(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[355],{369:(e,t,r)=>{"use strict";var n=r(62030),i=function(){return!!n};i.hasArrayLengthDefineBug=function(){if(!n)return null;try{return 1!==n([],"length",{value:1}).length}catch(e){return!0}},e.exports=i},668:e=>{var t="/";!function(){"undefined"!=typeof __nccwpck_require__&&(__nccwpck_require__.ab=t+"/");var r={};!function(){var e=r;e.endianness=function(){return"LE"},e.hostname=function(){return"undefined"!=typeof location?location.hostname:""},e.loadavg=function(){return[]},e.uptime=function(){return 0},e.freemem=function(){return Number.MAX_VALUE},e.totalmem=function(){return Number.MAX_VALUE},e.cpus=function(){return[]},e.type=function(){return"Browser"},e.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},e.networkInterfaces=e.getNetworkInterfaces=function(){return{}},e.arch=function(){return"javascript"},e.platform=function(){return"browser"},e.tmpdir=e.tmpDir=function(){return"/tmp"},e.EOL="\n",e.homedir=function(){return"/"}}(),e.exports=r}()},1504:(e,t,r)=>{var n=r(49509),i=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++)r[t[n]]=Object.getOwnPropertyDescriptor(e,t[n]);return r},s=/%[sdj%]/g;t.format=function(e){if(!x(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(c(arguments[r]));return t.join(" ")}for(var r=1,n=arguments,i=n.length,o=String(e).replace(s,function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),a=n[r];r<i;a=n[++r])E(a)||!_(a)?o+=" "+a:o+=" "+c(a);return o},t.deprecate=function(e,r){if(void 0!==n&&!0===n.noDeprecation)return e;if(void 0===n)return function(){return t.deprecate(e,r).apply(this,arguments)};var i=!1;return function(){if(!i){if(n.throwDeprecation)throw Error(r);n.traceDeprecation?console.trace(r):console.error(r),i=!0}return e.apply(this,arguments)}};var o={},a=/^$/;if(n.env.NODE_DEBUG){var l=n.env.NODE_DEBUG;a=RegExp("^"+(l=l.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase())+"$","i")}function c(e,r){var n={seen:[],stylize:d};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),v(r)?n.showHidden=r:r&&t._extend(n,r),S(n.showHidden)&&(n.showHidden=!1),S(n.depth)&&(n.depth=2),S(n.colors)&&(n.colors=!1),S(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=u),f(n,e,n.depth)}function u(e,t){var r=c.styles[t];return r?"\x1b["+c.colors[r][0]+"m"+e+"\x1b["+c.colors[r][1]+"m":e}function d(e,t){return e}function h(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function f(e,r,n){if(e.customInspect&&r&&C(r.inspect)&&r.inspect!==t.inspect&&!(r.constructor&&r.constructor.prototype===r)){var i,s=r.inspect(n,e);return x(s)||(s=f(e,s,n)),s}var o=p(e,r);if(o)return o;var a=Object.keys(r),l=h(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(r)),T(r)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return g(r);if(0===a.length){if(C(r)){var c=r.name?": "+r.name:"";return e.stylize("[Function"+c+"]","special")}if(k(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(I(r))return e.stylize(Date.prototype.toString.call(r),"date");if(T(r))return g(r)}var u="",d=!1,v=["{","}"];if(w(r)&&(d=!0,v=["[","]"]),C(r)&&(u=" [Function"+(r.name?": "+r.name:"")+"]"),k(r)&&(u=" "+RegExp.prototype.toString.call(r)),I(r)&&(u=" "+Date.prototype.toUTCString.call(r)),T(r)&&(u=" "+g(r)),0===a.length&&(!d||0==r.length))return v[0]+u+v[1];if(n<0)if(k(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");else return e.stylize("[Object]","special");return e.seen.push(r),i=d?m(e,r,n,l,a):a.map(function(t){return y(e,r,n,l,t,d)}),e.seen.pop(),b(i,u,v)}function p(e,t){if(S(t))return e.stylize("undefined","undefined");if(x(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return A(t)?e.stylize(""+t,"number"):v(t)?e.stylize(""+t,"boolean"):E(t)?e.stylize("null","null"):void 0}function g(e){return"["+Error.prototype.toString.call(e)+"]"}function m(e,t,r,n,i){for(var s=[],o=0,a=t.length;o<a;++o)M(t,String(o))?s.push(y(e,t,r,n,String(o),!0)):s.push("");return i.forEach(function(i){i.match(/^\d+$/)||s.push(y(e,t,r,n,i,!0))}),s}function y(e,t,r,n,i,s){var o,a,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(a=e.stylize("[Setter]","special")),M(n,i)||(o="["+i+"]"),!a&&(0>e.seen.indexOf(l.value)?(a=E(r)?f(e,l.value,null):f(e,l.value,r-1)).indexOf("\n")>-1&&(a=s?a.split("\n").map(function(e){return"  "+e}).join("\n").slice(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),S(o)){if(s&&i.match(/^\d+$/))return a;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.slice(1,-1),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+a}function b(e,t,r){var n=0;return e.reduce(function(e,t){return n++,t.indexOf("\n")>=0&&n++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function w(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function E(e){return null===e}function A(e){return"number"==typeof e}function x(e){return"string"==typeof e}function S(e){return void 0===e}function k(e){return _(e)&&"[object RegExp]"===P(e)}function _(e){return"object"==typeof e&&null!==e}function I(e){return _(e)&&"[object Date]"===P(e)}function T(e){return _(e)&&("[object Error]"===P(e)||e instanceof Error)}function C(e){return"function"==typeof e}function P(e){return Object.prototype.toString.call(e)}function R(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(!o[e=e.toUpperCase()])if(a.test(e)){var r=n.pid;o[e]=function(){var n=t.format.apply(t,arguments);console.error("%s %d: %s",e,r,n)}}else o[e]=function(){};return o[e]},t.inspect=c,c.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},c.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.types=r(60289),t.isArray=w,t.isBoolean=v,t.isNull=E,t.isNullOrUndefined=function(e){return null==e},t.isNumber=A,t.isString=x,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=S,t.isRegExp=k,t.types.isRegExp=k,t.isObject=_,t.isDate=I,t.types.isDate=I,t.isError=T,t.types.isNativeError=T,t.isFunction=C,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r(9742);var D=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function N(){var e=new Date,t=[R(e.getHours()),R(e.getMinutes()),R(e.getSeconds())].join(":");return[e.getDate(),D[e.getMonth()],t].join(" ")}function M(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",N(),t.format.apply(t,arguments))},t.inherits=r(84115),t._extend=function(e,t){if(!t||!_(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e};var B="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function O(e,t){if(!e){var r=Error("Promise was rejected with a falsy value");r.reason=e,e=r}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw TypeError('The "original" argument must be of type Function');if(B&&e[B]){var t=e[B];if("function"!=typeof t)throw TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,B,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,r,n=new Promise(function(e,n){t=e,r=n}),i=[],s=0;s<arguments.length;s++)i.push(arguments[s]);i.push(function(e,n){e?r(e):t(n)});try{e.apply(this,i)}catch(e){r(e)}return n}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),B&&Object.defineProperty(t,B,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,i(e))},t.promisify.custom=B,t.callbackify=function(e){if("function"!=typeof e)throw TypeError('The "original" argument must be of type Function');function t(){for(var t=[],r=0;r<arguments.length;r++)t.push(arguments[r]);var i=t.pop();if("function"!=typeof i)throw TypeError("The last argument must be of type Function");var s=this,o=function(){return i.apply(s,arguments)};e.apply(this,t).then(function(e){n.nextTick(o.bind(null,null,e))},function(e){n.nextTick(O.bind(null,e,o))})}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.defineProperties(t,i(e)),t}},1707:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});let n=function(e){let[t,r]=null!=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>t.next(),push:e=>{n.push(e)},next:()=>n.length>0?{done:!1,value:n.shift()}:t.next(),[r](){return this}}}},2629:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var n=r(69600),i=r(18593);function s(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}let o=s("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),a=s("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);let t=(0,i.K)(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),l={utf8:o,"utf-8":o,hex:n.Fo.base16,latin1:a,ascii:a,binary:a,...n.Fo}},2821:e=>{"use strict";e.exports=Object},2902:e=>{"use strict";e.exports=Error},3204:(e,t,r)=>{"use strict";r.d(t,{Um:()=>x,vF:()=>S});var n=r(43716),i=r(7796),s=r(53647);let o=1e3,a=6e4,l=36e5,c=864e5,u=6048e5,d=315576e5;function h(e){if((e=String(e)).length>100)throw Error("Value exceeds the maximum length of 100 characters.");let t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return NaN;let r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*d;case"weeks":case"week":case"w":return r*u;case"days":case"day":case"d":return r*c;case"hours":case"hour":case"hrs":case"hr":case"h":return r*l;case"minutes":case"minute":case"mins":case"min":case"m":return r*a;case"seconds":case"second":case"secs":case"sec":case"s":return r*o;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:throw Error(`The unit ${n} was matched, but no matching case exists.`)}}let f=function(e,t){try{if("string"==typeof e&&e.length>0)return h(e);if("number"==typeof e&&isFinite(e))return t?.long?g(e):p(e);throw Error("Value is not a string or number.")}catch(t){throw Error(y(t)?`${t.message}. value=${JSON.stringify(e)}`:"An unknown error has occured.")}};function p(e){let t=Math.abs(e);return t>=c?`${Math.round(e/c)}d`:t>=l?`${Math.round(e/l)}h`:t>=a?`${Math.round(e/a)}m`:t>=o?`${Math.round(e/o)}s`:`${e}ms`}function g(e){let t=Math.abs(e);return t>=c?m(e,t,c,"day"):t>=l?m(e,t,l,"hour"):t>=a?m(e,t,a,"minute"):t>=o?m(e,t,o,"second"):`${e} ms`}function m(e,t,r,n){let i=t>=1.5*r;return`${Math.round(e/r)} ${n}${i?"s":""}`}function y(e){return"object"==typeof e&&null!==e&&"message"in e}function b(e){function t(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){let t,i,s,o=null;function a(...e){if(!a.enabled)return;let n=a,i=Number(new Date);n.diff=i-(t||i),n.prev=t,n.curr=i,t=i,e[0]=r.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(t,i)=>{if("%%"===t)return"%";s++;let o=r.formatters[i];if("function"==typeof o){let r=e[s];t=o.call(n,r),e.splice(s,1),s--}return t}),r.formatArgs.call(n,e),(n.log||r.log).apply(n,e)}return a.namespace=e,a.useColors=r.useColors(),a.color=r.selectColor(e),a.extend=n,a.destroy=r.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==r.namespaces&&(i=r.namespaces,s=r.enabled(e)),s),set:e=>{o=e}}),"function"==typeof r.init&&r.init(a),a}function n(e,t){let n=r(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function i(e){let t;r.save(e),r.namespaces=e,r.names=[],r.skips=[];let n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(RegExp("^"+e.substr(1)+"$")):r.names.push(RegExp("^"+e+"$")))}function s(){let e=[...r.names.map(a),...r.skips.map(a).map(e=>"-"+e)].join(",");return r.enable(""),e}function o(e){let t,n;if("*"===e[e.length-1])return!0;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1}function a(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}function l(e){return e instanceof Error?e.stack??e.message:e}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.debug=r,r.default=r,r.coerce=l,r.disable=s,r.enable=i,r.enabled=o,r.humanize=f,r.destroy=c,Object.keys(e).forEach(t=>{r[t]=e[t]}),r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.setupFormatters(r.formatters),r.enable(r.load()),r}let w=v();function v(){try{return localStorage}catch(e){}}let E=b({formatArgs:function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+f(this.diff),!this.useColors)return;let t="color: "+this.color;e.splice(1,0,t,"color: inherit");let r=0,n=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(n=r))}),e.splice(n,0,t)},save:function(e){try{e?w?.setItem("debug",e):w?.removeItem("debug")}catch(e){}},load:function(){let e;try{e=w?.getItem("debug")}catch(e){}return!e&&void 0!==globalThis.process&&"env"in globalThis.process&&(e=globalThis.process.env.DEBUG),e},useColors:function(){return"undefined"!=typeof window&&!!window.process&&("renderer"===window.process.type||!!window.process.__nwjs)||("undefined"==typeof navigator||navigator.userAgent?.toLowerCase().match(/(edge|trident)\/(\d+)/)==null)&&("undefined"!=typeof document&&document.documentElement?.style?.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent?.toLowerCase().match(/firefox\/(\d+)/)!=null&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent?.toLowerCase().match(/applewebkit\/(\d+)/))},setupFormatters:function(e){e.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},colors:["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],storage:w,log:console.debug??console.log??(()=>{})});function A(e){let t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}E.formatters.b=e=>null==e?"undefined":i.base58btc.baseEncode(e),E.formatters.t=e=>null==e?"undefined":n.base32.baseEncode(e),E.formatters.m=e=>null==e?"undefined":s.base64.baseEncode(e),E.formatters.p=e=>null==e?"undefined":e.toString(),E.formatters.c=e=>null==e?"undefined":e.toString(),E.formatters.k=e=>null==e?"undefined":e.toString(),E.formatters.a=e=>null==e?"undefined":e.toString(),E.formatters.e=e=>null==e?"undefined":k(e.stack)??k(e.message)??e.toString();function x(){return{forComponent:e=>S(e)}}function S(e){let t=A(`${e}:trace`);return E.enabled(`${e}:trace`)&&null!=E.names.map(e=>e.toString()).find(e=>e.includes(":trace"))&&(t=E(`${e}:trace`)),Object.assign(E(e),{error:E(`${e}:error`),trace:t})}function k(e){if(null!=e&&0!==(e=e.trim()).length)return e}},3289:(e,t,r)=>{"use strict";var n=r(52430),i=r(61043),s=r(60261);e.exports=r(92678)||n.call(s,i)},3305:(e,t,r)=>{"use strict";var n=r(41878),i=/[\/\?<>\\:\*\|"]/g,s=/[\x00-\x1f\x80-\x9f]/g,o=/^\.+$/,a=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,l=/[\. ]+$/;function c(e,t){if("string"!=typeof e)throw Error("Input must be string");return n(e.replace(i,t).replace(s,t).replace(o,t).replace(a,t).replace(l,t),255)}e.exports=function(e,t){var r=t&&t.replacement||"",n=c(e,r);return""===r?n:c(n,"")}},3972:(e,t,r)=>{"use strict";r.d(t,{b:()=>o});var n=r(86620),i=r(98897),s=r(54954);class o extends s.f{data;constructor(){super(),this.data=new Map}put(e,t){return this.data.set(e.toString(),t),e}get(e){let t=this.data.get(e.toString());if(null==t)throw new i.m_;return t}has(e){return this.data.has(e.toString())}delete(e){this.data.delete(e.toString())}*_all(){for(let[e,t]of this.data.entries())yield{key:new n.U(e),value:t}}*_allKeys(){for(let e of this.data.keys())yield new n.U(e)}}},4157:(e,t,r)=>{"use strict";function n(e){return null!=e[Symbol.asyncIterator]}r.d(t,{A:()=>i});let i=function(e){if(n(e))return(async()=>{let t=[];for await(let r of e)t.push(r);return t})();let t=[];for(let r of e)t.push(r);return t}},4160:e=>{"use strict";e.exports=function(){return Date.now()}},5729:e=>{"use strict";e.exports=Math.floor},5845:(e,t,r)=>{"use strict";r.d(t,{i:()=>a});var n,i=r(12115),s=r(52712),o=(n||(n=r.t(i,2)))[" useInsertionEffect ".trim().toString()]||s.N;function a({prop:e,defaultProp:t,onChange:r=()=>{},caller:n}){let[s,o,a]=l({defaultProp:t,onChange:r}),u=void 0!==e,d=u?e:s;{let t=i.useRef(void 0!==e);i.useEffect(()=>{let e=t.current;if(e!==u){let t=e?"controlled":"uncontrolled",r=u?"controlled":"uncontrolled";console.warn(`${n} is changing from ${t} to ${r}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`)}t.current=u},[u,n])}return[d,i.useCallback(t=>{if(u){let r=c(t)?t(e):t;r!==e&&a.current?.(r)}else o(t)},[u,e,o,a])]}function l({defaultProp:e,onChange:t}){let[r,n]=i.useState(e),s=i.useRef(r),a=i.useRef(t);return o(()=>{a.current=t},[t]),i.useEffect(()=>{s.current!==r&&(a.current?.(r),s.current=r)},[r,s]),[r,n,a]}function c(e){return"function"==typeof e}Symbol("RADIX:SYNC_STATE")},5955:(e,t,r)=>{"use strict";var n=r(29241),i=Object.prototype.toString,s=Object.prototype.hasOwnProperty,o=function(e,t,r){for(var n=0,i=e.length;n<i;n++)s.call(e,n)&&(null==r?t(e[n],n,e):t.call(r,e[n],n,e))},a=function(e,t,r){for(var n=0,i=e.length;n<i;n++)null==r?t(e.charAt(n),n,e):t.call(r,e.charAt(n),n,e)},l=function(e,t,r){for(var n in e)s.call(e,n)&&(null==r?t(e[n],n,e):t.call(r,e[n],n,e))};function c(e){return"[object Array]"===i.call(e)}e.exports=function(e,t,r){var i;if(!n(t))throw TypeError("iterator must be a function");arguments.length>=3&&(i=r),c(e)?o(e,t,i):"string"==typeof e?a(e,t,i):l(e,t,i)}},6913:e=>{"use strict";e.exports=e=>{if("[object Object]"!==Object.prototype.toString.call(e))return!1;let t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}},7610:(e,t)=>{t.read=function(e,t,r,n,i){var s,o,a=8*i-n-1,l=(1<<a)-1,c=l>>1,u=-7,d=r?i-1:0,h=r?-1:1,f=e[t+d];for(d+=h,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=256*s+e[t+d],d+=h,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=n;u>0;o=256*o+e[t+d],d+=h,u-=8);if(0===s)s=1-c;else{if(s===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),s-=c}return(f?-1:1)*o*Math.pow(2,s-n)},t.write=function(e,t,r,n,i,s){var o,a,l,c=8*s-i-1,u=(1<<c)-1,d=u>>1,h=5960464477539062e-23*(23===i),f=n?0:s-1,p=n?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(a=+!!isNaN(t),o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+d>=1?t+=h/l:t+=h*Math.pow(2,1-d),t*l>=2&&(o++,l/=2),o+d>=u?(a=0,o=u):o+d>=1?(a=(t*l-1)*Math.pow(2,i),o+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;e[r+f]=255&a,f+=p,a/=256,i-=8);for(o=o<<i|a,c+=i;c>0;e[r+f]=255&o,f+=p,o/=256,c-=8);e[r+f-p]|=128*g}},7786:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(1707);function i(e){return null!=e[Symbol.asyncIterator]}let s=function(e,t){let r=0;if(i(e))return async function*(){for await(let n of e)yield t(n,r++)}();let s=(0,n.A)(e),{value:o,done:a}=s.next();if(!0===a)return function*(){}();let l=t(o,r++);if("function"==typeof l.then)return async function*(){for await(let e of(yield await l,s))yield t(e,r++)}();let c=t;return function*(){for(let e of(yield l,s))yield c(e,r++)}()}},7796:(e,t,r)=>{"use strict";r.r(t),r.d(t,{base58btc:()=>i,base58flickr:()=>s});var n=r(52215);let i=(0,n._Q)({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),s=(0,n._Q)({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})},7800:e=>{"use strict";e.exports=class extends Error{constructor(e,t){super(e||""),"object"==typeof t&&null!==t&&(t.code&&(this.code=String(t.code)),t.expected&&(this.expected=!0),t.transient&&(this.transient=!0),t.cause&&(this.cause=t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}},8024:(e,t,r)=>{"use strict";var n=r(70508),i=r(59888),s=r(369)(),o=r(81954),a=r(63674),l=n("%Math.floor%");e.exports=function(e,t){if("function"!=typeof e)throw new a("`fn` is not a function");if("number"!=typeof t||t<0||t>0xffffffff||l(t)!==t)throw new a("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],n=!0,c=!0;if("length"in e&&o){var u=o(e,"length");u&&!u.configurable&&(n=!1),u&&!u.writable&&(c=!1)}return(n||c||!r)&&(s?i(e,"length",t,!0,!0):i(e,"length",t)),e}},8419:(e,t,r)=>{"use strict";var n=r(33771),i="undefined"==typeof globalThis?r.g:globalThis;e.exports=function(){for(var e=[],t=0;t<n.length;t++)"function"==typeof i[n[t]]&&(e[e.length]=n[t]);return e}},9166:(e,t,r)=>{"use strict";var n=r(8024),i=r(62030),s=r(85407),o=r(13588);e.exports=function(e){var t=s(arguments),r=e.length-(arguments.length-1);return n(t,1+(r>0?r:0),!0)},i?i(e.exports,"apply",{value:o}):e.exports.apply=o},9742:e=>{e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},10258:(e,t,r)=>{"use strict";r.d(t,{W:()=>i});class n extends Error{type;code;constructor(e,t,r){super(e??"The operation was aborted"),this.type="aborted",this.name=r??"AbortError",this.code=t??"ABORT_ERR"}}async function i(e,t,r){let i;if(null==t)return e;if(t.aborted)return e.catch(()=>{}),Promise.reject(new n(r?.errorMessage,r?.errorCode,r?.errorName));let s=new n(r?.errorMessage,r?.errorCode,r?.errorName);try{return await Promise.race([e,new Promise((e,r)=>{i=()=>{r(s)},t.addEventListener("abort",i)})])}finally{null!=i&&t.removeEventListener("abort",i)}}},10681:(e,t,r)=>{"use strict";var n,i=r(85407),s=r(81954);try{n=[].__proto__===Array.prototype}catch(e){if(!e||"object"!=typeof e||!("code"in e)||"ERR_PROTO_ACCESS"!==e.code)throw e}var o=!!n&&s&&s(Object.prototype,"__proto__"),a=Object,l=a.getPrototypeOf;e.exports=o&&"function"==typeof o.get?i([o.get]):"function"==typeof l&&function(e){return l(null==e?e:a(e))}},12338:(e,t,r)=>{"use strict";let n=r(7800),i=r(86892),{Encoding:s}=r(69503),{BufferFormat:o,ViewFormat:a,UTF8Format:l}=r(22846),c=Symbol("formats"),u=Symbol("encodings"),d=new Set(["buffer","view","utf8"]);class h{constructor(e){if(Array.isArray(e)){if(!e.every(e=>d.has(e)))throw TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw TypeError("The first argument 'formats' must be an array");for(let t in this[u]=new Map,this[c]=new Set(e),i)try{this.encoding(t)}catch(e){if("LEVEL_ENCODING_NOT_SUPPORTED"!==e.code)throw e}}encodings(){return Array.from(new Set(this[u].values()))}encoding(e){let t=this[u].get(e);if(void 0===t){if("string"==typeof e&&""!==e){if(!(t=m[e]))throw new n(`Encoding '${e}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else if("object"!=typeof e||null===e)throw TypeError("First argument 'encoding' must be a string or object");else t=f(e);let{name:r,format:i}=t;if(!this[c].has(i))if(this[c].has("view"))t=t.createViewTranscoder();else if(this[c].has("buffer"))t=t.createBufferTranscoder();else if(this[c].has("utf8"))t=t.createUTF8Transcoder();else throw new n(`Encoding '${r}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(let n of[e,r,t.name,t.commonName])this[u].set(n,t)}return t}}function f(e){if(e instanceof s)return e;let t="type"in e&&"string"==typeof e.type?e.type:void 0,r=e.name||t||`anonymous-${y++}`;switch(p(e)){case"view":return new a({...e,name:r});case"utf8":return new l({...e,name:r});case"buffer":return new o({...e,name:r});default:throw TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function p(e){return"format"in e&&void 0!==e.format?e.format:"buffer"in e&&"boolean"==typeof e.buffer?e.buffer?"buffer":"utf8":"code"in e&&Number.isInteger(e.code)?"view":"buffer"}t.Transcoder=h;let g={binary:i.buffer,"utf-8":i.utf8},m={...i,...g},y=0},12588:e=>{"use strict";function t(e){return e>=55296&&e<=56319}function r(e){return e>=56320&&e<=57343}e.exports=function(e,n,i){if("string"!=typeof n)throw Error("Input must be string");for(var s,o,a=n.length,l=0,c=0;c<a;c+=1){if(s=n.charCodeAt(c),o=n[c],t(s)&&r(n.charCodeAt(c+1))&&(c+=1,o+=n[c]),(l+=e(o))===i)return n.slice(0,c+1);if(l>i)return n.slice(0,c-o.length+1)}return n}},12764:e=>{"use strict";e.exports=EvalError},13080:(e,t,r)=>{"use strict";let n;r.d(t,{y:()=>m});var i=r(17849),s=r(49509);let o="test"==s.env.ETH_ENV?"http://localhost:8545":`https://sepolia.infura.io/v3/${s.env.SEPOLIA_API_KEY}`;if("undefined"!=typeof window&&void 0!==window.ethereum)window.ethereum.request({method:"eth_requestAccounts"}),n=new i.Ay$(window.ethereum);else{let e=new i.Ay$.providers.HttpProvider(o);n=new i.Ay$(e)}let a=n,l=JSON.parse('[{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"articulos","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"titulo","type":"string"},{"internalType":"string[]","name":"contenido","type":"string[]"}],"name":"crearArticulo","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getArticulos","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getTitulos","outputs":[{"internalType":"string[]","name":"","type":"string[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"","type":"string"}],"name":"tituloToAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"titulos","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"}]'),c=JSON.parse('[{"inputs":[{"internalType":"string","name":"_titulo","type":"string"},{"internalType":"string[]","name":"_contenido","type":"string[]"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[{"internalType":"string","name":"_version","type":"string"}],"name":"addContenido","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"contenido","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getContenido","outputs":[{"internalType":"string[]","name":"","type":"string[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string[]","name":"_contenido","type":"string[]"}],"name":"setContenido","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_titulo","type":"string"}],"name":"setTitulo","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"titulo","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"}]'),u="0xc2F3e8C55dF2958483ce4707DF8C469FDBD272B9";var d=r(57116);class h{articleName;versionManager;constructor(e,t){this.articleName=e,this.versionManager=new d.m9(t)}getContent(e){let t=[];return t=e?this.versionManager.getBranch(e):this.versionManager.getMainBranch(),(0,d.a6)(t)}getVersions(){let e=new Set(this.versionManager.getMainBranch().map(e=>e.id));return this.versionManager.getAllVersions().map(t=>({id:t.id,date:t.date,parent:t.parent,mainBranch:e.has(t.id)}))}getCurrentVersionID(){let e=this.versionManager.getMainBranch();if(0===e.length)throw Error("No versions found");return e[e.length-1].id}newContent(e,t){let r;if(t){let n=this.versionManager.getBranch(t),i=(0,d.a6)(n);r=(0,d.JL)(i,e,t)}else r=(0,d.JL)("",e,t??null);return this.versionManager.addVersion(r),r}}class f{factoryInstance;constructor(){this.factoryInstance=new a.eth.Contract(l,u)}async getArticle(e){let t=await this.factoryInstance.methods.tituloToAddress(e).call();if(!t)return Promise.reject("Article not found");let r=new a.eth.Contract(c,t);return new h(e,(await r.methods.getContenido().call()).map(e=>JSON.parse(e)))}async newArticle(e,t){let r=(0,d.JL)("",t),n=await a.eth.getAccounts(),i=[JSON.stringify(r)];await this.factoryInstance.methods.crearArticulo(e,i).send({from:n[0]})}async addVersion(e,t,r){let n=await this.factoryInstance.methods.tituloToAddress(e).call();if(!n)return Promise.reject("Article not found");let i=new a.eth.Contract(c,n),s=(await this.getArticle(e)).newContent(t,r),o=await a.eth.getAccounts();await i.methods.addContenido(JSON.stringify(s)).send({from:o[0]})}async getArticleList(){return this.factoryInstance.methods.getTitulos().call()}}class p{articleRepository;lastVersionFetchedByArticle;versionManager;async start(){this.articleRepository=new f,this.lastVersionFetchedByArticle=new Map}async getArticle(e,t){let r=await this.articleRepository.getArticle(e);return this.lastVersionFetchedByArticle.set(e,r.getCurrentVersionID()),{name:e,content:r.getContent(t),versionsInfo:r.getVersions()}}async newArticle(e,t){await this.articleRepository.newArticle(e,t)}async editArticle(e,t){let r=this.lastVersionFetchedByArticle.get(e);if(!r)throw Error(`Article ${e} was not previously fetched. Fetched articles: ${this.lastVersionFetchedByArticle.keys()}`);await this.articleRepository.addVersion(e,t,r)}async getArticleList(){return this.articleRepository.getArticleList()}async stop(){}async searchArticles(e,t,r){throw Error("Method not implemented.")}}let g=p;async function m(){let e=new g;return await e.start(),e}},13372:e=>{"use strict";e.exports=Object.getOwnPropertyDescriptor},13588:(e,t,r)=>{"use strict";var n=r(52430),i=r(61043),s=r(3289);e.exports=function(){return s(n,i,arguments)}},13623:e=>{"use strict";let t=new TextEncoder;e.exports=function(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):t.encode(e)}},15452:(e,t,r)=>{"use strict";r.d(t,{UC:()=>en,VY:()=>es,ZL:()=>et,bL:()=>X,bm:()=>eo,hE:()=>ei,hJ:()=>er,l9:()=>ee});var n=r(12115),i=r(85185),s=r(6101),o=r(46081),a=r(61285),l=r(5845),c=r(19178),u=r(25519),d=r(34378),h=r(28905),f=r(63655),p=r(92293),g=r(93795),m=r(38168),y=r(99708),b=r(95155),w="Dialog",[v,E]=(0,o.A)(w),[A,x]=v(w),S=e=>{let{__scopeDialog:t,children:r,open:i,defaultOpen:s,onOpenChange:o,modal:c=!0}=e,u=n.useRef(null),d=n.useRef(null),[h,f]=(0,l.i)({prop:i,defaultProp:null!=s&&s,onChange:o,caller:w});return(0,b.jsx)(A,{scope:t,triggerRef:u,contentRef:d,contentId:(0,a.B)(),titleId:(0,a.B)(),descriptionId:(0,a.B)(),open:h,onOpenChange:f,onOpenToggle:n.useCallback(()=>f(e=>!e),[f]),modal:c,children:r})};S.displayName=w;var k="DialogTrigger",_=n.forwardRef((e,t)=>{let{__scopeDialog:r,...n}=e,o=x(k,r),a=(0,s.s)(t,o.triggerRef);return(0,b.jsx)(f.sG.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":G(o.open),...n,ref:a,onClick:(0,i.m)(e.onClick,o.onOpenToggle)})});_.displayName=k;var I="DialogPortal",[T,C]=v(I,{forceMount:void 0}),P=e=>{let{__scopeDialog:t,forceMount:r,children:i,container:s}=e,o=x(I,t);return(0,b.jsx)(T,{scope:t,forceMount:r,children:n.Children.map(i,e=>(0,b.jsx)(h.C,{present:r||o.open,children:(0,b.jsx)(d.Z,{asChild:!0,container:s,children:e})}))})};P.displayName=I;var R="DialogOverlay",D=n.forwardRef((e,t)=>{let r=C(R,e.__scopeDialog),{forceMount:n=r.forceMount,...i}=e,s=x(R,e.__scopeDialog);return s.modal?(0,b.jsx)(h.C,{present:n||s.open,children:(0,b.jsx)(M,{...i,ref:t})}):null});D.displayName=R;var N=(0,y.TL)("DialogOverlay.RemoveScroll"),M=n.forwardRef((e,t)=>{let{__scopeDialog:r,...n}=e,i=x(R,r);return(0,b.jsx)(g.A,{as:N,allowPinchZoom:!0,shards:[i.contentRef],children:(0,b.jsx)(f.sG.div,{"data-state":G(i.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),B="DialogContent",O=n.forwardRef((e,t)=>{let r=C(B,e.__scopeDialog),{forceMount:n=r.forceMount,...i}=e,s=x(B,e.__scopeDialog);return(0,b.jsx)(h.C,{present:n||s.open,children:s.modal?(0,b.jsx)(L,{...i,ref:t}):(0,b.jsx)(F,{...i,ref:t})})});O.displayName=B;var L=n.forwardRef((e,t)=>{let r=x(B,e.__scopeDialog),o=n.useRef(null),a=(0,s.s)(t,r.contentRef,o);return n.useEffect(()=>{let e=o.current;if(e)return(0,m.Eq)(e)},[]),(0,b.jsx)(U,{...e,ref:a,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,i.m)(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),null==(t=r.triggerRef.current)||t.focus()}),onPointerDownOutside:(0,i.m)(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,r=0===t.button&&!0===t.ctrlKey;(2===t.button||r)&&e.preventDefault()}),onFocusOutside:(0,i.m)(e.onFocusOutside,e=>e.preventDefault())})}),F=n.forwardRef((e,t)=>{let r=x(B,e.__scopeDialog),i=n.useRef(!1),s=n.useRef(!1);return(0,b.jsx)(U,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var n,o;null==(n=e.onCloseAutoFocus)||n.call(e,t),t.defaultPrevented||(i.current||null==(o=r.triggerRef.current)||o.focus(),t.preventDefault()),i.current=!1,s.current=!1},onInteractOutside:t=>{var n,o;null==(n=e.onInteractOutside)||n.call(e,t),t.defaultPrevented||(i.current=!0,"pointerdown"===t.detail.originalEvent.type&&(s.current=!0));let a=t.target;(null==(o=r.triggerRef.current)?void 0:o.contains(a))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&s.current&&t.preventDefault()}})}),U=n.forwardRef((e,t)=>{let{__scopeDialog:r,trapFocus:i,onOpenAutoFocus:o,onCloseAutoFocus:a,...l}=e,d=x(B,r),h=n.useRef(null),f=(0,s.s)(t,h);return(0,p.Oh)(),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(u.n,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:o,onUnmountAutoFocus:a,children:(0,b.jsx)(c.qW,{role:"dialog",id:d.contentId,"aria-describedby":d.descriptionId,"aria-labelledby":d.titleId,"data-state":G(d.open),...l,ref:f,onDismiss:()=>d.onOpenChange(!1)})}),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(J,{titleId:d.titleId}),(0,b.jsx)(Y,{contentRef:h,descriptionId:d.descriptionId})]})]})}),j="DialogTitle",H=n.forwardRef((e,t)=>{let{__scopeDialog:r,...n}=e,i=x(j,r);return(0,b.jsx)(f.sG.h2,{id:i.titleId,...n,ref:t})});H.displayName=j;var $="DialogDescription",q=n.forwardRef((e,t)=>{let{__scopeDialog:r,...n}=e,i=x($,r);return(0,b.jsx)(f.sG.p,{id:i.descriptionId,...n,ref:t})});q.displayName=$;var z="DialogClose",V=n.forwardRef((e,t)=>{let{__scopeDialog:r,...n}=e,s=x(z,r);return(0,b.jsx)(f.sG.button,{type:"button",...n,ref:t,onClick:(0,i.m)(e.onClick,()=>s.onOpenChange(!1))})});function G(e){return e?"open":"closed"}V.displayName=z;var K="DialogTitleWarning",[W,Q]=(0,o.q)(K,{contentName:B,titleName:j,docsSlug:"dialog"}),J=e=>{let{titleId:t}=e,r=Q(K),i="`".concat(r.contentName,"` requires a `").concat(r.titleName,"` for the component to be accessible for screen reader users.\n\nIf you want to hide the `").concat(r.titleName,"`, you can wrap it with our VisuallyHidden component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/").concat(r.docsSlug);return n.useEffect(()=>{t&&(document.getElementById(t)||console.error(i))},[i,t]),null},Z="DialogDescriptionWarning",Y=e=>{let{contentRef:t,descriptionId:r}=e,i=Q(Z),s="Warning: Missing `Description` or `aria-describedby={undefined}` for {".concat(i.contentName,"}.");return n.useEffect(()=>{var e;let n=null==(e=t.current)?void 0:e.getAttribute("aria-describedby");r&&n&&(document.getElementById(r)||console.warn(s))},[s,t,r]),null},X=S,ee=_,et=P,er=D,en=O,ei=H,es=q,eo=V},15484:(e,t,r)=>{"use strict";r.d(t,{A:()=>i,b:()=>n});var n=r(82661);let i=n},16121:(e,t,r)=>{"use strict";r.d(t,{TO:()=>i.TO,br:()=>s,ee:()=>n});var n=r(70834),i=r(69685),s=r(87704);r(65639),r(41394)},17001:(e,t,r)=>{"use strict";var n,i=r(91453),s=r(95224)(/^\s*(?:function)?\*/),o=r(39781)(),a=r(21589),l=i("Object.prototype.toString"),c=i("Function.prototype.toString"),u=function(){if(!o)return!1;try{return Function("return function*() {}")()}catch(e){}};e.exports=function(e){if("function"!=typeof e)return!1;if(s(c(e)))return!0;if(!o)return"[object GeneratorFunction]"===l(e);if(!a)return!1;if(void 0===n){var t=u();n=!!t&&a(t)}return a(e)===n}},17849:(e,t,r)=>{"use strict";let n,i,s,o,a,l,c,u,d,h,f,p,g,m,y,b,w,v;r.d(t,{Ay$:()=>wD});var E,A,x,S,k,_,I,T,C,P,R,D,N,M,B,O,L,F,U,j,H,$,q,z,V,G={};r.r(G),r.d(G,{abiSchemaToJsonSchema:()=>oq,codePointToInt:()=>oK,ensureIfUint8Array:()=>o1,ethAbiToJsonSchema:()=>oz,fetchArrayElement:()=>oV,hexToNumber:()=>oW,hexToUint8Array:()=>o0,numberToHex:()=>oQ,padLeft:()=>oJ,parseBaseType:()=>oH,transformJsonDataToAbiFormat:()=>oG,uint8ArrayToHexString:()=>oZ});var K={};r.r(K),r.d(K,{isBatchRequest:()=>lX,isBatchResponse:()=>lQ,isResponseRpcError:()=>l$,isResponseWithError:()=>lz,isResponseWithNotification:()=>lV,isResponseWithResult:()=>lq,isSubscriptionResult:()=>lG,isValidResponse:()=>lW,setRequestIdStart:()=>lJ,toBatchPayload:()=>lY,toPayload:()=>lZ,validateResponse:()=>lK});var W={};r.r(W),r.d(W,{ChunkResponseParser:()=>l2,Eip1193Provider:()=>l4,EventEmitter:()=>aY,SocketProvider:()=>l7,Web3DeferredPromise:()=>l1,asciiToHex:()=>aj,bytesToHex:()=>a_,bytesToUint8Array:()=>aS,checkAddressCheckSum:()=>a1,compareBlockNumbers:()=>a9,convert:()=>lg,convertScalarValue:()=>lf,encodePacked:()=>lI,ethUnitMap:()=>aA,format:()=>lm,fromAscii:()=>aH,fromDecimal:()=>aR,fromTwosComplement:()=>lc,fromUtf8:()=>aM,fromWei:()=>aK,getStorageSlotNumForLongString:()=>lP,hexToAscii:()=>a$,hexToBytes:()=>aI,hexToNumber:()=>aT,hexToNumberString:()=>aD,hexToString:()=>aU,hexToUtf8:()=>aO,isAddress:()=>a2,isBatchRequest:()=>lX,isBatchResponse:()=>lQ,isBloom:()=>a3,isContractAddressInBloom:()=>a6,isContractInitOptions:()=>le,isDataFormat:()=>ld,isHex:()=>a0,isHexStrict:()=>aX,isInBloom:()=>a4,isNullish:()=>lt,isPromise:()=>lB,isResponseRpcError:()=>l$,isResponseWithError:()=>lz,isResponseWithNotification:()=>lV,isResponseWithResult:()=>lq,isSubscriptionResult:()=>lG,isTopic:()=>a8,isTopicInBloom:()=>a7,isUint8Array:()=>aw,isUserEthereumAddressInBloom:()=>a5,isValidResponse:()=>lW,jsonRpc:()=>K,keccak256:()=>lb,keccak256Wrapper:()=>lb,leftPad:()=>la,mergeDeep:()=>ln,numberToHex:()=>aP,padLeft:()=>li,padRight:()=>ls,pollTillDefined:()=>lF,pollTillDefinedAndReturnIntervalId:()=>lL,processSolidityEncodePackedArgs:()=>l_,randomBytes:()=>lD,randomHex:()=>lN,rejectIfConditionAtInterval:()=>lj,rejectIfTimeout:()=>lU,rightPad:()=>lo,setRequestIdStart:()=>lJ,sha3:()=>lw,sha3Raw:()=>lv,soliditySha3:()=>lT,soliditySha3Raw:()=>lC,stringToHex:()=>aB,toAscii:()=>aq,toBatchPayload:()=>lY,toBigInt:()=>aG,toBool:()=>aJ,toChecksumAddress:()=>aQ,toDecimal:()=>aC,toHex:()=>az,toNumber:()=>aV,toPayload:()=>lZ,toTwosComplement:()=>ll,toUtf8:()=>aL,toWei:()=>aW,uint8ArrayConcat:()=>av,uint8ArrayEquals:()=>aE,utf8ToBytes:()=>aF,utf8ToHex:()=>aN,uuidV4:()=>lH,validateResponse:()=>lK,waitWithTimeout:()=>lO});var Q={};r.r(Q),r.d(Q,{DO:()=>c5,OG:()=>ul,My:()=>c8,Ph:()=>ur,lX:()=>un,Id:()=>ua,fg:()=>ud,qj:()=>uo,aT:()=>ut,aY:()=>c4,lq:()=>ui,z:()=>us,Q5:()=>uf});var J={};r.r(J),r.d(J,{secp256k1:()=>u8}),function(e){e.NUMBER="NUMBER_NUMBER",e.HEX="NUMBER_HEX",e.STR="NUMBER_STR",e.BIGINT="NUMBER_BIGINT"}(E||(E={})),function(e){e.HEX="BYTES_HEX",e.UINT8ARRAY="BYTES_UINT8ARRAY"}(A||(A={}));let Z={number:E.BIGINT,bytes:A.HEX},Y={number:E.HEX,bytes:A.HEX};!function(e){e.EARLIEST="earliest",e.LATEST="latest",e.PENDING="pending",e.SAFE="safe",e.FINALIZED="finalized",e.COMMITTED="committed"}(x||(x={})),function(e){e.chainstart="chainstart",e.frontier="frontier",e.homestead="homestead",e.dao="dao",e.tangerineWhistle="tangerineWhistle",e.spuriousDragon="spuriousDragon",e.byzantium="byzantium",e.constantinople="constantinople",e.petersburg="petersburg",e.istanbul="istanbul",e.muirGlacier="muirGlacier",e.berlin="berlin",e.london="london",e.altair="altair",e.arrowGlacier="arrowGlacier",e.grayGlacier="grayGlacier",e.bellatrix="bellatrix",e.merge="merge",e.capella="capella",e.shanghai="shanghai"}(S||(S={}));let X=Object.getPrototypeOf(Uint8Array);var ee=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let et=Symbol.for("web3/base-provider");class er{static isWeb3Provider(e){return e instanceof er||!!(e&&e[et])}get[et](){return!0}send(e,t){this.request(e).then(e=>{t(null,e)}).catch(e=>{t(e)})}sendAsync(e){return ee(this,void 0,void 0,function*(){return this.request(e)})}asEIP1193Provider(){let e=Object.create(this),t=e.request;return e.request=function(e){return ee(this,void 0,void 0,function*(){return(yield t(e)).result})},e.asEIP1193Provider=void 0,e}}class en extends Array{constructor(e){super(),this._accountProvider=e}}let ei=100,es=101,eo=201,ea=202,el=203,ec=204,eu=205,ed=206,eh=207,ef=208,ep=300,eg=301,em=310,ey=311,eb=400,ew=402,ev=405,eE=407,eA=408,ex=410,eS=411,ek=412,e_=413,eI=414,eT=415,eC=416,eP=417,eR=418,eD=419,eN=420,eM=421,eB=422,eO=423,eL=424,eF=425,eU=426,ej=427,eH=428,e$=429,eq=430,ez=431,eV=432,eG=433,eK=434,eW=435,eQ=436,eJ=437,eZ=438,eY=439,eX=440,e0=441,e1=500,e2=503,e3=505,e4=506,e5=507,e6=600,e8=602,e7=603,e9=604,te=701,tt=702,tr=703,tn=704,ti=705,ts=706,to=707,ta=709,tl=801,tc=802,tu=4001,td=4100,th=4200,tf=4900,tp=4901,tg=902,tm=903,ty=1001,tb=1002,tw=1003,tv=1004,tE=1005,tA=1006,tx=1008,tS=1009,tk=1010,t_=1011,tI=1012,tT=1014,tC=1015,tP=1100,tR=1101,tD=1200,tN=-32700,tM=-32600,tB=-32601,tO=-32602,tL=-32603,tF=-32e3,tU=-32001,tj=-32002,tH=-32003,t$=-32004,tq=-32005,tz=-32006;class tV extends Error{get innerError(){return this.cause instanceof tG?this.cause.errors:this.cause}set innerError(e){Array.isArray(e)?this.cause=new tG(e):this.cause=e}constructor(e,t){super(e),Array.isArray(t)?this.cause=new tG(t):this.cause=t,this.name=this.constructor.name,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(new.target.constructor):this.stack=Error().stack}static convertToString(e,t=!1){if(null==e)return"undefined";let r=JSON.stringify(e,(e,t)=>"bigint"==typeof t?t.toString():t);return t&&["bigint","string"].includes(typeof e)?r.replace(/['\\"]+/g,""):r}toJSON(){return{name:this.name,code:this.code,message:this.message,cause:this.cause,innerError:this.cause}}}class tG extends tV{constructor(e){super(`Multiple errors occurred: [${e.map(e=>e.message).join("], [")}]`),this.code=ef,this.errors=e}}class tK extends tV{constructor(e,t){super(`Invalid value given "${tV.convertToString(e,!0)}". Error: ${t}.`),this.name=this.constructor.name}}class tW extends tV{constructor(){super("Private key must be 32 bytes."),this.code=te}}class tQ extends tV{constructor(){super("Invalid Private Key, Not a valid string or uint8Array"),this.code=tt}}class tJ extends tV{constructor(e){super(`"${e}"`),this.code=tc}}class tZ extends tV{constructor(){super("Invalid key derivation function"),this.code=tr}}class tY extends tV{constructor(){super("Key derivation failed - possibly wrong password"),this.code=tn}}class tX extends tV{constructor(){super("Unsupported key store version"),this.code=ti}}class t0 extends tV{constructor(){super("Password cannot be empty"),this.code=ts}}class t1 extends tV{constructor(){super("Initialization vector must be 16 bytes"),this.code=to}}class t2 extends tV{constructor(){super("c > 1000, pbkdf2 is less secure with less iterations"),this.code=ta}}class t3 extends tV{constructor(e,t){super(e),this.code=e1,t&&(this.errorCode=t.code,this.errorReason=t.reason)}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{errorCode:this.errorCode,errorReason:this.errorReason})}}class t4 extends t3{constructor(e){super("Connection not open",e),this.code=e2}}class t5 extends t3{constructor(e){super(`Maximum number of reconnect attempts reached! (${e})`),this.code=e3}}class t6 extends t3{constructor(){super("CONNECTION ERROR: Provider started to reconnect before the response got received!"),this.code=e4}}class t8 extends t3{constructor(e){super(`Request already sent with following id: ${e}`),this.code=e5}}class t7 extends tV{constructor(e,t){super(e),this.code=ep,this.receipt=t}}class t9 extends tV{constructor(e,t){super(`The resolver at ${e} does not implement requested method: "${t}".`),this.address=e,this.name=t,this.code=eg}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{address:this.address,name:this.name})}}class re extends t7{constructor(e){if(super(e.message||"Error"),this.name="name"in e&&e.name||this.constructor.name,this.stack="stack"in e&&e.stack||void 0,this.code=e.code,"object"==typeof e.data){let t;t=e.data&&"originalError"in e.data?e.data.originalError:e.data,this.data=t.data,this.cause=new re(t)}else this.data=e.data}setDecodedProperties(e,t,r){this.errorName=e,this.errorSignature=t,this.errorArgs=r}toJSON(){let e=Object.assign(Object.assign({},super.toJSON()),{data:this.data});return this.errorName&&(e=Object.assign(Object.assign({},e),{errorName:this.errorName,errorSignature:this.errorSignature,errorArgs:this.errorArgs})),e}}class rt extends t7{constructor(e){super("Error happened while trying to execute a function inside a smart contract"),this.code=em,this.cause=new re(e)}}class rr extends tK{constructor(e){var t,r;super(`data: ${null!=(t=e.data)?t:"undefined"}, input: ${null!=(r=e.input)?r:"undefined"}`,'You can\'t have "data" and "input" as properties of a contract at the same time, please use either "data" or "input" instead.'),this.code=ey}}class rn extends tV{constructor(e){super(`ENS is not supported on network ${e}`),this.code=tg}}class ri extends tV{constructor(){super("Network not synced"),this.code=tm}}class rs extends tV{constructor(e){super(`Invalid parameters passed. "${void 0!==e?e:""}"`),this.hint=e,this.code=eh}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{hint:this.hint})}}class ro extends tV{constructor(){super(...arguments),this.code=eo}}class ra extends tV{constructor(){super("The method you're trying to call is not implemented."),this.code=ea}}class rl extends tV{constructor(){super(...arguments),this.code=el}}class rc extends tV{constructor(){super(...arguments),this.code=ec}}class ru extends tV{constructor(e,t){super(e),this.code=eu,this.props=null!=t?t:{}}}class rd extends tV{constructor(e){super(`A plugin with the namespace: ${e} has already been registered.`),this.code=ed}}class rh extends tV{constructor(){super(...arguments),this.code=e6}}class rf extends tV{constructor(e){super(`Client URL "${e}" is invalid.`),this.code=e8}}class rp extends tV{constructor(){super(...arguments),this.code=e7}}class rg extends tV{constructor(){super(...arguments),this.code=e9}}class rm extends tK{constructor(){super(...arguments),this.code=tl}}class ry extends tV{constructor(e,t){super(e),this.receipt=t,this.code=eb}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{receipt:this.receipt})}}class rb extends tV{constructor(e,t,r,n){super(`Transaction has been reverted by the EVM${void 0===r?"":`:
 ${tV.convertToString(r)}`}`),this.reason=e,this.signature=t,this.receipt=r,this.data=n,this.code=ew}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{reason:this.reason,signature:this.signature,receipt:this.receipt,data:this.data})}}class rw extends rb{constructor(e,t,r,n,i,s,o){super(e),this.reason=e,this.customErrorName=t,this.customErrorDecodedSignature=r,this.customErrorArguments=n,this.signature=i,this.receipt=s,this.data=o,this.code=eZ}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{reason:this.reason,customErrorName:this.customErrorName,customErrorDecodedSignature:this.customErrorDecodedSignature,customErrorArguments:this.customErrorArguments,signature:this.signature,receipt:this.receipt,data:this.data})}}class rv extends ry{constructor(e){super(`Transaction has been reverted by the EVM${void 0===e?"":`:
 ${tV.convertToString(e)}`}`,e),this.code=ev}}class rE extends ry{constructor(){super("Raw transaction undefined"),this.code=eE}}class rA extends ry{constructor(){super("Transaction not found"),this.code=eq}}class rx extends tK{constructor(e){super(e,"invalid transaction with invalid sender"),this.code=eA}}class rS extends tK{constructor(e){super(e,"invalid transaction with invalid receiver"),this.code=eJ}}class rk extends tK{constructor(){super("MissingCustomChainError","If tx.common is provided it must have tx.common.customChain"),this.code=ex}}class r_ extends tK{constructor(){super("MissingCustomChainIdError","If tx.common is provided it must have tx.common.customChain and tx.common.customChain.chainId"),this.code=eS}}class rI extends tK{constructor(e){super(JSON.stringify(e),"Chain Id doesnt match in tx.chainId tx.common.customChain.chainId"),this.code=ek}}class rT extends tK{constructor(e){super(JSON.stringify(e),"Chain doesnt match in tx.chain tx.common.basechain"),this.code=eW}}class rC extends tK{constructor(e){super(JSON.stringify(e),"hardfork doesnt match in tx.hardfork tx.common.hardfork"),this.code=eQ}}class rP extends tK{constructor(){super("CommonOrChainAndHardforkError","Please provide the common object or the chain and hardfork property but not all together."),this.code=e_}}class rR extends tK{constructor(e){var t,r;super("MissingChainOrHardforkError",`When specifying chain and hardfork, both values must be defined. Received "chain": ${null!=(t=e.chain)?t:"undefined"}, "hardfork": ${null!=(r=e.hardfork)?r:"undefined"}`),this.code=eI}}class rD extends tV{constructor(){super('Missing properties in transaction, either define "gas" and "gasPrice" for type 0 transactions or "gas", "maxPriorityFeePerGas" and "maxFeePerGas" for type 2 transactions'),this.code=eX}}class rN extends tK{constructor(e){var t,r,n,i;super(`gas: ${null!=(t=e.gas)?t:"undefined"}, gasPrice: ${null!=(r=e.gasPrice)?r:"undefined"}, maxPriorityFeePerGas: ${null!=(n=e.maxPriorityFeePerGas)?n:"undefined"}, maxFeePerGas: ${null!=(i=e.maxFeePerGas)?i:"undefined"}`,'"gas" is missing'),this.code=eT,this.cause=new rD}}class rM extends tV{constructor(){super('Missing properties in transaction, either define "gas" and "gasPrice" for type 0 transactions or "gas", "maxPriorityFeePerGas" and "maxFeePerGas" for type 2 transactions, not both'),this.code=e0}}class rB extends tK{constructor(e){var t,r,n,i;super(`gas: ${null!=(t=e.gas)?t:"undefined"}, gasPrice: ${null!=(r=e.gasPrice)?r:"undefined"}, maxPriorityFeePerGas: ${null!=(n=e.maxPriorityFeePerGas)?n:"undefined"}, maxFeePerGas: ${null!=(i=e.maxFeePerGas)?i:"undefined"}`,"transaction must specify legacy or fee market gas properties, not both"),this.code=eK,this.cause=new rM}}class rO extends tK{constructor(e){var t,r;super(`gas: ${null!=(t=e.gas)?t:"undefined"}, gasPrice: ${null!=(r=e.gasPrice)?r:"undefined"}`,"Gas or gasPrice is lower than 0"),this.code=eC}}class rL extends tK{constructor(e){var t,r;super(`maxPriorityFeePerGas: ${null!=(t=e.maxPriorityFeePerGas)?t:"undefined"}, maxFeePerGas: ${null!=(r=e.maxFeePerGas)?r:"undefined"}`,"maxPriorityFeePerGas or maxFeePerGas is lower than 0"),this.code=eP}}class rF extends tK{constructor(e){super(e,"eip-1559 transactions don't support gasPrice"),this.code=eR}}class rU extends tK{constructor(e){var t,r;super(`maxPriorityFeePerGas: ${null!=(t=e.maxPriorityFeePerGas)?t:"undefined"}, maxFeePerGas: ${null!=(r=e.maxFeePerGas)?r:"undefined"}`,"pre-eip-1559 transaction don't support maxFeePerGas/maxPriorityFeePerGas"),this.code=eD}}class rj extends tK{constructor(e){super(e,"invalid transaction object"),this.code=eN}}class rH extends tK{constructor(e){var t,r;super(`nonce: ${null!=(t=e.nonce)?t:"undefined"}, chainId: ${null!=(r=e.chainId)?r:"undefined"}`,"Nonce or chainId is lower than 0"),this.code=eM}}class r$ extends tK{constructor(){super("UnableToPopulateNonceError","unable to populate nonce, no from address available"),this.code=eB}}class rq extends tK{constructor(){super("Eip1559NotSupportedError","Network doesn't support eip-1559"),this.code=eO}}class rz extends tK{constructor(e){super(e,"unsupported transaction type"),this.code=eL}}class rV extends tK{constructor(e){var t,r;super(`data: ${null!=(t=e.data)?t:"undefined"}, input: ${null!=(r=e.input)?r:"undefined"}`,'You can\'t have "data" and "input" as properties of transactions at the same time, please use either "data" or "input" instead.'),this.code=eF}}class rG extends tV{constructor(e){super(`The connected Ethereum Node did not respond within ${e.numberOfSeconds} seconds, please make sure your transaction was properly sent and you are connected to a healthy Node. Be aware that transaction might still be pending or mined!
	Transaction Hash: ${e.transactionHash?e.transactionHash.toString():"not available"}`),this.code=ez}}function rK(e){return`Please make sure your transaction was properly sent and there are no previous pending transaction for the same account. However, be aware that it might still be mined!
	Transaction Hash: ${e?e.toString():"not available"}`}class rW extends tV{constructor(e){super(`Transaction was not mined within ${e.numberOfSeconds} seconds. ${rK(e.transactionHash)}`),this.code=eU}}class rQ extends tV{constructor(e){super(`Transaction started at ${e.starterBlockNumber} but was not mined within ${e.numberOfBlocks} blocks. ${rK(e.transactionHash)}`),this.code=eV}}class rJ extends tK{constructor(e){var t,r;super(`receipt: ${JSON.stringify(e.receipt)}, blockHash: ${null==(t=e.blockHash)?void 0:t.toString()}, transactionHash: ${null==(r=e.transactionHash)?void 0:r.toString()}`,"Receipt missing or blockHash null"),this.code=ej}}class rZ extends tK{constructor(e){super(`receipt: ${JSON.stringify(e.receipt)}`,"Receipt missing block number"),this.code=eH}}class rY extends tV{constructor(e){super(`Invalid signature. "${e}"`),this.code=eG}}class rX extends tK{constructor(){super("LocalWalletNotAvailableError","Attempted to index account in local wallet, but no wallet is available"),this.code=e$}}class r0 extends tV{constructor(e,t){let r=[];e.forEach(e=>r.push(e.keyword)),super(`The following properties are invalid for the transaction type ${t}: ${r.join(", ")}`),this.code=eY}}class r1 extends tK{constructor(e){super(e,"can not parse as byte data"),this.code=tb}}class r2 extends tK{constructor(e){super(e,"can not parse as number data"),this.code=tw}}class r3 extends tK{constructor(e){super(e,"invalid ethereum address"),this.code=tE}}class r4 extends tK{constructor(e){super(e,"not a valid string"),this.code=ty}}class r5 extends tK{constructor(e){super(e,"invalid unit"),this.code=tv}}class r6 extends tK{constructor(e){super(e,"not a valid unit. Must be a positive integer"),this.code=tC}}class r8 extends tK{constructor(e){super(e,"can not be converted to hex"),this.code=tA}}class r7 extends tK{constructor(e){super(e,"value greater than the nibble width"),this.code=tT}}class r9 extends tK{constructor(e){super(e,"not a valid boolean."),this.code=tx}}class ne extends tK{constructor(e){super(e,"not a valid unsigned integer."),this.code=tS}}class nt extends tK{constructor(e){super(e,"invalid size given."),this.code=tk}}class nr extends tK{constructor(e){super(e,"value is larger than size."),this.code=t_}}class nn extends tK{constructor(e){super(e,"invalid string given"),this.code=tI}}let ni=e=>!Array.isArray(e)&&"2.0"===e.jsonrpc&&!!e&&(void 0===e.result||null===e.result)&&"error"in e&&("number"==typeof e.id||"string"==typeof e.id),ns=e=>ni(e)?e.error.message:"";class no extends tV{constructor(e,t,r,n){var i;let s;super(null!=t?t:`Returned error: ${Array.isArray(e)?e.map(e=>ns(e)).join(","):ns(e)}`),this.code=ei,t||(this.data=Array.isArray(e)?e.map(e=>{var t;return null==(t=e.error)?void 0:t.data}):null==(i=null==e?void 0:e.error)?void 0:i.data),this.statusCode=n,this.request=r,"error"in e?s=e.error:e instanceof Array&&(s=e.filter(e=>e.error).map(e=>e.error)),Array.isArray(s)&&s.length>0?this.cause=new tG(s):this.cause=s}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{data:this.data,request:this.request,statusCode:this.statusCode})}}class na extends no{constructor(e,t){let r;super(e,void 0,t),this.code=es,"error"in e?r=e.error:e instanceof Array&&(r=e.map(e=>e.error)),Array.isArray(r)?this.cause=new tG(r):this.cause=r}}class nl extends tV{constructor(e,t){super(`Web3Config hardfork doesnt match in defaultHardfork ${e} and common.hardfork ${t}`),this.code=tR}}class nc extends tV{constructor(e,t){super(`Web3Config chain doesnt match in defaultHardfork ${e} and common.hardfork ${t}`),this.code=tR}}let nu="An Rpc error has occured with a code of *code*",nd={[tN]:{message:"Parse error",description:"Invalid JSON"},[tM]:{message:"Invalid request",description:"JSON is not a valid request object	"},[tB]:{message:"Method not found",description:"Method does not exist	"},[tO]:{message:"Invalid params",description:"Invalid method parameters"},[tL]:{message:"Internal error",description:"Internal JSON-RPC error"},[tF]:{message:"Invalid input",description:"Missing or invalid parameters"},[tU]:{message:"Resource not found",description:"Requested resource not found"},[tj]:{message:"Resource unavailable",description:"Requested resource not available"},[tH]:{message:"Transaction rejected",description:"Transaction creation failed"},[t$]:{message:"Method not supported",description:"Method is not implemented"},[tq]:{message:"Limit exceeded",description:"Request exceeds defined limit"},[tz]:{message:"JSON-RPC version not supported",description:"Version of JSON-RPC protocol is not supported"},[tu]:{name:"User Rejected Request",message:"The user rejected the request."},[td]:{name:"Unauthorized",message:"The requested method and/or account has not been authorized by the user."},[th]:{name:"Unsupported Method",message:"The Provider does not support the requested method."},[tf]:{name:"Disconnected",message:"The Provider is disconnected from all chains."},[tp]:{name:"Chain Disconnected",message:"The Provider is not connected to the requested chain."},"0-999":{name:"",message:"Not used."},1e3:{name:"Normal Closure",message:"The connection successfully completed the purpose for which it was created."},1001:{name:"Going Away",message:"The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection."},1002:{name:"Protocol error",message:"The endpoint is terminating the connection due to a protocol error."},1003:{name:"Unsupported Data",message:"The connection is being terminated because the endpoint received data of a type it cannot accept. (For example, a text-only endpoint received binary data.)"},1004:{name:"Reserved",message:"Reserved. A meaning might be defined in the future."},1005:{name:"No Status Rcvd",message:"Reserved. Indicates that no status code was provided even though one was expected."},1006:{name:"Abnormal Closure",message:"Reserved. Indicates that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected."},1007:{name:"Invalid frame payload data",message:"The endpoint is terminating the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message)."},1008:{name:"Policy Violation",message:"The endpoint is terminating the connection because it received a message that violates its policy. This is a generic status code, used when codes 1003 and 1009 are not suitable."},1009:{name:"Message Too Big",message:"The endpoint is terminating the connection because a data frame was received that is too large."},1010:{name:"Mandatory Ext.",message:"The client is terminating the connection because it expected the server to negotiate one or more extension, but the server didn't."},1011:{name:"Internal Error",message:"The server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request."},1012:{name:"Service Restart",message:"The server is terminating the connection because it is restarting."},1013:{name:"Try Again Later",message:"The server is terminating the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients."},1014:{name:"Bad Gateway",message:"The server was acting as a gateway or proxy and received an invalid response from the upstream server. This is similar to 502 HTTP Status Code."},1015:{name:"TLS handshake",message:"Reserved. Indicates that the connection was closed due to a failure to perform a TLS handshake (e.g., the server certificate can't be verified)."},"1016-2999":{name:"",message:"For definition by future revisions of the WebSocket Protocol specification, and for definition by extension specifications."},"3000-3999":{name:"",message:"For use by libraries, frameworks, and applications. These status codes are registered directly with IANA. The interpretation of these codes is undefined by the WebSocket protocol."},"4000-4999":{name:"",message:"For private use, and thus can't be registered. Such codes can be used by prior agreements between WebSocket applications. The interpretation of these codes is undefined by the WebSocket protocol."}};class nh extends tV{constructor(e,t){super(null!=t?t:nu.replace("*code*",e.error.code.toString())),this.code=e.error.code,this.id=e.id,this.jsonrpc=e.jsonrpc,this.jsonRpcError=e.error}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{error:this.jsonRpcError,id:this.id,jsonRpc:this.jsonrpc})}}class nf extends tV{constructor(e,t){var r,n,i,s;if(e)if(null==(r=nd[e])?void 0:r.message)super(nd[e].message);else{let t=Object.keys(nd).find(t=>"string"==typeof t&&e>=parseInt(t.split("-")[0],10)&&e<=parseInt(t.split("-")[1],10));super(null!=(i=null==(n=nd[null!=t?t:""])?void 0:n.message)?i:nu.replace("*code*",null!=(s=null==e?void 0:e.toString())?s:'""'))}else super();this.code=e,this.data=t}}class np extends nh{constructor(e){super(e,nd[tN].message),this.code=tN}}class ng extends nh{constructor(e){super(e,nd[tM].message),this.code=tM}}class nm extends nh{constructor(e){super(e,nd[tB].message),this.code=tB}}class ny extends nh{constructor(e){super(e,nd[tO].message),this.code=tO}}class nb extends nh{constructor(e){super(e,nd[tL].message),this.code=tL}}class nw extends nh{constructor(e){super(e,nd[tF].message),this.code=tF}}class nv extends nh{constructor(e){super(e,nd[t$].message),this.code=t$}}class nE extends nh{constructor(e){super(e,nd[tj].message),this.code=tj}}class nA extends nh{constructor(e){super(e,nd[tU].message),this.code=tU}}class nx extends nh{constructor(e){super(e,nd[tz].message),this.code=tz}}class nS extends nh{constructor(e){super(e,nd[tH].message),this.code=tH}}class nk extends nh{constructor(e){super(e,nd[tq].message),this.code=tq}}let n_=new Map;n_.set(tN,{error:np}),n_.set(tM,{error:ng}),n_.set(tB,{error:nm}),n_.set(tO,{error:ny}),n_.set(tL,{error:nb}),n_.set(tF,{error:nw}),n_.set(t$,{error:nv}),n_.set(tj,{error:nE}),n_.set(tH,{error:nS}),n_.set(tU,{error:nA}),n_.set(tz,{error:nx}),n_.set(tq,{error:nk});class nI extends tV{constructor(e){super(`Format for the type ${e} is unsupported`),this.type=e,this.code=tD}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{type:this.type})}}function nT(e){if(!Number.isSafeInteger(e)||e<0)throw Error(`positive integer expected, not ${e}`)}function nC(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function nP(e,...t){if(!nC(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function nR(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.wrapConstructor");nT(e.outputLen),nT(e.blockLen)}function nD(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function nN(e,t){nP(e);let r=t.outputLen;if(e.length<r)throw Error(`digestInto() expects output buffer of length at least ${r}`)}let nM={bool:function(e){if("boolean"!=typeof e)throw Error(`boolean expected, not ${e}`)},bytes:nP},nB=BigInt(0x100000000-1),nO=BigInt(32);function nL(e,t=!1){return t?{h:Number(e&nB),l:Number(e>>nO&nB)}:{h:0|Number(e>>nO&nB),l:0|Number(e&nB)}}function nF(e,t=!1){let r=new Uint32Array(e.length),n=new Uint32Array(e.length);for(let i=0;i<e.length;i++){let{h:s,l:o}=nL(e[i],t);[r[i],n[i]]=[s,o]}return[r,n]}let nU=(e,t,r)=>e<<r|t>>>32-r,nj=(e,t,r)=>t<<r|e>>>32-r,nH=(e,t,r)=>t<<r-32|e>>>64-r,n$=(e,t,r)=>e<<r-32|t>>>64-r,nq={split:nF,shrSH:(e,t,r)=>e>>>r,shrSL:(e,t,r)=>e<<32-r|t>>>r,rotrSH:(e,t,r)=>e>>>r|t<<32-r,rotrSL:(e,t,r)=>e<<32-r|t>>>r,rotrBH:(e,t,r)=>e<<64-r|t>>>r-32,rotrBL:(e,t,r)=>e>>>r-32|t<<64-r,add:function(e,t,r,n){let i=(t>>>0)+(n>>>0);return{h:e+r+(i/0x100000000|0)|0,l:0|i}},add3L:(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),add3H:(e,t,r,n)=>t+r+n+(e/0x100000000|0)|0,add4L:(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),add4H:(e,t,r,n,i)=>t+r+n+i+(e/0x100000000|0)|0,add5H:(e,t,r,n,i,s)=>t+r+n+i+s+(e/0x100000000|0)|0,add5L:(e,t,r,n,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(i>>>0)},nz="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,nV=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),nG=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),nK=(e,t)=>e<<32-t|e>>>t,nW=(e,t)=>e<<t|e>>>32-t>>>0,nQ=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0],nJ=e=>e<<24&0xff000000|e<<8&0xff0000|e>>>8&65280|e>>>24&255;function nZ(e){for(let t=0;t<e.length;t++)e[t]=nJ(e[t])}(e,t)=>t.toString(16).padStart(2,"0");let nY={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function nX(e){if("string"!=typeof e)throw Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function n0(e){return"string"==typeof e&&(e=nX(e)),nP(e),e}function n1(...e){let t=0;for(let r=0;r<e.length;r++){let n=e[r];nP(n),t+=n.length}let r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){let i=e[t];r.set(i,n),n+=i.length}return r}class n2{clone(){return this._cloneInto()}}let n3={}.toString;function n4(e,t){if(void 0!==t&&"[object Object]"!==n3.call(t))throw Error("Options should be object or undefined");return Object.assign(e,t)}function n5(e){let t=t=>e().update(n0(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function n6(e=32){if(nz&&"function"==typeof nz.getRandomValues)return nz.getRandomValues(new Uint8Array(e));throw Error("crypto.getRandomValues must be defined")}let n8=[],n7=[],n9=[],ie=BigInt(0),it=BigInt(1),ir=BigInt(2),ii=BigInt(7),is=BigInt(256),io=BigInt(113);for(let e=0,t=it,r=1,n=0;e<24;e++){[r,n]=[n,(2*r+3*n)%5],n8.push(2*(5*n+r)),n7.push((e+1)*(e+2)/2%64);let i=ie;for(let e=0;e<7;e++)(t=(t<<it^(t>>ii)*io)%is)&ir&&(i^=it<<(it<<BigInt(e))-it);n9.push(i)}let[ia,il]=nF(n9,!0),ic=(e,t,r)=>r>32?nH(e,t,r):nU(e,t,r),iu=(e,t,r)=>r>32?n$(e,t,r):nj(e,t,r);function id(e,t=24){let r=new Uint32Array(10);for(let n=24-t;n<24;n++){for(let t=0;t<10;t++)r[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){let n=(t+8)%10,i=(t+2)%10,s=r[i],o=r[i+1],a=ic(s,o,1)^r[n],l=iu(s,o,1)^r[n+1];for(let r=0;r<50;r+=10)e[t+r]^=a,e[t+r+1]^=l}let t=e[2],i=e[3];for(let r=0;r<24;r++){let n=n7[r],s=ic(t,i,n),o=iu(t,i,n),a=n8[r];t=e[a],i=e[a+1],e[a]=s,e[a+1]=o}for(let t=0;t<50;t+=10){for(let n=0;n<10;n++)r[n]=e[t+n];for(let n=0;n<10;n++)e[t+n]^=~r[(n+2)%10]&r[(n+4)%10]}e[0]^=ia[n],e[1]^=il[n]}r.fill(0)}class ih extends n2{constructor(e,t,r,n=!1,i=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=n,this.rounds=i,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,nT(r),0>=this.blockLen||this.blockLen>=200)throw Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=nV(this.state)}keccak(){nQ||nZ(this.state32),id(this.state32,this.rounds),nQ||nZ(this.state32),this.posOut=0,this.pos=0}update(e){nD(this);let{blockLen:t,state:r}=this,n=(e=n0(e)).length;for(let i=0;i<n;){let s=Math.min(t-this.pos,n-i);for(let t=0;t<s;t++)r[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:r,blockLen:n}=this;e[r]^=t,(128&t)!=0&&r===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){nD(this,!1),nP(e),this.finish();let t=this.state,{blockLen:r}=this;for(let n=0,i=e.length;n<i;){this.posOut>=r&&this.keccak();let s=Math.min(r-this.posOut,i-n);e.set(t.subarray(this.posOut,this.posOut+s),n),this.posOut+=s,n+=s}return e}xofInto(e){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return nT(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(nN(e,this),this.finished)throw Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){let{blockLen:t,suffix:r,outputLen:n,rounds:i,enableXOF:s}=this;return e||(e=new ih(t,r,n,s,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=r,e.outputLen=n,e.enableXOF=s,e.destroyed=this.destroyed,e}}let ip=(e,t,r)=>n5(()=>new ih(t,e,r)),ig=ip(1,144,28),im=ip(1,136,32),iy=ip(1,104,48),ib=ip(1,72,64);nM.bool;let iw=nM.bytes;function iv(e){if(!(e instanceof Uint8Array))throw TypeError(`bytesToUtf8 expected Uint8Array, got ${typeof e}`);return new TextDecoder().decode(e)}function iE(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function iA(e){return t=>(nM.bytes(t),e(t))}(()=>{let e="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,t="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);return t&&!e&&t("crypto")})(),iA(ig);let ix=(()=>{let e=iA(im);return e.create=im.create,e})();iA(iy),iA(ib),function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),n={};for(let e of r)n[e]=t[e];return e.objectValues(n)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(k||(k={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(_||(_={}));let iS=k.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ik=e=>{switch(typeof e){case"undefined":return iS.undefined;case"string":return iS.string;case"number":return isNaN(e)?iS.nan:iS.number;case"boolean":return iS.boolean;case"function":return iS.function;case"bigint":return iS.bigint;case"symbol":return iS.symbol;case"object":if(Array.isArray(e))return iS.array;if(null===e)return iS.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return iS.promise;if("undefined"!=typeof Map&&e instanceof Map)return iS.map;if("undefined"!=typeof Set&&e instanceof Set)return iS.set;if("undefined"!=typeof Date&&e instanceof Date)return iS.date;return iS.object;default:return iS.unknown}},i_=k.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),iI=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class iT extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},n=e=>{for(let i of e.issues)if("invalid_union"===i.code)i.unionErrors.map(n);else if("invalid_return_type"===i.code)n(i.returnTypeError);else if("invalid_arguments"===i.code)n(i.argumentsError);else if(0===i.path.length)r._errors.push(t(i));else{let e=r,n=0;for(;n<i.path.length;){let r=i.path[n];n===i.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(i))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return n(this),r}static assert(e){if(!(e instanceof iT))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,k.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}iT.create=e=>new iT(e);let iC=(e,t)=>{let r;switch(e.code){case i_.invalid_type:r=e.received===iS.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case i_.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,k.jsonStringifyReplacer)}`;break;case i_.unrecognized_keys:r=`Unrecognized key(s) in object: ${k.joinValues(e.keys,", ")}`;break;case i_.invalid_union:r="Invalid input";break;case i_.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${k.joinValues(e.options)}`;break;case i_.invalid_enum_value:r=`Invalid enum value. Expected ${k.joinValues(e.options)}, received '${e.received}'`;break;case i_.invalid_arguments:r="Invalid function arguments";break;case i_.invalid_return_type:r="Invalid function return type";break;case i_.invalid_date:r="Invalid date";break;case i_.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:k.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case i_.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case i_.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case i_.custom:r="Invalid input";break;case i_.invalid_intersection_types:r="Intersection results could not be merged";break;case i_.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case i_.not_finite:r="Number must be finite";break;default:r=t.defaultError,k.assertNever(e)}return{message:r}},iP=iC;function iR(e){iP=e}function iD(){return iP}let iN=e=>{let{data:t,path:r,errorMaps:n,issueData:i}=e,s=[...r,...i.path||[]],o={...i,path:s};if(void 0!==i.message)return{...i,path:s,message:i.message};let a="";for(let e of n.filter(e=>!!e).slice().reverse())a=e(o,{data:t,defaultError:a}).message;return{...i,path:s,message:a}},iM=[];function iB(e,t){let r=iD(),n=iN({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===iC?void 0:iC].filter(e=>!!e)});e.common.issues.push(n)}class iO{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let n of t){if("aborted"===n.status)return iL;"dirty"===n.status&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,n=await e.value;r.push({key:t,value:n})}return iO.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let n of t){let{key:t,value:i}=n;if("aborted"===t.status||"aborted"===i.status)return iL;"dirty"===t.status&&e.dirty(),"dirty"===i.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==i.value||n.alwaysSet)&&(r[t.value]=i.value)}return{status:e.value,value:r}}}let iL=Object.freeze({status:"aborted"}),iF=e=>({status:"dirty",value:e}),iU=e=>({status:"valid",value:e}),ij=e=>"aborted"===e.status,iH=e=>"dirty"===e.status,i$=e=>"valid"===e.status,iq=e=>"undefined"!=typeof Promise&&e instanceof Promise;function iz(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}function iV(e,t,r,n,i){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r}"function"==typeof SuppressedError&&SuppressedError,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(I||(I={}));class iG{constructor(e,t,r,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let iK=(e,t)=>{if(i$(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new iT(e.common.issues);return this._error=t,this._error}}};function iW(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:n,description:i}=e;if(t&&(r||n))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:i}:{errorMap:(t,i)=>{var s,o;let{message:a}=e;return"invalid_enum_value"===t.code?{message:null!=a?a:i.defaultError}:void 0===i.data?{message:null!=(s=null!=a?a:n)?s:i.defaultError}:"invalid_type"!==t.code?{message:i.defaultError}:{message:null!=(o=null!=a?a:r)?o:i.defaultError}},description:i}}class iQ{get description(){return this._def.description}_getType(e){return ik(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:ik(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new iO,ctx:{common:e.parent.common,data:e.data,parsedType:ik(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(iq(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;let n={common:{issues:[],async:null!=(r=null==t?void 0:t.async)&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ik(e)},i=this._parseSync({data:e,path:n.path,parent:n});return iK(n,i)}"~validate"(e){var t,r;let n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ik(e)};if(!this["~standard"].async)try{let t=this._parseSync({data:e,path:[],parent:n});return i$(t)?{value:t.value}:{issues:n.common.issues}}catch(e){(null==(r=null==(t=null==e?void 0:e.message)?void 0:t.toLowerCase())?void 0:r.includes("encountered"))&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(e=>i$(e)?{value:e.value}:{issues:n.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ik(e)},n=this._parse({data:e,path:r.path,parent:r});return iK(r,await (iq(n)?n:Promise.resolve(n)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,n)=>{let i=e(t),s=()=>n.addIssue({code:i_.custom,...r(t)});return"undefined"!=typeof Promise&&i instanceof Promise?i.then(e=>!!e||(s(),!1)):!!i||(s(),!1)})}refinement(e,t){return this._refinement((r,n)=>!!e(r)||(n.addIssue("function"==typeof t?t(r,n):t),!1))}_refinement(e){return new sH({schema:this,typeName:P.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return s$.create(this,this._def)}nullable(){return sq.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return sA.create(this)}promise(){return sj.create(this,this._def)}or(e){return sk.create([this,e],this._def)}and(e){return sC.create(this,e,this._def)}transform(e){return new sH({...iW(this._def),schema:this,typeName:P.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t="function"==typeof e?e:()=>e;return new sz({...iW(this._def),innerType:this,defaultValue:t,typeName:P.ZodDefault})}brand(){return new sW({typeName:P.ZodBranded,type:this,...iW(this._def)})}catch(e){let t="function"==typeof e?e:()=>e;return new sV({...iW(this._def),innerType:this,catchValue:t,typeName:P.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return sQ.create(this,e)}readonly(){return sJ.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let iJ=/^c[^\s-]{8,}$/i,iZ=/^[0-9a-z]+$/,iY=/^[0-9A-HJKMNP-TV-Z]{26}$/i,iX=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,i0=/^[a-z0-9_-]{21}$/i,i1=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,i2=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,i3=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,i4="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",i5=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,i6=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,i8=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,i7=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,i9=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,se=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,st="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",sr=RegExp(`^${st}$`);function sn(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function si(e){return RegExp(`^${sn(e)}$`)}function ss(e){let t=`${st}T${sn(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}function so(e,t){return!!(("v4"===t||!t)&&i5.test(e)||("v6"===t||!t)&&i8.test(e))}function sa(e,t){if(!i1.test(e))return!1;try{let[r]=e.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));if("object"!=typeof i||null===i||!i.typ||!i.alg||t&&i.alg!==t)return!1;return!0}catch(e){return!1}}function sl(e,t){return!!(("v4"===t||!t)&&i6.test(e)||("v6"===t||!t)&&i7.test(e))}class sc extends iQ{_parse(e){let t;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==iS.string){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.string,received:t.parsedType}),iL}let r=new iO;for(let i of this._def.checks)if("min"===i.kind)e.data.length<i.value&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if("max"===i.kind)e.data.length>i.value&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if("length"===i.kind){let n=e.data.length>i.value,s=e.data.length<i.value;(n||s)&&(t=this._getOrReturnCtx(e,t),n?iB(t,{code:i_.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):s&&iB(t,{code:i_.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if("email"===i.kind)i3.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"email",code:i_.invalid_string,message:i.message}),r.dirty());else if("emoji"===i.kind)n||(n=RegExp(i4,"u")),n.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"emoji",code:i_.invalid_string,message:i.message}),r.dirty());else if("uuid"===i.kind)iX.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"uuid",code:i_.invalid_string,message:i.message}),r.dirty());else if("nanoid"===i.kind)i0.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"nanoid",code:i_.invalid_string,message:i.message}),r.dirty());else if("cuid"===i.kind)iJ.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"cuid",code:i_.invalid_string,message:i.message}),r.dirty());else if("cuid2"===i.kind)iZ.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"cuid2",code:i_.invalid_string,message:i.message}),r.dirty());else if("ulid"===i.kind)iY.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"ulid",code:i_.invalid_string,message:i.message}),r.dirty());else if("url"===i.kind)try{new URL(e.data)}catch(n){iB(t=this._getOrReturnCtx(e,t),{validation:"url",code:i_.invalid_string,message:i.message}),r.dirty()}else"regex"===i.kind?(i.regex.lastIndex=0,i.regex.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"regex",code:i_.invalid_string,message:i.message}),r.dirty())):"trim"===i.kind?e.data=e.data.trim():"includes"===i.kind?e.data.includes(i.value,i.position)||(iB(t=this._getOrReturnCtx(e,t),{code:i_.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):"toLowerCase"===i.kind?e.data=e.data.toLowerCase():"toUpperCase"===i.kind?e.data=e.data.toUpperCase():"startsWith"===i.kind?e.data.startsWith(i.value)||(iB(t=this._getOrReturnCtx(e,t),{code:i_.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):"endsWith"===i.kind?e.data.endsWith(i.value)||(iB(t=this._getOrReturnCtx(e,t),{code:i_.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):"datetime"===i.kind?ss(i).test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{code:i_.invalid_string,validation:"datetime",message:i.message}),r.dirty()):"date"===i.kind?sr.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{code:i_.invalid_string,validation:"date",message:i.message}),r.dirty()):"time"===i.kind?si(i).test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{code:i_.invalid_string,validation:"time",message:i.message}),r.dirty()):"duration"===i.kind?i2.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"duration",code:i_.invalid_string,message:i.message}),r.dirty()):"ip"===i.kind?so(e.data,i.version)||(iB(t=this._getOrReturnCtx(e,t),{validation:"ip",code:i_.invalid_string,message:i.message}),r.dirty()):"jwt"===i.kind?sa(e.data,i.alg)||(iB(t=this._getOrReturnCtx(e,t),{validation:"jwt",code:i_.invalid_string,message:i.message}),r.dirty()):"cidr"===i.kind?sl(e.data,i.version)||(iB(t=this._getOrReturnCtx(e,t),{validation:"cidr",code:i_.invalid_string,message:i.message}),r.dirty()):"base64"===i.kind?i9.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"base64",code:i_.invalid_string,message:i.message}),r.dirty()):"base64url"===i.kind?se.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"base64url",code:i_.invalid_string,message:i.message}),r.dirty()):k.assertNever(i);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:i_.invalid_string,...I.errToObj(r)})}_addCheck(e){return new sc({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...I.errToObj(e)})}url(e){return this._addCheck({kind:"url",...I.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...I.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...I.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...I.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...I.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...I.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...I.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...I.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...I.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...I.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...I.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...I.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!=(t=null==e?void 0:e.offset)&&t,local:null!=(r=null==e?void 0:e.local)&&r,...I.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...I.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...I.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...I.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...I.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...I.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...I.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...I.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...I.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...I.errToObj(t)})}nonempty(e){return this.min(1,I.errToObj(e))}trim(){return new sc({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new sc({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new sc({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function su(e,t){let r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,i=r>n?r:n;return parseInt(e.toFixed(i).replace(".",""))%parseInt(t.toFixed(i).replace(".",""))/Math.pow(10,i)}sc.create=e=>{var t;return new sc({checks:[],typeName:P.ZodString,coerce:null!=(t=null==e?void 0:e.coerce)&&t,...iW(e)})};class sd extends iQ{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==iS.number){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.number,received:t.parsedType}),iL}let r=new iO;for(let n of this._def.checks)"int"===n.kind?k.isInteger(e.data)||(iB(t=this._getOrReturnCtx(e,t),{code:i_.invalid_type,expected:"integer",received:"float",message:n.message}),r.dirty()):"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"multipleOf"===n.kind?0!==su(e.data,n.value)&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(iB(t=this._getOrReturnCtx(e,t),{code:i_.not_finite,message:n.message}),r.dirty()):k.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,I.toString(t))}gt(e,t){return this.setLimit("min",e,!1,I.toString(t))}lte(e,t){return this.setLimit("max",e,!0,I.toString(t))}lt(e,t){return this.setLimit("max",e,!1,I.toString(t))}setLimit(e,t,r,n){return new sd({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:I.toString(n)}]})}_addCheck(e){return new sd({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:I.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:I.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:I.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:I.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:I.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:I.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:I.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:I.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:I.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&k.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks)if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;else"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value);return Number.isFinite(t)&&Number.isFinite(e)}}sd.create=e=>new sd({checks:[],typeName:P.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...iW(e)});class sh extends iQ{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch(t){return this._getInvalidInput(e)}if(this._getType(e)!==iS.bigint)return this._getInvalidInput(e);let r=new iO;for(let n of this._def.checks)"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):k.assertNever(n);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.bigint,received:t.parsedType}),iL}gte(e,t){return this.setLimit("min",e,!0,I.toString(t))}gt(e,t){return this.setLimit("min",e,!1,I.toString(t))}lte(e,t){return this.setLimit("max",e,!0,I.toString(t))}lt(e,t){return this.setLimit("max",e,!1,I.toString(t))}setLimit(e,t,r,n){return new sh({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:I.toString(n)}]})}_addCheck(e){return new sh({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:I.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:I.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:I.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:I.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:I.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}sh.create=e=>{var t;return new sh({checks:[],typeName:P.ZodBigInt,coerce:null!=(t=null==e?void 0:e.coerce)&&t,...iW(e)})};class sf extends iQ{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==iS.boolean){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.boolean,received:t.parsedType}),iL}return iU(e.data)}}sf.create=e=>new sf({typeName:P.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...iW(e)});class sp extends iQ{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==iS.date){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.date,received:t.parsedType}),iL}if(isNaN(e.data.getTime()))return iB(this._getOrReturnCtx(e),{code:i_.invalid_date}),iL;let r=new iO;for(let n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),r.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),r.dirty()):k.assertNever(n);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new sp({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:I.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:I.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}sp.create=e=>new sp({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:P.ZodDate,...iW(e)});class sg extends iQ{_parse(e){if(this._getType(e)!==iS.symbol){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.symbol,received:t.parsedType}),iL}return iU(e.data)}}sg.create=e=>new sg({typeName:P.ZodSymbol,...iW(e)});class sm extends iQ{_parse(e){if(this._getType(e)!==iS.undefined){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.undefined,received:t.parsedType}),iL}return iU(e.data)}}sm.create=e=>new sm({typeName:P.ZodUndefined,...iW(e)});class sy extends iQ{_parse(e){if(this._getType(e)!==iS.null){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.null,received:t.parsedType}),iL}return iU(e.data)}}sy.create=e=>new sy({typeName:P.ZodNull,...iW(e)});class sb extends iQ{constructor(){super(...arguments),this._any=!0}_parse(e){return iU(e.data)}}sb.create=e=>new sb({typeName:P.ZodAny,...iW(e)});class sw extends iQ{constructor(){super(...arguments),this._unknown=!0}_parse(e){return iU(e.data)}}sw.create=e=>new sw({typeName:P.ZodUnknown,...iW(e)});class sv extends iQ{_parse(e){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.never,received:t.parsedType}),iL}}sv.create=e=>new sv({typeName:P.ZodNever,...iW(e)});class sE extends iQ{_parse(e){if(this._getType(e)!==iS.undefined){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.void,received:t.parsedType}),iL}return iU(e.data)}}sE.create=e=>new sE({typeName:P.ZodVoid,...iW(e)});class sA extends iQ{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),n=this._def;if(t.parsedType!==iS.array)return iB(t,{code:i_.invalid_type,expected:iS.array,received:t.parsedType}),iL;if(null!==n.exactLength){let e=t.data.length>n.exactLength.value,i=t.data.length<n.exactLength.value;(e||i)&&(iB(t,{code:e?i_.too_big:i_.too_small,minimum:i?n.exactLength.value:void 0,maximum:e?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(null!==n.minLength&&t.data.length<n.minLength.value&&(iB(t,{code:i_.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dirty()),null!==n.maxLength&&t.data.length>n.maxLength.value&&(iB(t,{code:i_.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>n.type._parseAsync(new iG(t,e,t.path,r)))).then(e=>iO.mergeArray(r,e));let i=[...t.data].map((e,r)=>n.type._parseSync(new iG(t,e,t.path,r)));return iO.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new sA({...this._def,minLength:{value:e,message:I.toString(t)}})}max(e,t){return new sA({...this._def,maxLength:{value:e,message:I.toString(t)}})}length(e,t){return new sA({...this._def,exactLength:{value:e,message:I.toString(t)}})}nonempty(e){return this.min(1,e)}}function sx(e){if(e instanceof sS){let t={};for(let r in e.shape){let n=e.shape[r];t[r]=s$.create(sx(n))}return new sS({...e._def,shape:()=>t})}if(e instanceof sA)return new sA({...e._def,type:sx(e.element)});if(e instanceof s$)return s$.create(sx(e.unwrap()));if(e instanceof sq)return sq.create(sx(e.unwrap()));if(e instanceof sP)return sP.create(e.items.map(e=>sx(e)));else return e}sA.create=(e,t)=>new sA({type:e,minLength:null,maxLength:null,exactLength:null,typeName:P.ZodArray,...iW(t)});class sS extends iQ{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=k.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==iS.object){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.object,received:t.parsedType}),iL}let{status:t,ctx:r}=this._processInputParams(e),{shape:n,keys:i}=this._getCached(),s=[];if(!(this._def.catchall instanceof sv&&"strip"===this._def.unknownKeys))for(let e in r.data)i.includes(e)||s.push(e);let o=[];for(let e of i){let t=n[e],i=r.data[e];o.push({key:{status:"valid",value:e},value:t._parse(new iG(r,i,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof sv){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of s)o.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)s.length>0&&(iB(r,{code:i_.unrecognized_keys,keys:s}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of s){let n=r.data[t];o.push({key:{status:"valid",value:t},value:e._parse(new iG(r,n,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of o){let r=await t.key,n=await t.value;e.push({key:r,value:n,alwaysSet:t.alwaysSet})}return e}).then(e=>iO.mergeObjectSync(t,e)):iO.mergeObjectSync(t,o)}get shape(){return this._def.shape()}strict(e){return I.errToObj,new sS({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var n,i,s,o;let a=null!=(s=null==(i=(n=this._def).errorMap)?void 0:i.call(n,t,r).message)?s:r.defaultError;return"unrecognized_keys"===t.code?{message:null!=(o=I.errToObj(e).message)?o:a}:{message:a}}}:{}})}strip(){return new sS({...this._def,unknownKeys:"strip"})}passthrough(){return new sS({...this._def,unknownKeys:"passthrough"})}extend(e){return new sS({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new sS({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:P.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new sS({...this._def,catchall:e})}pick(e){let t={};return k.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new sS({...this._def,shape:()=>t})}omit(e){let t={};return k.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new sS({...this._def,shape:()=>t})}deepPartial(){return sx(this)}partial(e){let t={};return k.objectKeys(this.shape).forEach(r=>{let n=this.shape[r];e&&!e[r]?t[r]=n:t[r]=n.optional()}),new sS({...this._def,shape:()=>t})}required(e){let t={};return k.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof s$;)e=e._def.innerType;t[r]=e}}),new sS({...this._def,shape:()=>t})}keyof(){return sL(k.objectKeys(this.shape))}}sS.create=(e,t)=>new sS({shape:()=>e,unknownKeys:"strip",catchall:sv.create(),typeName:P.ZodObject,...iW(t)}),sS.strictCreate=(e,t)=>new sS({shape:()=>e,unknownKeys:"strict",catchall:sv.create(),typeName:P.ZodObject,...iW(t)}),sS.lazycreate=(e,t)=>new sS({shape:e,unknownKeys:"strip",catchall:sv.create(),typeName:P.ZodObject,...iW(t)});class sk extends iQ{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;function n(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new iT(e.ctx.common.issues));return iB(t,{code:i_.invalid_union,unionErrors:r}),iL}if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(n);{let e,n=[];for(let i of r){let r={...t,common:{...t.common,issues:[]},parent:null},s=i._parseSync({data:t.data,path:t.path,parent:r});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:r}),r.common.issues.length&&n.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let i=n.map(e=>new iT(e));return iB(t,{code:i_.invalid_union,unionErrors:i}),iL}}get options(){return this._def.options}}sk.create=(e,t)=>new sk({options:e,typeName:P.ZodUnion,...iW(t)});let s_=e=>{if(e instanceof sB)return s_(e.schema);if(e instanceof sH)return s_(e.innerType());if(e instanceof sO)return[e.value];if(e instanceof sF)return e.options;if(e instanceof sU)return k.objectValues(e.enum);else if(e instanceof sz)return s_(e._def.innerType);else if(e instanceof sm)return[void 0];else if(e instanceof sy)return[null];else if(e instanceof s$)return[void 0,...s_(e.unwrap())];else if(e instanceof sq)return[null,...s_(e.unwrap())];else if(e instanceof sW)return s_(e.unwrap());else if(e instanceof sJ)return s_(e.unwrap());else if(e instanceof sV)return s_(e._def.innerType);else return[]};class sI extends iQ{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==iS.object)return iB(t,{code:i_.invalid_type,expected:iS.object,received:t.parsedType}),iL;let r=this.discriminator,n=t.data[r],i=this.optionsMap.get(n);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(iB(t,{code:i_.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),iL)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let n=new Map;for(let r of t){let t=s_(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let i of t){if(n.has(i))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(i)}`);n.set(i,r)}}return new sI({typeName:P.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...iW(r)})}}function sT(e,t){let r=ik(e),n=ik(t);if(e===t)return{valid:!0,data:e};if(r===iS.object&&n===iS.object){let r=k.objectKeys(t),n=k.objectKeys(e).filter(e=>-1!==r.indexOf(e)),i={...e,...t};for(let r of n){let n=sT(e[r],t[r]);if(!n.valid)return{valid:!1};i[r]=n.data}return{valid:!0,data:i}}if(r===iS.array&&n===iS.array){if(e.length!==t.length)return{valid:!1};let r=[];for(let n=0;n<e.length;n++){let i=sT(e[n],t[n]);if(!i.valid)return{valid:!1};r.push(i.data)}return{valid:!0,data:r}}if(r===iS.date&&n===iS.date&&+e==+t)return{valid:!0,data:e};return{valid:!1}}class sC extends iQ{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),n=(e,n)=>{if(ij(e)||ij(n))return iL;let i=sT(e.value,n.value);return i.valid?((iH(e)||iH(n))&&t.dirty(),{status:t.value,value:i.data}):(iB(r,{code:i_.invalid_intersection_types}),iL)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>n(e,t)):n(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}sC.create=(e,t,r)=>new sC({left:e,right:t,typeName:P.ZodIntersection,...iW(r)});class sP extends iQ{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==iS.array)return iB(r,{code:i_.invalid_type,expected:iS.array,received:r.parsedType}),iL;if(r.data.length<this._def.items.length)return iB(r,{code:i_.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),iL;!this._def.rest&&r.data.length>this._def.items.length&&(iB(r,{code:i_.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let n=[...r.data].map((e,t)=>{let n=this._def.items[t]||this._def.rest;return n?n._parse(new iG(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(n).then(e=>iO.mergeArray(t,e)):iO.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new sP({...this._def,rest:e})}}sP.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new sP({items:e,typeName:P.ZodTuple,rest:null,...iW(t)})};class sR extends iQ{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==iS.object)return iB(r,{code:i_.invalid_type,expected:iS.object,received:r.parsedType}),iL;let n=[],i=this._def.keyType,s=this._def.valueType;for(let e in r.data)n.push({key:i._parse(new iG(r,e,r.path,e)),value:s._parse(new iG(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?iO.mergeObjectAsync(t,n):iO.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,r){return new sR(t instanceof iQ?{keyType:e,valueType:t,typeName:P.ZodRecord,...iW(r)}:{keyType:sc.create(),valueType:e,typeName:P.ZodRecord,...iW(t)})}}class sD extends iQ{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==iS.map)return iB(r,{code:i_.invalid_type,expected:iS.map,received:r.parsedType}),iL;let n=this._def.keyType,i=this._def.valueType,s=[...r.data.entries()].map(([e,t],s)=>({key:n._parse(new iG(r,e,r.path,[s,"key"])),value:i._parse(new iG(r,t,r.path,[s,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of s){let n=await r.key,i=await r.value;if("aborted"===n.status||"aborted"===i.status)return iL;("dirty"===n.status||"dirty"===i.status)&&t.dirty(),e.set(n.value,i.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of s){let n=r.key,i=r.value;if("aborted"===n.status||"aborted"===i.status)return iL;("dirty"===n.status||"dirty"===i.status)&&t.dirty(),e.set(n.value,i.value)}return{status:t.value,value:e}}}}sD.create=(e,t,r)=>new sD({valueType:t,keyType:e,typeName:P.ZodMap,...iW(r)});class sN extends iQ{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==iS.set)return iB(r,{code:i_.invalid_type,expected:iS.set,received:r.parsedType}),iL;let n=this._def;null!==n.minSize&&r.data.size<n.minSize.value&&(iB(r,{code:i_.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),null!==n.maxSize&&r.data.size>n.maxSize.value&&(iB(r,{code:i_.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());let i=this._def.valueType;function s(e){let r=new Set;for(let n of e){if("aborted"===n.status)return iL;"dirty"===n.status&&t.dirty(),r.add(n.value)}return{status:t.value,value:r}}let o=[...r.data.values()].map((e,t)=>i._parse(new iG(r,e,r.path,t)));return r.common.async?Promise.all(o).then(e=>s(e)):s(o)}min(e,t){return new sN({...this._def,minSize:{value:e,message:I.toString(t)}})}max(e,t){return new sN({...this._def,maxSize:{value:e,message:I.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}sN.create=(e,t)=>new sN({valueType:e,minSize:null,maxSize:null,typeName:P.ZodSet,...iW(t)});class sM extends iQ{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==iS.function)return iB(t,{code:i_.invalid_type,expected:iS.function,received:t.parsedType}),iL;function r(e,r){return iN({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,iD(),iC].filter(e=>!!e),issueData:{code:i_.invalid_arguments,argumentsError:r}})}function n(e,r){return iN({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,iD(),iC].filter(e=>!!e),issueData:{code:i_.invalid_return_type,returnTypeError:r}})}let i={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof sj){let e=this;return iU(async function(...t){let o=new iT([]),a=await e._def.args.parseAsync(t,i).catch(e=>{throw o.addIssue(r(t,e)),o}),l=await Reflect.apply(s,this,a);return await e._def.returns._def.type.parseAsync(l,i).catch(e=>{throw o.addIssue(n(l,e)),o})})}{let e=this;return iU(function(...t){let o=e._def.args.safeParse(t,i);if(!o.success)throw new iT([r(t,o.error)]);let a=Reflect.apply(s,this,o.data),l=e._def.returns.safeParse(a,i);if(!l.success)throw new iT([n(a,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new sM({...this._def,args:sP.create(e).rest(sw.create())})}returns(e){return new sM({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new sM({args:e||sP.create([]).rest(sw.create()),returns:t||sw.create(),typeName:P.ZodFunction,...iW(r)})}}class sB extends iQ{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}sB.create=(e,t)=>new sB({getter:e,typeName:P.ZodLazy,...iW(t)});class sO extends iQ{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return iB(t,{received:t.data,code:i_.invalid_literal,expected:this._def.value}),iL}return{status:"valid",value:e.data}}get value(){return this._def.value}}function sL(e,t){return new sF({values:e,typeName:P.ZodEnum,...iW(t)})}sO.create=(e,t)=>new sO({value:e,typeName:P.ZodLiteral,...iW(t)});class sF extends iQ{constructor(){super(...arguments),T.set(this,void 0)}_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return iB(t,{expected:k.joinValues(r),received:t.parsedType,code:i_.invalid_type}),iL}if(iz(this,T,"f")||iV(this,T,new Set(this._def.values),"f"),!iz(this,T,"f").has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return iB(t,{received:t.data,code:i_.invalid_enum_value,options:r}),iL}return iU(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return sF.create(e,{...this._def,...t})}exclude(e,t=this._def){return sF.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}T=new WeakMap,sF.create=sL;class sU extends iQ{constructor(){super(...arguments),C.set(this,void 0)}_parse(e){let t=k.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==iS.string&&r.parsedType!==iS.number){let e=k.objectValues(t);return iB(r,{expected:k.joinValues(e),received:r.parsedType,code:i_.invalid_type}),iL}if(iz(this,C,"f")||iV(this,C,new Set(k.getValidEnumValues(this._def.values)),"f"),!iz(this,C,"f").has(e.data)){let e=k.objectValues(t);return iB(r,{received:r.data,code:i_.invalid_enum_value,options:e}),iL}return iU(e.data)}get enum(){return this._def.values}}C=new WeakMap,sU.create=(e,t)=>new sU({values:e,typeName:P.ZodNativeEnum,...iW(t)});class sj extends iQ{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==iS.promise&&!1===t.common.async?(iB(t,{code:i_.invalid_type,expected:iS.promise,received:t.parsedType}),iL):iU((t.parsedType===iS.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}sj.create=(e,t)=>new sj({type:e,typeName:P.ZodPromise,...iW(t)});class sH extends iQ{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===P.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),n=this._def.effect||null,i={addIssue:e=>{iB(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===n.type){let e=n.transform(r.data,i);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return iL;let n=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===n.status?iL:"dirty"===n.status||"dirty"===t.value?iF(n.value):n});{if("aborted"===t.value)return iL;let n=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===n.status?iL:"dirty"===n.status||"dirty"===t.value?iF(n.value):n}}if("refinement"===n.type){let e=e=>{let t=n.refinement(e,i);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?iL:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let n=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===n.status?iL:("dirty"===n.status&&t.dirty(),e(n.value),{status:t.value,value:n.value})}}if("transform"===n.type)if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>i$(e)?Promise.resolve(n.transform(e.value,i)).then(e=>({status:t.value,value:e})):e);else{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!i$(e))return e;let s=n.transform(e.value,i);if(s instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}k.assertNever(n)}}sH.create=(e,t,r)=>new sH({schema:e,typeName:P.ZodEffects,effect:t,...iW(r)}),sH.createWithPreprocess=(e,t,r)=>new sH({schema:t,effect:{type:"preprocess",transform:e},typeName:P.ZodEffects,...iW(r)});class s$ extends iQ{_parse(e){return this._getType(e)===iS.undefined?iU(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}s$.create=(e,t)=>new s$({innerType:e,typeName:P.ZodOptional,...iW(t)});class sq extends iQ{_parse(e){return this._getType(e)===iS.null?iU(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}sq.create=(e,t)=>new sq({innerType:e,typeName:P.ZodNullable,...iW(t)});class sz extends iQ{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===iS.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}sz.create=(e,t)=>new sz({innerType:e,typeName:P.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...iW(t)});class sV extends iQ{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return iq(n)?n.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new iT(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===n.status?n.value:this._def.catchValue({get error(){return new iT(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}sV.create=(e,t)=>new sV({innerType:e,typeName:P.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...iW(t)});class sG extends iQ{_parse(e){if(this._getType(e)!==iS.nan){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.nan,received:t.parsedType}),iL}return{status:"valid",value:e.data}}}sG.create=e=>new sG({typeName:P.ZodNaN,...iW(e)});let sK=Symbol("zod_brand");class sW extends iQ{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class sQ extends iQ{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?iL:"dirty"===e.status?(t.dirty(),iF(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?iL:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new sQ({in:e,out:t,typeName:P.ZodPipeline})}}class sJ extends iQ{_parse(e){let t=this._def.innerType._parse(e),r=e=>(i$(e)&&(e.value=Object.freeze(e.value)),e);return iq(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function sZ(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function sY(e,t={},r){return e?sb.create().superRefine((n,i)=>{var s,o;let a=e(n);if(a instanceof Promise)return a.then(e=>{var s,o;if(!e){let e=sZ(t,n),a=null==(o=null!=(s=e.fatal)?s:r)||o;i.addIssue({code:"custom",...e,fatal:a})}});if(!a){let e=sZ(t,n),a=null==(o=null!=(s=e.fatal)?s:r)||o;i.addIssue({code:"custom",...e,fatal:a})}}):sb.create()}sJ.create=(e,t)=>new sJ({innerType:e,typeName:P.ZodReadonly,...iW(t)});let sX={object:sS.lazycreate};!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(P||(P={}));let s0=(e,t={message:`Input not instance of ${e.name}`})=>sY(t=>t instanceof e,t),s1=sc.create,s2=sd.create,s3=sG.create,s4=sh.create,s5=sf.create,s6=sp.create,s8=sg.create,s7=sm.create,s9=sy.create,oe=sb.create,ot=sw.create,or=sv.create,on=sE.create,oi=sA.create,os=sS.create,oo=sS.strictCreate,oa=sk.create,ol=sI.create,oc=sC.create,ou=sP.create,od=sR.create,oh=sD.create,of=sN.create,op=sM.create,og=sB.create,om=sO.create,oy=sF.create,ob=sU.create,ow=sj.create,ov=sH.create,oE=s$.create,oA=sq.create,ox=sH.createWithPreprocess,oS=sQ.create,ok=()=>s2().optional(),o_=()=>s5().optional(),oI={string:e=>sc.create({...e,coerce:!0}),number:e=>sd.create({...e,coerce:!0}),boolean:e=>sf.create({...e,coerce:!0}),bigint:e=>sh.create({...e,coerce:!0}),date:e=>sp.create({...e,coerce:!0})},oT=iL;var oC=Object.freeze({__proto__:null,defaultErrorMap:iC,setErrorMap:iR,getErrorMap:iD,makeIssue:iN,EMPTY_PATH:iM,addIssueToContext:iB,ParseStatus:iO,INVALID:iL,DIRTY:iF,OK:iU,isAborted:ij,isDirty:iH,isValid:i$,isAsync:iq,get util(){return k},get objectUtil(){return _},ZodParsedType:iS,getParsedType:ik,ZodType:iQ,datetimeRegex:ss,ZodString:sc,ZodNumber:sd,ZodBigInt:sh,ZodBoolean:sf,ZodDate:sp,ZodSymbol:sg,ZodUndefined:sm,ZodNull:sy,ZodAny:sb,ZodUnknown:sw,ZodNever:sv,ZodVoid:sE,ZodArray:sA,ZodObject:sS,ZodUnion:sk,ZodDiscriminatedUnion:sI,ZodIntersection:sC,ZodTuple:sP,ZodRecord:sR,ZodMap:sD,ZodSet:sN,ZodFunction:sM,ZodLazy:sB,ZodLiteral:sO,ZodEnum:sF,ZodNativeEnum:sU,ZodPromise:sj,ZodEffects:sH,ZodTransformer:sH,ZodOptional:s$,ZodNullable:sq,ZodDefault:sz,ZodCatch:sV,ZodNaN:sG,BRAND:sK,ZodBranded:sW,ZodPipeline:sQ,ZodReadonly:sJ,custom:sY,Schema:iQ,ZodSchema:iQ,late:sX,get ZodFirstPartyTypeKind(){return P},coerce:oI,any:oe,array:oi,bigint:s4,boolean:s5,date:s6,discriminatedUnion:ol,effect:ov,enum:oy,function:op,instanceof:s0,intersection:oc,lazy:og,literal:om,map:oh,nan:s3,nativeEnum:ob,never:or,null:s9,nullable:oA,number:s2,object:os,oboolean:o_,onumber:ok,optional:oE,ostring:()=>s1().optional(),pipeline:oS,preprocess:ox,promise:ow,record:od,set:of,strictObject:oo,string:s1,symbol:s8,transformer:ov,tuple:ou,undefined:s7,union:oa,unknown:ot,void:on,NEVER:oT,ZodIssueCode:i_,quotelessJson:iI,ZodError:iT});let oP=e=>e.message?e.message:"unspecified error";class oR extends tV{constructor(e){super(),this.code=tP,this.errors=e,super.message=`Web3 validator found ${e.length} error[s]:
${this._compileErrors().join("\n")}`}_compileErrors(){return this.errors.map(oP)}}let oD=["bool","int","uint","bytes","string","address","tuple"],oN=e=>"object"==typeof e&&"type"in e&&"name"in e,oM=e=>"string"==typeof e,oB=e=>"string"==typeof e&&/^((-)?0x[0-9a-f]+|(0x))$/i.test(e);function oO(e,t){return"string"==typeof e&&!!e.match(/^0x[0-9A-Fa-f]*$/)&&(void 0===t||!(t>0)||e.length===2+2*t)}let oL=e=>"number"==typeof e||"bigint"==typeof e||"string"==typeof e&&/^((-0x|0x|-)?[0-9a-f]+|(0x))$/i.test(e);function oF(e){if("string"!=typeof e)throw Error(`[isHexPrefixed] input must be type 'string', received type ${typeof e}`);return e.startsWith("0x")}let oU=function(e){for(let[t,r]of Object.entries(e))if(void 0!==r&&r.length>0&&0===r[0])throw Error(`${t} cannot have leading zeroes, received: ${r.toString()}`)},oj=["hex","number","blockNumber","blockNumberOrTag","filter","bloom"],oH=e=>{let t,r=e.replace(/ /,""),n=!1,i=[];if(e.includes("[")&&(r=r.slice(0,r.indexOf("[")),n=(i=[...e.matchAll(/(?:\[(\d*)\])/g)].map(e=>parseInt(e[1],10)).map(e=>Number.isNaN(e)?-1:e)).length>0),oD.includes(r))return{baseType:r,isArray:n,baseTypeSize:t,arraySizes:i};if(r.startsWith("int"))t=parseInt(r.substring(3),10),r="int";else if(r.startsWith("uint"))t=parseInt(e.substring(4),10),r="uint";else{if(!r.startsWith("bytes"))return{baseType:void 0,isArray:!1,baseTypeSize:void 0,arraySizes:i};t=parseInt(r.substring(5),10),r="bytes"}return{baseType:r,isArray:n,baseTypeSize:t,arraySizes:i}},o$=(e,t={})=>{if(Object.keys(t).includes("type"))throw new oR([{keyword:"eth",message:'Either "eth" or "type" can be presented in schema',params:{eth:e},instancePath:"",schemaPath:""}]);let{baseType:r,baseTypeSize:n}=oH(e);if(!r&&!oj.includes(e))throw new oR([{keyword:"eth",message:`Eth data type "${e}" is not valid`,params:{eth:e},instancePath:"",schemaPath:""}]);if(r){if("tuple"===r)throw Error('"tuple" type is not implemented directly.');return{format:`${r}${null!=n?n:""}`,required:!0}}return e?{format:e,required:!0}:{}},oq=(e,t="/0")=>{let r={type:"array",items:[],maxItems:e.length,minItems:e.length};for(let[n,i]of e.entries()){let e,s,o,a=[];oN(i)?(e=i.type,s=i.name||`${t}/${n}`,a=i.components):"string"==typeof i?(e=i,s=`${t}/${n}`):Array.isArray(i)&&(i[0]&&"string"==typeof i[0]&&i[0].startsWith("tuple")&&!Array.isArray(i[0])&&i[1]&&Array.isArray(i[1])?(e=i[0],s=`${t}/${n}`,a=i[1]):(e="tuple",s=`${t}/${n}`,a=i));let{baseType:l,isArray:c,arraySizes:u}=oH(e),d=r;for(let e=u.length-1;e>0;e-=1)o={type:"array",$id:s,items:[],maxItems:u[e],minItems:u[e]},u[e]<0&&(delete o.maxItems,delete o.minItems),Array.isArray(d.items)?0===d.items.length?d.items=[o]:d.items.push(o):d.items=[d.items,o],d=o;if("tuple"!==l||c)if("tuple"===l&&c){let e=u[0],t=Object.assign({type:"array",$id:s,items:oq(a,s)},e>=0&&{minItems:e,maxItems:e});d.items.push(t)}else if(c){let t=u[0],r=Object.assign({type:"array",$id:s,items:o$(e)},t>=0&&{minItems:t,maxItems:t});d.items.push(r)}else Array.isArray(d.items),d.items.push(Object.assign({$id:s},o$(e)));else{let e=oq(a,s);e.$id=s,d.items.push(e)}d=r}return r},oz=e=>oq(e),oV=(e,t)=>1===t?e:oV(e[0],t-1),oG=(e,t,r)=>{let n=[];for(let[i,s]of e.entries()){let e,o,a=[];oN(s)?(e=s.type,o=s.name,a=s.components):"string"==typeof s?e=s:Array.isArray(s)&&(s[1]&&Array.isArray(s[1])?(e=s[0],a=s[1]):(e="tuple",a=s));let{baseType:l,isArray:c,arraySizes:u}=oH(e),d=Array.isArray(t)?t[i]:t[o];if("tuple"!==l||c)if("tuple"===l&&c){let e=[];for(let t of d)if(u.length>1){let n=oV(t,u.length-1),i=[];for(let e of n)i.push(oG(a,e,r));e.push(i)}else e.push(oG(a,t,r));n.push(e)}else n.push(d);else n.push(oG(a,d,r))}return(r=null!=r?r:[]).push(...n),r},oK=e=>{if(e>=48&&e<=57)return e-48;if(e>=65&&e<=70)return e-55;if(e>=97&&e<=102)return e-87;throw Error(`Invalid code point: ${e}`)},oW=e=>{if(!oB(e))throw Error("Invalid hex string");let[t,r]=e.startsWith("-")?[!0,e.slice(1)]:[!1,e],n=BigInt(r);return n>Number.MAX_SAFE_INTEGER?t?-n:n:n<Number.MIN_SAFE_INTEGER?n:t?-1*Number(n):Number(n)},oQ=e=>{if(("number"==typeof e||"bigint"==typeof e)&&e<0)return`-0x${e.toString(16).slice(1)}`;if(("number"==typeof e||"bigint"==typeof e)&&e>=0)return`0x${e.toString(16)}`;if("string"==typeof e&&oB(e)){let[t,r]=e.startsWith("-")?[!0,e.slice(1)]:[!1,e],n=r.split(/^(-)?0(x|X)/).slice(-1)[0];return`${t?"-":""}0x${n.replace(/^0+/,"").toLowerCase()}`}if("string"==typeof e&&!oB(e))return oQ(BigInt(e));throw new r2(e)},oJ=(e,t,r="0")=>{if("string"==typeof e&&!oB(e))return e.padStart(t,r);let n="string"==typeof e&&oB(e)?e:oQ(e),[i,s]=n.startsWith("-")?["-0x",n.slice(3)]:["0x",n.slice(2)];return`${i}${s.padStart(t,r)}`};function oZ(e){let t="0x";for(let r of e){let e=r.toString(16);t+=1===e.length?`0${e}`:e}return t}let oY={zero:48,nine:57,A:65,F:70,a:97,f:102};function oX(e){return e>=oY.zero&&e<=oY.nine?e-oY.zero:e>=oY.A&&e<=oY.F?e-(oY.A-10):e>=oY.a&&e<=oY.f?e-(oY.a-10):void 0}function o0(e){let t=0;if(e.startsWith("0")&&("x"===e[1]||"X"===e[1])&&(t=2),e.length%2!=0)throw new r1(`hex string has odd length: ${e}`);let r=(e.length-t)/2,n=new Uint8Array(r);for(let i=0,s=t;i<r;i+=1){let t=oX(e.charCodeAt(s++)),r=oX(e.charCodeAt(s++));if(void 0===t||void 0===r)throw new r1(`Invalid byte sequence ("${e[s-2]}${e[s-1]}" in "${e}").`);n[i]=16*t+r}return n}function o1(e){var t;return e instanceof Uint8Array||(null==(t=null==e?void 0:e.constructor)?void 0:t.name)!=="Uint8Array"?e:Uint8Array.from(e)}let o2=e=>{var t,r;return e instanceof Uint8Array||(null==(t=null==e?void 0:e.constructor)?void 0:t.name)==="Uint8Array"||(null==(r=null==e?void 0:e.constructor)?void 0:r.name)==="Buffer"},o3=(e,t={abiType:"bytes"})=>{let r;if("string"!=typeof e&&!Array.isArray(e)&&!o2(e)||"string"==typeof e&&oB(e)&&e.startsWith("-")||"string"==typeof e&&!oB(e))return!1;if("string"==typeof e){if(e.length%2!=0)return!1;r=o0(e)}else if(Array.isArray(e)){if(e.some(e=>e<0||e>255||!Number.isInteger(e)))return!1;r=new Uint8Array(e)}else r=e;if(null==t?void 0:t.abiType){let{baseTypeSize:e}=oH(t.abiType);return!e||r.length===e}return null==t||!t.size||r.length===(null==t?void 0:t.size)},o4=e=>{if(!/^(0x)?[0-9a-f]{40}$/i.test(e))return!1;let t=e.slice(2),r=oZ(ix(o1(nX(t.toLowerCase())))).slice(2);for(let e=0;e<40;e+=1)if(parseInt(r[e],16)>7&&t[e].toUpperCase()!==t[e]||7>=parseInt(r[e],16)&&t[e].toLowerCase()!==t[e])return!1;return!0},o5=(e,t=!0)=>{let r;return("string"==typeof e||!!o2(e))&&(r=o2(e)?oZ(e):"string"!=typeof e||oB(e)||e.toLowerCase().startsWith("0x")?e:`0x${e}`,!!/^(0x)?[0-9a-f]{40}$/i.test(r)&&(!!(/^(0x|0X)?[0-9a-f]{40}$/.test(r)||/^(0x|0X)?[0-9A-F]{40}$/.test(r))||!t||o4(r)))},o6=(e,t)=>{if(t===BigInt(0))return BigInt(1);let r=e;for(let n=1;n<t;n+=1)r*=e;return r},o8=(e,t={abiType:"uint"})=>{let r;if(!["number","string","bigint"].includes(typeof e)||"string"==typeof e&&0===e.length)return!1;if(null==t?void 0:t.abiType){let{baseTypeSize:e}=oH(t.abiType);e&&(r=e)}else t.bitSize&&(r=t.bitSize);let n=o6(BigInt(2),BigInt(null!=r?r:256))-BigInt(1);try{let t="string"==typeof e&&oB(e)?BigInt(oW(e)):BigInt(e);return t>=0&&t<=n}catch(e){return!1}},o7=(e,t={abiType:"int"})=>{let r;if(!["number","string","bigint"].includes(typeof e)||"number"==typeof e&&e>Number.MAX_SAFE_INTEGER)return!1;if(null==t?void 0:t.abiType){let{baseTypeSize:e,baseType:n}=oH(t.abiType);if("int"!==n)return!1;e&&(r=e)}else t.bitSize&&(r=t.bitSize);let n=o6(BigInt(2),BigInt((null!=r?r:256)-1)),i=BigInt(-1)*o6(BigInt(2),BigInt((null!=r?r:256)-1));try{let t="string"==typeof e&&oB(e)?BigInt(oW(e)):BigInt(e);return t>=i&&t<=n}catch(e){return!1}},o9=e=>!!(o7(e)||"string"==typeof e&&/[0-9.]/.test(e)&&e.indexOf(".")===e.lastIndexOf("."))||"number"==typeof e,ae=e=>o8(e),at=e=>Object.values(x).includes(e),ar=e=>at(e)||ae(e),an=e=>"string"==typeof e&&!!/^(0x)?[0-9a-f]{512}$/i.test(e)&&!!(/^(0x)?[0-9a-f]{512}$/.test(e)||/^(0x)?[0-9A-F]{512}$/.test(e)),ai=(e,t)=>{if("string"==typeof t&&!oB(t)||!an(e))return!1;let r=oZ(ix("string"==typeof t?o0(t):t)).slice(2);for(let t=0;t<12;t+=4){let n=(parseInt(r.slice(t,t+2),16)<<8)+parseInt(r.slice(t+2,t+4),16)&2047,i=oK(e.charCodeAt(e.length-1-Math.floor(n/4))),s=1<<n%4;if((i&s)!==s)return!1}return!0},as=(e,t)=>!!an(e)&&!!o5(t)&&ai(e,oJ(t,64)),ao=(e,t)=>!!an(e)&&!!o5(t)&&ai(e,t),aa=e=>!!["number","string","boolean"].includes(typeof e)&&("boolean"==typeof e||("string"!=typeof e||oB(e)?"string"==typeof e&&oB(e)?"0x1"===e||"0x0"===e:1===e||0===e:"1"===e||"0"===e)),al=e=>null==e,ac=e=>"object"==typeof e&&!al(e)&&!Array.isArray(e)&&!(e instanceof X),au=e=>"string"==typeof e&&!!/^(0x)?[0-9a-f]{64}$/i.test(e)&&!!(/^(0x)?[0-9a-f]{64}$/.test(e)||/^(0x)?[0-9A-F]{64}$/.test(e)),ad=(e,t)=>!!an(e)&&!!au(t)&&ai(e,t),ah=e=>{let t=["fromBlock","toBlock","address","topics","blockHash"];if(al(e)||"object"!=typeof e||!Object.keys(e).every(e=>t.includes(e))||!al(e.fromBlock)&&!ar(e.fromBlock)||!al(e.toBlock)&&!ar(e.toBlock))return!1;if(!al(e.address)){if(Array.isArray(e.address)){if(!e.address.every(e=>o5(e)))return!1}else if(!o5(e.address))return!1}return!!al(e.topics)||!!e.topics.every(e=>!!al(e)||(Array.isArray(e)?e.every(e=>au(e)):!!au(e)))},af={address:e=>o5(e),bloom:e=>an(e),blockNumber:e=>ae(e),blockTag:e=>at(e),blockNumberOrTag:e=>ar(e),bool:e=>aa(e),bytes:e=>o3(e),filter:e=>ah(e),hex:e=>oB(e),uint:e=>o8(e),int:e=>o7(e),number:e=>o9(e),string:e=>oM(e)};for(let e=8;e<=256;e+=8)af[`int${e}`]=t=>o7(t,{bitSize:e}),af[`uint${e}`]=t=>o8(t,{bitSize:e});for(let e=1;e<=32;e+=1)af[`bytes${e}`]=t=>o3(t,{size:e});af.bytes256=af.bytes;let ap=af,ag=e=>{if((!(null==e?void 0:e.type)||(null==e?void 0:e.type)==="object")&&(null==e?void 0:e.properties)){let t={};for(let r of Object.keys(e.properties)){let n=ag(e.properties[r]);n&&(t[r]=n)}return Array.isArray(e.required)?oC.object(t).partial().required(e.required.reduce((e,t)=>Object.assign(Object.assign({},e),{[t]:!0}),{})):oC.object(t).partial()}if((null==e?void 0:e.type)==="array"&&(null==e?void 0:e.items)){if(Array.isArray(e.items)&&e.items.length>1&&void 0!==e.maxItems&&new Set(e.items.map(e=>e.$id)).size===e.items.length){let t=[];for(let r of e.items){let e=ag(r);e&&t.push(e)}return oC.tuple(t)}let t=Array.isArray(e.items)?e.items[0]:e.items,r=oC.array(ag(t));return r=void 0!==e.minItems?r.min(e.minItems):r,r=void 0!==e.maxItems?r.max(e.maxItems):r}if(e.oneOf&&Array.isArray(e.oneOf))return oC.union(e.oneOf.map(e=>ag(e)));if(null==e?void 0:e.format){if(!ap[e.format])throw new nI(e.format);return oC.any().refine(ap[e.format],t=>({params:{value:t,format:e.format}}))}return(null==e?void 0:e.type)&&(null==e?void 0:e.type)!=="object"&&"function"==typeof oC[String(e.type)]?oC[String(e.type)]():oC.object({data:oC.any()}).partial()};class am{static factory(){return am.validatorInstance||(am.validatorInstance=new am),am.validatorInstance}validate(e,t,r){var n,i;let s=ag(e).safeParse(t);if(!s.success){let e=this.convertErrors(null!=(i=null==(n=s.error)?void 0:n.issues)?i:[]);if(e){if(null==r?void 0:r.silent)return e;throw new oR(e)}}}convertErrors(e){if(e&&Array.isArray(e)&&e.length>0)return e.map(e=>{var t;let r,n,i,s;s=e.path.join("/");let o=String(e.path[e.path.length-1]),a=e.path.join("/");if(e.code===i_.too_big)n="maxItems",s=`${a}/maxItems`,i={limit:e.maximum},r=`must NOT have more than ${e.maximum} items`;else if(e.code===i_.too_small)n="minItems",s=`${a}/minItems`,i={limit:e.minimum},r=`must NOT have fewer than ${e.minimum} items`;else if(e.code===i_.custom){let{value:n,format:o}=null!=(t=e.params)?t:{};r=void 0===n?`value at "/${s}" is required`:`value "${"object"==typeof n?JSON.stringify(n):n}" at "/${s}" must pass "${o}" validation`,i={value:n}}return{keyword:null!=n?n:o,instancePath:a?`/${a}`:"",schemaPath:s?`#${s}`:"#",params:null!=i?i:{value:e.message},message:null!=r?r:e.message}})}}class ay{constructor(){this._validator=am.factory()}validateJSONSchema(e,t,r){return this._validator.validate(e,t,r)}validate(e,t,r={silent:!1}){var n,i;let s=oz(e);if(!Array.isArray(s.items)||(null==(n=s.items)?void 0:n.length)!==0||0!==t.length){if(Array.isArray(s.items)&&(null==(i=s.items)?void 0:i.length)===0&&0!==t.length)throw new oR([{instancePath:"/0",schemaPath:"/",keyword:"required",message:"empty schema against data can not be validated",params:t}]);return this._validator.validate(s,t,r)}}}let ab=new ay;function aw(e){var t,r;return e instanceof Uint8Array||(null==(t=null==e?void 0:e.constructor)?void 0:t.name)==="Uint8Array"||(null==(r=null==e?void 0:e.constructor)?void 0:r.name)==="Buffer"}function av(...e){let t=new Uint8Array(e.reduce((e,t)=>e+t.length,0)),r=0;for(let n of e)t.set(n,r),r+=n.length;return t}function aE(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r+=1)if(e[r]!==t[r])return!1;return!0}let aA={noether:BigInt(0),wei:BigInt(1),kwei:BigInt(1e3),Kwei:BigInt(1e3),babbage:BigInt(1e3),femtoether:BigInt(1e3),mwei:BigInt(1e6),Mwei:BigInt(1e6),lovelace:BigInt(1e6),picoether:BigInt(1e6),gwei:BigInt(1e9),Gwei:BigInt(1e9),shannon:BigInt(1e9),nanoether:BigInt(1e9),nano:BigInt(1e9),szabo:BigInt(1e12),microether:BigInt(1e12),micro:BigInt(1e12),finney:BigInt(1e15),milliether:BigInt(1e15),milli:BigInt(1e15),ether:BigInt("1000000000000000000"),kether:BigInt("1000000000000000000000"),grand:BigInt("1000000000000000000000"),mether:BigInt("1000000000000000000000000"),gether:BigInt("1000000000000000000000000000"),tether:BigInt("1000000000000000000000000000000")},ax="Warning: Using type `number` with values that are large or contain many decimals may cause loss of precision, it is recommended to use type `string` or `BigInt` when using conversion methods",aS=e=>{if(ab.validate(["bytes"],[e]),aw(e))return e;if(Array.isArray(e))return new Uint8Array(e);if("string"==typeof e)return o0(e);throw new r1(e)},{uint8ArrayToHexString:ak}=G,a_=e=>ak(aS(e)),aI=e=>"string"==typeof e&&"0x"!==e.slice(0,2).toLowerCase()?aS(`0x${e}`):aS(e),aT=e=>(ab.validate(["hex"],[e]),oW(e)),aC=aT,aP=(e,t)=>{"bigint"!=typeof e&&ab.validate(["int"],[e]);let r=oQ(e);return t&&(r.startsWith("-")||r.length%2!=1?r.length%2==0&&r.startsWith("-")&&(r="-0x0".concat(r.slice(3))):r="0x0".concat(r.slice(2))),r},aR=aP,aD=e=>aT(e).toString(),aN=e=>{ab.validate(["string"],[e]);let t=e.replace(/^(?:\u0000)/,"");return t=t.replace(/(?:\u0000)$/,""),a_(new TextEncoder().encode(t))},aM=aN,aB=aN,aO=e=>iv(aI(e)),aL=e=>"string"==typeof e?aO(e):(ab.validate(["bytes"],[e]),iv(e)),aF=nX,aU=aO,aj=e=>{ab.validate(["string"],[e]);let t="";for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r).toString(16);t+=n.length%2!=0?`0${n}`:n}return`0x${t}`},aH=aj,a$=e=>new TextDecoder("ascii").decode(aI(e)),aq=a$,az=(e,t)=>{if("string"==typeof e&&o5(e))return t?"address":`0x${e.toLowerCase().replace(/^0x/i,"")}`;if("boolean"==typeof e)return t?"bool":e?"0x01":"0x00";if("number"==typeof e)return t?e<0?"int256":"uint256":aP(e);if("bigint"==typeof e)return t?"bigint":aP(e);if(aw(e))return t?"bytes":a_(e);if("object"==typeof e&&e)return t?"string":aN(JSON.stringify(e));if("string"==typeof e){if(e.startsWith("-0x")||e.startsWith("-0X"))return t?"int256":aP(e);if(oB(e))return t?"bytes":e;if(oL(e)&&!o7(e)&&!o8(e))return t?"bytes":`0x${e}`;if(oL(e)&&!o7(e)&&o8(e))return t?"uint":aP(e);if(!Number.isFinite(e))return t?"string":aN(e)}throw new r8(e)},aV=e=>{if("number"==typeof e)return e>1e20?(console.warn(ax),BigInt(e)):e;if("bigint"==typeof e)return e>=Number.MIN_SAFE_INTEGER&&e<=Number.MAX_SAFE_INTEGER?Number(e):e;if("string"==typeof e&&oB(e))return aT(e);try{return aV(BigInt(e))}catch(t){throw new r2(e)}},aG=e=>{if("number"==typeof e)return BigInt(e);if("bigint"==typeof e)return e;if("string"==typeof e&&oL(e))return e.startsWith("-")?-BigInt(e.substring(1)):BigInt(e);throw new r2(e)},aK=(e,t)=>{let r;if("string"==typeof t){if(!(r=aA[t]))throw new r5(t)}else{if(t<0||!Number.isInteger(t))throw new r6(t);r=o6(BigInt(10),BigInt(t))}let n=String(aV(e)),i=r.toString().length-1;if(i<=0)return n.toString();let s=n.padStart(i,"0"),o=s.slice(0,-i),a=s.slice(-i).replace(/\.?0+$/,"");return""===o?a?`0.${a}`:"0":""===a?o:`${o}.${a}`.slice(0,o.length+i+1)},aW=(e,t)=>{let r;if(ab.validate(["number"],[e]),"string"==typeof t){if(!(r=aA[t]))throw new r5(t)}else{if(t<0||!Number.isInteger(t))throw new r6(t);r=o6(BigInt(10),BigInt(t))}let n=e;"number"==typeof n&&(n<1e-15&&console.warn(ax),n>1e20?(console.warn(ax),n=BigInt(n)):n=n.toLocaleString("fullwide",{useGrouping:!1,maximumFractionDigits:20}));let[i,s]=String("string"==typeof n&&!oB(n)?n:aV(n)).split(".").concat(""),o=BigInt(`${i}${s}`)*r,a=s.length;return 0===a?o.toString():o.toString().slice(0,-a)},aQ=e=>{if(!o5(e,!1))throw new r3(e);let t=e.toLowerCase().replace(/^0x/i,""),r=oZ(ix(o1(aF(t))));if(al(r)||"0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"===r)return"";let n="0x",i=r.replace(/^0x/i,"");for(let e=0;e<t.length;e+=1)parseInt(i[e],16)>7?n+=t[e].toUpperCase():n+=t[e];return n},aJ=e=>{if("boolean"==typeof e)return e;if("number"==typeof e&&(0===e||1===e)||"bigint"==typeof e&&(e===BigInt(0)||e===BigInt(1)))return!!e;if("string"==typeof e&&!oB(e)&&("1"===e||"0"===e||"false"===e||"true"===e))return"true"===e||"false"!==e&&!!Number(e);if("string"==typeof e&&oB(e)&&("0x1"===e||"0x0"===e))return!!aV(e);throw new r9(e)};var aZ=r(15484);class aY extends aZ.A{constructor(){super(...arguments),this.maxListeners=Number.MAX_SAFE_INTEGER}setMaxListeners(e){return this.maxListeners=e,this}getMaxListeners(){return this.maxListeners}}let aX=oB,a0=oL,a1=o4,a2=o5,a3=an,a4=ai,a5=as,a6=ao,a8=au,a7=ad,a9=(e,t)=>{let r="string"==typeof e&&at(e),n="string"==typeof t&&at(t);if(e===t||("earliest"===e||0===e)&&("earliest"===t||0===t))return 0;if("earliest"===e)return -1;if("earliest"===t)return 1;if(r&&n){let r={[x.EARLIEST]:1,[x.FINALIZED]:2,[x.SAFE]:3,[x.LATEST]:4,[x.PENDING]:5};return r[e]<r[t]?-1:1}if(r&&!n||!r&&n)throw new nn("Cannot compare blocktag with provided non-blocktag input.");let i=BigInt(e),s=BigInt(t);return i<s?-1:+(i!==s)},le=e=>"object"==typeof e&&!al(e)&&0!==Object.keys(e).length&&["input","data","from","gas","gasPrice","gasLimit","address","jsonInterface","syncWithContext","dataInputFill"].some(t=>t in e),lt=al,lr=e=>"object"==typeof e&&!al(e)&&!Array.isArray(e)&&!(e instanceof X),ln=(e,...t)=>{if(!lr(e))return e;let r=Object.assign({},e);for(let e of t)for(let t in e)lr(e[t])?(r[t]||(r[t]={}),r[t]=ln(r[t],e[t])):!al(e[t])&&Object.hasOwnProperty.call(e,t)&&(Array.isArray(e[t])||e[t]instanceof X?r[t]=e[t].slice(0):r[t]=e[t]);return r},li=(e,t,r="0")=>"string"==typeof e?oB(e)?oJ(e,t,r):e.padStart(t,r):(ab.validate(["int"],[e]),oJ(e,t,r)),ls=(e,t,r="0")=>{if("string"==typeof e&&!oB(e))return e.padEnd(t,r);let n="string"==typeof e&&oB(e)?e:aP(e),i=n.startsWith("-")?3:2;return ab.validate([n.startsWith("-")?"int":"uint"],[e]),n.padEnd(t+i,r)},lo=ls,la=li,ll=(e,t=64)=>{ab.validate(["int"],[e]);let r=aV(e);if(r>=0)return li(az(r),t);let n=o6(BigInt(2),BigInt(4*t));if(-r>=n)throw new r7(`value: ${e}, nibbleWidth: ${t}`);return li(aP(BigInt(r)+n),t)},lc=(e,t=64)=>{ab.validate(["int"],[e]);let r=aV(e);if(r<0)return r;let n=Math.ceil(Math.log(Number(r))/Math.log(2));if(n>4*t)throw new r7(`value: "${e}", nibbleWidth: "${t}"`);if(4*t!==n)return r;let i=o6(BigInt(2),BigInt(t)*BigInt(4));return aV(BigInt(r)-i)},{parseBaseType:lu}=G,ld=e=>"object"==typeof e&&!al(e)&&"number"in e&&"bytes"in e,lh=(e,t,r=[])=>{let n,i=Object.assign({},e);for(let e of t){if(i.oneOf&&n){let e=n,t=r.find(([t])=>t===e);t&&t[0]===n&&(i=i.oneOf[t[1]])}if(!i.properties&&!i.items)return;i.properties?i=i.properties[e]:i.items&&i.items.properties?i=i.items.properties[e]:i.items&&ac(i.items)?i=i.items:i.items&&Array.isArray(i.items)&&(i=i.items[parseInt(e,10)]),i&&e&&(n=e)}return i},lf=(e,t,r)=>{try{let{baseType:n,baseTypeSize:i}=lu(t);if("int"===n||"uint"===n)switch(r.number){case E.NUMBER:return Number(aG(e));case E.HEX:return aP(aG(e));case E.STR:return aG(e).toString();case E.BIGINT:return aG(e);default:throw new ro(`Invalid format: ${String(r.number)}`)}if("bytes"===n){let t;switch(i?"string"==typeof e?t=li(e,2*i):aw(e)&&(t=av(new Uint8Array(i-e.length),e)):t=e,r.bytes){case A.HEX:return a_(aS(t));case A.UINT8ARRAY:return aS(t);default:throw new ro(`Invalid format: ${String(r.bytes)}`)}}if("string"===n)return String(e)}catch(e){}return e},lp=({value:e,schemaProp:t,schema:r,object:n,key:i,dataPath:s,format:o,oneOfPath:a=[]})=>{var l,c;if(Array.isArray(e)){let u=t;if((null==t?void 0:t.oneOf)!==void 0&&t.oneOf.forEach((r,n)=>{var s,o;Array.isArray(null==t?void 0:t.items)||("object"!=typeof e[0]||(null==(s=null==r?void 0:r.items)?void 0:s.type)!=="object")&&("string"!=typeof e[0]||(null==(o=null==r?void 0:r.items)?void 0:o.type)==="object")||(u=r,a.push([i,n]))}),al(null==u?void 0:u.items))return delete n[i],s.pop(),!0;if(ac(u.items)&&!al(u.items.format)){for(let t=0;t<e.length;t+=1)n[i][t]=lf(e[t],null==(l=null==u?void 0:u.items)?void 0:l.format,o);return s.pop(),!0}if(!Array.isArray(null==u?void 0:u.items)&&(null==(c=null==u?void 0:u.items)?void 0:c.type)==="object"){for(let t of e)lg(t,r,s,o,a);return s.pop(),!0}if(Array.isArray(null==u?void 0:u.items)){for(let t=0;t<e.length;t+=1)n[i][t]=lf(e[t],u.items[t].format,o);return s.pop(),!0}}return!1},lg=(e,t,r,n,i=[])=>{var s;if(!ac(e)&&!Array.isArray(e))return lf(e,null==t?void 0:t.format,n);let o=e;if(Array.isArray(o)&&(null==t?void 0:t.type)==="array"&&(null==(s=null==t?void 0:t.items)?void 0:s.type)==="object")lp({value:o,schemaProp:t,schema:t,object:o,key:"",dataPath:r,format:n,oneOfPath:i});else for(let[e,s]of Object.entries(o)){r.push(e);let a=lh(t,r,i);if(al(a)){delete o[e],r.pop();continue}if(ac(s)){lg(s,t,r,n,i),r.pop();continue}if(!lp({value:s,schemaProp:a,schema:t,object:o,key:e,dataPath:r,format:n,oneOfPath:i})){if((null==a?void 0:a.format)===void 0&&(null==a?void 0:a.oneOf)!==void 0){for(let[e,t]of a.oneOf.entries())if((null==t?void 0:t.format)!==void 0){a=t;break}}o[e]=lf(s,a.format,n),r.pop()}}return o},lm=(e,t,r=Z)=>{let n;n=ac(t)?ln({},t):Array.isArray(t)?[...t]:t;let i=ac(e)?e:oz(e);if(!i.properties&&!i.items&&!i.format)throw new ro("Invalid json schema for formatting");return lg(n,i,[],r)},ly="0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",lb=e=>{let t;return a_(ix(o1(t="bigint"==typeof e||"number"==typeof e?nX(e.toString()):Array.isArray(e)?new Uint8Array(e):"string"!=typeof e||oB(e)?aS(e):nX(e))))},lw=e=>{let t,r=lb(t="string"==typeof e?e.startsWith("0x")&&oB(e)?aI(e):nX(e):e);return r===ly?void 0:r},lv=e=>{let t=lw(e);return al(t)?ly:t},lE=e=>{let t,r;if(Array.isArray(e))throw Error("Autodetection of array types is not supported.");if("object"==typeof e&&("t"in e||"type"in e)&&("v"in e||"value"in e))t="t"in e?e.t:e.type,r="v"in e?e.v:e.value,t="bigint"===t.toLowerCase()?"int":t;else{if("bigint"==typeof e)return["int",e];t=az(e,!0),r=az(e),t.startsWith("int")||t.startsWith("uint")||(t="bytes")}return(t.startsWith("int")||t.startsWith("uint"))&&"string"==typeof r&&!/^(-)?0x/i.test(r)&&(r=aG(r)),[t,r]},lA=e=>e.startsWith("int[")?`int256${e.slice(3)}`:"int"===e?"int256":e.startsWith("uint[")?`uint256'${e.slice(4)}`:"uint"===e?"uint256":e,lx=(e,t)=>{let r=/^(\d+).*$/.exec(e.slice(t));return r?parseInt(r[1],10):0},lS=e=>e.toString(2).length,lk=(e,t)=>{let r=t.toString();if("string"===e){if("string"==typeof t)return aN(t);throw new r4(t)}if("bool"===e||"boolean"===e){if("boolean"==typeof t)return t?"01":"00";throw new r9(t)}if("address"===e){if(!o5(r))throw new r3(r);return r}let n=lA(e);if(e.startsWith("uint")){let e=lx(n,4);if(e%8||e<8||e>256)throw new nt(r);let t=aV(r);if(lS(t)>e)throw new nr(r);if(t<BigInt(0))throw new ne(r);return e?la(t.toString(16),e/8*2):t.toString(16)}if(e.startsWith("int")){let t=lx(n,3);if(t%8||t<8||t>256)throw new nt(e);let i=aV(r);if(lS(i)>t)throw new nr(r);return i<BigInt(0)?ll(i.toString(),t/8*2):t?la(i.toString(16),t/4):i.toString(16)}if("bytes"===n){if(r.replace(/^0x/i,"").length%2!=0)throw new r1(r);return r}if(e.startsWith("bytes")){if(r.replace(/^0x/i,"").length%2!=0)throw new r1(r);let t=lx(e,5);if(!t||t<1||t>64||t<r.replace(/^0x/i,"").length/2)throw new r1(r);return lo(r,2*t)}return""},l_=e=>{let[t,r]=lE(e);return Array.isArray(r)?r.map(e=>lk(t,e).replace("0x","")).join(""):lk(t,r).replace("0x","")},lI=(...e)=>{let t=e.map(l_);return`0x${t.join("").toLowerCase()}`},lT=(...e)=>lw(lI(...e)),lC=(...e)=>lv(lI(...e)),lP=e=>lw(`0x${("number"==typeof e?e.toString():e).padStart(64,"0")}`);function lR(e){return n6(e)}let lD=e=>lR(e),lN=e=>a_(lD(e));var lM=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function lB(e){return("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}function lO(e,t,r){return lM(this,void 0,void 0,function*(){let n,i=yield Promise.race([e instanceof Promise?e:e(),new Promise((e,i)=>{n=setTimeout(()=>r?i(r):e(void 0),t)})]);if(n&&clearTimeout(n),i instanceof Error)throw i;return i})}function lL(e,t){let r;return[new Promise((n,i)=>{r=setInterval(function s(){return lM(this,void 0,void 0,function*(){try{let i=yield lO(e,t);al(i)||(clearInterval(r),n(i))}catch(e){clearInterval(r),i(e)}}),s}(),t)}),r]}function lF(e,t){return lM(this,void 0,void 0,function*(){return lL(e,t)[0]})}function lU(e,t){let r,n=new Promise((n,i)=>{r=setTimeout(()=>{i(t)},e)});return[r,n]}function lj(e,t){let r,n=new Promise((n,i)=>{r=setInterval(()=>{lM(this,void 0,void 0,function*(){let t=yield e();t&&(clearInterval(r),i(t))})},t)});return[r,n]}let lH=()=>{let e=lD(16);e[6]=15&e[6]|64,e[8]=63&e[8]|128;let t=a_(e);return[t.substring(2,10),t.substring(10,14),t.substring(14,18),t.substring(18,22),t.substring(22,34)].join("-")},l$=e=>{let t=e.error.code;return n_.has(t)||t>=-32099&&t<=-32e3},lq=e=>!Array.isArray(e)&&!!e&&"2.0"===e.jsonrpc&&"result"in e&&al(e.error)&&("number"==typeof e.id||"string"==typeof e.id),lz=e=>!Array.isArray(e)&&"2.0"===e.jsonrpc&&!!e&&al(e.result)&&"error"in e&&("number"==typeof e.id||"string"==typeof e.id),lV=e=>!Array.isArray(e)&&!!e&&"2.0"===e.jsonrpc&&!al(e.params)&&!al(e.method),lG=e=>!Array.isArray(e)&&!!e&&"2.0"===e.jsonrpc&&"id"in e&&"result"in e,lK=e=>lq(e)||lz(e),lW=e=>Array.isArray(e)?e.every(lK):lK(e),lQ=e=>Array.isArray(e)&&e.length>0&&lW(e),lJ=e=>{i=e},lZ=e=>{var t,r,n,s;return void 0!==i&&(i+=1),{jsonrpc:null!=(t=e.jsonrpc)?t:"2.0",id:null!=(n=null!=(r=e.id)?r:i)?n:lH(),method:e.method,params:null!=(s=e.params)?s:void 0}},lY=e=>e.map(e=>lZ(e)),lX=e=>Array.isArray(e)&&e.length>0;var l0=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class l1{constructor({timeout:e,eagerStart:t,timeoutMessage:r}={timeout:0,eagerStart:!1,timeoutMessage:"DeferredPromise timed out"}){this[R]="Promise",this._state="pending",this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t}),this._timeoutMessage=r,this._timeoutInterval=e,t&&this.startTimer()}get state(){return this._state}then(e,t){return l0(this,void 0,void 0,function*(){return this._promise.then(e,t)})}catch(e){return l0(this,void 0,void 0,function*(){return this._promise.catch(e)})}finally(e){return l0(this,void 0,void 0,function*(){return this._promise.finally(e)})}resolve(e){this._resolve(e),this._state="fulfilled",this._clearTimeout()}reject(e){this._reject(e),this._state="rejected",this._clearTimeout()}startTimer(){this._timeoutInterval&&this._timeoutInterval>0&&(this._timeoutId=setTimeout(this._checkTimeout.bind(this),this._timeoutInterval))}_checkTimeout(){"pending"===this._state&&this._timeoutId&&this.reject(new rl(this._timeoutMessage))}_clearTimeout(){this._timeoutId&&clearTimeout(this._timeoutId)}}R=Symbol.toStringTag;class l2{constructor(e,t){this.eventEmitter=e,this.autoReconnect=t,this.chunkTimeout=15e3}clearQueues(){"function"==typeof this._clearQueues&&this._clearQueues()}onError(e){this._clearQueues=e}parseResponse(e){let t=[];return e.replace(/\}[\n\r]?\{/g,"}|--|{").replace(/\}\][\n\r]?\[\{/g,"}]|--|[{").replace(/\}[\n\r]?\[\{/g,"}|--|[{").replace(/\}\][\n\r]?\{/g,"}]|--|{").split("|--|").forEach(e=>{let r,n=e;this.lastChunk&&(n=this.lastChunk+n);try{r=JSON.parse(n)}catch(e){this.lastChunk=n,this.lastChunkTimeout&&clearTimeout(this.lastChunkTimeout),this.lastChunkTimeout=setTimeout(()=>{this.autoReconnect||(this.clearQueues(),this.eventEmitter.emit("error",new na({id:1,jsonrpc:"2.0",error:{code:2,message:"Chunk timeout"}})))},this.chunkTimeout);return}clearTimeout(this.lastChunkTimeout),this.lastChunk=void 0,r&&t.push(r)}),t}}var l3=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class l4 extends er{constructor(){super(...arguments),this._eventEmitter=new aZ.b,this._chainId="",this._accounts=[]}_getChainId(){return l3(this,void 0,void 0,function*(){var e;let t=yield this.request(lZ({method:"eth_chainId",params:[]}));return null!=(e=null==t?void 0:t.result)?e:""})}_getAccounts(){return l3(this,void 0,void 0,function*(){var e;let t=yield this.request(lZ({method:"eth_accounts",params:[]}));return null!=(e=null==t?void 0:t.result)?e:[]})}_onConnect(){Promise.all([this._getChainId().then(e=>{e!==this._chainId&&(this._chainId=e,this._eventEmitter.emit("chainChanged",this._chainId))}).catch(e=>{console.error(e)}),this._getAccounts().then(e=>{this._accounts.length===e.length&&e.every(t=>e.includes(t))||(this._accounts=e,this._onAccountsChanged())}).catch(e=>{console.error(e)})]).then(()=>this._eventEmitter.emit("connect",{chainId:this._chainId})).catch(e=>{console.error(e)})}_onDisconnect(e,t){this._eventEmitter.emit("disconnect",new nf(e,t))}_onAccountsChanged(){this._eventEmitter.emit("accountsChanged",this._accounts)}}var l5=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let l6={autoReconnect:!0,delay:5e3,maxAttempts:5},l8=1e3;class l7 extends l4{get SocketConnection(){return this._socketConnection}constructor(e,t,r){if(super(),this._connectionStatus="connecting",this._onMessageHandler=this._onMessage.bind(this),this._onOpenHandler=this._onConnect.bind(this),this._onCloseHandler=this._onCloseEvent.bind(this),this._onErrorHandler=this._onError.bind(this),!this._validateProviderPath(e))throw new rf(e);this._socketPath=e,this._socketOptions=t,this._reconnectOptions=Object.assign(Object.assign({},l6),null!=r?r:{}),this._pendingRequestsQueue=new Map,this._sentRequestsQueue=new Map,this._init(),this.connect(),this.chunkResponseParser=new l2(this._eventEmitter,this._reconnectOptions.autoReconnect),this.chunkResponseParser.onError(()=>{this._clearQueues()}),this.isReconnecting=!1}_init(){this._reconnectAttempts=0}connect(){try{this._openSocketConnection(),this._connectionStatus="connecting",this._addSocketListeners()}catch(e){if(this.isReconnecting)setImmediate(()=>{this._reconnect()});else{if(this._connectionStatus="disconnected",e&&e.message)throw new t3(`Error while connecting to ${this._socketPath}. Reason: ${e.message}`);throw new rf(this._socketPath)}}}_validateProviderPath(e){return!!e}getPendingRequestQueueSize(){return this._pendingRequestsQueue.size}getSentRequestsQueueSize(){return this._sentRequestsQueue.size}supportsSubscriptions(){return!0}on(e,t){this._eventEmitter.on(e,t)}once(e,t){this._eventEmitter.once(e,t)}removeListener(e,t){this._eventEmitter.removeListener(e,t)}_onDisconnect(e,t){this._connectionStatus="disconnected",super._onDisconnect(e,t)}disconnect(e,t){let r=null!=e?e:l8;this._removeSocketListeners(),"disconnected"!==this.getStatus()&&this._closeSocketConnection(r,t),this._onDisconnect(r,t)}safeDisconnect(e,t){return l5(this,arguments,void 0,function*(e,t,r=!1,n=1e3){let i=0,s=()=>l5(this,void 0,void 0,function*(){return new Promise(e=>{let t=setInterval(()=>{r&&i>=5&&this.clearQueues(),0===this.getPendingRequestQueueSize()&&0===this.getSentRequestsQueueSize()&&(clearInterval(t),e(!0)),i+=1},n)})});yield s(),this.disconnect(e,t)})}removeAllListeners(e){this._eventEmitter.removeAllListeners(e)}_onError(e){this.isReconnecting?this._reconnect():this._eventEmitter.emit("error",e)}reset(){this._sentRequestsQueue.clear(),this._pendingRequestsQueue.clear(),this._init(),this._removeSocketListeners(),this._addSocketListeners()}_reconnect(){this.isReconnecting||(this.isReconnecting=!0,this._sentRequestsQueue.size>0&&this._sentRequestsQueue.forEach((e,t)=>{e.deferredPromise.reject(new t6),this._sentRequestsQueue.delete(t)}),this._reconnectAttempts<this._reconnectOptions.maxAttempts?(this._reconnectAttempts+=1,setTimeout(()=>{this._removeSocketListeners(),this.connect(),this.isReconnecting=!1},this._reconnectOptions.delay)):(this.isReconnecting=!1,this._clearQueues(),this._removeSocketListeners(),this._eventEmitter.emit("error",new t5(this._reconnectOptions.maxAttempts))))}request(e){return l5(this,void 0,void 0,function*(){if(lt(this._socketConnection))throw Error("Connection is undefined");"disconnected"===this.getStatus()&&this.connect();let t=lX(e)?e[0].id:e.id;if(!t)throw new rg("Request Id not defined");if(this._sentRequestsQueue.has(t))throw new t8(t);let r=new l1;r.catch(e=>{this._eventEmitter.emit("error",e)});let n={payload:e,deferredPromise:r};if("connecting"===this.getStatus())return this._pendingRequestsQueue.set(t,n),n.deferredPromise;this._sentRequestsQueue.set(t,n);try{this._sendToSocket(n.payload)}catch(e){this._sentRequestsQueue.delete(t),this._eventEmitter.emit("error",e)}return r})}_onConnect(){this._connectionStatus="connected",this._reconnectAttempts=0,super._onConnect(),this._sendPendingRequests()}_sendPendingRequests(){for(let[e,t]of this._pendingRequestsQueue.entries())try{this._sendToSocket(t.payload),this._pendingRequestsQueue.delete(e),this._sentRequestsQueue.set(e,t)}catch(t){this._pendingRequestsQueue.delete(e),this._eventEmitter.emit("error",t)}}_onMessage(e){let t=this._parseResponses(e);if(!lt(t)&&0!==t.length)for(let e of t){if(lV(e)&&e.method.endsWith("_subscription"))return void this._eventEmitter.emit("message",e);let t=lQ(e)?e[0].id:e.id,r=this._sentRequestsQueue.get(t);if(!r)return;(lQ(e)||lq(e)||lz(e))&&(this._eventEmitter.emit("message",e),r.deferredPromise.resolve(e)),this._sentRequestsQueue.delete(t)}}clearQueues(e){this._clearQueues(e)}_clearQueues(e){this._pendingRequestsQueue.size>0&&this._pendingRequestsQueue.forEach((t,r)=>{t.deferredPromise.reject(new t4(e)),this._pendingRequestsQueue.delete(r)}),this._sentRequestsQueue.size>0&&this._sentRequestsQueue.forEach((t,r)=>{t.deferredPromise.reject(new t4(e)),this._sentRequestsQueue.delete(r)}),this._removeSocketListeners()}}class l9{constructor(){this._emitter=new aY}on(e,t){this._emitter.on(e,t)}once(e,t){this._emitter.once(e,t)}off(e,t){this._emitter.off(e,t)}emit(e,t){this._emitter.emit(e,t)}listenerCount(e){return this._emitter.listenerCount(e)}listeners(e){return this._emitter.listeners(e)}eventNames(){return this._emitter.eventNames()}removeAllListeners(){return this._emitter.removeAllListeners()}setMaxListenerWarningThreshold(e){this._emitter.setMaxListeners(e)}getMaxListeners(){return this._emitter.getMaxListeners()}}!function(e){e.CONFIG_CHANGE="CONFIG_CHANGE"}(D||(D={}));class ce extends l9{constructor(e){super(),this.config={handleRevert:!1,defaultAccount:void 0,defaultBlock:"latest",transactionBlockTimeout:50,transactionConfirmationBlocks:24,transactionPollingInterval:1e3,transactionPollingTimeout:75e4,transactionReceiptPollingInterval:void 0,transactionSendTimeout:75e4,transactionConfirmationPollingInterval:void 0,blockHeaderTimeout:10,maxListenersWarningThreshold:100,contractDataInputFill:"data",defaultNetworkId:void 0,defaultChain:"mainnet",defaultHardfork:"london",defaultCommon:void 0,defaultTransactionType:"0x2",defaultMaxPriorityFeePerGas:az(25e8),enableExperimentalFeatures:{useSubscriptionWhenCheckingBlockTimeout:!1,useRpcCallSpecification:!1},transactionBuilder:void 0,transactionTypeParser:void 0,customTransactionSchema:void 0,defaultReturnFormat:Z,ignoreGasPricing:!1},this.setConfig(null!=e?e:{})}setConfig(e){for(let t of Object.keys(e))this._triggerConfigChange(t,e[t]),lt(e[t])||"number"!=typeof e[t]||"maxListenersWarningThreshold"!==t||this.setMaxListenerWarningThreshold(Number(e[t]));Object.assign(this.config,e)}get handleRevert(){return this.config.handleRevert}set handleRevert(e){this._triggerConfigChange("handleRevert",e),this.config.handleRevert=e}get contractDataInputFill(){return this.config.contractDataInputFill}set contractDataInputFill(e){this._triggerConfigChange("contractDataInputFill",e),this.config.contractDataInputFill=e}get defaultAccount(){return this.config.defaultAccount}set defaultAccount(e){this._triggerConfigChange("defaultAccount",e),this.config.defaultAccount=e}get defaultBlock(){return this.config.defaultBlock}set defaultBlock(e){this._triggerConfigChange("defaultBlock",e),this.config.defaultBlock=e}get transactionSendTimeout(){return this.config.transactionSendTimeout}set transactionSendTimeout(e){this._triggerConfigChange("transactionSendTimeout",e),this.config.transactionSendTimeout=e}get transactionBlockTimeout(){return this.config.transactionBlockTimeout}set transactionBlockTimeout(e){this._triggerConfigChange("transactionBlockTimeout",e),this.config.transactionBlockTimeout=e}get transactionConfirmationBlocks(){return this.config.transactionConfirmationBlocks}set transactionConfirmationBlocks(e){this._triggerConfigChange("transactionConfirmationBlocks",e),this.config.transactionConfirmationBlocks=e}get transactionPollingInterval(){return this.config.transactionPollingInterval}set transactionPollingInterval(e){this._triggerConfigChange("transactionPollingInterval",e),this.config.transactionPollingInterval=e,this.transactionReceiptPollingInterval=e,this.transactionConfirmationPollingInterval=e}get transactionPollingTimeout(){return this.config.transactionPollingTimeout}set transactionPollingTimeout(e){this._triggerConfigChange("transactionPollingTimeout",e),this.config.transactionPollingTimeout=e}get transactionReceiptPollingInterval(){return this.config.transactionReceiptPollingInterval}set transactionReceiptPollingInterval(e){this._triggerConfigChange("transactionReceiptPollingInterval",e),this.config.transactionReceiptPollingInterval=e}get transactionConfirmationPollingInterval(){return this.config.transactionConfirmationPollingInterval}set transactionConfirmationPollingInterval(e){this._triggerConfigChange("transactionConfirmationPollingInterval",e),this.config.transactionConfirmationPollingInterval=e}get blockHeaderTimeout(){return this.config.blockHeaderTimeout}set blockHeaderTimeout(e){this._triggerConfigChange("blockHeaderTimeout",e),this.config.blockHeaderTimeout=e}get enableExperimentalFeatures(){return this.config.enableExperimentalFeatures}set enableExperimentalFeatures(e){this._triggerConfigChange("enableExperimentalFeatures",e),this.config.enableExperimentalFeatures=e}get maxListenersWarningThreshold(){return this.config.maxListenersWarningThreshold}set maxListenersWarningThreshold(e){this._triggerConfigChange("maxListenersWarningThreshold",e),this.setMaxListenerWarningThreshold(e),this.config.maxListenersWarningThreshold=e}get defaultReturnFormat(){return this.config.defaultReturnFormat}set defaultReturnFormat(e){this._triggerConfigChange("defaultReturnFormat",e),this.config.defaultReturnFormat=e}get defaultNetworkId(){return this.config.defaultNetworkId}set defaultNetworkId(e){this._triggerConfigChange("defaultNetworkId",e),this.config.defaultNetworkId=e}get defaultChain(){return this.config.defaultChain}set defaultChain(e){if(!lt(this.config.defaultCommon)&&!lt(this.config.defaultCommon.baseChain)&&e!==this.config.defaultCommon.baseChain)throw new nc(this.config.defaultChain,e);this._triggerConfigChange("defaultChain",e),this.config.defaultChain=e}get defaultHardfork(){return this.config.defaultHardfork}set defaultHardfork(e){if(!lt(this.config.defaultCommon)&&!lt(this.config.defaultCommon.hardfork)&&e!==this.config.defaultCommon.hardfork)throw new nl(this.config.defaultCommon.hardfork,e);this._triggerConfigChange("defaultHardfork",e),this.config.defaultHardfork=e}get defaultCommon(){return this.config.defaultCommon}set defaultCommon(e){if(!lt(this.config.defaultHardfork)&&!lt(e)&&!lt(e.hardfork)&&this.config.defaultHardfork!==e.hardfork)throw new nl(this.config.defaultHardfork,e.hardfork);if(!lt(this.config.defaultChain)&&!lt(e)&&!lt(e.baseChain)&&this.config.defaultChain!==e.baseChain)throw new nc(this.config.defaultChain,e.baseChain);this._triggerConfigChange("defaultCommon",e),this.config.defaultCommon=e}get ignoreGasPricing(){return this.config.ignoreGasPricing}set ignoreGasPricing(e){this._triggerConfigChange("ignoreGasPricing",e),this.config.ignoreGasPricing=e}get defaultTransactionType(){return this.config.defaultTransactionType}set defaultTransactionType(e){this._triggerConfigChange("defaultTransactionType",e),this.config.defaultTransactionType=e}get defaultMaxPriorityFeePerGas(){return this.config.defaultMaxPriorityFeePerGas}set defaultMaxPriorityFeePerGas(e){this._triggerConfigChange("defaultMaxPriorityFeePerGas",e),this.config.defaultMaxPriorityFeePerGas=e}get transactionBuilder(){return this.config.transactionBuilder}set transactionBuilder(e){this._triggerConfigChange("transactionBuilder",e),this.config.transactionBuilder=e}get transactionTypeParser(){return this.config.transactionTypeParser}set transactionTypeParser(e){this._triggerConfigChange("transactionTypeParser",e),this.config.transactionTypeParser=e}get customTransactionSchema(){return this.config.customTransactionSchema}set customTransactionSchema(e){this._triggerConfigChange("customTransactionSchema",e),this.config.customTransactionSchema=e}_triggerConfigChange(e,t){this.emit(D.CONFIG_CHANGE,{name:e,oldValue:this.config[e],newValue:t})}}var ct=r(95120),cr=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class cn extends er{constructor(e,t){if(super(),!cn.validateClientUrl(e))throw new rf(e);this.clientUrl=e,this.httpProviderOptions=t}static validateClientUrl(e){return"string"==typeof e&&/^http(s)?:\/\//i.test(e)}getStatus(){throw new ra}supportsSubscriptions(){return!1}request(e,t){var r;return cr(this,void 0,void 0,function*(){let n=Object.assign(Object.assign({},null==(r=this.httpProviderOptions)?void 0:r.providerOptions),t),i=yield ct(this.clientUrl,Object.assign(Object.assign({},n),{method:"POST",headers:Object.assign(Object.assign({},n.headers),{"Content-Type":"application/json"}),body:JSON.stringify(e)}));if(!i.ok)throw new no((yield i.json()),void 0,void 0,i.status);return yield i.json()})}on(){throw new ra}removeListener(){throw new ra}once(){throw new ra}removeAllListeners(){throw new ra}connect(){throw new ra}disconnect(){throw new ra}reset(){throw new ra}reconnect(){throw new ra}}var ci=null;"undefined"!=typeof WebSocket?ci=WebSocket:"undefined"!=typeof MozWebSocket?ci=MozWebSocket:void 0!==r.g?ci=r.g.WebSocket||r.g.MozWebSocket:"undefined"!=typeof window?ci=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(ci=self.WebSocket||self.MozWebSocket);let cs=ci;class co extends l7{constructor(e,t,r){super(e,t,r)}_validateProviderPath(e){return"string"==typeof e&&/^ws(s)?:\/\//i.test(e)}getStatus(){if(this._socketConnection&&!lt(this._socketConnection))switch(this._socketConnection.readyState){case this._socketConnection.CONNECTING:return"connecting";case this._socketConnection.OPEN:return"connected"}return"disconnected"}_openSocketConnection(){this._socketConnection=new cs(this._socketPath,void 0,this._socketOptions&&0===Object.keys(this._socketOptions).length?void 0:this._socketOptions)}_closeSocketConnection(e,t){var r;null==(r=this._socketConnection)||r.close(e,t)}_sendToSocket(e){var t;if("disconnected"===this.getStatus())throw new t4;null==(t=this._socketConnection)||t.send(JSON.stringify(e))}_parseResponses(e){return this.chunkResponseParser.parseResponse(e.data)}_addSocketListeners(){var e,t,r,n;null==(e=this._socketConnection)||e.addEventListener("open",this._onOpenHandler),null==(t=this._socketConnection)||t.addEventListener("message",this._onMessageHandler),null==(r=this._socketConnection)||r.addEventListener("close",e=>this._onCloseHandler(e)),null==(n=this._socketConnection)||n.addEventListener("error",this._onErrorHandler)}_removeSocketListeners(){var e,t,r;null==(e=this._socketConnection)||e.removeEventListener("message",this._onMessageHandler),null==(t=this._socketConnection)||t.removeEventListener("open",this._onOpenHandler),null==(r=this._socketConnection)||r.removeEventListener("close",this._onCloseHandler)}_onCloseEvent(e){var t;if(this._reconnectOptions.autoReconnect&&(![1e3,1001].includes(e.code)||!e.wasClean))return void this._reconnect();this._clearQueues(e),this._removeSocketListeners(),this._onDisconnect(e.code,e.reason),null==(t=this._socketConnection)||t.removeEventListener("error",this._onErrorHandler)}}let ca=e=>er.isWeb3Provider(e),cl=e=>"string"!=typeof e&&"request"in e&&"Function"===e.request.constructor.name,cc=e=>"string"!=typeof e&&"request"in e&&"AsyncFunction"===e.request.constructor.name,cu=e=>"string"!=typeof e&&"send"in e,cd=e=>"string"!=typeof e&&"sendAsync"in e,ch=e=>e&&(ca(e)||cc(e)||cl(e)||cd(e)||cu(e)),cf=e=>e&&"supportsSubscriptions"in e?e.supportsSubscriptions():!!e&&"string"!=typeof e&&"on"in e;var cp=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};!function(e){e.PROVIDER_CHANGED="PROVIDER_CHANGED",e.BEFORE_PROVIDER_CHANGE="BEFORE_PROVIDER_CHANGE"}(N||(N={}));let cg={HttpProvider:cn,WebsocketProvider:co};class cm extends l9{constructor(e,t,r){super(),lt(e)||this.setProvider(e),this.useRpcCallSpecification=t,lt(r)||(this.middleware=r)}static get providers(){return cg}get provider(){return this._provider}get providers(){return cg}setProvider(e){let t;if(e&&"string"==typeof e&&this.providers)if(/^http(s)?:\/\//i.test(e))t=new this.providers.HttpProvider(e);else if(/^ws(s)?:\/\//i.test(e))t=new this.providers.WebsocketProvider(e);else throw new rh(`Can't autodetect provider for "${e}"`);else t=lt(e)?void 0:e;return this.emit(N.BEFORE_PROVIDER_CHANGE,this._provider),this._provider=t,this.emit(N.PROVIDER_CHANGED,this._provider),!0}setMiddleware(e){this.middleware=e}send(e){return cp(this,void 0,void 0,function*(){let t=Object.assign({},e),r=yield this._sendRequest(t);if(lt(this.middleware)||(r=yield this.middleware.processResponse(r)),lq(r))return r.result;throw new no(r)})}sendBatch(e){return cp(this,void 0,void 0,function*(){return yield this._sendRequest(e)})}_sendRequest(e){return cp(this,void 0,void 0,function*(){let{provider:t}=this;if(lt(t))throw new rh("Provider not available. Use `.setProvider` or `.provider=` to initialize the provider.");let r=lX(e)?lY(e):lZ(e);if(lt(this.middleware)||(r=yield this.middleware.processRequest(r)),ca(t)){let e;try{e=yield t.request(r)}catch(t){e=t}return this._processJsonRpcResponse(r,e,{legacy:!1,error:!1})}if(cc(t))return t.request(r).then(e=>this._processJsonRpcResponse(r,e,{legacy:!0,error:!1})).catch(e=>this._processJsonRpcResponse(r,e,{legacy:!0,error:!0}));if(cl(t))return new Promise((e,n)=>{let i=e=>{n(this._processJsonRpcResponse(r,e,{legacy:!0,error:!0}))},s=t=>e(this._processJsonRpcResponse(r,t,{legacy:!0,error:!1})),o=t.request(r,(e,t)=>e?i(e):s(t));lB(o)&&o.then(s).catch(e=>{try{let t=this._processJsonRpcResponse(r,e,{legacy:!0,error:!0});n(t)}catch(e){n(e)}})});if(cu(t))return new Promise((e,n)=>{t.send(r,(t,i)=>{if(t)return n(this._processJsonRpcResponse(r,t,{legacy:!0,error:!0}));if(lt(i))throw new no({},'Got a "nullish" response from provider.');return e(this._processJsonRpcResponse(r,i,{legacy:!0,error:!1}))})});if(cd(t))return t.sendAsync(r).then(e=>this._processJsonRpcResponse(r,e,{legacy:!0,error:!1})).catch(e=>this._processJsonRpcResponse(r,e,{legacy:!0,error:!0}));throw new rh("Provider does not have a request or send method to use.")})}_processJsonRpcResponse(e,t,{legacy:r,error:n}){if(lt(t))return this._buildResponse(e,null,n);if(lz(t)){if(this.useRpcCallSpecification&&l$(t)){let e=t;if(n_.get(e.error.code))throw new(n_.get(e.error.code)).error(e);throw new nh(e)}else if(!cm._isReverted(t))throw new na(t,e)}if(lq(t))return t;if(t instanceof Error)throw cm._isReverted(t),t;if(!r&&lX(e)&&lQ(t)||r&&!n&&lX(e))return t;if(r&&n&&lX(e))throw t;if(r&&!lz(t)&&!lq(t))return this._buildResponse(e,t,n);if(lX(e)&&!Array.isArray(t))throw new no(t,"Got normal response for a batch request.");if(!lX(e)&&Array.isArray(t))throw new no(t,"Got batch response for a normal request.");throw new no(t,"Invalid response")}static _isReverted(e){let t;if(lz(e)?t=e.error:e instanceof Error&&(t=e),null==t?void 0:t.message.includes("revert"))throw new rt(t);return!1}_buildResponse(e,t,r){let n={jsonrpc:"2.0",id:lX(e)?e[0].id:"id"in e?e.id:null};return r?Object.assign(Object.assign({},n),{error:t}):Object.assign(Object.assign({},n),{result:t})}}var cy=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class cb{constructor(e,t,r=!1){this.requestManager=e,this.registeredSubscriptions=t,this.tolerateUnlinkedSubscription=r,this._subscriptions=new Map,this.requestManager.on(N.BEFORE_PROVIDER_CHANGE,()=>cy(this,void 0,void 0,function*(){yield this.unsubscribe()})),this.requestManager.on(N.PROVIDER_CHANGED,()=>{this.clear(),this.listenToProviderEvents()}),this.listenToProviderEvents()}listenToProviderEvents(){let e=this.requestManager.provider;this.requestManager.provider&&("function"!=typeof(null==e?void 0:e.supportsSubscriptions)||(null==e?void 0:e.supportsSubscriptions()))&&"function"==typeof this.requestManager.provider.on&&("function"==typeof this.requestManager.provider.request?this.requestManager.provider.on("message",e=>this.messageListener(e)):e.on("data",e=>this.messageListener(e)))}messageListener(e){var t,r,n;if(!e)throw new rp("Should not call messageListener with no data. Type was");let i=(null==(t=e.params)?void 0:t.subscription)||(null==(r=e.data)?void 0:r.subscription)||(null==(n=e.id)?void 0:n.toString(16));if(i){let t=this._subscriptions.get(i);null==t||t.processSubscriptionData(e)}}subscribe(e,t){return cy(this,arguments,void 0,function*(e,t,r=Z){let n=this.registeredSubscriptions[e];if(!n)throw new rp("Invalid subscription type");let i=new n(null!=t?t:void 0,{subscriptionManager:this,returnFormat:r});return yield this.addSubscription(i),i})}get subscriptions(){return this._subscriptions}addSubscription(e){return cy(this,void 0,void 0,function*(){if(!this.requestManager.provider)throw new rh("Provider not available");if(!this.supportsSubscriptions())throw new rp("The current provider does not support subscriptions");if(e.id&&this._subscriptions.has(e.id))throw new rp(`Subscription with id "${e.id}" already exists`);if(yield e.sendSubscriptionRequest(),lt(e.id))throw new rp("Subscription is not subscribed yet.");return this._subscriptions.set(e.id,e),e.id})}removeSubscription(e){return cy(this,void 0,void 0,function*(){let{id:t}=e;if(lt(t))throw new rp("Subscription is not subscribed yet. Or, had already been unsubscribed but not through the Subscription Manager.");if(!this._subscriptions.has(t)&&!this.tolerateUnlinkedSubscription)throw new rp(`Subscription with id "${t.toString()}" does not exists`);return yield e.sendUnsubscribeRequest(),this._subscriptions.delete(t),t})}unsubscribe(e){return cy(this,void 0,void 0,function*(){let t=[];for(let[r,n]of this.subscriptions.entries())(!e||"function"==typeof e&&e({id:r,sub:n}))&&t.push(this.removeSubscription(n));return Promise.all(t)})}clear(){this._subscriptions.clear()}supportsSubscriptions(){return!lt(this.requestManager.provider)&&cf(this.requestManager.provider)}}var cw=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class cv extends l9{constructor(e,t){var r;super(),this.args=e;let{requestManager:n}=t,{subscriptionManager:i}=t;n?this._subscriptionManager=new cb(n,{},!0):this._subscriptionManager=i,this._returnFormat=null!=(r=null==t?void 0:t.returnFormat)?r:Z}get id(){return this._id}get lastBlock(){return this._lastBlock}subscribe(){return cw(this,void 0,void 0,function*(){return this._subscriptionManager.addSubscription(this)})}processSubscriptionData(e){var t,r;(null==e?void 0:e.data)?this._processSubscriptionResult(null!=(r=null==(t=null==e?void 0:e.data)?void 0:t.result)?r:null==e?void 0:e.data):e&&lV(e)&&this._processSubscriptionResult(null==e?void 0:e.params.result)}sendSubscriptionRequest(){return cw(this,void 0,void 0,function*(){return this._id=yield this._subscriptionManager.requestManager.send({method:"eth_subscribe",params:this._buildSubscriptionParams()}),this.emit("connected",this._id),this._id})}get returnFormat(){return this._returnFormat}get subscriptionManager(){return this._subscriptionManager}resubscribe(){return cw(this,void 0,void 0,function*(){yield this.unsubscribe(),yield this.subscribe()})}unsubscribe(){return cw(this,void 0,void 0,function*(){this.id&&(yield this._subscriptionManager.removeSubscription(this))})}sendUnsubscribeRequest(){return cw(this,void 0,void 0,function*(){yield this._subscriptionManager.requestManager.send({method:"eth_unsubscribe",params:[this.id]}),this._id=void 0})}formatSubscriptionResult(e){return e}_processSubscriptionResult(e){this.emit("data",this.formatSubscriptionResult(e))}_processSubscriptionError(e){this.emit("error",e)}_buildSubscriptionParams(){throw Error("Implement in the child class")}}var cE=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class cA extends en{constructor(){super(...arguments),this._addressMap=new Map,this._defaultKeyName="web3js_wallet"}static getStorage(){let e;try{e=window.localStorage;let t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch(t){return t&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&!al(e)&&0!==e.length?e:void 0}}create(e){for(let t=0;t<e;t+=1)this.add(this._accountProvider.create());return this}add(e){var t;if("string"==typeof e)return this.add(this._accountProvider.privateKeyToAccount(e));let r=this.length;return this.get(e.address)&&(console.warn(`Account ${e.address.toLowerCase()} already exists.`),r=null!=(t=this._addressMap.get(e.address.toLowerCase()))?t:r),this._addressMap.set(e.address.toLowerCase(),r),this[r]=e,this}get(e){if("string"==typeof e){let t=this._addressMap.get(e.toLowerCase());return al(t)?void 0:this[t]}return this[e]}remove(e){if("string"==typeof e){let t=this._addressMap.get(e.toLowerCase());return!al(t)&&(this._addressMap.delete(e.toLowerCase()),this.splice(t,1),!0)}return!!this[e]&&(this.splice(e,1),!0)}clear(){return this._addressMap.clear(),this.length=0,this}encrypt(e,t){return cE(this,void 0,void 0,function*(){return Promise.all(this.map(r=>cE(this,void 0,void 0,function*(){return r.encrypt(e,t)})))})}decrypt(e,t,r){return cE(this,void 0,void 0,function*(){for(let n of yield Promise.all(e.map(e=>cE(this,void 0,void 0,function*(){return this._accountProvider.decrypt(e,t,r)}))))this.add(n);return this})}save(e,t){return cE(this,void 0,void 0,function*(){let r=cA.getStorage();if(!r)throw Error("Local storage not available.");return r.setItem(null!=t?t:this._defaultKeyName,JSON.stringify((yield this.encrypt(e)))),!0})}load(e,t){return cE(this,void 0,void 0,function*(){let r=cA.getStorage();if(!r)throw Error("Local storage not available.");let n=r.getItem(null!=t?t:this._defaultKeyName);return n&&(yield this.decrypt(JSON.parse(n)||[],e)),this})}}let cx={web:nz};function cS(e,t,r){if(!r.startsWith("aes-"))throw Error(`AES submodule doesn't support mode ${r}`);if(16!==t.length)throw Error("AES: wrong IV length");if(r.startsWith("aes-128")&&16!==e.length||r.startsWith("aes-256")&&32!==e.length)throw Error("AES: wrong key length")}async function ck(e,t,r){let n;if(!cx.web)throw Error("Browser crypto not available.");if(["aes-128-cbc","aes-256-cbc"].includes(e)&&(n="cbc"),["aes-128-ctr","aes-256-ctr"].includes(e)&&(n="ctr"),!n)throw Error("AES: unsupported mode");return[await cx.web.subtle.importKey("raw",t,{name:`AES-${n.toUpperCase()}`,length:8*t.length},!0,["encrypt","decrypt"]),{name:`aes-${n}`,iv:r,counter:r,length:128}]}async function c_(e,t,r,n="aes-128-ctr",i=!0){if(cS(t,r,n),cx.web){let[s,o]=await ck(n,t,r),a=new Uint8Array(await cx.web.subtle.encrypt(o,s,e));return i||"aes-cbc"!==o.name||e.length%16||(a=a.slice(0,-16)),a}if(cx.node){let s=cx.node.createCipheriv(n,t,r);return s.setAutoPadding(i),n1(s.update(e),s.final())}throw Error("The environment doesn't have AES module")}async function cI(e,t,r,n){let i=e.slice(-16);for(let e=0;e<16;e++)i[e]^=16^r[e];return(await c_(i,t,r,n)).slice(0,16)}async function cT(e,t,r,n="aes-128-ctr",i=!0){if(cS(t,r,n),cx.web){let[s,o]=await ck(n,t,r);if(!i&&"aes-cbc"===o.name){let i=await cI(e,t,r,n);e=n1(e,i)}let a=new Uint8Array(await cx.web.subtle.decrypt(o,s,e));if("aes-cbc"===o.name&&!iE(await c_(a,t,r,n),e))throw Error("AES: wrong padding");return a}if(cx.node){let s=cx.node.createDecipheriv(n,t,r);return s.setAutoPadding(i),n1(s.update(e),s.final())}throw Error("The environment doesn't have AES module")}class cC extends n2{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,nR(e);let r=n0(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let n=this.blockLen,i=new Uint8Array(n);i.set(r.length>n?e.create().update(r).digest():r);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return nD(this),this.iHash.update(e),this}digestInto(e){nD(this),nP(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:r,finished:n,destroyed:i,blockLen:s,outputLen:o}=this;return e.finished=n,e.destroyed=i,e.blockLen=s,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let cP=(e,t,r)=>new cC(e,t).update(r).digest();function cR(e,t,r,n){nR(e);let{c:i,dkLen:s,asyncTick:o}=n4({dkLen:32,asyncTick:10},n);if(nT(i),nT(s),nT(o),i<1)throw Error("PBKDF2: iterations (c) should be >= 1");let a=n0(t),l=n0(r),c=new Uint8Array(s),u=cP.create(e,a),d=u._cloneInto().update(l);return{c:i,dkLen:s,asyncTick:o,DK:c,PRF:u,PRFSalt:d}}function cD(e,t,r,n,i){return e.destroy(),t.destroy(),n&&n.destroy(),i.fill(0),r}function cN(e,t,r,n){let i,{c:s,dkLen:o,DK:a,PRF:l,PRFSalt:c}=cR(e,t,r,n),u=new Uint8Array(4),d=nG(u),h=new Uint8Array(l.outputLen);for(let e=1,t=0;t<o;e++,t+=l.outputLen){let r=a.subarray(t,t+l.outputLen);d.setInt32(0,e,!1),(i=c._cloneInto(i)).update(u).digestInto(h),r.set(h.subarray(0,r.length));for(let e=1;e<s;e++){l._cloneInto(i).update(h).digestInto(h);for(let e=0;e<r.length;e++)r[e]^=h[e]}}return cD(l,c,a,i,h)}function cM(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);let i=BigInt(32),s=BigInt(0xffffffff),o=Number(r>>i&s),a=Number(r&s),l=4*!!n,c=4*!n;e.setUint32(t+l,o,n),e.setUint32(t+c,a,n)}cP.create=(e,t)=>new cC(e,t);let cB=(e,t,r)=>e&t^~e&r,cO=(e,t,r)=>e&t^e&r^t&r;class cL extends n2{constructor(e,t,r,n){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=nG(this.buffer)}update(e){nD(this);let{view:t,buffer:r,blockLen:n}=this,i=(e=n0(e)).length;for(let s=0;s<i;){let o=Math.min(n-this.pos,i-s);if(o===n){let t=nG(e);for(;n<=i-s;s+=n)this.process(t,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){nD(this),nN(e,this),this.finished=!0;let{buffer:t,view:r,blockLen:n,isLE:i}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>n-s&&(this.process(r,0),s=0);for(let e=s;e<n;e++)t[e]=0;cM(r,n-8,BigInt(8*this.length),i),this.process(r,0);let o=nG(e),a=this.outputLen;if(a%4)throw Error("_sha2: outputLen should be aligned to 32bit");let l=a/4,c=this.get();if(l>c.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<l;e++)o.setUint32(4*e,c[e],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:n,finished:i,destroyed:s,pos:o}=this;return e.length=n,e.pos=o,e.finished=i,e.destroyed=s,n%t&&e.buffer.set(r),e}}let cF=new Uint32Array([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),cU=new Uint32Array([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),cj=new Uint32Array(64);class cH extends cL{constructor(){super(64,32,8,!1),this.A=0|cU[0],this.B=0|cU[1],this.C=0|cU[2],this.D=0|cU[3],this.E=0|cU[4],this.F=0|cU[5],this.G=0|cU[6],this.H=0|cU[7]}get(){let{A:e,B:t,C:r,D:n,E:i,F:s,G:o,H:a}=this;return[e,t,r,n,i,s,o,a]}set(e,t,r,n,i,s,o,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)cj[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=cj[e-15],r=cj[e-2],n=nK(t,7)^nK(t,18)^t>>>3,i=nK(r,17)^nK(r,19)^r>>>10;cj[e]=i+cj[e-7]+n+cj[e-16]|0}let{A:r,B:n,C:i,D:s,E:o,F:a,G:l,H:c}=this;for(let e=0;e<64;e++){let t=c+(nK(o,6)^nK(o,11)^nK(o,25))+cB(o,a,l)+cF[e]+cj[e]|0,u=(nK(r,2)^nK(r,13)^nK(r,22))+cO(r,n,i)|0;c=l,l=a,a=o,o=s+t|0,s=i,i=n,n=r,r=t+u|0}r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(r,n,i,s,o,a,l,c)}roundClean(){cj.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}let c$=n5(()=>new cH),[cq,cz]=nq.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),cV=new Uint32Array(80),cG=new Uint32Array(80);class cK extends cL{constructor(){super(128,64,16,!1),this.Ah=0x6a09e667,this.Al=-0xc4336f8,this.Bh=-0x4498517b,this.Bl=-0x7b3558c5,this.Ch=0x3c6ef372,this.Cl=-0x16b07d5,this.Dh=-0x5ab00ac6,this.Dl=0x5f1d36f1,this.Eh=0x510e527f,this.El=-0x52197d2f,this.Fh=-0x64fa9774,this.Fl=0x2b3e6c1f,this.Gh=0x1f83d9ab,this.Gl=-0x4be4295,this.Hh=0x5be0cd19,this.Hl=0x137e2179}get(){let{Ah:e,Al:t,Bh:r,Bl:n,Ch:i,Cl:s,Dh:o,Dl:a,Eh:l,El:c,Fh:u,Fl:d,Gh:h,Gl:f,Hh:p,Hl:g}=this;return[e,t,r,n,i,s,o,a,l,c,u,d,h,f,p,g]}set(e,t,r,n,i,s,o,a,l,c,u,d,h,f,p,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|n,this.Ch=0|i,this.Cl=0|s,this.Dh=0|o,this.Dl=0|a,this.Eh=0|l,this.El=0|c,this.Fh=0|u,this.Fl=0|d,this.Gh=0|h,this.Gl=0|f,this.Hh=0|p,this.Hl=0|g}process(e,t){for(let r=0;r<16;r++,t+=4)cV[r]=e.getUint32(t),cG[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){let t=0|cV[e-15],r=0|cG[e-15],n=nq.rotrSH(t,r,1)^nq.rotrSH(t,r,8)^nq.shrSH(t,r,7),i=nq.rotrSL(t,r,1)^nq.rotrSL(t,r,8)^nq.shrSL(t,r,7),s=0|cV[e-2],o=0|cG[e-2],a=nq.rotrSH(s,o,19)^nq.rotrBH(s,o,61)^nq.shrSH(s,o,6),l=nq.rotrSL(s,o,19)^nq.rotrBL(s,o,61)^nq.shrSL(s,o,6),c=nq.add4L(i,l,cG[e-7],cG[e-16]),u=nq.add4H(c,n,a,cV[e-7],cV[e-16]);cV[e]=0|u,cG[e]=0|c}let{Ah:r,Al:n,Bh:i,Bl:s,Ch:o,Cl:a,Dh:l,Dl:c,Eh:u,El:d,Fh:h,Fl:f,Gh:p,Gl:g,Hh:m,Hl:y}=this;for(let e=0;e<80;e++){let t=nq.rotrSH(u,d,14)^nq.rotrSH(u,d,18)^nq.rotrBH(u,d,41),b=nq.rotrSL(u,d,14)^nq.rotrSL(u,d,18)^nq.rotrBL(u,d,41),w=u&h^~u&p,v=d&f^~d&g,E=nq.add5L(y,b,v,cz[e],cG[e]),A=nq.add5H(E,m,t,w,cq[e],cV[e]),x=0|E,S=nq.rotrSH(r,n,28)^nq.rotrBH(r,n,34)^nq.rotrBH(r,n,39),k=nq.rotrSL(r,n,28)^nq.rotrBL(r,n,34)^nq.rotrBL(r,n,39),_=r&i^r&o^i&o,I=n&s^n&a^s&a;m=0|p,y=0|g,p=0|h,g=0|f,h=0|u,f=0|d,({h:u,l:d}=nq.add(0|l,0|c,0|A,0|x)),l=0|o,c=0|a,o=0|i,a=0|s,i=0|r,s=0|n;let T=nq.add3L(x,k,I);r=nq.add3H(T,A,S,_),n=0|T}({h:r,l:n}=nq.add(0|this.Ah,0|this.Al,0|r,0|n)),({h:i,l:s}=nq.add(0|this.Bh,0|this.Bl,0|i,0|s)),({h:o,l:a}=nq.add(0|this.Ch,0|this.Cl,0|o,0|a)),({h:l,l:c}=nq.add(0|this.Dh,0|this.Dl,0|l,0|c)),({h:u,l:d}=nq.add(0|this.Eh,0|this.El,0|u,0|d)),({h:h,l:f}=nq.add(0|this.Fh,0|this.Fl,0|h,0|f)),({h:p,l:g}=nq.add(0|this.Gh,0|this.Gl,0|p,0|g)),({h:m,l:y}=nq.add(0|this.Hh,0|this.Hl,0|m,0|y)),this.set(r,n,i,s,o,a,l,c,u,d,h,f,p,g,m,y)}roundClean(){cV.fill(0),cG.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let cW=n5(()=>new cK);function cQ(e,t,r,n,i){if(!["sha256","sha512"].includes(i))throw Error("Only sha256 and sha512 are supported");return iw(e),iw(t),cN("sha256"===i?c$:cW,e,t,{c:r,dkLen:n})}function cJ(e,t,r,n,i,s){let o=e[t++]^r[n++],a=e[t++]^r[n++],l=e[t++]^r[n++],c=e[t++]^r[n++],u=e[t++]^r[n++],d=e[t++]^r[n++],h=e[t++]^r[n++],f=e[t++]^r[n++],p=e[t++]^r[n++],g=e[t++]^r[n++],m=e[t++]^r[n++],y=e[t++]^r[n++],b=e[t++]^r[n++],w=e[t++]^r[n++],v=e[t++]^r[n++],E=e[t++]^r[n++],A=o,x=a,S=l,k=c,_=u,I=d,T=h,C=f,P=p,R=g,D=m,N=y,M=b,B=w,O=v,L=E;for(let e=0;e<8;e+=2)_^=nW(A+M|0,7),P^=nW(_+A|0,9),M^=nW(P+_|0,13),A^=nW(M+P|0,18),R^=nW(I+x|0,7),B^=nW(R+I|0,9),x^=nW(B+R|0,13),I^=nW(x+B|0,18),O^=nW(D+T|0,7),S^=nW(O+D|0,9),T^=nW(S+O|0,13),D^=nW(T+S|0,18),k^=nW(L+N|0,7),C^=nW(k+L|0,9),N^=nW(C+k|0,13),L^=nW(N+C|0,18),x^=nW(A+k|0,7),S^=nW(x+A|0,9),k^=nW(S+x|0,13),A^=nW(k+S|0,18),T^=nW(I+_|0,7),C^=nW(T+I|0,9),_^=nW(C+T|0,13),I^=nW(_+C|0,18),N^=nW(D+R|0,7),P^=nW(N+D|0,9),R^=nW(P+N|0,13),D^=nW(R+P|0,18),M^=nW(L+O|0,7),B^=nW(M+L|0,9),O^=nW(B+M|0,13),L^=nW(O+B|0,18);i[s++]=o+A|0,i[s++]=a+x|0,i[s++]=l+S|0,i[s++]=c+k|0,i[s++]=u+_|0,i[s++]=d+I|0,i[s++]=h+T|0,i[s++]=f+C|0,i[s++]=p+P|0,i[s++]=g+R|0,i[s++]=m+D|0,i[s++]=y+N|0,i[s++]=b+M|0,i[s++]=w+B|0,i[s++]=v+O|0,i[s++]=E+L|0}function cZ(e,t,r,n,i){let s=n+0,o=n+16*i;for(let n=0;n<16;n++)r[o+n]=e[t+(2*i-1)*16+n];for(let n=0;n<i;n++,s+=16,t+=16)cJ(r,o,e,t,r,s),n>0&&(o+=16),cJ(r,s,e,t+=16,r,o)}function cY(e,t,r){let{N:n,r:i,p:s,dkLen:o,asyncTick:a,maxmem:l,onProgress:c}=n4({dkLen:32,asyncTick:10,maxmem:0x40000400},r);if(nT(n),nT(i),nT(s),nT(o),nT(a),nT(l),void 0!==c&&"function"!=typeof c)throw Error("progressCb should be function");let u=128*i,d=u/4;if(n<=1||(n&n-1)!=0||n>=2**(u/8)||n>0x100000000)throw Error("Scrypt: N must be larger than 1, a power of 2, less than 2^(128 * r / 8) and less than 2^32");if(s<0||s>(0x100000000-1)*32/u)throw Error("Scrypt: p must be a positive integer less than or equal to ((2^32 - 1) * 32) / (128 * r)");if(o<0||o>(0x100000000-1)*32)throw Error("Scrypt: dkLen should be positive integer less than or equal to (2^32 - 1) * 32");let h=u*(n+s);if(h>l)throw Error(`Scrypt: parameters too large, ${h} (128 * r * (N + p)) > ${l} (maxmem)`);let f=cN(c$,e,t,{c:1,dkLen:u*s}),p=nV(f),g=nV(new Uint8Array(u*n)),m=nV(new Uint8Array(u)),y=()=>{};if(c){let e=2*n*s,t=Math.max(Math.floor(e/1e4),1),r=0;y=()=>{r++,c&&(!(r%t)||r===e)&&c(r/e)}}return{N:n,r:i,p:s,dkLen:o,blockSize32:d,V:g,B32:p,B:f,tmp:m,blockMixCb:y,asyncTick:a}}function cX(e,t,r,n,i){let s=cN(c$,e,r,{c:1,dkLen:t});return r.fill(0),n.fill(0),i.fill(0),s}function c0(e,t,r){let{N:n,r:i,p:s,dkLen:o,blockSize32:a,V:l,B32:c,B:u,tmp:d,blockMixCb:h}=cY(e,t,r);nQ||nZ(c);for(let e=0;e<s;e++){let t=a*e;for(let e=0;e<a;e++)l[e]=c[t+e];for(let e=0,t=0;e<n-1;e++)cZ(l,t,l,t+=a,i),h();cZ(l,(n-1)*a,c,t,i),h();for(let e=0;e<n;e++){let e=c[t+a-16]%n;for(let r=0;r<a;r++)d[r]=c[t+r]^l[e*a+r];cZ(d,0,c,t,i),h()}}return nQ||nZ(c),cX(e,o,u,l,d)}function c1(e,t,r,n,i,s,o){return iw(e),iw(t),c0(e,t,{N:r,r:i,p:n,dkLen:s,onProgress:o})}let c2=BigInt(1),c3=BigInt(2);function c4(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function c5(e){if(!c4(e))throw Error("Uint8Array expected")}let c6=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function c8(e){c5(e);let t="";for(let r=0;r<e.length;r++)t+=c6[e[r]];return t}function c7(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}let c9={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function ue(e){return e>=c9._0&&e<=c9._9?e-c9._0:e>=c9._A&&e<=c9._F?e-(c9._A-10):e>=c9._a&&e<=c9._f?e-(c9._a-10):void 0}function ut(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);let t=e.length,r=t/2;if(t%2)throw Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let t=0,i=0;t<r;t++,i+=2){let r=ue(e.charCodeAt(i)),s=ue(e.charCodeAt(i+1));if(void 0===r||void 0===s)throw Error('hex string expected, got non-hex character "'+(e[i]+e[i+1])+'" at index '+i);n[t]=16*r+s}return n}function ur(e){return c7(c8(e))}function un(e){return c5(e),c7(c8(Uint8Array.from(e).reverse()))}function ui(e,t){return ut(e.toString(16).padStart(2*t,"0"))}function us(e,t){return ui(e,t).reverse()}function uo(e,t,r){let n;if("string"==typeof t)try{n=ut(t)}catch(r){throw Error(`${e} must be valid hex string, got "${t}". Cause: ${r}`)}else if(c4(t))n=Uint8Array.from(t);else throw Error(`${e} must be hex string or Uint8Array`);let i=n.length;if("number"==typeof r&&i!==r)throw Error(`${e} expected ${r} bytes, got ${i}`);return n}function ua(...e){let t=0;for(let r=0;r<e.length;r++){let n=e[r];c5(n),t+=n.length}let r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){let i=e[t];r.set(i,n),n+=i.length}return r}let ul=e=>(c3<<BigInt(e-1))-c2,uc=e=>new Uint8Array(e),uu=e=>Uint8Array.from(e);function ud(e,t,r){if("number"!=typeof e||e<2)throw Error("hashLen must be a number");if("number"!=typeof t||t<2)throw Error("qByteLen must be a number");if("function"!=typeof r)throw Error("hmacFn must be a function");let n=uc(e),i=uc(e),s=0,o=()=>{n.fill(1),i.fill(0),s=0},a=(...e)=>r(i,n,...e),l=(e=uc())=>{i=a(uu([0]),e),n=a(),0!==e.length&&(i=a(uu([1]),e),n=a())},c=()=>{if(s++>=1e3)throw Error("drbg: tried 1000 values");let e=0,r=[];for(;e<t;){let t=(n=a()).slice();r.push(t),e+=n.length}return ua(...r)};return(e,t)=>{let r;for(o(),l(e);!(r=t(c()));)l();return o(),r}}let uh={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||c4(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function uf(e,t,r={}){let n=(t,r,n)=>{let i=uh[r];if("function"!=typeof i)throw Error(`Invalid validator "${r}", expected function`);let s=e[t];if((!n||void 0!==s)&&!i(s,e))throw Error(`Invalid param ${String(t)}=${s} (${typeof s}), expected ${r}`)};for(let[e,r]of Object.entries(t))n(e,r,!1);for(let[e,t]of Object.entries(r))n(e,t,!0);return e}let up=BigInt(0),ug=BigInt(1),um=BigInt(2),uy=BigInt(3),ub=BigInt(4),uw=BigInt(5),uv=BigInt(8);function uE(e,t){let r=e%t;return r>=up?r:t+r}function uA(e,t,r){if(r<=up||t<up)throw Error("Expected power/modulo > 0");if(r===ug)return up;let n=ug;for(;t>up;)t&ug&&(n=n*e%r),e=e*e%r,t>>=ug;return n}function ux(e,t,r){let n=e;for(;t-- >up;)n*=n,n%=r;return n}function uS(e,t){if(e===up||t<=up)throw Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=uE(e,t),n=t,i=up,s=ug,o=ug,a=up;for(;r!==up;){let e=n/r,t=n%r,l=i-o*e,c=s-a*e;n=r,r=t,i=o,s=a,o=l,a=c}if(n!==ug)throw Error("invert: does not exist");return uE(i,t)}function uk(e){let t,r,n,i=(e-ug)/um;for(t=e-ug,r=0;t%um===up;t/=um,r++);for(n=um;n<e&&uA(n,i,e)!==e-ug;n++);if(1===r){let t=(e+ug)/ub;return function(e,r){let n=e.pow(r,t);if(!e.eql(e.sqr(n),r))throw Error("Cannot find square root");return n}}let s=(t+ug)/um;return function(e,o){if(e.pow(o,i)===e.neg(e.ONE))throw Error("Cannot find square root");let a=r,l=e.pow(e.mul(e.ONE,n),t),c=e.pow(o,s),u=e.pow(o,t);for(;!e.eql(u,e.ONE);){if(e.eql(u,e.ZERO))return e.ZERO;let t=1;for(let r=e.sqr(u);t<a&&!e.eql(r,e.ONE);t++)r=e.sqr(r);let r=e.pow(l,ug<<BigInt(a-t-1));l=e.sqr(r),c=e.mul(c,r),u=e.mul(u,l),a=t}return c}}function u_(e){if(e%ub===uy){let t=(e+ug)/ub;return function(e,r){let n=e.pow(r,t);if(!e.eql(e.sqr(n),r))throw Error("Cannot find square root");return n}}if(e%uv===uw){let t=(e-uw)/uv;return function(e,r){let n=e.mul(r,um),i=e.pow(n,t),s=e.mul(r,i),o=e.mul(e.mul(s,um),i),a=e.mul(s,e.sub(o,e.ONE));if(!e.eql(e.sqr(a),r))throw Error("Cannot find square root");return a}}return uk(e)}BigInt(9),BigInt(16);let uI=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function uT(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"};return uf(e,uI.reduce((e,t)=>(e[t]="function",e),t))}function uC(e,t,r){if(r<up)throw Error("Expected power > 0");if(r===up)return e.ONE;if(r===ug)return t;let n=e.ONE,i=t;for(;r>up;)r&ug&&(n=e.mul(n,i)),i=e.sqr(i),r>>=ug;return n}function uP(e,t){let r=Array(t.length),n=t.reduce((t,n,i)=>e.is0(n)?t:(r[i]=t,e.mul(t,n)),e.ONE),i=e.inv(n);return t.reduceRight((t,n,i)=>e.is0(n)?t:(r[i]=e.mul(t,r[i]),e.mul(t,n)),i),r}function uR(e,t){let r=void 0!==t?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function uD(e,t,r=!1,n={}){if(e<=up)throw Error(`Expected Field ORDER > 0, got ${e}`);let{nBitLength:i,nByteLength:s}=uR(e,t);if(s>2048)throw Error("Field lengths over 2048 bytes are not supported");let o=u_(e),a=Object.freeze({ORDER:e,BITS:i,BYTES:s,MASK:ul(i),ZERO:up,ONE:ug,create:t=>uE(t,e),isValid:t=>{if("bigint"!=typeof t)throw Error(`Invalid field element: expected bigint, got ${typeof t}`);return up<=t&&t<e},is0:e=>e===up,isOdd:e=>(e&ug)===ug,neg:t=>uE(-t,e),eql:(e,t)=>e===t,sqr:t=>uE(t*t,e),add:(t,r)=>uE(t+r,e),sub:(t,r)=>uE(t-r,e),mul:(t,r)=>uE(t*r,e),pow:(e,t)=>uC(a,e,t),div:(t,r)=>uE(t*uS(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>uS(t,e),sqrt:n.sqrt||(e=>o(a,e)),invertBatch:e=>uP(a,e),cmov:(e,t,r)=>r?t:e,toBytes:e=>r?us(e,s):ui(e,s),fromBytes:e=>{if(e.length!==s)throw Error(`Fp.fromBytes: expected ${s}, got ${e.length}`);return r?un(e):ur(e)}});return Object.freeze(a)}function uN(e){if("bigint"!=typeof e)throw Error("field order must be bigint");return Math.ceil(e.toString(2).length/8)}function uM(e){let t=uN(e);return t+Math.ceil(t/2)}function uB(e,t,r=!1){let n=e.length,i=uN(t),s=uM(t);if(n<16||n<s||n>1024)throw Error(`expected ${s}-1024 bytes of input, got ${n}`);let o=uE(r?ur(e):un(e),t-ug)+ug;return r?us(o,i):ui(o,i)}let uO=BigInt(0),uL=BigInt(1);function uF(e,t){let r=(e,t)=>{let r=t.negate();return e?r:t},n=e=>({windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:r,unsafeLadder(t,r){let n=e.ZERO,i=t;for(;r>uO;)r&uL&&(n=n.add(i)),i=i.double(),r>>=uL;return n},precomputeWindow(e,t){let{windows:r,windowSize:i}=n(t),s=[],o=e,a=o;for(let e=0;e<r;e++){a=o,s.push(a);for(let e=1;e<i;e++)a=a.add(o),s.push(a);o=a.double()}return s},wNAF(t,i,s){let{windows:o,windowSize:a}=n(t),l=e.ZERO,c=e.BASE,u=BigInt(2**t-1),d=2**t,h=BigInt(t);for(let e=0;e<o;e++){let t=e*a,n=Number(s&u);s>>=h,n>a&&(n-=d,s+=uL);let o=t,f=t+Math.abs(n)-1,p=e%2!=0,g=n<0;0===n?c=c.add(r(p,i[o])):l=l.add(r(g,i[f]))}return{p:l,f:c}},wNAFCached(e,t,r,n){let i=e._WINDOW_SIZE||1,s=t.get(e);return s||(s=this.precomputeWindow(e,i),1!==i&&t.set(e,n(s))),this.wNAF(i,s,r)}}}function uU(e){return uT(e.Fp),uf(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...uR(e.n,e.nBitLength),...e,...{p:e.Fp.ORDER}})}function uj(e){let t=uU(e);uf(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:r,Fp:n,a:i}=t;if(r){if(!n.eql(i,n.ZERO))throw Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof r||"bigint"!=typeof r.beta||"function"!=typeof r.splitScalar)throw Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}let{Ph:uH,aT:u$}=Q,uq={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){let{Err:t}=uq;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");let r=e[1],n=e.subarray(2,r+2);if(!r||n.length!==r)throw new t("Invalid signature integer: wrong length");if(128&n[0])throw new t("Invalid signature integer: negative");if(0===n[0]&&!(128&n[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:uH(n),l:e.subarray(r+2)}},toSig(e){let{Err:t}=uq,r="string"==typeof e?u$(e):e;c5(r);let n=r.length;if(n<2||48!=r[0])throw new t("Invalid signature tag");if(r[1]!==n-2)throw new t("Invalid signature: incorrect length");let{d:i,l:s}=uq._parseInt(r.subarray(2)),{d:o,l:a}=uq._parseInt(s);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(e){let t=e=>8&Number.parseInt(e[0],16)?"00"+e:e,r=e=>{let t=e.toString(16);return 1&t.length?`0${t}`:t},n=t(r(e.s)),i=t(r(e.r)),s=n.length/2,o=i.length/2,a=r(s),l=r(o);return`30${r(o+s+4)}02${l}${i}02${a}${n}`}},uz=BigInt(0),uV=BigInt(1),uG=BigInt(2),uK=BigInt(3),uW=BigInt(4);function uQ(e){let t=uj(e),{Fp:r}=t,n=t.toBytes||((e,t,n)=>{let i=t.toAffine();return ua(Uint8Array.from([4]),r.toBytes(i.x),r.toBytes(i.y))}),i=t.fromBytes||(e=>{let t=e.subarray(1);return{x:r.fromBytes(t.subarray(0,r.BYTES)),y:r.fromBytes(t.subarray(r.BYTES,2*r.BYTES))}});function s(e){let{a:n,b:i}=t,s=r.sqr(e),o=r.mul(s,e);return r.add(r.add(o,r.mul(e,n)),i)}if(!r.eql(r.sqr(t.Gy),s(t.Gx)))throw Error("bad generator point: equation left != right");function o(e){return"bigint"==typeof e&&uz<e&&e<t.n}function a(e){if(!o(e))throw Error("Expected valid bigint: 0 < bigint < curve.n")}function l(e){let r,{allowedPrivateKeyLengths:n,nByteLength:i,wrapPrivateKey:s,n:o}=t;if(n&&"bigint"!=typeof e){if(c4(e)&&(e=c8(e)),"string"!=typeof e||!n.includes(e.length))throw Error("Invalid key");e=e.padStart(2*i,"0")}try{r="bigint"==typeof e?e:ur(uo("private key",e,i))}catch(t){throw Error(`private key must be ${i} bytes, hex or bigint, not ${typeof e}`)}return s&&(r=uE(r,o)),a(r),r}let c=new Map;function u(e){if(!(e instanceof d))throw Error("ProjectivePoint expected")}class d{constructor(e,t,n){if(this.px=e,this.py=t,this.pz=n,null==e||!r.isValid(e))throw Error("x required");if(null==t||!r.isValid(t))throw Error("y required");if(null==n||!r.isValid(n))throw Error("z required")}static fromAffine(e){let{x:t,y:n}=e||{};if(!e||!r.isValid(t)||!r.isValid(n))throw Error("invalid affine point");if(e instanceof d)throw Error("projective point not allowed");let i=e=>r.eql(e,r.ZERO);return i(t)&&i(n)?d.ZERO:new d(t,n,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){let t=r.invertBatch(e.map(e=>e.pz));return e.map((e,r)=>e.toAffine(t[r])).map(d.fromAffine)}static fromHex(e){let t=d.fromAffine(i(uo("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return d.BASE.multiply(l(e))}_setWindowSize(e){this._WINDOW_SIZE=e,c.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!r.is0(this.py))return;throw Error("bad point: ZERO")}let{x:e,y:n}=this.toAffine();if(!r.isValid(e)||!r.isValid(n))throw Error("bad point: x or y not FE");let i=r.sqr(n),o=s(e);if(!r.eql(i,o))throw Error("bad point: equation left != right");if(!this.isTorsionFree())throw Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:e}=this.toAffine();if(r.isOdd)return!r.isOdd(e);throw Error("Field doesn't support isOdd")}equals(e){u(e);let{px:t,py:n,pz:i}=this,{px:s,py:o,pz:a}=e,l=r.eql(r.mul(t,a),r.mul(s,i)),c=r.eql(r.mul(n,a),r.mul(o,i));return l&&c}negate(){return new d(this.px,r.neg(this.py),this.pz)}double(){let{a:e,b:n}=t,i=r.mul(n,uK),{px:s,py:o,pz:a}=this,l=r.ZERO,c=r.ZERO,u=r.ZERO,h=r.mul(s,s),f=r.mul(o,o),p=r.mul(a,a),g=r.mul(s,o);return g=r.add(g,g),u=r.mul(s,a),u=r.add(u,u),l=r.mul(e,u),c=r.mul(i,p),c=r.add(l,c),l=r.sub(f,c),c=r.add(f,c),c=r.mul(l,c),l=r.mul(g,l),u=r.mul(i,u),p=r.mul(e,p),g=r.sub(h,p),g=r.mul(e,g),g=r.add(g,u),u=r.add(h,h),h=r.add(u,h),h=r.add(h,p),h=r.mul(h,g),c=r.add(c,h),p=r.mul(o,a),p=r.add(p,p),h=r.mul(p,g),l=r.sub(l,h),u=r.mul(p,f),u=r.add(u,u),new d(l,c,u=r.add(u,u))}add(e){u(e);let{px:n,py:i,pz:s}=this,{px:o,py:a,pz:l}=e,c=r.ZERO,h=r.ZERO,f=r.ZERO,p=t.a,g=r.mul(t.b,uK),m=r.mul(n,o),y=r.mul(i,a),b=r.mul(s,l),w=r.add(n,i),v=r.add(o,a);w=r.mul(w,v),v=r.add(m,y),w=r.sub(w,v),v=r.add(n,s);let E=r.add(o,l);return v=r.mul(v,E),E=r.add(m,b),v=r.sub(v,E),E=r.add(i,s),c=r.add(a,l),E=r.mul(E,c),c=r.add(y,b),E=r.sub(E,c),f=r.mul(p,v),c=r.mul(g,b),f=r.add(c,f),c=r.sub(y,f),f=r.add(y,f),h=r.mul(c,f),y=r.add(m,m),y=r.add(y,m),b=r.mul(p,b),v=r.mul(g,v),y=r.add(y,b),b=r.sub(m,b),b=r.mul(p,b),v=r.add(v,b),m=r.mul(y,v),h=r.add(h,m),m=r.mul(E,v),c=r.mul(w,c),c=r.sub(c,m),m=r.mul(w,y),f=r.mul(E,f),new d(c,h,f=r.add(f,m))}subtract(e){return this.add(e.negate())}is0(){return this.equals(d.ZERO)}wNAF(e){return f.wNAFCached(this,c,e,e=>{let t=r.invertBatch(e.map(e=>e.pz));return e.map((e,r)=>e.toAffine(t[r])).map(d.fromAffine)})}multiplyUnsafe(e){let n=d.ZERO;if(e===uz)return n;if(a(e),e===uV)return this;let{endo:i}=t;if(!i)return f.unsafeLadder(this,e);let{k1neg:s,k1:o,k2neg:l,k2:c}=i.splitScalar(e),u=n,h=n,p=this;for(;o>uz||c>uz;)o&uV&&(u=u.add(p)),c&uV&&(h=h.add(p)),p=p.double(),o>>=uV,c>>=uV;return s&&(u=u.negate()),l&&(h=h.negate()),h=new d(r.mul(h.px,i.beta),h.py,h.pz),u.add(h)}multiply(e){let n,i;a(e);let s=e,{endo:o}=t;if(o){let{k1neg:e,k1:t,k2neg:a,k2:l}=o.splitScalar(s),{p:c,f:u}=this.wNAF(t),{p:h,f:p}=this.wNAF(l);c=f.constTimeNegate(e,c),h=f.constTimeNegate(a,h),h=new d(r.mul(h.px,o.beta),h.py,h.pz),n=c.add(h),i=u.add(p)}else{let{p:e,f:t}=this.wNAF(s);n=e,i=t}return d.normalizeZ([n,i])[0]}multiplyAndAddUnsafe(e,t,r){let n=d.BASE,i=(e,t)=>t!==uz&&t!==uV&&e.equals(n)?e.multiply(t):e.multiplyUnsafe(t),s=i(this,t).add(i(e,r));return s.is0()?void 0:s}toAffine(e){let{px:t,py:n,pz:i}=this,s=this.is0();null==e&&(e=s?r.ONE:r.inv(i));let o=r.mul(t,e),a=r.mul(n,e),l=r.mul(i,e);if(s)return{x:r.ZERO,y:r.ZERO};if(!r.eql(l,r.ONE))throw Error("invZ was invalid");return{x:o,y:a}}isTorsionFree(){let{h:e,isTorsionFree:r}=t;if(e===uV)return!0;if(r)return r(d,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:e,clearCofactor:r}=t;return e===uV?this:r?r(d,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return this.assertValidity(),n(d,this,e)}toHex(e=!0){return c8(this.toRawBytes(e))}}d.BASE=new d(t.Gx,t.Gy,r.ONE),d.ZERO=new d(r.ZERO,r.ONE,r.ZERO);let h=t.nBitLength,f=uF(d,t.endo?Math.ceil(h/2):h);return{CURVE:t,ProjectivePoint:d,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function uJ(e){let t=uU(e);return uf(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function uZ(e){let t=uJ(e),{Fp:r,n:n}=t,i=r.BYTES+1,s=2*r.BYTES+1;function o(e){return uz<e&&e<r.ORDER}function a(e){return uE(e,n)}function l(e){return uS(e,n)}let{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:d,isWithinCurveOrder:h}=uQ({...t,toBytes(e,t,n){let i=t.toAffine(),s=r.toBytes(i.x),o=ua;return n?o(Uint8Array.from([t.hasEvenY()?2:3]),s):o(Uint8Array.from([4]),s,r.toBytes(i.y))},fromBytes(e){let t=e.length,n=e[0],a=e.subarray(1);if(t===i&&(2===n||3===n)){let e,t=ur(a);if(!o(t))throw Error("Point is not on curve");let i=d(t);try{e=r.sqrt(i)}catch(e){throw Error("Point is not on curve"+(e instanceof Error?": "+e.message:""))}return(1&n)==1!=((e&uV)===uV)&&(e=r.neg(e)),{x:t,y:e}}if(t===s&&4===n)return{x:r.fromBytes(a.subarray(0,r.BYTES)),y:r.fromBytes(a.subarray(r.BYTES,2*r.BYTES))};throw Error(`Point of length ${t} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}}),f=e=>c8(ui(e,t.nByteLength));function p(e){return e>n>>uV}function g(e){return p(e)?a(-e):e}let m=(e,t,r)=>ur(e.slice(t,r));class y{constructor(e,t,r){this.r=e,this.s=t,this.recovery=r,this.assertValidity()}static fromCompact(e){let r=t.nByteLength;return new y(m(e=uo("compactSignature",e,2*r),0,r),m(e,r,2*r))}static fromDER(e){let{r:t,s:r}=uq.toSig(uo("DER",e));return new y(t,r)}assertValidity(){if(!h(this.r))throw Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw Error("s must be 0 < s < CURVE.n")}addRecoveryBit(e){return new y(this.r,this.s,e)}recoverPublicKey(e){let{r:n,s:i,recovery:s}=this,o=x(uo("msgHash",e));if(null==s||![0,1,2,3].includes(s))throw Error("recovery id invalid");let u=2===s||3===s?n+t.n:n;if(u>=r.ORDER)throw Error("recovery id 2 or 3 invalid");let d=(1&s)==0?"02":"03",h=c.fromHex(d+f(u)),p=l(u),g=a(-o*p),m=a(i*p),y=c.BASE.multiplyAndAddUnsafe(h,g,m);if(!y)throw Error("point at infinify");return y.assertValidity(),y}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return ut(this.toDERHex())}toDERHex(){return uq.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return ut(this.toCompactHex())}toCompactHex(){return f(this.r)+f(this.s)}}let b={isValidPrivateKey(e){try{return u(e),!0}catch(e){return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{let e=uM(t.n);return uB(t.randomBytes(e),t.n)},precompute:(e=8,t=c.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function w(e,t=!0){return c.fromPrivateKey(e).toRawBytes(t)}function v(e){let t=c4(e),r="string"==typeof e,n=(t||r)&&e.length;return t?n===i||n===s:r?n===2*i||n===2*s:e instanceof c}function E(e,t,r=!0){if(v(e))throw Error("first arg must be private key");if(!v(t))throw Error("second arg must be public key");return c.fromHex(t).multiply(u(e)).toRawBytes(r)}let A=t.bits2int||function(e){let r=ur(e),n=8*e.length-t.nBitLength;return n>0?r>>BigInt(n):r},x=t.bits2int_modN||function(e){return a(A(e))},S=ul(t.nBitLength);function k(e){if("bigint"!=typeof e)throw Error("bigint expected");if(!(uz<=e&&e<S))throw Error(`bigint expected < 2^${t.nBitLength}`);return ui(e,t.nByteLength)}function _(e,n,i=I){if(["recovered","canonical"].some(e=>e in i))throw Error("sign() legacy options not supported");let{hash:s,randomBytes:o}=t,{lowS:d,prehash:f,extraEntropy:m}=i;null==d&&(d=!0),e=uo("msgHash",e),f&&(e=uo("prehashed msgHash",s(e)));let b=x(e),w=u(n),v=[k(w),k(b)];if(null!=m&&!1!==m){let e=!0===m?o(r.BYTES):m;v.push(uo("extraEntropy",e))}let E=ua(...v),S=b;return{seed:E,k2sig:function(e){let t=A(e);if(!h(t))return;let r=l(t),n=c.BASE.multiply(t).toAffine(),i=a(n.x);if(i===uz)return;let s=a(r*a(S+i*w));if(s===uz)return;let o=2*(n.x!==i)|Number(n.y&uV),u=s;return d&&p(s)&&(u=g(s),o^=1),new y(i,u,o)}}}let I={lowS:t.lowS,prehash:!1},T={lowS:t.lowS,prehash:!1};function C(e,r,n=I){let{seed:i,k2sig:s}=_(e,r,n),o=t;return ud(o.hash.outputLen,o.nByteLength,o.hmac)(i,s)}function P(e,r,n,i=T){let s,o,u=e;if(r=uo("msgHash",r),n=uo("publicKey",n),"strict"in i)throw Error("options.strict was renamed to lowS");let{lowS:d,prehash:h}=i;try{if("string"==typeof u||c4(u))try{o=y.fromDER(u)}catch(e){if(!(e instanceof uq.Err))throw e;o=y.fromCompact(u)}else if("object"==typeof u&&"bigint"==typeof u.r&&"bigint"==typeof u.s){let{r:e,s:t}=u;o=new y(e,t)}else throw Error("PARSE");s=c.fromHex(n)}catch(e){if("PARSE"===e.message)throw Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(d&&o.hasHighS())return!1;h&&(r=t.hash(r));let{r:f,s:p}=o,g=x(r),m=l(p),b=a(g*m),w=a(f*m),v=c.BASE.multiplyAndAddUnsafe(s,b,w)?.toAffine();return!!v&&a(v.x)===f}return c.BASE._setWindowSize(8),{CURVE:t,getPublicKey:w,getSharedSecret:E,sign:C,verify:P,ProjectivePoint:c,Signature:y,utils:b}}function uY(e){return{hash:e,hmac:(t,...r)=>cP(e,t,n1(...r)),randomBytes:n6}}function uX(e,t){let r=t=>uZ({...e,...uY(t)});return Object.freeze({...r(t),create:r})}let u0=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),u1=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),u2=BigInt(1),u3=BigInt(2),u4=(e,t)=>(e+t/u3)/t;function u5(e){let t=u0,r=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=e*e*e%t,u=c*c*e%t,d=ux(u,r,t)*u%t,h=ux(d,r,t)*u%t,f=ux(h,u3,t)*c%t,p=ux(f,i,t)*f%t,g=ux(p,s,t)*p%t,m=ux(g,a,t)*g%t,y=ux(m,l,t)*m%t,b=ux(y,a,t)*g%t,w=ux(b,r,t)*u%t,v=ux(w,o,t)*p%t,E=ux(v,n,t)*c%t,A=ux(E,u3,t);if(!u6.eql(u6.sqr(A),e))throw Error("Cannot find square root");return A}let u6=uD(u0,void 0,void 0,{sqrt:u5}),u8=uX({a:BigInt(0),b:BigInt(7),Fp:u6,n:u1,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=u1,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-u2*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=u4(s*e,t),l=u4(-n*e,t),c=uE(e-a*r-l*i,t),u=uE(-a*n-l*s,t),d=c>o,h=u>o;if(d&&(c=t-c),h&&(u=t-u),c>o||u>o)throw Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:d,k1:c,k2neg:h,k2:u}}}},c$),u7=BigInt(0),u9=e=>"bigint"==typeof e&&u7<e&&e<u0,de=e=>"bigint"==typeof e&&u7<e&&e<u1,dt={};function dr(e,...t){let r=dt[e];if(void 0===r){let t=sha256(Uint8Array.from(e,e=>e.charCodeAt(0)));r=concatBytes(t,t),dt[e]=r}return sha256(concatBytes(r,...t))}let dn=e=>e.toRawBytes(!0).slice(1),di=e=>numberToBytesBE(e,32),ds=e=>mod(e,u0),da=e=>mod(e,u1),dl=u8.ProjectivePoint,dc=(e,t,r)=>dl.BASE.multiplyAndAddUnsafe(e,t,r);function du(e){if(!u9(e))throw Error("bad x: need 0 < x < p");let t=ds(e*e),r=u5(ds(t*e+BigInt(7)));r%u3!==u7&&(r=ds(-r));let n=new dl(e,r,u2);return n.assertValidity(),n}function dd(...e){return da(bytesToNumberBE(dr("BIP0340/challenge",...e)))}let dh=null!=(M=u8)?M:J,df=BigInt("0xffffffffffffffff"),dp=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),dg=dh.CURVE.n/BigInt(2),dm={type:"object",required:["crypto","id","version","address"],properties:{crypto:{type:"object",required:["cipher","ciphertext","cipherparams","kdf","kdfparams","mac"],properties:{cipher:{type:"string"},ciphertext:{type:"string"},cipherparams:{type:"object"},kdf:{type:"string"},kdfparams:{type:"object"},salt:{type:"string"},mac:{type:"string"}}},id:{type:"string"},version:{type:"number"},address:{type:"string"}}};!function(e){e[e.Mainnet=1]="Mainnet",e[e.Goerli=5]="Goerli",e[e.Sepolia=0xaa36a7]="Sepolia"}(B||(B={})),function(e){e.Chainstart="chainstart",e.Homestead="homestead",e.Dao="dao",e.TangerineWhistle="tangerineWhistle",e.SpuriousDragon="spuriousDragon",e.Byzantium="byzantium",e.Constantinople="constantinople",e.Petersburg="petersburg",e.Istanbul="istanbul",e.MuirGlacier="muirGlacier",e.Berlin="berlin",e.London="london",e.ArrowGlacier="arrowGlacier",e.GrayGlacier="grayGlacier",e.MergeForkIdTransition="mergeForkIdTransition",e.Merge="merge",e.Shanghai="shanghai",e.ShardingForkDev="shardingFork"}(O||(O={})),function(e){e.ProofOfStake="pos",e.ProofOfWork="pow",e.ProofOfAuthority="poa"}(L||(L={})),function(e){e.Ethash="ethash",e.Clique="clique",e.Casper="casper"}(F||(F={})),function(e){e.PolygonMainnet="polygon-mainnet",e.PolygonMumbai="polygon-mumbai",e.ArbitrumRinkebyTestnet="arbitrum-rinkeby-testnet",e.ArbitrumOne="arbitrum-one",e.xDaiChain="x-dai-chain",e.OptimisticKovan="optimistic-kovan",e.OptimisticEthereum="optimistic-ethereum"}(U||(U={})),function(e){e[e.Number=0]="Number",e[e.BigInt=1]="BigInt",e[e.Uint8Array=2]="Uint8Array",e[e.PrefixedHexString=3]="PrefixedHexString"}(j||(j={}));let dy=e=>{if("string"!=typeof e)throw Error(`[stripHexPrefix] input must be type 'string', received ${typeof e}`);return oF(e)?e.slice(2):e};function db(e){return e&&"0x0"!==e?oF(e)?`0x${dy(e).padStart(16,"0")}`:`0x${e.padStart(16,"0")}`:"0x0000000000000000"}let dw=function(e){if(!Number.isSafeInteger(e)||e<0)throw Error(`Received an invalid integer type: ${e}`);return`0x${e.toString(16)}`};function dv(e,t=!0){var r,n;let{name:i,config:s,difficulty:o,mixHash:a,gasLimit:l,coinbase:c,baseFeePerGas:u}=e,{extraData:d,timestamp:h,nonce:f}=e,p=Number(h),{chainId:g}=s;if(""===d&&(d="0x"),oF(h)||(h=dw(parseInt(h))),18!==f.length&&(f=db(f)),s.eip155Block!==s.eip158Block)throw Error("EIP155 block number must equal EIP 158 block number since both are part of SpuriousDragon hardfork and the client only supports activating the full hardfork");let m={name:i,chainId:g,networkId:g,genesis:{timestamp:h,gasLimit:parseInt(l),difficulty:parseInt(o),nonce:f,extraData:d,mixHash:a,coinbase:c,baseFeePerGas:u},hardfork:void 0,hardforks:[],bootstrapNodes:[],consensus:void 0!==s.clique?{type:"poa",algorithm:"clique",clique:{period:null!=(r=s.clique.period)?r:s.clique.blockperiodseconds,epoch:null!=(n=s.clique.epoch)?n:s.clique.epochlength}}:{type:"pow",algorithm:"ethash",ethash:{}}},y={[O.Homestead]:{name:"homesteadBlock"},[O.Dao]:{name:"daoForkBlock"},[O.TangerineWhistle]:{name:"eip150Block"},[O.SpuriousDragon]:{name:"eip155Block"},[O.Byzantium]:{name:"byzantiumBlock"},[O.Constantinople]:{name:"constantinopleBlock"},[O.Petersburg]:{name:"petersburgBlock"},[O.Istanbul]:{name:"istanbulBlock"},[O.MuirGlacier]:{name:"muirGlacierBlock"},[O.Berlin]:{name:"berlinBlock"},[O.London]:{name:"londonBlock"},[O.MergeForkIdTransition]:{name:"mergeForkBlock",postMerge:t},[O.Shanghai]:{name:"shanghaiTime",postMerge:!0,isTimestamp:!0},[O.ShardingForkDev]:{name:"shardingForkTime",postMerge:!0,isTimestamp:!0}},b=Object.keys(y).reduce((e,t)=>(e[y[t].name]=t,e),{});if(m.hardforks=Object.keys(s).filter(e=>void 0!==b[e]&&void 0!==s[e]&&null!==s[e]).map(e=>({name:b[e],block:!0===y[b[e]].isTimestamp||"number"!=typeof s[e]?null:s[e],timestamp:!0===y[b[e]].isTimestamp&&"number"==typeof s[e]?s[e]:void 0})).filter(e=>null!==e.block||void 0!==e.timestamp),m.hardforks.sort((e,t)=>{var r,n;return(null!=(r=e.block)?r:1/0)-(null!=(n=t.block)?n:1/0)}),m.hardforks.sort((e,t)=>{var r,n;return(null!=(r=e.timestamp)?r:p)-(null!=(n=t.timestamp)?n:p)}),void 0!==s.terminalTotalDifficulty){let e={name:O.Merge,ttd:s.terminalTotalDifficulty,block:null},t=m.hardforks.findIndex(e=>{var t;return(null==(t=y[e.name])?void 0:t.postMerge)===!0});-1!==t?m.hardforks.splice(t,0,e):m.hardforks.push(e)}let w=m.hardforks.length>0?m.hardforks.slice(-1)[0]:void 0;return m.hardfork=null==w?void 0:w.name,m.hardforks.unshift({name:O.Chainstart,block:0}),m}function dE(e,t,r){try{if(["config","difficulty","gasLimit","alloc"].some(t=>!(t in e)))throw Error("Invalid format, expected geth genesis fields missing");return void 0!==t&&(e.name=t),dv(e,r)}catch(e){throw Error(`Error parsing parameters file: ${e.message}`)}}function dA(e){let t=e;if("string"!=typeof t)throw Error(`[padToEven] value must be type 'string', received ${typeof t}`);return t.length%2&&(t=`0${t}`),t}let dx=function(e){let t=dw(e);return aI(`0x${dA(t.slice(2))}`)},dS=function(e){var t;if(null==e)return new Uint8Array;if(e instanceof Uint8Array)return e;if((null==(t=null==e?void 0:e.constructor)?void 0:t.name)==="Uint8Array"||Array.isArray(e))return Uint8Array.from(e);if("string"==typeof e){if(!oO(e))throw Error(`Cannot convert string to Uint8Array. only supports 0x-prefixed hex strings and this string was given: ${e}`);return aI(dA(dy(e)))}if("number"==typeof e)return dS(aP(e));if("bigint"==typeof e){if(e<BigInt(0))throw Error(`Cannot convert negative bigint to Uint8Array. Given: ${e}`);let t=e.toString(16);return t.length%2&&(t=`0${t}`),dS(`0x${t}`)}if(e.toArray)return Uint8Array.from(e.toArray());throw Error("invalid type")};function dk(e){let t=a_(e);return"0x"===t?BigInt(0):BigInt(t)}function d_(e){return dS(`0x${e.toString(16)}`)}let dI=function(e){return new Uint8Array(e).fill(0)},dT=function(e,t,r){let n=dI(t);return r?e.length<t?(n.set(e),n):e.subarray(0,t):e.length<t?(n.set(e,t-e.length),n):e.subarray(-t)};function dC(e){if(!aw(e))throw Error(`This method only supports Uint8Array but input was: ${e}`)}let dP=function(e,t){return dC(e),dT(e,t,!1)};function dR(e){let t=e[0];for(;e.length>0&&"0"===t.toString();)t=(e=e.slice(1))[0];return e}let dD=function(e){return dC(e),dR(e)},dN=e=>`0x${e.toString(16)}`;function dM(e){return dD(d_(e))}function dB(e,t){return e===BigInt(0)||e===BigInt(1)?e:void 0===t?e-BigInt(27):e-(t*BigInt(2)+BigInt(35))}function dO(e){return e===BigInt(0)||e===BigInt(1)}let dL=function(e,t,r,n,i){let s=dB(t,i);if(!dO(s))throw Error("Invalid signature v value");return new dh.Signature(dk(r),dk(n)).addRecoveryBit(Number(s)).recoverPublicKey(e).toRawBytes(!1).slice(1)};function dF(e,t){if(null===e)return null;if(void 0===e)return;if("string"!=typeof e||oO(e)){if("number"==typeof e&&!Number.isSafeInteger(e))throw Error("The provided number is greater than MAX_SAFE_INTEGER (please use an alternative input type)")}else throw Error(`A string must be provided with a 0x-prefix, given: ${e}`);let r=dS(e);switch(t){case j.Uint8Array:return r;case j.BigInt:return dk(r);case j.Number:{let e=dk(r);if(e>BigInt(Number.MAX_SAFE_INTEGER))throw Error("The provided number is greater than MAX_SAFE_INTEGER (please use an alternative output type)");return Number(e)}case j.PrefixedHexString:return a_(r);default:throw Error("unknown outputType")}}var dU=r(40944),dj=r(40463);let dH={name:"goerli",chainId:5,networkId:5,defaultHardfork:"merge",consensus:{type:"poa",algorithm:"clique",clique:{period:15,epoch:3e4}},comment:"Cross-client PoA test network",url:"https://github.com/goerli/testnet",genesis:{timestamp:"0x5c51a607",gasLimit:0xa00000,difficulty:1,nonce:"0x0000000000000000",extraData:"0x22466c6578692069732061207468696e6722202d204166726900000000000000e0a2bd4258d2768837baa26a28fe71dc079f84c70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"},hardforks:[{name:"chainstart",block:0,forkHash:"0xa3f5ab08"},{name:"homestead",block:0,forkHash:"0xa3f5ab08"},{name:"tangerineWhistle",block:0,forkHash:"0xa3f5ab08"},{name:"spuriousDragon",block:0,forkHash:"0xa3f5ab08"},{name:"byzantium",block:0,forkHash:"0xa3f5ab08"},{name:"constantinople",block:0,forkHash:"0xa3f5ab08"},{name:"petersburg",block:0,forkHash:"0xa3f5ab08"},{name:"istanbul",block:1561651,forkHash:"0xc25efa5c"},{name:"berlin",block:4460644,forkHash:"0x757a1c47"},{name:"london",block:5062605,forkHash:"0xb8c6299d"},{"//_comment":"The forkHash will remain same as mergeForkIdTransition is post merge, terminal block: https://goerli.etherscan.io/block/7382818",name:"merge",ttd:"10790000",block:7382819,forkHash:"0xb8c6299d"},{name:"mergeForkIdTransition",block:null,forkHash:null},{name:"shanghai",block:null,forkHash:null}],bootstrapNodes:[],dnsNetworks:["enrtree://AKA3AM6LPBYEUDMVNU3BSVQJ5AD45Y7YPOHJLEF6W26QOE4VTUDPE@all.goerli.ethdisco.net"]},d$={name:"mainnet",chainId:1,networkId:1,defaultHardfork:"merge",consensus:{type:"pow",algorithm:"ethash",ethash:{}},comment:"The Ethereum main chain",url:"https://ethstats.net/",genesis:{gasLimit:5e3,difficulty:0x400000000,nonce:"0x0000000000000042",extraData:"0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa"},hardforks:[{name:"chainstart",block:0,forkHash:"0xfc64ec04"},{name:"homestead",block:115e4,forkHash:"0x97c2c34c"},{name:"dao",block:192e4,forkHash:"0x91d1f948"},{name:"tangerineWhistle",block:2463e3,forkHash:"0x7a64da13"},{name:"spuriousDragon",block:2675e3,forkHash:"0x3edd5b10"},{name:"byzantium",block:437e4,forkHash:"0xa00bc324"},{name:"constantinople",block:728e4,forkHash:"0x668db0af"},{name:"petersburg",block:728e4,forkHash:"0x668db0af"},{name:"istanbul",block:9069e3,forkHash:"0x879d6e30"},{name:"muirGlacier",block:92e5,forkHash:"0xe029e991"},{name:"berlin",block:12244e3,forkHash:"0x0eb440f6"},{name:"london",block:12965e3,forkHash:"0xb715077d"},{name:"arrowGlacier",block:13773e3,forkHash:"0x20c327fc"},{name:"grayGlacier",block:1505e4,forkHash:"0xf0afd0e3"},{"//_comment":"The forkHash will remain same as mergeForkIdTransition is post merge, terminal block: https://etherscan.io/block/15537393",name:"merge",ttd:"58750000000000000000000",block:0xed14f2,forkHash:"0xf0afd0e3"},{name:"mergeForkIdTransition",block:null,forkHash:null},{name:"shanghai",block:null,forkHash:null}],bootstrapNodes:[],dnsNetworks:["enrtree://AKA3AM6LPBYEUDMVNU3BSVQJ5AD45Y7YPOHJLEF6W26QOE4VTUDPE@all.mainnet.ethdisco.net"]},dq={name:"sepolia",chainId:0xaa36a7,networkId:0xaa36a7,defaultHardfork:"merge",consensus:{type:"pow",algorithm:"ethash",ethash:{}},comment:"PoW test network to replace Ropsten",url:"https://github.com/ethereum/go-ethereum/pull/23730",genesis:{timestamp:"0x6159af19",gasLimit:3e7,difficulty:131072,nonce:"0x0000000000000000",extraData:"0x5365706f6c69612c20417468656e732c204174746963612c2047726565636521"},hardforks:[{name:"chainstart",block:0,forkHash:"0xfe3366e7"},{name:"homestead",block:0,forkHash:"0xfe3366e7"},{name:"tangerineWhistle",block:0,forkHash:"0xfe3366e7"},{name:"spuriousDragon",block:0,forkHash:"0xfe3366e7"},{name:"byzantium",block:0,forkHash:"0xfe3366e7"},{name:"constantinople",block:0,forkHash:"0xfe3366e7"},{name:"petersburg",block:0,forkHash:"0xfe3366e7"},{name:"istanbul",block:0,forkHash:"0xfe3366e7"},{name:"muirGlacier",block:0,forkHash:"0xfe3366e7"},{name:"berlin",block:0,forkHash:"0xfe3366e7"},{name:"london",block:0,forkHash:"0xfe3366e7"},{"//_comment":"The forkHash will remain same as mergeForkIdTransition is post merge, terminal block: https://sepolia.etherscan.io/block/1450408",name:"merge",ttd:"17000000000000000",block:1450409,forkHash:"0xfe3366e7"},{name:"mergeForkIdTransition",block:1735371,forkHash:"0xb96cbd13"},{name:"shanghai",block:null,timestamp:"1677557088",forkHash:"0xf7f9bc08"}],bootstrapNodes:[],dnsNetworks:["enrtree://AKA3AM6LPBYEUDMVNU3BSVQJ5AD45Y7YPOHJLEF6W26QOE4VTUDPE@all.sepolia.ethdisco.net"]},dz={1153:{name:"EIP-1153",number:1153,comment:"Transient Storage",url:"https://eips.ethereum.org/EIPS/eip-1153",status:"Review",minimumHardfork:"chainstart",requiredEIPs:[],gasConfig:{},gasPrices:{tstore:{v:100,d:"Base fee of the TSTORE opcode"},tload:{v:100,d:"Base fee of the TLOAD opcode"}},vm:{},pow:{}},1559:{name:"EIP-1559",number:1559,comment:"Fee market change for ETH 1.0 chain",url:"https://eips.ethereum.org/EIPS/eip-1559",status:"Final",minimumHardfork:"berlin",requiredEIPs:[2930],gasConfig:{baseFeeMaxChangeDenominator:{v:8,d:"Maximum base fee change denominator"},elasticityMultiplier:{v:2,d:"Maximum block gas target elasticity"},initialBaseFee:{v:1e9,d:"Initial base fee on first EIP1559 block"}},gasPrices:{},vm:{},pow:{}},2315:{name:"EIP-2315",number:2315,comment:"Simple subroutines for the EVM",url:"https://eips.ethereum.org/EIPS/eip-2315",status:"Draft",minimumHardfork:"istanbul",gasConfig:{},gasPrices:{beginsub:{v:2,d:"Base fee of the BEGINSUB opcode"},returnsub:{v:5,d:"Base fee of the RETURNSUB opcode"},jumpsub:{v:10,d:"Base fee of the JUMPSUB opcode"}},vm:{},pow:{}},2537:{name:"EIP-2537",number:2537,comment:"BLS12-381 precompiles",url:"https://eips.ethereum.org/EIPS/eip-2537",status:"Draft",minimumHardfork:"chainstart",gasConfig:{},gasPrices:{Bls12381G1AddGas:{v:600,d:"Gas cost of a single BLS12-381 G1 addition precompile-call"},Bls12381G1MulGas:{v:12e3,d:"Gas cost of a single BLS12-381 G1 multiplication precompile-call"},Bls12381G2AddGas:{v:4500,d:"Gas cost of a single BLS12-381 G2 addition precompile-call"},Bls12381G2MulGas:{v:55e3,d:"Gas cost of a single BLS12-381 G2 multiplication precompile-call"},Bls12381PairingBaseGas:{v:115e3,d:"Base gas cost of BLS12-381 pairing check"},Bls12381PairingPerPairGas:{v:23e3,d:"Per-pair gas cost of BLS12-381 pairing check"},Bls12381MapG1Gas:{v:5500,d:"Gas cost of BLS12-381 map field element to G1"},Bls12381MapG2Gas:{v:11e4,d:"Gas cost of BLS12-381 map field element to G2"},Bls12381MultiExpGasDiscount:{v:[[1,1200],[2,888],[3,764],[4,641],[5,594],[6,547],[7,500],[8,453],[9,438],[10,423],[11,408],[12,394],[13,379],[14,364],[15,349],[16,334],[17,330],[18,326],[19,322],[20,318],[21,314],[22,310],[23,306],[24,302],[25,298],[26,294],[27,289],[28,285],[29,281],[30,277],[31,273],[32,269],[33,268],[34,266],[35,265],[36,263],[37,262],[38,260],[39,259],[40,257],[41,256],[42,254],[43,253],[44,251],[45,250],[46,248],[47,247],[48,245],[49,244],[50,242],[51,241],[52,239],[53,238],[54,236],[55,235],[56,233],[57,232],[58,231],[59,229],[60,228],[61,226],[62,225],[63,223],[64,222],[65,221],[66,220],[67,219],[68,219],[69,218],[70,217],[71,216],[72,216],[73,215],[74,214],[75,213],[76,213],[77,212],[78,211],[79,211],[80,210],[81,209],[82,208],[83,208],[84,207],[85,206],[86,205],[87,205],[88,204],[89,203],[90,202],[91,202],[92,201],[93,200],[94,199],[95,199],[96,198],[97,197],[98,196],[99,196],[100,195],[101,194],[102,193],[103,193],[104,192],[105,191],[106,191],[107,190],[108,189],[109,188],[110,188],[111,187],[112,186],[113,185],[114,185],[115,184],[116,183],[117,182],[118,182],[119,181],[120,180],[121,179],[122,179],[123,178],[124,177],[125,176],[126,176],[127,175],[128,174]],d:"Discount gas costs of calls to the MultiExp precompiles with `k` (point, scalar) pair"}},vm:{},pow:{}},2565:{name:"EIP-2565",number:2565,comment:"ModExp gas cost",url:"https://eips.ethereum.org/EIPS/eip-2565",status:"Final",minimumHardfork:"byzantium",gasConfig:{},gasPrices:{modexpGquaddivisor:{v:3,d:"Gquaddivisor from modexp precompile for gas calculation"}},vm:{},pow:{}},2718:{name:"EIP-2718",comment:"Typed Transaction Envelope",url:"https://eips.ethereum.org/EIPS/eip-2718",status:"Final",minimumHardfork:"chainstart",gasConfig:{},gasPrices:{},vm:{},pow:{}},2929:{name:"EIP-2929",comment:"Gas cost increases for state access opcodes",url:"https://eips.ethereum.org/EIPS/eip-2929",status:"Final",minimumHardfork:"chainstart",gasConfig:{},gasPrices:{coldsload:{v:2100,d:"Gas cost of the first read of storage from a given location (per transaction)"},coldaccountaccess:{v:2600,d:"Gas cost of the first read of a given address (per transaction)"},warmstorageread:{v:100,d:"Gas cost of reading storage locations which have already loaded 'cold'"},sstoreCleanGasEIP2200:{v:2900,d:"Once per SSTORE operation from clean non-zero to something else"},sstoreNoopGasEIP2200:{v:100,d:"Once per SSTORE operation if the value doesn't change"},sstoreDirtyGasEIP2200:{v:100,d:"Once per SSTORE operation if a dirty value is changed"},sstoreInitRefundEIP2200:{v:19900,d:"Once per SSTORE operation for resetting to the original zero value"},sstoreCleanRefundEIP2200:{v:4900,d:"Once per SSTORE operation for resetting to the original non-zero value"},call:{v:0,d:"Base fee of the CALL opcode"},callcode:{v:0,d:"Base fee of the CALLCODE opcode"},delegatecall:{v:0,d:"Base fee of the DELEGATECALL opcode"},staticcall:{v:0,d:"Base fee of the STATICCALL opcode"},balance:{v:0,d:"Base fee of the BALANCE opcode"},extcodesize:{v:0,d:"Base fee of the EXTCODESIZE opcode"},extcodecopy:{v:0,d:"Base fee of the EXTCODECOPY opcode"},extcodehash:{v:0,d:"Base fee of the EXTCODEHASH opcode"},sload:{v:0,d:"Base fee of the SLOAD opcode"},sstore:{v:0,d:"Base fee of the SSTORE opcode"}},vm:{},pow:{}},2930:{name:"EIP-2930",comment:"Optional access lists",url:"https://eips.ethereum.org/EIPS/eip-2930",status:"Final",minimumHardfork:"istanbul",requiredEIPs:[2718,2929],gasConfig:{},gasPrices:{accessListStorageKeyCost:{v:1900,d:"Gas cost per storage key in an Access List transaction"},accessListAddressCost:{v:2400,d:"Gas cost per storage key in an Access List transaction"}},vm:{},pow:{}},3198:{name:"EIP-3198",number:3198,comment:"BASEFEE opcode",url:"https://eips.ethereum.org/EIPS/eip-3198",status:"Final",minimumHardfork:"london",gasConfig:{},gasPrices:{basefee:{v:2,d:"Gas cost of the BASEFEE opcode"}},vm:{},pow:{}},3529:{name:"EIP-3529",comment:"Reduction in refunds",url:"https://eips.ethereum.org/EIPS/eip-3529",status:"Final",minimumHardfork:"berlin",requiredEIPs:[2929],gasConfig:{maxRefundQuotient:{v:5,d:"Maximum refund quotient; max tx refund is min(tx.gasUsed/maxRefundQuotient, tx.gasRefund)"}},gasPrices:{selfdestructRefund:{v:0,d:"Refunded following a selfdestruct operation"},sstoreClearRefundEIP2200:{v:4800,d:"Once per SSTORE operation for clearing an originally existing storage slot"}},vm:{},pow:{}},3540:{name:"EIP-3540",number:3540,comment:"EVM Object Format (EOF) v1",url:"https://eips.ethereum.org/EIPS/eip-3540",status:"Review",minimumHardfork:"london",requiredEIPs:[3541],gasConfig:{},gasPrices:{},vm:{},pow:{}},3541:{name:"EIP-3541",comment:"Reject new contracts starting with the 0xEF byte",url:"https://eips.ethereum.org/EIPS/eip-3541",status:"Final",minimumHardfork:"berlin",requiredEIPs:[],gasConfig:{},gasPrices:{},vm:{},pow:{}},3554:{name:"EIP-3554",comment:"Reduction in refunds",url:"Difficulty Bomb Delay to December 1st 2021",status:"Final",minimumHardfork:"muirGlacier",requiredEIPs:[],gasConfig:{},gasPrices:{},vm:{},pow:{difficultyBombDelay:{v:95e5,d:"the amount of blocks to delay the difficulty bomb with"}}},3607:{name:"EIP-3607",number:3607,comment:"Reject transactions from senders with deployed code",url:"https://eips.ethereum.org/EIPS/eip-3607",status:"Final",minimumHardfork:"chainstart",requiredEIPs:[],gasConfig:{},gasPrices:{},vm:{},pow:{}},3651:{name:"EIP-3651",number:3198,comment:"Warm COINBASE",url:"https://eips.ethereum.org/EIPS/eip-3651",status:"Review",minimumHardfork:"london",requiredEIPs:[2929],gasConfig:{},gasPrices:{},vm:{},pow:{}},3670:{name:"EIP-3670",number:3670,comment:"EOF - Code Validation",url:"https://eips.ethereum.org/EIPS/eip-3670",status:"Review",minimumHardfork:"london",requiredEIPs:[3540],gasConfig:{},gasPrices:{},vm:{},pow:{}},3675:{name:"EIP-3675",number:3675,comment:"Upgrade consensus to Proof-of-Stake",url:"https://eips.ethereum.org/EIPS/eip-3675",status:"Final",minimumHardfork:"london",requiredEIPs:[],gasConfig:{},gasPrices:{},vm:{},pow:{}},3855:{name:"EIP-3855",number:3855,comment:"PUSH0 instruction",url:"https://eips.ethereum.org/EIPS/eip-3855",status:"Review",minimumHardfork:"chainstart",requiredEIPs:[],gasConfig:{},gasPrices:{push0:{v:2,d:"Base fee of the PUSH0 opcode"}},vm:{},pow:{}},3860:{name:"EIP-3860",number:3860,comment:"Limit and meter initcode",url:"https://eips.ethereum.org/EIPS/eip-3860",status:"Review",minimumHardfork:"spuriousDragon",requiredEIPs:[],gasConfig:{},gasPrices:{initCodeWordCost:{v:2,d:"Gas to pay for each word (32 bytes) of initcode when creating a contract"}},vm:{maxInitCodeSize:{v:49152,d:"Maximum length of initialization code when creating a contract"}},pow:{}},4345:{name:"EIP-4345",number:4345,comment:"Difficulty Bomb Delay to June 2022",url:"https://eips.ethereum.org/EIPS/eip-4345",status:"Final",minimumHardfork:"london",gasConfig:{},gasPrices:{},vm:{},pow:{difficultyBombDelay:{v:107e5,d:"the amount of blocks to delay the difficulty bomb with"}}},4399:{name:"EIP-4399",number:4399,comment:"Supplant DIFFICULTY opcode with PREVRANDAO",url:"https://eips.ethereum.org/EIPS/eip-4399",status:"Review",minimumHardfork:"london",requiredEIPs:[],gasConfig:{},gasPrices:{},vm:{},pow:{}},5133:{name:"EIP-5133",number:5133,comment:"Delaying Difficulty Bomb to mid-September 2022",url:"https://eips.ethereum.org/EIPS/eip-5133",status:"Draft",minimumHardfork:"grayGlacier",gasConfig:{},gasPrices:{},vm:{},pow:{difficultyBombDelay:{v:114e5,d:"the amount of blocks to delay the difficulty bomb with"}}}},dV={chainstart:{name:"chainstart",comment:"Start of the Ethereum main chain",url:"",status:"",gasConfig:{minGasLimit:{v:5e3,d:"Minimum the gas limit may ever be"},gasLimitBoundDivisor:{v:1024,d:"The bound divisor of the gas limit, used in update calculations"},maxRefundQuotient:{v:2,d:"Maximum refund quotient; max tx refund is min(tx.gasUsed/maxRefundQuotient, tx.gasRefund)"}},gasPrices:{base:{v:2,d:"Gas base cost, used e.g. for ChainID opcode (Istanbul)"},tierStep:{v:[0,2,3,5,8,10,20],d:"Once per operation, for a selection of them"},exp:{v:10,d:"Base fee of the EXP opcode"},expByte:{v:10,d:"Times ceil(log256(exponent)) for the EXP instruction"},sha3:{v:30,d:"Base fee of the SHA3 opcode"},sha3Word:{v:6,d:"Once per word of the SHA3 operation's data"},sload:{v:50,d:"Base fee of the SLOAD opcode"},sstoreSet:{v:2e4,d:"Once per SSTORE operation if the zeroness changes from zero"},sstoreReset:{v:5e3,d:"Once per SSTORE operation if the zeroness does not change from zero"},sstoreRefund:{v:15e3,d:"Once per SSTORE operation if the zeroness changes to zero"},jumpdest:{v:1,d:"Base fee of the JUMPDEST opcode"},log:{v:375,d:"Base fee of the LOG opcode"},logData:{v:8,d:"Per byte in a LOG* operation's data"},logTopic:{v:375,d:"Multiplied by the * of the LOG*, per LOG transaction. e.g. LOG0 incurs 0 * c_txLogTopicGas, LOG4 incurs 4 * c_txLogTopicGas"},create:{v:32e3,d:"Base fee of the CREATE opcode"},call:{v:40,d:"Base fee of the CALL opcode"},callStipend:{v:2300,d:"Free gas given at beginning of call"},callValueTransfer:{v:9e3,d:"Paid for CALL when the value transfor is non-zero"},callNewAccount:{v:25e3,d:"Paid for CALL when the destination address didn't exist prior"},selfdestructRefund:{v:24e3,d:"Refunded following a selfdestruct operation"},memory:{v:3,d:"Times the address of the (highest referenced byte in memory + 1). NOTE: referencing happens on read, write and in instructions such as RETURN and CALL"},quadCoeffDiv:{v:512,d:"Divisor for the quadratic particle of the memory cost equation"},createData:{v:200,d:""},tx:{v:21e3,d:"Per transaction. NOTE: Not payable on data of calls between transactions"},txCreation:{v:32e3,d:"The cost of creating a contract via tx"},txDataZero:{v:4,d:"Per byte of data attached to a transaction that equals zero. NOTE: Not payable on data of calls between transactions"},txDataNonZero:{v:68,d:"Per byte of data attached to a transaction that is not equal to zero. NOTE: Not payable on data of calls between transactions"},copy:{v:3,d:"Multiplied by the number of 32-byte words that are copied (round up) for any *COPY operation and added"},ecRecover:{v:3e3,d:""},sha256:{v:60,d:""},sha256Word:{v:12,d:""},ripemd160:{v:600,d:""},ripemd160Word:{v:120,d:""},identity:{v:15,d:""},identityWord:{v:3,d:""},stop:{v:0,d:"Base fee of the STOP opcode"},add:{v:3,d:"Base fee of the ADD opcode"},mul:{v:5,d:"Base fee of the MUL opcode"},sub:{v:3,d:"Base fee of the SUB opcode"},div:{v:5,d:"Base fee of the DIV opcode"},sdiv:{v:5,d:"Base fee of the SDIV opcode"},mod:{v:5,d:"Base fee of the MOD opcode"},smod:{v:5,d:"Base fee of the SMOD opcode"},addmod:{v:8,d:"Base fee of the ADDMOD opcode"},mulmod:{v:8,d:"Base fee of the MULMOD opcode"},signextend:{v:5,d:"Base fee of the SIGNEXTEND opcode"},lt:{v:3,d:"Base fee of the LT opcode"},gt:{v:3,d:"Base fee of the GT opcode"},slt:{v:3,d:"Base fee of the SLT opcode"},sgt:{v:3,d:"Base fee of the SGT opcode"},eq:{v:3,d:"Base fee of the EQ opcode"},iszero:{v:3,d:"Base fee of the ISZERO opcode"},and:{v:3,d:"Base fee of the AND opcode"},or:{v:3,d:"Base fee of the OR opcode"},xor:{v:3,d:"Base fee of the XOR opcode"},not:{v:3,d:"Base fee of the NOT opcode"},byte:{v:3,d:"Base fee of the BYTE opcode"},address:{v:2,d:"Base fee of the ADDRESS opcode"},balance:{v:20,d:"Base fee of the BALANCE opcode"},origin:{v:2,d:"Base fee of the ORIGIN opcode"},caller:{v:2,d:"Base fee of the CALLER opcode"},callvalue:{v:2,d:"Base fee of the CALLVALUE opcode"},calldataload:{v:3,d:"Base fee of the CALLDATALOAD opcode"},calldatasize:{v:2,d:"Base fee of the CALLDATASIZE opcode"},calldatacopy:{v:3,d:"Base fee of the CALLDATACOPY opcode"},codesize:{v:2,d:"Base fee of the CODESIZE opcode"},codecopy:{v:3,d:"Base fee of the CODECOPY opcode"},gasprice:{v:2,d:"Base fee of the GASPRICE opcode"},extcodesize:{v:20,d:"Base fee of the EXTCODESIZE opcode"},extcodecopy:{v:20,d:"Base fee of the EXTCODECOPY opcode"},blockhash:{v:20,d:"Base fee of the BLOCKHASH opcode"},coinbase:{v:2,d:"Base fee of the COINBASE opcode"},timestamp:{v:2,d:"Base fee of the TIMESTAMP opcode"},number:{v:2,d:"Base fee of the NUMBER opcode"},difficulty:{v:2,d:"Base fee of the DIFFICULTY opcode"},gaslimit:{v:2,d:"Base fee of the GASLIMIT opcode"},pop:{v:2,d:"Base fee of the POP opcode"},mload:{v:3,d:"Base fee of the MLOAD opcode"},mstore:{v:3,d:"Base fee of the MSTORE opcode"},mstore8:{v:3,d:"Base fee of the MSTORE8 opcode"},sstore:{v:0,d:"Base fee of the SSTORE opcode"},jump:{v:8,d:"Base fee of the JUMP opcode"},jumpi:{v:10,d:"Base fee of the JUMPI opcode"},pc:{v:2,d:"Base fee of the PC opcode"},msize:{v:2,d:"Base fee of the MSIZE opcode"},gas:{v:2,d:"Base fee of the GAS opcode"},push:{v:3,d:"Base fee of the PUSH opcode"},dup:{v:3,d:"Base fee of the DUP opcode"},swap:{v:3,d:"Base fee of the SWAP opcode"},callcode:{v:40,d:"Base fee of the CALLCODE opcode"},return:{v:0,d:"Base fee of the RETURN opcode"},invalid:{v:0,d:"Base fee of the INVALID opcode"},selfdestruct:{v:0,d:"Base fee of the SELFDESTRUCT opcode"}},vm:{stackLimit:{v:1024,d:"Maximum size of VM stack allowed"},callCreateDepth:{v:1024,d:"Maximum depth of call/create stack"},maxExtraDataSize:{v:32,d:"Maximum size extra data may be after Genesis"}},pow:{minimumDifficulty:{v:131072,d:"The minimum that the difficulty may ever be"},difficultyBoundDivisor:{v:2048,d:"The bound divisor of the difficulty, used in the update calculations"},durationLimit:{v:13,d:"The decision boundary on the blocktime duration used to determine whether difficulty should go up or not"},epochDuration:{v:3e4,d:"Duration between proof-of-work epochs"},timebombPeriod:{v:1e5,d:"Exponential difficulty timebomb period"},minerReward:{v:"5000000000000000000",d:"the amount a miner get rewarded for mining a block"},difficultyBombDelay:{v:0,d:"the amount of blocks to delay the difficulty bomb with"}}},homestead:{name:"homestead",comment:"Homestead hardfork with protocol and network changes",url:"https://eips.ethereum.org/EIPS/eip-606",status:"Final",gasConfig:{},gasPrices:{delegatecall:{v:40,d:"Base fee of the DELEGATECALL opcode"}},vm:{},pow:{}},dao:{name:"dao",comment:"DAO rescue hardfork",url:"https://eips.ethereum.org/EIPS/eip-779",status:"Final",gasConfig:{},gasPrices:{},vm:{},pow:{}},tangerineWhistle:{name:"tangerineWhistle",comment:"Hardfork with gas cost changes for IO-heavy operations",url:"https://eips.ethereum.org/EIPS/eip-608",status:"Final",gasConfig:{},gasPrices:{sload:{v:200,d:"Once per SLOAD operation"},call:{v:700,d:"Once per CALL operation & message call transaction"},extcodesize:{v:700,d:"Base fee of the EXTCODESIZE opcode"},extcodecopy:{v:700,d:"Base fee of the EXTCODECOPY opcode"},balance:{v:400,d:"Base fee of the BALANCE opcode"},delegatecall:{v:700,d:"Base fee of the DELEGATECALL opcode"},callcode:{v:700,d:"Base fee of the CALLCODE opcode"},selfdestruct:{v:5e3,d:"Base fee of the SELFDESTRUCT opcode"}},vm:{},pow:{}},spuriousDragon:{name:"spuriousDragon",comment:"HF with EIPs for simple replay attack protection, EXP cost increase, state trie clearing, contract code size limit",url:"https://eips.ethereum.org/EIPS/eip-607",status:"Final",gasConfig:{},gasPrices:{expByte:{v:50,d:"Times ceil(log256(exponent)) for the EXP instruction"}},vm:{maxCodeSize:{v:24576,d:"Maximum length of contract code"}},pow:{}},byzantium:{name:"byzantium",comment:"Hardfork with new precompiles, instructions and other protocol changes",url:"https://eips.ethereum.org/EIPS/eip-609",status:"Final",gasConfig:{},gasPrices:{modexpGquaddivisor:{v:20,d:"Gquaddivisor from modexp precompile for gas calculation"},ecAdd:{v:500,d:"Gas costs for curve addition precompile"},ecMul:{v:4e4,d:"Gas costs for curve multiplication precompile"},ecPairing:{v:1e5,d:"Base gas costs for curve pairing precompile"},ecPairingWord:{v:8e4,d:"Gas costs regarding curve pairing precompile input length"},revert:{v:0,d:"Base fee of the REVERT opcode"},staticcall:{v:700,d:"Base fee of the STATICCALL opcode"},returndatasize:{v:2,d:"Base fee of the RETURNDATASIZE opcode"},returndatacopy:{v:3,d:"Base fee of the RETURNDATACOPY opcode"}},vm:{},pow:{minerReward:{v:"3000000000000000000",d:"the amount a miner get rewarded for mining a block"},difficultyBombDelay:{v:3e6,d:"the amount of blocks to delay the difficulty bomb with"}}},constantinople:{name:"constantinople",comment:"Postponed hardfork including EIP-1283 (SSTORE gas metering changes)",url:"https://eips.ethereum.org/EIPS/eip-1013",status:"Final",gasConfig:{},gasPrices:{netSstoreNoopGas:{v:200,d:"Once per SSTORE operation if the value doesn't change"},netSstoreInitGas:{v:2e4,d:"Once per SSTORE operation from clean zero"},netSstoreCleanGas:{v:5e3,d:"Once per SSTORE operation from clean non-zero"},netSstoreDirtyGas:{v:200,d:"Once per SSTORE operation from dirty"},netSstoreClearRefund:{v:15e3,d:"Once per SSTORE operation for clearing an originally existing storage slot"},netSstoreResetRefund:{v:4800,d:"Once per SSTORE operation for resetting to the original non-zero value"},netSstoreResetClearRefund:{v:19800,d:"Once per SSTORE operation for resetting to the original zero value"},shl:{v:3,d:"Base fee of the SHL opcode"},shr:{v:3,d:"Base fee of the SHR opcode"},sar:{v:3,d:"Base fee of the SAR opcode"},extcodehash:{v:400,d:"Base fee of the EXTCODEHASH opcode"},create2:{v:32e3,d:"Base fee of the CREATE2 opcode"}},vm:{},pow:{minerReward:{v:"2000000000000000000",d:"The amount a miner gets rewarded for mining a block"},difficultyBombDelay:{v:5e6,d:"the amount of blocks to delay the difficulty bomb with"}}},petersburg:{name:"petersburg",comment:"Aka constantinopleFix, removes EIP-1283, activate together with or after constantinople",url:"https://eips.ethereum.org/EIPS/eip-1716",status:"Final",gasConfig:{},gasPrices:{netSstoreNoopGas:{v:null,d:"Removed along EIP-1283"},netSstoreInitGas:{v:null,d:"Removed along EIP-1283"},netSstoreCleanGas:{v:null,d:"Removed along EIP-1283"},netSstoreDirtyGas:{v:null,d:"Removed along EIP-1283"},netSstoreClearRefund:{v:null,d:"Removed along EIP-1283"},netSstoreResetRefund:{v:null,d:"Removed along EIP-1283"},netSstoreResetClearRefund:{v:null,d:"Removed along EIP-1283"}},vm:{},pow:{}},istanbul:{name:"istanbul",comment:"HF targeted for December 2019 following the Constantinople/Petersburg HF",url:"https://eips.ethereum.org/EIPS/eip-1679",status:"Final",gasConfig:{},gasPrices:{blake2Round:{v:1,d:"Gas cost per round for the Blake2 F precompile"},ecAdd:{v:150,d:"Gas costs for curve addition precompile"},ecMul:{v:6e3,d:"Gas costs for curve multiplication precompile"},ecPairing:{v:45e3,d:"Base gas costs for curve pairing precompile"},ecPairingWord:{v:34e3,d:"Gas costs regarding curve pairing precompile input length"},txDataNonZero:{v:16,d:"Per byte of data attached to a transaction that is not equal to zero. NOTE: Not payable on data of calls between transactions"},sstoreSentryGasEIP2200:{v:2300,d:"Minimum gas required to be present for an SSTORE call, not consumed"},sstoreNoopGasEIP2200:{v:800,d:"Once per SSTORE operation if the value doesn't change"},sstoreDirtyGasEIP2200:{v:800,d:"Once per SSTORE operation if a dirty value is changed"},sstoreInitGasEIP2200:{v:2e4,d:"Once per SSTORE operation from clean zero to non-zero"},sstoreInitRefundEIP2200:{v:19200,d:"Once per SSTORE operation for resetting to the original zero value"},sstoreCleanGasEIP2200:{v:5e3,d:"Once per SSTORE operation from clean non-zero to something else"},sstoreCleanRefundEIP2200:{v:4200,d:"Once per SSTORE operation for resetting to the original non-zero value"},sstoreClearRefundEIP2200:{v:15e3,d:"Once per SSTORE operation for clearing an originally existing storage slot"},balance:{v:700,d:"Base fee of the BALANCE opcode"},extcodehash:{v:700,d:"Base fee of the EXTCODEHASH opcode"},chainid:{v:2,d:"Base fee of the CHAINID opcode"},selfbalance:{v:5,d:"Base fee of the SELFBALANCE opcode"},sload:{v:800,d:"Base fee of the SLOAD opcode"}},vm:{},pow:{}},muirGlacier:{name:"muirGlacier",comment:"HF to delay the difficulty bomb",url:"https://eips.ethereum.org/EIPS/eip-2384",status:"Final",gasConfig:{},gasPrices:{},vm:{},pow:{difficultyBombDelay:{v:9e6,d:"the amount of blocks to delay the difficulty bomb with"}}},berlin:{name:"berlin",comment:"HF targeted for July 2020 following the Muir Glacier HF",url:"https://eips.ethereum.org/EIPS/eip-2070",status:"Final",eips:[2565,2929,2718,2930]},london:{name:"london",comment:"HF targeted for July 2021 following the Berlin fork",url:"https://github.com/ethereum/eth1.0-specs/blob/master/network-upgrades/mainnet-upgrades/london.md",status:"Final",eips:[1559,3198,3529,3541]},shanghai:{name:"shanghai",comment:"Next feature hardfork after the merge hardfork having withdrawals, warm coinbase, push0, limit/meter initcode",url:"https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/shanghai.md",status:"Final",eips:[3651,3855,3860,4895]},arrowGlacier:{name:"arrowGlacier",comment:"HF to delay the difficulty bomb",url:"https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/arrow-glacier.md",status:"Final",eips:[4345],gasConfig:{},gasPrices:{},vm:{},pow:{}},grayGlacier:{name:"grayGlacier",comment:"Delaying the difficulty bomb to Mid September 2022",url:"https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/gray-glacier.md",status:"Draft",eips:[5133],gasConfig:{},gasPrices:{},vm:{},pow:{}},mergeForkIdTransition:{name:"mergeForkIdTransition",comment:"Pre-merge hardfork to fork off non-upgraded clients",url:"https://eips.ethereum.org/EIPS/eip-3675",status:"Draft",eips:[]},merge:{name:"merge",comment:"Hardfork to upgrade the consensus mechanism to Proof-of-Stake",url:"https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/merge.md",status:"Final",consensus:{type:"pos",algorithm:"casper",casper:{}},eips:[3675,4399]}},{buf:dG}=dj;class dK extends aY{static custom(e,t={}){var r;let n=null!=(r=t.baseChain)?r:"mainnet",i=Object.assign({},dK._getChainParams(n));if(i.name="custom-chain","string"!=typeof e)return new dK(Object.assign({chain:Object.assign(Object.assign({},i),e)},t));if(e===U.PolygonMainnet)return dK.custom({name:U.PolygonMainnet,chainId:137,networkId:137},t);if(e===U.PolygonMumbai)return dK.custom({name:U.PolygonMumbai,chainId:80001,networkId:80001},t);if(e===U.ArbitrumRinkebyTestnet)return dK.custom({name:U.ArbitrumRinkebyTestnet,chainId:421611,networkId:421611},t);if(e===U.ArbitrumOne)return dK.custom({name:U.ArbitrumOne,chainId:42161,networkId:42161},t);if(e===U.xDaiChain)return dK.custom({name:U.xDaiChain,chainId:100,networkId:100},t);if(e===U.OptimisticKovan)return dK.custom({name:U.OptimisticKovan,chainId:69,networkId:69},Object.assign({hardfork:O.Berlin},t));if(e===U.OptimisticEthereum)return dK.custom({name:U.OptimisticEthereum,chainId:10,networkId:10},Object.assign({hardfork:O.Berlin},t));throw Error(`Custom chain ${e} not supported`)}static fromGethGenesis(e,{chain:t,eips:r,genesisHash:n,hardfork:i,mergeForkIdPostMerge:s}){var o;let a=dE(e,t,s),l=new dK({chain:null!=(o=a.name)?o:"custom",customChains:[a],eips:r,hardfork:null!=i?i:a.hardfork});return void 0!==n&&l.setForkHashes(n),l}static isSupportedChainId(e){return!!this._getInitializedChains().names[e.toString()]}static _getChainParams(e,t){let r=e,n=this._getInitializedChains(t);if("number"==typeof r||"bigint"==typeof r){if(r=r.toString(),n.names[r]){let e=n.names[r];return n[e]}throw Error(`Chain with ID ${r} not supported`)}if(void 0!==n[r])return n[r];throw Error(`Chain with name ${r} not supported`)}constructor(e){var t,r;super(),this._eips=[],this._customChains=null!=(t=e.customChains)?t:[],this._chainParams=this.setChain(e.chain),this.DEFAULT_HARDFORK=null!=(r=this._chainParams.defaultHardfork)?r:O.Merge,this.HARDFORK_CHANGES=this.hardforks().map(e=>[e.name,dV[e.name]]),this._hardfork=this.DEFAULT_HARDFORK,void 0!==e.hardfork&&this.setHardfork(e.hardfork),e.eips&&this.setEIPs(e.eips)}setChain(e){if("number"==typeof e||"bigint"==typeof e||"string"==typeof e)this._chainParams=dK._getChainParams(e,this._customChains);else if("object"==typeof e){if(this._customChains.length>0)throw Error("Chain must be a string, number, or bigint when initialized with customChains passed in");for(let t of["networkId","genesis","hardforks","bootstrapNodes"])if(!(t in e))throw Error(`Missing required chain parameter: ${t}`);this._chainParams=e}else throw Error("Wrong input format");for(let e of this.hardforks())if(void 0===e.block)throw Error("Hardfork cannot have undefined block number");return this._chainParams}setHardfork(e){let t=!1;for(let r of this.HARDFORK_CHANGES)r[0]===e&&(this._hardfork!==e&&(this._hardfork=e,this.emit("hardforkChanged",e)),t=!0);if(!t)throw Error(`Hardfork with name ${e} not supported`)}getHardforkByBlockNumber(e,t,r){let n=dF(e,j.BigInt),i=dF(t,j.BigInt),s=dF(r,j.Number),o=this.hardforks().filter(e=>null!==e.block||null!==e.ttd&&void 0!==e.ttd||void 0!==e.timestamp),a=o.findIndex(e=>null!==e.ttd&&void 0!==e.ttd);if(o.slice(a+1).findIndex(e=>null!==e.ttd&&void 0!==e.ttd)>=0)throw Error("More than one merge hardforks found with ttd specified");let l=o.findIndex(e=>null!==e.block&&e.block>n||void 0!==s&&Number(e.timestamp)>s);if(-1===l)l=o.length;else if(0===l)throw Error("Must have at least one hardfork at block 0");if(void 0===s){let e=o.slice(0,l).reverse().findIndex(e=>null!==e.block||void 0!==e.ttd);l-=e}if(null===o[l-=1].block&&void 0===o[l].timestamp)(null==i||BigInt(o[l].ttd)>i)&&(l-=1);else if(a>=0&&null!=i){if(l>=a&&BigInt(o[a].ttd)>i)throw Error("Maximum HF determined by total difficulty is lower than the block number HF");else if(l<a&&BigInt(o[a].ttd)<=i)throw Error("HF determined by block number is lower than the minimum total difficulty HF")}let c=l;for(;l<o.length-1&&o[l].block===o[l+1].block&&o[l].timestamp===o[l+1].timestamp;l+=1);if(s){if(o.slice(0,c).reduce((e,t)=>{var r;return Math.max(Number(null!=(r=t.timestamp)?r:"0"),e)},0)>s)throw Error("Maximum HF determined by timestamp is lower than the block number/ttd HF");if(o.slice(l+1).reduce((e,t)=>{var r;return Math.min(Number(null!=(r=t.timestamp)?r:s),e)},s)<s)throw Error("Maximum HF determined by block number/ttd is lower than timestamp HF")}return o[l].name}setHardforkByBlockNumber(e,t,r){let n=this.getHardforkByBlockNumber(e,t,r);return this.setHardfork(n),n}_getHardfork(e){for(let t of this.hardforks())if(t.name===e)return t;return null}setEIPs(e=[]){for(let t of e){if(!(t in dz))throw Error(`${t} not supported`);let r=this.gteHardfork(dz[t].minimumHardfork);if(!r)throw Error(`${t} cannot be activated on hardfork ${this.hardfork()}, minimumHardfork: ${r}`);if(void 0!==dz[t].requiredEIPs){for(let r of dz[t].requiredEIPs)if(!(e.includes(r)||this.isActivatedEIP(r)))throw Error(`${t} requires EIP ${r}, but is not included in the EIP list`)}}this._eips=e}param(e,t){let r;for(let n of this._eips)if(void 0!==(r=this.paramByEIP(e,t,n)))return r;return this.paramByHardfork(e,t,this._hardfork)}paramByHardfork(e,t,r){let n=null;for(let i of this.HARDFORK_CHANGES){if("eips"in i[1])for(let r of i[1].eips){let i=this.paramByEIP(e,t,r);n="bigint"==typeof i?i:n}else{if(void 0===i[1][e])throw Error(`Topic ${e} not defined`);void 0!==i[1][e][t]&&(n=i[1][e][t].v)}if(i[0]===r)break}return BigInt(null!=n?n:0)}paramByEIP(e,t,r){if(!(r in dz))throw Error(`${r} not supported`);let n=dz[r];if(!(e in n))throw Error(`Topic ${e} not defined`);if(void 0!==n[e][t])return BigInt(n[e][t].v)}paramByBlock(e,t,r,n,i){let s=this.getHardforkByBlockNumber(r,n,i);return this.paramByHardfork(e,t,s)}isActivatedEIP(e){if(this.eips().includes(e))return!0;for(let t of this.HARDFORK_CHANGES){let r=t[1];if(this.gteHardfork(r.name)&&"eips"in r&&r.eips.includes(e))return!0}return!1}hardforkIsActiveOnBlock(e,t){let r=dF(t,j.BigInt),n=null!=e?e:this._hardfork,i=this.hardforkBlock(n);return"bigint"==typeof i&&i!==BigInt(0)&&!!(r>=i)}activeOnBlock(e){return this.hardforkIsActiveOnBlock(null,e)}hardforkGteHardfork(e,t){let r=null!=e?e:this._hardfork,n=this.hardforks(),i=-1,s=-1,o=0;for(let e of n)e.name===r&&(i=o),e.name===t&&(s=o),o+=1;return i>=s&&-1!==s}gteHardfork(e){return this.hardforkGteHardfork(null,e)}hardforkBlock(e){var t;let r=null!=e?e:this._hardfork,n=null==(t=this._getHardfork(r))?void 0:t.block;return null==n?null:BigInt(n)}hardforkTimestamp(e){var t;let r=null!=e?e:this._hardfork,n=null==(t=this._getHardfork(r))?void 0:t.timestamp;return null==n?null:BigInt(n)}eipBlock(e){for(let t of this.HARDFORK_CHANGES){let r=t[1];if("eips"in r&&r.eips.includes(e))return this.hardforkBlock("number"==typeof t[0]?String(t[0]):t[0])}return null}hardforkTTD(e){var t;let r=null!=e?e:this._hardfork,n=null==(t=this._getHardfork(r))?void 0:t.ttd;return null==n?null:BigInt(n)}isHardforkBlock(e,t){let r=dF(e,j.BigInt),n=null!=t?t:this._hardfork,i=this.hardforkBlock(n);return"bigint"==typeof i&&i!==BigInt(0)&&i===r}nextHardforkBlockOrTimestamp(e){var t,r,n;let i=null!=(t=e)?t:this._hardfork,s=this.hardforks(),o=s.findIndex(e=>e.name===i);if(i===O.Merge&&(o-=1),o<0)return null;let a=null!=(r=s[o].timestamp)?r:s[o].block;a=null!=a?Number(a):null;let l=s.slice(o+1).find(e=>{var t;let r=null!=(t=e.timestamp)?t:e.block;return r=null!=r?Number(r):null,e.name!==O.Merge&&null!=r&&r!==a});if(void 0===l)return null;let c=null!=(n=l.timestamp)?n:l.block;return null==c?null:BigInt(c)}nextHardforkBlock(e){var t;let r=null!=(t=e)?t:this._hardfork,n=this.hardforkBlock(r);if(null===n&&r===O.Merge){let e=this.hardforks(),t=e.findIndex(e=>null!==e.ttd&&void 0!==e.ttd);if(t<0)throw Error("Merge hardfork should have been found");n=this.hardforkBlock(e[t-1].name)}return null===n?null:this.hardforks().reduce((e,t)=>{let r=BigInt(null===t.block||void 0!==t.ttd&&null!==t.ttd?0:t.block);return r>n&&null===e?r:e},null)}isNextHardforkBlock(e,t){let r=dF(e,j.BigInt),n=null!=t?t:this._hardfork,i=this.nextHardforkBlock(n);return null!==i&&i===r}_calcForkHash(e,t){let r=new Uint8Array,n=0;for(let t of this.hardforks()){let{block:i,timestamp:s,name:o}=t,a=null!=s?s:i;if("number"==typeof(a=null!==a?Number(a):null)&&0!==a&&a!==n&&o!==O.Merge&&(r=av(r,aI(a.toString(16).padStart(16,"0"))),n=a),t.name===e)break}return a_(dx(dG(av(t,r))>>>0))}forkHash(e,t){let r=null!=e?e:this._hardfork,n=this._getHardfork(r);if(null===n||(null==n?void 0:n.block)===null&&(null==n?void 0:n.timestamp)===void 0&&(null==n?void 0:n.ttd)===void 0)throw Error("No fork hash calculation possible for future hardfork");if((null==n?void 0:n.forkHash)!==null&&(null==n?void 0:n.forkHash)!==void 0)return n.forkHash;if(!t)throw Error("genesisHash required for forkHash calculation");return this._calcForkHash(r,t)}hardforkForForkHash(e){let t=this.hardforks().filter(t=>t.forkHash===e);return t.length>=1?t[t.length-1]:null}setForkHashes(e){var t;for(let r of this.hardforks()){let n=null!=(t=r.timestamp)?t:r.block;(null===r.forkHash||void 0===r.forkHash)&&(null!=n||void 0!==r.ttd)&&(r.forkHash=this.forkHash(r.name,e))}}genesis(){return this._chainParams.genesis}hardforks(){return this._chainParams.hardforks}bootstrapNodes(){return this._chainParams.bootstrapNodes}dnsNetworks(){return this._chainParams.dnsNetworks}hardfork(){return this._hardfork}chainId(){return BigInt(this._chainParams.chainId)}chainName(){return this._chainParams.name}networkId(){return BigInt(this._chainParams.networkId)}eips(){return this._eips}consensusType(){let e,t=this.hardfork();for(let r of this.HARDFORK_CHANGES)if("consensus"in r[1]&&(e=r[1].consensus.type),r[0]===t)break;return null!=e?e:this._chainParams.consensus.type}consensusAlgorithm(){let e,t=this.hardfork();for(let r of this.HARDFORK_CHANGES)if("consensus"in r[1]&&(e=r[1].consensus.algorithm),r[0]===t)break;return null!=e?e:this._chainParams.consensus.algorithm}consensusConfig(){var e;let t,r=this.hardfork();for(let e of this.HARDFORK_CHANGES)if("consensus"in e[1]&&(t=e[1].consensus[e[1].consensus.algorithm]),e[0]===r)break;return null!=(e=null!=t?t:this._chainParams.consensus[this.consensusAlgorithm()])?e:{}}copy(){let e=Object.assign(Object.create(Object.getPrototypeOf(this)),this);return e.removeAllListeners(),e}static _getInitializedChains(e){let t={};for(let[e,r]of Object.entries(B))t[r]=e.toLowerCase();let r={mainnet:d$,goerli:dH,sepolia:dq};if(e)for(let n of e){let{name:e}=n;t[n.chainId.toString()]=e,r[e]=n}return r.names=t,r}}function dW(e){return!!(0===e.length||Array.isArray(e[0]))}function dQ(e){return!dW(e)}!function(e){e[e.EIP155ReplayProtection=155]="EIP155ReplayProtection",e[e.EIP1559FeeMarket=1559]="EIP1559FeeMarket",e[e.EIP2718TypedTransaction=2718]="EIP2718TypedTransaction",e[e.EIP2930AccessLists=2930]="EIP2930AccessLists"}(H||(H={}));class dJ{constructor(e){if(20!==e.length)throw Error("Invalid address length");this.buf=e}static zero(){return new dJ(dI(20))}equals(e){return aE(this.buf,e.buf)}isZero(){return this.equals(dJ.zero())}toString(){return a_(this.buf)}toArray(){return this.buf}static publicToAddress(e,t=!1){let r=e;if(dC(r),t&&64!==r.length&&(r=dh.ProjectivePoint.fromHex(r).toRawBytes(!1).slice(1)),64!==r.length)throw Error("Expected pubKey to be of length 64");return ix(r).slice(-20)}}let dZ=(e,t)=>{let r=e.param("vm","maxInitCodeSize");if(r&&BigInt(t)>r)throw Error(`the initcode size of this transaction is too large: it is ${t} while the max is ${e.param("vm","maxInitCodeSize")}`)},dY=e=>{let t,r;if(dQ(e)){t=e;let n=[];for(let t=0;t<e.length;t+=1){let r=e[t],i=dS(r.address),s=[];for(let e=0;e<r.storageKeys.length;e+=1)s.push(dS(r.storageKeys[e]));n.push([i,s])}r=n}else{r=null!=e?e:[];let n=[];for(let e=0;e<r.length;e+=1){let t=r[e],i=a_(t[0]),s=[];for(let e=0;e<t[1].length;e+=1)s.push(a_(t[1][e]));let o={address:i,storageKeys:s};n.push(o)}t=n}return{AccessListJSON:t,accessList:r}},dX=e=>{for(let t=0;t<e.length;t+=1){let r=e[t],n=r[0],i=r[1];if(void 0!==r[2])throw Error("Access list item cannot have 3 elements. It can only have an address, and an array of storage slots.");if(20!==n.length)throw Error("Invalid EIP-2930 transaction: address length should be 20 bytes");for(let e=0;e<i.length;e+=1)if(32!==i[e].length)throw Error("Invalid EIP-2930 transaction: storage slot length should be 32 bytes")}},d0=e=>{let t=[];for(let r=0;r<e.length;r+=1){let n=e[r],i={address:a_(dP(n[0],20)),storageKeys:[]},s=n&&n[1];for(let e=0;e<s.length;e+=1){let t=s[e];i.storageKeys.push(a_(dP(t,32)))}t.push(i)}return t},d1=(e,t)=>{let r=t.param("gasPrices","accessListStorageKeyCost"),n=t.param("gasPrices","accessListAddressCost"),i=0;for(let t=0;t<e.length;t+=1)i+=e[t][1].length;return e.length*Number(n)+i*Number(r)};class d2{constructor(e,t){var r,n;this.cache={hash:void 0,dataFee:void 0},this.activeCapabilities=[],this.DEFAULT_CHAIN=B.Mainnet,this.DEFAULT_HARDFORK=O.Merge;let{nonce:i,gasLimit:s,to:o,value:a,data:l,v:c,r:u,s:d,type:h}=e;this._type=Number(dk(dS(h))),this.txOptions=t;let f=dS(""===o?"0x":o),p=dS(""===c?"0x":c),g=dS(""===u?"0x":u),m=dS(""===d?"0x":d);this.nonce=dk(dS(""===i?"0x":i)),this.gasLimit=dk(dS(""===s?"0x":s)),this.to=f.length>0?new dJ(f):void 0,this.value=dk(dS(""===a?"0x":a)),this.data=dS(""===l?"0x":l),this.v=p.length>0?dk(p):void 0,this.r=g.length>0?dk(g):void 0,this.s=m.length>0?dk(m):void 0,this._validateCannotExceedMaxInteger({value:this.value,r:this.r,s:this.s}),this._validateCannotExceedMaxInteger({gasLimit:this.gasLimit},64),this._validateCannotExceedMaxInteger({nonce:this.nonce},64,!0);let y=void 0===this.to||null===this.to,b=null!=(r=t.allowUnlimitedInitCodeSize)&&r,w=null!=(n=t.common)?n:this._getCommon();y&&w.isActivatedEIP(3860)&&!b&&dZ(w,this.data.length)}get type(){return this._type}supports(e){return this.activeCapabilities.includes(e)}validate(e=!1){let t=[];return this.getBaseFee()>this.gasLimit&&t.push(`gasLimit is too low. given ${this.gasLimit}, need at least ${this.getBaseFee()}`),this.isSigned()&&!this.verifySignature()&&t.push("Invalid Signature"),e?t:0===t.length}_validateYParity(){let{v:e}=this;if(void 0!==e&&e!==BigInt(0)&&e!==BigInt(1))throw Error(this._errorMsg("The y-parity of the transaction should either be 0 or 1"))}_validateHighS(){let{s:e}=this;if(this.common.gteHardfork("homestead")&&void 0!==e&&e>dg)throw Error(this._errorMsg("Invalid Signature: s-values greater than secp256k1n/2 are considered invalid"))}getBaseFee(){let e=this.common.param("gasPrices","tx"),t=this.getDataFee();if(e&&(t+=e),this.common.gteHardfork("homestead")&&this.toCreationAddress()){let e=this.common.param("gasPrices","txCreation");e&&(t+=e)}return t}getDataFee(){let e=this.common.param("gasPrices","txDataZero"),t=this.common.param("gasPrices","txDataNonZero"),r=BigInt(0);for(let n=0;n<this.data.length;n+=1)0===this.data[n]?r+=e:r+=t;if((void 0===this.to||null===this.to)&&this.common.isActivatedEIP(3860)){let e=BigInt(Math.ceil(this.data.length/32));r+=this.common.param("gasPrices","initCodeWordCost")*e}return r}toCreationAddress(){return void 0===this.to||0===this.to.buf.length}isSigned(){let{v:e,r:t,s:r}=this;return void 0!==e&&void 0!==t&&void 0!==r}verifySignature(){try{let e=this.getSenderPublicKey();return 0!==dD(e).length}catch(e){return!1}}getSenderAddress(){return new dJ(dJ.publicToAddress(this.getSenderPublicKey()))}sign(e){if(32!==e.length)throw Error(this._errorMsg("Private key must be 32 bytes in length."));let t=!1;0===this.type&&this.common.gteHardfork("spuriousDragon")&&!this.supports(H.EIP155ReplayProtection)&&(this.activeCapabilities.push(H.EIP155ReplayProtection),t=!0);let r=this.getMessageToSign(!0),{v:n,r:i,s}=this._ecsign(r,e),o=this._processSignature(n,i,s);if(t){let e=this.activeCapabilities.indexOf(H.EIP155ReplayProtection);e>-1&&this.activeCapabilities.splice(e,1)}return o}_getCommon(e,t){var r,n,i,s;if(void 0!==t){let r=dk(dS(t));if(e){if(e.chainId()!==r)throw Error(this._errorMsg("The chain ID does not match the chain ID of Common"));return e.copy()}return dK.isSupportedChainId(r)?new dK({chain:r,hardfork:this.DEFAULT_HARDFORK}):dK.custom({name:"custom-chain",networkId:r,chainId:r},{baseChain:this.DEFAULT_CHAIN,hardfork:this.DEFAULT_HARDFORK})}if((null==e?void 0:e.copy)&&"function"==typeof(null==e?void 0:e.copy))return e.copy();if(e){let t="function"==typeof e.hardfork?e.hardfork():e.hardfork;return dK.custom({name:"custom-chain",networkId:e.networkId?e.networkId():null!=(n=BigInt(null==(r=e.customChain)?void 0:r.networkId))?n:void 0,chainId:e.chainId?e.chainId():null!=(s=BigInt(null==(i=e.customChain)?void 0:i.chainId))?s:void 0},{baseChain:this.DEFAULT_CHAIN,hardfork:t||this.DEFAULT_HARDFORK})}return new dK({chain:this.DEFAULT_CHAIN,hardfork:this.DEFAULT_HARDFORK})}_validateCannotExceedMaxInteger(e,t=256,r=!1){for(let[n,i]of Object.entries(e))switch(t){case 64:if(r){if(void 0!==i&&i>=df)throw Error(this._errorMsg(`${n} cannot equal or exceed MAX_UINT64 (2^64-1), given ${i}`))}else if(void 0!==i&&i>df)throw Error(this._errorMsg(`${n} cannot exceed MAX_UINT64 (2^64-1), given ${i}`));break;case 256:if(r){if(void 0!==i&&i>=dp)throw Error(this._errorMsg(`${n} cannot equal or exceed MAX_INTEGER (2^256-1), given ${i}`))}else if(void 0!==i&&i>dp)throw Error(this._errorMsg(`${n} cannot exceed MAX_INTEGER (2^256-1), given ${i}`));break;default:throw Error(this._errorMsg("unimplemented bits value"))}}static _validateNotArray(e){let t=["nonce","gasPrice","gasLimit","to","value","data","v","r","s","type","baseFee","maxFeePerGas","chainId"];for(let[r,n]of Object.entries(e))if(t.includes(r)&&Array.isArray(n))throw Error(`${r} cannot be an array`)}_getSharedErrorPostfix(){let e="";try{e=this.isSigned()?a_(this.hash()):"not available (unsigned)"}catch(t){e="error"}let t="";try{t=this.isSigned().toString()}catch(t){e="error"}let r="";try{r=this.common.hardfork()}catch(e){r="error"}let n=`tx type=${this.type} hash=${e} nonce=${this.nonce} value=${this.value} `;return n+`signed=${t} hf=${r}`}_ecsign(e,t,r){let n=dh.sign(e,t),i=n.toCompactRawBytes(),s=i.subarray(0,32);return{r:s,s:i.subarray(32,64),v:void 0===r?BigInt(n.recovery+27):BigInt(n.recovery+35)+BigInt(r)*BigInt(2)}}static fromSerializedTx(e,t={}){}static fromTxData(e,t={}){}}let d3=2,d4=aI("2".padStart(2,"0"));class d5 extends d2{static fromTxData(e,t={}){return new d5(e,t)}static fromSerializedTx(e,t={}){if(!aE(e.subarray(0,1),d4))throw Error(`Invalid serialized tx input: not an EIP-1559 transaction (wrong tx type, expected: ${d3}, received: ${a_(e.subarray(0,1))}`);let r=dU.Tj.decode(e.subarray(1));if(!Array.isArray(r))throw Error("Invalid serialized tx input: must be array");return d5.fromValuesArray(r,t)}static fromValuesArray(e,t={}){if(9!==e.length&&12!==e.length)throw Error("Invalid EIP-1559 transaction. Only expecting 9 values (for unsigned tx) or 12 values (for signed tx).");let[r,n,i,s,o,a,l,c,u,d,h,f]=e;return this._validateNotArray({chainId:r,v:d}),oU({nonce:n,maxPriorityFeePerGas:i,maxFeePerGas:s,gasLimit:o,value:l,v:d,r:h,s:f}),new d5({chainId:dk(r),nonce:n,maxPriorityFeePerGas:i,maxFeePerGas:s,gasLimit:o,to:a,value:l,data:c,accessList:null!=u?u:[],v:void 0!==d?dk(d):void 0,r:h,s:f},t)}constructor(e,t={}){var r;super(Object.assign(Object.assign({},e),{type:d3}),t),this.DEFAULT_HARDFORK="london";let{chainId:n,accessList:i,maxFeePerGas:s,maxPriorityFeePerGas:o}=e;if(this.common=this._getCommon(t.common,n),this.chainId=this.common.chainId(),!this.common.isActivatedEIP(1559))throw Error("EIP-1559 not enabled on Common");this.activeCapabilities=this.activeCapabilities.concat([1559,2718,2930]);let a=dY(null!=i?i:[]);if(this.accessList=a.accessList,this.AccessListJSON=a.AccessListJSON,dX(this.accessList),this.maxFeePerGas=dk(dS(""===s?"0x":s)),this.maxPriorityFeePerGas=dk(dS(""===o?"0x":o)),this._validateCannotExceedMaxInteger({maxFeePerGas:this.maxFeePerGas,maxPriorityFeePerGas:this.maxPriorityFeePerGas}),d2._validateNotArray(e),this.gasLimit*this.maxFeePerGas>dp)throw Error(this._errorMsg("gasLimit * maxFeePerGas cannot exceed MAX_INTEGER (2^256-1)"));if(this.maxFeePerGas<this.maxPriorityFeePerGas)throw Error(this._errorMsg("maxFeePerGas cannot be less than maxPriorityFeePerGas (The total must be the larger of the two)"));this._validateYParity(),this._validateHighS(),(null==(r=null==t?void 0:t.freeze)||r)&&Object.freeze(this)}getDataFee(){if(this.cache.dataFee&&this.cache.dataFee.hardfork===this.common.hardfork())return this.cache.dataFee.value;let e=super.getDataFee();return e+=BigInt(d1(this.accessList,this.common)),Object.isFrozen(this)&&(this.cache.dataFee={value:e,hardfork:this.common.hardfork()}),e}getUpfrontCost(e=BigInt(0)){let t=this.maxPriorityFeePerGas,r=this.maxFeePerGas-e,n=(t<r?t:r)+e;return this.gasLimit*n+this.value}raw(){return[dM(this.chainId),dM(this.nonce),dM(this.maxPriorityFeePerGas),dM(this.maxFeePerGas),dM(this.gasLimit),void 0!==this.to?this.to.buf:Uint8Array.from([]),dM(this.value),this.data,this.accessList,void 0!==this.v?dM(this.v):Uint8Array.from([]),void 0!==this.r?dM(this.r):Uint8Array.from([]),void 0!==this.s?dM(this.s):Uint8Array.from([])]}serialize(){let e=this.raw();return av(d4,dU.Tj.encode(e))}getMessageToSign(e=!0){let t=this.raw().slice(0,9),r=av(d4,dU.Tj.encode(t));return e?ix(r):r}hash(){if(!this.isSigned())throw Error(this._errorMsg("Cannot call hash method if transaction is not signed"));return Object.isFrozen(this)?(this.cache.hash||(this.cache.hash=ix(this.serialize())),this.cache.hash):ix(this.serialize())}getMessageToVerifySignature(){return this.getMessageToSign()}getSenderPublicKey(){if(!this.isSigned())throw Error(this._errorMsg("Cannot call this method if transaction is not signed"));let e=this.getMessageToVerifySignature(),{v:t,r,s:n}=this;this._validateHighS();try{return dL(e,t+BigInt(27),dM(r),dM(n))}catch(e){throw Error(this._errorMsg("Invalid Signature"))}}_processSignature(e,t,r){let n=Object.assign(Object.assign({},this.txOptions),{common:this.common});return d5.fromTxData({chainId:this.chainId,nonce:this.nonce,maxPriorityFeePerGas:this.maxPriorityFeePerGas,maxFeePerGas:this.maxFeePerGas,gasLimit:this.gasLimit,to:this.to,value:this.value,data:this.data,accessList:this.accessList,v:e-BigInt(27),r:dk(t),s:dk(r)},n)}toJSON(){let e=d0(this.accessList);return{chainId:dN(this.chainId),nonce:dN(this.nonce),maxPriorityFeePerGas:dN(this.maxPriorityFeePerGas),maxFeePerGas:dN(this.maxFeePerGas),gasLimit:dN(this.gasLimit),to:void 0!==this.to?this.to.toString():void 0,value:dN(this.value),data:a_(this.data),accessList:e,v:void 0!==this.v?dN(this.v):void 0,r:void 0!==this.r?dN(this.r):void 0,s:void 0!==this.s?dN(this.s):void 0}}errorStr(){let e=this._getSharedErrorPostfix();return e+` maxFeePerGas=${this.maxFeePerGas} maxPriorityFeePerGas=${this.maxPriorityFeePerGas}`}_errorMsg(e){return`${e} (${this.errorStr()})`}}let d6=1,d8=aI("1".padStart(2,"0"));class d7 extends d2{static fromTxData(e,t={}){return new d7(e,t)}static fromSerializedTx(e,t={}){if(!aE(e.subarray(0,1),d8))throw Error(`Invalid serialized tx input: not an EIP-2930 transaction (wrong tx type, expected: ${d6}, received: ${a_(e.subarray(0,1))}`);let r=dU.Tj.decode(Uint8Array.from(e.subarray(1)));if(!Array.isArray(r))throw Error("Invalid serialized tx input: must be array");return d7.fromValuesArray(r,t)}static fromValuesArray(e,t={}){if(8!==e.length&&11!==e.length)throw Error("Invalid EIP-2930 transaction. Only expecting 8 values (for unsigned tx) or 11 values (for signed tx).");let[r,n,i,s,o,a,l,c,u,d,h]=e;this._validateNotArray({chainId:r,v:u}),oU({nonce:n,gasPrice:i,gasLimit:s,value:a,v:u,r:d,s:h});let f=[];return new d7({chainId:dk(r),nonce:n,gasPrice:i,gasLimit:s,to:o,value:a,data:l,accessList:null!=c?c:f,v:void 0!==u?dk(u):void 0,r:d,s:h},t)}constructor(e,t={}){var r;super(Object.assign(Object.assign({},e),{type:d6}),t),this.DEFAULT_HARDFORK="berlin";let{chainId:n,accessList:i,gasPrice:s}=e;if(this.common=this._getCommon(t.common,n),this.chainId=this.common.chainId(),!this.common.isActivatedEIP(2930))throw Error("EIP-2930 not enabled on Common");this.activeCapabilities=this.activeCapabilities.concat([2718,2930]);let o=dY(null!=i?i:[]);if(this.accessList=o.accessList,this.AccessListJSON=o.AccessListJSON,dX(this.accessList),this.gasPrice=dk(dS(""===s?"0x":s)),this._validateCannotExceedMaxInteger({gasPrice:this.gasPrice}),d2._validateNotArray(e),this.gasPrice*this.gasLimit>dp)throw Error(this._errorMsg("gasLimit * gasPrice cannot exceed MAX_INTEGER"));this._validateYParity(),this._validateHighS(),(null==(r=null==t?void 0:t.freeze)||r)&&Object.freeze(this)}getDataFee(){if(this.cache.dataFee&&this.cache.dataFee.hardfork===this.common.hardfork())return this.cache.dataFee.value;let e=super.getDataFee();return e+=BigInt(d1(this.accessList,this.common)),Object.isFrozen(this)&&(this.cache.dataFee={value:e,hardfork:this.common.hardfork()}),e}getUpfrontCost(){return this.gasLimit*this.gasPrice+this.value}raw(){return[dM(this.chainId),dM(this.nonce),dM(this.gasPrice),dM(this.gasLimit),void 0!==this.to?this.to.buf:Uint8Array.from([]),dM(this.value),this.data,this.accessList,void 0!==this.v?dM(this.v):Uint8Array.from([]),void 0!==this.r?dM(this.r):Uint8Array.from([]),void 0!==this.s?dM(this.s):Uint8Array.from([])]}serialize(){let e=this.raw();return av(d8,dU.Tj.encode(e))}getMessageToSign(e=!0){let t=this.raw().slice(0,8),r=av(d8,dU.Tj.encode(t));return e?ix(r):r}hash(){if(!this.isSigned())throw Error(this._errorMsg("Cannot call hash method if transaction is not signed"));return Object.isFrozen(this)?(this.cache.hash||(this.cache.hash=ix(this.serialize())),this.cache.hash):ix(this.serialize())}getMessageToVerifySignature(){return this.getMessageToSign()}getSenderPublicKey(){if(!this.isSigned())throw Error(this._errorMsg("Cannot call this method if transaction is not signed"));let e=this.getMessageToVerifySignature(),{v:t,r,s:n}=this;this._validateHighS();try{return dL(e,t+BigInt(27),dM(r),dM(n))}catch(e){throw Error(this._errorMsg("Invalid Signature"))}}_processSignature(e,t,r){let n=Object.assign(Object.assign({},this.txOptions),{common:this.common});return d7.fromTxData({chainId:this.chainId,nonce:this.nonce,gasPrice:this.gasPrice,gasLimit:this.gasLimit,to:this.to,value:this.value,data:this.data,accessList:this.accessList,v:e-BigInt(27),r:dk(t),s:dk(r)},n)}toJSON(){let e=d0(this.accessList);return{chainId:dN(this.chainId),nonce:dN(this.nonce),gasPrice:dN(this.gasPrice),gasLimit:dN(this.gasLimit),to:void 0!==this.to?this.to.toString():void 0,value:dN(this.value),data:a_(this.data),accessList:e,v:void 0!==this.v?dN(this.v):void 0,r:void 0!==this.r?dN(this.r):void 0,s:void 0!==this.s?dN(this.s):void 0}}errorStr(){var e,t;let r=this._getSharedErrorPostfix();return r+` gasPrice=${this.gasPrice} accessListCount=${null!=(t=null==(e=this.accessList)?void 0:e.length)?t:0}`}_errorMsg(e){return`${e} (${this.errorStr()})`}}let d9=0;function he(e,t){let r=Number(e),n=2*Number(t);return r===n+35||r===n+36}class ht extends d2{static fromTxData(e,t={}){return new ht(e,t)}static fromSerializedTx(e,t={}){let r=dU.Tj.decode(e);if(!Array.isArray(r))throw Error("Invalid serialized tx input. Must be array");return this.fromValuesArray(r,t)}static fromValuesArray(e,t={}){if(6!==e.length&&9!==e.length)throw Error("Invalid transaction. Only expecting 6 values (for unsigned tx) or 9 values (for signed tx).");let[r,n,i,s,o,a,l,c,u]=e;return oU({nonce:r,gasPrice:n,gasLimit:i,value:o,v:l,r:c,s:u}),new ht({nonce:r,gasPrice:n,gasLimit:i,to:s,value:o,data:a,v:l,r:c,s:u},t)}constructor(e,t={}){var r;if(super(Object.assign(Object.assign({},e),{type:d9}),t),this.common=this._validateTxV(this.v,t.common),this.gasPrice=dk(dS(""===e.gasPrice?"0x":e.gasPrice)),this.gasPrice*this.gasLimit>dp)throw Error(this._errorMsg("gas limit * gasPrice cannot exceed MAX_INTEGER (2^256-1)"));this._validateCannotExceedMaxInteger({gasPrice:this.gasPrice}),d2._validateNotArray(e),this.common.gteHardfork("spuriousDragon")&&(this.isSigned()?he(this.v,this.common.chainId())&&this.activeCapabilities.push(H.EIP155ReplayProtection):this.activeCapabilities.push(H.EIP155ReplayProtection)),(null==(r=null==t?void 0:t.freeze)||r)&&Object.freeze(this)}raw(){return[dM(this.nonce),dM(this.gasPrice),dM(this.gasLimit),void 0!==this.to?this.to.buf:Uint8Array.from([]),dM(this.value),this.data,void 0!==this.v?dM(this.v):Uint8Array.from([]),void 0!==this.r?dM(this.r):Uint8Array.from([]),void 0!==this.s?dM(this.s):Uint8Array.from([])]}serialize(){return dU.Tj.encode(this.raw())}_getMessageToSign(){let e=[dM(this.nonce),dM(this.gasPrice),dM(this.gasLimit),void 0!==this.to?this.to.buf:Uint8Array.from([]),dM(this.value),this.data];return this.supports(H.EIP155ReplayProtection)&&(e.push(dS(this.common.chainId())),e.push(dD(dS(0))),e.push(dD(dS(0)))),e}getMessageToSign(e=!0){let t=this._getMessageToSign();return e?ix(dU.Tj.encode(t)):t}getDataFee(){return this.cache.dataFee&&this.cache.dataFee.hardfork===this.common.hardfork()?this.cache.dataFee.value:(Object.isFrozen(this)&&(this.cache.dataFee={value:super.getDataFee(),hardfork:this.common.hardfork()}),super.getDataFee())}getUpfrontCost(){return this.gasLimit*this.gasPrice+this.value}hash(){if(!this.isSigned())throw Error(this._errorMsg("Cannot call hash method if transaction is not signed"));return Object.isFrozen(this)?(this.cache.hash||(this.cache.hash=ix(dU.Tj.encode(this.raw()))),this.cache.hash):ix(dU.Tj.encode(this.raw()))}getMessageToVerifySignature(){if(!this.isSigned())throw Error(this._errorMsg("This transaction is not signed"));let e=this._getMessageToSign();return ix(dU.Tj.encode(e))}getSenderPublicKey(){let e=this.getMessageToVerifySignature(),{v:t,r,s:n}=this;this._validateHighS();try{return dL(e,t,dM(r),dM(n),this.supports(H.EIP155ReplayProtection)?this.common.chainId():void 0)}catch(e){throw Error(this._errorMsg("Invalid Signature"))}}_processSignature(e,t,r){let n=e;this.supports(H.EIP155ReplayProtection)&&(n+=this.common.chainId()*BigInt(2)+BigInt(8));let i=Object.assign(Object.assign({},this.txOptions),{common:this.common});return ht.fromTxData({nonce:this.nonce,gasPrice:this.gasPrice,gasLimit:this.gasLimit,to:this.to,value:this.value,data:this.data,v:n,r:dk(t),s:dk(r)},i)}toJSON(){return{nonce:dN(this.nonce),gasPrice:dN(this.gasPrice),gasLimit:dN(this.gasLimit),to:void 0!==this.to?this.to.toString():void 0,value:dN(this.value),data:a_(this.data),v:void 0!==this.v?dN(this.v):void 0,r:void 0!==this.r?dN(this.r):void 0,s:void 0!==this.s?dN(this.s):void 0}}_validateTxV(e,t){let r,n=void 0!==e?Number(e):void 0;if(void 0!==n&&n<37&&27!==n&&28!==n)throw Error(`Legacy txs need either v = 27/28 or v >= 37 (EIP-155 replay protection), got v = ${n}`);if(void 0!==n&&0!==n&&(!t||t.gteHardfork("spuriousDragon"))&&27!==n&&28!==n)if(t){if(!he(BigInt(n),t.chainId()))throw Error(`Incompatible EIP155-based V ${n} and chain id ${t.chainId()}. See the Common parameter of the Transaction constructor to set the chain id.`)}else{let e;e=(n-35)%2==0?35:36,r=BigInt(n-e)/BigInt(2)}return this._getCommon(t,r)}errorStr(){let e=this._getSharedErrorPostfix();return e+` gasPrice=${this.gasPrice}`}_errorMsg(e){return`${e} (${this.errorStr()})`}}let hr=new Map;class hn{constructor(){}static typeToInt(e){return Number(dk(dS(e)))}static registerTransactionType(e,t){let r=hn.typeToInt(e);hr.set(r,t)}static fromTxData(e,t={}){if(!("type"in e)||void 0===e.type)return ht.fromTxData(e,t);let r=hn.typeToInt(e.type);if(0===r)return ht.fromTxData(e,t);if(1===r)return d7.fromTxData(e,t);if(2===r)return d5.fromTxData(e,t);let n=hr.get(r);if(null==n?void 0:n.fromTxData)return n.fromTxData(e,t);throw Error(`Tx instantiation with type ${r} not supported`)}static fromSerializedData(e,t={}){if(!(e[0]<=127))return ht.fromSerializedTx(e,t);switch(e[0]){case 1:return d7.fromSerializedTx(e,t);case 2:return d5.fromSerializedTx(e,t);default:{let r=hr.get(Number(e[0]));if(null==r?void 0:r.fromSerializedTx)return r.fromSerializedTx(e,t);throw Error(`TypedTransaction with ID ${e[0]} unknown`)}}}static fromBlockBodyData(e,t={}){if(aw(e))return this.fromSerializedData(e,t);if(Array.isArray(e))return ht.fromValuesArray(e,t);throw Error("Cannot decode transaction: unknown type input")}}var hi=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let hs=(e,t)=>{let r;if(!t&&"string"==typeof e&&oB(e)&&66!==e.length)throw new tW;try{r=aw(e)?e:aS(e)}catch(e){throw new tQ}if(!t&&32!==r.byteLength)throw new tW;return r},ho=(e,t=!1)=>{let r=aI(oB(e)?e:aN(e)),n=aI(aM(`\x19Ethereum Signed Message:
${r.byteLength}`));return lv(t?r:av(n,r))},ha=(e,t)=>{let r=hs(t),n=dh.sign(e.substring(2),r),i=n.toCompactRawBytes(),s=n.r.toString(16).padStart(64,"0"),o=n.s.toString(16).padStart(64,"0"),a=n.recovery+27;return{messageHash:e,v:aP(a),r:`0x${s}`,s:`0x${o}`,signature:`${a_(i)}${a.toString(16)}`}},hl=(e,t)=>{let{messageHash:r,v:n,r:i,s,signature:o}=ha(ho(e),t);return{message:e,messageHash:r,v:n,r:i,s,signature:o}},hc=(e,t)=>hi(void 0,void 0,void 0,function*(){let r=e.sign(aI(t));if(al(r.v)||al(r.r)||al(r.s))throw new rY("Signer Error");let n=r.validate(!0);if(n.length>0){let e="Signer Error ";for(let t of n)e+=`${e} ${t}.`;throw new rY(e)}let i=a_(r.serialize()),s=lv(i);return{messageHash:a_(r.getMessageToSign(!0)),v:`0x${r.v.toString(16)}`,r:`0x${r.r.toString(16).padStart(64,"0")}`,s:`0x${r.s.toString(16).padStart(64,"0")}`,rawTransaction:i,transactionHash:a_(s)}}),hu=e=>{if(al(e))throw new rE;return aQ(hn.fromSerializedData(aI(e)).getSenderAddress().toString())},hd=(e,t,r,n,i)=>{if("object"==typeof e){let t=`${e.r}${e.s.slice(2)}${e.v.slice(2)}`;return hd(e.messageHash,t,r)}if("string"==typeof t&&"string"==typeof r&&!al(n))return hd(e,`${r}${n.slice(2)}${t.slice(2)}`,i);if(al(t))throw new tJ("signature string undefined");let s=130,o=r?e:ho(e),a=parseInt(t.substring(s),16);a>26&&(a-=27);let l=lv(dh.Signature.fromCompact(t.slice(2,s)).addRecoveryBit(a).recoverPublicKey(o.replace("0x","")).toRawBytes(!1).subarray(1));return aQ(`0x${l.slice(-40)}`)},hh=e=>{let t=hs(e),r=lv(dh.getPublicKey(t,!1).slice(1)).slice(-40);return aQ(`0x${r}`)},hf=(e,t)=>{let r=hs(e);return`0x${a_(dh.getPublicKey(r,t)).slice(4)}`},hp=(e,t,r)=>hi(void 0,void 0,void 0,function*(){var n,i,s,o,a,l,c;let u,d,h,f,p=hs(e);if(u=(null==r?void 0:r.salt)?"string"==typeof r.salt?aI(r.salt):r.salt:lD(32),!(oM(t)||aw(t)))throw new t0;let g="string"==typeof t?aI(aN(t)):t;if(null==r?void 0:r.iv){if(16!==(d="string"==typeof r.iv?aI(r.iv):r.iv).length)throw new t1}else d=lD(16);let m=null!=(n=null==r?void 0:r.kdf)?n:"scrypt";if("pbkdf2"===m){if((f={dklen:null!=(i=null==r?void 0:r.dklen)?i:32,salt:a_(u).replace("0x",""),c:null!=(s=null==r?void 0:r.c)?s:262144,prf:"hmac-sha256"}).c<1e3)throw new t2;h=cQ(g,u,f.c,f.dklen,"sha256")}else if("scrypt"===m)f={n:null!=(o=null==r?void 0:r.n)?o:8192,r:null!=(a=null==r?void 0:r.r)?a:8,p:null!=(l=null==r?void 0:r.p)?l:1,dklen:null!=(c=null==r?void 0:r.dklen)?c:32,salt:a_(u).replace("0x","")},h=c1(g,u,f.n,f.p,f.r,f.dklen);else throw new tZ;let y=yield c_(p,h.slice(0,16),d,"aes-128-ctr"),b=a_(y).slice(2),w=lv(av(h.slice(16,32),y)).replace("0x","");return{version:3,id:lH(),address:hh(p).toLowerCase().replace("0x",""),crypto:{ciphertext:b,cipherparams:{iv:a_(d).replace("0x","")},cipher:"aes-128-ctr",kdf:m,kdfparams:f,mac:w}}}),hg=(e,t)=>{let r=hs(e,t);return{address:hh(r),privateKey:a_(r),signTransaction:e=>{throw new rY("Do not have network access to sign the transaction")},sign:e=>hl("string"==typeof e?e:JSON.stringify(e),r),encrypt:(e,t)=>hi(void 0,void 0,void 0,function*(){return hp(r,e,t)})}},hm=()=>{let e=dh.utils.randomPrivateKey();return hg(`${a_(e)}`)},hy=(e,t,r)=>hi(void 0,void 0,void 0,function*(){let n,i="object"==typeof e?e:JSON.parse(r?e.toLowerCase():e);if(ab.validateJSONSchema(dm,i),3!==i.version)throw new tX;let s="string"==typeof t?aI(aN(t)):t;if(ab.validate(["bytes"],[s]),"scrypt"===i.crypto.kdf){let e=i.crypto.kdfparams;n=c1(s,"string"==typeof e.salt?aI(e.salt):e.salt,e.n,e.p,e.r,e.dklen)}else if("pbkdf2"===i.crypto.kdf){let e=i.crypto.kdfparams;n=cQ(s,"string"==typeof e.salt?aI(e.salt):e.salt,e.c,e.dklen,"sha256")}else throw new tZ;let o=aI(i.crypto.ciphertext);if(lv(av(n.slice(16,32),o)).replace("0x","")!==i.crypto.mac)throw new tY;return hg((yield cT(aI(i.crypto.ciphertext),n.slice(0,16),aI(i.crypto.cipherparams.iv))))});var hb=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let hw=1e3;class hv{constructor(e){this._requestManager=e,this._requests=new Map}get requests(){return[...this._requests.values()].map(e=>e.payload)}add(e){let t=lZ(e),r=new l1;return this._requests.set(t.id,{payload:t,promise:r}),r}execute(e){return hb(this,void 0,void 0,function*(){var t;if(0===this.requests.length)return Promise.resolve([]);let r=new l1({timeout:null!=(t=null==e?void 0:e.timeout)?t:hw,eagerStart:!0,timeoutMessage:"Batch request timeout"});return this._processBatchRequest(r).catch(e=>r.reject(e)),r.catch(e=>{e instanceof rl&&this._abortAllRequests("Batch request timeout"),r.reject(e)}),r})}_processBatchRequest(e){return hb(this,void 0,void 0,function*(){var t,r;let n=yield this._requestManager.sendBatch([...this._requests.values()].map(e=>e.payload));if(n.length!==this._requests.size)throw this._abortAllRequests("Invalid batch response"),new no(n,`Batch request size mismatch the results size. Requests: ${this._requests.size}, Responses: ${n.length}`);let i=this.requests.map(e=>e.id).map(Number).sort((e,t)=>e-t),s=n.map(e=>e.id).map(Number).sort((e,t)=>e-t);if(JSON.stringify(i)!==JSON.stringify(s))throw this._abortAllRequests("Invalid batch response"),new no(n,`Batch request mismatch the results. Requests: [${i.join()}], Responses: [${s.join()}]`);for(let e of n)lq(e)?null==(t=this._requests.get(e.id))||t.promise.resolve(e.result):lz(e)&&(null==(r=this._requests.get(e.id))||r.promise.reject(e.error));e.resolve(n)})}_abortAllRequests(e){for(let{promise:t}of this._requests.values())t.reject(new rc(e))}}var hE=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class hA extends ce{constructor(e){var t;if(super(),this.providers=cm.providers,lt(e)||"string"==typeof e&&""!==e.trim()||ch(e)){this._requestManager=new cm(e),this._subscriptionManager=new cb(this._requestManager,{});return}let{config:r,provider:n,requestManager:i,subscriptionManager:s,registeredSubscriptions:o,accountProvider:a,wallet:l,requestManagerMiddleware:c}=e;this.setConfig(null!=r?r:{}),this._requestManager=null!=i?i:new cm(n,null==(t=null==r?void 0:r.enableExperimentalFeatures)?void 0:t.useSubscriptionWhenCheckingBlockTimeout,c),s?this._subscriptionManager=s:this._subscriptionManager=new cb(this.requestManager,null!=o?o:{}),a&&(this._accountProvider=a),l&&(this._wallet=l)}get requestManager(){return this._requestManager}get subscriptionManager(){return this._subscriptionManager}get wallet(){return this._wallet}get accountProvider(){return this._accountProvider}static fromContextObject(...e){return new this(...e.reverse())}getContextObject(){var e;return{config:this.config,provider:this.provider,requestManager:this.requestManager,subscriptionManager:this.subscriptionManager,registeredSubscriptions:null==(e=this.subscriptionManager)?void 0:e.registeredSubscriptions,providers:this.providers,wallet:this.wallet,accountProvider:this.accountProvider}}use(e,...t){let r=new e(...[...t,this.getContextObject()]);return this.on(D.CONFIG_CHANGE,e=>{r.setConfig({[e.name]:e.newValue})}),this[e.name]=r,r}link(e){this.setConfig(e.config),this._requestManager=e.requestManager,this.provider=e.provider,this._subscriptionManager=e.subscriptionManager,this._wallet=e.wallet,this._accountProvider=e._accountProvider,e.on(D.CONFIG_CHANGE,e=>{this.setConfig({[e.name]:e.newValue})})}registerPlugin(e){if(void 0!==this[e.pluginNamespace])throw new rd(e.pluginNamespace);let t={[e.pluginNamespace]:e};t[e.pluginNamespace].link(this),Object.assign(this,t)}get provider(){return this.currentProvider}set provider(e){this.requestManager.setProvider(e)}get currentProvider(){return this.requestManager.provider}set currentProvider(e){this.requestManager.setProvider(e)}get givenProvider(){return hA.givenProvider}setProvider(e){return this.provider=e,!0}setRequestManagerMiddleware(e){this.requestManager.setMiddleware(e)}get BatchRequest(){return hv.bind(void 0,this._requestManager)}extend(e){var t;return e.property&&!this[e.property]&&(this[e.property]={}),null==(t=e.methods)||t.forEach(t=>{let r=(...e)=>hE(this,void 0,void 0,function*(){return this.requestManager.send({method:t.call,params:e})});e.property?this[e.property][t.name]=r:this[t.name]=r}),this}}hA.providers=cm.providers;class hx{constructor(e){if(this.toAddress=()=>{if(this.isDirect()){let e=this._iban.slice(4);return aQ(la(hx._parseInt(e,36),40))}throw Error("Iban is indirect and cannot be converted. Must be length of 34 or 35")},hx.isIndirect(e)||hx.isDirect(e))this._iban=e;else throw Error("Invalid IBAN was provided")}static isDirect(e){return 34===e.length||35===e.length}isDirect(){return hx.isDirect(this._iban)}static isIndirect(e){return 20===e.length}isIndirect(){return hx.isIndirect(this._iban)}static isValid(e){return/^XE[0-9]{2}(ETH[0-9A-Z]{13}|[0-9A-Z]{30,31})$/.test(e)&&1===hx._mod9710(hx._iso13616Prepare(e))}isValid(){return hx.isValid(this._iban)}static fromBban(e){let t="XE",r=this._mod9710(this._iso13616Prepare(`${t}00${e}`)),n=`0${(98-r).toString()}`.slice(-2);return new hx(`${t}${n}${e}`)}static createIndirect(e){return hx.fromBban(`ETH${e.institution}${e.identifier}`)}static fromAddress(e){if(!o5(e))throw new r3(e);let t=la(BigInt(aT(e)).toString(36),15);return hx.fromBban(t.toUpperCase())}static toIban(e){return hx.fromAddress(e).toString()}client(){return this.isIndirect()?this._iban.slice(11):""}checksum(){return this._iban.slice(2,4)}institution(){return this.isIndirect()?this._iban.slice(7,11):""}toString(){return this._iban}}hx._iso13616Prepare=e=>{let t=65,r=90,n=e.toUpperCase();return`${n.slice(4)}${n.slice(0,4)}`.split("").map(e=>{let n=e.charCodeAt(0);return n>=t&&n<=r?n-t+10:e}).join("")},hx._parseInt=(e,t)=>[...e].reduce((e,r)=>BigInt(parseInt(r,t))+BigInt(t)*e,BigInt(0)),hx._mod9710=e=>{let t,r=e;for(;r.length>2;)t=r.slice(0,9),r=`${(parseInt(t,10)%97).toString()}${r.slice(t.length)}`;return parseInt(r,10)%97},hx.toAddress=e=>new hx(e).toAddress();var hS=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class hk extends l9{constructor(e){super(),this[$]="Promise",this._promise=new Promise(e)}then(e,t){return hS(this,void 0,void 0,function*(){return this._promise.then(e,t)})}catch(e){return hS(this,void 0,void 0,function*(){return this._promise.catch(e)})}finally(e){return hS(this,void 0,void 0,function*(){return this._promise.finally(e)})}on(e,t){return super.on(e,t),this}once(e,t){return super.once(e,t),this}}$=Symbol.toStringTag,r(50271);var h_=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function hI(e){return h_(this,void 0,void 0,function*(){return e.send({method:"eth_protocolVersion",params:[]})})}function hT(e){return h_(this,void 0,void 0,function*(){return e.send({method:"eth_syncing",params:[]})})}function hC(e){return h_(this,void 0,void 0,function*(){return e.send({method:"eth_coinbase",params:[]})})}function hP(e){return h_(this,void 0,void 0,function*(){return e.send({method:"eth_mining",params:[]})})}function hR(e){return h_(this,void 0,void 0,function*(){return e.send({method:"eth_hashrate",params:[]})})}function hD(e){return h_(this,void 0,void 0,function*(){return e.send({method:"eth_gasPrice",params:[]})})}function hN(e){return h_(this,void 0,void 0,function*(){return e.send({method:"eth_maxPriorityFeePerGas",params:[]})})}function hM(e){return h_(this,void 0,void 0,function*(){return e.send({method:"eth_accounts",params:[]})})}function hB(e){return h_(this,void 0,void 0,function*(){return e.send({method:"eth_blockNumber",params:[]})})}function hO(e,t,r){return h_(this,void 0,void 0,function*(){return ab.validate(["address","blockNumberOrTag"],[t,r]),e.send({method:"eth_getBalance",params:[t,r]})})}function hL(e,t,r,n){return h_(this,void 0,void 0,function*(){return ab.validate(["address","hex","blockNumberOrTag"],[t,r,n]),e.send({method:"eth_getStorageAt",params:[t,r,n]})})}function hF(e,t,r){return h_(this,void 0,void 0,function*(){return ab.validate(["address","blockNumberOrTag"],[t,r]),e.send({method:"eth_getTransactionCount",params:[t,r]})})}function hU(e,t){return h_(this,void 0,void 0,function*(){return ab.validate(["bytes32"],[t]),e.send({method:"eth_getBlockTransactionCountByHash",params:[t]})})}function hj(e,t){return h_(this,void 0,void 0,function*(){return ab.validate(["blockNumberOrTag"],[t]),e.send({method:"eth_getBlockTransactionCountByNumber",params:[t]})})}function hH(e,t){return h_(this,void 0,void 0,function*(){return ab.validate(["bytes32"],[t]),e.send({method:"eth_getUncleCountByBlockHash",params:[t]})})}function h$(e,t){return h_(this,void 0,void 0,function*(){return ab.validate(["blockNumberOrTag"],[t]),e.send({method:"eth_getUncleCountByBlockNumber",params:[t]})})}function hq(e,t,r){return h_(this,void 0,void 0,function*(){return ab.validate(["address","blockNumberOrTag"],[t,r]),e.send({method:"eth_getCode",params:[t,r]})})}function hz(e,t,r){return h_(this,void 0,void 0,function*(){return ab.validate(["address","hex"],[t,r]),e.send({method:"eth_sign",params:[t,r]})})}function hV(e,t){return h_(this,void 0,void 0,function*(){return e.send({method:"eth_signTransaction",params:[t]})})}function hG(e,t){return h_(this,void 0,void 0,function*(){return e.send({method:"eth_sendTransaction",params:[t]})})}function hK(e,t){return h_(this,void 0,void 0,function*(){return ab.validate(["hex"],[t]),e.send({method:"eth_sendRawTransaction",params:[t]})})}function hW(e,t,r){return h_(this,void 0,void 0,function*(){return ab.validate(["blockNumberOrTag"],[r]),e.send({method:"eth_call",params:[t,r]})})}function hQ(e,t,r){return h_(this,void 0,void 0,function*(){return ab.validate(["blockNumberOrTag"],[r]),e.send({method:"eth_estimateGas",params:[t,r]})})}function hJ(e,t,r){return h_(this,void 0,void 0,function*(){return ab.validate(["bytes32","bool"],[t,r]),e.send({method:"eth_getBlockByHash",params:[t,r]})})}function hZ(e,t,r){return h_(this,void 0,void 0,function*(){return ab.validate(["blockNumberOrTag","bool"],[t,r]),e.send({method:"eth_getBlockByNumber",params:[t,r]})})}function hY(e,t){return h_(this,void 0,void 0,function*(){return ab.validate(["bytes32"],[t]),e.send({method:"eth_getTransactionByHash",params:[t]})})}function hX(e,t,r){return h_(this,void 0,void 0,function*(){return ab.validate(["bytes32","hex"],[t,r]),e.send({method:"eth_getTransactionByBlockHashAndIndex",params:[t,r]})})}function h0(e,t,r){return h_(this,void 0,void 0,function*(){return ab.validate(["blockNumberOrTag","hex"],[t,r]),e.send({method:"eth_getTransactionByBlockNumberAndIndex",params:[t,r]})})}function h1(e,t){return h_(this,void 0,void 0,function*(){return ab.validate(["bytes32"],[t]),e.send({method:"eth_getTransactionReceipt",params:[t]})})}function h2(e,t,r){return h_(this,void 0,void 0,function*(){return ab.validate(["bytes32","hex"],[t,r]),e.send({method:"eth_getUncleByBlockHashAndIndex",params:[t,r]})})}function h3(e,t,r){return h_(this,void 0,void 0,function*(){return ab.validate(["blockNumberOrTag","hex"],[t,r]),e.send({method:"eth_getUncleByBlockNumberAndIndex",params:[t,r]})})}function h4(e,t){return h_(this,void 0,void 0,function*(){return ab.validate(["filter"],[t]),e.send({method:"eth_newFilter",params:[t]})})}function h5(e){return h_(this,void 0,void 0,function*(){return e.send({method:"eth_newBlockFilter",params:[]})})}function h6(e){return h_(this,void 0,void 0,function*(){return e.send({method:"eth_newPendingTransactionFilter",params:[]})})}function h8(e,t){return h_(this,void 0,void 0,function*(){return ab.validate(["hex"],[t]),e.send({method:"eth_uninstallFilter",params:[t]})})}function h7(e,t){return h_(this,void 0,void 0,function*(){return ab.validate(["hex"],[t]),e.send({method:"eth_getFilterChanges",params:[t]})})}function h9(e,t){return h_(this,void 0,void 0,function*(){return ab.validate(["hex"],[t]),e.send({method:"eth_getFilterLogs",params:[t]})})}function fe(e,t){return h_(this,void 0,void 0,function*(){return ab.validate(["filter"],[t]),e.send({method:"eth_getLogs",params:[t]})})}function ft(e){return h_(this,void 0,void 0,function*(){return e.send({method:"eth_getWork",params:[]})})}function fr(e,t,r,n){return h_(this,void 0,void 0,function*(){return ab.validate(["bytes8","bytes32","bytes32"],[t,r,n]),e.send({method:"eth_submitWork",params:[t,r,n]})})}function fn(e,t,r,n){return h_(this,void 0,void 0,function*(){for(let e of(ab.validate(["hex","blockNumberOrTag"],[t,r]),n))ab.validate(["number"],[e]);return e.send({method:"eth_feeHistory",params:[t,r,n]})})}function fi(e){return h_(this,void 0,void 0,function*(){return e.send({method:"eth_pendingTransactions",params:[]})})}function fs(e){return h_(this,void 0,void 0,function*(){return e.send({method:"eth_requestAccounts",params:[]})})}function fo(e){return h_(this,void 0,void 0,function*(){return e.send({method:"eth_chainId",params:[]})})}function fa(e,t,r,n){return h_(this,void 0,void 0,function*(){return ab.validate(["address","bytes32[]","blockNumberOrTag"],[t,r,n]),e.send({method:"eth_getProof",params:[t,r,n]})})}function fl(e){return h_(this,void 0,void 0,function*(){return e.send({method:"web3_clientVersion",params:[]})})}function fc(e,t,r){return h_(this,void 0,void 0,function*(){return ab.validate(["blockNumberOrTag"],[r]),e.send({method:"eth_createAccessList",params:[t,r]})})}function fu(e,t,r,n=!1){return h_(this,void 0,void 0,function*(){return ab.validate(["address"],[t]),e.send({method:`eth_signTypedData${n?"":"_v4"}`,params:[t,r]})})}var fd=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function fh(e){return fd(this,void 0,void 0,function*(){return e.send({method:"net_version",params:[]})})}function ff(e){return fd(this,void 0,void 0,function*(){return e.send({method:"net_peerCount",params:[]})})}function fp(e){return fd(this,void 0,void 0,function*(){return e.send({method:"net_listening",params:[]})})}var fg=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let fm=e=>fg(void 0,void 0,void 0,function*(){return e.send({method:"personal_listAccounts",params:[]})}),fy=(e,t)=>fg(void 0,void 0,void 0,function*(){return e.send({method:"personal_newAccount",params:[t]})}),fb=(e,t,r,n)=>fg(void 0,void 0,void 0,function*(){return e.send({method:"personal_unlockAccount",params:[t,r,n]})}),fw=(e,t)=>fg(void 0,void 0,void 0,function*(){return e.send({method:"personal_lockAccount",params:[t]})}),fv=(e,t,r)=>fg(void 0,void 0,void 0,function*(){return e.send({method:"personal_importRawKey",params:[t,r]})}),fE=(e,t,r)=>fg(void 0,void 0,void 0,function*(){return e.send({method:"personal_sendTransaction",params:[t,r]})}),fA=(e,t,r)=>fg(void 0,void 0,void 0,function*(){return e.send({method:"personal_signTransaction",params:[t,r]})}),fx=(e,t,r,n)=>fg(void 0,void 0,void 0,function*(){return e.send({method:"personal_sign",params:[t,r,n]})}),fS=(e,t,r)=>fg(void 0,void 0,void 0,function*(){return e.send({method:"personal_ecRecover",params:[t,r]})}),fk={type:"object",properties:{accessList:{type:"null"},maxFeePerGas:{type:"null"},maxPriorityFeePerGas:{type:"null"}}},f_={type:"object",properties:{maxFeePerGas:{type:"null"},maxPriorityFeePerGas:{type:"null"}}},fI={type:"object",properties:{gasPrice:{type:"null"}}},fT=(e,t,r)=>{try{ab.validateJSONSchema(e,t)}catch(e){if(e instanceof oR)throw new r0(e.errors,r);throw e}},fC=e=>{var t,r;let n=e;if(!al(n.type)){let e;switch(n.type){case"0x0":e=fk;break;case"0x1":e=f_;break;case"0x2":e=fI;break;default:return lm({format:"uint"},n.type,Y)}return fT(e,n,n.type),lm({format:"uint"},n.type,Y)}if(!al(n.maxFeePerGas)||!al(n.maxPriorityFeePerGas))return fT(fI,n,"0x2"),"0x2";if(!al(n.accessList))return fT(f_,n,"0x1"),"0x1";let i=null!=(t=n.hardfork)?t:null==(r=n.common)?void 0:r.hardfork;if(!al(i)){let e=Object.keys(S).indexOf(i);if(e>=Object.keys(S).indexOf("london"))return al(n.gasPrice)?"0x2":"0x0";if(e===Object.keys(S).indexOf("berlin"))return"0x0"}if(!al(n.gasPrice))return fT(fk,n,"0x0"),"0x0"},fP=(e,t)=>{var r;return(null!=(r=null==t?void 0:t.transactionTypeParser)?r:fC)(e)},fR=e=>e[0]>127?"0x0":az(e[0]),fD={type:"array",items:Object.assign({},{type:"object",properties:{address:{format:"address"},storageKeys:{type:"array",items:{format:"bytes32"}}}})},fN={type:"object",properties:{accessList:Object.assign({},fD),gasUsed:{type:"string"}}},fM={type:"string",enum:["goerli","kovan","mainnet","rinkeby","ropsten","sepolia"]},fB={type:"string",enum:["arrowGlacier","berlin","byzantium","chainstart","constantinople","dao","homestead","istanbul","london","merge","muirGlacier","petersburg","shanghai","spuriousDragon","tangerineWhistle"]},fO={type:"object",properties:{name:{format:"string"},networkId:{format:"uint"},chainId:{format:"uint"}}},fL={type:"object",properties:{from:{format:"address"},to:{oneOf:[{format:"address"},{type:"null"}]},value:{format:"uint"},gas:{format:"uint"},gasPrice:{format:"uint"},effectiveGasPrice:{format:"uint"},type:{format:"uint"},maxFeePerGas:{format:"uint"},maxPriorityFeePerGas:{format:"uint"},accessList:Object.assign({},fD),data:{format:"bytes"},input:{format:"bytes"},nonce:{format:"uint"},chain:Object.assign({},fM),hardfork:Object.assign({},fB),chainId:{format:"uint"},networkId:{format:"uint"},common:{type:"object",properties:{customChain:Object.assign({},fO),baseChain:Object.assign({},fM),hardfork:Object.assign({},fB)}},gasLimit:{format:"uint"},v:{format:"uint"},r:{format:"bytes32"},s:{format:"bytes32"}}},fF={type:"object",properties:Object.assign(Object.assign({},fL.properties),{blockHash:{format:"bytes32"},blockNumber:{format:"uint"},hash:{format:"bytes32"},transactionIndex:{format:"uint"},from:{format:"address"},to:{oneOf:[{format:"address"},{type:"null"}]},value:{format:"uint"},gas:{format:"uint"},gasPrice:{format:"uint"},effectiveGasPrice:{format:"uint"},type:{format:"uint"},maxFeePerGas:{format:"uint"},maxPriorityFeePerGas:{format:"uint"},accessList:Object.assign({},fD),data:{format:"bytes"},input:{format:"bytes"},nonce:{format:"uint"},gasLimit:{format:"uint"},v:{format:"uint"},r:{format:"bytes32"},s:{format:"bytes32"}})},fU={type:"object",properties:{index:{format:"uint"},validatorIndex:{format:"uint"},address:{format:"address"},amount:{format:"uint"}}},fj={type:"object",properties:{baseFeePerGas:{format:"uint"},blobGasUsed:{format:"uint"},difficulty:{format:"uint"},excessBlobGas:{format:"uint"},extraData:{format:"bytes"},gasLimit:{format:"uint"},gasUsed:{format:"uint"},hash:{format:"bytes32"},logsBloom:{format:"bytes256"},miner:{format:"bytes"},mixHash:{format:"bytes32"},nonce:{format:"uint"},number:{format:"uint"},parentBeaconBlockRoot:{format:"bytes32"},parentHash:{format:"bytes32"},receiptsRoot:{format:"bytes32"},sha3Uncles:{format:"bytes32"},size:{format:"uint"},stateRoot:{format:"bytes32"},timestamp:{format:"uint"},totalDifficulty:{format:"uint"},transactions:{oneOf:[{type:"array",items:Object.assign({},fF)},{type:"array",items:{format:"bytes32"}}]},transactionsRoot:{format:"bytes32"},uncles:{type:"array",items:{format:"bytes32"}},withdrawals:{type:"array",items:Object.assign({},fU)},withdrawalsRoot:{format:"bytes32"}}},fH={type:"object",properties:{author:{format:"bytes32"},excessDataGas:{format:"uint"},baseFeePerGas:{format:"uint"},blobGasUsed:{format:"uint"},difficulty:{format:"uint"},excessBlobGas:{format:"uint"},extraData:{format:"bytes"},gasLimit:{format:"uint"},gasUsed:{format:"uint"},hash:{format:"bytes32"},logsBloom:{format:"bytes256"},miner:{format:"bytes"},mixHash:{format:"bytes32"},nonce:{format:"uint"},number:{format:"uint"},parentBeaconBlockRoot:{format:"bytes32"},parentHash:{format:"bytes32"},receiptsRoot:{format:"bytes32"},sha3Uncles:{format:"bytes32"},size:{format:"uint"},stateRoot:{format:"bytes32"},timestamp:{format:"uint"},totalDifficulty:{format:"uint"},transactions:{type:"array",items:{format:"bytes32"}},transactionsRoot:{format:"bytes32"},uncles:{type:"array",items:{format:"bytes32"}},withdrawals:{type:"array",items:Object.assign({},fU)},withdrawalsRoot:{format:"bytes32"}}},f$={type:"object",properties:{removed:{format:"bool"},logIndex:{format:"uint"},transactionIndex:{format:"uint"},transactionHash:{format:"bytes32"},blockHash:{format:"bytes32"},blockNumber:{format:"uint"},address:{format:"address"},data:{format:"bytes"},topics:{type:"array",items:{format:"bytes32"}}}},fq={type:"object",properties:{startingBlock:{format:"string"},currentBlock:{format:"string"},highestBlock:{format:"string"},knownStates:{format:"string"},pulledStates:{format:"string"}}},fz={type:"object",properties:{transactionHash:{format:"bytes32"},transactionIndex:{format:"uint"},blockHash:{format:"bytes32"},blockNumber:{format:"uint"},from:{format:"address"},to:{format:"address"},cumulativeGasUsed:{format:"uint"},gasUsed:{format:"uint"},effectiveGasPrice:{format:"uint"},contractAddress:{format:"address"},logs:{type:"array",items:Object.assign({},f$)},logsBloom:{format:"bytes"},root:{format:"bytes"},status:{format:"uint"},type:{format:"uint"}}},fV={type:"object",properties:{messageHash:{format:"bytes"},r:{format:"bytes32"},s:{format:"bytes32"},v:{format:"bytes"},message:{format:"bytes"},signature:{format:"bytes"}}},fG={type:"object",properties:{oldestBlock:{format:"uint"},baseFeePerGas:{type:"array",items:{format:"uint"}},reward:{type:"array",items:{type:"array",items:{format:"uint"}}},gasUsedRatio:{type:"array",items:{type:"number"}}}},fK={type:"object",properties:{balance:{format:"uint"},codeHash:{format:"bytes32"},nonce:{format:"uint"},storageHash:{format:"bytes32"},accountProof:{type:"array",items:{format:"bytes32"}},storageProof:{type:"array",items:Object.assign({},{type:"object",properties:{key:{format:"bytes32"},value:{format:"uint"},proof:{type:"array",items:{format:"bytes32"}}}})}}};function fW(e,t=Z,r={transactionSchema:fF,fillInputAndData:!1}){var n,i;let s=ln({},e);if(!al(null==e?void 0:e.common)&&(s.common=Object.assign({},e.common),al(null==(n=e.common)?void 0:n.customChain)||(s.common.customChain=Object.assign({},e.common.customChain))),!al((s=lm(null!=(i=r.transactionSchema)?i:fF,s,t)).data)&&!al(s.input)&&az(s.data)!==az(s.input))throw new rV({data:a_(s.data),input:a_(s.input)});return r.fillInputAndData&&(al(s.data)?al(s.input)||(s.data=s.input):s.input=s.data),al(s.gasLimit)||(s.gas=s.gasLimit,delete s.gasLimit),s}function fQ(e,t,r={fillInputAndData:!1}){return{raw:lm({format:"bytes"},e,t),tx:fW(Object.assign(Object.assign({},hn.fromSerializedData(aI(e)).toJSON()),{hash:a_(lb(aI(e))),type:fR(aI(e))}),t,{fillInputAndData:r.fillInputAndData,transactionSchema:r.transactionSchema})}}var fJ=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function fZ(e,t){return fJ(this,void 0,void 0,function*(){return lm({format:"uint"},(yield fh(e.requestManager)),t)})}function fY(e,t){return fJ(this,void 0,void 0,function*(){return lm({format:"uint"},(yield ff(e.requestManager)),t)})}let fX=e=>fJ(void 0,void 0,void 0,function*(){return fp(e.requestManager)});var f0=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class f1 extends hA{getId(e=this.defaultReturnFormat){return f0(this,void 0,void 0,function*(){return fZ(this,e)})}getPeerCount(e=this.defaultReturnFormat){return f0(this,void 0,void 0,function*(){return fY(this,e)})}isListening(){return f0(this,void 0,void 0,function*(){return fX(this)})}}let f2="ALLEVENTS",f3={name:f2,signature:"",type:"event",inputs:[]},f4={bytes:A.HEX,number:E.NUMBER};var f5=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function f6(e,t,r){return f5(this,void 0,void 0,function*(){var n,i,s,o;let a,l=yield mA(t,t.defaultBlock,!1,Y);if(al(l.baseFeePerGas))throw new rq;if(al(e.gasPrice)&&BigInt(l.baseFeePerGas)===BigInt(0)&&(a=yield mm(t,r)),!al(e.gasPrice)||!al(a)){let t=lm({format:"uint"},null!=(n=e.gasPrice)?n:a,r);return{maxPriorityFeePerGas:t,maxFeePerGas:t}}return{maxPriorityFeePerGas:lm({format:"uint"},null!=(i=e.maxPriorityFeePerGas)?i:t.defaultMaxPriorityFeePerGas,r),maxFeePerGas:lm({format:"uint"},null!=(s=e.maxFeePerGas)?s:BigInt(l.baseFeePerGas)*BigInt(2)+BigInt(null!=(o=e.maxPriorityFeePerGas)?o:t.defaultMaxPriorityFeePerGas),r)}})}function f8(e,t,r){return f5(this,void 0,void 0,function*(){let n=pt(e,t);if(!al(n)){if(n.startsWith("-")||0>Number(n)||Number(n)>127)throw new rz(n);if(al(e.gasPrice)&&("0x0"===n||"0x1"===n))return{gasPrice:yield mm(t,r),maxPriorityFeePerGas:void 0,maxFeePerGas:void 0};if("0x2"===n)return Object.assign({gasPrice:void 0},(yield f6(e,t,r)))}})}var f7=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let f9=(e,t,r,n)=>{if(void 0!==r&&e in r&&void 0!==r[e]){if("string"==typeof r[e]&&o5(r[e]))return r[e];if(!oB(r[e])&&o9(r[e])){if(t.wallet){let n=t.wallet.get(lm({format:"uint"},r[e],f4));if(!al(n))return n.address}throw new rX}throw"from"===e?new rx(r.from):new rS(r.to)}if("from"===e){if(!al(n))return hh(n);if(!al(t.defaultAccount))return t.defaultAccount}},pe=(e,t,...r)=>f7(void 0,[e,t,...r],void 0,function*(e,t,r=e.defaultReturnFormat){if(al(t))throw new r$;return mP(e,t,e.defaultBlock,r)}),pt=(e,t)=>{let r=fP(e,t);return al(r)?al(t.defaultTransactionType)?void 0:lm({format:"uint"},t.defaultTransactionType,Y):r};function pr(e){return f7(this,void 0,void 0,function*(){var t,r;let n=lm(fL,e.transaction,e.web3Context.defaultReturnFormat);if(al(n.from)&&(n.from=f9("from",e.web3Context,void 0,e.privateKey)),al(n.nonce)&&(n.nonce=yield pe(e.web3Context,n.from,Y)),al(n.value)&&(n.value="0x0"),al(n.data))al(n.input)?n.input="0x":n.input.startsWith("0x")||(n.input=`0x${n.input}`);else{if(!al(n.input)&&n.data!==n.input)throw new rV({data:a_(n.data),input:a_(n.input)});n.data.startsWith("0x")||(n.data=`0x${n.data}`)}if(al(n.common)){if(e.web3Context.defaultCommon){let t=e.web3Context.defaultCommon,r=t.customChain.chainId,i=t.customChain.networkId,s=t.customChain.name;n.common=Object.assign(Object.assign({},t),{customChain:{chainId:r,networkId:i,name:s}})}al(n.chain)&&(n.chain=e.web3Context.defaultChain),al(n.hardfork)&&(n.hardfork=e.web3Context.defaultHardfork)}if(al(n.chainId)&&al(null==(t=n.common)?void 0:t.customChain.chainId)&&(n.chainId=yield mF(e.web3Context,Y)),al(n.networkId)&&(n.networkId=null!=(r=e.web3Context.defaultNetworkId)?r:yield fZ(e.web3Context,Y)),al(n.gasLimit)&&!al(n.gas)&&(n.gasLimit=n.gas),n.type=pt(n,e.web3Context),al(n.accessList)&&("0x1"===n.type||"0x2"===n.type)&&(n.accessList=[]),e.fillGasPrice&&(n=Object.assign(Object.assign({},n),(yield f8(n,e.web3Context,Y)))),al(n.gas)&&al(n.gasLimit)&&e.fillGasLimit){let t=yield mO(e.web3Context,n,"latest",Y);n=Object.assign(Object.assign({},n),{gas:lm({format:"uint"},t,Y)})}return n})}let pn=e=>f7(void 0,void 0,void 0,function*(){var t;return(null!=(t=e.web3Context.transactionBuilder)?t:pr)(Object.assign(Object.assign({},e),{transaction:e.transaction}))});var pi=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function ps(e,t,r){let[n,i]=lj(()=>pi(this,void 0,void 0,function*(){let n;try{n=yield mb(e,f4)}catch(e){console.warn("An error happen while trying to get the block number",e);return}let i=n-t;if(i>=e.transactionBlockTimeout)return new rQ({starterBlockNumber:t,numberOfBlocks:i,transactionHash:r})}),e.transactionPollingInterval);return[i,{clean:()=>{clearInterval(n)}}]}function po(e,t,r){return pi(this,void 0,void 0,function*(){var n;let i,s,o=!0;function a(n,i){i&&console.warn("error happened at subscription. So revert to polling...",i),s.clean(),o=!1;let[a,l]=ps(e,t,r);s.clean=l.clean,a.catch(e=>n(e))}try{i=yield null==(n=e.subscriptionManager)?void 0:n.subscribe("newHeads"),s={clean:()=>{var t;i.id&&(null==(t=e.subscriptionManager)||t.removeSubscription(i).then(()=>{}).catch(()=>{}))}}}catch(n){return ps(e,t,r)}return[new Promise((n,s)=>{try{i.on("data",n=>{if(o=!1,!(null==n?void 0:n.number))return;let i=Number(BigInt(n.number)-BigInt(t));i>=e.transactionBlockTimeout&&s(new rQ({starterBlockNumber:t,numberOfBlocks:i,transactionHash:r}))}),i.on("error",e=>{a(s,e)})}catch(e){a(s,e)}setTimeout(()=>{o&&a(s)},1e3*e.blockHeaderTimeout)}),s]})}function pa(e,t){return pi(this,void 0,void 0,function*(){var r,n;let i,{provider:s}=e.requestManager,o=yield mb(e,f4);return(null==(n=(r=s).supportsSubscriptions)?void 0:n.call(r))&&e.enableExperimentalFeatures.useSubscriptionWhenCheckingBlockTimeout?yield po(e,o,t):ps(e,o,t)})}var pl=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function pc(e,t,r){return pl(this,void 0,void 0,function*(){let[n,i]=lU(e.transactionSendTimeout,new rG({numberOfSeconds:e.transactionSendTimeout/1e3,transactionHash:r})),[s,o]=yield pa(e,r);try{return yield Promise.race([t(),i,s])}finally{clearTimeout(n),o.clean()}})}var pu=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function pd(e,t,r,n){return pu(this,void 0,void 0,function*(){var i;let[s,o]=lL(()=>pu(this,void 0,void 0,function*(){try{return(null!=n?n:mC)(e,t,r)}catch(e){console.warn("An error happen while trying to get the transaction receipt",e);return}}),null!=(i=e.transactionReceiptPollingInterval)?i:e.transactionPollingInterval),[a,l]=lU(e.transactionPollingTimeout,new rW({numberOfSeconds:e.transactionPollingTimeout/1e3,transactionHash:t})),[c,u]=yield pa(e,t);try{return yield Promise.race([s,l,c])}finally{a&&clearTimeout(a),o&&clearInterval(o),u.clean()}})}var ph=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let pf=({web3Context:e,transactionReceipt:t,transactionPromiEvent:r,customTransactionReceiptSchema:n,returnFormat:i})=>{var s;let o=1,a=setInterval(()=>{ph(void 0,void 0,void 0,function*(){if(o>=e.transactionConfirmationBlocks)return void clearInterval(a);let s=yield hZ(e.requestManager,aP(BigInt(t.blockNumber)+BigInt(o)),!1);(null==s?void 0:s.hash)&&(o+=1,r.emit("confirmation",{confirmations:lm({format:"uint"},o,i),receipt:lm(null!=n?n:fz,t,i),latestBlockHash:lm({format:"bytes32"},s.hash,i)}))})},null!=(s=e.transactionReceiptPollingInterval)?s:e.transactionPollingInterval)};var pp=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let pg=({web3Context:e,transactionReceipt:t,transactionPromiEvent:r,customTransactionReceiptSchema:n,returnFormat:i})=>{let s,o=!0;setImmediate(()=>{var a;null==(a=e.subscriptionManager)||a.subscribe("newHeads").then(a=>{a.on("data",l=>pp(void 0,void 0,void 0,function*(){var c;if(o=!1,!(null==l?void 0:l.number)||s===(null==l?void 0:l.parentHash))return;s=null==l?void 0:l.parentHash;let u=BigInt(l.number)-BigInt(t.blockNumber)+BigInt(1);r.emit("confirmation",{confirmations:lm({format:"uint"},u,i),receipt:lm(null!=n?n:fz,t,i),latestBlockHash:lm({format:"bytes32"},l.parentHash,i)}),u>=e.transactionConfirmationBlocks&&(yield null==(c=e.subscriptionManager)?void 0:c.removeSubscription(a))})),a.on("error",()=>pp(void 0,void 0,void 0,function*(){var s;yield null==(s=e.subscriptionManager)?void 0:s.removeSubscription(a),o=!1,pf({web3Context:e,transactionReceipt:t,transactionPromiEvent:r,customTransactionReceiptSchema:n,returnFormat:i})}))}).catch(()=>{o=!1,pf({web3Context:e,transactionReceipt:t,customTransactionReceiptSchema:n,transactionPromiEvent:r,returnFormat:i})})}),setTimeout(()=>{o&&pf({web3Context:e,transactionReceipt:t,transactionPromiEvent:r,returnFormat:i})},1e3*e.blockHeaderTimeout)};function pm(e,t,r,n,i,s){if(al(r)||al(r.blockHash))throw new rJ({receipt:r,blockHash:lm({format:"bytes32"},null==r?void 0:r.blockHash,i),transactionHash:lm({format:"bytes32"},n,i)});if(!r.blockNumber)throw new rZ({receipt:r});t.emit("confirmation",{confirmations:lm({format:"uint"},1,i),receipt:lm(null!=s?s:fz,r,i),latestBlockHash:lm({format:"bytes32"},r.blockHash,i)});let o=e.requestManager.provider;o&&"supportsSubscriptions"in o&&o.supportsSubscriptions()?pg({web3Context:e,transactionReceipt:r,transactionPromiEvent:t,customTransactionReceiptSchema:s,returnFormat:i}):pf({web3Context:e,transactionReceipt:r,transactionPromiEvent:t,customTransactionReceiptSchema:s,returnFormat:i})}let py=e=>!lt(e)&&"object"==typeof e&&!lt(e.type)&&"error"===e.type,pb=e=>!lt(e)&&"object"==typeof e&&!lt(e.type)&&"event"===e.type,pw=e=>!lt(e)&&"object"==typeof e&&!lt(e.type)&&"function"===e.type,pv=e=>!lt(e)&&"object"==typeof e&&!lt(e.type)&&"constructor"===e.type,pE=e=>"object"==typeof e&&void 0===e.components&&void 0===e.name,pA=e=>e.includes("[]")?{type:"tuple[]",name:e.slice(0,-2)}:{type:"tuple",name:e},px=e=>{let t=[];for(let r of Object.keys(e)){let n=e[r];"object"==typeof n?t.push(Object.assign(Object.assign({},pA(r)),{components:px(n)})):t.push({name:r,type:e[r]})}return t},pS=e=>"string"==typeof e&&/^(-)?0x[0-9a-f]*$/i.test(e)&&e.length%2==1,pk=(e,t)=>{let r=[];return t.forEach(t=>{if("object"==typeof t.components){if(!t.type.startsWith("tuple"))throw new ru(`Invalid value given "${t.type}". Error: components found but type is not tuple.`);let n=t.type.indexOf("["),i=n>=0?t.type.substring(n):"",s=pk(e,t.components);Array.isArray(s)&&e?r.push(`tuple(${s.join(",")})${i}`):e?r.push(`(${s.join()})`):r.push(`(${s.join(",")})${i}`)}else r.push(t.type)}),r},p_=e=>{var t,r,n,i;return py(e)||pb(e)||pw(e)?(null==(t=e.name)?void 0:t.includes("("))?e.name:`${null!=(r=e.name)?r:""}(${pk(!1,null!=(n=e.inputs)?n:[]).join(",")})`:`(${pk(!1,null!=(i=e.inputs)?i:[]).join(",")})`},pI=e=>{let t;if("string"!=typeof e&&!py(e))throw new ru("Invalid parameter value in encodeErrorSignature");return lv(t=e&&("function"==typeof e||"object"==typeof e)?p_(e):e)},pT=e=>{let t;if("string"!=typeof e&&!pb(e))throw new ru("Invalid parameter value in encodeEventSignature");return lv(t=e&&("function"==typeof e||"object"==typeof e)?p_(e):e)};function pC(e,t){let r=e.exec(t);return r?.groups}var pP=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,pR=/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/,pD=/^\(.+?\).*?$/,pN=Object.defineProperty,pM=(e,t,r)=>t in e?pN(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,pB=(e,t,r)=>(pM(e,"symbol"!=typeof t?t+"":t,r),r),pO="abitype",pL="0.7.1",pF=class extends Error{constructor(e,t={}){let r=t.cause instanceof pF?t.cause.details:t.cause?.message?t.cause.message:t.details,n=t.cause instanceof pF&&t.cause.docsPath||t.docsPath;super([e||"An error occurred.","",...t.metaMessages?[...t.metaMessages,""]:[],...n?[`Docs: https://abitype.dev${n}`]:[],...r?[`Details: ${r}`]:[],`Version: ${pO}@${pL}`].join("\n")),pB(this,"details"),pB(this,"docsPath"),pB(this,"metaMessages"),pB(this,"shortMessage"),pB(this,"name","AbiTypeError"),t.cause&&(this.cause=t.cause),this.details=r,this.docsPath=n,this.metaMessages=t.metaMessages,this.shortMessage=e}},pU=/^error (?<name>[a-zA-Z0-9_]+)\((?<parameters>.*?)\)$/;function pj(e){return pU.test(e)}function pH(e){return execTyped(pU,e)}var p$=/^event (?<name>[a-zA-Z0-9_]+)\((?<parameters>.*?)\)$/;function pq(e){return p$.test(e)}function pz(e){return execTyped(p$,e)}var pV=/^function (?<name>[a-zA-Z0-9_]+)\((?<parameters>.*?)\)(?: (?<scope>external|public{1}))?(?: (?<stateMutability>pure|view|nonpayable|payable{1}))?(?: returns \((?<returns>.*?)\))?$/;function pG(e){return pV.test(e)}function pK(e){return execTyped(pV,e)}var pW=/^struct (?<name>[a-zA-Z0-9_]+) \{(?<properties>.*?)\}$/;function pQ(e){return pW.test(e)}function pJ(e){return pC(pW,e)}var pZ=/^constructor\((?<parameters>.*?)\)(?:\s(?<stateMutability>payable{1}))?$/;function pY(e){return pZ.test(e)}function pX(e){return execTyped(pZ,e)}var p0=/^fallback\(\)$/;function p1(e){return p0.test(e)}var p2=/^receive\(\) external payable$/;function p3(e){return p2.test(e)}var p4=new Set(["memory","indexed","storage","calldata"]),p5=new Set(["indexed"]),p6=new Set(["calldata","memory","storage"]);function p8(e,t){return t?`${t}:${e}`:e}var p7=new Map([["address",{type:"address"}],["bool",{type:"bool"}],["bytes",{type:"bytes"}],["bytes32",{type:"bytes32"}],["int",{type:"int256"}],["int256",{type:"int256"}],["string",{type:"string"}],["uint",{type:"uint256"}],["uint8",{type:"uint8"}],["uint16",{type:"uint16"}],["uint24",{type:"uint24"}],["uint32",{type:"uint32"}],["uint64",{type:"uint64"}],["uint96",{type:"uint96"}],["uint112",{type:"uint112"}],["uint160",{type:"uint160"}],["uint192",{type:"uint192"}],["uint256",{type:"uint256"}],["address owner",{type:"address",name:"owner"}],["address to",{type:"address",name:"to"}],["bool approved",{type:"bool",name:"approved"}],["bytes _data",{type:"bytes",name:"_data"}],["bytes data",{type:"bytes",name:"data"}],["bytes signature",{type:"bytes",name:"signature"}],["bytes32 hash",{type:"bytes32",name:"hash"}],["bytes32 r",{type:"bytes32",name:"r"}],["bytes32 root",{type:"bytes32",name:"root"}],["bytes32 s",{type:"bytes32",name:"s"}],["string name",{type:"string",name:"name"}],["string symbol",{type:"string",name:"symbol"}],["string tokenURI",{type:"string",name:"tokenURI"}],["uint tokenId",{type:"uint256",name:"tokenId"}],["uint8 v",{type:"uint8",name:"v"}],["uint256 balance",{type:"uint256",name:"balance"}],["uint256 tokenId",{type:"uint256",name:"tokenId"}],["uint256 value",{type:"uint256",name:"value"}],["event:address indexed from",{type:"address",name:"from",indexed:!0}],["event:address indexed to",{type:"address",name:"to",indexed:!0}],["event:uint indexed tokenId",{type:"uint256",name:"tokenId",indexed:!0}],["event:uint256 indexed tokenId",{type:"uint256",name:"tokenId",indexed:!0}]]),p9=/^(?<type>[a-zA-Z0-9_]+?)(?<array>(?:\[\d*?\])+?)?(?:\s(?<modifier>calldata|indexed|memory|storage{1}))?(?:\s(?<name>[a-zA-Z0-9_]+))?$/,ge=/^\((?<type>.+?)\)(?<array>(?:\[\d*?\])+?)?(?:\s(?<modifier>calldata|indexed|memory|storage{1}))?(?:\s(?<name>[a-zA-Z0-9_]+))?$/,gt=/^u?int$/;function gr(e,t){let r,n=p8(e,t?.type);if(p7.has(n))return p7.get(n);let i=pD.test(e),s=pC(i?ge:p9,e);if(!s)throw new pF("Invalid ABI parameter.",{details:e});if(s.name&&go(s.name))throw new pF("Invalid ABI parameter.",{details:e,metaMessages:[`"${s.name}" is a protected Solidity keyword. More info: https://docs.soliditylang.org/en/latest/cheatsheet.html`]});let o=s.name?{name:s.name}:{},a="indexed"===s.modifier?{indexed:!0}:{},l=t?.structs??{},c={};if(i){r="tuple";let e=gn(s.type),t=[],n=e.length;for(let r=0;r<n;r++)t.push(gr(e[r],{structs:l}));c={components:t}}else if(s.type in l)r="tuple",c={components:l[s.type]};else if(gt.test(s.type))r=`${s.type}256`;else if(r=s.type,t?.type!=="struct"&&!gi(r))throw new pF("Unknown type.",{metaMessages:[`Type "${r}" is not a valid ABI type.`]});if(s.modifier){if(!t?.modifiers?.has?.(s.modifier))throw new pF("Invalid ABI parameter.",{details:e,metaMessages:[`Modifier "${s.modifier}" not allowed${t?.type?` in "${t.type}" type`:""}.`]});if(p6.has(s.modifier)&&!ga(r,!!s.array))throw new pF("Invalid ABI parameter.",{details:e,metaMessages:[`Modifier "${s.modifier}" not allowed${t?.type?` in "${t.type}" type`:""}.`,`Data location can only be specified for array, struct, or mapping types, but "${s.modifier}" was given.`]})}let u={type:`${r}${s.array??""}`,...o,...a,...c};return p7.set(n,u),u}function gn(e,t=[],r="",n=0){if(""===e){if(""===r)return t;if(0!==n)throw new pF("Unbalanced parentheses.",{metaMessages:[`"${r.trim()}" has too many ${n>0?"opening":"closing"} parentheses.`],details:`Depth "${n}"`});return[...t,r.trim()]}let i=e.length;for(let s=0;s<i;s++){let i=e[s],o=e.slice(s+1);switch(i){case",":return 0===n?gn(o,[...t,r.trim()]):gn(o,t,`${r}${i}`,n);case"(":return gn(o,t,`${r}${i}`,n+1);case")":return gn(o,t,`${r}${i}`,n-1);default:return gn(o,t,`${r}${i}`,n)}}return[]}function gi(e){return"address"===e||"bool"===e||"function"===e||"string"===e||pP.test(e)||pR.test(e)}var gs=/^(?:after|alias|anonymous|apply|auto|byte|calldata|case|catch|constant|copyof|default|defined|error|event|external|false|final|function|immutable|implements|in|indexed|inline|internal|let|mapping|match|memory|mutable|null|of|override|partial|private|promise|public|pure|reference|relocatable|return|returns|sizeof|static|storage|struct|super|supports|switch|this|true|try|typedef|typeof|var|view|virtual)$/;function go(e){return"address"===e||"bool"===e||"function"===e||"string"===e||"tuple"===e||pP.test(e)||pR.test(e)||gs.test(e)}function ga(e,t){return t||"bytes"===e||"string"===e||"tuple"===e}function gl(e){let t={},r=e.length;for(let n=0;n<r;n++){let r=e[n];if(!pQ(r))continue;let i=pJ(r);if(!i)throw new pF("Invalid struct signature.",{details:r});let s=i.properties.split(";"),o=[],a=s.length;for(let e=0;e<a;e++){let t=s[e].trim();if(!t)continue;let r=gr(t,{type:"struct"});o.push(r)}if(!o.length)throw new pF("Invalid struct signature.",{details:r,metaMessages:["No properties exist."]});t[i.name]=o}let n={},i=Object.entries(t),s=i.length;for(let e=0;e<s;e++){let[r,s]=i[e];n[r]=gu(s,t)}return n}var gc=/^(?<type>[a-zA-Z0-9_]+?)(?<array>(?:\[\d*?\])+?)?$/;function gu(e,t,r=new Set){let n=[],i=e.length;for(let s=0;s<i;s++){let i=e[s];if(pD.test(i.type))n.push(i);else{let e=pC(gc,i.type);if(!e?.type)throw new pF("Invalid ABI parameter.",{details:JSON.stringify(i,null,2),metaMessages:["ABI parameter type is invalid."]});let{array:s,type:o}=e;if(o in t){if(r.has(o))throw new pF("Circular reference detected.",{metaMessages:[`Struct "${o}" is a circular reference.`]});n.push({...i,type:`tuple${s??""}`,components:gu(t[o]??[],t,new Set([...r,o]))})}else if(gi(o))n.push(i);else throw new pF("Unknown type.",{metaMessages:[`Type "${o}" is not a valid ABI type. Perhaps you forgot to include a struct signature?`]})}}return n}function gd(e){let t;if("string"==typeof e)t=gr(e,{modifiers:p4});else{let r=gl(e),n=e.length;for(let i=0;i<n;i++){let n=e[i];if(!pQ(n)){t=gr(n,{modifiers:p4,structs:r});break}}}if(!t)throw new pF("Failed to parse ABI parameter.",{details:`parseAbiParameter(${JSON.stringify(e,null,2)})`,docsPath:"/api/human.html#parseabiparameter-1"});return t}let gh=32;function gf(e=0){var t;if((null==(t=globalThis.Buffer)?void 0:t.alloc)!==void 0){let t=globalThis.Buffer.alloc(e);return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}return new Uint8Array(e)}function gp(e){var t,r;return Object.assign(Object.assign({},e),{name:null!=(t=e.name)?t:"",components:null==(r=e.components)?void 0:r.map(e=>gp(e))})}function gg(e){return!lt(e)&&"object"==typeof e&&!lt(e.type)&&"string"==typeof e.type}function gm(e){return e.map(e=>{var t;if(gg(e))return e;if("string"==typeof e)return gp(gd(e.replace(/tuple/,"")));if(pE(e)){let r=Object.keys(e)[0],n=pA(r);return n.name=null!=(t=n.name)?t:"",Object.assign(Object.assign({},n),{components:px(e[r])})}throw new ru("Invalid abi")})}function gy(e){let t=e.type.lastIndexOf("["),r=e.type.substring(0,t),n=e.type.substring(t),i=-1;if("[]"!==n&&isNaN(i=Number(n.slice(1,-1))))throw new ru("Invalid fixed array size",{size:n});return{param:{type:r,name:"",components:e.components},size:i}}function gb(e){var t,r;return!!("string"===e.type||"bytes"===e.type||e.type.endsWith("[]"))||("tuple"===e.type?null!=(r=null==(t=e.components)?void 0:t.some(gb))&&r:!!e.type.endsWith("]")&&gb(gy(e).param))}let gw=20,gv=12;function gE(e,t){if("string"!=typeof t)throw new ru("address type expects string as input type",{value:t,name:e.name,type:e.type});let r=t.toLowerCase();if(r.startsWith("0x")||(r=`0x${r}`),!o5(r))throw new ru("provided input is not valid address",{value:t,name:e.name,type:e.type});let n=o0(r),i=gf(gh);return i.set(n,gv),{dynamic:!1,encoded:i}}function gA(e,t){let r=t.subarray(gv,gh);if(r.length!==gw)throw new ru("Invalid decoding input, not enough bytes to decode address",{bytes:t});return{result:aQ(oZ(r)),encoded:t.subarray(gh),consumed:gh}}let gx=new Map,gS=BigInt(256);for(let e=8;e<=256;e+=8)gx.set(`uint${e}`,{min:BigInt(0),max:gS-BigInt(1)}),gx.set(`int${e}`,{min:-gS/BigInt(2),max:gS/BigInt(2)-BigInt(1)}),gS*=BigInt(256);gx.set("int",gx.get("int256")),gx.set("uint",gx.get("uint256"));let gk=BigInt(1)<<BigInt(256);function g_(e,t=gh){let r;return o0(r=li(r=e<0?(gk+e).toString(16):e.toString(16),2*t))}function gI(e,t){let r=BigInt(oZ(e));return r<=t?r:r-gk}function gT(e,t){let r;try{r=aG(t)}catch(r){throw new ru("provided input is not number value",{type:e.type,value:t,name:e.name})}let n=gx.get(e.type);if(!n)throw new ru("provided abi contains invalid number datatype",{type:e.type});if(r<n.min)throw new ru("provided input is less then minimum for given type",{type:e.type,value:t,name:e.name,minimum:n.min.toString()});if(r>n.max)throw new ru("provided input is greater then maximum for given type",{type:e.type,value:t,name:e.name,maximum:n.max.toString()});return{dynamic:!1,encoded:g_(r)}}function gC(e,t){if(t.length<gh)throw new ru("Not enough bytes left to decode",{param:e,bytesLeft:t.length});let r=t.subarray(0,gh),n=gx.get(e.type);if(!n)throw new ru("provided abi contains invalid number datatype",{type:e.type});let i=gI(r,n.max);if(i<n.min)throw new ru("decoded value is less then minimum for given type",{type:e.type,value:i,name:e.name,minimum:n.min.toString()});if(i>n.max)throw new ru("decoded value is greater then maximum for given type",{type:e.type,value:i,name:e.name,maximum:n.max.toString()});return{result:i,encoded:t.subarray(gh),consumed:gh}}function gP(e,t){let r;try{r=aJ(t)}catch(r){if(r instanceof r9)throw new ru("provided input is not valid boolean value",{type:e.type,value:t,name:e.name})}return gT({type:"uint8",name:""},Number(r))}function gR(e,t){let r=gC({type:"uint8",name:""},t);if(r.result>1||r.result<0)throw new ru("Invalid boolean value encoded",{boolBytes:t.subarray(0,gh),numberResult:r});return{result:r.result===BigInt(1),encoded:r.encoded,consumed:gh}}let gD=32;function gN(e,t){if("string"==typeof t&&t.length%2!=0&&(t+="0"),!o3(t))throw new ru("provided input is not valid bytes value",{type:e.type,value:t,name:e.name});let r=aS(t),[,n]=e.type.split("bytes");if(n){if(Number(n)>gD||1>Number(n))throw new ru("invalid bytes type. Static byte type can have between 1 and 32 bytes",{type:e.type});if(Number(n)<r.length)throw new ru("provided input size is different than type size",{type:e.type,value:t,name:e.name});let i=gf(gh);return i.set(r),{dynamic:!1,encoded:i}}let i=Math.ceil(r.length/gh),s=gf(gh+i*gh);return s.set(gT({type:"uint32",name:""},r.length).encoded),s.set(r,gh),{dynamic:!0,encoded:s}}function gM(e,t){let[,r]=e.type.split("bytes"),n=Number(r),i=t,s=1,o=0;if(!n){let e=gC({type:"uint32",name:""},i);n=Number(e.result),o+=e.consumed,i=e.encoded,s=Math.ceil(n/gh)}if(n>t.length)throw new ru("there is not enough data to decode",{type:e.type,encoded:t,size:n});return{result:a_(i.subarray(0,n)),encoded:i.subarray(s*gh),consumed:o+s*gh}}function gB(e,t){if("string"!=typeof t)throw new ru("invalid input, should be string",{input:t});return gN({type:"bytes",name:""},aF(t))}function gO(e,t){let r=gM({type:"bytes",name:""},t);return{result:aO(r.result),encoded:r.encoded,consumed:r.consumed}}function gL(e){let t=0,r=0,n=[],i=[];for(let r of e)r.dynamic?t+=gh:t+=r.encoded.length;for(let s of e)s.dynamic?(n.push(gT({type:"uint256",name:""},t+r)),i.push(s),r+=s.encoded.length):n.push(s);return av(...n.map(e=>e.encoded),...i.map(e=>e.encoded))}function gF(e,t){if(!Array.isArray(t))throw new ru("Expected value to be array",{abi:e,values:t});let{size:r,param:n}=gy(e),i=t.map(e=>gj(n,e)),s=-1===r,o=i.length>0&&i[0].dynamic;if(!s&&t.length!==r)throw new ru("Given arguments count doesn't match array length",{arrayLength:r,argumentsLength:t.length});if(s||o){let e=gL(i);if(s){let t=gT({type:"uint256",name:""},i.length).encoded;return{dynamic:!0,encoded:i.length>0?av(t,e):t}}return{dynamic:!0,encoded:e}}return{dynamic:!1,encoded:av(...i.map(e=>e.encoded))}}function gU(e,t){let{size:r,param:n}=gy(e),i=0,s=[],o=t;if(-1===r){let e=gC({type:"uint32",name:""},t);r=Number(e.result),i=e.consumed,o=e.encoded}if(gb(n)){for(let e=0;e<r;e+=1){let t=gC({type:"uint32",name:""},o.subarray(e*gh));i+=t.consumed;let r=gH(n,o.subarray(Number(t.result)));i+=r.consumed,s.push(r.result)}return{result:s,encoded:o.subarray(i),consumed:i}}for(let e=0;e<r;e+=1){let e=gH(n,t.subarray(i));i+=e.consumed,s.push(e.result)}return{result:s,encoded:t.subarray(i),consumed:i}}function gj(e,t){if("string"===e.type)return gB(e,t);if("bool"===e.type)return gP(e,t);if("address"===e.type)return gE(e,t);if("tuple"===e.type)return g$(e,t);if(e.type.endsWith("]"))return gF(e,t);if(e.type.startsWith("bytes"))return gN(e,t);if(e.type.startsWith("uint")||e.type.startsWith("int"))return gT(e,t);throw new ru("Unsupported",{param:e,value:t})}function gH(e,t){if("string"===e.type)return gO(e,t);if("bool"===e.type)return gR(e,t);if("address"===e.type)return gA(e,t);if("tuple"===e.type)return gq(e,t);if(e.type.endsWith("]"))return gU(e,t);if(e.type.startsWith("bytes"))return gM(e,t);if(e.type.startsWith("uint")||e.type.startsWith("int"))return gC(e,t);throw new ru("Unsupported",{param:e,bytes:t})}function g$(e,t){var r,n,i;let s=!1;if(!Array.isArray(t)&&"object"!=typeof t)throw new ru("param must be either Array or Object",{param:e,input:t});let o=t,a=[];for(let l=0;l<(null!=(n=null==(r=e.components)?void 0:r.length)?n:0);l+=1){let r,n=e.components[l];if(Array.isArray(o)){if(l>=o.length)throw new ru("input param length missmatch",{param:e,input:t});r=gj(n,o[l])}else{let s=o[null!=(i=n.name)?i:""];if(null==s)throw new ru("missing input defined in abi",{param:e,input:t,paramName:n.name});r=gj(n,s)}r.dynamic&&(s=!0),a.push(r)}return s?{dynamic:!0,encoded:gL(a)}:{dynamic:!1,encoded:av(...a.map(e=>e.encoded))}}function gq(e,t){let r={__length__:0},n=0;if(!e.components)return{result:r,encoded:t,consumed:n};let i=0;for(let[s,o]of e.components.entries()){let e;if(gb(o)){let r=gC({type:"uint32",name:""},t.subarray(n));e=gH(o,t.subarray(Number(r.result))),n+=r.consumed,i+=e.consumed}else e=gH(o,t.subarray(n)),n+=e.consumed;r.__length__+=1,r[s]=e.result,o.name&&""!==o.name&&(r[o.name]=e.result)}return{encoded:t.subarray(n+i),result:r,consumed:n+i}}function gz(e,t,r){return gq({type:"tuple",name:"",components:gm(e)},o0(t)).result}function gV(e){let t=[];return e.forEach(e=>{if(Array.isArray(e)){let r=gV(e);t.push({type:"tuple",components:r,name:""})}else t.push({type:az(e,!0)})}),t}function gG(e,t){if((null==e?void 0:e.length)!==t.length)throw new ru("Invalid number of values received for given ABI",{expected:null==e?void 0:e.length,received:t.length});return oZ(g$({type:"tuple",name:"",components:gm(e)},t).encoded)}function gK(e){try{let t=gV(e);return oZ(g$({type:"tuple",name:"",components:t},e).encoded)}catch(t){throw new ru("Could not infer types from given params",{params:e})}}let gW=(e,t)=>gG([e],[t]),gQ=(e,t,r)=>{try{if(e.length>0&&(!t||"0x"===t||"0X"===t))throw new ru("Returned values aren't valid, did it run Out of Gas? You might also see this error if you are not using the correct ABI for the contract you are retrieving data from, requesting data from a block number that does not exist, or querying a node which is not fully synced.");return gz(e,`0x${t.replace(/0x/i,"")}`,r)}catch(e){throw new ru(`Parameter decoding error: ${e.message}`,{internalErr:e})}},gJ=(e,t)=>gQ(e,t,!1),gZ=(e,t)=>gJ([e],t)["0"],gY=e=>{let t;if("string"!=typeof e&&!pw(e))throw new ru("Invalid parameter value in encodeFunctionSignature");return lv(t=e&&("function"==typeof e||"object"==typeof e)?p_(e):e).slice(0,10)},gX=(e,t)=>{var r;if(!pw(e))throw new ru("Invalid parameter value in encodeFunctionCall");return`${gY(e)}${gG(null!=(r=e.inputs)?r:[],null!=t?t:[]).replace("0x","")}`},g0=(e,t,r=!0)=>{let n=r&&t&&t.length>=10&&t.startsWith("0x")?t.slice(10):t;if(!e.inputs)throw new t7("No inputs found in the ABI");return Object.assign(Object.assign({},gJ([...e.inputs],n)),{__method__:p_(e)})},g1=(e,t)=>{if("constructor"===e.type)return t;if(!t)return null;let r=t.length>=2?t.slice(2):t;if(!e.outputs)return null;let n=gJ([...e.outputs],r);return 1===n.__length__?n[0]:n},g2=["bool","string","int","uint","address","fixed","ufixed"],g3=(e,t)=>"string"===e?t:gZ(e,t),g4=(e,t,r)=>{let n=Array.isArray(r)?r:[r],i={},s={};for(let[t,r]of e.entries())r.indexed?i[t]=r:s[t]=r;let o=t?gQ(Object.values(s),t,!0):{__length__:0},a=n.length-Object.keys(i).length,l=Object.values(i).map((e,t)=>g2.some(t=>e.type.startsWith(t))?g3(e.type,n[t+a]):n[t+a]),c={__length__:0},u=0,d=0;for(let[t,r]of e.entries())c[t]="string"===r.type?"":void 0,i[t]&&(c[t]=l[u],u+=1),s[t]&&(c[t]=o[String(d)],d+=1),r.name&&(c[r.name]=c[t]),c.__length__+=1;return c},g5=(e,t)=>{if(null==t?void 0:t.data){let r,n,i;try{let s=t.data.slice(0,10),o=e.find(e=>pI(e).startsWith(s));(null==o?void 0:o.inputs)?(r=o.name,n=p_(o),i=gJ([...o.inputs],t.data.substring(10))):t.data.startsWith("0x08c379a0")?(r="Error",n="Error(string)",i=gJ([{name:"message",type:"string"}],t.data.substring(10))):t.data.startsWith("0x4e487b71")?(r="Panic",n="Panic(uint256)",i=gJ([{name:"code",type:"uint256"}],t.data.substring(10))):console.error("No matching error abi found for error data",t.data)}catch(e){console.error(e)}r&&t.setDecodedProperties(r,n,i)}},g6=/^\w+/,g8=/^(.*)\[([0-9]*?)]$/,g7=(e,t,r=[])=>{let n=t.match(g6)[0];return r.includes(n)||!e.types[n]?r:[n,...e.types[n].reduce((t,r)=>[...t,...g7(e,r.type,t).filter(e=>!t.includes(e))],[])]},g9=(e,t)=>{let[r,...n]=g7(e,t);return[r,...n.sort()].map(t=>`${t}(${e.types[t].map(e=>`${e.type} ${e.name}`)})`).join("")},me=(e,t)=>keccak256(g9(e,t)),mt=(e,t,r)=>keccak256(mn(e,t,r)),mr=(e,t,r)=>{let n=t.match(g8);if(n){let t=n[1],i=Number(n[2])||void 0;if(!Array.isArray(r))throw new AbiError("Cannot encode data: value is not of array type",{data:r});if(i&&r.length!==i)throw new AbiError(`Cannot encode data: expected length of ${i}, but got ${r.length}`,{data:r});let s=r.map(r=>mr(e,t,r));return["bytes32",keccak256(encodeParameters(s.map(e=>e[0]),s.map(e=>e[1])))]}return e.types[t]?["bytes32",mt(e,t,r)]:"string"===t||"bytes"===t?["bytes32",keccak256(r)]:[t,r]},mn=(e,t,r)=>{let[n,i]=e.types[t].reduce(([t,n],i)=>{if(isNullish(r[i.name])||isNullish(i.type))throw new AbiError(`Cannot encode data: missing data for '${i.name}'`,{data:r,field:i});let s=r[i.name],[o,a]=mr(e,i.type,s);return[[...t,o],[...n,a]]},[["bytes32"],[me(e,t)]]);return encodeParameters(n,i)};var mi=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let ms=(e,t)=>{var r,n,i,s,o;if(e instanceof rt&&e.cause instanceof re)return void 0!==t?(g5(t.filter(e=>py(e)),e.cause),{reason:e.cause.message,signature:null==(r=e.cause.data)?void 0:r.slice(0,10),data:null==(n=e.cause.data)?void 0:n.substring(10),customErrorName:e.cause.errorName,customErrorDecodedSignature:e.cause.errorSignature,customErrorArguments:e.cause.errorArgs}):{reason:e.cause.message,signature:null==(i=e.cause.data)?void 0:i.slice(0,10),data:null==(s=e.cause.data)?void 0:s.substring(10)};if(e instanceof na&&!Array.isArray(null==(o=e.cause)?void 0:o.errors)&&void 0!==e.cause)return e.cause.message;throw e};function mo(e,t,r){return mi(this,arguments,void 0,function*(e,t,r,n=e.defaultReturnFormat){try{yield mB(e,t,e.defaultBlock,n);return}catch(e){return ms(e,r)}})}var ma=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function ml(e,t,r,n,i,s){return ma(this,void 0,void 0,function*(){let o,a=s;if(void 0===a&&(void 0!==n?a=ms(n):e.handleRevert&&void 0!==t&&(a=yield mo(e,t,i))),void 0===a)o=new rv(r);else if("string"==typeof a)o=new rb(a,void 0,r);else if(void 0!==a.customErrorName&&void 0!==a.customErrorDecodedSignature&&void 0!==a.customErrorArguments){let e=a;o=new rw(e.reason,e.customErrorName,e.customErrorDecodedSignature,e.customErrorArguments,e.signature,r,e.data)}else o=new rb(a.reason,a.signature,r,a.data);return o})}let mc=(e,t,r,n=Z)=>{var i,s,o,a,l,c;let u=Object.assign({},e),d=lm(f$,t,n);if([f2,"allEvents"].includes(u.name)){let e=r.find(e=>e.signature===t.topics[0]);u=e||{anonymous:!0}}if(u.inputs=null!=(s=null!=(i=u.inputs)?i:e.inputs)?s:[],!u.anonymous){let e=0;(null!=(o=u.inputs)?o:[]).forEach(t=>{t.indexed&&(e+=1)}),e>0&&(null==t?void 0:t.topics)&&(null==t?void 0:t.topics.length)!==e+1&&(u=Object.assign(Object.assign({},u),{anonymous:!0,inputs:[]}))}let h=u.anonymous?t.topics:(null!=(a=t.topics)?a:[]).slice(1);return Object.assign(Object.assign({},d),{returnValues:g4([...null!=(l=u.inputs)?l:[]],t.data,h),event:u.name,signature:!u.anonymous&&(null==(c=t.topics)?void 0:c.length)>0&&t.topics[0]?t.topics[0]:void 0,raw:{data:t.data,topics:t.topics}})};var mu=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class md{constructor({options:e,web3Context:t,promiEvent:r,returnFormat:n}){this.options={checkRevertBeforeSending:!0},this.options=e,this.web3Context=t,this.promiEvent=r,this.returnFormat=n}getReceiptWithEvents(e){var t,r;let n=Object.assign({},null!=e?e:{});if((null==(t=this.options)?void 0:t.contractAbi)&&n.logs&&n.logs.length>0)for(let e of(n.events={},n.logs)){let t=mc(f3,e,null==(r=this.options)?void 0:r.contractAbi,this.returnFormat);t.event&&(n.events[t.event]=t)}return n}checkRevertBeforeSending(e){return mu(this,void 0,void 0,function*(){if(!1!==this.options.checkRevertBeforeSending){let t=e;al(e.data)&&al(e.input)&&al(e.gas)&&(t=Object.assign(Object.assign({},e),{gas:21e3}));let r=yield mo(this.web3Context,t,this.options.contractAbi);if(void 0!==r)throw yield ml(this.web3Context,e,void 0,void 0,this.options.contractAbi,r)}})}emitSending(e){this.promiEvent.listenerCount("sending")>0&&this.promiEvent.emit("sending",e)}populateGasPrice(e){return mu(this,arguments,void 0,function*({transactionFormatted:e,transaction:t}){var r;let n=e;return!this.web3Context.config.ignoreGasPricing&&!(null==(r=this.options)?void 0:r.ignoreGasPricing)&&al(e.gasPrice)&&(al(t.maxPriorityFeePerGas)||al(t.maxFeePerGas))&&(n=Object.assign(Object.assign({},e),(yield f8(e,this.web3Context,Y)))),n})}signAndSend(e){return mu(this,arguments,void 0,function*({wallet:e,tx:t}){if(e){let r=yield e.signTransaction(t);return pc(this.web3Context,()=>mu(this,void 0,void 0,function*(){return hK(this.web3Context.requestManager,r.rawTransaction)}),r.transactionHash)}return pc(this.web3Context,()=>mu(this,void 0,void 0,function*(){return hG(this.web3Context.requestManager,t)}))})}emitSent(e){this.promiEvent.listenerCount("sent")>0&&this.promiEvent.emit("sent",e)}emitTransactionHash(e){this.promiEvent.listenerCount("transactionHash")>0&&this.promiEvent.emit("transactionHash",e)}emitReceipt(e){this.promiEvent.listenerCount("receipt")>0&&this.promiEvent.emit("receipt",e)}handleError(e){return mu(this,arguments,void 0,function*({error:e,tx:t}){var r;let n=e;return n instanceof rt&&this.web3Context.handleRevert&&(n=yield ml(this.web3Context,t,void 0,void 0,null==(r=this.options)?void 0:r.contractAbi)),(n instanceof na||n instanceof rt||n instanceof rw||n instanceof rv||n instanceof rb||n instanceof rW)&&this.promiEvent.listenerCount("error")>0&&this.promiEvent.emit("error",n),n})}emitConfirmation({receipt:e,transactionHash:t,customTransactionReceiptSchema:r}){this.promiEvent.listenerCount("confirmation")>0&&pm(this.web3Context,this.promiEvent,e,t,this.returnFormat,r)}handleResolve(e){return mu(this,arguments,void 0,function*({receipt:e,tx:t}){var r,n,i;if(null==(r=this.options)?void 0:r.transactionResolver)return null==(n=this.options)?void 0:n.transactionResolver(e);if(e.status!==BigInt(0))return e;{let r=yield ml(this.web3Context,t,e,void 0,null==(i=this.options)?void 0:i.contractAbi);throw this.promiEvent.listenerCount("error")>0&&this.promiEvent.emit("error",r),r}})}}var mh=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})},mf=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r};let mp=e=>mh(void 0,void 0,void 0,function*(){return hT(e.requestManager)});function mg(e,t){return mh(this,void 0,void 0,function*(){return lm({format:"uint"},(yield hR(e.requestManager)),null!=t?t:e.defaultReturnFormat)})}function mm(e,t){return mh(this,void 0,void 0,function*(){return lm({format:"uint"},(yield hD(e.requestManager)),null!=t?t:e.defaultReturnFormat)})}function my(e,t){return mh(this,void 0,void 0,function*(){return lm({format:"uint"},(yield hN(e.requestManager)),null!=t?t:e.defaultReturnFormat)})}function mb(e,t){return mh(this,void 0,void 0,function*(){return lm({format:"uint"},(yield hB(e.requestManager)),null!=t?t:e.defaultReturnFormat)})}function mw(e,t){return mh(this,arguments,void 0,function*(e,t,r=e.defaultBlock,n){let i=at(r)?r:lm({format:"uint"},r,Y);return lm({format:"uint"},(yield hO(e.requestManager,t,i)),null!=n?n:e.defaultReturnFormat)})}function mv(e,t,r){return mh(this,arguments,void 0,function*(e,t,r,n=e.defaultBlock,i){let s=lm({format:"uint"},r,Y),o=at(n)?n:lm({format:"uint"},n,Y);return lm({format:"bytes"},(yield hL(e.requestManager,t,s,o)),null!=i?i:e.defaultReturnFormat)})}function mE(e,t){return mh(this,arguments,void 0,function*(e,t,r=e.defaultBlock,n){let i=at(r)?r:lm({format:"uint"},r,Y);return lm({format:"bytes"},(yield hq(e.requestManager,t,i)),null!=n?n:e.defaultReturnFormat)})}function mA(e){return mh(this,arguments,void 0,function*(e,t=e.defaultBlock,r=!1,n){var i;let s;if(o3(t)){let n=lm({format:"bytes32"},t,Y);s=yield hJ(e.requestManager,n,r)}else{let n=at(t)?t:lm({format:"uint"},t,Y);s=yield hZ(e.requestManager,n,r)}let o=lm(fj,s,null!=n?n:e.defaultReturnFormat);return al(o)?o:Object.assign(Object.assign({},o),{transactions:null!=(i=o.transactions)?i:[]})})}function mx(e){return mh(this,arguments,void 0,function*(e,t=e.defaultBlock,r){let n;if(o3(t)){let r=lm({format:"bytes32"},t,Y);n=yield hU(e.requestManager,r)}else{let r=at(t)?t:lm({format:"uint"},t,Y);n=yield hj(e.requestManager,r)}return lm({format:"uint"},n,null!=r?r:e.defaultReturnFormat)})}function mS(e){return mh(this,arguments,void 0,function*(e,t=e.defaultBlock,r){let n;if(o3(t)){let r=lm({format:"bytes32"},t,Y);n=yield hH(e.requestManager,r)}else{let r=at(t)?t:lm({format:"uint"},t,Y);n=yield h$(e.requestManager,r)}return lm({format:"uint"},n,null!=r?r:e.defaultReturnFormat)})}function mk(e){return mh(this,arguments,void 0,function*(e,t=e.defaultBlock,r,n){let i,s=lm({format:"uint"},r,Y);if(o3(t)){let r=lm({format:"bytes32"},t,Y);i=yield h2(e.requestManager,r,s)}else{let r=at(t)?t:lm({format:"uint"},t,Y);i=yield h3(e.requestManager,r,s)}return lm(fj,i,null!=n?n:e.defaultReturnFormat)})}function m_(e,t){return mh(this,arguments,void 0,function*(e,t,r=e.defaultReturnFormat){let n=lm({format:"bytes32"},t,Z),i=yield hY(e.requestManager,n);return al(i)?i:fW(i,r,{transactionSchema:e.config.customTransactionSchema,fillInputAndData:!0})})}function mI(e,t){return mh(this,void 0,void 0,function*(){return(yield fi(e.requestManager)).map(r=>fW(r,null!=t?t:e.defaultReturnFormat,{transactionSchema:e.config.customTransactionSchema,fillInputAndData:!0}))})}function mT(e){return mh(this,arguments,void 0,function*(e,t=e.defaultBlock,r,n){let i,s=lm({format:"uint"},r,Y);if(o3(t)){let r=lm({format:"bytes32"},t,Y);i=yield hX(e.requestManager,r,s)}else{let r=at(t)?t:lm({format:"uint"},t,Y);i=yield h0(e.requestManager,r,s)}return al(i)?i:fW(i,null!=n?n:e.defaultReturnFormat,{transactionSchema:e.config.customTransactionSchema,fillInputAndData:!0})})}function mC(e,t,r){return mh(this,void 0,void 0,function*(){let n,i=lm({format:"bytes32"},t,Z);try{n=yield h1(e.requestManager,i)}catch(e){if("object"==typeof e&&!al(e)&&"message"in e&&"transaction indexing is in progress"===e.message)console.warn("Transaction indexing is in progress.");else throw e}return al(n)?n:lm(fz,n,null!=r?r:e.defaultReturnFormat)})}function mP(e,t){return mh(this,arguments,void 0,function*(e,t,r=e.defaultBlock,n){let i=at(r)?r:lm({format:"uint"},r,Y);return lm({format:"uint"},(yield hF(e.requestManager,t,i)),null!=n?n:e.defaultReturnFormat)})}function mR(e,t,r,n={checkRevertBeforeSending:!0},i){let s=new hk((o,a)=>{setImmediate(()=>{mh(this,void 0,void 0,function*(){let l=new md({web3Context:e,promiEvent:s,options:n,returnFormat:r}),c=Object.assign({},t);al(i)||(c=yield i.processTransaction(c));let u=fW(Object.assign(Object.assign({},c),{from:f9("from",e,c),to:f9("to",e,c)}),Y,{transactionSchema:e.config.customTransactionSchema});try{let t;u=yield l.populateGasPrice({transaction:c,transactionFormatted:u}),yield l.checkRevertBeforeSending(u),l.emitSending(u),e.wallet&&!al(u.from)&&(t=e.wallet.get(u.from));let n=yield l.signAndSend({wallet:t,tx:u}),i=lm({format:"bytes32"},n,null!=r?r:e.defaultReturnFormat);l.emitSent(u),l.emitTransactionHash(i);let s=yield pd(e,n,null!=r?r:e.defaultReturnFormat),a=l.getReceiptWithEvents(lm(fz,s,null!=r?r:e.defaultReturnFormat));l.emitReceipt(a),o((yield l.handleResolve({receipt:a,tx:u}))),l.emitConfirmation({receipt:a,transactionHash:n})}catch(e){a((yield l.handleError({error:e,tx:u})))}})})});return s}function mD(e,t,r,n={checkRevertBeforeSending:!0}){let i=new hk((s,o)=>{setImmediate(()=>{mh(this,void 0,void 0,function*(){let a=new md({web3Context:e,promiEvent:i,options:n,returnFormat:r}),l=lm({format:"bytes"},t,Y),c=hn.fromSerializedData(aS(aI(l))),u=Object.assign(Object.assign({},c.toJSON()),{from:c.getSenderAddress().toString()});try{let{v:t,r:n,s:i}=u,o=mf(u,["v","r","s"]);yield a.checkRevertBeforeSending(o),a.emitSending(l);let c=yield pc(e,()=>mh(this,void 0,void 0,function*(){return hK(e.requestManager,l)}));a.emitSent(l);let d=lm({format:"bytes32"},c,null!=r?r:e.defaultReturnFormat);a.emitTransactionHash(d);let h=yield pd(e,c,null!=r?r:e.defaultReturnFormat),f=a.getReceiptWithEvents(lm(fz,h,null!=r?r:e.defaultReturnFormat));a.emitReceipt(f),s((yield a.handleResolve({receipt:f,tx:u}))),a.emitConfirmation({receipt:f,transactionHash:c})}catch(e){o((yield a.handleError({error:e,tx:u})))}})})});return i}function mN(e,t,r){return mh(this,arguments,void 0,function*(e,t,r,n=e.defaultReturnFormat){var i;let s=lm({format:"bytes"},t,Z);if(null==(i=e.wallet)?void 0:i.get(r))return lm(fV,e.wallet.get(r).sign(s),n);if("number"==typeof r)throw new rm(t,'RPC method "eth_sign" does not support index signatures');return lm({format:"bytes"},(yield hz(e.requestManager,r,s)),n)})}function mM(e,t){return mh(this,arguments,void 0,function*(e,t,r=e.defaultReturnFormat){let n=yield hV(e.requestManager,fW(t,Y,{transactionSchema:e.config.customTransactionSchema}));return oM(n)?fQ(n,r,{fillInputAndData:!0}):{raw:lm({format:"bytes"},n.raw,r),tx:fW(n.tx,r,{transactionSchema:e.config.customTransactionSchema,fillInputAndData:!0})}})}function mB(e,t){return mh(this,arguments,void 0,function*(e,t,r=e.defaultBlock,n=e.defaultReturnFormat){let i=at(r)?r:lm({format:"uint"},r,Y);return lm({format:"bytes"},(yield hW(e.requestManager,fW(t,Y,{transactionSchema:e.config.customTransactionSchema}),i)),n)})}function mO(e,t){return mh(this,arguments,void 0,function*(e,t,r=e.defaultBlock,n){let i=fW(t,Y,{transactionSchema:e.config.customTransactionSchema}),s=at(r)?r:lm({format:"uint"},r,Y);return lm({format:"uint"},(yield hQ(e.requestManager,i,s)),null!=n?n:e.defaultReturnFormat)})}function mL(e,t,r){return mh(this,void 0,void 0,function*(){let{toBlock:n,fromBlock:i}=t;al(n)||"number"!=typeof n&&"bigint"!=typeof n||(n=aP(n)),al(i)||"number"!=typeof i&&"bigint"!=typeof i||(i=aP(i));let s=Object.assign(Object.assign({},t),{fromBlock:i,toBlock:n});return(yield fe(e.requestManager,s)).map(t=>"string"==typeof t?t:lm(f$,t,null!=r?r:e.defaultReturnFormat))})}function mF(e,t){return mh(this,void 0,void 0,function*(){return lm({format:"uint"},(yield fo(e.requestManager)),null!=t?t:e.defaultReturnFormat)})}function mU(e,t,r){return mh(this,arguments,void 0,function*(e,t,r,n=e.defaultBlock,i){let s=r.map(e=>lm({format:"bytes"},e,Y)),o=at(n)?n:lm({format:"uint"},n,Y);return lm(fK,(yield fa(e.requestManager,t,s,o)),null!=i?i:e.defaultReturnFormat)})}function mj(e,t){return mh(this,arguments,void 0,function*(e,t,r=e.defaultBlock,n,i){let s=lm({format:"uint"},t,Y),o=at(r)?r:lm({format:"uint"},r,Y),a=lm({type:"array",items:{format:"uint"}},n,f4);return lm(fG,(yield fn(e.requestManager,s,o,a)),null!=i?i:e.defaultReturnFormat)})}function mH(e,t){return mh(this,arguments,void 0,function*(e,t,r=e.defaultBlock,n){let i=at(r)?r:lm({format:"uint"},r,Y);return lm(fN,(yield fc(e.requestManager,fW(t,Y,{transactionSchema:e.config.customTransactionSchema}),i)),null!=n?n:e.defaultReturnFormat)})}function m$(e,t,r,n,i){return mh(this,void 0,void 0,function*(){return lm({format:"bytes"},(yield fu(e.requestManager,t,r,n)),null!=i?i:e.defaultReturnFormat)})}var mq=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function mz(e,t){return mq(this,void 0,void 0,function*(){return lm({format:"uint"},(yield h6(e.requestManager)),null!=t?t:e.defaultReturnFormat)})}function mV(e,t,r){return mq(this,void 0,void 0,function*(){let{toBlock:n,fromBlock:i}=t;al(n)||"number"!=typeof n&&"bigint"!=typeof n||(n=aP(n)),al(i)||"number"!=typeof i&&"bigint"!=typeof i||(i=aP(i));let s=Object.assign(Object.assign({},t),{fromBlock:i,toBlock:n});return lm({format:"uint"},(yield h4(e.requestManager,s)),null!=r?r:e.defaultReturnFormat)})}function mG(e,t){return mq(this,void 0,void 0,function*(){return lm({format:"uint"},(yield h5(e.requestManager)),null!=t?t:e.defaultReturnFormat)})}function mK(e,t){return mq(this,void 0,void 0,function*(){return yield h8(e.requestManager,aP(t))})}function mW(e,t,r){return mq(this,void 0,void 0,function*(){return(yield h7(e.requestManager,aP(t))).map(t=>"string"==typeof t?t:lm(f$,t,null!=r?r:e.defaultReturnFormat))})}function mQ(e,t,r){return mq(this,void 0,void 0,function*(){return(yield h9(e.requestManager,aP(t))).map(t=>"string"==typeof t?t:lm(f$,t,null!=r?r:e.defaultReturnFormat))})}class mJ extends cv{_buildSubscriptionParams(){return["logs",this.args]}formatSubscriptionResult(e){return lm(f$,e,super.returnFormat)}}class mZ extends cv{_buildSubscriptionParams(){return["newPendingTransactions"]}formatSubscriptionResult(e){return lm({format:"string"},e,super.returnFormat)}}class mY extends cv{_buildSubscriptionParams(){return["newHeads"]}formatSubscriptionResult(e){return lm(fH,e,super.returnFormat)}}class mX extends cv{_buildSubscriptionParams(){return["syncing"]}_processSubscriptionResult(e){if("boolean"==typeof e)this.emit("changed",e);else{let t=Object.fromEntries(Object.entries((null==e?void 0:e.status)||e).map(([e,t])=>[e.charAt(0).toLowerCase()+e.substring(1),t]));this.emit("changed",e.syncing),this.emit("data",lm(fq,t,super.returnFormat))}}}var m0=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let m1={logs:mJ,newPendingTransactions:mZ,newHeads:mY,syncing:mX,pendingTransactions:mZ,newBlockHeaders:mY};class m2 extends hA{constructor(e){if("string"==typeof e||ch(e))return void super({provider:e,registeredSubscriptions:m1});if(e.registeredSubscriptions)return void super(e);super(Object.assign(Object.assign({},e),{registeredSubscriptions:m1})),this.getFeeData=this.calculateFeeData}setTransactionMiddleware(e){this.transactionMiddleware=e}getTransactionMiddleware(){return this.transactionMiddleware}getProtocolVersion(){return m0(this,void 0,void 0,function*(){return hI(this.requestManager)})}isSyncing(){return m0(this,void 0,void 0,function*(){return hT(this.requestManager)})}getCoinbase(){return m0(this,void 0,void 0,function*(){return hC(this.requestManager)})}isMining(){return m0(this,void 0,void 0,function*(){return hP(this.requestManager)})}getHashrate(e){return m0(this,void 0,void 0,function*(){var t;return void 0===e&&(e=null!=(t=this.defaultReturnFormat)?t:Z),this.getHashRate(e)})}getHashRate(){return m0(this,arguments,void 0,function*(e=this.defaultReturnFormat){return mg(this,e)})}getGasPrice(){return m0(this,arguments,void 0,function*(e=this.defaultReturnFormat){return mm(this,e)})}getMaxPriorityFeePerGas(){return m0(this,arguments,void 0,function*(e=this.defaultReturnFormat){return my(this,e)})}calculateFeeData(){return m0(this,arguments,void 0,function*(e=BigInt(2),t=aA.Gwei){var r;let n,i,s,o=yield this.getBlock(void 0,!1),a=null!=(r=null==o?void 0:o.baseFeePerGas)?r:void 0;try{n=yield this.getGasPrice()}catch(e){}try{i=yield this.getMaxPriorityFeePerGas()}catch(e){}if(a){let r;i=null!=i?i:t,s=a*(r="number"==typeof e?BigInt(Math.floor(1e3*e))/BigInt(1e3):e)+i}return{gasPrice:n,maxFeePerGas:s,maxPriorityFeePerGas:i,baseFeePerGas:a}})}getAccounts(){return m0(this,void 0,void 0,function*(){var e;return(null!=(e=yield hM(this.requestManager))?e:[]).map(e=>aQ(e))})}getBlockNumber(){return m0(this,arguments,void 0,function*(e=this.defaultReturnFormat){return mb(this,e)})}getBalance(e){return m0(this,arguments,void 0,function*(e,t=this.defaultBlock,r=this.defaultReturnFormat){return mw(this,e,t,r)})}getStorageAt(e,t){return m0(this,arguments,void 0,function*(e,t,r=this.defaultBlock,n=this.defaultReturnFormat){return mv(this,e,t,r,n)})}getCode(e){return m0(this,arguments,void 0,function*(e,t=this.defaultBlock,r=this.defaultReturnFormat){return mE(this,e,t,r)})}getBlock(){return m0(this,arguments,void 0,function*(e=this.defaultBlock,t=!1,r=this.defaultReturnFormat){return mA(this,e,t,r)})}getBlockTransactionCount(){return m0(this,arguments,void 0,function*(e=this.defaultBlock,t=this.defaultReturnFormat){return mx(this,e,t)})}getBlockUncleCount(){return m0(this,arguments,void 0,function*(e=this.defaultBlock,t=this.defaultReturnFormat){return mS(this,e,t)})}getUncle(){return m0(this,arguments,void 0,function*(e=this.defaultBlock,t,r=this.defaultReturnFormat){return mk(this,e,t,r)})}getTransaction(e){return m0(this,arguments,void 0,function*(e,t=this.defaultReturnFormat){let r=yield m_(this,e,t);if(!r)throw new rA;return r})}getPendingTransactions(){return m0(this,arguments,void 0,function*(e=this.defaultReturnFormat){return mI(this,e)})}getTransactionFromBlock(){return m0(this,arguments,void 0,function*(e=this.defaultBlock,t,r=this.defaultReturnFormat){return mT(this,e,t,r)})}getTransactionReceipt(e){return m0(this,arguments,void 0,function*(e,t=this.defaultReturnFormat){let r=yield mC(this,e,t);if(!r)throw new rA;return r})}getTransactionCount(e){return m0(this,arguments,void 0,function*(e,t=this.defaultBlock,r=this.defaultReturnFormat){return mP(this,e,t,r)})}sendTransaction(e,t=this.defaultReturnFormat,r){return mR(this,e,t,r,this.transactionMiddleware)}sendSignedTransaction(e,t=this.defaultReturnFormat,r){return mD(this,e,t,r)}sign(e,t){return m0(this,arguments,void 0,function*(e,t,r=this.defaultReturnFormat){return mN(this,e,t,r)})}signTransaction(e){return m0(this,arguments,void 0,function*(e,t=this.defaultReturnFormat){return mM(this,e,t)})}call(e){return m0(this,arguments,void 0,function*(e,t=this.defaultBlock,r=this.defaultReturnFormat){return mB(this,e,t,r)})}estimateGas(e){return m0(this,arguments,void 0,function*(e,t=this.defaultBlock,r=this.defaultReturnFormat){return mO(this,e,t,r)})}getPastLogs(e){return m0(this,arguments,void 0,function*(e,t=this.defaultReturnFormat){return mL(this,e,t)})}getWork(){return m0(this,void 0,void 0,function*(){return ft(this.requestManager)})}submitWork(e,t,r){return m0(this,void 0,void 0,function*(){return fr(this.requestManager,e,t,r)})}requestAccounts(){return m0(this,void 0,void 0,function*(){return fs(this.requestManager)})}getChainId(){return m0(this,arguments,void 0,function*(e=this.defaultReturnFormat){return mF(this,e)})}getNodeInfo(){return m0(this,void 0,void 0,function*(){return fl(this.requestManager)})}getProof(e,t){return m0(this,arguments,void 0,function*(e,t,r=this.defaultBlock,n=this.defaultReturnFormat){return mU(this,e,t,r,n)})}getFeeHistory(e){return m0(this,arguments,void 0,function*(e,t=this.defaultBlock,r,n=this.defaultReturnFormat){return mj(this,e,t,r,n)})}createAccessList(e){return m0(this,arguments,void 0,function*(e,t=this.defaultBlock,r=this.defaultReturnFormat){return mH(this,e,t,r)})}signTypedData(e,t,r,n){return m0(this,void 0,void 0,function*(){var i;return void 0===r&&(r=!1),void 0===n&&(n=null!=(i=this.defaultReturnFormat)?i:Z),m$(this,e,t,r,n)})}subscribe(e,t,r){return m0(this,void 0,void 0,function*(){var n,i;void 0===r&&(r=null!=(n=this.defaultReturnFormat)?n:Z);let s=yield null==(i=this.subscriptionManager)?void 0:i.subscribe(e,t,r);return s instanceof mJ&&"logs"===e&&"object"==typeof t&&!lt(t.fromBlock)&&Number.isFinite(Number(t.fromBlock))&&setImmediate(()=>{this.getPastLogs(t).then(e=>{for(let t of e)s._processSubscriptionResult(t)}).catch(e=>{s._processSubscriptionError(e)})}),s})}static shouldClearSubscription({sub:e}){return!(e instanceof mX)}clearSubscriptions(e=!1){var t;return null==(t=this.subscriptionManager)?void 0:t.unsubscribe(e?m2.shouldClearSubscription:void 0)}createNewPendingTransactionFilter(){return m0(this,arguments,void 0,function*(e=this.defaultReturnFormat){return mz(this,e)})}createNewFilter(e){return m0(this,arguments,void 0,function*(e,t=this.defaultReturnFormat){return mV(this,e,t)})}createNewBlockFilter(){return m0(this,arguments,void 0,function*(e=this.defaultReturnFormat){return mG(this,e)})}uninstallFilter(e){return m0(this,void 0,void 0,function*(){return mK(this,e)})}getFilterChanges(e){return m0(this,arguments,void 0,function*(e,t=this.defaultReturnFormat){return mW(this,e,t)})}getFilterLogs(e){return m0(this,arguments,void 0,function*(e,t=this.defaultReturnFormat){return mQ(this,e,t)})}}function m3(e){return(!!isNullish(e.to)||!!isAddress(e.to))&&(!!isHexStrict(e.type)||!!isNullish(e.type)||2===e.type.length)&&!!isHexStrict(e.nonce)&&!!isHexStrict(e.gas)&&!!isHexStrict(e.value)&&!!isHexStrict(e.input)&&(!e.chainId||!!isHexStrict(e.chainId))&&!0}function m4(e){return(!!isNullish(e.address)||!!isAddress(e.address))&&(!!isNullish(e.storageKeys)||!!e.storageKeys.every(e=>isHexString32Bytes(e)))}function m5(e){return!!Array.isArray(e)&&!!e.every(e=>m4(e))}function m6(e){return!!m3(e)&&!!isHexStrict(e.maxFeePerGas)&&!!isHexStrict(e.maxPriorityFeePerGas)&&!!m5(e.accessList)}function m8(e){return!!m3(e)&&!!isHexStrict(e.gasPrice)&&!!m5(e.accessList)}function m7(e){return!!m3(e)&&!!isHexStrict(e.gasPrice)}let m9=e=>{if(!al(e.common)){if(al(e.common.customChain))throw new rk;if(al(e.common.customChain.chainId))throw new r_;if(!al(e.chainId)&&e.chainId!==e.common.customChain.chainId)throw new rI({txChainId:e.chainId,customChainId:e.common.customChain.chainId})}},ye=e=>{if(!al(e.common)&&!al(e.chain)&&!al(e.hardfork))throw new rP;if(!al(e.chain)&&al(e.hardfork)||!al(e.hardfork)&&al(e.chain))throw new rR({chain:e.chain,hardfork:e.hardfork})},yt=e=>{if(!al(e.common)&&!al(e.common.baseChain)&&!al(e.chain)&&e.chain!==e.common.baseChain)throw new rT({txChain:e.chain,baseChain:e.common.baseChain})},yr=e=>{if(!al(e.common)&&!al(e.common.hardfork)&&!al(e.hardfork)&&e.hardfork!==e.common.hardfork)throw new rC({txHardfork:e.hardfork,commonHardfork:e.common.hardfork})},yn=e=>{if(al(e.gas)||!o8(e.gas)||al(e.gasPrice)||!o8(e.gasPrice))throw new rO({gas:e.gas,gasPrice:e.gasPrice});if(!al(e.maxFeePerGas)||!al(e.maxPriorityFeePerGas))throw new rU({maxFeePerGas:e.maxFeePerGas,maxPriorityFeePerGas:e.maxPriorityFeePerGas})},yi=e=>{if(!al(e.gasPrice)&&"0x2"===e.type)throw new rF(e.gasPrice);if("0x0"===e.type||"0x1"===e.type)throw new rU({maxFeePerGas:e.maxFeePerGas,maxPriorityFeePerGas:e.maxPriorityFeePerGas});if(al(e.maxFeePerGas)||!o8(e.maxFeePerGas)||al(e.maxPriorityFeePerGas)||!o8(e.maxPriorityFeePerGas))throw new rL({maxPriorityFeePerGas:e.maxPriorityFeePerGas,maxFeePerGas:e.maxFeePerGas})},ys=e=>{let t=!al(e.gas)||!al(e.gasLimit),r=t&&!al(e.gasPrice),n=t&&!al(e.maxPriorityFeePerGas)&&!al(e.maxFeePerGas);if(!r&&!n)throw new rN({gas:e.gas,gasPrice:e.gasPrice,maxPriorityFeePerGas:e.maxPriorityFeePerGas,maxFeePerGas:e.maxFeePerGas});if(r&&n)throw new rB({gas:e.gas,gasPrice:e.gasPrice,maxPriorityFeePerGas:e.maxPriorityFeePerGas,maxFeePerGas:e.maxFeePerGas});(r?yn:yi)(e),(!al(e.type)&&e.type>"0x1"?yi:yn)(e)},yo=(e,t,r={transactionSchema:void 0})=>{if(!al(t))return void t(e);if("object"!=typeof e||al(e))throw new rj(e);m9(e),ye(e),yt(e),yr(e);let n=fW(e,Y,{transactionSchema:r.transactionSchema});if(ys(n),al(n.nonce)||al(n.chainId)||n.nonce.startsWith("-")||n.chainId.startsWith("-"))throw new rH({nonce:e.nonce,chainId:e.chainId})};var ya=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let yl=e=>{var t,r;return Object.assign(Object.assign({},e),{nonce:e.nonce,gasPrice:e.gasPrice,gasLimit:null!=(t=e.gasLimit)?t:e.gas,to:e.to,value:e.value,data:null!=(r=e.data)?r:e.input,type:e.type,chainId:e.chainId,accessList:e.accessList,maxPriorityFeePerGas:e.maxPriorityFeePerGas,maxFeePerGas:e.maxFeePerGas})},yc=(e,t)=>{var r,n,i,s,o,a,l,c,u,d,h,f,p,g,m,y,b,w;let v;if((al(e.chain)||al(e.hardfork))&&al(e.common))t.defaultCommon?(al((v=Object.assign({},t.defaultCommon)).hardfork)&&(v.hardfork=null!=(r=e.hardfork)?r:t.defaultHardfork),al(v.baseChain)&&(v.baseChain=t.defaultChain)):v=dK.custom({name:"custom-network",chainId:aV(e.chainId),networkId:al(e.networkId)?void 0:aV(e.networkId),defaultHardfork:null!=(n=e.hardfork)?n:t.defaultHardfork},{baseChain:t.defaultChain});else{let r=null!=(a=null!=(o=null==(s=null==(i=null==e?void 0:e.common)?void 0:i.customChain)?void 0:s.name)?o:e.chain)?a:"custom-network",n=aV(null!=(u=null==(c=null==(l=null==e?void 0:e.common)?void 0:l.customChain)?void 0:c.chainId)?u:null==e?void 0:e.chainId),E=aV(null!=(f=null==(h=null==(d=null==e?void 0:e.common)?void 0:d.customChain)?void 0:h.networkId)?f:null==e?void 0:e.networkId),A=null!=(m=null!=(g=null==(p=null==e?void 0:e.common)?void 0:p.hardfork)?g:null==e?void 0:e.hardfork)?m:t.defaultHardfork,x=null!=(w=null!=(b=null==(y=e.common)?void 0:y.baseChain)?b:e.chain)?w:t.defaultChain;n&&E&&r&&(v=dK.custom({name:r,chainId:n,networkId:E,defaultHardfork:A},{baseChain:x}))}return{common:v}},yu=(e,t,r,...n)=>ya(void 0,[e,t,r,...n],void 0,function*(e,t,r,n=!1,i=!0){let s=fW((yield pn({transaction:e,web3Context:t,privateKey:r,fillGasPrice:n,fillGasLimit:i})),Y,{transactionSchema:t.config.customTransactionSchema});return yo(s,void 0,{transactionSchema:t.config.customTransactionSchema}),hn.fromTxData(yl(s),yc(s,t))}),yd=({address:e},t,r)=>{var n,i;let s=null==r?void 0:r.topics,o=null!=(n=null==r?void 0:r.filter)?n:{},a={};if(lt(null==r?void 0:r.fromBlock)||(a.fromBlock=lm(fj.properties.number,null==r?void 0:r.fromBlock,{number:E.HEX,bytes:A.HEX})),lt(null==r?void 0:r.toBlock)||(a.toBlock=lm(fj.properties.number,null==r?void 0:r.toBlock,{number:E.HEX,bytes:A.HEX})),s&&Array.isArray(s))a.topics=[...s];else if(a.topics=[],!t||t.anonymous||[f2,"allEvents"].includes(t.name)||a.topics.push(null!=(i=t.signature)?i:pT(p_(t))),![f2,"allEvents"].includes(t.name)&&t.inputs)for(let e of t.inputs){if(!e.indexed)continue;let t=o[e.name];if(!t){a.topics.push(null);continue}Array.isArray(t)?a.topics.push(t.map(t=>gW(e.type,t))):"string"===e.type?a.topics.push(lb(t)):a.topics.push(gW(e.type,t))}return a.topics.length||delete a.topics,e&&(a.address=e.toLowerCase()),a},yh=(e,t,r)=>{let n,i=Array.isArray(e.inputs)?e.inputs.length:0;if(e.inputs&&i!==t.length)throw new t7(`The number of arguments is not matching the methods required number. You need to pass ${i} arguments.`);if(n=e.inputs?gG(Array.isArray(e.inputs)?e.inputs:[],t).replace("0x",""):gK(t).replace("0x",""),pv(e)){if(!r)throw new t7("The contract has no contract data option set. This is necessary to append the constructor parameters.");return r.startsWith("0x")?`${r}${n}`:`0x${r}${n}`}return`${gY(e)}${n}`};class yf extends cv{constructor(e,t){super(e,t),this.address=e.address,this.topics=e.topics,this.abi=e.abi,this.jsonInterface=e.jsonInterface}_buildSubscriptionParams(){return["logs",{address:this.address,topics:this.topics}]}formatSubscriptionResult(e){return mc(this.abi,e,this.jsonInterface,super.returnFormat)}}function yp(e,t,r){if(r>e.length)throw Error("invalid RLP (safeSlice): end slice of Uint8Array out-of-bounds");return e.slice(t,r)}function yg(e){if(0===e[0])throw Error("invalid RLP: extra zeros");return yb(yy(e))}let ym=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function yy(e){let t="";for(let r=0;r<e.length;r++)t+=ym[e[r]];return t}function yb(e){let t=Number.parseInt(e,16);if(Number.isNaN(t))throw Error("Invalid byte sequence");return t}function yw(e){if("string"!=typeof e)throw TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw Error("hexToBytes: received invalid unpadded hex");let t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){let n=2*r;t[r]=yb(e.slice(n,n+2))}return t}function yv(e){return new TextEncoder().encode(e)}function yE(e){if(e<0)throw Error("Invalid integer as argument, must be unsigned!");let t=e.toString(16);return t.length%2?`0${t}`:t}function yA(e){return e.length%2?`0${e}`:e}function yx(e){return e.length>=2&&"0"===e[0]&&"x"===e[1]}function yS(e){return"string"!=typeof e?e:yx(e)?e.slice(2):e}let yk=(e,t,r,n)=>{var i,s;let o={};return lt(e.data)&&"both"!==n||(o.data=yh(t,r,null!=(i=e.data)?i:e.input)),lt(e.input)&&"both"!==n||(o.input=yh(t,r,null!=(s=e.input)?s:e.data)),lt(o.input)&&lt(o.data)&&(o[n]=yh(t,r)),{data:o.data,input:o.input}},y_=({abi:e,params:t,options:r,contractOptions:n})=>{var i,s,o;if(!(null!=(o=null!=(s=null!=(i=null==r?void 0:r.input)?i:null==r?void 0:r.data)?s:n.input)?o:n.data)&&!(null==r?void 0:r.to)&&!n.address)throw new t7("Contract address not specified");if(!(null==r?void 0:r.from)&&!n.from)throw new t7('Contract "from" address not specified');let a=ln({to:n.address,gas:n.gas,gasPrice:n.gasPrice,from:n.from,input:n.input,maxPriorityFeePerGas:n.maxPriorityFeePerGas,maxFeePerGas:n.maxFeePerGas,data:n.data},r),l=yk(a,e,t,null==r?void 0:r.dataInputFill);return Object.assign(Object.assign({},a),{data:l.data,input:l.input})},yI=({abi:e,params:t,options:r,contractOptions:n})=>{if(!(null==r?void 0:r.to)&&!n.address)throw new t7("Contract address not specified");let i=ln({to:n.address,gas:n.gas,gasPrice:n.gasPrice,from:n.from,input:n.input,maxPriorityFeePerGas:n.maxPriorityFeePerGas,maxFeePerGas:n.maxFeePerGas,data:n.data},r),s=yk(i,e,t,null==r?void 0:r.dataInputFill);return Object.assign(Object.assign({},i),{data:s.data,input:s.input})},yT=({abi:e,params:t,options:r,contractOptions:n})=>{let i=ln({to:n.address,gas:n.gas,gasPrice:n.gasPrice,from:n.from,input:n.input,data:n.data},r),s=yk(i,e,t,null==r?void 0:r.dataInputFill);return Object.assign(Object.assign({},i),{data:s.data,input:s.input})},yC=e=>"object"==typeof e&&!lt(e)&&0!==Object.keys(e).length&&!le(e),yP=({abi:e,params:t,options:r,contractOptions:n})=>{if(!(null==r?void 0:r.to)&&!n.address)throw new t7("Contract address not specified");if(!(null==r?void 0:r.from)&&!n.from)throw new t7('Contract "from" address not specified');let i=ln({to:n.address,gas:n.gas,gasPrice:n.gasPrice,from:n.from,input:n.input,maxPriorityFeePerGas:n.maxPriorityFeePerGas,maxFeePerGas:n.maxFeePerGas,data:n.data},r),s=yk(i,e,t,null==r?void 0:r.dataInputFill);return Object.assign(Object.assign({},i),{data:s.data,input:s.input})};var yR=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class yD{_contractMethodDeploySend(e){let t={transactionResolver:e=>{if(e.status===BigInt(0))throw new t7("code couldn't be stored",e);let t=this.parent.clone();return t.options.address=e.contractAddress,t},contractAbi:this.parent.options.jsonInterface,checkRevertBeforeSending:!1};return al(this.parent.getTransactionMiddleware())?mR(this.parent,e,this.parent.defaultReturnFormat,t):mR(this.parent,e,this.parent.defaultReturnFormat,t,this.parent.getTransactionMiddleware())}constructor(e,t){this.parent=e,this.deployOptions=t;let{args:r,abi:n,contractOptions:i,deployData:s}=this.calculateDeployParams();this.args=r,this.constructorAbi=n,this.contractOptions=i,this.deployData=s}send(e){let t=Object.assign({},e),r=this.populateTransaction(t);return this._contractMethodDeploySend(r)}populateTransaction(e){var t,r;let n=Object.assign(Object.assign({},this.contractOptions),{from:null!=(r=null!=(t=this.contractOptions.from)?t:this.parent.defaultAccount)?r:void 0}),i=y_({abi:this.constructorAbi,params:this.args,options:Object.assign(Object.assign({},e),{dataInputFill:this.parent.contractDataInputFill}),contractOptions:n});return i.dataInputFill&&delete i.dataInputFill,i}calculateDeployParams(){var e,t,r,n,i,s;let o=this.parent.options.jsonInterface.find(e=>"constructor"===e.type);o||(o={type:"constructor",stateMutability:""});let a=lm({format:"bytes"},null!=(t=null==(e=this.deployOptions)?void 0:e.input)?t:this.parent.options.input,Z),l=lm({format:"bytes"},null!=(n=null==(r=this.deployOptions)?void 0:r.data)?n:this.parent.options.data,Z);if((!a||"0x"===a.trim())&&(!l||"0x"===l.trim()))throw new t7("contract creation without any data provided.");let c=null!=(s=null==(i=this.deployOptions)?void 0:i.arguments)?s:[];return{args:c,abi:o,contractOptions:Object.assign(Object.assign({},this.parent.options),{input:a,data:l}),deployData:null!=a?a:l}}estimateGas(e){return yR(this,arguments,void 0,function*(e,t=this.parent.defaultReturnFormat){let r=Object.assign({},e);return this.parent.contractMethodEstimateGas({abi:this.constructorAbi,params:this.args,returnFormat:t,options:r,contractOptions:this.contractOptions})})}encodeABI(){return yh(this.constructorAbi,this.args,lm({format:"bytes"},this.deployData,this.parent.defaultReturnFormat))}decodeData(e){return Object.assign(Object.assign({},g0(this.constructorAbi,e.replace(this.deployData,""),!1)),{__method__:this.constructorAbi.type})}}var yN=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class yM extends cb{constructor(e,t){super(e.requestManager,e.registeredSubscriptions),this.parentContract=t}subscribe(e,t){let r=Object.create(null,{subscribe:{get:()=>super.subscribe}});return yN(this,arguments,void 0,function*(e,t,n=Z){return r.subscribe.call(this,e,null!=t?t:this.parentContract.options,n)})}}var yB=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let yO={logs:yf,newHeads:mY,newBlockHeaders:mY};class yL extends hA{get subscriptionManager(){return this._subscriptionManager}constructor(e,t,r,n,i){var s,o,a;let l,c,u=le(t)?t:le(r)?r:void 0;if(super(Object.assign(Object.assign({},l=yC(t)?t:yC(r)?r:n),{provider:c="object"==typeof t&&"provider"in t?t.provider:"object"==typeof r&&"provider"in r?r.provider:"object"==typeof n&&"provider"in n?n.provider:yL.givenProvider,registeredSubscriptions:yO})),this.syncWithContext=!1,this._functions={},this._subscriptionManager=new yM(super.subscriptionManager,this),(null==l?void 0:l.wallet)&&(this._wallet=l.wallet),(null==l?void 0:l.accountProvider)&&(this._accountProvider=l.accountProvider),!al(u)&&!al(u.data)&&!al(u.input)&&"both"!==this.config.contractDataInputFill)throw new rr({data:u.data,input:u.input});this._overloadedMethodAbis=new Map;let d=ld(n)?n:ld(r)?r:null!=i?i:this.defaultReturnFormat,h="string"==typeof t?t:void 0;this.config.contractDataInputFill=null!=(s=null==u?void 0:u.dataInputFill)?s:this.config.contractDataInputFill,this._parseAndSetJsonInterface(e,d),this.defaultReturnFormat!==d&&(this.defaultReturnFormat=d),al(h)||this._parseAndSetAddress(h,d),this.options={address:h,jsonInterface:this._jsonInterface,gas:null!=(o=null==u?void 0:u.gas)?o:null==u?void 0:u.gasLimit,gasPrice:null==u?void 0:u.gasPrice,from:null==u?void 0:u.from,input:null==u?void 0:u.input,data:null==u?void 0:u.data},this.syncWithContext=null!=(a=null==u?void 0:u.syncWithContext)&&a,l instanceof hA&&this.subscribeToContextEvents(l),Object.defineProperty(this.options,"address",{set:e=>this._parseAndSetAddress(e,d),get:()=>this._address}),Object.defineProperty(this.options,"jsonInterface",{set:e=>this._parseAndSetJsonInterface(e,d),get:()=>this._jsonInterface}),l instanceof hA&&l.on(D.CONFIG_CHANGE,e=>{this.setConfig({[e.name]:e.newValue})})}setTransactionMiddleware(e){this.transactionMiddleware=e}getTransactionMiddleware(){return this.transactionMiddleware}get events(){return this._events}get methods(){return this._methods}clone(){let e;return e=this.options.address?new yL([...this._jsonInterface,...this._errorsInterface],this.options.address,{gas:this.options.gas,gasPrice:this.options.gasPrice,from:this.options.from,input:this.options.input,data:this.options.data,provider:this.currentProvider,syncWithContext:this.syncWithContext,dataInputFill:this.config.contractDataInputFill},this.getContextObject()):new yL([...this._jsonInterface,...this._errorsInterface],{gas:this.options.gas,gasPrice:this.options.gasPrice,from:this.options.from,input:this.options.input,data:this.options.data,provider:this.currentProvider,syncWithContext:this.syncWithContext,dataInputFill:this.config.contractDataInputFill},this.getContextObject()),this.context&&e.subscribeToContextEvents(this.context),e}deploy(e){return new yD(this,e)}getPastEvents(e,t,r){return yB(this,void 0,void 0,function*(){var n;let i="string"==typeof e?e:f2,s="string"==typeof e||ld(e)?ld(t)?{}:t:e,o=ld(e)?e:ld(t)?t:null!=r?r:this.defaultReturnFormat,a="allEvents"===i||i===f2?f3:this._jsonInterface.find(e=>"name"in e&&e.name===i);if(!a)throw new t7(`Event ${String(i)} not found.`);let{fromBlock:l,toBlock:c,topics:u,address:d}=yd(this.options,a,null!=s?s:{}),h=yield mL(this,{fromBlock:l,toBlock:c,topics:u,address:d},o),f=h?h.map(e=>"string"==typeof e?e:mc(a,e,this._jsonInterface,o)):[],p=null!=(n=null==s?void 0:s.filter)?n:{},g=Object.keys(p);return g.length>0?f.filter(e=>"string"==typeof e||g.every(t=>{var r;if(Array.isArray(p[t]))return p[t].some(r=>String(e.returnValues[t]).toUpperCase()===String(r).toUpperCase());let n=null==(r=a.inputs)?void 0:r.filter(e=>e.name===t)[0];return(null==n?!!void 0:!!n.indexed)&&"string"===n.type&&lb(p[t])===String(e.returnValues[t])||String(e.returnValues[t]).toUpperCase()===String(p[t]).toUpperCase()})):f})}_parseAndSetAddress(e,t=this.defaultReturnFormat){this._address=e?aQ(lm({format:"address"},e,t)):e}decodeMethodData(e){let t=e.slice(0,10),r=this._jsonInterface.filter(e=>"error"!==e.type).find(e=>t===gY(p_(e)));if(!r)throw new t7(`The ABI for the provided method signature ${t} was not found.`);return g0(r,e)}_parseAndSetJsonInterface(e,t=this.defaultReturnFormat){var r,n;this._functions={},this._methods={},this._events={};let i=[],s=e.filter(e=>"error"!==e.type),o=e.filter(e=>py(e));for(let e of s){let s=Object.assign(Object.assign({},e),{signature:""});if(pw(s)){let e=p_(s),t=gY(e);s.methodNameWithInputs=e,s.signature=t,s.constant="view"===s.stateMutability||"pure"===s.stateMutability||s.constant,s.payable="payable"===s.stateMutability||s.payable,this._overloadedMethodAbis.set(s.name,[...null!=(r=this._overloadedMethodAbis.get(s.name))?r:[],s]);let i=null!=(n=this._overloadedMethodAbis.get(s.name))?n:[],a=this._createContractMethod(i,o),l=this._createContractMethod(i,o,!0);this._functions[e]={signature:t,method:l},this._methods[s.name]=a,this._methods[e]=l,this._methods[t]=l}else if(pb(s)){let e=p_(s),r=pT(e),n=this._createContractEvent(s,t);s.signature=r,e in this._events&&"bound"!==s.name||(this._events[e]=n),this._events[s.name]=n,this._events[r]=n}i=[...i,s]}this._events.allEvents=this._createContractEvent(f3,t),this._jsonInterface=[...i],this._errorsInterface=o}_getAbiParams(e,t){var r;try{return oG(null!=(r=e.inputs)?r:[],t)}catch(t){throw new t7(`Invalid parameters for method ${e.name}: ${t.message}`)}}_createContractMethod(e,t,r=!1){let n=e[e.length-1];return(...e)=>{var i,s,o;let a,l=null!=(s=r?null==(i=this._overloadedMethodAbis.get(n.name))?void 0:i.filter(e=>e.signature===n.signature):this._overloadedMethodAbis.get(n.name))?s:[],c=l[0],u=t,d=l.filter(t=>{var r;return(null!=(r=t.inputs)?r:[]).length===e.length});if(1===l.length||0===d.length)a=this._getAbiParams(c,e),ab.validate(null!=(o=n.inputs)?o:[],a);else{let t=[],r=[];for(let n of d)try{a=this._getAbiParams(n,e),ab.validate(n.inputs,a),r.push(n)}catch(e){t.push(e)}if(1===r.length?[c]=r:r.length>1&&([c]=r,console.warn(`Multiple methods found that is compatible with the given inputs.
	Found ${r.length} compatible methods: ${JSON.stringify(r.map(e=>`${e.methodNameWithInputs} (signature: ${e.signature})`))} 
	The first one will be used: ${c.methodNameWithInputs}`)),t.length===d.length)throw new oR(t)}let h={arguments:a,call:(e,t)=>yB(this,void 0,void 0,function*(){return this._contractMethodCall(c,a,u,e,t)}),send:e=>this._contractMethodSend(c,a,u,e),populateTransaction:(t,r)=>{var i,s;let o=null!=r?r:this.options;o=Object.assign(Object.assign({},o),{input:void 0,from:null!=(s=null!=(i=null==o?void 0:o.from)?i:this.defaultAccount)?s:void 0});let a=y_({abi:n,params:e,options:Object.assign(Object.assign({},t),{dataInputFill:this.config.contractDataInputFill}),contractOptions:o});return a.dataInputFill&&delete a.dataInputFill,a},estimateGas:(e,...t)=>yB(this,[e,...t],void 0,function*(e,t=this.defaultReturnFormat){return this.contractMethodEstimateGas({abi:c,params:a,returnFormat:t,options:e})}),encodeABI:()=>yh(c,a),decodeData:e=>g0(c,e),createAccessList:(e,t)=>yB(this,void 0,void 0,function*(){return this._contractMethodCreateAccessList(c,a,u,e,t)})};return c.stateMutability,h}}_contractMethodCall(e,t,r,n,i){return yB(this,void 0,void 0,function*(){var s;let o=yI({abi:e,params:t,options:Object.assign(Object.assign({},n),{dataInputFill:this.config.contractDataInputFill}),contractOptions:Object.assign(Object.assign({},this.options),{from:null!=(s=this.options.from)?s:this.config.defaultAccount})});try{let t=yield mB(this,o,i,this.defaultReturnFormat);return g1(e,t)}catch(e){throw e instanceof rt&&g5(r,e.cause),e}})}_contractMethodCreateAccessList(e,t,r,n,i){return yB(this,void 0,void 0,function*(){var s;let o=yP({abi:e,params:t,options:Object.assign(Object.assign({},n),{dataInputFill:this.config.contractDataInputFill}),contractOptions:Object.assign(Object.assign({},this.options),{from:null!=(s=this.options.from)?s:this.config.defaultAccount})});try{return mH(this,o,i,this.defaultReturnFormat)}catch(e){throw e instanceof rt&&g5(r,e.cause),e}})}_contractMethodSend(e,t,r,n,i){var s,o;let a=null!=i?i:this.options;a=Object.assign(Object.assign({},a),{input:void 0,from:null!=(o=null!=(s=a.from)?s:this.defaultAccount)?o:void 0});let l=y_({abi:e,params:t,options:Object.assign(Object.assign({},n),{dataInputFill:this.config.contractDataInputFill}),contractOptions:a}),c=al(this.transactionMiddleware)?mR(this,l,this.defaultReturnFormat,{checkRevertBeforeSending:!1,contractAbi:this._jsonInterface}):mR(this,l,this.defaultReturnFormat,{checkRevertBeforeSending:!1,contractAbi:this._jsonInterface},this.transactionMiddleware);return c.on("error",e=>{e instanceof rt&&g5(r,e.cause)}),c}contractMethodEstimateGas(e){return yB(this,arguments,void 0,function*({abi:e,params:t,returnFormat:r,options:n,contractOptions:i}){return mO(this,yT({abi:e,params:t,options:Object.assign(Object.assign({},n),{dataInputFill:this.config.contractDataInputFill}),contractOptions:null!=i?i:this.options}),x.LATEST,null!=r?r:this.defaultReturnFormat)})}_createContractEvent(e,t=this.defaultReturnFormat){return(...r)=>{var n;let{topics:i,fromBlock:s}=yd(this.options,e,r[0]),o=new yf({address:this.options.address,topics:i,abi:e,jsonInterface:this._jsonInterface},{subscriptionManager:this.subscriptionManager,returnFormat:t});return al(s)||this.getPastEvents(e.name,{fromBlock:s,topics:i},t).then(e=>{e&&e.forEach(e=>o.emit("data",e))}).catch(e=>{o.emit("error",new rp("Failed to get past events.",e))}),null==(n=this.subscriptionManager)||n.addSubscription(o).catch(e=>{o.emit("error",new rp("Failed to subscribe.",e))}),o}}subscribeToContextEvents(e){let t=this;this.context=e,t.syncWithContext&&e.on(D.CONFIG_CHANGE,e=>{t.setConfig({[e.name]:e.newValue})})}}let yF=yL,yU={addr:"0x3b3b57de",name:"0x691f3431",abi:"0x2203ab56",pubkey:"0xc8690233",text:"0x59d1d43c",contenthash:"0xbc1c58d1"},yj={setAddr:"addr",addr:"addr",pubkey:"pubkey",contenthash:"contenthash",text:"text",name:"name"},yH={main:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",goerli:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},y$={"0x1":"main","0x5":"goerli"},yq=[{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"label",type:"bytes32"},{indexed:!1,internalType:"address",name:"owner",type:"address"}],name:"NewOwner",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"address",name:"resolver",type:"address"}],name:"NewResolver",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"address",name:"owner",type:"address"}],name:"Transfer",type:"event"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"}],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"}],name:"recordExists",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"}],name:"resolver",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"}],name:"ttl",outputs:[{internalType:"uint64",name:"",type:"uint64"}],stateMutability:"view",type:"function"}],yz=[{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"address",name:"a",type:"address"}],name:"AddrChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"coinType",type:"uint256"},{indexed:!1,internalType:"bytes",name:"newAddress",type:"bytes"}],name:"AddressChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"bytes",name:"hash",type:"bytes"}],name:"ContenthashChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"bytes",name:"name",type:"bytes"},{indexed:!1,internalType:"uint16",name:"resource",type:"uint16"},{indexed:!1,internalType:"bytes",name:"record",type:"bytes"}],name:"DNSRecordChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"bytes",name:"name",type:"bytes"},{indexed:!1,internalType:"uint16",name:"resource",type:"uint16"}],name:"DNSRecordDeleted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"}],name:"DNSZoneCleared",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"bytes",name:"lastzonehash",type:"bytes"},{indexed:!1,internalType:"bytes",name:"zonehash",type:"bytes"}],name:"DNSZonehashChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!0,internalType:"bytes4",name:"interfaceID",type:"bytes4"},{indexed:!1,internalType:"address",name:"implementer",type:"address"}],name:"InterfaceChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"string",name:"name",type:"string"}],name:"NameChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"x",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"y",type:"bytes32"}],name:"PubkeyChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!0,internalType:"string",name:"indexedKey",type:"string"},{indexed:!1,internalType:"string",name:"key",type:"string"}],name:"TextChanged",type:"event"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"},{internalType:"uint256",name:"contentTypes",type:"uint256"}],name:"ABI",outputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"}],name:"addr",outputs:[{internalType:"address payable",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"},{internalType:"uint256",name:"coinType",type:"uint256"}],name:"addr",outputs:[{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"}],name:"contenthash",outputs:[{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"},{internalType:"bytes32",name:"name",type:"bytes32"},{internalType:"uint16",name:"resource",type:"uint16"}],name:"dnsRecord",outputs:[{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"},{internalType:"bytes32",name:"name",type:"bytes32"}],name:"hasDNSRecords",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"},{internalType:"bytes4",name:"interfaceID",type:"bytes4"}],name:"interfaceImplementer",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"}],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"}],name:"pubkey",outputs:[{internalType:"bytes32",name:"x",type:"bytes32"},{internalType:"bytes32",name:"y",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceID",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"},{internalType:"string",name:"key",type:"string"}],name:"text",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"}],name:"zonehash",outputs:[{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"},{internalType:"address",name:"a",type:"address"}],name:"setAddr",outputs:[],stateMutability:"nonpayable",type:"function"}];var yV="AEkU4AngDVgB0QKRAQYBOwDqATEAnwDbAIUApABsAOAAbwCRAEYAiQBPAHYAPgA+ACsANwAlAGMAHwAvACsAJQAWAC8AGwAiACIALwAUACsAEQAiAAsAGwARABcAGAA6ACkALAAsADUAFgAsABEAHQAhAA8AGwAdABUAFgAZAA0ADQAXABAAGQAUABIEqgYJAR4UFjfDBdMAsQCuPwFnAKUBA10jAK5/Ly8vLwE/pwUJ6/0HPwbkMQVXBVgAPSs5APa2EQbIwQuUCkEDyJ4zAsUKLwKOoQKG2D+Ob4kCxcsCg/IBH98JAPKtAUECLY0KP48A4wDiChUAF9S5yAwLPZ0EG3cA/QI5GL0P6wkGKekFBIFnDRsHLQCrAGmR76WcfwBbBpMjBukAGwA7DJMAWxVbqfu75wzbIM8IuykDsRQ7APcta6MAoX0YABcEJdcWAR0AuRnNBPoJIEw3CZcJiB4bVllM44NCABMADAAVAA5rVAAhAA4AR+4V2D3zOVjKleYuChAdX01YPewAEwAMABUADmsgXECXAMPrABsAOQzFABsVW6n7Adq4HB0FWwXiAtCfAsSwCkwcpGUUcxptTPUAuw1nAuEACy00iRfJkQKBewETGwC9DWcC4QALLQFIUCWRTAoDLfsFMgnXaRetAddDAEkrEncCMRYhAusnuTdrADnhAfUlAMcOy7UBG2OBALEFAAUAitNJBRvDHwcXAKgn0QGhKy0DmwBnAQoZPu03dAQYFwCqAccCIQDTKxJzOvNQsAWQOncnNUgF+icFWQVYr7gFaTtdQhI6WEGXe5NmX6H4CxMDxQcl8XcjBKNLAlNTAnUbqycBj6OlNVsDRRcEg2EJANEGqz8vIwcpAjldAGsBYR9xAIMdGQCVAUm3ACdpFwGvxQM3LSFDUwFvWQZlAmUA8UkXAykBBQBJQQCrAF0AcwArtQYH8+8ZjX8ACSEAKQCzG0cB0QHbBwsxl3iB6AAKABEANAA9ADgzd3nTwBBfEFwBTQlMbDoVCwKsD6YL5REVDNEqy9PYADSpB+sDUwfrA1MDUwfrB+sDUwfrA1MDUwNTA1McCvAa08AQXw9IBG0FjgWLBNYIgyZJEYEHKAjSVA10HhxHA0UA/CMlSRw7kzMLJUJMDE0DB/w2QmynfTgDRzGrVPWQogPLMk85bAEecRKgACoPcxw1tU5+ekdxoApLT661f0liTmcCvjqoP/gKIQmTb7t3TgY9EBcnoRDzDC8BsQE3DelL1ATtBjcExR95GRUPyZWYCKEt2QzpJt8unYBWI/EqfwXpS/A82QtJUWQPVQthCd86X4FKAx0BCSKHCtkNNQhpEO8KxWcN4RFBBzUD0UmWAKEG/QsNHTEVsSYMYqgLBTlzBvca8guLJqsTJXr4Bc8aHQZJASUa+wDLLuOFrFotXBhPWwX/CyEjwxSkUBwNIUCzeEQaFwcRJaUCjUNsSoNRMh6PIfI8OQ1iLg9ReAfxPAEZSwt9PJpGp0UKEc4+iT1EIkVMKAQxeywrJ4cJyw+BDLV8bgFVCR0JrQxtEy0REzfBCDUHFSmXICcRCB1GkWCWBPObA+8TzQMHBTsJPQcPA7EcKRMqFSUFCYEg0wLvNtEurwKLVnwBEwXHDyEf2xBMR9wO5QiXAmEDfyXnACkVHQATIpcIP18AW4/UUwEuxwjDamgjcANjFONdEW8HjQ5TB6McLxW7HN1wxF4HhgQon6sJVwFxCZUBWwTfCAU1V4ycID1nT4tUGJcgXUE7XfgCLQxhFZtEuYd0AocPZxIXATEBbwc1DP0CcxHpEWcQkQjnhgA1sTP0OiEESyF/IA0KIwNLbMoLIyb1DPRlAZ8SXgMINDl36menYLIgF/kHFTLBQVwh7QuOT8kMmBq9GD5UKhngB7sD7xrvJ+ZBUwX7A58POkkz6gS5C2UIhwk7AEUOnxMH0xhmCm2MzAEthwGzlQNTjX8Ca4sGMwcHAGMHgwV14QAZAqMInwABAMsDUwA1AqkHmQAVAIE9ATkDIysBHeECiwOPCC3HAZErAe8lBBe/DBEA8zNuRgLDrQKAZmaeBdlUAooCRTEBSSEEAUpDTQOrbd0A1wBHBg/bQwERp0bHFt8/AdtrJwDDAPcAATEHAT0ByQHvaQCzAVsLLQmer7EBSeUlAH8AEWcB0wKFANkAMQB77QFPAEkFVfUFzwJLRQENLRQnU10BtwMbAS8BCQB1BseJocUDGwRpB88CEBcV3QLvKgexAyLbE8lCwQK92lEAMhIKNAq1CrQfX/NcLwItbj1MAAofpD7DP0oFTTtPO1Q7TztUO087VDtPO1Q7TztUA5O73rveCmhfQWHnDKIN0ETEOkUT12BNYC4TxC2zFL0VyiVSGTkauCcBJeBVBQ8ALc9mLAgoNHEXuAA7KWSDPWOCHiwKRxzjU41U9C0XAK1LnjOrDagbEUQ8BUN16WImFgoKHgJkfQJiPldJq1c3HAKh8wJolAJmBQKfgDgXBwJmNwJmIgRqBHsDfw8Dfo45AjlzEzl+Oh8fAmwZAjIyOAYCbcMCbarrhi9jQScBYwDaAN0ARgEHlAyJAPoHvgAJsQJ3KwJ2njsCeUc/Ani2GVjXRapG0wJ8OwJ6xAJ9BQJ87AVVBRxH/Eh5XyAAJxFJVEpXERNKyALQ/QLQyEsjA4hLA4fiRMGRLgLynVz/AwOqS8pMKSHLTUhNqwKLOwKK1L0XAxk/YwGzAo4zAo5YPJN9Ao7VAo5YdFGwUzEGUtBUgQKT9wKTCADlABhVGlWrVcwCLBcpkYIy3XhiRTc1ApebAu+uWB2kAFUhApaLApZ4mAClWahaBX1JADcClrEClkpcQFzNApnHAplgXMZdAxUCnJc5vjqZApwSAp+XAp60hgAZCy0mCwKd7QKejgCxOWEwYesCns8CoGoBpQKemxsCnkqhY8RkIyEnAierAiZ6AqD3AqBIAqLZAqHAAqYrAqXKAqf7AHkCp+5oeGit/0VqGGrNAqzfAqyqAq1jAqz+AlcZAlXYArHd0wMfSmyTArK5CQKy5BNs3G1fbURbAyXJArZYNztujAMpQQK4WgK5QxECuSZzcDJw3QK9FQK71nCSAzINAr6Ecf4DM20CvhZzHnNLAsPHAsMAc350RzFBdNwDPKMDPJYDPbsCxXgCxkMCxgyFAshlTQLIQALJSwLJKgJkmQLdznh1XXiqeSFLzAMYn2b+AmHwGe+VIHsHXo5etw0Cz2cCz2grR0/O7w+bAMKpAs9vASXmA04OfkcBAtwjAtuGAtJLA1JYA1NbAP0DVYiAhTvHEulcQYIYgs+CyoOJAtrDAtnahAyERac4A4ahACsDZAqGbVX1AFEC32EC3rRvcwLiK+0QAfMsIwH0lwHyzoMC6+8C6Wx1Aur1AurgAPVDAbUC7oUC65iWppb/Au47A4XcmHVw3HGdAvL/AGUDjhKZjwL3DwORagOSgwL3lAL51QL4YpoYmqe3M5saA51/Av72ARcANZ8Yn68DBYkDpmYDptUAzcEDBmahhKIBBQMMRQELARsHaQZdtWMBALcEZ7sNhx6vCQATcTUAHwMvEkkDhXsBXyMdAIzrAB0A5p8Dm40IswYbn8EApwURu+kdPT4WeAVoNz5AK0IhQrRfcRFfvACWxQUyAJBMGZu5OyZgMhG6zw4vGMYYicn2BVcFWAVXBVgFYwVYBVcFWAVXBVgFVwVYBVcFWEYVCNeFZwICAgpkXukrBMkDsQYvu7sAuwSnuwDnQCkWsgVGPmk+cEI/QrZfdTdf6ABYETOrAIz+zGvL/KbnRno9JiMEKxYnNjV+bd9qwfEZwixpAWvXbjAXBV8FasnBybgIz0lbAAAACnxefYu+ADM/gQADFtEG5a0jBQCMwwsDAQ0A5WUdPSQfSkKxQrxBOCNfJ2A2JzgjCcE9CkQ/Qz54PoE+cD5xAolCvElCO1/LTk9qTQosa1QvagtuH1/gMzobCWebCmIjKzwdJkKrQrwrzAHL/F/JDh8uCQgJIn6d32o6LUoXyavJrAllwcvMCmBBXw/lEKMRAJONHUVCJRupbTnOOAozP0M+cEI/HAcKHUxHbFssLVrhvBIKfe0dK0I/HF0ISgkOM1RDQjcEO0OcLAqBGy1CPxv1CFMiIxgwMQAFj2HwXgpxZMlgC2AtI25DYBk5AhseYLMGAmsQZU5gTREBZOdgFWCVYH1gs2BLYJFoFhcGtQ7cVam8WgtDFqsBuyvNwQIfFQAcAx4BeQJsLzCVUoABigq4RxoA5CN0jgrKDaZN6gGbAoecTwVAXwD39wkANBZXDAulDCQfuq9HAE8MNAAVE58rggh6AtILS2URGwDYTgZ1BAoeWgAxALa4AZonCxZvqyQ4nxkBWwGGCfwD2e0PBqoGSga5AB3LValaCbthE4kLLT8OuwG7ASICR1ooKCggHh8hLBImBiEMjQBUAm5XkEmVAW4fD3FHAdN1D85RIBmpsE3qBxEFTF8A9/cKAHoGJGwKKwulODAtx69WDQsAX7wLAGNAlQh6AOpN7yIbvwAxALa4AZonLTsOzgKQGHtQu1jIdHKO16WbDvWZFT0b7AEpEFwSBg8bAccJOhCTBRArDDYLABEAs84BAgCkAOEAmIIABWtXLwAUAFsbxi5sdioNwRACOyQz0+EcHgsbfQJ7Ls6hHATBCqrxbAA3OS0Opge7CQAQOi7OERkAfavaHA+7GkcczaF3HgE9Kl8cAuugCAHCAULz5B9lAb4Jtwz6CDwKPgAFwAs9AksNuwi8DTwKvC7OoSoJPA67BZgBG2sKD4sa4QHDARELuxY7AKALOxC7BBige9wAO2sMPAACpgm8BRvQ9QUBvgH6bsoGewAHuwG7D00RErwBAQDqAQAAdBVbBhbLFPxvF7sYOwAuuwLrDlaouwAeuwJVICp/AAG7AALjAAg7FTwVuwAbuwG9KOClWw6/xAD0AGj7L7ZtvgNIo7vIqDsDAbuVJ0sAAlsACrsEAOfdGbsIGnsIoQUK/3AA37unuxjbGruji3lyBvupm4MAErsGGwsBvAAAhgBtuwYAC7unOwEaO7oIoZzKAbsL7QfAqTsA4XsBvwAA5QAVuwAG+wAJuwBpiwAauwAOuwIYu45pFfsAAVsADmsALkseAAa7ABe7CCEADUoBwgC3ryYBwAAAtAAOmwG+J+QAsloAHBsBv/7hCqEABcYLFRXbAAebAEK7AQIAabsAC3sAHbsACLsJoQAFygBunxnVAJEIIQAFygABOwAH2wAdmwghAAaaAAl7ABsrAG0bAOa7gAAIWwAUuwkhAAbKAOOLAAk7C6EOxPtfAAc7AG6cQEgARwADOwAJrQM3AAcbABl7Abv/Aab7AAobAAo7AAn7p+sGuwAJGwADCwAQOwAAFDsAEWsAD4sADesADbsAGQsGFhsAFTsAbpsWswG7ALoAEzsDAGkrCgDhSwACOwAEUgAXewUbAAbQABi7AAv7AF+7AGv7AOSLAbsAF3YBvAABcguhAAVKHgF7KFIAOUUA/gcNDHIAKCpwAaQFCF4BvF4jDAkHb0tsXyqJHzwUYi02A6EKtAHYABYC0QNuAXZyR1IUIQNPAhU+ASwGA3NGvHtSekAAKQAxAfsAUwrbAHuQLAErAHblDREyRgFKAFcFAAFQAQeKzAB4OwQgpQBaANYVAJVoNx+LAM1rsQDP1BYIwnVzGxhWHQnRAYiQqyJTU01IEjzCifkAfxw3QCkr4BGXTwByASksMClCGQ8DMFUE98XuAEtl3ABqAnECPxF6Osd4LjXVBgUAEBsdCggMKgQfHSlOU04IuboAChLNACYAARoAhgCJAI41AO4AtADgAJ08ALsAqwCmAKEA8gCfANMAnADrAQwBBwDAAHkAWgDLAM0BBwDXAOsAiACiATUA4wDYANUDAQcqM9TU1NS2wNzN0M5DMhcBTQFXL0cBVQFkAWMBVgFHS0NFaA0BThUHCAMyNgwHACINJCYpLDg6Oj09PT4/DkAeUVFRUVNTUlMpVFVXVlYcXWFhYGJhI2ZocG9ycnJycnJ0dHR0dHR0dHR0dHZ2d3Z1WwBA7ABFAJYAdAAuAGLyAIoAUwBTADMCc+kAh//y8gBgAI/sAJsASwBeAGD5+aoAgQCBAGUAUgCtAB4AsgB/AjwCPwD4AOMA+gD6AOQA+wDlAOUA5ADiACkCdwFNATwBOgFQAToBOgE6ATUBNAE0ATQBGAFUDwArCAAATRcKFgMVFg4AigCSAKIASwBkGAItAHAAaQCRAxIDJCoDHkE+RykAiwJLAMMCUwKgALoCkgKSApICkgKSApIChwKSApICkgKSApICkgKRApEClAKcApMCkgKSApACkAKQApACjgKRAnEB0AKTApsCkgKSApEWeQsA+gUDpwJdAjYXAVAQNQLeEQorEwFKNxNNkQF3pDwBZVkA/wM9RwEAAJMpHhiPagApYABpAC4AiQOUzIvwroRaBborDsIRAZ3VdCoLBCMxbAEzWmwBsgDdfoB/foB+gYKCfoOGhH6FiIaAh4KIgol+in6LfoyKjX6Ofo+CkH6RfpJ+k36Ug5WIloKXftoC2WzhAtdsAIJsJGygAINsbARCBD8EQQREBEIESARFBEAERgRIBEcEQwRFBEgAlmZsAKMDh2wAtGYBBWwAyVFsbADPbAIMbAD2WmwA9gEZAPYA9AD0APUA9AN8XmzUhCNlvwD2APQA9AD1APQcbGwAiVpsAPYAiQEZAPYAiQLsAPYAiQN8XmzUhCNlvxxsAPdabAEZAPYA9gD0APQA9QD0APcA9AD0APUA9AN8XmzUhCNlvxxsbACJWmwBGQD2AIkA9gCJAuwA9gCJA3xebNSEI2W/HGwCQwE2bAJKATlsAkvBbGwCV2xsA54C7AOeA54DnwOfA58DnwN8XmzUhCNlvxxsbACJWmwBGQOeAIkDngCJAuwDngCJA3xebNSEI2W/HGwEN2wAiQQ4AIkGjTFtIC9s1m4DJmwA/QDGWgJsbABVWv4UMgJsbACJAmwAVAEAuV5sAmxebGwAiV5sAmxebD3YAEls1gJsbEZFNiJ9FGVAe8xvEZKvxVfKZszAVTBzYBH2d1iyUXEHH7twNw7eZF5JJRHI5EgaRr5D20/3dfONrFLSq5qSrrgd2CEUq722WBQ/LzpA+bx1oREI5xy4BDSZNun0ZWORUJqInZSyMaioyvfSI0l5uFDzbWaQ28/zdB0hwR4OQZ0/jn9ALSLNikjFYGfqR389qtFlhD3a6KdIh97rhZYpywuLc7o8ql5/X8KCbPU3L/QlmCowhRXhsGDvg6wUNprA9bM/49uxlAj7ZVy3ouEY/BgFXBNyK0TLrSjZWeJm/T4nz6QGLT3cJNtWRZVZTvIdtaxMMJRHgig9+S11LjBh7Inr06ykoch1U097Rw0hvgmOrydQyaWcEQDg0RavuMuT0zYabUZl1e33HNSK1oNUCS03eh+9C2EvF3fq9h+XBaAMFuoWeZf+mfZgL4HzyiKDIUtfNU4oFu0aE9qt3VA3U4D3fOSrAcYVnjG3cSkp1vhXZnp3JQm4JknKdBitO2NVnGCYQwU3YMWHWB87NEd+4AHuOKI8BSIH92reW0pfs+kWCTJxDCbRjFv8Cfc4/DSBYJScJYTeAEgg9wTEvcwd/QuHRHqGzAQ4fXf5FUI1lPrO+fvEcPl4JInM1z9AtBT2bL4QYEREe7KiSnnxTwtmAFjn8lqT3mND8qTktX2F16Ae9cakqJ6/pEQsHURqyqWlRMCzKXRKfCHT7sYHWx9/T/ugYTFY6iVN3Btm58ATJR5alYZybKMWojwOw3HbFn23NFyeLl7+Er82RchyYuBoGQ3j7SAWNxiYvp5U+Fq/DEzB9cG5DlJWsqkosRze92OVlCtQEYo1S1lF72Z8xWc4ld/+fFcfTEDTFb9d8tJGQ75dpJEvcWyGmGBiTbiWDdGOcw93Dmxq5ISUrmasygONfHLvhgo83HQZenbdBtSzBkvYrCEQ/xEDMhMZsN6gqplx5jGG9mSQLhM81UEdEeJ59sdNJDAFy/gPyJoKlwPZgB/MkC/kICLiCB8va+nCdO2ry4aDfkmPFpF/H/SGQ3LJ6aAv9dtJ8DniHtLOckZix0BVb0iR5V3LAp521LBSIi6AtV7r2ZB/hQEvAw54EFNOQcFnl1xGUIc67tqK1INNwD2n/RbwgzO9h45LM6VMuN8V1ZNIQ6t+Xy3lTqyVCD5kqLy/t3/b8MLbgDg8JIWDkSZ+LrGhhr+gYpH+pr1TnCUnZPjpUdw6bSL6MWVXoDDciQDWECwU2e6VEpfrcOBbrSOijqGkEIoJPbpmeJLkcwbvA0yWIixQVjo0HnYh7fji+Dfdq1mtV1lG2Zz9R7eFMHS+FK7nybutu2fwzDpFldO2pZBshsHJWaltn3PWOoGJpCT2jE8EHOuC6FkejNWcfsWCqNqMLP9xTwcWArj2EiiI7D+EaDi7/2cqHL1gPiF6C/J7aUo7RQqogPZ11WqbyP97nsoMxPOC78wZMF7B1Y0g7JNXJV/nN1m4xx8hbqWz07KSaqr5hE4icB326DMR/vUKX9LoNjle/ZWtbUhrTAcsdgrLlG5Ne8aiR0bS/2ZhpNOVVxavWIZsEM/rd68EB4vjbbD13NkMK1qvMk74vGbSkL7ULO0sZ9R6APSCo6KH+Xn98wEdw1bCPAnDTaBsD6sidAGN58uiH4a3ovG1KyZAu2XtyGgF/vgWKGxw9R1lfAVcfuYE71DHuxtTzfGZnHaDpDGWmfEq0N4GawE7yIkaoz8jcmVmzJe1ydM8q0p08YIxFcY1YcqQc1djWBEoNETDFcgk5waRftEJasPREkrV++N/TOKkERF1fCLrXS8DFGYGRBeECMQRNEs0ES3FzUtXCcNxpYEM3Uei6XodZruXUIRnn+UXf2b/r7n1vQutoi6WoIbW7svDNWBbUWcDUc7F9SJK3bvSy9KIqhgyJHoW2Kpvv0J4ob14HFXGWWVsYXJzjwxS+SADShTgCRjhoDgjAYRGxwJ1Vonw+cpnCKhz8NQPrb0SFxHIRbmG95Q2hlC4mDxvPBRbkFa60cvWakd7f0kVBxxktzZ9agPJEWyA63RSHYVqt8cPrs2uFJ3rS3k9ETGKn5+A6F9IOrdZHfT1biEyUJKEvwzuscwshGCBJvd16TrefW03xVnJf4xvs72PdxrMidjJO8EiWyN/VWyB3fv9kc34YIuZTFtXGo9DuG3H1Uka5FgBMwDPEvRcSabi3WakNQkXFecJlFk6buLVk5YHpuKWTw6oF632FPPSVIVl5hgUAeHhj0t/sw/PEEvThLQDDFE34eCg/rLOyXT3r+L98oRKrlTO0MdALYQ3rRQqC7d822dJPGxF1K4J2TtfPSMFaCAg0n0NGk9yiaKKOJD1v2aBX9HUOIawjjfvwCmjHZJTR62R9c9x33JnBjWrN4QYEOmehy0oZMP9XM9Zyi6TYoe07PaLceRXcCWZiY/imRUWW6+mci7+wMxSdwMdbXckXtvhJH8sc4iQcTwm7yp+3f7CaesTTQB2qkgeXh+wFiSMXfMlH7Yil0OoZ2QTtRLTip2O0cLZ4SstqWHZ6H+8A2kZXhpm0kPbL9dUanTOvziqIUh6Ambwa3WrCb2eWbuCN3L1hgWUmjRC3JoL3dBhR3imSQI8xuCMfsszlji7cSShNSYdqCXPxEVwbqO9i5B6hf93YI7aeyI8jxgcVXK0I/klbvhSXjkjOIwZgPdVwmsFW7HGPLUAvDRuKm+itybRg7c8+Yqqjg824Qf+/NxsBSUNAK9KCoJpauFqK0XQULrWYj4FnxeKDuvr54iokpi+D57e6Y1zxRJJdsHnDR3JyraCUufHBRTKODWBVzthjm4k3/Hv+Q990XDVR+KW+TcJX045LW86EKhz/97aqj89A8ZvTk1//tczosU90loIPVaHuWegJU3wP//7XHcO7c0yQM2jM/IhQKrf8hiObHWiWDZManF8Uf/HzbmDfC2wT//aiZ4hGTv/xzgKwdb1sD6cGEkceow0s3b89/zg+3plyRm0HlZi886j5wUwFhdHiDTaBidZRo5cx/tMeLyguOATbzq17ydhzbrpxunuHx6lbFGiO97gsd4dk//7iCIo+Ew+hG2so5kvv+ITG4c1fzHPtu1Xn5QfUnqY3/uByVmB7gmnE/E+5zdm+6nDmoews5fr+NzThdSHzK4bBQOL9c4O8OI0xLSqjJ4lbniLJg1aFpQRLwaSMZmpkC9e/j6FOVrTQ6a/a4alGgfrl2ZL1sbHUQ3DOI7ntq9diHFfm3t1mul3rdJEJCHnlW/hlQntipMrpeMs7fUr6wK370D7VbXH0DUHzdYfRg/6Z11Ult1sffJS+heHbco15Sxy3+rDnPesqH1lajk0yu02hPUvEUqvcUXWXL7Ad0wNGMx5gOle4XJxq/r/YY0xdco2wRSEGwcT7YADlBrHc9ZbvzOL0QwyWCWWChB9Obg800v7tyBWaNvdwz+fL7Ph9i2irEeJkRgOzeEDw+JiD/V93vH9FgMEoFIJMoIuogmicZohf94SBuPn6hXaV9jP4VVVA/bu+Wg8S88GLtmEPSNRLdtlXx2XL/nuM8nKkhnlnjaropiKKLIH94pLIASci0pDBfj9Hi5BfaTSXQg5+PMjQX91Ktk4MOqK1K99l4BRPv5+vNovGZ3IxQv8ICvjV4/diThpoaM8uvd3D9d/DE477w3yAbW3IDm2i73pZ9aEj38JqS6h/s8/xgmUIVcuq2JTgefAyuoafzQxAuRASeg3NtG3ach/JEkyuX+JDt2PnDZTShUhyHHG3ttBg/6lhAchGjLJBtopj4e01MlCp2yqQRTr4sBBXru+lKaoanwYX8y2aWCJiR3KnhCOkYVFSvsO0oDRujUFOEptiNDTYrJoUbvOyvl4AhC9h3wORiTXK1MrpMfnvdnndnR/HRVSusMBgIxwrLdn3vq1VcncPiD0SquTx/kNmxeFyCT4uXVUd9AL+rSGmuq7OOCzDKeVPjiNWVaoP5KOFqYq5Xcuf/xW9S+u9eIq9GAtZWtQlgkRecjRtvG1NR4WXXpn+pwsTBTIy079Ikg8rSef1aVapIFcXCd6C2wHVjLXR+N0tw4Taw6x6H90BFRgNrtlq2up6hHKuV3inM5RJaQWZHd84e6RsKkk9po3dk9by54tpPw7cBkFas/G+GbHwuG+AwP55BZyXILTHCIVrPpXHEaUPYfL6nphJP1Rc10xG4UaCeY4IHCwuur8xmSQDgY4aVwhzWhjbtSHG8JO6P2i2nC9/0Bfx0zk6dYQq3aw7k5vIObD7SEKrxhz0fQ0+YTOfHW23CBNeZci1qNsUDhoeqmfyP6PvjoEjHk8QbrFyQVZPHVWijnb8YCM65iYNoEbvnchStZ/9cKg5Vd45j8KnB6UjzXl/bkyZx7VoD47ocUUi117WwgySSb4rXgLJ52Mv5XJbp3I+uBP81BUvOjy4Cacgi+GWWlC/8dwgqwiojjUBDnEOxyRyowwLQfytFra1OZS4XvRYr4uoamAfG3I/p2bA7G90yqKThH8Ke00Tqd+3l3dmJpaCZelBMYjGqNLVa3SM4+LQeL56gY6Bymy2LQPVOxjWfj5tq4o74swcxhyGJPynkS5xAjOXZP1/FAYcBT3u6qLoIkEfErwo4gozmyI1YCvM0oyI3ghjGPQSsof2sKUhq91WsKy9cYWN+4A2v4pG/Mxpdc6w6kI/HX7Xb0TuihmsiOy2wQIsrZbUmr3OBSUo6oDJNgQp+YqYkgTgYcWZDgawJw3DFfdzT//PhVUidgB2qa8uw/j9ToHBAS33iT8YLhhAfyXG0bQUFp7QmH7oQ3i6Flf4OTZLvJdh8pfuflmWu2ohm5pTiSg1pl3vq9uluTJwqXfh1hqy8e2iHoD+Y35gCIViTo6VOtK5dD8HYClucJucXASzwe2kPj4S4eYQtmkYHagXhAzp/F541xE8YFYqSPszDuz3soWzHy0p3E2jwZNQaIcGU9FNQwQxeDw0ZlK9dxXrj9IUHGUPTOyib8CqXmbZ7Ex54bn1rLx3qqAavu/gh6XjV0GmN1p+yyMK9HN5uYEvxgbAk43tsheREhyI+Q5WLIneKTGPmYiM/lxOp8fvqHy8YgXK0TlMiX0tliLI2JtfmWZP8eVV732sdYm+pcWzDzEmKLJZyeelyaZKkjPnnUO9keDwtgiLnmd5+t+Sr5y8brRnlvxcWEWfCqIALQYHvaXx6jTg4dAlye469uGwwOZVZCILLfGjaMg4LUCNMTtMSp1aC2y/3wR2t1v3w/iNBRQ+bNbtDqL2NAr7K4rUcyqbSpNrXZgAWXvjxBBtfYLK1uRYt3q2pfXJOAL0HtWcEwJLddOSJKV1SwvcvEuzg/4MPnA8MIUJOLqm3qI6wFyN99Ck6zYaV/zGSAzF/PGsaNa4vPLe5QnyuqVUnVQ6xELA6gbe53aGgeke+R/ycb2LJVyc7BhuzI90zA+c6wUDTb7NH//gdDSl2u/aW7lRJm8m1fLtPxcNuEM5JbkOCZKPM88HUsLRoC1pmKKlvWyeAXuxILbu0snpSxf8N+RgtLUSe5n2gdjOjoSTaN7mMZ7bF+cWk/MS8mFD4pcyl5UN7CbpFZH2a+Pm1VAnUTVfbw8qrmz1G9m5aKmRzY1SMhhPrlCn2t4uNUXNA3IFe6NOjSC1DEaAFZAfDlEkQCsbNhsZPj6NQPDSB3tLiTo0ZYoEbIeEIaKtU3Wk60rEszawTFuyHVd365LA/c/uarABN5M5rGq/dqTG3Ilye/5EKiYisisuzqNaZjmWv0z9TORc0CKbaTea214oNM9u2sXUZub/eqM3Pi/PjRSyQiOSwPWif2asTgu6hS6fb5UGosCWxdedMqdViIUUSSdIJx+qQ4KShfTT39VAWZbi+mB+iKICNwpt6cflY57Rcbs6d1kA26Iru73cuxYVlSvuJdcR5VfDYZRk8X0AXePROyw3Le6LaUdmTLzYsoNhhgQpd67xVNiHgk3pakmndeIAtTC4DCXy9oS6eU4CWxDdVmY53pKNbdAKmQsP37lrJZC6iDXMELGKcHjNuuZgcDyY8W/yv6ha3DX7OWm/35fpvhw55oitf4V+GULlcPWYyGGuVBdro19c8u0RDddDun40W7G5cSIzHLh/qZxb59R+EPY+wZ2XerkUim92hhXpKyW6WtAh6zQS97DrPyjCvKi3pCw96LeKynOpyjtsMQc2RmI/20zFOZcSa2AK++PoRcT6zeJyxlBZ7kk5mhqXGkLlM2hFKc+/T544xXP0Ua38Q6xdPTLTeG1PHnLMaOvksUQMrEFTB/lizCirmFQL8zYVU+OTeYQEFaITsBSMMYexS9HkajO2gGIf2micvntCZJsZQEwIH3/4JGJQGflBuH5rNXmnRRYXDQs3ZoEQoMtYDr1kFKUS/siiQSUxcTH9XYeBZiKDDFQoExREO9dddKQLO3BwMHvymCSTFyY+vxn3D27NDx6OlU092D5EDUwilttqVHpjJQDUceJYCLsK2swfXeNUVrBJT/w/sk+7si8rPtiMFis+oxvGdGQxirMBID700T39mULuNHzOyN+xBfcFACZcyngF1aSpv0JPkNUrAZTqfplv509cGXFUiEEm5dZb+OsP/blizqdK45/dSsIrufYTrCPY2lgJD6k6QljTfXVlHfYKSq+MsagyUcaMintyr95bD8kdTAeYNLNsMmo/Wdd8a2nStBP49ARIjqqpUHWY4q4mvO5Cq/CgCP+4/B+5zutGwX5pssgVLr1+fIM7WWLfiUQDk4c6ZdHZOWv5hG3g2dgQ5NXnpIY+BWwJpaouf25bXnjDzbHnQNofH/c6m+dEAS9Gs2h7pFRPKOBDnqswZ8KZjhId1ytHUTs533KwBoSiImoxKQUgZ7z6pA9QB3sZ8Cq0vwutJTTkfbX8AzCpm2cFXx/P22niUMHauU8IGc+78R6TsutoonoqFuoNA3l80t387YHMoL5KGAT1JO4zmx+vJ0LbLHlicHraSVYvJjnO9p++qnWgKw9OwFVVUagvZuf9qfiuum+hIicxP1q4zDnzkHsCNriLxBpxY9N+UOmqzdY1MunLMDgkMyi3uvnN3UBXJeZ8YLs5xr8QrOhimYoKuGBebZHAiBIkViv3DG8k2oNpp5OIgX6ulqaRN8V62QUPjn5tl1kPXhT9bcd8qIm8gi4or/FGbvQ6pgGSHmnayrugmf5E0upGxPRf/3xOtitGMaHLKJVm5zhglmVfI91o0yxhJZVS/5wQ8zfxK8Ylw0WmHXoGfRkoBRx9Hsnl/6sgTjAVwpmNuSeZtBwlX4qB8Bh8lxjqBDIuFGJ4I1wxN0XRlAAslzqMKwQfyA7OkuivCXfv+i+3XmhcBFM2n4jdT+NyUmBnQJPV3F2sZfKvJhUlXzSosFR4VevVVcOkFnnjdiRWc0TeSYxj41sJGYMbZTeLI3GvyZ8/gAAudQ1+4oFX+enX5V49MczGCYVBuoC4kHjp7ZVxj+clBwPr9k+v05SsezQK3enxLs1Nt/N7c7AImVUysjGou4iOohHo83Zs9/MI/OWB+OyXzOBD93NbApGHXrv8CVRHp2bwH+xB55cfNrdqFD35HSMx4iVmtzYAmSCIV8kXsHoq3DIb93riTWbubnjxbBW5zConVtbxLRStXHkIyAByaozME952Gc9aAdAbBpZSVCH88Uwb/4bPTVOVl+WoMYD7JIvK8VcMrJ8zHV4bbG0Dg7Kx17A4ej/ZcZ2Z5pVuVLUH1E/AccUTKm81SE+LQ6STTUDscUk0x2OWIbEORhg69tdoTGNkA1RfkGIRZHr5mCXOpLC55WWzCZoGPFUVtZRHwh0nq039CDdjEPo+JyaxSQAvDgR6Iqvxy0frrtEG1A385N81l05SSzN+IDm9bypF9m92EUqblnauZ5sjc37wRykOdl7w4o8WMgQsjii3EE/aJYDfHs1cH6DNBEujjcCc8qAefYFyIAURDcDnzun5UmkbBQsU4eu/W8I9nBE0qJKTdg2hwjq0+XV7a3TJ7R+alvJZCRia9lJ+grNB9dbrOmWEvUotMjvDhq4wV/kq4fvIBkzUGpDeYH74rne8uU3dgoNZdR9pUL6q9YDNRfOiF6Dyk+SYXQIghTjm9qR4tBHh0gnmF/9q3Qv22EzaLhSvDlDOxMrrCNRmLCl1jApzLrBCPn2mjn5zqK7OYK7VxOfQ5GfBfoPdyQwqFEgCVHkJ9oTnagRM3R0+rsuN5jQv9icCav/p1WqiEXSzCdLd/WEA6z6dDP7tPqPbeDYKAkVcz1lLGbFOC9b7cBd3MV0Ve8dZ89oR7OnxGS7uVpSry8banVZwpJg+nkH1jRBYa2BvBMY2xITH9ERXCjHzdZxs+ipdXP2DY7X+eWiBhtT2L0RRGTLPeazn5tpl4tu8iE2rWig731iuJDRbCHHy+g/Mb9+miAyVqfIpXT/iZeOxOxODO0hEpLM78I1+G2Z45yi3lS1K3m4WMQ559Lp4UML5vZUjYGJuxl+OPpUH5klpyBujkjprhei0TmUik10gjvNUp8mDkWlNKikmYspaVTqewbnOzJrmz8FLIpsT67EJLHIIfeDcWEfiP+DJrZ1jfxpoAb2abeMqLx+9RuZGzQoYtYVGgAWwEM9Kek2vPIeBNAKD6ao7nw6sgvfeLZPoXkbYO/tStHJdKzk+WFSFEU2NcALJAEP6S8pcnqqBBt57dwTrzQNCIdk2SocK4dLRbD/pu/VryKnm65ZYXiJCfHJk3mx9MRSl+nSK6OqEBSoGjz0/LADddwF/HqcfK3K3O+6YUGQcmj8pZL4PhZ6KrGkb8B38FmDvvLd3XQXbvS/FQmrXFTvJNkaN/FGo83KuS43BK1UfVnIqigGkCoP5fBda2MwAGTGNKX9K9t4Bx83pMFc5KSORmWKv+8VoVggWxoaBz3/9IBh6RwLd1tebwy89xvE5z6EEpXpDfrXWfRsMs6+ekUHH6idVosno55+xQ8Zqzelh0bxtJTgCcH3Z3/Cxlx9eNIS4JIFKOAVrDqbrXRszmY55a5+niJGHtkO3b6mnIDxLa1WXc7BAe33mt2KyM4Fbc3R6/WVTQN8QhlqAtave2WsQTqzWeSlKuGUVIJRqtObpv294rS0kDN1RKzdstZTXJebR2HlzsQ4P3NbMHUqFZMZw+/IKXnh4t+lY8qocp/B1oMszR03EFs3bPeND8QkItMvllObeCz3SZAjqZrobmLcrpFyQV7mwBjg3C3C8/bc5goQhv8j/IXMLGnt4mF7tybRDG5G0polxoUScQkPvmnga2/K+aapKeqSL0BTmo1Cm5g+booNOtdyKva2KoefRURaBk7113QKo3y+WTuFKtgETIK8HRluYS9DvlcciCDvnG8UaJRfZE2siZsiTHvRmN80xkUIInHeRZl5Re/+ATL6VhKFi8CZ/n/jbFV6T5pZ+Uoppvsi3qjacVFOJgWWfdlwVHKPW/TJO3na9hRM9bS2yo2rEsC6IBzRReVO6IesJU7PItzOamr+ROFfwGZmZ7ue8HNxAgLJKb7P3p8dMqk6Be5PJaT/5Rdc1deYVihWH9cjVKc9uz5EnfHqxLUkOO8iJUENBNVf5LyNy8zjLu/78k5WNTywiPfYeX3CPk7yc6CI3lum/CEZwfUaNpcI3KsPqfn2lmz3kd/acQjKA1ebkJaiuLD+epQ/Fc1llHXXMzofWzz/Kd29SNmOhcjMWw1jq1g3YfrXZ9rzXDYW4ZttfgfMi6oCUtBs0PkMVuxmq5lxEoCaSXPSqCJJ7MlKdRDidVt0AFlxk5cTdX++sBF2+E35mjwfm8ERVxH0FvuAQtsfA4V2G0TKTUxeyRGVjd/u6F1SvuAiU2/WaQjcNCU4Ep7VunXCYSbZj3U3wzu/LWM5MPlYuyQ3FOOCD/zt7K295hY2JhwF+ODDIZ676vGQFKveEQYkWj7lkK7rVmD7MhU0Y/tF8EcTTpo4/yqOufbd/zWIpMajnbDuWK2vn6OPPtz2rc9MIBNlPd8tt+yf+7SC4wqEPbozKMCwY5Bygx4JmoIEDsixWRDcdHd6S3/dZMHXOJAAv7+NIstl00crgSqHZKAEe4g3G4dzIV51EeZB01r7p8GNlfUnG/GjZgNGsqXZdYMBVtAtFNv3hJWPve4GvqZ2XxuiNkHTz5kxWgr0PjQdJlVywJ9Zf2ZvqeeTbolKtvK54re2Lq5BoyzfsRtvDfyao3kmyFzDQ88nM+qx83w74RDlkngtYiArI05Epre3GgBeSlMig0pE6RGQaFznKkGeb0SozLCyiOtxh7hgwZlbKbClzUUfC8ntMiHUOZE375RhTy9c4DA+oMLkUDkztSybZbdmP1xpaIbjUpPAHBq3cIq+CBFzbMlMMCCkUQ6d9LGV6GYCsYiEWZIy3nBnuxOYXeU4YTGDSin9e4/pCjPtQSHlg5LMEvIlF0ElthqrF129iK2RPBEWd3XWOl3SWV5uz5VUyZYp5kEFmz7QfP/B1W1BBzQ2iTGbSVT79lUHzcGXz3PJceSgz4uknETUwo0xffpr2KUvZF0i/r2sL3IFIClYx8CbIZE6Qt7MDJbOPB3xMScwaOcWG66IJfCnDkb0D2Mb+PHzX+oiCbxeTIogtyN+s2NJirNACk/OACSOTtV6vscwbzW4M168xqaI+RzR47S1nlV/rOoZnid87n/Ima2XYa3un3BuGAisNjb8eLMT9OnMtazQROFCuO1HiZXaOc0oUDbNC4eKLToOx8DzVhMgGA8XIAQ2x3b6I0uEyLssQjJX3QphcUMx4KsMgJ+72km4N2aqkBF2coKmUEt1eqIMGn+5txMT4kYVGd3ALO+y9Z4PP3d3l48JQK8s9ZZ/Qx/+NBKgBEJFlQ32psoJiihGO7FSYM5L81q72kaAYcilEFMG+ZK1BcMqELkflyCV7v8JEXLO4Rf/oZYNZHZVjJhfL6fnpP9Tio3Euue5uS7FMkfGOeRCTrBZ06Caev7tgufeTrX34Ur/Vvc+b8ksiIShNJtuF9WmYxOZ4xg8y6zTdy3KAB2y5kYkcRnXsptWwAFyKZ2I/QGySNeoQLkINUMloC+5L3WuMMx297Q1xUYLKqZ9XHavaobo6QQv4auMm+i84IhxRpPt9nUmcav9NcjCcP+TcMmxsQZ/F3mgeoA0fQgwvTsyXuuTaM3Sqtv2jaaajmaFQpK9W6uIbeqwvSDo34ZrY6elDUHwSCjHRRmlwmyy+eOra64Ssq0XSXYljMHtKY+FShcMkHsEUY/4Bw63dJ6KpwDaxmthlDdbdE+TvYF3v33cGSKqO+1H1pKYhJMvZD5ckQcHyNF8zrtiR5b0ko6NPGoRexUZTYP6VbUdn3zzxGBOi8Z0OqHjGqYxRXwN3mYi0GYEEZYq+Q3QvdKcEHILLLj8S+VFepSfErtmfZCdvxbfIifFSpEzKi+7VJsLMT+zEFeyp1OdwRC1VZrfTLIyR7xTPUcZFYPD9qI7D70uTb4hdpqPXsJIRNYbZtNwch1OI3trh3u2ScoQyM9POnInsUa+OovcwkUP1UfIzPb95n4BaF2ev57NHAej0+BVMF9/Cj9663HN2/JN3SQgslL914bKfiTTDFAz9PlQEL/dSv1H8xl3mtWxh1McFO9EJXlRDaKQDsyKO4vOJW90NFE6yw2tjbc2GeF95sbs0I9enAa6QwQVf/kJQhAD2BzUDKggOyjy1TEhED6sfk+418lQy3c/uj8aw8UEzZ6hIMCd8RohAkumMtIj9m73l2yPWoGHVTPaywkC7Yj9tBM1NxMgcrDwRtk4RO2WHT7Ql5kQCKdJj6kNuOTeyEBYBjLMhGz+O5/YGa84HEiTYEpZ6fFzy26GG2hWtTyteuYrhSyG56BjsT/wQeLRytpTY3D7sIMqZnJ9z1FDrfyjFlGl2TNw9BQysbaxOuwYYZs/7I6BANgkqCknWZC7/BBXvaeKwAmC959I+G39BUE9bExkNlbRoFRyEtNzv+NJ91FuisG3JCS6uYBeRnfv8AkAfKTeg9EYamqnsGfAV7d0f9DghHEQ5IsPGDIUhgoSj7obM4Bu5uhQ3/CYEDTHc92AsFvDK4XGrwUeGBWBHPlS+f4x+CxmmHz2sAGmSFNt65kwZC64mnaoWlu2310laYn8r62AqsR5dfjyK18MEdurdagldzfJtjFXlZs7St4QhdPiye6TPh2/ZAQLU/Fip5s7TDEM16KtRWrK9hmxnQ7bmfa/+7pa10Z8WDPK3NuJ+NN/RAbQ5vHx2uX0Lm7/w7cAEH/hvZA+mt7J7zGw7YtQYwnNN6dpgwkGjjrS3yQoeoYt1EnczmtmJfQZWzUlP3Hlg9Wzlr9IH23q3thGth+QNEANFettxKfskkGOlLk8AqoKJwDqOxAa6UzAx07plSSyNBJSGco9zjnC5gGbDoKvsMDuBR6bGRlGzJ+hFsGa/Izt78aI+WZ6dJlZKp4pGISuv9rV0sAS0MWEwCmfauO7oQZMiakHU35LBxiyJoOMddhUWgcZuC8r4Ksvn75TTcQXLJ7kWtYhGuGqPd9dZuFjBWQHNwosXY5snbHFQq72CvHXhIg+shQxycuLOuWYErwCLZeF24b7F78pO7xw4X6lIAR02hUOf5087Rl0nOaeb6CK4i/KA/EZv76ftOWZtjwxslNr0E/u8rWUmnf3amfg6UZmBAluuoj3Dd7UV+9IAJ6iYcDfSJlgmIImohjfIUMJ27z+opj50Ak9af2LCNrWrBJvMovA1OeNO+MF/MwZvnaCxTgG7Cw4QfSPF6AYCGFt21M8PySZFeV3t2Rqqs5JMzMYzGRgq4o+UaKRgBf9GHi/9X9HXA3wxkCsd/UhnHSh2zUVDiraio/6nP4y3XJqs8ABfALAtCYU7DHPMPRjgcM6Ad/HiSXDAbOdSMkvGZPAkHs8wuQTy6X2Ov/JFvcPuKfV3/r9Q28";let yG=new Map([[8217,"apostrophe"],[8260,"fraction slash"],[12539,"middle dot"]]),yK=4;function yW(e){let t=0;function r(){return e[t++]<<8|e[t++]}let n=r(),i=1,s=[0,1];for(let e=1;e<n;e++)s.push(i+=r());let o=r(),a=t;t+=o;let l=0,c=0;function u(){return 0==l&&(c=c<<8|e[t++],l=8),c>>--l&1}let d=31,h=2**d,f=h>>>1,p=f>>1,g=h-1,m=0;for(let e=0;e<d;e++)m=m<<1|u();let y=[],b=0,w=h;for(;;){let e=Math.floor(((m-b+1)*i-1)/w),t=0,r=n;for(;r-t>1;){let n=t+r>>>1;e<s[n]?r=n:t=n}if(0==t)break;y.push(t);let o=b+Math.floor(w*s[t]/i),a=b+Math.floor(w*s[t+1]/i)-1;for(;((o^a)&f)==0;)m=m<<1&g|u(),o=o<<1&g,a=a<<1&g|1;for(;o&~a&p;)m=m&f|m<<1&g>>>1|u(),o=o<<1^f,a=(a^f)<<1|f|1;b=o,w=1+a-o}let v=n-4;return y.map(t=>{switch(t-v){case 3:return v+65792+(e[a++]<<16|e[a++]<<8|e[a++]);case 2:return v+256+(e[a++]<<8|e[a++]);case 1:return v+e[a++];default:return t-1}})}function yQ(e){let t=0;return()=>e[t++]}function yJ(e){return yQ(yW(yZ(e)))}function yZ(e){let t=[];[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"].forEach((e,r)=>t[e.charCodeAt(0)]=r);let r=e.length,n=new Uint8Array(6*r>>3);for(let i=0,s=0,o=0,a=0;i<r;i++)a=a<<6|t[e.charCodeAt(i)],(o+=6)>=8&&(n[s++]=a>>(o-=8));return n}function yY(e){return 1&e?~e>>1:e>>1}function yX(e,t){let r=Array(e);for(let n=0,i=0;n<e;n++)r[n]=i+=yY(t());return r}function y0(e,t=0){let r=[];for(;;){let n=e(),i=e();if(!i)break;t+=n;for(let e=0;e<i;e++)r.push(t+e);t+=i+1}return r}function y1(e){return y3(()=>{let t=y0(e);if(t.length)return t})}function y2(e){let t=[];for(;;){let r=e();if(0==r)break;t.push(y5(r,e))}for(;;){let r=e()-1;if(r<0)break;t.push(y6(r,e))}return t.flat()}function y3(e){let t=[];for(;;){let r=e(t.length);if(!r)break;t.push(r)}return t}function y4(e,t,r){let n=Array(e).fill().map(()=>[]);for(let i=0;i<t;i++)yX(e,r).forEach((e,t)=>n[t].push(e));return n}function y5(e,t){let r=1+t(),n=t(),i=y3(t);return y4(i.length,1+e,t).flatMap((e,t)=>{let[s,...o]=e;return Array(i[t]).fill().map((e,t)=>{let i=t*n;return[s+t*r,o.map(e=>e+i)]})})}function y6(e,t){return y4(1+t(),1+e,t).map(e=>[e[0],e.slice(1)])}function y8(e){let t=[],r=y0(e);return i(n([]),[]),t;function n(t){return{S:e(),B:y3(()=>{let t=y0(e).map(e=>r[e]);if(t.length)return n(t)}),Q:t}}function i({S:e,B:r},n,s){if(!(4&e)||s!==n[n.length-1])for(let o of(2&e&&(s=n[n.length-1]),1&e&&t.push(n),r))for(let e of o.Q)i(o,[...n,e],s)}}function y7(e){return e.toString(16).toUpperCase().padStart(2,"0")}function y9(e){return`{${y7(e)}}`}function be(e){let t=[];for(let r=0,n=e.length;r<n;){let n=e.codePointAt(r);r+=n<65536?1:2,t.push(n)}return t}function bt(e){let t=4096,r=e.length;if(r<t)return String.fromCodePoint(...e);let n=[];for(let i=0;i<r;)n.push(String.fromCodePoint(...e.slice(i,i+=t)));return n.join("")}function br(e,t){let r=e.length,n=r-t.length;for(let i=0;0==n&&i<r;i++)n=e[i]-t[i];return n}var bn="AEUDVgHLCGMATwDUADIAdAAhADQAFAAtABQAIQAPACcADQASAAoAGAAJABIACQARAAUACwAFAAwABQAQAAMABwAEAAoABQAJAAIACgABAAQAFAALAAIACwABAAIAAQAHAAMAAwAEAAsADAAMAAwACwANAA0AAwAKAAkABAAdAAYAZwDTAeYDMwCxCl8B8xhZAqfoC190UGcThgBurwf7PT09Pb09AjgJum8OjDllxHYUKXAPxzq6tABAxgK8ysUvWAgMPT09PT09PSs6LT2HcgWXWwFLoSMEEEl5RFVMKvO0XQ8ExDdJMnIgPi89uj00MsvBXxEPAGPCDwBnQKoEbwRwBHEEcgRzBHQEdQR2BHcEeAR6BHsEfAR+BIAEgfndBQoBYgULAWIFDAFiBNcE2ATZBRAFEQUvBdALFAsVDPcNBw13DYcOMA4xDjMB4BllHI0B2grbAMDpHLkQ7QHVAPRNQQFnGRUEg0yEB2uaJF8AJpIBpob5AERSMAKNoAXqaQLUBMCzEiC+AZ4EWRJJFbEu7QDQLARtEbgECxDwAb/RyAk1AV4nD2cEQQKTAzsAGpobWgAahAGPCrysdy0OAKwAfFIcBAQFUmoA/PtZADkBIadVj2UMUgx5Il4ANQC9vAITAdQZWxDzALN9AhsZVwIcGSkCBAgXOhG7AqMZ4M7+1M0UAPDNAWsC+mcJDe8AAQA99zkEXLICyQozAo6lAobcP5JvjQLFzwKD9gU/OD8FEQCtEQL6bW+nAKUEvzjDHsuRyUvOFHcacUz5AqIFRSE2kzsBEQCuaQL5DQTlcgO6twSpTiUgCwIFCAUXBHQEqQV6swAVxUlmTmsCwjqsP/wKJQmXb793UgZBEBsnpRD3DDMBtQE7De1L2ATxBjsEyR99GRkPzZWcCKUt3QztJuMuoYBaI/UqgwXtS/Q83QtNUWgPWQtlCeM6Y4FOAyEBDSKLCt0NOQhtEPMKyWsN5RFFBzkD1UmaAKUHAQsRHTUVtSYQYqwLCTl3Bvsa9guPJq8TKXr8BdMaIQZNASka/wDPLueFsFoxXBxPXwYDCyUjxxSoUCANJUC3eEgaGwcVJakCkUNwSodRNh6TIfY8PQ1mLhNRfAf1PAUZTwuBPJ5Gq0UOEdI+jT1IIklMLAQ1fywvJ4sJzw+FDLl8cgFZCSEJsQxxEzERFzfFCDkHGS2XJCcVCCFGlWCaBPefA/MT0QMLBT8JQQcTA7UcLRMuFSkFDYEk1wLzNtUuswKPVoABFwXLDyUf3xBQR+AO6QibAmUDgyXrAC0VIQAXIpsIQ2MAX4/YUwUuywjHamwjdANnFOdhEXMHkQ5XB6ccMxW/HOFwyF4Lhggoo68JWwF1CZkBXwTjCAk1W4ygIEFnU4tYGJsgYUE/XfwCMQxlFZ9EvYd4AosPaxIbATUBcwc5DQECdxHtEWsQlQjrhgQ1tTP4OiUETyGDIBEKJwNPbM4LJyb5DPhpAaMSYgMMND137merYLYkF/0HGTLFQWAh8QuST80MnBrBGEJULhnkB78D8xrzJ+pBVwX/A6MDEzpNM+4EvQtpCIsJPwBJDqMXB9cYagpxjNABMYsBt5kDV5GDAm+PBjcHCwBnC4cFeeUAHQKnCKMABQDPA1cAOQKtB50AGQCFQQE9AycvASHlAo8DkwgxywGVLwHzKQQbwwwVAPc3bkoCw7ECgGpmogXdWAKOAkk1AU0lBAVOR1EDr3HhANsASwYT30cBFatKyxrjQwHfbysAxwD7AAU1BwVBAc0B820AtwFfCzEJorO1AU3pKQCDABVrAdcCiQDdADUAf/EBUwBNBVn5BdMCT0kBETEYK1dhAbsDHwEzAQ0AeQbLjaXJBx8EbQfTAhAbFeEC7y4HtQEDIt8TzULFAr3eVaFgAmSBAmJCW02vWzcgAqH3AmiYAmYJAp+EOBsLAmY7AmYmBG4EfwN/EwN+kjkGOXcXOYI6IyMCbB0CMjY4CgJtxwJtru+KM2dFKwFnAN4A4QBKBQeYDI0A/gvCAA21AncvAnaiPwJ5S0MCeLodXNtFrkbXAnw/AnrIAn0JAnzwBVkFIEgASH1jJAKBbQKAAAKABQJ/rklYSlsVF0rMAtEBAtDMSycDiE8Dh+ZExZEyAvKhXQMDA65LzkwtJQPPTUxNrwKLPwKK2MEbBx1DZwW3Ao43Ao5cQJeBAo7ZAo5ceFG0UzUKUtRUhQKT+wKTDADpABxVHlWvVdAGLBsplYYy4XhmRTs5ApefAu+yWCGoAFklApaPApZ8nACpWaxaCYFNADsClrUClk5cRFzRApnLAplkXMpdBxkCnJs5wjqdApwWAp+bAp64igAdDzEqDwKd8QKekgC1PWE0Ye8CntMCoG4BqQKenx8Cnk6lY8hkJyUrAievAiZ+AqD7AqBMAqLdAqHEAqYvAqXOAqf/AH0Cp/JofGixAANJahxq0QKs4wKsrgKtZwKtAgJXHQJV3AKx4dcDH05slwKyvQ0CsugXbOBtY21IXwMlzQK2XDs/bpADKUUCuF4CuUcVArkqd3A2cOECvRkCu9pwlgMyEQK+iHICAzNxAr4acyJzTwLDywLDBHOCdEs1RXTgAzynAzyaAz2/AsV8AsZHAsYQiQLIaVECyEQCyU8CyS4CZJ0C3dJ4eWF4rnklS9ADGKNnAgJh9BnzlSR7C16SXrsRAs9rAs9sL0tT0vMTnwDGrQLPcwEp6gNOEn5LBQLcJwLbigLSTwNSXANTXwEBA1WMgIk/AMsW7WBFghyC04LOg40C2scC2d6EEIRJpzwDhqUALwNkDoZxWfkAVQLfZQLeuHN3AuIv7RQB8zAnAfSbAfLShwLr8wLpcHkC6vkC6uQA+UcBuQLuiQLrnJaqlwMC7j8DheCYeXDgcaEC8wMAaQOOFpmTAvcTA5FuA5KHAveYAvnZAvhmmhyaq7s3mx4DnYMC/voBGwA5nxyfswMFjQOmagOm2QDRxQMGaqGIogUJAwxJAtQAPwMA4UEXUwER8wNrB5dnBQCTLSu3r73bAYmZFH8RBDkB+ykFIQ6dCZ8Akv0TtRQrxQL3LScApQC3BbmOkRc/xqdtQS4UJo0uAUMBgPwBtSYAdQMOBG0ALAIWDKEAAAoCPQJqA90DfgSRASBFBSF8CgAFAEQAEwA2EgJ3AQAF1QNr7wrFAgD3Cp8nv7G35QGRIUFCAekUfxE0wIkABAAbAFoCRQKEiwAGOlM6lI1tALg6jzrQAI04wTrcAKUA6ADLATqBOjs5/Dn5O3aJOls7nok6bzkYAVYBMwFsBS81XTWeNa01ZjV1NbY1xTWCNZE10jXhNZ41rTXuNf01sjXBNgI2ETXGNdU2FjYnNd417TYuNj02LjUtITY6Nj02PDbJNwgEkDxXNjg23TcgNw82yiA3iTcwCgSwPGc2JDcZN2w6jTchQtRDB0LgQwscDw8JmyhtKFFVBgDpfwDpsAD+mxQ91wLpNSMArQC9BbeOkRdLxptzBL8MDAMMAQgDAAkKCwsLCQoGBAVVBI/DvwDz9b29kaUCb0QtsRTNLt4eGBcSHAMZFhYZEhYEARAEBUEcQRxBHEEcQRxBHEEaQRxBHEFCSTxBPElISUhBNkM2QTYbNklISVmBVIgELgEaJZkC7aMAoQCjBcGOmxdNxrsBvwGJAaQcEZ0ePCklMAAhMvAIMAL54gC7Bm8EescjzQMpARQpKgDUHqSvAj5Gqwr7YrMUACT9AN3rlr3JG9m8w9lIAXltp/v8kfWaIaaR9OwpAES/I3ZVamDXSgB/UsOgAG6D0tq+5CIqE15FiAhV3yA2VhCQ7tj+m6xXaF53FIfGi/IAZIskMGAi2MU7MDVJNCbMzERyHZi+osdPtnFVbvq653O8rwaCy4IAf9OOok65AqJUtUriUfYsGPPVbe6jm0s9lbKlPCUKjdkHsFsEhvX4kT39ZCtAAbwQdn/h4TpO5hTByWAmr5n+Wuwhdegv6bmvX4LyOes3z2+cuHv2JFYwVMNuq2gzn8YHTjlUQd39osyWei4NKl3LAdfxlO876hh5ENp/cOvpuI9bF55guEthLLPOXjD4dktTH04P5TvZrWTM0e4+BHJxj7MLApXIFOs0sWKhNkG8iwuM5wR83my6V3wW06abhDzTXYfOr/ZpFXgXzmv4d12FFyP00/dPGbIVGV5ao8UufGzUwp/IHx6v/wDWJr9iaoCulhWwlZ7A8q/NMoD12+mBdNRgJYnThRLtMx1Bgwttn8/4Qn2CDfOSup9GVXEvA21ILgp0owHYxNOkpwLWz0G7K+WREIDjIzUzSn8I99CuJSmSpPyH0Ke6/NERYiNx+3dncSebPnOUnnWD61AhJ1n/tSLZmU5wYO5GfgzyAYJm6VL91LxZ8hL1lfximQxIDMRhIecQZBmeE5R0XlrpvwplVrJwpa8BBCdp93GPP9lyBeZ2zkRr920CR3cYbKpKHfogvm0nV7XdDz6EbjzlxADCMjSLXuXpIpyuizy39yY+I+H9rmpoIF3YwEjlH9MgGgWcCNTjHEWMqAbprn2Ox7rOHupaVE3lNyg3nt5XaZID6Y+uml5Ja+aOPu+BI+DZbiJVfaspUadakWUX6TA4dETkIqdJJHYnU4Z4yKpt5y8rVIahoMUf8A8kWtAQNCTbjp71gx3/zVdqNz1Sutkw0gFIMVm2BF4Xdv/0olw+NaDIR9Bb3DPweZA2K/cw+/b+AwyWl9ZOP67A9nexmeTNjfdzPGf9J6E6BMPKa5lJh+qNsdUz3HBUevU71eQFCqOcxiIYhacAhh/8PX0J5DdSViZ6WazDDx7cukJNpMfEkYLJ5Ao4vLoVd3d25Pg4qaVa2p2D2L3WvYPJ5Yf/A/MSxptjlgXL/KJtP2U0cRv2I09ATAiWCJYuRwiapeKFsqmi18yMMulDp3HdcIldq+7jkwsJUOHLHCzzzBw5XFvL0CAmo1ub456z7zb7shk3KPGCLZzr47oT1k/j06XNnJvG3Udv6XrP+wsqTBlZ5MaNPt9FOs/4Bt/ja/vbVhTNpBFl9Gq7MqINvGlWKOAwQzwOZy+EzSdjAqKJVV2YcskTuM94aIK+kc/AZaXiZLPREUDpkXIV947IFfj+85TrqPqLfkGcxgboMQjosf+az+odLNXdyp1mDNGsqSdK/pJ2Ca04mt/4d6s1X+lncOEYaGBBeW4pApGcjf7/XJCFbj3N3mFb+BtlIcw8ZiDKoClFX9Rf0bxCqtLpicObKJzBVVHr/6u4siH2hK75RNv7w9GfTbhJOQBYiFUZAByY4rn37tZBHT//kqKsNi3ryL9AqXJRzqiMIJMhILjoi/i8LVEsbu+Ih9bsyW16sgQqjYLO0qda6KaCPKj3DQcu6CfV5lKtjS3ZCdqLAZkOey9MR+QutJBGiz/r15GVD6rCVwJR4UUKC4GNJkfDf00OMW8aQtLSAGLXV8MIi9mbbl/qQEpxCm2L5hutFX4ekeLH4QgBWUFKs/2VVMKy46WtFE6AbwgmYm/Z0yHk5veDIrcl2HpVqb/rSE0PC9EbDzJEWqeaPhh7vF369Umq2kSiB3s5rBI6c/7N9bkRu4h2n+/h5nSwy+7n+/I+6oXQVANo2Jb5zDwtiBPf1ySCzHdT6yJShMzqSRZfnykX49CaFaxhoVF4PBhEuECJ1PrFYSpmHuyYsl14DTAV9ZxRms1XiR/kBrjhZjidOt0UNe+GSml7XNgpVw8YsUTmZXLTK+6iYnyW/wYR1W4UXwOi14xpFROHb6HcZzksgF5DbL2AFXzKNwHU2adjdAY+KCyM/cwRTBkkq/a227NI0q6DR2MkMCRu620t79bGcYUmACtqN3mk/0uNwd3JSXHqE1kzf6Yyj0W2083JNDRnIXDlgBxJ6uf58NN1f6FQiRCWB4egF8QDx74AixV8oTyw7PluIjr3/rj/WzgwPSq4xPojaF7V0xqG2u5ti2L1h6yYHv73Isrukr0kURDIEjClBsBx7kdcXUxaYMS0syT3ymLzDzslNDWQOT1Tao1YNmJHARUenhCkmV9tqCPGI5GqZaRpkiPxyjoncWjyOHYGqvbvRX+Bn1pn7EhRNXa1lqJPmoeN5VqdqIDPhEVhFsyG0d4iQEIYX0wZUbY2XbZWYlpZ/l66IrDDY0q1C1YzBDpHC4h05YqHQLqS9anyl22JQ6lEvjvdBwMHfE7z0luCXD34/rFeDa2TmSeEAykSpYO5j1G/nsgpR3qn0qaQEmLjnnLfcz+veoYqPnRqmRGwCJ6FJ3Gm/Z1/aVX5PSb03MMnjAf41ww54sD5k8FrkfBP+K0b1MrYpapWjtpZfve2HVf4ickX3LKSOhu7qI1Vd4c1kNrn2ajy1t4y93JhV4fnWCKq7OmFpcr7FjdJCXPTql0Drr14Ho3Z87+GPQ4Z/DcTiGqtvZxlRYi8cNuhXABveZIwNl/BX1huhVLaFax5OqypUrQRyb9OE3SSkPlDdy5uo5XGg2EIGEjLY1MO5cr1ibfiFWV7zspcTgkBKkwo5jPyAin04LqizZXb2tDRgwKJjGx4cVk3ngAQixwcxjYAg2Q7vmUR/hpwInMdw7OhC2qyf41vTPkudQAORS0DdLtOGQxb4fH2VYGsvJCkeWPeUwtf1/tuIhzXEThoCZzzSJqqjUtbaPI3ntHm3T5uf849hGUA0zU8ni5W+EEn3/0Y6oUhQFw9z0aGjkljBbAlFXc0y82G2wkd7VdgWa5KTgJJNjNwZMfmdnUIUn1JU5LiWX5UZEZbVlKSN76mlmjUR2ku+fucTNlO4IAAahnLjBhlvQNR9pe9swGBgq0YR7P3VCyI/seYwQ4QBzy9X+HPePgoF8WfKaJ4MBOhLCGHae6Z8xkNXwni9QAKvTNtVA56x8YJflZ/VvONRSlsSLmiSyNMnTjTaE1ko81zkzGEnVwEhjCzlwIqpxmpDAqwsEmtpdr3xpc7i/ZX3f2TzT3M0FdxIEQvO1jgmmiN+D1YpMduAzEhBtj2OBkMN/rv6p7Th4pSH6f5aH3aTvwFTl7EOSgGASI7ttyMehzpm4AVyK+bFEaFg9gnZsSUPpsbAe/0RFhrH+EXZ12Z7thf4dzN1+Sn+G8QrDA1VKaN4IFxD1rQz9Xq9Coii9S9/hPbTGjyBwFH3H1UdQuz5KsgPDEHua4/kPg2Gp/IIItsaLWBqiT9XH45MiQxSosGJ56H/0F2cjcCFd72l1665RNHURdC3lspI77esfJsl+rXXabkAy7vxDXG/XGGcKpwiKDPFfvMEgjkAHil4Za1F36RnyxxvdIAzvgfH8knukYDck07tc++DP4TdWeI7HXuq5Yl6VVFrUQtf64/dkXewlKZSHQo6YvCSpREB0GDrz+Ys2GfO8nw2SwrYwaf88AifzlPvP17bf1mI3AuccJvAjZIpBmqvharKFAebEjVKfGAwpQjWoXlm9LROsq9bCk1UeQ3CJxJqprzssS/Q04JeS1ReCCubL3J7sx86spkP4eNpp95UF+8K748icIs8vdILFklk9skQqi1So6cx3X906pvy1vz+KipTJ8fiVJxsV5MmT0XwA";let bi=44032,bs=4352,bo=4449,ba=4519,bl=28,bc=588,bu=55204,bd=4371,bh=4470,bf=4547;function bp(e){return e>>24&255}function bg(e){return 0xffffff&e}function bm(){let e=yJ(bn);for(let[t,r]of(s=new Map(y1(e).flatMap((e,t)=>e.map(e=>[e,t+1<<24]))),o=new Set(y0(e)),a=new Map,l=new Map,y2(e))){if(!o.has(t)&&2==r.length){let[e,n]=r,i=l.get(e);i||(i=new Map,l.set(e,i)),i.set(n,t)}a.set(t,r.reverse())}}function by(e){return e>=bi&&e<bu}function bb(e,t){if(e>=bs&&e<bd&&t>=bo&&t<bh)return bi+(e-bs)*bc+(t-bo)*bl;{if(by(e)&&t>ba&&t<bf&&(e-bi)%bl==0)return e+(t-ba);let r=l.get(e);return r&&(r=r.get(t))?r:-1}}function bw(e){s||bm();let t=[],r=[],n=!1;function i(e){let r=s.get(e);r&&(n=!0,e|=r),t.push(e)}for(let n of e)for(;;){if(n<128)t.push(n);else if(by(n)){let e=n-bi,t=e/bc|0,r=e%bc/bl|0,s=e%bl;i(bs+t),i(bo+r),s>0&&i(ba+s)}else{let e=a.get(n);e?r.push(...e):i(n)}if(!r.length)break;n=r.pop()}if(n&&t.length>1){let e=bp(t[0]);for(let r=1;r<t.length;r++){let n=bp(t[r]);if(0==n||e<=n){e=n;continue}let i=r-1;for(;;){let r=t[i+1];if(t[i+1]=t[i],t[i]=r,!i||(e=bp(t[--i]))<=n)break}e=bp(t[r])}}return t}function bv(e){let t=[],r=[],n=-1,i=0;for(let s of e){let e=bp(s),o=bg(s);if(-1==n)0==e?n=o:t.push(o);else if(i>0&&i>=e)0==e?(t.push(n,...r),r.length=0,n=o):r.push(o),i=e;else{let s=bb(n,o);s>=0?n=s:0==i&&0==e?(t.push(n),n=o):(r.push(o),i=e)}}return n>=0&&t.push(n,...r),t}function bE(e){return bw(e).map(bg)}function bA(e){return bv(bw(e))}let bx=45,bS=".",bk=65039,b_=1,bI=e=>Array.from(e);function bT(e,t){return e.P.has(t)||e.Q.has(t)}class bC extends Array{get is_emoji(){return!0}}function bP(){if(c)return;let e=yJ(yV),t=()=>y0(e),r=()=>new Set(t()),n=(e,t)=>t.forEach(t=>e.add(t));c=new Map(y2(e)),u=r(),d=t(),h=new Set(t().map(e=>d[e])),d=new Set(d),f=r(),p=r();let i=y1(e),s=e(),o=()=>{let e=new Set;return t().forEach(t=>n(e,i[t])),n(e,t()),e};g=y3(t=>{let r=y3(e).map(e=>e+96);if(r.length){let n=t>=s;r[0]-=32,r=bt(r),n&&(r=`Restricted[${r}]`);let i=o();return{N:r,P:i,Q:o(),M:!e(),R:n}}}),m=r(),y=new Map;let a=t().concat(bI(m)).sort((e,t)=>e-t);for(let{V:t,M:r}of(a.forEach((t,r)=>{let n=e(),i=a[r]=n?a[r-n]:{V:[],M:new Map};i.V.push(t),m.has(t)||y.set(t,i)}),new Set(y.values()))){let e=[];for(let r of t){let t=g.filter(e=>bT(e,r)),i=e.find(({G:e})=>t.some(t=>e.has(t)));i||(i={G:new Set,V:[]},e.push(i)),i.V.push(r),n(i.G,t)}let i=e.flatMap(e=>bI(e.G));for(let{G:t,V:n}of e){let e=new Set(i.filter(e=>!t.has(e)));for(let t of n)r.set(t,e)}}b=new Set;let l=new Set,E=e=>b.has(e)?l.add(e):b.add(e);for(let e of g){for(let t of e.P)E(t);for(let t of e.Q)E(t)}for(let e of b)y.has(e)||l.has(e)||y.set(e,b_);for(let t of(n(b,bE(b)),w=y8(e).map(e=>bC.from(e)).sort(br),v=new Map,w)){let e=[v];for(let r of t){let t=e.map(e=>{let t=e.get(r);return t||(t=new Map,e.set(r,t)),t});r===bk?e.push(...t):e=t}for(let r of e)r.V=t}}function bR(e){return(bF(e)?"":`${bD(bO([e]))} `)+y9(e)}function bD(e){return`"${e}"\u200E`}function bN(e){if(e.length>=4&&e[2]==bx&&e[3]==bx)throw Error(`invalid label extension: "${bt(e.slice(0,4))}"`)}function bM(e){let t=95;for(let r=e.lastIndexOf(t);r>0;)if(e[--r]!==t)throw Error("underscore allowed only at start")}function bB(e){let t=e[0],r=yG.get(t);if(r)throw bG(`leading ${r}`);let n=e.length,i=-1;for(let s=1;s<n;s++){t=e[s];let n=yG.get(t);if(n){if(i==s)throw bG(`${r} + ${n}`);i=s+1,r=n}}if(i==n)throw bG(`trailing ${r}`)}function bO(e,t=1/0,r=y9){let n=[];bL(e[0])&&n.push(""),e.length>t&&(t>>=1,e=[...e.slice(0,t),8230,...e.slice(-t)]);let i=0,s=e.length;for(let t=0;t<s;t++){let s=e[t];bF(s)&&(n.push(bt(e.slice(i,t))),n.push(r(s)),i=t+1)}return n.push(bt(e.slice(i,s))),n.join("")}function bL(e,t){return bP(),t?h.has(e):d.has(e)}function bF(e){return bP(),f.has(e)}function bU(e){return bq(bj(e,bA,bQ))}function bj(e,t,r){if(!e)return[];bP();let n=0;return e.split(bS).map(e=>{let i=be(e),s={input:i,offset:n};n+=i.length+1;try{let e,n=s.tokens=bW(i,t,r),o=n.length;if(!o)throw Error("empty label");let a=s.output=n.flat();if(bM(a),!(s.emoji=o>1||n[0].is_emoji)&&a.every(e=>e<128))bN(a),e="ASCII";else{let t=n.flatMap(e=>e.is_emoji?[]:e);if(t.length){if(d.has(a[0]))throw bG("leading combining mark");for(let e=1;e<o;e++){let t=n[e];if(!t.is_emoji&&d.has(t[0]))throw bG(`emoji + combining mark: "${bt(n[e-1])} + ${bO([t[0]])}"`)}bB(a);let r=bI(new Set(t)),[i]=b$(r);bK(i,t),bH(i,r),e=i.N}else e="Emoji"}s.type=e}catch(e){s.error=e}return s})}function bH(e,t){let r,n=[];for(let e of t){let t=y.get(e);if(t===b_)return;if(t){let n=t.M.get(e);if(!(r=r?r.filter(e=>n.has(e)):bI(n)).length)return}else n.push(e)}if(r){for(let t of r)if(n.every(e=>bT(t,e)))throw Error(`whole-script confusable: ${e.N}/${t.N}`)}}function b$(e){let t=g;for(let r of e){let e=t.filter(e=>bT(e,r));if(!e.length)if(g.some(e=>bT(e,r)))throw bV(t[0],r);else throw bz(r);if(t=e,1==e.length)break}return t}function bq(e){return e.map(({input:t,error:r,output:n})=>{if(r){let n=r.message;throw Error(1==e.length?n:`Invalid label ${bD(bO(t,63))}: ${n}`)}return bt(n)}).join(bS)}function bz(e){return Error(`disallowed character: ${bR(e)}`)}function bV(e,t){let r=bR(t),n=g.find(e=>e.P.has(t));return n&&(r=`${n.N} ${r}`),Error(`illegal mixture: ${e.N} + ${r}`)}function bG(e){return Error(`illegal placement: ${e}`)}function bK(e,t){for(let r of t)if(!bT(e,r))throw bV(e,r);if(e.M){let e=bE(t);for(let t=1,r=e.length;t<r;t++)if(h.has(e[t])){let n=t+1;for(let i;n<r&&h.has(i=e[n]);n++)for(let r=t;r<n;r++)if(e[r]==i)throw Error(`duplicate non-spacing marks: ${bR(i)}`);if(n-t>yK)throw Error(`excessive non-spacing marks: ${bD(bO(e.slice(t-1,n)))} (${n-t}/${yK})`);t=n}}}function bW(e,t,r){let n=[],i=[];for(e=e.slice().reverse();e.length;){let s=bJ(e);if(s)i.length&&(n.push(t(i)),i=[]),n.push(r(s));else{let t=e.pop();if(b.has(t))i.push(t);else{let e=c.get(t);if(e)i.push(...e);else if(!u.has(t))throw bz(t)}}}return i.length&&n.push(t(i)),n}function bQ(e){return e.filter(e=>e!=bk)}function bJ(e,t){let r,n=v,i=e.length;for(;i&&(n=n.get(e[--i]));){let{V:s}=n;s&&(r=s,t&&t.push(...e.slice(i).reverse()),e.length=i)}return r}let bZ="valid",bY="mapped",bX=e=>bU(e),b0=e=>{let t="";for(let e=0;e<32;e+=1)t+="00";if(e){let r=bX(e).split(".");for(let e=r.length-1;e>=0;e-=1){let n=lv(r[e]).slice(2);t=lv(`0x${t}${n}`).slice(2)}}return`0x${t}`};var b1=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class b2{constructor(e,t){this.contract=new yL(yq,null!=t?t:yH.main,e),this.context=e}getOwner(e){return b1(this,void 0,void 0,function*(){try{return this.contract.methods.owner(b0(e)).call()}catch(e){throw Error()}})}getTTL(e){return b1(this,void 0,void 0,function*(){try{return this.contract.methods.ttl(b0(e)).call()}catch(e){throw Error()}})}recordExists(e){return b1(this,void 0,void 0,function*(){try{return this.contract.methods.recordExists(b0(e)).call()}catch(e){throw Error()}})}getResolver(e){return b1(this,void 0,void 0,function*(){try{return this.contract.methods.resolver(b0(e)).call().then(e=>{if("string"==typeof e)return new yL(yz,e,this.context);throw Error()})}catch(e){throw Error()}})}get events(){return this.contract.events}}var b3=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class b4{constructor(e){this.registry=e}getResolverContractAdapter(e){return b3(this,void 0,void 0,function*(){return this.registry.getResolver(e)})}checkInterfaceSupport(e,t){var r,n;return b3(this,void 0,void 0,function*(){if(lt(yU[t]))throw new t9(null!=(r=e.options.address)?r:"",t);if(!(yield e.methods.supportsInterface(yU[t]).call()))throw new t9(null!=(n=e.options.address)?n:"",t)})}supportsInterface(e,t){var r;return b3(this,void 0,void 0,function*(){let n=yield this.getResolverContractAdapter(e),i=t;if(!oB(i)){if(i=null!=(r=lw(t))?r:"",""===t)throw Error("Invalid interface Id");i=i.slice(0,10)}return n.methods.supportsInterface(i).call()})}getAddress(e,t=60){return b3(this,void 0,void 0,function*(){let r=yield this.getResolverContractAdapter(e);return yield this.checkInterfaceSupport(r,yj.addr),r.methods.addr(b0(e),t).call()})}getPubkey(e){return b3(this,void 0,void 0,function*(){let t=yield this.getResolverContractAdapter(e);return yield this.checkInterfaceSupport(t,yj.pubkey),t.methods.pubkey(b0(e)).call()})}getContenthash(e){return b3(this,void 0,void 0,function*(){let t=yield this.getResolverContractAdapter(e);return yield this.checkInterfaceSupport(t,yj.contenthash),t.methods.contenthash(b0(e)).call()})}setAddress(e,t,r){return b3(this,void 0,void 0,function*(){let n=yield this.getResolverContractAdapter(e);return yield this.checkInterfaceSupport(n,yj.setAddr),n.methods.setAddr(b0(e),t).send(r)})}getText(e,t){return b3(this,void 0,void 0,function*(){let r=yield this.getResolverContractAdapter(e);return yield this.checkInterfaceSupport(r,yj.text),r.methods.text(b0(e),t).call()})}getName(e,t=!0){return b3(this,void 0,void 0,function*(){let r=`${e.toLowerCase().substring(2)}.addr.reverse`,n=yield this.getResolverContractAdapter(r);return t&&(yield this.checkInterfaceSupport(n,yj.name)),n.methods.name(b0(r)).call()})}}var b5=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class b6 extends hA{constructor(e,t){super(null!=t?t:""),this.registryAddress=null!=e?e:yH.main,this._registry=new b2(this.getContextObject(),e),this._resolver=new b4(this._registry)}getResolver(e){return b5(this,void 0,void 0,function*(){return this._registry.getResolver(e)})}recordExists(e){return b5(this,void 0,void 0,function*(){return this._registry.recordExists(e)})}getTTL(e){return b5(this,void 0,void 0,function*(){return this._registry.getTTL(e)})}getOwner(e){return b5(this,void 0,void 0,function*(){return this._registry.getOwner(e)})}getAddress(e,t=60){return b5(this,void 0,void 0,function*(){return this._resolver.getAddress(e,t)})}getText(e,t){return b5(this,void 0,void 0,function*(){return o5(e)?this._resolver.getText((yield this._resolver.getName(e,!1)),t):this._resolver.getText(e,t)})}getName(e,t=!0){return b5(this,void 0,void 0,function*(){return this._resolver.getName(e,t)})}getPubkey(e){return b5(this,void 0,void 0,function*(){return this._resolver.getPubkey(e)})}getContenthash(e){return b5(this,void 0,void 0,function*(){return this._resolver.getContenthash(e)})}checkNetwork(){return b5(this,void 0,void 0,function*(){let e=Date.now()/1e3;if(!this._lastSyncCheck||e-this._lastSyncCheck>3600){let t=yield mp(this);if(!("boolean"==typeof t&&!t))throw new ri;this._lastSyncCheck=e}if(this._detectedAddress)return this._detectedAddress;let t=yield fZ(this,Object.assign(Object.assign({},this.defaultReturnFormat),{number:E.HEX})),r=yH[y$[t]];if(void 0===r)throw new rn(t);return this._detectedAddress=r,this._detectedAddress})}supportsInterface(e,t){return b5(this,void 0,void 0,function*(){return this._resolver.supportsInterface(e,t)})}get events(){return this._registry.events}setAddress(e,t,r){return b5(this,void 0,void 0,function*(){return this._resolver.setAddress(e,t,r)})}}var b8=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let b7=e=>b8(void 0,void 0,void 0,function*(){return(yield fm(e)).map(aQ)}),b9=(e,t)=>b8(void 0,void 0,void 0,function*(){return ab.validate(["string"],[t]),aQ((yield fy(e,t)))}),we=(e,t,r,n)=>b8(void 0,void 0,void 0,function*(){return ab.validate(["address","string","uint"],[t,r,n]),fb(e,t,r,n)}),wt=(e,t)=>b8(void 0,void 0,void 0,function*(){return ab.validate(["address"],[t]),fw(e,t)}),wr=(e,t,r)=>b8(void 0,void 0,void 0,function*(){return ab.validate(["string","string"],[t,r]),fv(e,t,r)}),wn=(e,t,r,n)=>b8(void 0,void 0,void 0,function*(){return fE(e,fW(t,Y,{transactionSchema:null==n?void 0:n.customTransactionSchema}),r)}),wi=(e,t,r,n)=>b8(void 0,void 0,void 0,function*(){return fA(e,fW(t,Y,{transactionSchema:null==n?void 0:n.customTransactionSchema}),r)}),ws=(e,t,r,n)=>b8(void 0,void 0,void 0,function*(){return ab.validate(["string","address","string"],[t,r,n]),fx(e,oB(t)?t:aN(t),r,n)}),wo=(e,t,r)=>b8(void 0,void 0,void 0,function*(){return ab.validate(["string","string"],[t,r]),fS(e,oB(t)?t:aN(t),r)});var wa=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class wl extends hA{getAccounts(){return wa(this,void 0,void 0,function*(){return b7(this.requestManager)})}newAccount(e){return wa(this,void 0,void 0,function*(){return b9(this.requestManager,e)})}unlockAccount(e,t,r){return wa(this,void 0,void 0,function*(){return we(this.requestManager,e,t,r)})}lockAccount(e){return wa(this,void 0,void 0,function*(){return wt(this.requestManager,e)})}importRawKey(e,t){return wa(this,void 0,void 0,function*(){return wr(this.requestManager,e,t)})}sendTransaction(e,t){return wa(this,void 0,void 0,function*(){return wn(this.requestManager,e,t,this.config)})}signTransaction(e,t){return wa(this,void 0,void 0,function*(){return wi(this.requestManager,e,t,this.config)})}sign(e,t,r){return wa(this,void 0,void 0,function*(){return ws(this.requestManager,e,t,r)})}ecRecover(e,t){return wa(this,void 0,void 0,function*(){return wo(this.requestManager,e,t)})}}!function(e){e.HTTPS="https",e.WebSocket="wss"}(q||(q={})),function(e){e.ETH_MAINNET="eth_mainnet",e.ETH_SEPOLIA="eth_sepolia",e.ETH_HOLESKY="eth_holesky",e.POLYGON_MAINNET="polygon_mainnet",e.POLYGON_AMOY="polygon_amoy",e.AVALANCHE_C_MAINNET="avalanche_c_mainnet",e.AVALANCHE_P_MAINNET="avalanche_p_mainnet",e.AVALANCHE_X_MAINNET="avalanche_x_mainnet",e.ARBITRUM_MAINNET="arbitrum_mainnet",e.ARBITRUM_SEPOLIA="arbitrum_sepolia",e.BASE_MAINNET="base_mainnet",e.BASE_SEPOLIA="base_sepolia",e.OPTIMISM_MAINNET="optimism_mainnet",e.OPTIMISM_SEPOLIA="optimism_sepolia",e.FANTOM_MAINNET="fantom_mainnet",e.FANTOM_TESTNET="fantom_testnet",e.DYMENSION_MAINNET="dymension_mainnet",e.DYMENSION_TESTNET="dymension_testnet",e.BNB_MAINNET="bnb_mainnet",e.BNB_TESTNET="bnb_testnet",e.BSC_MAINNET="bsc_mainnet",e.BSC_TESTNET="bsc_testnet",e.ARBITRUM_ONE="arbitrum_one",e.ARBITRUM_NOVA="arbitrum_nova",e.AVALANCHE_FUJI_C="avalanche_fuji_c",e.AVALANCHE_FUJI_P="avalanche_fuji_p",e.AVALANCHE_FUJI_X="avalanche_fuji_x",e.BLAST_MAINNET="blast_mainnet",e.OPBNB_MAINNET="opbnb_mainnet",e.OPBNB_TESTNET="opbnb_testnet",e.GNOSIS_MAINNET="gnosis_mainnet",e.GNOSIS_CHIADO="gnosis_chiado",e.PULSECHAIN_MAINNET="pulsechain_mainnet",e.PULSECHAIN_TESTNET="pulsechain_testnet",e.KAVA_MAINNET="kava_mainnet",e.CRONOS_MAINNET="cronos_mainnet",e.MANTLE_MAINNET="mantle_mainnet",e.CHILIZ_MAINNET="chiliz_mainnet",e.CHILIZ_SPICY="chiliz_spicy",e.MOONBEAM_MAINNET="moonbeam_mainnet",e.TAIKO_MAINNET="taiko_mainnet",e.TAIKO_HEKLA="taiko_hekla",e.LINEA_MAINNET="linea_mainnet",e.LINEA_SEPOLIA="linea_sepolia",e.BAHAMUT_MAINNET="bahamut_mainnet",e.SCROLL_MAINNET="scroll_mainnet",e.SCROLL_SEPOLIA="scroll_sepolia",e.TRON_MAINNET="tron_mainnet",e.SYSCOIN_MAINNET="syscoin_mainnet",e.SYSCOIN_TANENBAUM="syscoin_tanenbaum",e.MOONRIVER_MAINNET="moonriver_mainnet",e.HAQQ_MAINNET="haqq_mainnet",e.EVMOS_MAINNET="evmos_mainnet",e.EVMOS_TESTNET="evmos_testnet",e.BERACHAIN_TESTNET="berachain_testnet"}(z||(z={}));let wc=1300;class wu extends tV{constructor(e){super("You've reach the rate limit of free RPC calls from our Partner Quick Nodes. There are two options you can either create a paid Quick Nodes account and get 20% off for 2 months using WEB3JS referral code, or use Free public RPC endpoint.",e),this.code=wc}}let wd=1301;class wh extends tV{constructor(e){super(`Invalid provider config options given for ${e}`),this.code=wd}}var wf=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class wp extends l4{constructor(e,t,r,n,i){if(super(),void 0===i||t!==q.HTTPS||"providerOptions"in i){if(void 0!==i&&t===q.WebSocket&&!("socketOptions"in i||"reconnectOptions"in i))throw new wh("Websocket Provider")}else throw new wh("HTTP Provider");this.transport=t,t===q.HTTPS?this.provider=new cn(this.getRPCURL(e,t,r,n),i):t===q.WebSocket&&(this.provider=new co(this.getRPCURL(e,t,r,n),null==i?void 0:i.socketOptions,null==i?void 0:i.reconnectOptions))}request(e,t){return wf(this,void 0,void 0,function*(){return this.transport===q.HTTPS?yield this.provider.request(e,t):this.provider.request(e)})}getStatus(){return this.provider.getStatus()}supportsSubscriptions(){return this.provider.supportsSubscriptions()}once(e,t){var r;(null==(r=this.provider)?void 0:r.once)&&this.provider.once(e,t)}removeAllListeners(e){var t;(null==(t=this.provider)?void 0:t.removeAllListeners)&&this.provider.removeAllListeners(e)}connect(){var e;(null==(e=this.provider)?void 0:e.connect)&&this.provider.connect()}disconnect(e,t){var r;(null==(r=this.provider)?void 0:r.disconnect)&&this.provider.disconnect(e,t)}reset(){var e;(null==(e=this.provider)?void 0:e.reset)&&this.provider.reset()}on(e,t){this.provider&&this.provider.on(e,t)}removeListener(e,t){this.provider&&this.provider.removeListener(e,t)}}var wg=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let wm=e=>void 0!==e&&e.trim().length>0;class wy extends wp{constructor(e=z.ETH_MAINNET,t=q.HTTPS,r="",n="",i){super(e,t,r,n,i)}request(e,t){let r=Object.create(null,{request:{get:()=>super.request}});return wg(this,void 0,void 0,function*(){try{return yield r.request.call(this,e,t)}catch(e){if(e instanceof no&&429===e.statusCode)throw new wu(e);throw e}})}getRPCURL(e,t,r,n){let i="",s="";switch(e){case z.ETH_MAINNET:i=wm(n)?n:"powerful-holy-bush.quiknode.pro",s=wm(r)?r:"3240624a343867035925ff7561eb60dfdba2a668";break;case z.ETH_SEPOLIA:i=wm(n)?n:"dimensional-fabled-glitter.ethereum-sepolia.quiknode.pro",s=wm(r)?r:"382a3b5a4b938f2d6e8686c19af4b22921fde2cd";break;case z.ETH_HOLESKY:i=wm(n)?n:"yolo-morning-card.ethereum-holesky.quiknode.pro",s=wm(r)?r:"481ebe70638c4dcf176af617a16d02ab866b9af9";break;case z.ARBITRUM_MAINNET:i=wm(n)?n:"autumn-divine-dinghy.arbitrum-mainnet.quiknode.pro",s=wm(r)?r:"a5d7bfbf60b5ae9ce3628e53d69ef50d529e9a8c";break;case z.ARBITRUM_SEPOLIA:i=wm(n)?n:"few-patient-pond.arbitrum-sepolia.quiknode.pro",s=wm(r)?r:"3be985450970628c860b959c65cd2642dcafe53c";break;case z.BNB_MAINNET:i=wm(n)?n:"purple-empty-reel.bsc.quiknode.pro",s=wm(r)?r:"ebf6c532961e21f092ff2facce1ec4c89c540158";break;case z.BNB_TESTNET:i=wm(n)?n:"floral-rough-scion.bsc-testnet.quiknode.pro",s=wm(r)?r:"5b297e5acff5f81f4c37ebf6f235f7299b6f9d28";break;case z.POLYGON_MAINNET:i=wm(n)?n:"small-chaotic-moon.matic.quiknode.pro",s=wm(r)?r:"847569f8a017e84d985e10d0f44365d965a951f1";break;case z.POLYGON_AMOY:i=wm(n)?n:"prettiest-side-shape.matic-amoy.quiknode.pro",s=wm(r)?r:"79a9476eea661d4f82de614db1d8a895b14b881c";break;default:throw Error("Network info not avalible.")}return`${t}://${i}/${s}`}}let wb=e=>void 0!==e&&e.trim().length>0,ww=[z.DYMENSION_MAINNET,z.DYMENSION_TESTNET,z.KAVA_MAINNET,z.CRONOS_MAINNET,z.POLYGON_MAINNET];class wv extends wp{constructor(e=z.ETH_MAINNET,t=q.HTTPS,r="",n){super(e,t,"",r,n)}getRPCURL(e,t,r,n){if(!wv.networkHostMap[e])throw Error("Network info not avalible.");let i=`${wv.networkHostMap[e]}.publicnode.com`,s=wb(n)?n:i;return ww.includes(e)&&t===q.WebSocket?`${t}://${s}/websocket`:`${t}://${s}`}}wv.networkHostMap={[z.POLYGON_AMOY]:"polygon-amoy-bor-rpc",[z.DYMENSION_MAINNET]:"dymension-evm-rpc",[z.DYMENSION_TESTNET]:"dymension-testnet-evm-rpc",[z.BLAST_MAINNET]:"blast-rpc",[z.GNOSIS_MAINNET]:"gnosis-rpc",[z.PULSECHAIN_MAINNET]:"pulsechain-rpc",[z.PULSECHAIN_TESTNET]:"pulsechain-testnet-rpc",[z.KAVA_MAINNET]:"kava-evm-rpc",[z.CRONOS_MAINNET]:"cronos-evm-rpc",[z.MANTLE_MAINNET]:"mantle-rpc",[z.TAIKO_MAINNET]:"taiko-rpc",[z.TAIKO_HEKLA]:"taiko-hekla-rpc",[z.LINEA_MAINNET]:"linea-rpc",[z.LINEA_SEPOLIA]:"linea-sepolia-rpc",[z.SCROLL_MAINNET]:"scroll-rpc",[z.SCROLL_SEPOLIA]:"scroll-sepolia-rpc",[z.SYSCOIN_MAINNET]:"syscoin-evm-rpc",[z.SYSCOIN_TANENBAUM]:"syscoin-tanenbaum-evm-rpc",[z.HAQQ_MAINNET]:"haqq-evm-rpc",[z.EVMOS_MAINNET]:"evmos-evm-rpc",[z.EVMOS_TESTNET]:"evmos-testnet-evm-rpc",[z.BERACHAIN_TESTNET]:"berachain-testnet-evm-rpc",[z.ETH_MAINNET]:"ethereum-rpc",[z.ETH_SEPOLIA]:"ethereum-sepolia-rpc",[z.ETH_HOLESKY]:"ethereum-holesky-rpc",[z.BSC_MAINNET]:"bsc-rpc",[z.BSC_TESTNET]:"bsc-testnet-rpc",[z.POLYGON_MAINNET]:"polygon-bor-rpc",[z.BASE_MAINNET]:"base-rpc",[z.BASE_SEPOLIA]:"base-sepolia-rpc",[z.ARBITRUM_ONE]:"arbitrum-one-rpc",[z.ARBITRUM_NOVA]:"arbitrum-nova-rpc",[z.ARBITRUM_SEPOLIA]:"arbitrum-sepolia-rpc",[z.AVALANCHE_C_MAINNET]:"avalanche-c-chain-rpc",[z.AVALANCHE_P_MAINNET]:"avalanche-p-chain-rpc",[z.AVALANCHE_X_MAINNET]:"avalanche-x-chain-rpc",[z.AVALANCHE_FUJI_C]:"avalanche-fuji-c-chain-rpc",[z.AVALANCHE_FUJI_P]:"avalanche-fuji-p-chain-rpc",[z.AVALANCHE_FUJI_X]:"avalanche-fuji-x-chain-rpc",[z.OPTIMISM_MAINNET]:"optimism-rpc",[z.OPTIMISM_SEPOLIA]:"optimism-sepolia-rpc",[z.FANTOM_MAINNET]:"fantom-rpc",[z.FANTOM_TESTNET]:"fantom-testnet-rpc",[z.OPBNB_MAINNET]:"opbnb-rpc",[z.OPBNB_TESTNET]:"opbnb-testnet-rpc",[z.GNOSIS_CHIADO]:"gnosis-chiado-rpc",[z.CHILIZ_MAINNET]:"chiliz-rpc",[z.CHILIZ_SPICY]:"chiliz-spicy-rpc",[z.MOONBEAM_MAINNET]:"moonbeam-rpc",[z.BAHAMUT_MAINNET]:"bahamut-rpc",[z.TRON_MAINNET]:"tron-evm-rpc",[z.MOONRIVER_MAINNET]:"moonriver-rpc"};let wE=new wy,wA={encodeEventSignature:pT,encodeFunctionCall:gX,encodeFunctionSignature:gY,encodeParameter:gW,encodeParameters:gG,decodeParameter:gZ,decodeParameters:gJ,decodeLog:g4};var wx=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let wS=e=>{let t=(t,r)=>wx(void 0,void 0,void 0,function*(){return hc((yield yu(t,e)),lm({format:"bytes"},r,Y))}),r=e=>{let r=hg(e);return Object.assign(Object.assign({},r),{signTransaction:e=>wx(void 0,void 0,void 0,function*(){return t(e,r.privateKey)})})},n=(e,r,n)=>wx(void 0,void 0,void 0,function*(){var i;let s=yield hy(e,r,null==(i=null==n?void 0:n.nonStrict)||i);return Object.assign(Object.assign({},s),{signTransaction:e=>wx(void 0,void 0,void 0,function*(){return t(e,s.privateKey)})})}),i=()=>{let e=hm();return Object.assign(Object.assign({},e),{signTransaction:r=>wx(void 0,void 0,void 0,function*(){return t(r,e.privateKey)})})},s=new cA({create:i,privateKeyToAccount:r,decrypt:n});return{signTransaction:t,create:i,privateKeyToAccount:r,decrypt:n,recoverTransaction:hu,hashMessage:ho,sign:hl,recover:hd,encrypt:hp,wallet:s,privateKeyToAddress:hh,parseAndValidatePrivateKey:hs,privateKeyToPublicKey:hf}},wk={version:"4.16.0"};var w_=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};!function(e){e.eip6963announceProvider="eip6963:announceProvider",e.eip6963requestProvider="eip6963:requestProvider"}(V||(V={}));let wI=new Map,wT="web3:providersMapUpdated",wC=()=>w_(void 0,void 0,void 0,function*(){return new Promise((e,t)=>{"undefined"==typeof window&&t(Error("window object not available, EIP-6963 is intended to be used within a browser")),window.addEventListener(V.eip6963announceProvider,t=>{wI.set(t.detail.info.uuid,t.detail);let r=new CustomEvent(wT,{detail:wI});window.dispatchEvent(r),e(wI)}),window.dispatchEvent(new Event(V.eip6963requestProvider))})}),wP=e=>{if("undefined"==typeof window)throw Error("window object not available, EIP-6963 is intended to be used within a browser");window.addEventListener(wT,e)};class wR extends hA{constructor(e=wE){var t;!lt(e)&&("string"!=typeof e||""!==e.trim())&&("string"==typeof e||ch(e)||e.provider)||console.warn("NOTE: web3.js is running without provider. You need to pass a provider in order to interact with the network!");let r={};"string"==typeof e||ch(e)?r.provider=e:r=e||{},r.registeredSubscriptions=Object.assign(Object.assign({},m1),null!=(t=r.registeredSubscriptions)?t:{}),super(r);let n=wS(this);this._wallet=n.wallet,this._accountProvider=n,this.utils=W;let i=this;class s extends yF{constructor(e,t,r,n,s){let a,l,c;if(le(t)&&le(r))throw new rs("Should not provide options at both 2nd and 3rd parameters");let u={};if(!lt(t)&&"object"!=typeof t&&"string"!=typeof t)throw new rs;if("string"==typeof t&&(a=t),u=le(t)?t:le(r)?r:{},l=t instanceof hA?t:r instanceof hA?r:n instanceof hA?n:i.getContextObject(),s?c=s:ld(r)?c=r:ld(n)&&(c=n),super(e,a,u,l,c),super.subscribeToContextEvents(i),!lt(o)){let e=o.getTransactionMiddleware();lt(e)||super.setTransactionMiddleware(e)}}}let o=i.use(m2);this.eth=Object.assign(o,{ens:i.use(b6,yH.main),Iban:hx,net:i.use(f1),personal:i.use(wl),Contract:s,abi:wA,accounts:n})}}wR.version=wk.version,wR.utils=W,wR.requestEIP6963Providers=wC,wR.onNewProviderDiscovered=wP,wR.modules={Web3Eth:m2,Iban:hx,Net:f1,ENS:b6,Personal:wl};let wD=wR},18593:(e,t,r)=>{"use strict";function n(e=0){return new Uint8Array(e)}function i(e=0){return new Uint8Array(e)}r.d(t,{K:()=>i,c:()=>n})},18993:(e,t,r)=>{"use strict";let{AbstractIterator:n}=r(97233),i=r(75799),s=r(13623),o=Symbol("cache"),a=Symbol("finished"),l=Symbol("options"),c=Symbol("currentOptions"),u=Symbol("position"),d=Symbol("location"),h=Symbol("first"),f={};class p extends n{constructor(e,t,r){super(e,r),this[o]=[],this[a]=0===this.limit,this[l]=r,this[c]={...r},this[u]=void 0,this[d]=t,this[h]=!0}_nextv(e,t,r){let n;if(this[h]=!1,this[a])return this.nextTick(r,null,[]);if(this[o].length>0)return e=Math.min(e,this[o].length),this.nextTick(r,null,this[o].splice(0,e));void 0!==this[u]&&(this[l].reverse?(this[c].lt=this[u],this[c].lte=void 0):(this[c].gt=this[u],this[c].gte=void 0));try{n=i(this[c])}catch(e){return this[a]=!0,this.nextTick(r,null,[])}let f=this.db.db.transaction([this[d]],"readonly"),p=f.objectStore(this[d]),m=[];if(this[l].reverse){let t=!this[l].values&&p.openKeyCursor?"openKeyCursor":"openCursor";p[t](n,"prev").onsuccess=t=>{let r=t.target.result;if(r){let{key:t,value:n}=r;this[u]=t,m.push([this[l].keys&&void 0!==t?s(t):void 0,this[l].values&&void 0!==n?s(n):void 0]),m.length<e?r.continue():g(f)}else this[a]=!0}}else{let t,r,i=()=>{if(void 0===t||void 0===r)return;let n=Math.max(t.length,r.length);0===n||e===1/0?this[a]=!0:this[u]=t[n-1],m.length=n;for(let e=0;e<n;e++){let n=t[e],i=r[e];m[e]=[this[l].keys&&void 0!==n?s(n):void 0,this[l].values&&void 0!==i?s(i):void 0]}g(f)};this[l].keys||e<1/0?p.getAllKeys(n,e<1/0?e:void 0).onsuccess=e=>{t=e.target.result,i()}:(t=[],this.nextTick(i)),this[l].values?p.getAll(n,e<1/0?e:void 0).onsuccess=e=>{r=e.target.result,i()}:(r=[],this.nextTick(i))}f.onabort=()=>{r(f.error||Error("aborted by user")),r=null},f.oncomplete=()=>{r(null,m),r=null}}_next(e){if(this[o].length>0){let[t,r]=this[o].shift();this.nextTick(e,null,t,r)}else if(this[a])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[h]&&(this[h]=!1,t=1),this._nextv(t,f,(t,r)=>{if(t)return e(t);this[o]=r,this._next(e)})}}_all(e,t){this[h]=!1;let r=this[o].splice(0,this[o].length),n=this.limit-this.count-r.length;if(n<=0)return this.nextTick(t,null,r);this._nextv(n,f,(e,n)=>{if(e)return t(e);r.length>0&&(n=r.concat(n)),t(null,n)})}_seek(e,t){let r;this[h]=!0,this[o]=[],this[a]=!1,this[u]=void 0,this[c]={...this[l]};try{r=i(this[l])}catch(e){this[a]=!0;return}null===r||r.includes(e)?this[l].reverse?this[c].lte=e:this[c].gte=e:this[a]=!0}}function g(e){"function"==typeof e.commit&&e.commit()}t.Iterator=p},19169:(e,t,r)=>{"use strict";var n,i=r(44134).Buffer;let s="[object ArrayBuffer]";class o{static isArrayBuffer(e){return Object.prototype.toString.call(e)===s}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){let r=o.toUint8Array(e),n=o.toUint8Array(t);if(r.length!==n.byteLength)return!1;for(let e=0;e<r.length;e++)if(r[e]!==n[e])return!1;return!0}static concat(...e){let t;t=!Array.isArray(e[0])||e[1]instanceof Function?Array.isArray(e[0])&&e[1]instanceof Function?e[0]:e[e.length-1]instanceof Function?e.slice(0,e.length-1):e:e[0];let r=0;for(let e of t)r+=e.byteLength;let n=new Uint8Array(r),i=0;for(let e of t){let t=this.toUint8Array(e);n.set(t,i),i+=t.length}return e[e.length-1]instanceof Function?this.toView(n,e[e.length-1]):n.buffer}}let a="string",l=/^[0-9a-f\s]+$/i,c=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,u=/^[a-zA-Z0-9-_]+$/;class d{static fromString(e){let t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r.buffer}static toString(e){let t=o.toUint8Array(e),r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return decodeURIComponent(escape(r))}}class h{static toString(e,t=!1){let r=o.toArrayBuffer(e),n=new DataView(r),i="";for(let e=0;e<r.byteLength;e+=2)i+=String.fromCharCode(n.getUint16(e,t));return i}static fromString(e,t=!1){let r=new ArrayBuffer(2*e.length),n=new DataView(r);for(let r=0;r<e.length;r++)n.setUint16(2*r,e.charCodeAt(r),t);return r}}class f{static isHex(e){return typeof e===a&&l.test(e)}static isBase64(e){return typeof e===a&&c.test(e)}static isBase64Url(e){return typeof e===a&&u.test(e)}static ToString(e,t="utf8"){let r=o.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return h.toString(r,!0);case"utf16":case"utf16be":return h.toString(r);default:throw Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return h.fromString(e,!0);case"utf16":case"utf16be":return h.fromString(e);default:throw Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){let t=o.toUint8Array(e);return"undefined"!=typeof btoa?btoa(this.ToString(t,"binary")):i.from(t).toString("base64")}static FromBase64(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!f.isBase64(t))throw TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(t)):new Uint8Array(i.from(t,"base64")).buffer}static FromBase64Url(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!f.isBase64Url(t))throw TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=f.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return d.fromString(e);case"utf16":case"utf16be":return h.fromString(e);case"utf16le":case"usc2":return h.fromString(e,!0);default:throw Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=f.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return d.toString(e);case"utf16":case"utf16be":return h.toString(e);case"utf16le":case"usc2":return h.toString(e,!0);default:throw Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){let t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return r.buffer}static ToBinary(e){let t=o.toUint8Array(e),r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return r}static ToHex(e){let t=o.toUint8Array(e),r="",n=t.length;for(let e=0;e<n;e++){let n=t[e];n<16&&(r+="0"),r+=n.toString(16)}return r}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!f.isHex(t))throw TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);let r=new Uint8Array(t.length/2);for(let e=0;e<t.length;e+=2){let n=t.slice(e,e+2);r[e/2]=parseInt(n,16)}return r.buffer}static ToUtf16String(e,t=!1){return h.toString(e,t)}static FromUtf16String(e,t=!1){return h.fromString(e,t)}static Base64Padding(e){let t=4-e.length%4;if(t<4)for(let r=0;r<t;r++)e+="=";return e}static formatString(e){return(null==e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}function p(e,...t){let r=arguments[0];for(let e=1;e<arguments.length;e++){let t=arguments[e];for(let e in t)r[e]=t[e]}return r}function g(...e){let t=new Uint8Array(e.map(e=>e.byteLength).reduce((e,t)=>e+t)),r=0;return e.map(e=>new Uint8Array(e)).forEach(e=>{for(let n of e)t[r++]=n}),t.buffer}function m(e,t){if(!(e&&t)||e.byteLength!==t.byteLength)return!1;let r=new Uint8Array(e),n=new Uint8Array(t);for(let t=0;t<e.byteLength;t++)if(r[t]!==n[t])return!1;return!0}f.DEFAULT_UTF8_ENCODING="utf8",t._H=o,t.U$=f,n=p,n=g,n=m},19178:(e,t,r)=>{"use strict";r.d(t,{qW:()=>m});var n,i=r(12115),s=r(85185),o=r(63655),a=r(6101),l=r(39033);function c(e,t=globalThis?.document){let r=(0,l.c)(e);i.useEffect(()=>{let e=e=>{"Escape"===e.key&&r(e)};return t.addEventListener("keydown",e,{capture:!0}),()=>t.removeEventListener("keydown",e,{capture:!0})},[r,t])}var u=r(95155),d="DismissableLayer",h="dismissableLayer.update",f="dismissableLayer.pointerDownOutside",p="dismissableLayer.focusOutside",g=i.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),m=i.forwardRef((e,t)=>{var r,l;let{disableOutsidePointerEvents:d=!1,onEscapeKeyDown:f,onPointerDownOutside:p,onFocusOutside:m,onInteractOutside:y,onDismiss:E,...A}=e,x=i.useContext(g),[S,k]=i.useState(null),_=null!=(l=null==S?void 0:S.ownerDocument)?l:null==(r=globalThis)?void 0:r.document,[,I]=i.useState({}),T=(0,a.s)(t,e=>k(e)),C=Array.from(x.layers),[P]=[...x.layersWithOutsidePointerEventsDisabled].slice(-1),R=C.indexOf(P),D=S?C.indexOf(S):-1,N=x.layersWithOutsidePointerEventsDisabled.size>0,M=D>=R,B=b(e=>{let t=e.target,r=[...x.branches].some(e=>e.contains(t));M&&!r&&(null==p||p(e),null==y||y(e),e.defaultPrevented||null==E||E())},_),O=w(e=>{let t=e.target;![...x.branches].some(e=>e.contains(t))&&(null==m||m(e),null==y||y(e),e.defaultPrevented||null==E||E())},_);return c(e=>{D===x.layers.size-1&&(null==f||f(e),!e.defaultPrevented&&E&&(e.preventDefault(),E()))},_),i.useEffect(()=>{if(S)return d&&(0===x.layersWithOutsidePointerEventsDisabled.size&&(n=_.body.style.pointerEvents,_.body.style.pointerEvents="none"),x.layersWithOutsidePointerEventsDisabled.add(S)),x.layers.add(S),v(),()=>{d&&1===x.layersWithOutsidePointerEventsDisabled.size&&(_.body.style.pointerEvents=n)}},[S,_,d,x]),i.useEffect(()=>()=>{S&&(x.layers.delete(S),x.layersWithOutsidePointerEventsDisabled.delete(S),v())},[S,x]),i.useEffect(()=>{let e=()=>I({});return document.addEventListener(h,e),()=>document.removeEventListener(h,e)},[]),(0,u.jsx)(o.sG.div,{...A,ref:T,style:{pointerEvents:N?M?"auto":"none":void 0,...e.style},onFocusCapture:(0,s.m)(e.onFocusCapture,O.onFocusCapture),onBlurCapture:(0,s.m)(e.onBlurCapture,O.onBlurCapture),onPointerDownCapture:(0,s.m)(e.onPointerDownCapture,B.onPointerDownCapture)})});m.displayName=d;var y="DismissableLayerBranch";function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(()=>{var e;return null==(e=globalThis)?void 0:e.document})(),r=(0,l.c)(e),n=i.useRef(!1),s=i.useRef(()=>{});return i.useEffect(()=>{let e=e=>{if(e.target&&!n.current){let n=function(){E(f,r,i,{discrete:!0})},i={originalEvent:e};"touch"===e.pointerType?(t.removeEventListener("click",s.current),s.current=n,t.addEventListener("click",s.current,{once:!0})):n()}else t.removeEventListener("click",s.current);n.current=!1},i=window.setTimeout(()=>{t.addEventListener("pointerdown",e)},0);return()=>{window.clearTimeout(i),t.removeEventListener("pointerdown",e),t.removeEventListener("click",s.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(()=>{var e;return null==(e=globalThis)?void 0:e.document})(),r=(0,l.c)(e),n=i.useRef(!1);return i.useEffect(()=>{let e=e=>{e.target&&!n.current&&E(p,r,{originalEvent:e},{discrete:!1})};return t.addEventListener("focusin",e),()=>t.removeEventListener("focusin",e)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function v(){let e=new CustomEvent(h);document.dispatchEvent(e)}function E(e,t,r,n){let{discrete:i}=n,s=r.originalEvent.target,a=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&s.addEventListener(e,t,{once:!0}),i?(0,o.hO)(s,a):s.dispatchEvent(a)}i.forwardRef((e,t)=>{let r=i.useContext(g),n=i.useRef(null),s=(0,a.s)(t,n);return i.useEffect(()=>{let e=n.current;if(e)return r.branches.add(e),()=>{r.branches.delete(e)}},[r.branches]),(0,u.jsx)(o.sG.div,{...e,ref:s})}).displayName=y},20492:(e,t,r)=>{"use strict";var n=r(80228).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(e){var t;if(!e)return"utf8";for(;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function o(e){var t=s(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw Error("Unknown encoding: "+e);return t||e}function a(e){var t;switch(this.encoding=o(e),this.encoding){case"utf16le":this.text=p,this.end=g,t=4;break;case"utf8":this.fillLast=d,t=4;break;case"base64":this.text=m,this.end=y,t=3;break;default:this.write=b,this.end=w;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function l(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function c(e,t,r){var n=t.length-1;if(n<r)return 0;var i=l(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||-2===i?0:(i=l(t[n]))>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||-2===i?0:(i=l(t[n]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}function u(e,t,r){if((192&t[0])!=128)return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if((192&t[1])!=128)return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&(192&t[2])!=128)return e.lastNeed=2,""}}function d(e){var t=this.lastTotal-this.lastNeed,r=u(this,e,t);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):void(e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length)}function h(e,t){var r=c(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)}function f(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t}function p(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function g(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function m(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function y(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function b(e){return e.toString(this.encoding)}function w(e){return e&&e.length?this.write(e):""}t.StringDecoder=a,a.prototype.write=function(e){var t,r;if(0===e.length)return"";if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},a.prototype.end=f,a.prototype.text=h,a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},21589:(e,t,r)=>{"use strict";var n=r(45329),i=r(71033),s=r(10681);e.exports=n?function(e){return n(e)}:i?function(e){if(!e||"object"!=typeof e&&"function"!=typeof e)throw TypeError("getProto: not an object");return i(e)}:s?function(e){return s(e)}:null},22846:(e,t,r)=>{"use strict";let{Buffer:n}=r(44134)||{},{Encoding:i}=r(69503),s=r(77697);class o extends i{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new a({encode:this.encode,decode:e=>this.decode(n.from(e.buffer,e.byteOffset,e.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}}class a extends i{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new o({encode:e=>{let t=this.encode(e);return n.from(t.buffer,t.byteOffset,t.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}}class l extends i{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new o({encode:e=>n.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){let{textEncoder:e,textDecoder:t}=s();return new a({encode:t=>e.encode(this.encode(t)),decode:e=>this.decode(t.decode(e)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}}t.BufferFormat=o,t.ViewFormat=a,t.UTF8Format=l},22938:(e,t,r)=>{"use strict";r.d(t,{s:()=>i});var n=r(2629);function i(e,t="utf8"){let r=n.A[t];if(null==r)throw Error(`Unsupported encoding "${t}"`);return r.decoder.decode(`${r.prefix}${e}`)}},24658:(e,t,r)=>{"use strict";let n=r(4160);class i{constructor(e,t,r){let i=this;this._started=n(),this._rescheduled=0,this._scheduled=t,this._args=r,this._triggered=!1,this._timerWrapper=()=>{i._rescheduled>0?(i._scheduled=i._rescheduled-(n()-i._started),i._schedule(i._scheduled)):(i._triggered=!0,e.apply(null,i._args))},this._timer=setTimeout(this._timerWrapper,t)}reschedule(e){e||(e=this._scheduled);let t=n();t+e-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(e)):this._triggered?this._schedule(e):(this._started=t,this._rescheduled=e)}_schedule(e){this._triggered=!1,this._started=n(),this._rescheduled=0,this._scheduled=e,this._timer=setTimeout(this._timerWrapper,e)}clear(){clearTimeout(this._timer)}}e.exports=function(){let e;if("function"!=typeof arguments[0])throw Error("callback needed");if("number"!=typeof arguments[1])throw Error("timeout needed");if(arguments.length>0){e=Array(arguments.length-2);for(var t=0;t<e.length;t++)e[t]=arguments[t+2]}return new i(arguments[0],arguments[1],e)}},24747:e=>{"use strict";e.exports=ReferenceError},24802:(e,t,r)=>{"use strict";function n(e){return null!=e[Symbol.asyncIterator]}r.d(t,{A:()=>i});let i=function(e){if(n(e))return(async()=>{for await(let t of e);})();for(let t of e);}},25519:(e,t,r)=>{"use strict";r.d(t,{n:()=>h});var n=r(12115),i=r(6101),s=r(63655),o=r(39033),a=r(95155),l="focusScope.autoFocusOnMount",c="focusScope.autoFocusOnUnmount",u={bubbles:!1,cancelable:!0},d="FocusScope",h=n.forwardRef((e,t)=>{let{loop:r=!1,trapped:d=!1,onMountAutoFocus:h,onUnmountAutoFocus:m,...y}=e,[b,E]=n.useState(null),A=(0,o.c)(h),S=(0,o.c)(m),k=n.useRef(null),_=(0,i.s)(t,e=>E(e)),I=n.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;n.useEffect(()=>{if(d){let e=function(e){if(I.paused||!b)return;let t=e.target;b.contains(t)?k.current=t:w(k.current,{select:!0})},t=function(e){if(I.paused||!b)return;let t=e.relatedTarget;null!==t&&(b.contains(t)||w(k.current,{select:!0}))},r=function(e){if(document.activeElement===document.body)for(let t of e)t.removedNodes.length>0&&w(b)};document.addEventListener("focusin",e),document.addEventListener("focusout",t);let n=new MutationObserver(r);return b&&n.observe(b,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),n.disconnect()}}},[d,b,I.paused]),n.useEffect(()=>{if(b){v.add(I);let e=document.activeElement;if(!b.contains(e)){let t=new CustomEvent(l,u);b.addEventListener(l,A),b.dispatchEvent(t),t.defaultPrevented||(f(x(g(b)),{select:!0}),document.activeElement===e&&w(b))}return()=>{b.removeEventListener(l,A),setTimeout(()=>{let t=new CustomEvent(c,u);b.addEventListener(c,S),b.dispatchEvent(t),t.defaultPrevented||w(null!=e?e:document.body,{select:!0}),b.removeEventListener(c,S),v.remove(I)},0)}}},[b,A,S,I]);let T=n.useCallback(e=>{if(!r&&!d||I.paused)return;let t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,n=document.activeElement;if(t&&n){let t=e.currentTarget,[i,s]=p(t);i&&s?e.shiftKey||n!==s?e.shiftKey&&n===i&&(e.preventDefault(),r&&w(s,{select:!0})):(e.preventDefault(),r&&w(i,{select:!0})):n===t&&e.preventDefault()}},[r,d,I.paused]);return(0,a.jsx)(s.sG.div,{tabIndex:-1,...y,ref:_,onKeyDown:T})});function f(e){let{select:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=document.activeElement;for(let n of e)if(w(n,{select:t}),document.activeElement!==r)return}function p(e){let t=g(e);return[m(t,e),m(t.reverse(),e)]}function g(e){let t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function m(e,t){for(let r of e)if(!y(r,{upTo:t}))return r}function y(e,t){let{upTo:r}=t;if("hidden"===getComputedStyle(e).visibility)return!0;for(;e&&(void 0===r||e!==r);){if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function b(e){return e instanceof HTMLInputElement&&"select"in e}function w(e){let{select:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&e.focus){let r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&b(e)&&t&&e.select()}}h.displayName=d;var v=E();function E(){let e=[];return{add(t){let r=e[0];t!==r&&(null==r||r.pause()),(e=A(e,t)).unshift(t)},remove(t){var r;null==(r=(e=A(e,t))[0])||r.resume()}}}function A(e,t){let r=[...e],n=r.indexOf(t);return -1!==n&&r.splice(n,1),r}function x(e){return e.filter(e=>"A"!==e.tagName)}},27744:(e,t,r)=>{"use strict";r.d(t,{Q:()=>d});var n=r(68250),i=r(31987),s=r(98897),o=r(76520),a=r(7786),l=r(76154),c=r(91295),u=r(59372);class d extends n.fD{db;opts;constructor(e,t={}){super(),this.db="string"==typeof e?new u.Level(e,{...t,keyEncoding:"utf8",valueEncoding:"view"}):e,this.opts={createIfMissing:!0,compression:!1,...t}}async open(){try{await this.db.open(this.opts)}catch(e){throw new s.c0(String(e))}}async put(e,t){try{return await this.db.put(e.toString(),t),e}catch(e){throw new s.F9(String(e))}}async get(e){let t;try{t=await this.db.get(e.toString())}catch(e){if(null!=e.notFound)throw new s.m_(String(e));throw new s.kR(String(e))}return t}async has(e){try{await this.db.get(e.toString())}catch(e){if(null!=e.notFound)return!1;throw e}return!0}async delete(e){try{await this.db.del(e.toString())}catch(e){throw new s.DI(String(e))}}async close(){await this.db.close()}batch(){let e=[];return{put:(t,r)=>{e.push({type:"put",key:t.toString(),value:r})},delete:t=>{e.push({type:"del",key:t.toString()})},commit:async()=>{if(null==this.db.batch)throw Error("Batch operations unsupported by underlying Level");await this.db.batch(e)}}}query(e){let t=this._query({values:!0,prefix:e.prefix});Array.isArray(e.filters)&&(t=e.filters.reduce((e,t)=>(0,o.A)(e,t),t)),Array.isArray(e.orders)&&(t=e.orders.reduce((e,t)=>(0,l.A)(e,t),t));let{offset:r,limit:n}=e;if(null!=r){let e=0;t=(0,o.A)(t,()=>e++>=r)}return null!=n&&(t=(0,c.A)(t,n)),t}queryKeys(e){let t=(0,a.A)(this._query({values:!1,prefix:e.prefix}),({key:e})=>e);Array.isArray(e.filters)&&(t=e.filters.reduce((e,t)=>(0,o.A)(e,t),t)),Array.isArray(e.orders)&&(t=e.orders.reduce((e,t)=>(0,l.A)(e,t),t));let{offset:r,limit:n}=e;if(null!=r){let e=0;t=(0,o.A)(t,()=>e++>=r)}return null!=n&&(t=(0,c.A)(t,n)),t}_query(e){let t={keys:!0,keyEncoding:"buffer",values:e.values};if(null!=e.prefix){let r=e.prefix.toString();t.gte=r,t.lt=r+"\xff"}let r=this.db.iterator(t);if(null!=r[Symbol.asyncIterator])return h(r);if(null!=r.next&&null!=r.end)return f(r);throw Error("Level returned incompatible iterator")}}async function*h(e){for await(let[t,r]of e)yield{key:new i.U(t,!1),value:r};await e.close()}function f(e){return{[Symbol.asyncIterator]:()=>({next:async()=>new Promise((t,r)=>{e.next((n,s,o)=>null!=n?void r(n):null==s?void e.end(e=>{if(null!=e)return void r(e);t({done:!0,value:void 0})}):void t({done:!1,value:{key:new i.U(s,!1),value:o}}))}),return:async()=>new Promise((t,r)=>{e.end(e=>{if(null!=e)return void r(e);t({done:!0,value:void 0})})})})}}},28886:(e,t,r)=>{"use strict";var n=r(5955),i=r(8419),s=r(9166),o=r(91453),a=r(81954),l=r(21589),c=o("Object.prototype.toString"),u=r(39781)(),d="undefined"==typeof globalThis?r.g:globalThis,h=i(),f=o("String.prototype.slice"),p=o("Array.prototype.indexOf",!0)||function(e,t){for(var r=0;r<e.length;r+=1)if(e[r]===t)return r;return -1},g={__proto__:null};u&&a&&l?n(h,function(e){var t=new d[e];if(Symbol.toStringTag in t&&l){var r=l(t),n=a(r,Symbol.toStringTag);!n&&r&&(n=a(l(r),Symbol.toStringTag)),g["$"+e]=s(n.get)}}):n(h,function(e){var t=new d[e],r=t.slice||t.set;r&&(g["$"+e]=s(r))});var m=function(e){var t=!1;return n(g,function(r,n){if(!t)try{"$"+r(e)===n&&(t=f(n,1))}catch(e){}}),t},y=function(e){var t=!1;return n(g,function(r,n){if(!t)try{r(e),t=f(n,1)}catch(e){}}),t};e.exports=function(e){if(!e||"object"!=typeof e)return!1;if(!u){var t=f(c(e),8,-1);return p(h,t)>-1?t:"Object"===t&&y(e)}return a?m(e):null}},29200:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r)if(!this._cachedTimeouts)return!1;else this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var i=this._errors[n],s=i.message,o=(e[s]||0)+1;e[s]=o,o>=r&&(t=i,r=o)}return t}},29241:e=>{"use strict";var t,r,n=Function.prototype.toString,i="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof i&&"function"==typeof Object.defineProperty)try{t=Object.defineProperty({},"length",{get:function(){throw r}}),r={},i(function(){throw 42},null,t)}catch(e){e!==r&&(i=null)}else i=null;var s=/^\s*class\b/,o=function(e){try{var t=n.call(e);return s.test(t)}catch(e){return!1}},a=function(e){try{if(o(e))return!1;return n.call(e),!0}catch(e){return!1}},l=Object.prototype.toString,c="[object Object]",u="[object Function]",d="[object GeneratorFunction]",h="[object HTMLAllCollection]",f="[object HTML document.all class]",p="[object HTMLCollection]",g="function"==typeof Symbol&&!!Symbol.toStringTag,m=!(0 in[,]),y=function(){return!1};if("object"==typeof document){var b=document.all;l.call(b)===l.call(document.all)&&(y=function(e){if((m||!e)&&(void 0===e||"object"==typeof e))try{var t=l.call(e);return(t===h||t===f||t===p||t===c)&&null==e("")}catch(e){}return!1})}e.exports=i?function(e){if(y(e))return!0;if(!e||"function"!=typeof e&&"object"!=typeof e)return!1;try{i(e,null,t)}catch(e){if(e!==r)return!1}return!o(e)&&a(e)}:function(e){if(y(e))return!0;if(!e||"function"!=typeof e&&"object"!=typeof e)return!1;if(g)return a(e);if(o(e))return!1;var t=l.call(e);return(t===u||t===d||!!/^\[object HTML/.test(t))&&a(e)}},29485:(e,t,r)=>{e.exports=i;let n=r(56765);function i(e,t,r){let i,s,o,a,l,c;if("number"!=typeof t)throw Error("second argument must be a Number");let u=!0;function d(e){function t(){r&&r(e,i),r=null}u?n(t):t()}function h(t,r,n){if(i[t]=n,r&&(l=!0),0==--o||r)d(r);else if(!l&&c<s){let t;a?(t=a[c],c+=1,e[t](function(e,r){h(t,e,r)})):(t=c,c+=1,e[t](function(e,r){h(t,e,r)}))}}Array.isArray(e)?(i=[],o=s=e.length):(a=Object.keys(e),i={},o=s=a.length),c=t,o?a?a.some(function(r,n){return e[r](function(e,t){h(r,e,t)}),n===t-1}):e.some(function(e,r){return e(function(e,t){h(r,e,t)}),r===t-1}):d(null),u=!1}},30539:(e,t,r)=>{"use strict";r.d(t,{x:()=>u});var n=r(46923),i=r(98897),s=r(59372),o=r(43716),a=r(69685),l=r(34269),c=r(87704);class u extends n.if{db;opts;base;constructor(e,t={}){super(),this.db="string"==typeof e?new s.Level(e,{...t,keyEncoding:"utf8",valueEncoding:"view"}):e,this.opts={createIfMissing:!0,compression:!1,...t},this.base=t.base??o.base32upper}#e(e){return`/${this.base.encoder.encode(e.multihash.bytes)}`}#t(e){return a.TO.createV1(l.code,c.decode(this.base.decoder.decode(e.substring(1))))}async open(){try{await this.db.open(this.opts)}catch(e){throw new i.c0(String(e))}}async put(e,t){try{return await this.db.put(this.#e(e),t),e}catch(e){throw new i.F9(String(e))}}async get(e){let t;try{t=await this.db.get(this.#e(e))}catch(e){if(null!=e.notFound)throw new i.m_(String(e));throw new i.kR(String(e))}return t}async has(e){try{await this.db.get(this.#e(e))}catch(e){if(null!=e.notFound)return!1;throw e}return!0}async delete(e){try{await this.db.del(this.#e(e))}catch(e){throw new i.DI(String(e))}}async close(){await this.db.close()}async *getAll(e){for await(let{key:e,value:t}of this.#r({values:!0}))yield{cid:this.#t(e),block:t}}async *#r(e){let t={keys:!0,keyEncoding:"buffer",values:e.values};if(null!=e.prefix){let r=e.prefix.toString();t.gte=r,t.lt=r+"\xff"}let r=this.db.iterator(t);try{for await(let[e,t]of r)yield{key:new TextDecoder().decode(e),value:t}}finally{await r.close()}}}},30946:(e,t,r)=>{"use strict";r.r(t),r.d(t,{identity:()=>c});var n=r(70834),i=r(87704);let s=0,o="identity",a=n.coerce;function l(e){return i.create(s,a(e))}let c={code:s,name:o,encode:a,digest:l}},31102:function(e,t){!function(r,n){"use strict";var i={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function s(e){if(!Array.isArray(e)&&!ArrayBuffer.isView(e))return!1;for(var t=0;t<e.length;t++)if(!Number.isInteger(e[t])||e[t]<0||e[t]>255)return!1;return!0}function o(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function a(e,t){return e<<t|e>>>32-t}function l(e){return e^=e>>>16,e=o(e,0x85ebca6b),e^=e>>>13,e=o(e,0xc2b2ae35),e^=e>>>16}function c(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]+t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]+t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]+t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]+t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function u(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]*t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]*t[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=e[3]*t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]*t[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[2]*t[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[3]*t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function d(e,t){return 32==(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function h(e,t){return 0==(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function f(e,t){return[e[0]^t[0],e[1]^t[1]]}function p(e){return e=u(e=f(e,[0,e[0]>>>1]),[0xff51afd7,0xed558ccd]),e=u(e=f(e,[0,e[0]>>>1]),[0xc4ceb9fe,0x1a85ec53]),e=f(e,[0,e[0]>>>1])}i.x86.hash32=function(e,t){if(!i.inputValidation||s(e)){t=t||0;for(var r=e.length%4,n=e.length-r,c=t,u=0,d=0xcc9e2d51,h=0x1b873593,f=0;f<n;f+=4)u=a(u=o(u=e[f]|e[f+1]<<8|e[f+2]<<16|e[f+3]<<24,d),15),c^=u=o(u,h),c=o(c=a(c,13),5)+0xe6546b64;switch(u=0,r){case 3:u^=e[f+2]<<16;case 2:u^=e[f+1]<<8;case 1:u^=e[f],u=a(u=o(u,d),15),c^=u=o(u,h)}return c^=e.length,(c=l(c))>>>0}},i.x86.hash128=function(e,t){if(!i.inputValidation||s(e)){t=t||0;for(var r=e.length%16,n=e.length-r,c=t,u=t,d=t,h=t,f=0,p=0,g=0,m=0,y=0x239b961b,b=0xab0e9789,w=0x38b34ae5,v=0xa1e38b93,E=0;E<n;E+=16)f=e[E]|e[E+1]<<8|e[E+2]<<16|e[E+3]<<24,p=e[E+4]|e[E+5]<<8|e[E+6]<<16|e[E+7]<<24,g=e[E+8]|e[E+9]<<8|e[E+10]<<16|e[E+11]<<24,m=e[E+12]|e[E+13]<<8|e[E+14]<<16|e[E+15]<<24,f=a(f=o(f,y),15),c^=f=o(f,b),c=o(c=a(c,19)+u,5)+0x561ccd1b,p=a(p=o(p,b),16),u^=p=o(p,w),u=o(u=a(u,17)+d,5)+0xbcaa747,g=a(g=o(g,w),17),d^=g=o(g,v),d=o(d=a(d,15)+h,5)+0x96cd1c35,m=a(m=o(m,v),18),h^=m=o(m,y),h=o(h=a(h,13)+c,5)+0x32ac3b17;switch(f=0,p=0,g=0,m=0,r){case 15:m^=e[E+14]<<16;case 14:m^=e[E+13]<<8;case 13:m^=e[E+12],m=a(m=o(m,v),18),h^=m=o(m,y);case 12:g^=e[E+11]<<24;case 11:g^=e[E+10]<<16;case 10:g^=e[E+9]<<8;case 9:g^=e[E+8],g=a(g=o(g,w),17),d^=g=o(g,v);case 8:p^=e[E+7]<<24;case 7:p^=e[E+6]<<16;case 6:p^=e[E+5]<<8;case 5:p^=e[E+4],p=a(p=o(p,b),16),u^=p=o(p,w);case 4:f^=e[E+3]<<24;case 3:f^=e[E+2]<<16;case 2:f^=e[E+1]<<8;case 1:f^=e[E],f=a(f=o(f,y),15),c^=f=o(f,b)}return c^=e.length,u^=e.length,d^=e.length,h^=e.length,c+=u,c+=d,c+=h,u+=c,d+=c,h+=c,c=l(c),u=l(u),d=l(d),h=l(h),c+=u,c+=d,c+=h,u+=c,d+=c,h+=c,("00000000"+(c>>>0).toString(16)).slice(-8)+("00000000"+(u>>>0).toString(16)).slice(-8)+("00000000"+(d>>>0).toString(16)).slice(-8)+("00000000"+(h>>>0).toString(16)).slice(-8)}},i.x64.hash128=function(e,t){if(i.inputValidation&&!s(e))return n;t=t||0;for(var r=e.length%16,o=e.length-r,a=[0,t],l=[0,t],g=[0,0],m=[0,0],y=[0x87c37b91,0x114253d5],b=[0x4cf5ad43,0x2745937f],w=0;w<o;w+=16)g=[e[w+4]|e[w+5]<<8|e[w+6]<<16|e[w+7]<<24,e[w]|e[w+1]<<8|e[w+2]<<16|e[w+3]<<24],m=[e[w+12]|e[w+13]<<8|e[w+14]<<16|e[w+15]<<24,e[w+8]|e[w+9]<<8|e[w+10]<<16|e[w+11]<<24],g=d(g=u(g,y),31),a=c(a=d(a=f(a,g=u(g,b)),27),l),a=c(u(a,[0,5]),[0,0x52dce729]),m=d(m=u(m,b),33),l=c(l=d(l=f(l,m=u(m,y)),31),a),l=c(u(l,[0,5]),[0,0x38495ab5]);switch(g=[0,0],m=[0,0],r){case 15:m=f(m,h([0,e[w+14]],48));case 14:m=f(m,h([0,e[w+13]],40));case 13:m=f(m,h([0,e[w+12]],32));case 12:m=f(m,h([0,e[w+11]],24));case 11:m=f(m,h([0,e[w+10]],16));case 10:m=f(m,h([0,e[w+9]],8));case 9:m=d(m=u(m=f(m,[0,e[w+8]]),b),33),l=f(l,m=u(m,y));case 8:g=f(g,h([0,e[w+7]],56));case 7:g=f(g,h([0,e[w+6]],48));case 6:g=f(g,h([0,e[w+5]],40));case 5:g=f(g,h([0,e[w+4]],32));case 4:g=f(g,h([0,e[w+3]],24));case 3:g=f(g,h([0,e[w+2]],16));case 2:g=f(g,h([0,e[w+1]],8));case 1:g=d(g=u(g=f(g,[0,e[w]]),y),31),a=f(a,g=u(g,b))}return a=c(a=f(a,[0,e.length]),l=f(l,[0,e.length])),l=c(l,a),a=c(a=p(a),l=p(l)),l=c(l,a),("00000000"+(a[0]>>>0).toString(16)).slice(-8)+("00000000"+(a[1]>>>0).toString(16)).slice(-8)+("00000000"+(l[0]>>>0).toString(16)).slice(-8)+("00000000"+(l[1]>>>0).toString(16)).slice(-8)},e.exports&&(t=e.exports=i),t.murmurHash3=i}(0)},31133:(e,t,r)=>{"use strict";function n(){let e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e}r.d(t,{A:()=>n})},31467:e=>{"use strict";e.exports=RangeError},31588:(e,t,r)=>{e.exports=r(31102)},31987:(e,t,r)=>{"use strict";r.d(t,{U:()=>n.U});var n=r(86620)},33534:(e,t)=>{"use strict";t.getCallback=function(e,t){return"function"==typeof e?e:t},t.getOptions=function(e,t){return"object"==typeof e&&null!==e?e:void 0!==t?t:{}}},33771:e=>{"use strict";e.exports=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]},34269:(e,t,r)=>{"use strict";r.r(t),r.d(t,{code:()=>s,decode:()=>a,encode:()=>o,name:()=>i});var n=r(70834);let i="raw",s=85;function o(e){return(0,n.coerce)(e)}function a(e){return(0,n.coerce)(e)}},34378:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var n=r(12115),i=r(47650),s=r(63655),o=r(52712),a=r(95155),l="Portal",c=n.forwardRef((e,t)=>{var r,l;let{container:c,...u}=e,[d,h]=n.useState(!1);(0,o.N)(()=>h(!0),[]);let f=c||d&&(null==(l=globalThis)||null==(r=l.document)?void 0:r.body);return f?i.createPortal((0,a.jsx)(s.sG.div,{...u,ref:t}),f):null});c.displayName=l},34817:e=>{"use strict";e.exports=Math.pow},36362:(e,t,r)=>{"use strict";var n,i=r(91453),s=r(39781)(),o=r(41444),a=r(81954);if(s){var l=i("RegExp.prototype.exec"),c={},u=function(){throw c},d={toString:u,valueOf:u};"symbol"==typeof Symbol.toPrimitive&&(d[Symbol.toPrimitive]=u),n=function(e){if(!e||"object"!=typeof e)return!1;var t=a(e,"lastIndex");if(!(t&&o(t,"value")))return!1;try{l(e,d)}catch(e){return e===c}}}else{var h=i("Object.prototype.toString"),f="[object RegExp]";n=function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&h(e)===f}}e.exports=n},37703:(e,t,r)=>{"use strict";r.d(t,{O:()=>m});var n=r(46923),i=r(68250),s=r(67358),o=["debug","info","warn","error"],a="warn";function l(e){return o.indexOf(e)>=o.indexOf(a)}function c(e,t,r){if(l(t)){let n=new Date().toISOString();e(`[${n}] [${t.toUpperCase()}]`,...r)}}var u={setLevel(e){o.includes(e)&&(a=e)},debug(...e){c(console.debug,"debug",e)},info(...e){c(console.info,"info",e)},warn(...e){c(console.warn,"warn",e)},error(...e){c(console.error,"error",e)}};function d(e,t,r,n){return{id:crypto.randomUUID(),parentId:n||"",sender:e,senderAlias:t,message:r,timestamp:Date.now()}}function h(e){let t=JSON.parse(e);if(!f(t))throw u.error("Parsed object isn't a ChatMessage. Chat returned: ",t),Error("Parsed object isn't a ChatMessage");return t}function f(e){return"object"==typeof e&&null!==e&&"string"==typeof e.id&&"string"==typeof e.sender&&"string"==typeof e.senderAlias&&"string"==typeof e.message&&"number"==typeof e.timestamp}var p=class e{static async create(t,r,n,i){u.debug("Creating Chat...");let s=[];return(await n.getAllKeys()).includes(r)&&(u.info("Existing Chat found, getting messages..."),s=(await n.get(r)).map(e=>h(e)),u.info(`Found ${s.length} messages in existing Chat`)),new e(t,r,s,n,i)}constructor(e,t,r,n,i){this.chatSpace=e,this.chatName=t,this.astraDb=n,this.messages=r,i?this.listenToNewMessages(i):this.listenToNewMessages(e=>{})}getMessages(){return u.info(`Getting messages for ${this.chatName}`),this.messages.sort((e,t)=>e.timestamp-t.timestamp),this.messages}async sendMessage(e){u.info(`Sending message in ${this.chatName}: ${e}`),await this.astraDb.add(this.chatName,JSON.stringify(e))}listenToNewMessages(e){u.info(`Setting new callback for ${this.chatName}`),this.astraDb.events.on(`${this.chatSpace}::${this.chatName}`,t=>{let r=h(t);u.info("New message detected in callback: ",r.id),u.debug("Calling set callback..."),e(r)})}},g=class{constructor(e){this.chatSpace=e}async init(e){u.debug("Creating AstraDb..."),this.astraDb=await (0,s.W)({dbName:this.chatSpace,loginKey:e.loginKey,isCollaborator:e.isCollaborator,datastore:e.datastore,blockstore:e.blockstore,publicIp:e.publicIp,TcpPort:e.tcpPort,WSPort:e.wsPort,WSSPort:e.wssPort,dataDir:e.dataDir,offlineMode:e.offlineMode}),u.debug("AstraDb created"),e.alias||u.debug("No alias found, setting public key as alias"),this.alias=e.alias||this.astraDb.getLoginPublicKey()}async createChat(e,t){u.debug(`[${this.alias}] Creating chat...`);let r=await p.create(this.chatSpace,e,this.astraDb,t),n=d(this.getUserId(),this.alias,"Chat created");await r.sendMessage(n),u.debug(`[${this.alias}] Chat "${e}" created`)}async getMessages(e,t){u.info(`[${this.alias}] Getting messages from ${e}...`);let r=await p.create(this.chatSpace,e,this.astraDb,t);return u.debug(`[${this.alias}] Chat found, getting messages...`),r.getMessages()}async sendMessage(e,t,r){u.debug(`[${this.alias}] Sending message for ${e}...`);let n=await p.create(this.chatSpace,e,this.astraDb),i=d(this.getUserId(),this.alias,t,r);u.debug(`[${this.alias}] Sending message with ID ${i.id}`),await n.sendMessage(i),u.info(`[${this.alias}] Message with ID ${e} sent`)}async getChatList(){return u.info(`[${this.alias}] Getting chat list for ${this.chatSpace}`),await this.astraDb.getAllKeys()}getUserId(){return u.debug(`[${this.alias}] Getting user id...`),this.astraDb.getLoginPublicKey()}async getLoginKey(){return u.debug(`[${this.alias}] Getting logging key...`),await this.astraDb.getLoginPrivateKey()}getAlias(){return this.alias}setChatAlias(e){this.alias=e,u.info(`[${this.alias}] New alias set: ${e}`)}};async function m(e){e.chatSpace=e.chatSpace??"bitxenia-chat",e.alias=e.alias??"",e.loginKey=e.loginKey??"",e.isCollaborator=e.isCollaborator??!1,e.datastore=e.datastore??new i.bk,e.blockstore=e.blockstore??new n.ED,e.publicIp=e.publicIp??"0.0.0.0",e.tcpPort=e.tcpPort??50001,e.wsPort=e.wsPort??50002,e.wssPort=e.wssPort??50003,e.dataDir=e.dataDir??"./data/astrachat",e.offlineMode=e.offlineMode??!1,e.logLevel&&u.setLevel(e.logLevel),u.info("Creating Astrachat node...");let t=new g(e.chatSpace);return await t.init(e),u.info("Astrachat node created & initialized"),t}},38168:(e,t,r)=>{"use strict";r.d(t,{Eq:()=>d});var n=function(e){return"undefined"==typeof document?null:(Array.isArray(e)?e[0]:e).ownerDocument.body},i=new WeakMap,s=new WeakMap,o={},a=0,l=function(e){return e&&(e.host||l(e.parentNode))},c=function(e,t){return t.map(function(t){if(e.contains(t))return t;var r=l(t);return r&&e.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",e,". Doing nothing"),null)}).filter(function(e){return!!e})},u=function(e,t,r,n){var l=c(t,Array.isArray(e)?e:[e]);o[r]||(o[r]=new WeakMap);var u=o[r],d=[],h=new Set,f=new Set(l),p=function(e){!e||h.has(e)||(h.add(e),p(e.parentNode))};l.forEach(p);var g=function(e){!e||f.has(e)||Array.prototype.forEach.call(e.children,function(e){if(h.has(e))g(e);else try{var t=e.getAttribute(n),o=null!==t&&"false"!==t,a=(i.get(e)||0)+1,l=(u.get(e)||0)+1;i.set(e,a),u.set(e,l),d.push(e),1===a&&o&&s.set(e,!0),1===l&&e.setAttribute(r,"true"),o||e.setAttribute(n,"true")}catch(t){console.error("aria-hidden: cannot operate on ",e,t)}})};return g(t),h.clear(),a++,function(){d.forEach(function(e){var t=i.get(e)-1,o=u.get(e)-1;i.set(e,t),u.set(e,o),t||(s.has(e)||e.removeAttribute(n),s.delete(e)),o||e.removeAttribute(r)}),--a||(i=new WeakMap,i=new WeakMap,s=new WeakMap,o={})}},d=function(e,t,r){void 0===r&&(r="data-aria-hidden");var i=Array.from(Array.isArray(e)?e:[e]),s=t||n(e);return s?(i.push.apply(i,Array.from(s.querySelectorAll("[aria-live]"))),u(i,s,r,"aria-hidden")):function(){return null}}},38541:(e,t)=>{"use strict";t.supports=function(...e){let t=e.reduce((e,t)=>Object.assign(e,t),{});return Object.assign(t,{snapshots:t.snapshots||!1,permanence:t.permanence||!1,seek:t.seek||!1,clear:t.clear||!1,getMany:t.getMany||!1,keyIterator:t.keyIterator||!1,valueIterator:t.valueIterator||!1,iteratorNextv:t.iteratorNextv||!1,iteratorAll:t.iteratorAll||!1,status:t.status||!1,createIfMissing:t.createIfMissing||!1,errorIfExists:t.errorIfExists||!1,deferredOpen:t.deferredOpen||!1,promises:t.promises||!1,streams:t.streams||!1,encodings:Object.assign({},t.encodings),events:Object.assign({},t.events),additionalMethods:Object.assign({},t.additionalMethods)})}},39070:(e,t,r)=>{"use strict";let{fromCallback:n}=r(82813),i=r(7800),{getOptions:s,getCallback:o}=r(33534),a=Symbol("promise"),l=Symbol("callback"),c=Symbol("working"),u=Symbol("handleOne"),d=Symbol("handleMany"),h=Symbol("autoClose"),f=Symbol("finishWork"),p=Symbol("returnMany"),g=Symbol("closing"),m=Symbol("handleClose"),y=Symbol("closed"),b=Symbol("closeCallbacks"),w=Symbol("keyEncoding"),v=Symbol("valueEncoding"),E=Symbol("abortOnClose"),A=Symbol("legacy"),x=Symbol("keys"),S=Symbol("values"),k=Symbol("limit"),_=Symbol("count"),I=Object.freeze({}),T=()=>{},C=!1;class P{constructor(e,t,r){if("object"!=typeof e||null===e){let t=null===e?"null":typeof e;throw TypeError(`The first argument must be an abstract-level database, received ${t}`)}if("object"!=typeof t||null===t)throw TypeError("The second argument must be an options object");this[y]=!1,this[b]=[],this[c]=!1,this[g]=!1,this[h]=!1,this[l]=null,this[u]=this[u].bind(this),this[d]=this[d].bind(this),this[m]=this[m].bind(this),this[w]=t[w],this[v]=t[v],this[A]=r,this[k]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[_]=0,this[E]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[_]}get limit(){return this[k]}next(e){let t;if(void 0===e)t=new Promise((t,r)=>{e=(e,n,i)=>{e?r(e):this[A]?void 0===n&&void 0===i?t():t([n,i]):t(n)}});else if("function"!=typeof e)throw TypeError("Callback must be a function");return this[g]?this.nextTick(e,new i("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[c]?this.nextTick(e,new i("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[c]=!0,this[l]=e,this[_]>=this[k]?this.nextTick(this[u],null):this._next(this[u])),t}_next(e){this.nextTick(e)}nextv(e,t,r){return(r=n(r=o(t,r),a),t=s(t,I),Number.isInteger(e))?this[g]?this.nextTick(r,new i("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[c]?this.nextTick(r,new i("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[k]<1/0&&(e=Math.min(e,this[k]-this[_])),this[c]=!0,this[l]=r,e<=0?this.nextTick(this[d],null,[]):this._nextv(e,t,this[d])):this.nextTick(r,TypeError("The first argument 'size' must be an integer")),r[a]}_nextv(e,t,r){let n=[],i=(t,s,o)=>t?r(t):(this[A]?void 0===s&&void 0===o:void 0===s)?r(null,n):void(n.push(this[A]?[s,o]:s),n.length===e?r(null,n):this._next(i));this._next(i)}all(e,t){return t=n(t=o(e,t),a),e=s(e,I),this[g]?this.nextTick(t,new i("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[c]?this.nextTick(t,new i("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[c]=!0,this[l]=t,this[h]=!0,this[_]>=this[k]?this.nextTick(this[d],null,[]):this._all(e,this[d])),t[a]}_all(e,t){let r=this[_],n=[],i=()=>{let e=this[k]<1/0?Math.min(1e3,this[k]-r):1e3;e<=0?this.nextTick(t,null,n):this._nextv(e,I,s)},s=(e,s)=>{e?t(e):0===s.length?t(null,n):(n.push.apply(n,s),r+=s.length,i())};i()}[f](){let e=this[l];return this[E]&&null===e?T:(this[c]=!1,this[l]=null,this[g]&&this._close(this[m]),e)}[p](e,t,r){this[h]?this.close(e.bind(null,t,r)):e(t,r)}seek(e,t){if(t=s(t,I),this[g]);else if(this[c])throw new i("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});else{let r=this.db.keyEncoding(t.keyEncoding||this[w]),n=r.format;t.keyEncoding!==n&&(t={...t,keyEncoding:n});let i=this.db.prefixKey(r.encode(e),n);this._seek(i,t)}}_seek(e,t){throw new i("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){return e=n(e,a),this[y]?this.nextTick(e):this[g]?this[b].push(e):(this[g]=!0,this[b].push(e),this[c]?this[E]&&this[f]()(new i("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[m])),e[a]}_close(e){this.nextTick(e)}[m](){this[y]=!0,this.db.detachResource(this);let e=this[b];for(let t of(this[b]=[],e))t()}async *[Symbol.asyncIterator](){try{let e;for(;void 0!==(e=await this.next());)yield e}finally{this[y]||await this.close()}}}class R extends P{constructor(e,t){super(e,t,!0),this[x]=!1!==t.keys,this[S]=!1!==t.values}[u](e,t,r){let n=this[f]();if(e)return n(e);try{t=this[x]&&void 0!==t?this[w].decode(t):void 0,r=this[S]&&void 0!==r?this[v].decode(r):void 0}catch(e){return n(new M("entry",e))}(void 0!==t||void 0!==r)&&this[_]++,n(null,t,r)}[d](e,t){let r=this[f]();if(e)return this[p](r,e);try{for(let e of t){let t=e[0],r=e[1];e[0]=this[x]&&void 0!==t?this[w].decode(t):void 0,e[1]=this[S]&&void 0!==r?this[v].decode(r):void 0}}catch(e){return this[p](r,new M("entries",e))}this[_]+=t.length,this[p](r,null,t)}end(e){return C||"undefined"==typeof console||(C=!0,console.warn(new i("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}}class D extends P{constructor(e,t){super(e,t,!1)}[u](e,t){let r=this[f]();if(e)return r(e);try{t=void 0!==t?this[w].decode(t):void 0}catch(e){return r(new M("key",e))}void 0!==t&&this[_]++,r(null,t)}[d](e,t){let r=this[f]();if(e)return this[p](r,e);try{for(let e=0;e<t.length;e++){let r=t[e];t[e]=void 0!==r?this[w].decode(r):void 0}}catch(e){return this[p](r,new M("keys",e))}this[_]+=t.length,this[p](r,null,t)}}class N extends P{constructor(e,t){super(e,t,!1)}[u](e,t){let r=this[f]();if(e)return r(e);try{t=void 0!==t?this[v].decode(t):void 0}catch(e){return r(new M("value",e))}void 0!==t&&this[_]++,r(null,t)}[d](e,t){let r=this[f]();if(e)return this[p](r,e);try{for(let e=0;e<t.length;e++){let r=t[e];t[e]=void 0!==r?this[v].decode(r):void 0}}catch(e){return this[p](r,new M("values",e))}this[_]+=t.length,this[p](r,null,t)}}class M extends i{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}}for(let e of["_ended property","_nexting property","_end method"])Object.defineProperty(R.prototype,e.split(" ")[0],{get(){throw new i(`The ${e} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new i(`The ${e} has been removed`,{code:"LEVEL_LEGACY"})}});R.keyEncoding=w,R.valueEncoding=v,t.AbstractIterator=R,t.AbstractKeyIterator=D,t.AbstractValueIterator=N},39781:(e,t,r)=>{"use strict";var n=r(68852);e.exports=function(){return n()&&!!Symbol.toStringTag}},40463:(e,t)=>{var r;!function(e){"undefined"==typeof DO_NOT_EXPORT_CRC?e(t):e(r={})}(function(e){e.version="1.2.2";var t=function(){for(var e=0,t=Array(256),r=0;256!=r;++r)e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=r)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1,t[r]=e;return"undefined"!=typeof Int32Array?new Int32Array(t):t}(),r=function(e){var t=0,r=0,n=0,i="undefined"!=typeof Int32Array?new Int32Array(4096):Array(4096);for(n=0;256!=n;++n)i[n]=e[n];for(n=0;256!=n;++n)for(r=e[n],t=256+n;t<4096;t+=256)r=i[t]=r>>>8^e[255&r];var s=[];for(n=1;16!=n;++n)s[n-1]="undefined"!=typeof Int32Array?i.subarray(256*n,256*n+256):i.slice(256*n,256*n+256);return s}(t),n=r[0],i=r[1],s=r[2],o=r[3],a=r[4],l=r[5],c=r[6],u=r[7],d=r[8],h=r[9],f=r[10],p=r[11],g=r[12],m=r[13],y=r[14];function b(e,r){for(var n=-1^r,i=0,s=e.length;i<s;)n=n>>>8^t[(n^e.charCodeAt(i++))&255];return~n}function w(e,r){for(var b=-1^r,w=e.length-15,v=0;v<w;)b=y[e[v++]^255&b]^m[e[v++]^b>>8&255]^g[e[v++]^b>>16&255]^p[e[v++]^b>>>24]^f[e[v++]]^h[e[v++]]^d[e[v++]]^u[e[v++]]^c[e[v++]]^l[e[v++]]^a[e[v++]]^o[e[v++]]^s[e[v++]]^i[e[v++]]^n[e[v++]]^t[e[v++]];for(w+=15;v<w;)b=b>>>8^t[(b^e[v++])&255];return~b}function v(e,r){for(var n=-1^r,i=0,s=e.length,o=0,a=0;i<s;)(o=e.charCodeAt(i++))<128?n=n>>>8^t[(n^o)&255]:o<2048?n=(n=n>>>8^t[(n^(192|o>>6&31))&255])>>>8^t[(n^(128|63&o))&255]:o>=55296&&o<57344?(o=(1023&o)+64,a=1023&e.charCodeAt(i++),n=(n=(n=(n=n>>>8^t[(n^(240|o>>8&7))&255])>>>8^t[(n^(128|o>>2&63))&255])>>>8^t[(n^(128|a>>6&15|(3&o)<<4))&255])>>>8^t[(n^(128|63&a))&255]):n=(n=(n=n>>>8^t[(n^(224|o>>12&15))&255])>>>8^t[(n^(128|o>>6&63))&255])>>>8^t[(n^(128|63&o))&255];return~n}e.table=t,e.bstr=b,e.buf=w,e.str=v})},40662:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};function i(e){console&&console.warn&&console.warn(e)}t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=b,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function l(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function u(e,t,r,n){if(l(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),a=o[t]),void 0===a)a=o[t]=r,++e._eventsCount;else if("function"==typeof a?a=o[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(s=c(e))>0&&a.length>s&&!a.warned){a.warned=!0;var s,o,a,u=Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,i(u)}return e}function d(){if(!this.fired)return(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length)?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=d.bind(n);return i.listener=r,n.wrapFn=i,i}function f(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?y(i):g(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=Array(t),n=0;n<t;++n)r[n]=e[n];return r}function m(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function y(e){for(var t=Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function b(e,t){return new Promise(function(r,n){function i(r){e.removeListener(t,s),n(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}v(e,t,s,{once:!0}),"error"!==t&&w(e,i,{once:!0})})}function w(e,t,r){"function"==typeof e.on&&v(e,"error",t,r)}function v(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else if("function"==typeof e.addEventListener)e.addEventListener(t,function i(s){n.once&&e.removeEventListener(t,i),r(s)});else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||s(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),o.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,s=this._events;if(void 0!==s)i=i&&void 0===s.error;else if(!i)return!1;if(i){if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var o,a=Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=s[e];if(void 0===l)return!1;if("function"==typeof l)n(l,this,t);else for(var c=l.length,u=g(l,c),r=0;r<c;++r)n(u[r],this,t);return!0},o.prototype.addListener=function(e,t){return u(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return u(this,e,t,!0)},o.prototype.once=function(e,t){return l(t),this.on(e,h(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,h(this,e,t)),this},o.prototype.removeListener=function(e,t){var r,n,i,s,o;if(l(t),void 0===(n=this._events)||void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;0===i?r.shift():m(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0==arguments.length){var i,s=Object.keys(r);for(n=0;n<s.length;++n)"removeListener"!==(i=s[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},o.prototype.listeners=function(e){return f(this,e,!0)},o.prototype.rawListeners=function(e){return f(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},40944:(e,t)=>{"use strict";var r;function n(e){if(Array.isArray(e)){let t=[],r=0;for(let i=0;i<e.length;i++){let s=n(e[i]);t.push(s),r+=s.length}return f(o(r,192),...t)}let t=w(e);return 1===t.length&&t[0]<128?t:f(o(t.length,128),t)}function i(e,t,r){if(r>e.length)throw Error("invalid RLP (safeSlice): end slice of Uint8Array out-of-bounds");return e.slice(t,r)}function s(e){if(0===e[0])throw Error("invalid RLP: extra zeros");return d(u(e))}function o(e,t){if(e<56)return Uint8Array.from([e+t]);let r=g(e),n=g(t+55+r.length/2);return Uint8Array.from(h(n+r))}function a(e,t=!1){if(null==e||0===e.length)return Uint8Array.from([]);let r=l(w(e));if(t)return r;if(0!==r.remainder.length)throw Error("invalid RLP: remainder must be zero");return r.data}function l(e){let t,r,n,o,a,c=[],u=e[0];if(u<=127)return{data:e.slice(0,1),remainder:e.slice(1)};if(u<=183){if(t=u-127,n=128===u?Uint8Array.from([]):i(e,1,t),2===t&&n[0]<128)throw Error("invalid RLP encoding: invalid prefix, single byte < 0x80 are not prefixed");return{data:n,remainder:e.slice(t)}}if(u<=191){if(r=u-182,e.length-1<r)throw Error("invalid RLP: not enough bytes for string length");if((t=s(i(e,1,r)))<=55)throw Error("invalid RLP: expected string length to be greater than 55");return{data:n=i(e,r,t+r),remainder:e.slice(t+r)}}if(u<=247){for(o=i(e,1,t=u-191);o.length;)a=l(o),c.push(a.data),o=a.remainder;return{data:c,remainder:e.slice(t)}}{if((t=s(i(e,1,r=u-246)))<56)throw Error("invalid RLP: encoded list too short");let n=r+t;if(n>e.length)throw Error("invalid RLP: total length is larger than the data");for(o=i(e,r,n);o.length;)a=l(o),c.push(a.data),o=a.remainder;return{data:c,remainder:e.slice(n)}}}r={value:!0},t.Tj=r=r=r=void 0,r=n,r=a;let c=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function u(e){let t="";for(let r=0;r<e.length;r++)t+=c[e[r]];return t}function d(e){let t=Number.parseInt(e,16);if(Number.isNaN(t))throw Error("Invalid byte sequence");return t}function h(e){if("string"!=typeof e)throw TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw Error("hexToBytes: received invalid unpadded hex");let t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){let n=2*r;t[r]=d(e.slice(n,n+2))}return t}function f(...e){if(1===e.length)return e[0];let t=new Uint8Array(e.reduce((e,t)=>e+t.length,0));for(let r=0,n=0;r<e.length;r++){let i=e[r];t.set(i,n),n+=i.length}return t}function p(e){return new TextEncoder().encode(e)}function g(e){if(e<0)throw Error("Invalid integer as argument, must be unsigned!");let t=e.toString(16);return t.length%2?`0${t}`:t}function m(e){return e.length%2?`0${e}`:e}function y(e){return e.length>=2&&"0"===e[0]&&"x"===e[1]}function b(e){return"string"!=typeof e?e:y(e)?e.slice(2):e}function w(e){if(e instanceof Uint8Array)return e;if("string"==typeof e)return y(e)?h(m(b(e))):p(e);if("number"==typeof e||"bigint"==typeof e)return e?h(g(e)):Uint8Array.from([]);if(null==e)return Uint8Array.from([]);throw Error("toBytes: received unsupported type "+typeof e)}r={bytesToHex:u,concatBytes:f,hexToBytes:h,utf8ToBytes:p},t.Tj={encode:n,decode:a}},41394:(e,t,r)=>{"use strict";r.d(t,{D4:()=>v,s_:()=>E,OY:()=>A});var n=128,i=-128,s=0x80000000;function o(e,t,r){t=t||[];for(var a=r=r||0;e>=s;)t[r++]=255&e|n,e/=128;for(;e&i;)t[r++]=255&e|n,e>>>=7;return t[r]=0|e,o.bytes=r-a+1,t}var a=128,l=127;function c(e,t){var r,n=0,t=t||0,i=0,s=t,o=e.length;do{if(s>=o)throw c.bytes=0,RangeError("Could not decode varint");r=e[s++],n+=i<28?(r&l)<<i:(r&l)*Math.pow(2,i),i+=7}while(r>=a);return c.bytes=s-t,n}var u=128,d=16384,h=2097152,f=0x10000000,p=0x800000000,g=0x40000000000,m=0x2000000000000,y=0x100000000000000,b=0x8000000000000000;let w={encode:o,decode:c,encodingLength:function(e){return e<u?1:e<d?2:e<h?3:e<f?4:e<p?5:e<g?6:e<m?7:e<y?8:e<b?9:10}};function v(e,t=0){return[w.decode(e,t),w.decode.bytes]}function E(e,t,r=0){return w.encode(e,t,r),t}function A(e){return w.encodingLength(e)}},41444:(e,t,r)=>{"use strict";var n=Function.prototype.call,i=Object.prototype.hasOwnProperty;e.exports=r(52430).call(n,i)},41472:(e,t,r)=>{"use strict";r.r(t),r.d(t,{base36:()=>i,base36upper:()=>s});var n=r(52215);let i=(0,n._Q)({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),s=(0,n._Q)({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})},41878:(e,t,r)=>{"use strict";var n=r(12588),i=r(52103);e.exports=n.bind(null,i)},42066:e=>{"use strict";e.exports=Number.isNaN||function(e){return e!=e}},42406:(e,t,r)=>{"use strict";let n,i,s;r.d(t,{S:()=>rf});var o={};function a(e,t){return function(){return e.apply(t,arguments)}}r.r(o),r.d(o,{hasBrowserEnv:()=>eF,hasStandardBrowserEnv:()=>ej,hasStandardBrowserWebWorkerEnv:()=>eH,navigator:()=>eU,origin:()=>e$});var l=r(49509);let{toString:c}=Object.prototype,{getPrototypeOf:u}=Object,{iterator:d,toStringTag:h}=Symbol,f=(e=>t=>{let r=c.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),p=e=>(e=e.toLowerCase(),t=>f(t)===e),g=e=>t=>typeof t===e,{isArray:m}=Array,y=g("undefined");function b(e){return null!==e&&!y(e)&&null!==e.constructor&&!y(e.constructor)&&A(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}let w=p("ArrayBuffer");function v(e){let t;return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&w(e.buffer)}let E=g("string"),A=g("function"),x=g("number"),S=e=>null!==e&&"object"==typeof e,k=e=>!0===e||!1===e,_=e=>{if("object"!==f(e))return!1;let t=u(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(h in e)&&!(d in e)},I=p("Date"),T=p("File"),C=p("Blob"),P=p("FileList"),R=e=>S(e)&&A(e.pipe),D=e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||A(e.append)&&("formdata"===(t=f(e))||"object"===t&&A(e.toString)&&"[object FormData]"===e.toString()))},N=p("URLSearchParams"),[M,B,O,L]=["ReadableStream","Request","Response","Headers"].map(p),F=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function U(e,t,{allOwnKeys:r=!1}={}){let n,i;if(null!=e)if("object"!=typeof e&&(e=[e]),m(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{let i,s=r?Object.getOwnPropertyNames(e):Object.keys(e),o=s.length;for(n=0;n<o;n++)i=s[n],t.call(null,e[i],i,e)}}function j(e,t){let r;t=t.toLowerCase();let n=Object.keys(e),i=n.length;for(;i-- >0;)if(t===(r=n[i]).toLowerCase())return r;return null}let H="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,$=e=>!y(e)&&e!==H;function q(){let{caseless:e}=$(this)&&this||{},t={},r=(r,n)=>{let i=e&&j(t,n)||n;_(t[i])&&_(r)?t[i]=q(t[i],r):_(r)?t[i]=q({},r):m(r)?t[i]=r.slice():t[i]=r};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&U(arguments[e],r);return t}let z=(e,t,r,{allOwnKeys:n}={})=>(U(t,(t,n)=>{r&&A(t)?e[n]=a(t,r):e[n]=t},{allOwnKeys:n}),e),V=e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),G=(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},K=(e,t,r,n)=>{let i,s,o,a={};if(t=t||{},null==e)return t;do{for(s=(i=Object.getOwnPropertyNames(e)).length;s-- >0;)o=i[s],(!n||n(o,e,t))&&!a[o]&&(t[o]=e[o],a[o]=!0);e=!1!==r&&u(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},W=(e,t,r)=>{e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;let n=e.indexOf(t,r);return -1!==n&&n===r},Q=e=>{if(!e)return null;if(m(e))return e;let t=e.length;if(!x(t))return null;let r=Array(t);for(;t-- >0;)r[t]=e[t];return r},J=(e=>t=>e&&t instanceof e)("undefined"!=typeof Uint8Array&&u(Uint8Array)),Z=(e,t)=>{let r,n=(e&&e[d]).call(e);for(;(r=n.next())&&!r.done;){let n=r.value;t.call(e,n[0],n[1])}},Y=(e,t)=>{let r,n=[];for(;null!==(r=e.exec(t));)n.push(r);return n},X=p("HTMLFormElement"),ee=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,r){return t.toUpperCase()+r}),et=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),er=p("RegExp"),en=(e,t)=>{let r=Object.getOwnPropertyDescriptors(e),n={};U(r,(r,i)=>{let s;!1!==(s=t(r,i,e))&&(n[i]=s||r)}),Object.defineProperties(e,n)},ei=e=>{en(e,(t,r)=>{if(A(e)&&-1!==["arguments","caller","callee"].indexOf(r))return!1;if(A(e[r])){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},es=(e,t)=>{let r={};return(e=>{e.forEach(e=>{r[e]=!0})})(m(e)?e:String(e).split(t)),r},eo=()=>{},ea=(e,t)=>null!=e&&Number.isFinite(e*=1)?e:t;function el(e){return!!(e&&A(e.append)&&"FormData"===e[h]&&e[d])}let ec=e=>{let t=Array(10),r=(e,n)=>{if(S(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;let i=m(e)?[]:{};return U(e,(e,t)=>{let s=r(e,n+1);y(s)||(i[t]=s)}),t[n]=void 0,i}}return e};return r(e,0)},eu=p("AsyncFunction"),ed=e=>e&&(S(e)||A(e))&&A(e.then)&&A(e.catch),eh=(i="function"==typeof setImmediate,s=A(H.postMessage),i?setImmediate:s?((e,t)=>(H.addEventListener("message",({source:r,data:n})=>{r===H&&n===e&&t.length&&t.shift()()},!1),r=>{t.push(r),H.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e)),ef="undefined"!=typeof queueMicrotask?queueMicrotask.bind(H):void 0!==l&&l.nextTick||eh,ep=e=>null!=e&&A(e[d]),eg={isArray:m,isArrayBuffer:w,isBuffer:b,isFormData:D,isArrayBufferView:v,isString:E,isNumber:x,isBoolean:k,isObject:S,isPlainObject:_,isReadableStream:M,isRequest:B,isResponse:O,isHeaders:L,isUndefined:y,isDate:I,isFile:T,isBlob:C,isRegExp:er,isFunction:A,isStream:R,isURLSearchParams:N,isTypedArray:J,isFileList:P,forEach:U,merge:q,extend:z,trim:F,stripBOM:V,inherits:G,toFlatObject:K,kindOf:f,kindOfTest:p,endsWith:W,toArray:Q,forEachEntry:Z,matchAll:Y,isHTMLForm:X,hasOwnProperty:et,hasOwnProp:et,reduceDescriptors:en,freezeMethods:ei,toObjectSet:es,toCamelCase:ee,noop:eo,toFiniteNumber:ea,findKey:j,global:H,isContextDefined:$,isSpecCompliantForm:el,toJSONObject:ec,isAsyncFn:eu,isThenable:ed,setImmediate:eh,asap:ef,isIterable:ep};function em(e,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}eg.inherits(em,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:eg.toJSONObject(this.config),code:this.code,status:this.status}}});let ey=em.prototype,eb={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{eb[e]={value:e}}),Object.defineProperties(em,eb),Object.defineProperty(ey,"isAxiosError",{value:!0}),em.from=(e,t,r,n,i,s)=>{let o=Object.create(ey);return eg.toFlatObject(e,o,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),em.call(o,e.message,t,r,n,i),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};let ew=em,ev=null;var eE=r(44134).Buffer;function eA(e){return eg.isPlainObject(e)||eg.isArray(e)}function ex(e){return eg.endsWith(e,"[]")?e.slice(0,-2):e}function eS(e,t,r){return e?e.concat(t).map(function(e,t){return e=ex(e),!r&&t?"["+e+"]":e}).join(r?".":""):t}function ek(e){return eg.isArray(e)&&!e.some(eA)}let e_=eg.toFlatObject(eg,{},null,function(e){return/^is[A-Z]/.test(e)}),eI=function(e,t,r){if(!eg.isObject(e))throw TypeError("target must be an object");t=t||new(ev||FormData);let n=(r=eg.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!eg.isUndefined(t[e])})).metaTokens,i=r.visitor||c,s=r.dots,o=r.indexes,a=(r.Blob||"undefined"!=typeof Blob&&Blob)&&eg.isSpecCompliantForm(t);if(!eg.isFunction(i))throw TypeError("visitor must be a function");function l(e){if(null===e)return"";if(eg.isDate(e))return e.toISOString();if(!a&&eg.isBlob(e))throw new ew("Blob is not supported. Use a Buffer instead.");return eg.isArrayBuffer(e)||eg.isTypedArray(e)?a&&"function"==typeof Blob?new Blob([e]):eE.from(e):e}function c(e,r,i){let a=e;if(e&&!i&&"object"==typeof e){if(eg.endsWith(r,"{}"))r=n?r:r.slice(0,-2),e=JSON.stringify(e);else if(eg.isArray(e)&&ek(e)||(eg.isFileList(e)||eg.endsWith(r,"[]"))&&(a=eg.toArray(e)))return r=ex(r),a.forEach(function(e,n){eg.isUndefined(e)||null===e||t.append(!0===o?eS([r],n,s):null===o?r:r+"[]",l(e))}),!1}return!!eA(e)||(t.append(eS(i,r,s),l(e)),!1)}let u=[],d=Object.assign(e_,{defaultVisitor:c,convertValue:l,isVisitable:eA});function h(e,r){if(!eg.isUndefined(e)){if(-1!==u.indexOf(e))throw Error("Circular reference detected in "+r.join("."));u.push(e),eg.forEach(e,function(e,n){!0===(!(eg.isUndefined(e)||null===e)&&i.call(t,e,eg.isString(n)?n.trim():n,r,d))&&h(e,r?r.concat(n):[n])}),u.pop()}}if(!eg.isObject(e))throw TypeError("data must be an object");return h(e),t};function eT(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function eC(e,t){this._pairs=[],e&&eI(e,this,t)}let eP=eC.prototype;eP.append=function(e,t){this._pairs.push([e,t])},eP.toString=function(e){let t=e?function(t){return e.call(this,t,eT)}:eT;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};let eR=eC;function eD(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function eN(e,t,r){let n;if(!t)return e;let i=r&&r.encode||eD;eg.isFunction(r)&&(r={serialize:r});let s=r&&r.serialize;if(n=s?s(t,r):eg.isURLSearchParams(t)?t.toString():new eR(t,r).toString(i)){let t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}class eM{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){eg.forEach(this.handlers,function(t){null!==t&&e(t)})}}let eB=eM,eO={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},eL={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:eR,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},eF="undefined"!=typeof window&&"undefined"!=typeof document,eU="object"==typeof navigator&&navigator||void 0,ej=eF&&(!eU||0>["ReactNative","NativeScript","NS"].indexOf(eU.product)),eH="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,e$=eF&&window.location.href||"http://localhost",eq={...o,...eL};function ez(e,t){return eI(e,new eq.classes.URLSearchParams,Object.assign({visitor:function(e,t,r,n){return eq.isNode&&eg.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}function eV(e){return eg.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}function eG(e){let t,r,n={},i=Object.keys(e),s=i.length;for(t=0;t<s;t++)n[r=i[t]]=e[r];return n}let eK=function(e){function t(e,r,n,i){let s=e[i++];if("__proto__"===s)return!0;let o=Number.isFinite(+s),a=i>=e.length;return(s=!s&&eg.isArray(n)?n.length:s,a)?eg.hasOwnProp(n,s)?n[s]=[n[s],r]:n[s]=r:(n[s]&&eg.isObject(n[s])||(n[s]=[]),t(e,r,n[s],i)&&eg.isArray(n[s])&&(n[s]=eG(n[s]))),!o}if(eg.isFormData(e)&&eg.isFunction(e.entries)){let r={};return eg.forEachEntry(e,(e,n)=>{t(eV(e),n,r,0)}),r}return null};function eW(e,t,r){if(eg.isString(e))try{return(t||JSON.parse)(e),eg.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(e)}let eQ={transitional:eO,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){let r,n=t.getContentType()||"",i=n.indexOf("application/json")>-1,s=eg.isObject(e);if(s&&eg.isHTMLForm(e)&&(e=new FormData(e)),eg.isFormData(e))return i?JSON.stringify(eK(e)):e;if(eg.isArrayBuffer(e)||eg.isBuffer(e)||eg.isStream(e)||eg.isFile(e)||eg.isBlob(e)||eg.isReadableStream(e))return e;if(eg.isArrayBufferView(e))return e.buffer;if(eg.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return ez(e,this.formSerializer).toString();if((r=eg.isFileList(e))||n.indexOf("multipart/form-data")>-1){let t=this.env&&this.env.FormData;return eI(r?{"files[]":e}:e,t&&new t,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),eW(e)):e}],transformResponse:[function(e){let t=this.transitional||eQ.transitional,r=t&&t.forcedJSONParsing,n="json"===this.responseType;if(eg.isResponse(e)||eg.isReadableStream(e))return e;if(e&&eg.isString(e)&&(r&&!this.responseType||n)){let r=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(e){if(r){if("SyntaxError"===e.name)throw ew.from(e,ew.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:eq.classes.FormData,Blob:eq.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};eg.forEach(["delete","get","head","post","put","patch"],e=>{eQ.headers[e]={}});let eJ=eQ,eZ=eg.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),eY=e=>{let t,r,n,i={};return e&&e.split("\n").forEach(function(e){n=e.indexOf(":"),t=e.substring(0,n).trim().toLowerCase(),r=e.substring(n+1).trim(),!t||i[t]&&eZ[t]||("set-cookie"===t?i[t]?i[t].push(r):i[t]=[r]:i[t]=i[t]?i[t]+", "+r:r)}),i},eX=Symbol("internals");function e0(e){return e&&String(e).trim().toLowerCase()}function e1(e){return!1===e||null==e?e:eg.isArray(e)?e.map(e1):String(e)}function e2(e){let t,r=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;for(;t=n.exec(e);)r[t[1]]=t[2];return r}let e3=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function e4(e,t,r,n,i){if(eg.isFunction(n))return n.call(this,t,r);if(i&&(t=r),eg.isString(t)){if(eg.isString(n))return -1!==t.indexOf(n);if(eg.isRegExp(n))return n.test(t)}}function e5(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function e6(e,t){let r=eg.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(e,r,i){return this[n].call(this,t,e,r,i)},configurable:!0})})}class e8{constructor(e){e&&this.set(e)}set(e,t,r){let n=this;function i(e,t,r){let i=e0(t);if(!i)throw Error("header name must be a non-empty string");let s=eg.findKey(n,i);s&&void 0!==n[s]&&!0!==r&&(void 0!==r||!1===n[s])||(n[s||t]=e1(e))}let s=(e,t)=>eg.forEach(e,(e,r)=>i(e,r,t));if(eg.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(eg.isString(e)&&(e=e.trim())&&!e3(e))s(eY(e),t);else if(eg.isObject(e)&&eg.isIterable(e)){let r={},n,i;for(let t of e){if(!eg.isArray(t))throw TypeError("Object iterator must return a key-value pair");r[i=t[0]]=(n=r[i])?eg.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}s(r,t)}else null!=e&&i(t,e,r);return this}get(e,t){if(e=e0(e)){let r=eg.findKey(this,e);if(r){let e=this[r];if(!t)return e;if(!0===t)return e2(e);if(eg.isFunction(t))return t.call(this,e,r);if(eg.isRegExp(t))return t.exec(e);throw TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=e0(e)){let r=eg.findKey(this,e);return!!(r&&void 0!==this[r]&&(!t||e4(this,this[r],r,t)))}return!1}delete(e,t){let r=this,n=!1;function i(e){if(e=e0(e)){let i=eg.findKey(r,e);i&&(!t||e4(r,r[i],i,t))&&(delete r[i],n=!0)}}return eg.isArray(e)?e.forEach(i):i(e),n}clear(e){let t=Object.keys(this),r=t.length,n=!1;for(;r--;){let i=t[r];(!e||e4(this,this[i],i,e,!0))&&(delete this[i],n=!0)}return n}normalize(e){let t=this,r={};return eg.forEach(this,(n,i)=>{let s=eg.findKey(r,i);if(s){t[s]=e1(n),delete t[i];return}let o=e?e5(i):String(i).trim();o!==i&&delete t[i],t[o]=e1(n),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){let t=Object.create(null);return eg.forEach(this,(r,n)=>{null!=r&&!1!==r&&(t[n]=e&&eg.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){let r=new this(e);return t.forEach(e=>r.set(e)),r}static accessor(e){let t=(this[eX]=this[eX]={accessors:{}}).accessors,r=this.prototype;function n(e){let n=e0(e);t[n]||(e6(r,e),t[n]=!0)}return eg.isArray(e)?e.forEach(n):n(e),this}}e8.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),eg.reduceDescriptors(e8.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[r]=e}}}),eg.freezeMethods(e8);let e7=e8;function e9(e,t){let r=this||eJ,n=t||r,i=e7.from(n.headers),s=n.data;return eg.forEach(e,function(e){s=e.call(r,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function te(e){return!!(e&&e.__CANCEL__)}function tt(e,t,r){ew.call(this,null==e?"canceled":e,ew.ERR_CANCELED,t,r),this.name="CanceledError"}eg.inherits(tt,ew,{__CANCEL__:!0});let tr=tt;function tn(e,t,r){let n=r.config.validateStatus;!r.status||!n||n(r.status)?e(r):t(new ew("Request failed with status code "+r.status,[ew.ERR_BAD_REQUEST,ew.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function ti(e){let t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}let ts=function(e,t){let r,n=Array(e=e||10),i=Array(e),s=0,o=0;return t=void 0!==t?t:1e3,function(a){let l=Date.now(),c=i[o];r||(r=l),n[s]=a,i[s]=l;let u=o,d=0;for(;u!==s;)d+=n[u++],u%=e;if((s=(s+1)%e)===o&&(o=(o+1)%e),l-r<t)return;let h=c&&l-c;return h?Math.round(1e3*d/h):void 0}},to=function(e,t){let r,n,i=0,s=1e3/t,o=(t,s=Date.now())=>{i=s,r=null,n&&(clearTimeout(n),n=null),e.apply(null,t)};return[(...e)=>{let t=Date.now(),a=t-i;a>=s?o(e,t):(r=e,n||(n=setTimeout(()=>{n=null,o(r)},s-a)))},()=>r&&o(r)]},ta=(e,t,r=3)=>{let n=0,i=ts(50,250);return to(r=>{let s=r.loaded,o=r.lengthComputable?r.total:void 0,a=s-n,l=i(a),c=s<=o;n=s,e({loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:l||void 0,estimated:l&&o&&c?(o-s)/l:void 0,event:r,lengthComputable:null!=o,[t?"download":"upload"]:!0})},r)},tl=(e,t)=>{let r=null!=e;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},tc=e=>(...t)=>eg.asap(()=>e(...t)),tu=eq.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,eq.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(eq.origin),eq.navigator&&/(msie|trident)/i.test(eq.navigator.userAgent)):()=>!0,td=eq.hasStandardBrowserEnv?{write(e,t,r,n,i,s){let o=[e+"="+encodeURIComponent(t)];eg.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),eg.isString(n)&&o.push("path="+n),eg.isString(i)&&o.push("domain="+i),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read(e){let t=document.cookie.match(RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function th(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function tf(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function tp(e,t,r){let n=!th(t);return e&&(n||!1==r)?tf(e,t):t}let tg=e=>e instanceof e7?{...e}:e;function tm(e,t){t=t||{};let r={};function n(e,t,r,n){return eg.isPlainObject(e)&&eg.isPlainObject(t)?eg.merge.call({caseless:n},e,t):eg.isPlainObject(t)?eg.merge({},t):eg.isArray(t)?t.slice():t}function i(e,t,r,i){return eg.isUndefined(t)?eg.isUndefined(e)?void 0:n(void 0,e,r,i):n(e,t,r,i)}function s(e,t){if(!eg.isUndefined(t))return n(void 0,t)}function o(e,t){return eg.isUndefined(t)?eg.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function a(r,i,s){return s in t?n(r,i):s in e?n(void 0,r):void 0}let l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(e,t,r)=>i(tg(e),tg(t),r,!0)};return eg.forEach(Object.keys(Object.assign({},e,t)),function(n){let s=l[n]||i,o=s(e[n],t[n],n);eg.isUndefined(o)&&s!==a||(r[n]=o)}),r}let ty=e=>{let t,r=tm({},e),{data:n,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:o,headers:a,auth:l}=r;if(r.headers=a=e7.from(a),r.url=eN(tp(r.baseURL,r.url,r.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&a.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),eg.isFormData(n)){if(eq.hasStandardBrowserEnv||eq.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(!1!==(t=a.getContentType())){let[e,...r]=t?t.split(";").map(e=>e.trim()).filter(Boolean):[];a.setContentType([e||"multipart/form-data",...r].join("; "))}}if(eq.hasStandardBrowserEnv&&(i&&eg.isFunction(i)&&(i=i(r)),i||!1!==i&&tu(r.url))){let e=s&&o&&td.read(o);e&&a.set(s,e)}return r},tb="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(t,r){let n,i,s,o,a,l=ty(e),c=l.data,u=e7.from(l.headers).normalize(),{responseType:d,onUploadProgress:h,onDownloadProgress:f}=l;function p(){o&&o(),a&&a(),l.cancelToken&&l.cancelToken.unsubscribe(n),l.signal&&l.signal.removeEventListener("abort",n)}let g=new XMLHttpRequest;function m(){if(!g)return;let n=e7.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders());tn(function(e){t(e),p()},function(e){r(e),p()},{data:d&&"text"!==d&&"json"!==d?g.response:g.responseText,status:g.status,statusText:g.statusText,headers:n,config:e,request:g}),g=null}g.open(l.method.toUpperCase(),l.url,!0),g.timeout=l.timeout,"onloadend"in g?g.onloadend=m:g.onreadystatechange=function(){g&&4===g.readyState&&(0!==g.status||g.responseURL&&0===g.responseURL.indexOf("file:"))&&setTimeout(m)},g.onabort=function(){g&&(r(new ew("Request aborted",ew.ECONNABORTED,e,g)),g=null)},g.onerror=function(){r(new ew("Network Error",ew.ERR_NETWORK,e,g)),g=null},g.ontimeout=function(){let t=l.timeout?"timeout of "+l.timeout+"ms exceeded":"timeout exceeded",n=l.transitional||eO;l.timeoutErrorMessage&&(t=l.timeoutErrorMessage),r(new ew(t,n.clarifyTimeoutError?ew.ETIMEDOUT:ew.ECONNABORTED,e,g)),g=null},void 0===c&&u.setContentType(null),"setRequestHeader"in g&&eg.forEach(u.toJSON(),function(e,t){g.setRequestHeader(t,e)}),eg.isUndefined(l.withCredentials)||(g.withCredentials=!!l.withCredentials),d&&"json"!==d&&(g.responseType=l.responseType),f&&([s,a]=ta(f,!0),g.addEventListener("progress",s)),h&&g.upload&&([i,o]=ta(h),g.upload.addEventListener("progress",i),g.upload.addEventListener("loadend",o)),(l.cancelToken||l.signal)&&(n=t=>{g&&(r(!t||t.type?new tr(null,e,g):t),g.abort(),g=null)},l.cancelToken&&l.cancelToken.subscribe(n),l.signal&&(l.signal.aborted?n():l.signal.addEventListener("abort",n)));let y=ti(l.url);if(y&&-1===eq.protocols.indexOf(y))return void r(new ew("Unsupported protocol "+y+":",ew.ERR_BAD_REQUEST,e));g.send(c||null)})},tw=(e,t)=>{let{length:r}=e=e?e.filter(Boolean):[];if(t||r){let r,n=new AbortController,i=function(e){if(!r){r=!0,o();let t=e instanceof Error?e:this.reason;n.abort(t instanceof ew?t:new tr(t instanceof Error?t.message:t))}},s=t&&setTimeout(()=>{s=null,i(new ew(`timeout ${t} of ms exceeded`,ew.ETIMEDOUT))},t),o=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)}),e=null)};e.forEach(e=>e.addEventListener("abort",i));let{signal:a}=n;return a.unsubscribe=()=>eg.asap(o),a}},tv=function*(e,t){let r,n=e.byteLength;if(!t||n<t)return void(yield e);let i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},tE=async function*(e,t){for await(let r of tA(e))yield*tv(r,t)},tA=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);let t=e.getReader();try{for(;;){let{done:e,value:r}=await t.read();if(e)break;yield r}}finally{await t.cancel()}},tx=(e,t,r,n)=>{let i,s=tE(e,t),o=0,a=e=>{!i&&(i=!0,n&&n(e))};return new ReadableStream({async pull(e){try{let{done:t,value:n}=await s.next();if(t){a(),e.close();return}let i=n.byteLength;if(r){let e=o+=i;r(e)}e.enqueue(new Uint8Array(n))}catch(e){throw a(e),e}},cancel:e=>(a(e),s.return())},{highWaterMark:2})},tS="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,tk=tS&&"function"==typeof ReadableStream,t_=tS&&("function"==typeof TextEncoder?(n=new TextEncoder,e=>n.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer())),tI=(e,...t)=>{try{return!!e(...t)}catch(e){return!1}},tT=tk&&tI(()=>{let e=!1,t=new Request(eq.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),tC=65536,tP=tk&&tI(()=>eg.isReadableStream(new Response("").body)),tR={stream:tP&&(e=>e.body)};tS&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{tR[t]||(tR[t]=eg.isFunction(e[t])?e=>e[t]():(e,r)=>{throw new ew(`Response type '${t}' is not supported`,ew.ERR_NOT_SUPPORT,r)})})})(new Response);let tD=async e=>{if(null==e)return 0;if(eg.isBlob(e))return e.size;if(eg.isSpecCompliantForm(e)){let t=new Request(eq.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return eg.isArrayBufferView(e)||eg.isArrayBuffer(e)?e.byteLength:(eg.isURLSearchParams(e)&&(e+=""),eg.isString(e))?(await t_(e)).byteLength:void 0},tN=async(e,t)=>{let r=eg.toFiniteNumber(e.getContentLength());return null==r?tD(t):r},tM={http:ev,xhr:tb,fetch:tS&&(async e=>{let t,r,{url:n,method:i,data:s,signal:o,cancelToken:a,timeout:l,onDownloadProgress:c,onUploadProgress:u,responseType:d,headers:h,withCredentials:f="same-origin",fetchOptions:p}=ty(e);d=d?(d+"").toLowerCase():"text";let g=tw([o,a&&a.toAbortSignal()],l),m=g&&g.unsubscribe&&(()=>{g.unsubscribe()});try{if(u&&tT&&"get"!==i&&"head"!==i&&0!==(r=await tN(h,s))){let e,t=new Request(n,{method:"POST",body:s,duplex:"half"});if(eg.isFormData(s)&&(e=t.headers.get("content-type"))&&h.setContentType(e),t.body){let[e,n]=tl(r,ta(tc(u)));s=tx(t.body,tC,e,n)}}eg.isString(f)||(f=f?"include":"omit");let o="credentials"in Request.prototype;t=new Request(n,{...p,signal:g,method:i.toUpperCase(),headers:h.normalize().toJSON(),body:s,duplex:"half",credentials:o?f:void 0});let a=await fetch(t),l=tP&&("stream"===d||"response"===d);if(tP&&(c||l&&m)){let e={};["status","statusText","headers"].forEach(t=>{e[t]=a[t]});let t=eg.toFiniteNumber(a.headers.get("content-length")),[r,n]=c&&tl(t,ta(tc(c),!0))||[];a=new Response(tx(a.body,tC,r,()=>{n&&n(),m&&m()}),e)}d=d||"text";let y=await tR[eg.findKey(tR,d)||"text"](a,e);return!l&&m&&m(),await new Promise((r,n)=>{tn(r,n,{data:y,headers:e7.from(a.headers),status:a.status,statusText:a.statusText,config:e,request:t})})}catch(r){if(m&&m(),r&&"TypeError"===r.name&&/Load failed|fetch/i.test(r.message))throw Object.assign(new ew("Network Error",ew.ERR_NETWORK,e,t),{cause:r.cause||r});throw ew.from(r,r&&r.code,e,t)}})};eg.forEach(tM,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}});let tB=e=>`- ${e}`,tO=e=>eg.isFunction(e)||null===e||!1===e,tL={getAdapter:e=>{let t,r,{length:n}=e=eg.isArray(e)?e:[e],i={};for(let s=0;s<n;s++){let n;if(r=t=e[s],!tO(t)&&void 0===(r=tM[(n=String(t)).toLowerCase()]))throw new ew(`Unknown adapter '${n}'`);if(r)break;i[n||"#"+s]=r}if(!r){let e=Object.entries(i).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));throw new ew("There is no suitable adapter to dispatch the request "+(n?e.length>1?"since :\n"+e.map(tB).join("\n"):" "+tB(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r}};function tF(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new tr(null,e)}function tU(e){return tF(e),e.headers=e7.from(e.headers),e.data=e9.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),tL.getAdapter(e.adapter||eJ.adapter)(e).then(function(t){return tF(e),t.data=e9.call(e,e.transformResponse,t),t.headers=e7.from(t.headers),t},function(t){return!te(t)&&(tF(e),t&&t.response&&(t.response.data=e9.call(e,e.transformResponse,t.response),t.response.headers=e7.from(t.response.headers))),Promise.reject(t)})}let tj="1.9.0",tH={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{tH[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});let t$={};tH.transitional=function(e,t,r){function n(e,t){return"[Axios v"+tj+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return(r,i,s)=>{if(!1===e)throw new ew(n(i," has been removed"+(t?" in "+t:"")),ew.ERR_DEPRECATED);return t&&!t$[i]&&(t$[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,i,s)}},tH.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};let tq={assertOptions:function(e,t,r){if("object"!=typeof e)throw new ew("options must be an object",ew.ERR_BAD_OPTION_VALUE);let n=Object.keys(e),i=n.length;for(;i-- >0;){let s=n[i],o=t[s];if(o){let t=e[s],r=void 0===t||o(t,s,e);if(!0!==r)throw new ew("option "+s+" must be "+r,ew.ERR_BAD_OPTION_VALUE);continue}if(!0!==r)throw new ew("Unknown option "+s,ew.ERR_BAD_OPTION)}},validators:tH},tz=tq.validators;class tV{constructor(e){this.defaults=e||{},this.interceptors={request:new eB,response:new eB}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=Error();let r=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?r&&!String(e.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+r):e.stack=r}catch(e){}}throw e}}_request(e,t){let r,n;"string"==typeof e?(t=t||{}).url=e:t=e||{};let{transitional:i,paramsSerializer:s,headers:o}=t=tm(this.defaults,t);void 0!==i&&tq.assertOptions(i,{silentJSONParsing:tz.transitional(tz.boolean),forcedJSONParsing:tz.transitional(tz.boolean),clarifyTimeoutError:tz.transitional(tz.boolean)},!1),null!=s&&(eg.isFunction(s)?t.paramsSerializer={serialize:s}:tq.assertOptions(s,{encode:tz.function,serialize:tz.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),tq.assertOptions(t,{baseUrl:tz.spelling("baseURL"),withXsrfToken:tz.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=o&&eg.merge(o.common,o[t.method]);o&&eg.forEach(["delete","get","head","post","put","patch","common"],e=>{delete o[e]}),t.headers=e7.concat(a,o);let l=[],c=!0;this.interceptors.request.forEach(function(e){("function"!=typeof e.runWhen||!1!==e.runWhen(t))&&(c=c&&e.synchronous,l.unshift(e.fulfilled,e.rejected))});let u=[];this.interceptors.response.forEach(function(e){u.push(e.fulfilled,e.rejected)});let d=0;if(!c){let e=[tU.bind(this),void 0];for(e.unshift.apply(e,l),e.push.apply(e,u),n=e.length,r=Promise.resolve(t);d<n;)r=r.then(e[d++],e[d++]);return r}n=l.length;let h=t;for(d=0;d<n;){let e=l[d++],t=l[d++];try{h=e(h)}catch(e){t.call(this,e);break}}try{r=tU.call(this,h)}catch(e){return Promise.reject(e)}for(d=0,n=u.length;d<n;)r=r.then(u[d++],u[d++]);return r}getUri(e){return eN(tp((e=tm(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}eg.forEach(["delete","get","head","options"],function(e){tV.prototype[e]=function(t,r){return this.request(tm(r||{},{method:e,url:t,data:(r||{}).data}))}}),eg.forEach(["post","put","patch"],function(e){function t(t){return function(r,n,i){return this.request(tm(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}tV.prototype[e]=t(),tV.prototype[e+"Form"]=t(!0)});let tG=tV;class tK{constructor(e){let t;if("function"!=typeof e)throw TypeError("executor must be a function.");this.promise=new Promise(function(e){t=e});let r=this;this.promise.then(e=>{if(!r._listeners)return;let t=r._listeners.length;for(;t-- >0;)r._listeners[t](e);r._listeners=null}),this.promise.then=e=>{let t,n=new Promise(e=>{r.subscribe(e),t=e}).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e(function(e,n,i){r.reason||(r.reason=new tr(e,n,i),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason)return void e(this.reason);this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){let e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new tK(function(t){e=t}),cancel:e}}}let tW=tK;function tQ(e){return function(t){return e.apply(null,t)}}function tJ(e){return eg.isObject(e)&&!0===e.isAxiosError}let tZ={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(tZ).forEach(([e,t])=>{tZ[t]=e});let tY=tZ;function tX(e){let t=new tG(e),r=a(tG.prototype.request,t);return eg.extend(r,tG.prototype,t,{allOwnKeys:!0}),eg.extend(r,t,null,{allOwnKeys:!0}),r.create=function(t){return tX(tm(e,t))},r}let t0=tX(eJ);t0.Axios=tG,t0.CanceledError=tr,t0.CancelToken=tW,t0.isCancel=te,t0.VERSION=tj,t0.toFormData=eI,t0.AxiosError=ew,t0.Cancel=t0.CanceledError,t0.all=function(e){return Promise.all(e)},t0.spread=tQ,t0.isAxiosError=tJ,t0.mergeConfig=tm,t0.AxiosHeaders=e7,t0.formToJSON=e=>eK(eg.isHTMLForm(e)?new FormData(e):e),t0.getAdapter=tL.getAdapter,t0.HttpStatusCode=tY,t0.default=t0;let t1=t0,{Axios:t2,AxiosError:t3,CanceledError:t4,isCancel:t5,CancelToken:t6,VERSION:t8,all:t7,Cancel:t9,isAxiosError:re,spread:rt,toFormData:rr,AxiosHeaders:rn,HttpStatusCode:ri,formToJSON:rs,getAdapter:ro,mergeConfig:ra}=t1;var rl=r(57116);class rc{articleName;versionManager;constructor(e,t){this.articleName=e,this.versionManager=new rl.m9(t)}getContent(e){let t=[];return t=e?this.versionManager.getBranch(e):this.versionManager.getMainBranch(),(0,rl.a6)(t)}getVersions(){let e=new Set(this.versionManager.getMainBranch().map(e=>e.id));return this.versionManager.getAllVersions().map(t=>({id:t.id,date:t.date,parent:t.parent,mainBranch:e.has(t.id)}))}getCurrentVersionID(){let e=this.versionManager.getMainBranch();if(0===e.length)throw Error("No versions found");return e[e.length-1].id}newContent(e,t){let r;if(t){let n=this.versionManager.getBranch(t),i=(0,rl.a6)(n);r=(0,rl.JL)(i,e,t)}else r=(0,rl.JL)("",e,t??null);return this.versionManager.addVersion(r),r}}class ru{url;constructor(e){this.url=e}async getArticle(e){let{data:t,status:r}=await t1.get(`${this.url}/articles/${e}`);return r===ri.NotFound?Promise.reject("Article not found"):r!==ri.Ok?Promise.reject("Server error"):new rc(e,JSON.parse(t.versions))}async newArticle(e,t){let r=(0,rl.JL)("",t),{status:n}=await t1.post(`${this.url}/articles`,{name:e,version:r});return n===ri.Conflict?Promise.reject("Article already exists"):n!==ri.Created?Promise.reject(`Server error: ${n}`):void 0}async addVersion(e,t,r){let n=(await this.getArticle(e)).newContent(t,r),{status:i}=await t1.patch(`${this.url}/articles/${e}`,n);return i===ri.BadRequest?Promise.reject("Bad request while editing article"):i===ri.NotFound?Promise.reject("Article to edit not found"):void 0}async getArticleList(){let{data:e}=await t1.get(`${this.url}/articles`);return e}}class rd{articleRepository;versionManager;lastVersionFetchedByArticle;async start(e){console.log("Initializing"),this.articleRepository=new ru(e),this.lastVersionFetchedByArticle=new Map}async getArticle(e,t){let r=await this.articleRepository.getArticle(e);return this.lastVersionFetchedByArticle.set(e,r.getCurrentVersionID()),{name:e,content:r.getContent(t),versionsInfo:r.getVersions()}}async newArticle(e,t){if(0===e.length)throw Error("Name cannot be empty");await this.articleRepository.newArticle(e,t)}async editArticle(e,t){if(0===e.length)throw Error("No name given");let r=this.lastVersionFetchedByArticle.get(e);if(!r)throw Error(`Article ${e} was not previously fetched. Fetched articles: ${this.lastVersionFetchedByArticle.keys()}`);await this.articleRepository.addVersion(e,t,r)}async getArticleList(){return this.articleRepository.getArticleList()}async searchArticles(e,t=10,r=0){return[]}}let rh=rd;async function rf(e){let t=new rh;return await t.start(e),t}},43716:(e,t,r)=>{"use strict";r.r(t),r.d(t,{base32:()=>i,base32hex:()=>l,base32hexpad:()=>u,base32hexpadupper:()=>d,base32hexupper:()=>c,base32pad:()=>o,base32padupper:()=>a,base32upper:()=>s,base32z:()=>h});var n=r(52215);let i=(0,n.yE)({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),s=(0,n.yE)({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),o=(0,n.yE)({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),a=(0,n.yE)({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),l=(0,n.yE)({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),c=(0,n.yE)({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),u=(0,n.yE)({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),d=(0,n.yE)({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),h=(0,n.yE)({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})},44134:(e,t,r)=>{"use strict";let n=r(57719),i=r(7610),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=c,t.SlowBuffer=v,t.INSPECT_MAX_BYTES=50;let o=0x7fffffff;function a(){try{let e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}function l(e){if(e>o)throw RangeError('The value "'+e+'" is invalid for option "size"');let t=new Uint8Array(e);return Object.setPrototypeOf(t,c.prototype),t}function c(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return f(e)}return u(e,t,r)}function u(e,t,r){if("string"==typeof e)return p(e,t);if(ArrayBuffer.isView(e))return m(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(eo(e,ArrayBuffer)||e&&eo(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(eo(e,SharedArrayBuffer)||e&&eo(e.buffer,SharedArrayBuffer)))return y(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');let n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return c.from(n,t,r);let i=b(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return c.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function d(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function h(e,t,r){return(d(e),e<=0)?l(e):void 0!==t?"string"==typeof r?l(e).fill(t,r):l(e).fill(t):l(e)}function f(e){return d(e),l(e<0?0:0|w(e))}function p(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!c.isEncoding(t))throw TypeError("Unknown encoding: "+t);let r=0|E(e,t),n=l(r),i=n.write(e,t);return i!==r&&(n=n.slice(0,i)),n}function g(e){let t=e.length<0?0:0|w(e.length),r=l(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function m(e){if(eo(e,Uint8Array)){let t=new Uint8Array(e);return y(t.buffer,t.byteOffset,t.byteLength)}return g(e)}function y(e,t,r){let n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),c.prototype),n}function b(e){if(c.isBuffer(e)){let t=0|w(e.length),r=l(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||ea(e.length)?l(0):g(e):"Buffer"===e.type&&Array.isArray(e.data)?g(e.data):void 0}function w(e){if(e>=o)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function v(e){return+e!=e&&(e=0),c.alloc(+e)}function E(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||eo(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return et(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return ei(e).length;default:if(i)return n?-1:et(e).length;t=(""+t).toLowerCase(),i=!0}}function A(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return L(this,t,r);case"utf8":case"utf-8":return D(this,t,r);case"ascii":return B(this,t,r);case"latin1":case"binary":return O(this,t,r);case"base64":return R(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,t,r);default:if(n)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function x(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function S(e,t,r,n,i){if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),ea(r*=1)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(i)return -1;else r=e.length-1;else if(r<0)if(!i)return -1;else r=0;if("string"==typeof t&&(t=c.from(t,n)),c.isBuffer(t))return 0===t.length?-1:k(e,t,r,n,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return k(e,[t],r,n,i)}throw TypeError("val must be string, number or Buffer")}function k(e,t,r,n,i){let s,o=1,a=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;o=2,a/=2,l/=2,r/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){let n=-1;for(s=r;s<a;s++)if(c(e,s)===c(t,-1===n?0:s-n)){if(-1===n&&(n=s),s-n+1===l)return n*o}else -1!==n&&(s-=s-n),n=-1}else for(r+l>a&&(r=a-l),s=r;s>=0;s--){let r=!0;for(let n=0;n<l;n++)if(c(e,s+n)!==c(t,n)){r=!1;break}if(r)return s}return -1}function _(e,t,r,n){let i;r=Number(r)||0;let s=e.length-r;n?(n=Number(n))>s&&(n=s):n=s;let o=t.length;for(n>o/2&&(n=o/2),i=0;i<n;++i){let n=parseInt(t.substr(2*i,2),16);if(ea(n))break;e[r+i]=n}return i}function I(e,t,r,n){return es(et(t,e.length-r),e,r,n)}function T(e,t,r,n){return es(er(t),e,r,n)}function C(e,t,r,n){return es(ei(t),e,r,n)}function P(e,t,r,n){return es(en(t,e.length-r),e,r,n)}function R(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function D(e,t,r){r=Math.min(e.length,r);let n=[],i=t;for(;i<r;){let t=e[i],s=null,o=t>239?4:t>223?3:t>191?2:1;if(i+o<=r){let r,n,a,l;switch(o){case 1:t<128&&(s=t);break;case 2:(192&(r=e[i+1]))==128&&(l=(31&t)<<6|63&r)>127&&(s=l);break;case 3:r=e[i+1],n=e[i+2],(192&r)==128&&(192&n)==128&&(l=(15&t)<<12|(63&r)<<6|63&n)>2047&&(l<55296||l>57343)&&(s=l);break;case 4:r=e[i+1],n=e[i+2],a=e[i+3],(192&r)==128&&(192&n)==128&&(192&a)==128&&(l=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&a)>65535&&l<1114112&&(s=l)}}null===s?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),i+=o}return M(n)}t.kMaxLength=0x7fffffff,c.TYPED_ARRAY_SUPPORT=a(),c.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=function(e,t,r){return u(e,t,r)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(e,t,r){return h(e,t,r)},c.allocUnsafe=function(e){return f(e)},c.allocUnsafeSlow=function(e){return f(e)},c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(e,t){if(eo(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),eo(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(e)||!c.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:+(n<r)},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){let r;if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;let n=c.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){let t=e[r];if(eo(t,Uint8Array))i+t.length>n.length?(c.isBuffer(t)||(t=c.from(t)),t.copy(n,i)):Uint8Array.prototype.set.call(n,t,i);else if(c.isBuffer(t))t.copy(n,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=t.length}return n},c.byteLength=E,c.prototype._isBuffer=!0,c.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)x(this,t,t+1);return this},c.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)x(this,t,t+3),x(this,t+1,t+2);return this},c.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)x(this,t,t+7),x(this,t+1,t+6),x(this,t+2,t+5),x(this,t+3,t+4);return this},c.prototype.toString=function(){let e=this.length;return 0===e?"":0==arguments.length?D(this,0,e):A.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(e){if(!c.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){let e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(c.prototype[s]=c.prototype.inspect),c.prototype.compare=function(e,t,r,n,i){if(eo(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;let s=i-n,o=r-t,a=Math.min(s,o),l=this.slice(n,i),u=e.slice(t,r);for(let e=0;e<a;++e)if(l[e]!==u[e]){s=l[e],o=u[e];break}return s<o?-1:+(o<s)},c.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return S(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return S(this,e,t,r,!1)},c.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let s=!1;for(;;)switch(n){case"hex":return _(this,e,t,r);case"utf8":case"utf-8":return I(this,e,t,r);case"ascii":case"latin1":case"binary":return T(this,e,t,r);case"base64":return C(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,t,r);default:if(s)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};let N=4096;function M(e){let t=e.length;if(t<=N)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=N));return r}function B(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function O(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function L(e,t,r){let n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=t;n<r;++n)i+=el[e[n]];return i}function F(e,t,r){let n=e.slice(t,r),i="";for(let e=0;e<n.length-1;e+=2)i+=String.fromCharCode(n[e]+256*n[e+1]);return i}function U(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function j(e,t,r,n,i,s){if(!c.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function H(e,t,r,n,i){J(t,n,i,e,r,7);let s=Number(t&BigInt(0xffffffff));e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s;let o=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,r}function $(e,t,r,n,i){J(t,n,i,e,r,7);let s=Number(t&BigInt(0xffffffff));e[r+7]=s,s>>=8,e[r+6]=s,s>>=8,e[r+5]=s,s>>=8,e[r+4]=s;let o=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[r+3]=o,o>>=8,e[r+2]=o,o>>=8,e[r+1]=o,o>>=8,e[r]=o,r+8}function q(e,t,r,n,i,s){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function z(e,t,r,n,s){return t*=1,r>>>=0,s||q(e,t,r,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,r,n,23,4),r+4}function V(e,t,r,n,s){return t*=1,r>>>=0,s||q(e,t,r,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,r,n,52,8),r+8}c.prototype.slice=function(e,t){let r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);let n=this.subarray(e,t);return Object.setPrototypeOf(n,c.prototype),n},c.prototype.readUintLE=c.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||U(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return n},c.prototype.readUintBE=c.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||U(e,t,this.length);let n=this[e+--t],i=1;for(;t>0&&(i*=256);)n+=this[e+--t]*i;return n},c.prototype.readUint8=c.prototype.readUInt8=function(e,t){return e>>>=0,t||U(e,1,this.length),this[e]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||U(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||U(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||U(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||U(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readBigUInt64LE=ec(function(e){Z(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&Y(e,this.length-8);let n=t+256*this[++e]+65536*this[++e]+0x1000000*this[++e],i=this[++e]+256*this[++e]+65536*this[++e]+0x1000000*r;return BigInt(n)+(BigInt(i)<<BigInt(32))}),c.prototype.readBigUInt64BE=ec(function(e){Z(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&Y(e,this.length-8);let n=0x1000000*t+65536*this[++e]+256*this[++e]+this[++e],i=0x1000000*this[++e]+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)}),c.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||U(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},c.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||U(e,t,this.length);let n=t,i=1,s=this[e+--n];for(;n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},c.prototype.readInt8=function(e,t){return(e>>>=0,t||U(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||U(e,2,this.length);let r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},c.prototype.readInt16BE=function(e,t){e>>>=0,t||U(e,2,this.length);let r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||U(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||U(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readBigInt64LE=ec(function(e){Z(e>>>=0,"offset");let t=this[e],r=this[e+7];return(void 0===t||void 0===r)&&Y(e,this.length-8),(BigInt(this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24))<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+0x1000000*this[++e])}),c.prototype.readBigInt64BE=ec(function(e){Z(e>>>=0,"offset");let t=this[e],r=this[e+7];return(void 0===t||void 0===r)&&Y(e,this.length-8),(BigInt((t<<24)+65536*this[++e]+256*this[++e]+this[++e])<<BigInt(32))+BigInt(0x1000000*this[++e]+65536*this[++e]+256*this[++e]+r)}),c.prototype.readFloatLE=function(e,t){return e>>>=0,t||U(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||U(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||U(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||U(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){let n=Math.pow(2,8*r)-1;j(this,e,t,r,n,0)}let i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){let n=Math.pow(2,8*r)-1;j(this,e,t,r,n,0)}let i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},c.prototype.writeUint8=c.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigUInt64LE=ec(function(e,t=0){return H(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeBigUInt64BE=ec(function(e,t=0){return $(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeIntLE=function(e,t,r,n){if(e*=1,t>>>=0,!n){let n=Math.pow(2,8*r-1);j(this,e,t,r,n-1,-n)}let i=0,s=1,o=0;for(this[t]=255&e;++i<r&&(s*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/s|0)-o&255;return t+r},c.prototype.writeIntBE=function(e,t,r,n){if(e*=1,t>>>=0,!n){let n=Math.pow(2,8*r-1);j(this,e,t,r,n-1,-n)}let i=r-1,s=1,o=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/s|0)-o&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigInt64LE=ec(function(e,t=0){return H(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeBigInt64BE=ec(function(e,t=0){return $(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeFloatLE=function(e,t,r){return z(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return z(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return V(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return V(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,n){if(!c.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);let i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},c.prototype.fill=function(e,t,r,n){let i;if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){let t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{let s=c.isBuffer(e)?e:c.from(e,n),o=s.length;if(0===o)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=s[i%o]}return this};let G={};function K(e,t,r){G[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function W(e){let t="",r=e.length,n=+("-"===e[0]);for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function Q(e,t,r){Z(t,"offset"),(void 0===e[t]||void 0===e[t+r])&&Y(t,e.length-(r+1))}function J(e,t,r,n,i,s){if(e>r||e<t){let n,i="bigint"==typeof t?"n":"";throw n=s>3?0===t||t===BigInt(0)?`>= 0${i} and < 2${i} ** ${(s+1)*8}${i}`:`>= -(2${i} ** ${(s+1)*8-1}${i}) and < 2 ** ${(s+1)*8-1}${i}`:`>= ${t}${i} and <= ${r}${i}`,new G.ERR_OUT_OF_RANGE("value",n,e)}Q(n,i,s)}function Z(e,t){if("number"!=typeof e)throw new G.ERR_INVALID_ARG_TYPE(t,"number",e)}function Y(e,t,r){if(Math.floor(e)!==e)throw Z(e,r),new G.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new G.ERR_BUFFER_OUT_OF_BOUNDS;throw new G.ERR_OUT_OF_RANGE(r||"offset",`>= ${+!!r} and <= ${t}`,e)}K("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),K("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),K("ERR_OUT_OF_RANGE",function(e,t,r){let n=`The value of "${e}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>0x100000000?i=W(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=W(i)),i+="n"),n+=` It must be ${t}. Received ${i}`},RangeError);let X=/[^+/0-9A-Za-z-_]/g;function ee(e){if((e=(e=e.split("=")[0]).trim().replace(X,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function et(e,t){let r;t=t||1/0;let n=e.length,i=null,s=[];for(let o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319||o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function er(e){let t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function en(e,t){let r,n,i=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}function ei(e){return n.toByteArray(ee(e))}function es(e,t,r,n){let i;for(i=0;i<n&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function eo(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function ea(e){return e!=e}let el=function(){let e="0123456789abcdef",t=Array(256);for(let r=0;r<16;++r){let n=16*r;for(let i=0;i<16;++i)t[n+i]=e[r]+e[i]}return t}();function ec(e){return"undefined"==typeof BigInt?eu:e}function eu(){throw Error("BigInt not supported")}},45077:(e,t,r)=>{"use strict";let n=r(56765);e.exports=function(e,...t){0===t.length?n(e):n(()=>e(...t))}},45329:e=>{"use strict";e.exports="undefined"!=typeof Reflect&&Reflect.getPrototypeOf||null},45346:(e,t,r)=>{"use strict";r.d(t,{F:()=>s});var n=r(62954),i=r(62897);function s(e,...t){if(null==e)throw Error("Empty pipeline");if(c(e)){let t=e;e=()=>t.source}else if(l(e)||a(e)){let t=e;e=()=>t}let r=[e,...t];if(r.length>1&&c(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let e=1;e<r.length-1;e++)c(r[e])&&(r[e]=u(r[e]));return o(...r)}let o=(...e)=>{let t;for(;e.length>0;)t=e.shift()(t);return t},a=e=>e?.[Symbol.asyncIterator]!=null,l=e=>e?.[Symbol.iterator]!=null,c=e=>null!=e&&null!=e.sink&&null!=e.source,u=e=>t=>{let r=e.sink(t);if(r?.then!=null){let t,s=(0,n.Ny)({objectMode:!0});r.then(()=>{s.end()},e=>{s.end(e)});let o=e.source;if(a(o))t=async function*(){yield*o,s.end()};else if(l(o))t=function*(){yield*o,s.end()};else throw Error("Unknown duplex source type - must be Iterable or AsyncIterable");return(0,i.A)(s,t())}return e.source}},46923:(e,t,r)=>{"use strict";r.d(t,{if:()=>n.i,ED:()=>c});var n=r(90161),i=r(98897),s=r(43716),o=r(69685),a=r(34269),l=r(87704);class c extends n.i{data;constructor(){super(),this.data=new Map}put(e,t){return this.data.set(s.base32.encode(e.multihash.bytes),t),e}get(e){let t=this.data.get(s.base32.encode(e.multihash.bytes));if(null==t)throw new i.m_;return t}has(e){return this.data.has(s.base32.encode(e.multihash.bytes))}async delete(e){this.data.delete(s.base32.encode(e.multihash.bytes))}async *getAll(){for(let[e,t]of this.data.entries())yield{cid:o.TO.createV1(a.code,l.decode(s.base32.decode(e))),block:t}}}var u=r(3204);r(24802),r(76520),r(62897),r(62954),(0,u.vF)("blockstore:core:tiered"),n.i},47951:(e,t,r)=>{"use strict";r.r(t),r.d(t,{code:()=>o,decode:()=>l,encode:()=>a,name:()=>s});let n=new TextEncoder,i=new TextDecoder,s="json",o=512;function a(e){return n.encode(JSON.stringify(e))}function l(e){return JSON.parse(i.decode(e))}},48856:e=>{"use strict";function t(e,t){var t=t||{};this._capacity=t.capacity,this._head=0,this._tail=0,Array.isArray(e)?this._fromArray(e):(this._capacityMask=3,this._list=[,,,,])}t.prototype.peekAt=function(e){var t=e;if(t===(0|t)){var r=this.size();if(!(t>=r)&&!(t<-r))return t<0&&(t+=r),t=this._head+t&this._capacityMask,this._list[t]}},t.prototype.get=function(e){return this.peekAt(e)},t.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},t.prototype.peekFront=function(){return this.peek()},t.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(t.prototype,"length",{get:function(){return this.size()}}),t.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.unshift=function(e){if(0==arguments.length)return this.size();var t=this._list.length;return(this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail)?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}},t.prototype.push=function(e){if(0==arguments.length)return this.size();var t=this._tail;return(this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail)?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var r=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),r}},t.prototype.removeOne=function(e){var t,r=e;if(r===(0|r)&&this._head!==this._tail){var n=this.size(),i=this._list.length;if(!(r>=n)&&!(r<-n)){r<0&&(r+=n),r=this._head+r&this._capacityMask;var s=this._list[r];if(e<n/2){for(t=e;t>0;t--)this._list[r]=this._list[r=r-1+i&this._capacityMask];this._list[r]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(t=n-1-e;t>0;t--)this._list[r]=this._list[r=r+1+i&this._capacityMask];this._list[r]=void 0,this._tail=this._tail-1+i&this._capacityMask}return s}}},t.prototype.remove=function(e,t){var r,n,i=e,s=t;if(i===(0|i)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(i>=o)&&!(i<-o)&&!(t<1)){if(i<0&&(i+=o),1===t||!t)return(r=[,])[0]=this.removeOne(i),r;if(0===i&&i+t>=o)return r=this.toArray(),this.clear(),r;for(i+t>o&&(t=o-i),r=Array(t),n=0;n<t;n++)r[n]=this._list[this._head+i+n&this._capacityMask];if(i=this._head+i&this._capacityMask,e+t===o){for(this._tail=this._tail-t+a&this._capacityMask,n=t;n>0;n--)this._list[i=i+1+a&this._capacityMask]=void 0;return r}if(0===e){for(this._head=this._head+t+a&this._capacityMask,n=t-1;n>0;n--)this._list[i=i+1+a&this._capacityMask]=void 0;return r}if(i<o/2){for(this._head=this._head+e+t+a&this._capacityMask,n=e;n>0;n--)this.unshift(this._list[i=i-1+a&this._capacityMask]);for(i=this._head-1+a&this._capacityMask;s>0;)this._list[i=i-1+a&this._capacityMask]=void 0,s--;e<0&&(this._tail=i)}else{for(this._tail=i,i=i+t+a&this._capacityMask,n=o-(t+e);n>0;n--)this.push(this._list[i++]);for(i=this._tail;s>0;)this._list[i=i+1+a&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),r}}},t.prototype.splice=function(e,t){var r=e;if(r===(0|r)){var n=this.size();if(r<0&&(r+=n),!(r>n))if(!(arguments.length>2))return this.remove(r,t);else{var i,s,o,a=arguments.length,l=this._list.length,c=2;if(!n||r<n/2){for(i=0,s=Array(r);i<r;i++)s[i]=this._list[this._head+i&this._capacityMask];for(0===t?(o=[],r>0&&(this._head=this._head+r+l&this._capacityMask)):(o=this.remove(r,t),this._head=this._head+r+l&this._capacityMask);a>c;)this.unshift(arguments[--a]);for(i=r;i>0;i--)this.unshift(s[i-1])}else{var u=(s=Array(n-(r+t))).length;for(i=0;i<u;i++)s[i]=this._list[this._head+r+t+i&this._capacityMask];for(0===t?(o=[],r!=n&&(this._tail=this._head+r+l&this._capacityMask)):(o=this.remove(r,t),this._tail=this._tail-u+l&this._capacityMask);c<a;)this.push(arguments[c++]);for(i=0;i<u;i++)this.push(s[i])}return o}}},t.prototype.clear=function(){this._list=Array(this._list.length),this._head=0,this._tail=0},t.prototype.isEmpty=function(){return this._head===this._tail},t.prototype.toArray=function(){return this._copyArray(!1)},t.prototype._fromArray=function(e){var t=e.length,r=this._nextPowerOf2(t);this._list=Array(r),this._capacityMask=r-1,this._tail=t;for(var n=0;n<t;n++)this._list[n]=e[n]},t.prototype._copyArray=function(e,t){var r,n=this._list,i=n.length,s=this.length;if((t|=s)==s&&this._head<this._tail)return this._list.slice(this._head,this._tail);var o=Array(t),a=0;if(e||this._head>this._tail){for(r=this._head;r<i;r++)o[a++]=n[r];for(r=0;r<this._tail;r++)o[a++]=n[r]}else for(r=this._head;r<this._tail;r++)o[a++]=n[r];return o},t.prototype._growArray=function(){if(0!=this._head){var e=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=e}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1},t.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},t.prototype._nextPowerOf2=function(e){return Math.max(1<<Math.log(e)/Math.log(2)+1,4)},e.exports=t},49005:(e,t,r)=>{"use strict";r.d(t,{H_:()=>iu,UC:()=>io,YJ:()=>ia,q7:()=>ic,VF:()=>ip,JU:()=>il,ZL:()=>is,z6:()=>id,hN:()=>ih,bL:()=>ir,wv:()=>ig,Pb:()=>im,G5:()=>ib,ZP:()=>iy,l9:()=>ii});var n,i=r(12115),s=r(85185),o=r(6101),a=r(46081),l=r(5845),c=r(63655);function u(e,t){return t.get?t.get.call(e):t.value}function d(e,t,r){if(!t.has(e))throw TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}function h(e,t){var r=d(e,t,"get");return u(e,r)}function f(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}function p(e,t,r){f(e,t),t.set(e,r)}function g(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=r}}function m(e,t,r){var n=d(e,t,"set");return g(e,n,r),r}var y=r(99708),b=r(95155);function w(e){let t=e+"CollectionProvider",[r,n]=(0,a.A)(t),[s,l]=r(t,{collectionRef:{current:null},itemMap:new Map}),c=e=>{let{scope:t,children:r}=e,n=i.useRef(null),o=i.useRef(new Map).current;return(0,b.jsx)(s,{scope:t,itemMap:o,collectionRef:n,children:r})};c.displayName=t;let u=e+"CollectionSlot",d=(0,y.TL)(u),h=i.forwardRef((e,t)=>{let{scope:r,children:n}=e,i=l(u,r),s=(0,o.s)(t,i.collectionRef);return(0,b.jsx)(d,{ref:s,children:n})});h.displayName=u;let f=e+"CollectionItemSlot",p="data-radix-collection-item",g=(0,y.TL)(f),m=i.forwardRef((e,t)=>{let{scope:r,children:n,...s}=e,a=i.useRef(null),c=(0,o.s)(t,a),u=l(f,r);return i.useEffect(()=>(u.itemMap.set(a,{ref:a,...s}),()=>void u.itemMap.delete(a))),(0,b.jsx)(g,{...{[p]:""},ref:c,children:n})});return m.displayName=f,[{Provider:c,Slot:h,ItemSlot:m},function(t){let r=l(e+"CollectionConsumer",t);return i.useCallback(()=>{let e=r.collectionRef.current;if(!e)return[];let t=Array.from(e.querySelectorAll("[".concat(p,"]")));return Array.from(r.itemMap.values()).sort((e,r)=>t.indexOf(e.ref.current)-t.indexOf(r.ref.current))},[r.collectionRef,r.itemMap])},n]}var v=new WeakMap;function E(e,t){if("at"in Array.prototype)return Array.prototype.at.call(e,t);let r=A(e,t);return -1===r?void 0:e[r]}function A(e,t){let r=e.length,n=x(t),i=n>=0?n:r+n;return i<0||i>=r?-1:i}function x(e){return e!=e||0===e?0:Math.trunc(e)}n=new WeakMap;function S(e,t){return!!(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_PRECEDING)}var k=r(94315),_=r(19178),I=r(92293),T=r(25519),C=r(61285);let P=["top","right","bottom","left"],R=Math.min,D=Math.max,N=Math.round,M=Math.floor,B=e=>({x:e,y:e}),O={left:"right",right:"left",bottom:"top",top:"bottom"},L={start:"end",end:"start"};function F(e,t,r){return D(e,R(t,r))}function U(e,t){return"function"==typeof e?e(t):e}function j(e){return e.split("-")[0]}function H(e){return e.split("-")[1]}function $(e){return"x"===e?"y":"x"}function q(e){return"y"===e?"height":"width"}function z(e){return["top","bottom"].includes(j(e))?"y":"x"}function V(e){return $(z(e))}function G(e,t,r){void 0===r&&(r=!1);let n=H(e),i=V(e),s=q(i),o="x"===i?n===(r?"end":"start")?"right":"left":"start"===n?"bottom":"top";return t.reference[s]>t.floating[s]&&(o=Z(o)),[o,Z(o)]}function K(e){let t=Z(e);return[W(e),t,W(t)]}function W(e){return e.replace(/start|end/g,e=>L[e])}function Q(e,t,r){let n=["left","right"],i=["right","left"],s=["top","bottom"],o=["bottom","top"];switch(e){case"top":case"bottom":if(r)return t?i:n;return t?n:i;case"left":case"right":return t?s:o;default:return[]}}function J(e,t,r,n){let i=H(e),s=Q(j(e),"start"===r,n);return i&&(s=s.map(e=>e+"-"+i),t&&(s=s.concat(s.map(W)))),s}function Z(e){return e.replace(/left|right|bottom|top/g,e=>O[e])}function Y(e){return{top:0,right:0,bottom:0,left:0,...e}}function X(e){return"number"!=typeof e?Y(e):{top:e,right:e,bottom:e,left:e}}function ee(e){let{x:t,y:r,width:n,height:i}=e;return{width:n,height:i,top:r,left:t,right:t+n,bottom:r+i,x:t,y:r}}function et(e,t,r){let n,{reference:i,floating:s}=e,o=z(t),a=V(t),l=q(a),c=j(t),u="y"===o,d=i.x+i.width/2-s.width/2,h=i.y+i.height/2-s.height/2,f=i[l]/2-s[l]/2;switch(c){case"top":n={x:d,y:i.y-s.height};break;case"bottom":n={x:d,y:i.y+i.height};break;case"right":n={x:i.x+i.width,y:h};break;case"left":n={x:i.x-s.width,y:h};break;default:n={x:i.x,y:i.y}}switch(H(t)){case"start":n[a]-=f*(r&&u?-1:1);break;case"end":n[a]+=f*(r&&u?-1:1)}return n}let er=async(e,t,r)=>{let{placement:n="bottom",strategy:i="absolute",middleware:s=[],platform:o}=r,a=s.filter(Boolean),l=await (null==o.isRTL?void 0:o.isRTL(t)),c=await o.getElementRects({reference:e,floating:t,strategy:i}),{x:u,y:d}=et(c,n,l),h=n,f={},p=0;for(let r=0;r<a.length;r++){let{name:s,fn:g}=a[r],{x:m,y:y,data:b,reset:w}=await g({x:u,y:d,initialPlacement:n,placement:h,strategy:i,middlewareData:f,rects:c,platform:o,elements:{reference:e,floating:t}});u=null!=m?m:u,d=null!=y?y:d,f={...f,[s]:{...f[s],...b}},w&&p<=50&&(p++,"object"==typeof w&&(w.placement&&(h=w.placement),w.rects&&(c=!0===w.rects?await o.getElementRects({reference:e,floating:t,strategy:i}):w.rects),{x:u,y:d}=et(c,h,l)),r=-1)}return{x:u,y:d,placement:h,strategy:i,middlewareData:f}};async function en(e,t){var r;void 0===t&&(t={});let{x:n,y:i,platform:s,rects:o,elements:a,strategy:l}=e,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:f=0}=U(t,e),p=X(f),g="floating"===d?"reference":"floating",m=a[h?g:d],y=ee(await s.getClippingRect({element:null==(r=await (null==s.isElement?void 0:s.isElement(m)))||r?m:m.contextElement||await (null==s.getDocumentElement?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),b="floating"===d?{x:n,y:i,width:o.floating.width,height:o.floating.height}:o.reference,w=await (null==s.getOffsetParent?void 0:s.getOffsetParent(a.floating)),v=await (null==s.isElement?void 0:s.isElement(w))&&await (null==s.getScale?void 0:s.getScale(w))||{x:1,y:1},E=ee(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:b,offsetParent:w,strategy:l}):b);return{top:(y.top-E.top+p.top)/v.y,bottom:(E.bottom-y.bottom+p.bottom)/v.y,left:(y.left-E.left+p.left)/v.x,right:(E.right-y.right+p.right)/v.x}}let ei=e=>({name:"arrow",options:e,async fn(t){let{x:r,y:n,placement:i,rects:s,platform:o,elements:a,middlewareData:l}=t,{element:c,padding:u=0}=U(e,t)||{};if(null==c)return{};let d=X(u),h={x:r,y:n},f=V(i),p=q(f),g=await o.getDimensions(c),m="y"===f,y=m?"top":"left",b=m?"bottom":"right",w=m?"clientHeight":"clientWidth",v=s.reference[p]+s.reference[f]-h[f]-s.floating[p],E=h[f]-s.reference[f],A=await (null==o.getOffsetParent?void 0:o.getOffsetParent(c)),x=A?A[w]:0;x&&await (null==o.isElement?void 0:o.isElement(A))||(x=a.floating[w]||s.floating[p]);let S=v/2-E/2,k=x/2-g[p]/2-1,_=R(d[y],k),I=R(d[b],k),T=_,C=x-g[p]-I,P=x/2-g[p]/2+S,D=F(T,P,C),N=!l.arrow&&null!=H(i)&&P!==D&&s.reference[p]/2-(P<T?_:I)-g[p]/2<0,M=N?P<T?P-T:P-C:0;return{[f]:h[f]+M,data:{[f]:D,centerOffset:P-D-M,...N&&{alignmentOffset:M}},reset:N}}}),es=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var r,n,i,s,o,a;let{placement:l,middlewareData:c,rects:u,initialPlacement:d,platform:h,elements:f}=t,{mainAxis:p=!0,crossAxis:g=!0,fallbackPlacements:m,fallbackStrategy:y="bestFit",fallbackAxisSideDirection:b="none",flipAlignment:w=!0,...v}=U(e,t);if(null!=(r=c.arrow)&&r.alignmentOffset)return{};let E=j(l),A=z(d),x=j(d)===d,S=await (null==h.isRTL?void 0:h.isRTL(f.floating)),k=m||(x||!w?[Z(d)]:K(d)),_="none"!==b;!m&&_&&k.push(...J(d,w,b,S));let I=[d,...k],T=await en(t,v),C=[],P=(null==(n=c.flip)?void 0:n.overflows)||[];if(p&&C.push(T[E]),g){let e=G(l,u,S);C.push(T[e[0]],T[e[1]])}if(P=[...P,{placement:l,overflows:C}],!C.every(e=>e<=0)){let e=((null==(i=c.flip)?void 0:i.index)||0)+1,t=I[e];if(t){let r="alignment"===g&&A!==z(t),n=(null==(o=P[0])?void 0:o.overflows[0])>0;if(!r||n)return{data:{index:e,overflows:P},reset:{placement:t}}}let r=null==(s=P.filter(e=>e.overflows[0]<=0).sort((e,t)=>e.overflows[1]-t.overflows[1])[0])?void 0:s.placement;if(!r)switch(y){case"bestFit":{let e=null==(a=P.filter(e=>{if(_){let t=z(e.placement);return t===A||"y"===t}return!0}).map(e=>[e.placement,e.overflows.filter(e=>e>0).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0])?void 0:a[0];e&&(r=e);break}case"initialPlacement":r=d}if(l!==r)return{reset:{placement:r}}}return{}}}};function eo(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function ea(e){return P.some(t=>e[t]>=0)}let el=function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(t){let{rects:r}=t,{strategy:n="referenceHidden",...i}=U(e,t);switch(n){case"referenceHidden":{let e=eo(await en(t,{...i,elementContext:"reference"}),r.reference);return{data:{referenceHiddenOffsets:e,referenceHidden:ea(e)}}}case"escaped":{let e=eo(await en(t,{...i,altBoundary:!0}),r.floating);return{data:{escapedOffsets:e,escaped:ea(e)}}}default:return{}}}}};async function ec(e,t){let{placement:r,platform:n,elements:i}=e,s=await (null==n.isRTL?void 0:n.isRTL(i.floating)),o=j(r),a=H(r),l="y"===z(r),c=["left","top"].includes(o)?-1:1,u=s&&l?-1:1,d=U(t,e),{mainAxis:h,crossAxis:f,alignmentAxis:p}="number"==typeof d?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&"number"==typeof p&&(f="end"===a?-1*p:p),l?{x:f*u,y:h*c}:{x:h*c,y:f*u}}let eu=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){var r,n;let{x:i,y:s,placement:o,middlewareData:a}=t,l=await ec(t,e);return o===(null==(r=a.offset)?void 0:r.placement)&&null!=(n=a.arrow)&&n.alignmentOffset?{}:{x:i+l.x,y:s+l.y,data:{...l,placement:o}}}}},ed=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){let{x:r,y:n,placement:i}=t,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:e=>{let{x:t,y:r}=e;return{x:t,y:r}}},...l}=U(e,t),c={x:r,y:n},u=await en(t,l),d=z(j(i)),h=$(d),f=c[h],p=c[d];if(s){let e="y"===h?"top":"left",t="y"===h?"bottom":"right",r=f+u[e],n=f-u[t];f=F(r,f,n)}if(o){let e="y"===d?"top":"left",t="y"===d?"bottom":"right",r=p+u[e],n=p-u[t];p=F(r,p,n)}let g=a.fn({...t,[h]:f,[d]:p});return{...g,data:{x:g.x-r,y:g.y-n,enabled:{[h]:s,[d]:o}}}}}},eh=function(e){return void 0===e&&(e={}),{options:e,fn(t){let{x:r,y:n,placement:i,rects:s,middlewareData:o}=t,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=U(e,t),u={x:r,y:n},d=z(i),h=$(d),f=u[h],p=u[d],g=U(a,t),m="number"==typeof g?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(l){let e="y"===h?"height":"width",t=s.reference[h]-s.floating[e]+m.mainAxis,r=s.reference[h]+s.reference[e]-m.mainAxis;f<t?f=t:f>r&&(f=r)}if(c){var y,b;let e="y"===h?"width":"height",t=["top","left"].includes(j(i)),r=s.reference[d]-s.floating[e]+(t&&(null==(y=o.offset)?void 0:y[d])||0)+(t?0:m.crossAxis),n=s.reference[d]+s.reference[e]+(t?0:(null==(b=o.offset)?void 0:b[d])||0)-(t?m.crossAxis:0);p<r?p=r:p>n&&(p=n)}return{[h]:f,[d]:p}}}},ef=function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(t){var r,n;let i,s,{placement:o,rects:a,platform:l,elements:c}=t,{apply:u=()=>{},...d}=U(e,t),h=await en(t,d),f=j(o),p=H(o),g="y"===z(o),{width:m,height:y}=a.floating;"top"===f||"bottom"===f?(i=f,s=p===(await (null==l.isRTL?void 0:l.isRTL(c.floating))?"start":"end")?"left":"right"):(s=f,i="end"===p?"top":"bottom");let b=y-h.top-h.bottom,w=m-h.left-h.right,v=R(y-h[i],b),E=R(m-h[s],w),A=!t.middlewareData.shift,x=v,S=E;if(null!=(r=t.middlewareData.shift)&&r.enabled.x&&(S=w),null!=(n=t.middlewareData.shift)&&n.enabled.y&&(x=b),A&&!p){let e=D(h.left,0),t=D(h.right,0),r=D(h.top,0),n=D(h.bottom,0);g?S=m-2*(0!==e||0!==t?e+t:D(h.left,h.right)):x=y-2*(0!==r||0!==n?r+n:D(h.top,h.bottom))}await u({...t,availableWidth:S,availableHeight:x});let k=await l.getDimensions(c.floating);return m!==k.width||y!==k.height?{reset:{rects:!0}}:{}}}};function ep(){return"undefined"!=typeof window}function eg(e){return eb(e)?(e.nodeName||"").toLowerCase():"#document"}function em(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function ey(e){var t;return null==(t=(eb(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function eb(e){return!!ep()&&(e instanceof Node||e instanceof em(e).Node)}function ew(e){return!!ep()&&(e instanceof Element||e instanceof em(e).Element)}function ev(e){return!!ep()&&(e instanceof HTMLElement||e instanceof em(e).HTMLElement)}function eE(e){return!!ep()&&"undefined"!=typeof ShadowRoot&&(e instanceof ShadowRoot||e instanceof em(e).ShadowRoot)}function eA(e){let{overflow:t,overflowX:r,overflowY:n,display:i}=eC(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!["inline","contents"].includes(i)}function ex(e){return["table","td","th"].includes(eg(e))}function eS(e){return[":popover-open",":modal"].some(t=>{try{return e.matches(t)}catch(e){return!1}})}function ek(e){let t=eI(),r=ew(e)?eC(e):e;return["transform","translate","scale","rotate","perspective"].some(e=>!!r[e]&&"none"!==r[e])||!!r.containerType&&"normal"!==r.containerType||!t&&!!r.backdropFilter&&"none"!==r.backdropFilter||!t&&!!r.filter&&"none"!==r.filter||["transform","translate","scale","rotate","perspective","filter"].some(e=>(r.willChange||"").includes(e))||["paint","layout","strict","content"].some(e=>(r.contain||"").includes(e))}function e_(e){let t=eR(e);for(;ev(t)&&!eT(t);){if(ek(t))return t;if(eS(t))break;t=eR(t)}return null}function eI(){return"undefined"!=typeof CSS&&!!CSS.supports&&CSS.supports("-webkit-backdrop-filter","none")}function eT(e){return["html","body","#document"].includes(eg(e))}function eC(e){return em(e).getComputedStyle(e)}function eP(e){return ew(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function eR(e){if("html"===eg(e))return e;let t=e.assignedSlot||e.parentNode||eE(e)&&e.host||ey(e);return eE(t)?t.host:t}function eD(e){let t=eR(e);return eT(t)?e.ownerDocument?e.ownerDocument.body:e.body:ev(t)&&eA(t)?t:eD(t)}function eN(e,t,r){var n;void 0===t&&(t=[]),void 0===r&&(r=!0);let i=eD(e),s=i===(null==(n=e.ownerDocument)?void 0:n.body),o=em(i);if(s){let e=eM(o);return t.concat(o,o.visualViewport||[],eA(i)?i:[],e&&r?eN(e):[])}return t.concat(i,eN(i,[],r))}function eM(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function eB(e){let t=eC(e),r=parseFloat(t.width)||0,n=parseFloat(t.height)||0,i=ev(e),s=i?e.offsetWidth:r,o=i?e.offsetHeight:n,a=N(r)!==s||N(n)!==o;return a&&(r=s,n=o),{width:r,height:n,$:a}}function eO(e){return ew(e)?e:e.contextElement}function eL(e){let t=eO(e);if(!ev(t))return B(1);let r=t.getBoundingClientRect(),{width:n,height:i,$:s}=eB(t),o=(s?N(r.width):r.width)/n,a=(s?N(r.height):r.height)/i;return o&&Number.isFinite(o)||(o=1),a&&Number.isFinite(a)||(a=1),{x:o,y:a}}let eF=B(0);function eU(e){let t=em(e);return eI()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:eF}function ej(e,t,r){return void 0===t&&(t=!1),!!r&&(!t||r===em(e))&&t}function eH(e,t,r,n){void 0===t&&(t=!1),void 0===r&&(r=!1);let i=e.getBoundingClientRect(),s=eO(e),o=B(1);t&&(n?ew(n)&&(o=eL(n)):o=eL(e));let a=ej(s,r,n)?eU(s):B(0),l=(i.left+a.x)/o.x,c=(i.top+a.y)/o.y,u=i.width/o.x,d=i.height/o.y;if(s){let e=em(s),t=n&&ew(n)?em(n):n,r=e,i=eM(r);for(;i&&n&&t!==r;){let e=eL(i),t=i.getBoundingClientRect(),n=eC(i),s=t.left+(i.clientLeft+parseFloat(n.paddingLeft))*e.x,o=t.top+(i.clientTop+parseFloat(n.paddingTop))*e.y;l*=e.x,c*=e.y,u*=e.x,d*=e.y,l+=s,c+=o,i=eM(r=em(i))}}return ee({width:u,height:d,x:l,y:c})}function e$(e,t){let r=eP(e).scrollLeft;return t?t.left+r:eH(ey(e)).left+r}function eq(e,t,r){void 0===r&&(r=!1);let n=e.getBoundingClientRect();return{x:n.left+t.scrollLeft-(r?0:e$(e,n)),y:n.top+t.scrollTop}}function ez(e){let t=ey(e),r=eP(e),n=e.ownerDocument.body,i=D(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),s=D(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight),o=-r.scrollLeft+e$(e),a=-r.scrollTop;return"rtl"===eC(n).direction&&(o+=D(t.clientWidth,n.clientWidth)-i),{width:i,height:s,x:o,y:a}}function eV(e,t){let r=em(e),n=ey(e),i=r.visualViewport,s=n.clientWidth,o=n.clientHeight,a=0,l=0;if(i){s=i.width,o=i.height;let e=eI();(!e||e&&"fixed"===t)&&(a=i.offsetLeft,l=i.offsetTop)}return{width:s,height:o,x:a,y:l}}function eG(e,t){let r=eH(e,!0,"fixed"===t),n=r.top+e.clientTop,i=r.left+e.clientLeft,s=ev(e)?eL(e):B(1),o=e.clientWidth*s.x,a=e.clientHeight*s.y;return{width:o,height:a,x:i*s.x,y:n*s.y}}function eK(e,t,r){let n;if("viewport"===t)n=eV(e,r);else if("document"===t)n=ez(ey(e));else if(ew(t))n=eG(t,r);else{let r=eU(e);n={x:t.x-r.x,y:t.y-r.y,width:t.width,height:t.height}}return ee(n)}function eW(e,t){let r=eR(e);return!(r===t||!ew(r)||eT(r))&&("fixed"===eC(r).position||eW(r,t))}function eQ(e,t){let r=t.get(e);if(r)return r;let n=eN(e,[],!1).filter(e=>ew(e)&&"body"!==eg(e)),i=null,s="fixed"===eC(e).position,o=s?eR(e):e;for(;ew(o)&&!eT(o);){let t=eC(o),r=ek(o);r||"fixed"!==t.position||(i=null),(s?!r&&!i:!r&&"static"===t.position&&!!i&&["absolute","fixed"].includes(i.position)||eA(o)&&!r&&eW(e,o))?n=n.filter(e=>e!==o):i=t,o=eR(o)}return t.set(e,n),n}function eJ(e,t,r){let n=ev(t),i=ey(t),s="fixed"===r,o=eH(e,!0,s,t),a={scrollLeft:0,scrollTop:0},l=B(0);function c(){l.x=e$(i)}if(n||!n&&!s)if(("body"!==eg(t)||eA(i))&&(a=eP(t)),n){let e=eH(t,!0,s,t);l.x=e.x+t.clientLeft,l.y=e.y+t.clientTop}else i&&c();s&&!n&&i&&c();let u=!i||n||s?B(0):eq(i,a);return{x:o.left+a.scrollLeft-l.x-u.x,y:o.top+a.scrollTop-l.y-u.y,width:o.width,height:o.height}}function eZ(e){return"static"===eC(e).position}function eY(e,t){if(!ev(e)||"fixed"===eC(e).position)return null;if(t)return t(e);let r=e.offsetParent;return ey(e)===r&&(r=r.ownerDocument.body),r}function eX(e,t){let r=em(e);if(eS(e))return r;if(!ev(e)){let t=eR(e);for(;t&&!eT(t);){if(ew(t)&&!eZ(t))return t;t=eR(t)}return r}let n=eY(e,t);for(;n&&ex(n)&&eZ(n);)n=eY(n,t);return n&&eT(n)&&eZ(n)&&!ek(n)?r:n||e_(e)||r}let e0=async function(e){let t=this.getOffsetParent||eX,r=this.getDimensions,n=await r(e.floating);return{reference:eJ(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}},e1={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{elements:t,rect:r,offsetParent:n,strategy:i}=e,s="fixed"===i,o=ey(n),a=!!t&&eS(t.floating);if(n===o||a&&s)return r;let l={scrollLeft:0,scrollTop:0},c=B(1),u=B(0),d=ev(n);if((d||!d&&!s)&&(("body"!==eg(n)||eA(o))&&(l=eP(n)),ev(n))){let e=eH(n);c=eL(n),u.x=e.x+n.clientLeft,u.y=e.y+n.clientTop}let h=!o||d||s?B(0):eq(o,l,!0);return{width:r.width*c.x,height:r.height*c.y,x:r.x*c.x-l.scrollLeft*c.x+u.x+h.x,y:r.y*c.y-l.scrollTop*c.y+u.y+h.y}},getDocumentElement:ey,getClippingRect:function(e){let{element:t,boundary:r,rootBoundary:n,strategy:i}=e,s=[..."clippingAncestors"===r?eS(t)?[]:eQ(t,this._c):[].concat(r),n],o=s[0],a=s.reduce((e,r)=>{let n=eK(t,r,i);return e.top=D(n.top,e.top),e.right=R(n.right,e.right),e.bottom=R(n.bottom,e.bottom),e.left=D(n.left,e.left),e},eK(t,o,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}},getOffsetParent:eX,getElementRects:e0,getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){let{width:t,height:r}=eB(e);return{width:t,height:r}},getScale:eL,isElement:ew,isRTL:function(e){return"rtl"===eC(e).direction}};function e2(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function e3(e,t){let r,n=null,i=ey(e);function s(){var e;clearTimeout(r),null==(e=n)||e.disconnect(),n=null}function o(a,l){void 0===a&&(a=!1),void 0===l&&(l=1),s();let c=e.getBoundingClientRect(),{left:u,top:d,width:h,height:f}=c;if(a||t(),!h||!f)return;let p=M(d),g=M(i.clientWidth-(u+h)),m={rootMargin:-p+"px "+-g+"px "+-M(i.clientHeight-(d+f))+"px "+-M(u)+"px",threshold:D(0,R(1,l))||1},y=!0;function b(t){let n=t[0].intersectionRatio;if(n!==l){if(!y)return o();n?o(!1,n):r=setTimeout(()=>{o(!1,1e-7)},1e3)}1!==n||e2(c,e.getBoundingClientRect())||o(),y=!1}try{n=new IntersectionObserver(b,{...m,root:i.ownerDocument})}catch(e){n=new IntersectionObserver(b,m)}n.observe(e)}return o(!0),s}function e4(e,t,r,n){let i;void 0===n&&(n={});let{ancestorScroll:s=!0,ancestorResize:o=!0,elementResize:a="function"==typeof ResizeObserver,layoutShift:l="function"==typeof IntersectionObserver,animationFrame:c=!1}=n,u=eO(e),d=s||o?[...u?eN(u):[],...eN(t)]:[];d.forEach(e=>{s&&e.addEventListener("scroll",r,{passive:!0}),o&&e.addEventListener("resize",r)});let h=u&&l?e3(u,r):null,f=-1,p=null;a&&(p=new ResizeObserver(e=>{let[n]=e;n&&n.target===u&&p&&(p.unobserve(t),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var e;null==(e=p)||e.observe(t)})),r()}),u&&!c&&p.observe(u),p.observe(t));let g=c?eH(e):null;function m(){let t=eH(e);g&&!e2(g,t)&&r(),g=t,i=requestAnimationFrame(m)}return c&&m(),r(),()=>{var e;d.forEach(e=>{s&&e.removeEventListener("scroll",r),o&&e.removeEventListener("resize",r)}),null==h||h(),null==(e=p)||e.disconnect(),p=null,c&&cancelAnimationFrame(i)}}let e5=eu,e6=ed,e8=es,e7=ef,e9=el,te=ei,tt=eh,tr=(e,t,r)=>{let n=new Map,i={platform:e1,...r},s={...i.platform,_c:n};return er(e,t,{...i,platform:s})};var tn=r(47650),ti="undefined"!=typeof document?i.useLayoutEffect:i.useEffect;function ts(e,t){let r,n,i;if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if((r=e.length)!==t.length)return!1;for(n=r;0!=n--;)if(!ts(e[n],t[n]))return!1;return!0}if((r=(i=Object.keys(e)).length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!({}).hasOwnProperty.call(t,i[n]))return!1;for(n=r;0!=n--;){let r=i[n];if(("_owner"!==r||!e.$$typeof)&&!ts(e[r],t[r]))return!1}return!0}return e!=e&&t!=t}function to(e){return"undefined"==typeof window?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function ta(e,t){let r=to(e);return Math.round(t*r)/r}function tl(e){let t=i.useRef(e);return ti(()=>{t.current=e}),t}function tc(e){void 0===e&&(e={});let{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:s,elements:{reference:o,floating:a}={},transform:l=!0,whileElementsMounted:c,open:u}=e,[d,h]=i.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[f,p]=i.useState(n);ts(f,n)||p(n);let[g,m]=i.useState(null),[y,b]=i.useState(null),w=i.useCallback(e=>{e!==x.current&&(x.current=e,m(e))},[]),v=i.useCallback(e=>{e!==S.current&&(S.current=e,b(e))},[]),E=o||g,A=a||y,x=i.useRef(null),S=i.useRef(null),k=i.useRef(d),_=null!=c,I=tl(c),T=tl(s),C=tl(u),P=i.useCallback(()=>{if(!x.current||!S.current)return;let e={placement:t,strategy:r,middleware:f};T.current&&(e.platform=T.current),tr(x.current,S.current,e).then(e=>{let t={...e,isPositioned:!1!==C.current};R.current&&!ts(k.current,t)&&(k.current=t,tn.flushSync(()=>{h(t)}))})},[f,t,r,T,C]);ti(()=>{!1===u&&k.current.isPositioned&&(k.current.isPositioned=!1,h(e=>({...e,isPositioned:!1})))},[u]);let R=i.useRef(!1);ti(()=>(R.current=!0,()=>{R.current=!1}),[]),ti(()=>{if(E&&(x.current=E),A&&(S.current=A),E&&A){if(I.current)return I.current(E,A,P);P()}},[E,A,P,I,_]);let D=i.useMemo(()=>({reference:x,floating:S,setReference:w,setFloating:v}),[w,v]),N=i.useMemo(()=>({reference:E,floating:A}),[E,A]),M=i.useMemo(()=>{let e={position:r,left:0,top:0};if(!N.floating)return e;let t=ta(N.floating,d.x),n=ta(N.floating,d.y);return l?{...e,transform:"translate("+t+"px, "+n+"px)",...to(N.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:t,top:n}},[r,l,N.floating,d.x,d.y]);return i.useMemo(()=>({...d,update:P,refs:D,elements:N,floatingStyles:M}),[d,P,D,N,M])}let tu=e=>{function t(e){return({}).hasOwnProperty.call(e,"current")}return{name:"arrow",options:e,fn(r){let{element:n,padding:i}="function"==typeof e?e(r):e;return n&&t(n)?null!=n.current?te({element:n.current,padding:i}).fn(r):{}:n?te({element:n,padding:i}).fn(r):{}}}},td=(e,t)=>({...e5(e),options:[e,t]}),th=(e,t)=>({...e6(e),options:[e,t]}),tf=(e,t)=>({...tt(e),options:[e,t]}),tp=(e,t)=>({...e8(e),options:[e,t]}),tg=(e,t)=>({...e7(e),options:[e,t]}),tm=(e,t)=>({...e9(e),options:[e,t]}),ty=(e,t)=>({...tu(e),options:[e,t]});var tb="Arrow",tw=i.forwardRef((e,t)=>{let{children:r,width:n=10,height:i=5,...s}=e;return(0,b.jsx)(c.sG.svg,{...s,ref:t,width:n,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:(0,b.jsx)("polygon",{points:"0,0 30,0 15,10"})})});tw.displayName=tb;var tv=tw,tE=r(39033),tA=r(52712);function tx(e){let[t,r]=i.useState(void 0);return(0,tA.N)(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let n,i;if(!Array.isArray(t)||!t.length)return;let s=t[0];if("borderBoxSize"in s){let e=s.borderBoxSize,t=Array.isArray(e)?e[0]:e;n=t.inlineSize,i=t.blockSize}else n=e.offsetWidth,i=e.offsetHeight;r({width:n,height:i})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}r(void 0)},[e]),t}var tS="Popper",[tk,t_]=(0,a.A)(tS),[tI,tT]=tk(tS),tC=e=>{let{__scopePopper:t,children:r}=e,[n,s]=i.useState(null);return(0,b.jsx)(tI,{scope:t,anchor:n,onAnchorChange:s,children:r})};tC.displayName=tS;var tP="PopperAnchor",tR=i.forwardRef((e,t)=>{let{__scopePopper:r,virtualRef:n,...s}=e,a=tT(tP,r),l=i.useRef(null),u=(0,o.s)(t,l);return i.useEffect(()=>{a.onAnchorChange((null==n?void 0:n.current)||l.current)}),n?null:(0,b.jsx)(c.sG.div,{...s,ref:u})});tR.displayName=tP;var tD="PopperContent",[tN,tM]=tk(tD),tB=i.forwardRef((e,t)=>{var r,n,s,a,l,u,d,h;let{__scopePopper:f,side:p="bottom",sideOffset:g=0,align:m="center",alignOffset:y=0,arrowPadding:w=0,avoidCollisions:v=!0,collisionBoundary:E=[],collisionPadding:A=0,sticky:x="partial",hideWhenDetached:S=!1,updatePositionStrategy:k="optimized",onPlaced:_,...I}=e,T=tT(tD,f),[C,P]=i.useState(null),R=(0,o.s)(t,e=>P(e)),[D,N]=i.useState(null),M=tx(D),B=null!=(d=null==M?void 0:M.width)?d:0,O=null!=(h=null==M?void 0:M.height)?h:0,L=p+("center"!==m?"-"+m:""),F="number"==typeof A?A:{top:0,right:0,bottom:0,left:0,...A},U=Array.isArray(E)?E:[E],j=U.length>0,H={padding:F,boundary:U.filter(tU),altBoundary:j},{refs:$,floatingStyles:q,placement:z,isPositioned:V,middlewareData:G}=tc({strategy:"fixed",placement:L,whileElementsMounted:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return e4(...t,{animationFrame:"always"===k})},elements:{reference:T.anchor},middleware:[td({mainAxis:g+O,alignmentAxis:y}),v&&th({mainAxis:!0,crossAxis:!1,limiter:"partial"===x?tf():void 0,...H}),v&&tp({...H}),tg({...H,apply:e=>{let{elements:t,rects:r,availableWidth:n,availableHeight:i}=e,{width:s,height:o}=r.reference,a=t.floating.style;a.setProperty("--radix-popper-available-width","".concat(n,"px")),a.setProperty("--radix-popper-available-height","".concat(i,"px")),a.setProperty("--radix-popper-anchor-width","".concat(s,"px")),a.setProperty("--radix-popper-anchor-height","".concat(o,"px"))}}),D&&ty({element:D,padding:w}),tj({arrowWidth:B,arrowHeight:O}),S&&tm({strategy:"referenceHidden",...H})]}),[K,W]=tH(z),Q=(0,tE.c)(_);(0,tA.N)(()=>{V&&(null==Q||Q())},[V,Q]);let J=null==(r=G.arrow)?void 0:r.x,Z=null==(n=G.arrow)?void 0:n.y,Y=(null==(s=G.arrow)?void 0:s.centerOffset)!==0,[X,ee]=i.useState();return(0,tA.N)(()=>{C&&ee(window.getComputedStyle(C).zIndex)},[C]),(0,b.jsx)("div",{ref:$.setFloating,"data-radix-popper-content-wrapper":"",style:{...q,transform:V?q.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:X,"--radix-popper-transform-origin":[null==(a=G.transformOrigin)?void 0:a.x,null==(l=G.transformOrigin)?void 0:l.y].join(" "),...(null==(u=G.hide)?void 0:u.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:(0,b.jsx)(tN,{scope:f,placedSide:K,onArrowChange:N,arrowX:J,arrowY:Z,shouldHideArrow:Y,children:(0,b.jsx)(c.sG.div,{"data-side":K,"data-align":W,...I,ref:R,style:{...I.style,animation:V?void 0:"none"}})})})});tB.displayName=tD;var tO="PopperArrow",tL={top:"bottom",right:"left",bottom:"top",left:"right"},tF=i.forwardRef(function(e,t){let{__scopePopper:r,...n}=e,i=tM(tO,r),s=tL[i.placedSide];return(0,b.jsx)("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[s]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:(0,b.jsx)(tv,{...n,ref:t,style:{...n.style,display:"block"}})})});function tU(e){return null!==e}tF.displayName=tO;var tj=e=>({name:"transformOrigin",options:e,fn(t){var r,n,i,s,o;let{placement:a,rects:l,middlewareData:c}=t,u=(null==(r=c.arrow)?void 0:r.centerOffset)!==0,d=u?0:e.arrowWidth,h=u?0:e.arrowHeight,[f,p]=tH(a),g={start:"0%",center:"50%",end:"100%"}[p],m=(null!=(s=null==(n=c.arrow)?void 0:n.x)?s:0)+d/2,y=(null!=(o=null==(i=c.arrow)?void 0:i.y)?o:0)+h/2,b="",w="";return"bottom"===f?(b=u?g:"".concat(m,"px"),w="".concat(-h,"px")):"top"===f?(b=u?g:"".concat(m,"px"),w="".concat(l.floating.height+h,"px")):"right"===f?(b="".concat(-h,"px"),w=u?g:"".concat(y,"px")):"left"===f&&(b="".concat(l.floating.width+h,"px"),w=u?g:"".concat(y,"px")),{data:{x:b,y:w}}}});function tH(e){let[t,r="center"]=e.split("-");return[t,r]}var t$=tC,tq=tR,tz=tB,tV=tF,tG=r(34378),tK=r(28905),tW="rovingFocusGroup.onEntryFocus",tQ={bubbles:!1,cancelable:!0},tJ="RovingFocusGroup",[tZ,tY,tX]=w(tJ),[t0,t1]=(0,a.A)(tJ,[tX]),[t2,t3]=t0(tJ),t4=i.forwardRef((e,t)=>(0,b.jsx)(tZ.Provider,{scope:e.__scopeRovingFocusGroup,children:(0,b.jsx)(tZ.Slot,{scope:e.__scopeRovingFocusGroup,children:(0,b.jsx)(t5,{...e,ref:t})})}));t4.displayName=tJ;var t5=i.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:r,orientation:n,loop:a=!1,dir:u,currentTabStopId:d,defaultCurrentTabStopId:h,onCurrentTabStopIdChange:f,onEntryFocus:p,preventScrollOnEntryFocus:g=!1,...m}=e,y=i.useRef(null),w=(0,o.s)(t,y),v=(0,k.jH)(u),[E,A]=(0,l.i)({prop:d,defaultProp:null!=h?h:null,onChange:f,caller:tJ}),[x,S]=i.useState(!1),_=(0,tE.c)(p),I=tY(r),T=i.useRef(!1),[C,P]=i.useState(0);return i.useEffect(()=>{let e=y.current;if(e)return e.addEventListener(tW,_),()=>e.removeEventListener(tW,_)},[_]),(0,b.jsx)(t2,{scope:r,orientation:n,dir:v,loop:a,currentTabStopId:E,onItemFocus:i.useCallback(e=>A(e),[A]),onItemShiftTab:i.useCallback(()=>S(!0),[]),onFocusableItemAdd:i.useCallback(()=>P(e=>e+1),[]),onFocusableItemRemove:i.useCallback(()=>P(e=>e-1),[]),children:(0,b.jsx)(c.sG.div,{tabIndex:x||0===C?-1:0,"data-orientation":n,...m,ref:w,style:{outline:"none",...e.style},onMouseDown:(0,s.m)(e.onMouseDown,()=>{T.current=!0}),onFocus:(0,s.m)(e.onFocus,e=>{let t=!T.current;if(e.target===e.currentTarget&&t&&!x){let t=new CustomEvent(tW,tQ);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=I().filter(e=>e.focusable);rt([e.find(e=>e.active),e.find(e=>e.id===E),...e].filter(Boolean).map(e=>e.ref.current),g)}}T.current=!1}),onBlur:(0,s.m)(e.onBlur,()=>S(!1))})})}),t6="RovingFocusGroupItem",t8=i.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:r,focusable:n=!0,active:o=!1,tabStopId:a,children:l,...u}=e,d=(0,C.B)(),h=a||d,f=t3(t6,r),p=f.currentTabStopId===h,g=tY(r),{onFocusableItemAdd:m,onFocusableItemRemove:y,currentTabStopId:w}=f;return i.useEffect(()=>{if(n)return m(),()=>y()},[n,m,y]),(0,b.jsx)(tZ.ItemSlot,{scope:r,id:h,focusable:n,active:o,children:(0,b.jsx)(c.sG.span,{tabIndex:p?0:-1,"data-orientation":f.orientation,...u,ref:t,onMouseDown:(0,s.m)(e.onMouseDown,e=>{n?f.onItemFocus(h):e.preventDefault()}),onFocus:(0,s.m)(e.onFocus,()=>f.onItemFocus(h)),onKeyDown:(0,s.m)(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey)return void f.onItemShiftTab();if(e.target!==e.currentTarget)return;let t=re(e,f.orientation,f.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let r=g().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)r.reverse();else if("prev"===t||"next"===t){"prev"===t&&r.reverse();let n=r.indexOf(e.currentTarget);r=f.loop?rr(r,n+1):r.slice(n+1)}setTimeout(()=>rt(r))}}),children:"function"==typeof l?l({isCurrentTabStop:p,hasTabStop:null!=w}):l})})});t8.displayName=t6;var t7={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function t9(e,t){return"rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}function re(e,t,r){let n=t9(e.key,r);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(n))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(n)))return t7[n]}function rt(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=document.activeElement;for(let n of e)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}function rr(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var rn=t4,ri=t8,rs=r(38168),ro=r(93795),ra=["Enter"," "],rl=["ArrowUp","PageDown","End"],rc=["ArrowDown","PageUp","Home",...rl],ru={ltr:[...ra,"ArrowRight"],rtl:[...ra,"ArrowLeft"]},rd={ltr:["ArrowLeft"],rtl:["ArrowRight"]},rh="Menu",[rf,rp,rg]=w(rh),[rm,ry]=(0,a.A)(rh,[rg,t_,t1]),rb=t_(),rw=t1(),[rv,rE]=rm(rh),[rA,rx]=rm(rh),rS=e=>{let{__scopeMenu:t,open:r=!1,children:n,dir:s,onOpenChange:o,modal:a=!0}=e,l=rb(t),[c,u]=i.useState(null),d=i.useRef(!1),h=(0,tE.c)(o),f=(0,k.jH)(s);return i.useEffect(()=>{let e=()=>{d.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>d.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}},[]),(0,b.jsx)(t$,{...l,children:(0,b.jsx)(rv,{scope:t,open:r,onOpenChange:h,content:c,onContentChange:u,children:(0,b.jsx)(rA,{scope:t,onClose:i.useCallback(()=>h(!1),[h]),isUsingKeyboardRef:d,dir:f,modal:a,children:n})})})};rS.displayName=rh;var rk="MenuAnchor",r_=i.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e,i=rb(r);return(0,b.jsx)(tq,{...i,...n,ref:t})});r_.displayName=rk;var rI="MenuPortal",[rT,rC]=rm(rI,{forceMount:void 0}),rP=e=>{let{__scopeMenu:t,forceMount:r,children:n,container:i}=e,s=rE(rI,t);return(0,b.jsx)(rT,{scope:t,forceMount:r,children:(0,b.jsx)(tK.C,{present:r||s.open,children:(0,b.jsx)(tG.Z,{asChild:!0,container:i,children:n})})})};rP.displayName=rI;var rR="MenuContent",[rD,rN]=rm(rR),rM=i.forwardRef((e,t)=>{let r=rC(rR,e.__scopeMenu),{forceMount:n=r.forceMount,...i}=e,s=rE(rR,e.__scopeMenu),o=rx(rR,e.__scopeMenu);return(0,b.jsx)(rf.Provider,{scope:e.__scopeMenu,children:(0,b.jsx)(tK.C,{present:n||s.open,children:(0,b.jsx)(rf.Slot,{scope:e.__scopeMenu,children:o.modal?(0,b.jsx)(rB,{...i,ref:t}):(0,b.jsx)(rO,{...i,ref:t})})})})}),rB=i.forwardRef((e,t)=>{let r=rE(rR,e.__scopeMenu),n=i.useRef(null),a=(0,o.s)(t,n);return i.useEffect(()=>{let e=n.current;if(e)return(0,rs.Eq)(e)},[]),(0,b.jsx)(rF,{...e,ref:a,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:(0,s.m)(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),rO=i.forwardRef((e,t)=>{let r=rE(rR,e.__scopeMenu);return(0,b.jsx)(rF,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),rL=(0,y.TL)("MenuContent.ScrollLock"),rF=i.forwardRef((e,t)=>{let{__scopeMenu:r,loop:n=!1,trapFocus:a,onOpenAutoFocus:l,onCloseAutoFocus:c,disableOutsidePointerEvents:u,onEntryFocus:d,onEscapeKeyDown:h,onPointerDownOutside:f,onFocusOutside:p,onInteractOutside:g,onDismiss:m,disableOutsideScroll:y,...w}=e,v=rE(rR,r),E=rx(rR,r),A=rb(r),x=rw(r),S=rp(r),[k,C]=i.useState(null),P=i.useRef(null),R=(0,o.s)(t,P,v.onContentChange),D=i.useRef(0),N=i.useRef(""),M=i.useRef(0),B=i.useRef(null),O=i.useRef("right"),L=i.useRef(0),F=y?ro.A:i.Fragment,U=y?{as:rL,allowPinchZoom:!0}:void 0,j=e=>{var t,r;let n=N.current+e,i=S().filter(e=>!e.disabled),s=document.activeElement,o=null==(t=i.find(e=>e.ref.current===s))?void 0:t.textValue,a=nh(i.map(e=>e.textValue),n,o),l=null==(r=i.find(e=>e.textValue===a))?void 0:r.ref.current;!function e(t){N.current=t,window.clearTimeout(D.current),""!==t&&(D.current=window.setTimeout(()=>e(""),1e3))}(n),l&&setTimeout(()=>l.focus())};i.useEffect(()=>()=>window.clearTimeout(D.current),[]),(0,I.Oh)();let H=i.useCallback(e=>{var t,r;return O.current===(null==(t=B.current)?void 0:t.side)&&np(e,null==(r=B.current)?void 0:r.area)},[]);return(0,b.jsx)(rD,{scope:r,searchRef:N,onItemEnter:i.useCallback(e=>{H(e)&&e.preventDefault()},[H]),onItemLeave:i.useCallback(e=>{var t;H(e)||(null==(t=P.current)||t.focus(),C(null))},[H]),onTriggerLeave:i.useCallback(e=>{H(e)&&e.preventDefault()},[H]),pointerGraceTimerRef:M,onPointerGraceIntentChange:i.useCallback(e=>{B.current=e},[]),children:(0,b.jsx)(F,{...U,children:(0,b.jsx)(T.n,{asChild:!0,trapped:a,onMountAutoFocus:(0,s.m)(l,e=>{var t;e.preventDefault(),null==(t=P.current)||t.focus({preventScroll:!0})}),onUnmountAutoFocus:c,children:(0,b.jsx)(_.qW,{asChild:!0,disableOutsidePointerEvents:u,onEscapeKeyDown:h,onPointerDownOutside:f,onFocusOutside:p,onInteractOutside:g,onDismiss:m,children:(0,b.jsx)(rn,{asChild:!0,...x,dir:E.dir,orientation:"vertical",loop:n,currentTabStopId:k,onCurrentTabStopIdChange:C,onEntryFocus:(0,s.m)(d,e=>{E.isUsingKeyboardRef.current||e.preventDefault()}),preventScrollOnEntryFocus:!0,children:(0,b.jsx)(tz,{role:"menu","aria-orientation":"vertical","data-state":na(v.open),"data-radix-menu-content":"",dir:E.dir,...A,...w,ref:R,style:{outline:"none",...w.style},onKeyDown:(0,s.m)(w.onKeyDown,e=>{let t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,r=e.ctrlKey||e.altKey||e.metaKey,n=1===e.key.length;t&&("Tab"===e.key&&e.preventDefault(),!r&&n&&j(e.key));let i=P.current;if(e.target!==i||!rc.includes(e.key))return;e.preventDefault();let s=S().filter(e=>!e.disabled).map(e=>e.ref.current);rl.includes(e.key)&&s.reverse(),nu(s)}),onBlur:(0,s.m)(e.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(D.current),N.current="")}),onPointerMove:(0,s.m)(e.onPointerMove,ng(e=>{let t=e.target,r=L.current!==e.clientX;e.currentTarget.contains(t)&&r&&(O.current=e.clientX>L.current?"right":"left",L.current=e.clientX)}))})})})})})})});rM.displayName=rR;var rU="MenuGroup",rj=i.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e;return(0,b.jsx)(c.sG.div,{role:"group",...n,ref:t})});rj.displayName=rU;var rH="MenuLabel",r$=i.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e;return(0,b.jsx)(c.sG.div,{...n,ref:t})});r$.displayName=rH;var rq="MenuItem",rz="menu.itemSelect",rV=i.forwardRef((e,t)=>{let{disabled:r=!1,onSelect:n,...a}=e,l=i.useRef(null),u=rx(rq,e.__scopeMenu),d=rN(rq,e.__scopeMenu),h=(0,o.s)(t,l),f=i.useRef(!1),p=()=>{let e=l.current;if(!r&&e){let t=new CustomEvent(rz,{bubbles:!0,cancelable:!0});e.addEventListener(rz,e=>null==n?void 0:n(e),{once:!0}),(0,c.hO)(e,t),t.defaultPrevented?f.current=!1:u.onClose()}};return(0,b.jsx)(rG,{...a,ref:h,disabled:r,onClick:(0,s.m)(e.onClick,p),onPointerDown:t=>{var r;null==(r=e.onPointerDown)||r.call(e,t),f.current=!0},onPointerUp:(0,s.m)(e.onPointerUp,e=>{var t;f.current||null==(t=e.currentTarget)||t.click()}),onKeyDown:(0,s.m)(e.onKeyDown,e=>{let t=""!==d.searchRef.current;r||t&&" "===e.key||ra.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})})});rV.displayName=rq;var rG=i.forwardRef((e,t)=>{let{__scopeMenu:r,disabled:n=!1,textValue:a,...l}=e,u=rN(rq,r),d=rw(r),h=i.useRef(null),f=(0,o.s)(t,h),[p,g]=i.useState(!1),[m,y]=i.useState("");return i.useEffect(()=>{let e=h.current;if(e){var t;y((null!=(t=e.textContent)?t:"").trim())}},[l.children]),(0,b.jsx)(rf.ItemSlot,{scope:r,disabled:n,textValue:null!=a?a:m,children:(0,b.jsx)(ri,{asChild:!0,...d,focusable:!n,children:(0,b.jsx)(c.sG.div,{role:"menuitem","data-highlighted":p?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...l,ref:f,onPointerMove:(0,s.m)(e.onPointerMove,ng(e=>{n?u.onItemLeave(e):(u.onItemEnter(e),e.defaultPrevented||e.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:(0,s.m)(e.onPointerLeave,ng(e=>u.onItemLeave(e))),onFocus:(0,s.m)(e.onFocus,()=>g(!0)),onBlur:(0,s.m)(e.onBlur,()=>g(!1))})})})}),rK="MenuCheckboxItem",rW=i.forwardRef((e,t)=>{let{checked:r=!1,onCheckedChange:n,...i}=e;return(0,b.jsx)(r2,{scope:e.__scopeMenu,checked:r,children:(0,b.jsx)(rV,{role:"menuitemcheckbox","aria-checked":nl(r)?"mixed":r,...i,ref:t,"data-state":nc(r),onSelect:(0,s.m)(i.onSelect,()=>null==n?void 0:n(!!nl(r)||!r),{checkForDefaultPrevented:!1})})})});rW.displayName=rK;var rQ="MenuRadioGroup",[rJ,rZ]=rm(rQ,{value:void 0,onValueChange:()=>{}}),rY=i.forwardRef((e,t)=>{let{value:r,onValueChange:n,...i}=e,s=(0,tE.c)(n);return(0,b.jsx)(rJ,{scope:e.__scopeMenu,value:r,onValueChange:s,children:(0,b.jsx)(rj,{...i,ref:t})})});rY.displayName=rQ;var rX="MenuRadioItem",r0=i.forwardRef((e,t)=>{let{value:r,...n}=e,i=rZ(rX,e.__scopeMenu),o=r===i.value;return(0,b.jsx)(r2,{scope:e.__scopeMenu,checked:o,children:(0,b.jsx)(rV,{role:"menuitemradio","aria-checked":o,...n,ref:t,"data-state":nc(o),onSelect:(0,s.m)(n.onSelect,()=>{var e;return null==(e=i.onValueChange)?void 0:e.call(i,r)},{checkForDefaultPrevented:!1})})})});r0.displayName=rX;var r1="MenuItemIndicator",[r2,r3]=rm(r1,{checked:!1}),r4=i.forwardRef((e,t)=>{let{__scopeMenu:r,forceMount:n,...i}=e,s=r3(r1,r);return(0,b.jsx)(tK.C,{present:n||nl(s.checked)||!0===s.checked,children:(0,b.jsx)(c.sG.span,{...i,ref:t,"data-state":nc(s.checked)})})});r4.displayName=r1;var r5="MenuSeparator",r6=i.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e;return(0,b.jsx)(c.sG.div,{role:"separator","aria-orientation":"horizontal",...n,ref:t})});r6.displayName=r5;var r8="MenuArrow",r7=i.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e,i=rb(r);return(0,b.jsx)(tV,{...i,...n,ref:t})});r7.displayName=r8;var r9="MenuSub",[ne,nt]=rm(r9),nr=e=>{let{__scopeMenu:t,children:r,open:n=!1,onOpenChange:s}=e,o=rE(r9,t),a=rb(t),[l,c]=i.useState(null),[u,d]=i.useState(null),h=(0,tE.c)(s);return i.useEffect(()=>(!1===o.open&&h(!1),()=>h(!1)),[o.open,h]),(0,b.jsx)(t$,{...a,children:(0,b.jsx)(rv,{scope:t,open:n,onOpenChange:h,content:u,onContentChange:d,children:(0,b.jsx)(ne,{scope:t,contentId:(0,C.B)(),triggerId:(0,C.B)(),trigger:l,onTriggerChange:c,children:r})})})};nr.displayName=r9;var nn="MenuSubTrigger",ni=i.forwardRef((e,t)=>{let r=rE(nn,e.__scopeMenu),n=rx(nn,e.__scopeMenu),a=nt(nn,e.__scopeMenu),l=rN(nn,e.__scopeMenu),c=i.useRef(null),{pointerGraceTimerRef:u,onPointerGraceIntentChange:d}=l,h={__scopeMenu:e.__scopeMenu},f=i.useCallback(()=>{c.current&&window.clearTimeout(c.current),c.current=null},[]);return i.useEffect(()=>f,[f]),i.useEffect(()=>{let e=u.current;return()=>{window.clearTimeout(e),d(null)}},[u,d]),(0,b.jsx)(r_,{asChild:!0,...h,children:(0,b.jsx)(rG,{id:a.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":a.contentId,"data-state":na(r.open),...e,ref:(0,o.t)(t,a.onTriggerChange),onClick:t=>{var n;null==(n=e.onClick)||n.call(e,t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:(0,s.m)(e.onPointerMove,ng(t=>{l.onItemEnter(t),!t.defaultPrevented&&(e.disabled||r.open||c.current||(l.onPointerGraceIntentChange(null),c.current=window.setTimeout(()=>{r.onOpenChange(!0),f()},100)))})),onPointerLeave:(0,s.m)(e.onPointerLeave,ng(e=>{var t,n;f();let i=null==(t=r.content)?void 0:t.getBoundingClientRect();if(i){let t=null==(n=r.content)?void 0:n.dataset.side,s="right"===t,o=s?-5:5,a=i[s?"left":"right"],c=i[s?"right":"left"];l.onPointerGraceIntentChange({area:[{x:e.clientX+o,y:e.clientY},{x:a,y:i.top},{x:c,y:i.top},{x:c,y:i.bottom},{x:a,y:i.bottom}],side:t}),window.clearTimeout(u.current),u.current=window.setTimeout(()=>l.onPointerGraceIntentChange(null),300)}else{if(l.onTriggerLeave(e),e.defaultPrevented)return;l.onPointerGraceIntentChange(null)}})),onKeyDown:(0,s.m)(e.onKeyDown,t=>{let i=""!==l.searchRef.current;if(!e.disabled&&(!i||" "!==t.key)&&ru[n.dir].includes(t.key)){var s;r.onOpenChange(!0),null==(s=r.content)||s.focus(),t.preventDefault()}})})})});ni.displayName=nn;var ns="MenuSubContent",no=i.forwardRef((e,t)=>{let r=rC(rR,e.__scopeMenu),{forceMount:n=r.forceMount,...a}=e,l=rE(rR,e.__scopeMenu),c=rx(rR,e.__scopeMenu),u=nt(ns,e.__scopeMenu),d=i.useRef(null),h=(0,o.s)(t,d);return(0,b.jsx)(rf.Provider,{scope:e.__scopeMenu,children:(0,b.jsx)(tK.C,{present:n||l.open,children:(0,b.jsx)(rf.Slot,{scope:e.__scopeMenu,children:(0,b.jsx)(rF,{id:u.contentId,"aria-labelledby":u.triggerId,...a,ref:h,align:"start",side:"rtl"===c.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{var t;c.isUsingKeyboardRef.current&&(null==(t=d.current)||t.focus()),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:(0,s.m)(e.onFocusOutside,e=>{e.target!==u.trigger&&l.onOpenChange(!1)}),onEscapeKeyDown:(0,s.m)(e.onEscapeKeyDown,e=>{c.onClose(),e.preventDefault()}),onKeyDown:(0,s.m)(e.onKeyDown,e=>{let t=e.currentTarget.contains(e.target),r=rd[c.dir].includes(e.key);if(t&&r){var n;l.onOpenChange(!1),null==(n=u.trigger)||n.focus(),e.preventDefault()}})})})})})});function na(e){return e?"open":"closed"}function nl(e){return"indeterminate"===e}function nc(e){return nl(e)?"indeterminate":e?"checked":"unchecked"}function nu(e){let t=document.activeElement;for(let r of e)if(r===t||(r.focus(),document.activeElement!==t))return}function nd(e,t){return e.map((r,n)=>e[(t+n)%e.length])}function nh(e,t,r){let n=t.length>1&&Array.from(t).every(e=>e===t[0])?t[0]:t,i=r?e.indexOf(r):-1,s=nd(e,Math.max(i,0));1===n.length&&(s=s.filter(e=>e!==r));let o=s.find(e=>e.toLowerCase().startsWith(n.toLowerCase()));return o!==r?o:void 0}function nf(e,t){let{x:r,y:n}=e,i=!1;for(let e=0,s=t.length-1;e<t.length;s=e++){let o=t[e],a=t[s],l=o.x,c=o.y,u=a.x,d=a.y;c>n!=d>n&&r<(u-l)*(n-c)/(d-c)+l&&(i=!i)}return i}function np(e,t){return!!t&&nf({x:e.clientX,y:e.clientY},t)}function ng(e){return t=>"mouse"===t.pointerType?e(t):void 0}no.displayName=ns;var nm=rS,ny=r_,nb=rP,nw=rM,nv=rj,nE=r$,nA=rV,nx=rW,nS=rY,nk=r0,n_=r4,nI=r6,nT=r7,nC=nr,nP=ni,nR=no,nD="DropdownMenu",[nN,nM]=(0,a.A)(nD,[ry]),nB=ry(),[nO,nL]=nN(nD),nF=e=>{let{__scopeDropdownMenu:t,children:r,dir:n,open:s,defaultOpen:o,onOpenChange:a,modal:c=!0}=e,u=nB(t),d=i.useRef(null),[h,f]=(0,l.i)({prop:s,defaultProp:null!=o&&o,onChange:a,caller:nD});return(0,b.jsx)(nO,{scope:t,triggerId:(0,C.B)(),triggerRef:d,contentId:(0,C.B)(),open:h,onOpenChange:f,onOpenToggle:i.useCallback(()=>f(e=>!e),[f]),modal:c,children:(0,b.jsx)(nm,{...u,open:h,onOpenChange:f,dir:n,modal:c,children:r})})};nF.displayName=nD;var nU="DropdownMenuTrigger",nj=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,disabled:n=!1,...i}=e,a=nL(nU,r),l=nB(r);return(0,b.jsx)(ny,{asChild:!0,...l,children:(0,b.jsx)(c.sG.button,{type:"button",id:a.triggerId,"aria-haspopup":"menu","aria-expanded":a.open,"aria-controls":a.open?a.contentId:void 0,"data-state":a.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...i,ref:(0,o.t)(t,a.triggerRef),onPointerDown:(0,s.m)(e.onPointerDown,e=>{!n&&0===e.button&&!1===e.ctrlKey&&(a.onOpenToggle(),a.open||e.preventDefault())}),onKeyDown:(0,s.m)(e.onKeyDown,e=>{!n&&(["Enter"," "].includes(e.key)&&a.onOpenToggle(),"ArrowDown"===e.key&&a.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})})})});nj.displayName=nU;var nH=e=>{let{__scopeDropdownMenu:t,...r}=e,n=nB(t);return(0,b.jsx)(nb,{...n,...r})};nH.displayName="DropdownMenuPortal";var n$="DropdownMenuContent",nq=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,o=nL(n$,r),a=nB(r),l=i.useRef(!1);return(0,b.jsx)(nw,{id:o.contentId,"aria-labelledby":o.triggerId,...a,...n,ref:t,onCloseAutoFocus:(0,s.m)(e.onCloseAutoFocus,e=>{var t;l.current||null==(t=o.triggerRef.current)||t.focus(),l.current=!1,e.preventDefault()}),onInteractOutside:(0,s.m)(e.onInteractOutside,e=>{let t=e.detail.originalEvent,r=0===t.button&&!0===t.ctrlKey,n=2===t.button||r;(!o.modal||n)&&(l.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});nq.displayName=n$;var nz="DropdownMenuGroup",nV=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nv,{...i,...n,ref:t})});nV.displayName=nz;var nG="DropdownMenuLabel",nK=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nE,{...i,...n,ref:t})});nK.displayName=nG;var nW="DropdownMenuItem",nQ=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nA,{...i,...n,ref:t})});nQ.displayName=nW;var nJ="DropdownMenuCheckboxItem",nZ=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nx,{...i,...n,ref:t})});nZ.displayName=nJ;var nY="DropdownMenuRadioGroup",nX=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nS,{...i,...n,ref:t})});nX.displayName=nY;var n0="DropdownMenuRadioItem",n1=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nk,{...i,...n,ref:t})});n1.displayName=n0;var n2="DropdownMenuItemIndicator",n3=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(n_,{...i,...n,ref:t})});n3.displayName=n2;var n4="DropdownMenuSeparator",n5=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nI,{...i,...n,ref:t})});n5.displayName=n4;var n6="DropdownMenuArrow";i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nT,{...i,...n,ref:t})}).displayName=n6;var n8=e=>{let{__scopeDropdownMenu:t,children:r,open:n,onOpenChange:i,defaultOpen:s}=e,o=nB(t),[a,c]=(0,l.i)({prop:n,defaultProp:null!=s&&s,onChange:i,caller:"DropdownMenuSub"});return(0,b.jsx)(nC,{...o,open:a,onOpenChange:c,children:r})},n7="DropdownMenuSubTrigger",n9=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nP,{...i,...n,ref:t})});n9.displayName=n7;var ie="DropdownMenuSubContent",it=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nR,{...i,...n,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});it.displayName=ie;var ir=nF,ii=nj,is=nH,io=nq,ia=nV,il=nK,ic=nQ,iu=nZ,id=nX,ih=n1,ip=n3,ig=n5,im=n8,iy=n9,ib=it},50271:(e,t,r)=>{var n="/",i=r(49509);!function(){var t={189:function(){!function(e,t){"use strict";if(!e.setImmediate){var r,n=1,s={},o=!1,a=e.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(e);l=l&&l.setTimeout?l:e,"[object process]"===({}).toString.call(e.process)?f():p()?g():e.MessageChannel?m():a&&"onreadystatechange"in a.createElement("script")?y():b(),l.setImmediate=c,l.clearImmediate=u}function c(e){"function"!=typeof e&&(e=Function(""+e));for(var t=Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var o={callback:e,args:t};return s[n]=o,r(n),n++}function u(e){delete s[e]}function d(e){var r=e.callback,n=e.args;switch(n.length){case 0:r();break;case 1:r(n[0]);break;case 2:r(n[0],n[1]);break;case 3:r(n[0],n[1],n[2]);break;default:r.apply(t,n)}}function h(e){if(o)setTimeout(h,0,e);else{var t=s[e];if(t){o=!0;try{d(t)}finally{u(e),o=!1}}}}function f(){r=function(e){i.nextTick(function(){h(e)})}}function p(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}function g(){var t="setImmediate$"+Math.random()+"$",n=function(r){r.source===e&&"string"==typeof r.data&&0===r.data.indexOf(t)&&h(+r.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),r=function(r){e.postMessage(t+r,"*")}}function m(){var e=new MessageChannel;e.port1.onmessage=function(e){h(e.data)},r=function(t){e.port2.postMessage(t)}}function y(){var e=a.documentElement;r=function(t){var r=a.createElement("script");r.onreadystatechange=function(){h(t),r.onreadystatechange=null,e.removeChild(r),r=null},e.appendChild(r)}}function b(){r=function(e){setTimeout(h,0,e)}}}("undefined"==typeof self?void 0===r.g?this:r.g:self)}};"undefined"!=typeof __nccwpck_require__&&(__nccwpck_require__.ab=n+"/");var s={};t[189](),e.exports=s}()},51476:e=>{var t=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},r=-1,n=1,i=0;t.Diff=function(e,t){return[e,t]},t.prototype.diff_main=function(e,r,n,s){void 0===s&&(s=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var o=s;if(null==e||null==r)throw Error("Null input. (diff_main)");if(e==r)return e?[new t.Diff(i,e)]:[];void 0===n&&(n=!0);var a=n,l=this.diff_commonPrefix(e,r),c=e.substring(0,l);e=e.substring(l),r=r.substring(l),l=this.diff_commonSuffix(e,r);var u=e.substring(e.length-l);e=e.substring(0,e.length-l),r=r.substring(0,r.length-l);var d=this.diff_compute_(e,r,a,o);return c&&d.unshift(new t.Diff(i,c)),u&&d.push(new t.Diff(i,u)),this.diff_cleanupMerge(d),d},t.prototype.diff_compute_=function(e,s,o,a){if(!e)return[new t.Diff(n,s)];if(!s)return[new t.Diff(r,e)];var l,c=e.length>s.length?e:s,u=e.length>s.length?s:e,d=c.indexOf(u);if(-1!=d)return l=[new t.Diff(n,c.substring(0,d)),new t.Diff(i,u),new t.Diff(n,c.substring(d+u.length))],e.length>s.length&&(l[0][0]=l[2][0]=r),l;if(1==u.length)return[new t.Diff(r,e),new t.Diff(n,s)];var h=this.diff_halfMatch_(e,s);if(h){var f=h[0],p=h[1],g=h[2],m=h[3],y=h[4],b=this.diff_main(f,g,o,a),w=this.diff_main(p,m,o,a);return b.concat([new t.Diff(i,y)],w)}return o&&e.length>100&&s.length>100?this.diff_lineMode_(e,s,a):this.diff_bisect_(e,s,a)},t.prototype.diff_lineMode_=function(e,s,o){var a=this.diff_linesToChars_(e,s);e=a.chars1,s=a.chars2;var l=a.lineArray,c=this.diff_main(e,s,!1,o);this.diff_charsToLines_(c,l),this.diff_cleanupSemantic(c),c.push(new t.Diff(i,""));for(var u=0,d=0,h=0,f="",p="";u<c.length;){switch(c[u][0]){case n:h++,p+=c[u][1];break;case r:d++,f+=c[u][1];break;case i:if(d>=1&&h>=1){c.splice(u-d-h,d+h),u=u-d-h;for(var g=this.diff_main(f,p,!1,o),m=g.length-1;m>=0;m--)c.splice(u,0,g[m]);u+=g.length}h=0,d=0,f="",p=""}u++}return c.pop(),c},t.prototype.diff_bisect_=function(e,i,s){for(var o=e.length,a=i.length,l=Math.ceil((o+a)/2),c=l,u=2*l,d=Array(u),h=Array(u),f=0;f<u;f++)d[f]=-1,h[f]=-1;d[c+1]=0,h[c+1]=0;for(var p=o-a,g=p%2!=0,m=0,y=0,b=0,w=0,v=0;v<l&&!(new Date().getTime()>s);v++){for(var E=-v+m;E<=v-y;E+=2){for(var A,x=c+E,S=(A=E==-v||E!=v&&d[x-1]<d[x+1]?d[x+1]:d[x-1]+1)-E;A<o&&S<a&&e.charAt(A)==i.charAt(S);)A++,S++;if(d[x]=A,A>o)y+=2;else if(S>a)m+=2;else if(g){var k=c+p-E;if(k>=0&&k<u&&-1!=h[k]){var _=o-h[k];if(A>=_)return this.diff_bisectSplit_(e,i,A,S,s)}}}for(var I=-v+b;I<=v-w;I+=2){for(var _,k=c+I,T=(_=I==-v||I!=v&&h[k-1]<h[k+1]?h[k+1]:h[k-1]+1)-I;_<o&&T<a&&e.charAt(o-_-1)==i.charAt(a-T-1);)_++,T++;if(h[k]=_,_>o)w+=2;else if(T>a)b+=2;else if(!g){var x=c+p-I;if(x>=0&&x<u&&-1!=d[x]){var A=d[x],S=c+A-x;if(A>=(_=o-_))return this.diff_bisectSplit_(e,i,A,S,s)}}}}return[new t.Diff(r,e),new t.Diff(n,i)]},t.prototype.diff_bisectSplit_=function(e,t,r,n,i){var s=e.substring(0,r),o=t.substring(0,n),a=e.substring(r),l=t.substring(n),c=this.diff_main(s,o,!1,i),u=this.diff_main(a,l,!1,i);return c.concat(u)},t.prototype.diff_linesToChars_=function(e,t){var r=[],n={};function i(e){for(var t="",i=0,o=-1,a=r.length;o<e.length-1;){-1==(o=e.indexOf("\n",i))&&(o=e.length-1);var l=e.substring(i,o+1);(n.hasOwnProperty?n.hasOwnProperty(l):void 0!==n[l])?t+=String.fromCharCode(n[l]):(a==s&&(l=e.substring(i),o=e.length),t+=String.fromCharCode(a),n[l]=a,r[a++]=l),i=o+1}return t}r[0]="";var s=4e4,o=i(e);return s=65535,{chars1:o,chars2:i(t),lineArray:r}},t.prototype.diff_charsToLines_=function(e,t){for(var r=0;r<e.length;r++){for(var n=e[r][1],i=[],s=0;s<n.length;s++)i[s]=t[n.charCodeAt(s)];e[r][1]=i.join("")}},t.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var r=0,n=Math.min(e.length,t.length),i=n,s=0;r<i;)e.substring(s,i)==t.substring(s,i)?s=r=i:n=i,i=Math.floor((n-r)/2+r);return i},t.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var r=0,n=Math.min(e.length,t.length),i=n,s=0;r<i;)e.substring(e.length-i,e.length-s)==t.substring(t.length-i,t.length-s)?s=r=i:n=i,i=Math.floor((n-r)/2+r);return i},t.prototype.diff_commonOverlap_=function(e,t){var r=e.length,n=t.length;if(0==r||0==n)return 0;r>n?e=e.substring(r-n):r<n&&(t=t.substring(0,r));var i=Math.min(r,n);if(e==t)return i;for(var s=0,o=1;;){var a=e.substring(i-o),l=t.indexOf(a);if(-1==l)return s;o+=l,(0==l||e.substring(i-o)==t.substring(0,o))&&(s=o,o++)}},t.prototype.diff_halfMatch_=function(e,t){if(this.Diff_Timeout<=0)return null;var r,n,i,s,o,a=e.length>t.length?e:t,l=e.length>t.length?t:e;if(a.length<4||2*l.length<a.length)return null;var c=this;function u(e,t,r){for(var n,i,s,o,a=e.substring(r,r+Math.floor(e.length/4)),l=-1,u="";-1!=(l=t.indexOf(a,l+1));){var d=c.diff_commonPrefix(e.substring(r),t.substring(l)),h=c.diff_commonSuffix(e.substring(0,r),t.substring(0,l));u.length<h+d&&(u=t.substring(l-h,l)+t.substring(l,l+d),n=e.substring(0,r-h),i=e.substring(r+d),s=t.substring(0,l-h),o=t.substring(l+d))}return 2*u.length>=e.length?[n,i,s,o,u]:null}var d=u(a,l,Math.ceil(a.length/4)),h=u(a,l,Math.ceil(a.length/2));return d||h?(r=h?d&&d[4].length>h[4].length?d:h:d,e.length>t.length?(n=r[0],i=r[1],s=r[2],o=r[3]):(s=r[0],o=r[1],n=r[2],i=r[3]),[n,i,s,o,r[4]]):null},t.prototype.diff_cleanupSemantic=function(e){for(var s=!1,o=[],a=0,l=null,c=0,u=0,d=0,h=0,f=0;c<e.length;)e[c][0]==i?(o[a++]=c,u=h,d=f,h=0,f=0,l=e[c][1]):(e[c][0]==n?h+=e[c][1].length:f+=e[c][1].length,l&&l.length<=Math.max(u,d)&&l.length<=Math.max(h,f)&&(e.splice(o[a-1],0,new t.Diff(r,l)),e[o[a-1]+1][0]=n,a--,c=--a>0?o[a-1]:-1,u=0,d=0,h=0,f=0,l=null,s=!0)),c++;for(s&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),c=1;c<e.length;){if(e[c-1][0]==r&&e[c][0]==n){var p=e[c-1][1],g=e[c][1],m=this.diff_commonOverlap_(p,g),y=this.diff_commonOverlap_(g,p);m>=y?(m>=p.length/2||m>=g.length/2)&&(e.splice(c,0,new t.Diff(i,g.substring(0,m))),e[c-1][1]=p.substring(0,p.length-m),e[c+1][1]=g.substring(m),c++):(y>=p.length/2||y>=g.length/2)&&(e.splice(c,0,new t.Diff(i,p.substring(0,y))),e[c-1][0]=n,e[c-1][1]=g.substring(0,g.length-y),e[c+1][0]=r,e[c+1][1]=p.substring(y),c++),c++}c++}},t.prototype.diff_cleanupSemanticLossless=function(e){function r(e,r){if(!e||!r)return 6;var n=e.charAt(e.length-1),i=r.charAt(0),s=n.match(t.nonAlphaNumericRegex_),o=i.match(t.nonAlphaNumericRegex_),a=s&&n.match(t.whitespaceRegex_),l=o&&i.match(t.whitespaceRegex_),c=a&&n.match(t.linebreakRegex_),u=l&&i.match(t.linebreakRegex_),d=c&&e.match(t.blanklineEndRegex_),h=u&&r.match(t.blanklineStartRegex_);if(d||h)return 5;if(c||u)return 4;if(s&&!a&&l)return 3;if(a||l)return 2;if(s||o)return 1;return 0}for(var n=1;n<e.length-1;){if(e[n-1][0]==i&&e[n+1][0]==i){var s=e[n-1][1],o=e[n][1],a=e[n+1][1],l=this.diff_commonSuffix(s,o);if(l){var c=o.substring(o.length-l);s=s.substring(0,s.length-l),o=c+o.substring(0,o.length-l),a=c+a}for(var u=s,d=o,h=a,f=r(s,o)+r(o,a);o.charAt(0)===a.charAt(0);){s+=o.charAt(0),o=o.substring(1)+a.charAt(0),a=a.substring(1);var p=r(s,o)+r(o,a);p>=f&&(f=p,u=s,d=o,h=a)}e[n-1][1]!=u&&(u?e[n-1][1]=u:(e.splice(n-1,1),n--),e[n][1]=d,h?e[n+1][1]=h:(e.splice(n+1,1),n--))}n++}},t.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,t.whitespaceRegex_=/\s/,t.linebreakRegex_=/[\r\n]/,t.blanklineEndRegex_=/\n\r?\n$/,t.blanklineStartRegex_=/^\r?\n\r?\n/,t.prototype.diff_cleanupEfficiency=function(e){for(var s=!1,o=[],a=0,l=null,c=0,u=!1,d=!1,h=!1,f=!1;c<e.length;)e[c][0]==i?(e[c][1].length<this.Diff_EditCost&&(h||f)?(o[a++]=c,u=h,d=f,l=e[c][1]):(a=0,l=null),h=f=!1):(e[c][0]==r?f=!0:h=!0,l&&(u&&d&&h&&f||l.length<this.Diff_EditCost/2&&u+d+h+f==3)&&(e.splice(o[a-1],0,new t.Diff(r,l)),e[o[a-1]+1][0]=n,a--,l=null,u&&d?(h=f=!0,a=0):(c=--a>0?o[a-1]:-1,h=f=!1),s=!0)),c++;s&&this.diff_cleanupMerge(e)},t.prototype.diff_cleanupMerge=function(e){e.push(new t.Diff(i,""));for(var s,o=0,a=0,l=0,c="",u="";o<e.length;)switch(e[o][0]){case n:l++,u+=e[o][1],o++;break;case r:a++,c+=e[o][1],o++;break;case i:a+l>1?(0!==a&&0!==l&&(0!==(s=this.diff_commonPrefix(u,c))&&(o-a-l>0&&e[o-a-l-1][0]==i?e[o-a-l-1][1]+=u.substring(0,s):(e.splice(0,0,new t.Diff(i,u.substring(0,s))),o++),u=u.substring(s),c=c.substring(s)),0!==(s=this.diff_commonSuffix(u,c))&&(e[o][1]=u.substring(u.length-s)+e[o][1],u=u.substring(0,u.length-s),c=c.substring(0,c.length-s))),o-=a+l,e.splice(o,a+l),c.length&&(e.splice(o,0,new t.Diff(r,c)),o++),u.length&&(e.splice(o,0,new t.Diff(n,u)),o++),o++):0!==o&&e[o-1][0]==i?(e[o-1][1]+=e[o][1],e.splice(o,1)):o++,l=0,a=0,c="",u=""}""===e[e.length-1][1]&&e.pop();var d=!1;for(o=1;o<e.length-1;)e[o-1][0]==i&&e[o+1][0]==i&&(e[o][1].substring(e[o][1].length-e[o-1][1].length)==e[o-1][1]?(e[o][1]=e[o-1][1]+e[o][1].substring(0,e[o][1].length-e[o-1][1].length),e[o+1][1]=e[o-1][1]+e[o+1][1],e.splice(o-1,1),d=!0):e[o][1].substring(0,e[o+1][1].length)==e[o+1][1]&&(e[o-1][1]+=e[o+1][1],e[o][1]=e[o][1].substring(e[o+1][1].length)+e[o+1][1],e.splice(o+1,1),d=!0)),o++;d&&this.diff_cleanupMerge(e)},t.prototype.diff_xIndex=function(e,t){var i,s=0,o=0,a=0,l=0;for(i=0;i<e.length&&(e[i][0]!==n&&(s+=e[i][1].length),e[i][0]!==r&&(o+=e[i][1].length),!(s>t));i++)a=s,l=o;return e.length!=i&&e[i][0]===r?l:l+(t-a)},t.prototype.diff_prettyHtml=function(e){for(var t=[],s=/&/g,o=/</g,a=/>/g,l=/\n/g,c=0;c<e.length;c++){var u=e[c][0],d=e[c][1].replace(s,"&amp;").replace(o,"&lt;").replace(a,"&gt;").replace(l,"&para;<br>");switch(u){case n:t[c]='<ins style="background:#e6ffe6;">'+d+"</ins>";break;case r:t[c]='<del style="background:#ffe6e6;">'+d+"</del>";break;case i:t[c]="<span>"+d+"</span>"}}return t.join("")},t.prototype.diff_text1=function(e){for(var t=[],r=0;r<e.length;r++)e[r][0]!==n&&(t[r]=e[r][1]);return t.join("")},t.prototype.diff_text2=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==r&&(t[n]=e[n][1]);return t.join("")},t.prototype.diff_levenshtein=function(e){for(var t=0,s=0,o=0,a=0;a<e.length;a++){var l=e[a][0],c=e[a][1];switch(l){case n:s+=c.length;break;case r:o+=c.length;break;case i:t+=Math.max(s,o),s=0,o=0}}return t+Math.max(s,o)},t.prototype.diff_toDelta=function(e){for(var t=[],s=0;s<e.length;s++)switch(e[s][0]){case n:t[s]="+"+encodeURI(e[s][1]);break;case r:t[s]="-"+e[s][1].length;break;case i:t[s]="="+e[s][1].length}return t.join("	").replace(/%20/g," ")},t.prototype.diff_fromDelta=function(e,s){for(var o=[],a=0,l=0,c=s.split(/\t/g),u=0;u<c.length;u++){var d=c[u].substring(1);switch(c[u].charAt(0)){case"+":try{o[a++]=new t.Diff(n,decodeURI(d))}catch(e){throw Error("Illegal escape in diff_fromDelta: "+d)}break;case"-":case"=":var h=parseInt(d,10);if(isNaN(h)||h<0)throw Error("Invalid number in diff_fromDelta: "+d);var f=e.substring(l,l+=h);"="==c[u].charAt(0)?o[a++]=new t.Diff(i,f):o[a++]=new t.Diff(r,f);break;default:if(c[u])throw Error("Invalid diff operation in diff_fromDelta: "+c[u])}}if(l!=e.length)throw Error("Delta length ("+l+") does not equal source text length ("+e.length+").");return o},t.prototype.match_main=function(e,t,r){if(null==e||null==t||null==r)throw Error("Null input. (match_main)");return(r=Math.max(0,Math.min(r,e.length)),e==t)?0:e.length?e.substring(r,r+t.length)==t?r:this.match_bitap_(e,t,r):-1},t.prototype.match_bitap_=function(e,t,r){if(t.length>this.Match_MaxBits)throw Error("Pattern too long for this browser.");var n,i,s,o=this.match_alphabet_(t),a=this;function l(e,n){var i=e/t.length,s=Math.abs(r-n);return a.Match_Distance?i+s/a.Match_Distance:s?1:i}var c=this.Match_Threshold,u=e.indexOf(t,r);-1!=u&&(c=Math.min(l(0,u),c),-1!=(u=e.lastIndexOf(t,r+t.length))&&(c=Math.min(l(0,u),c)));var d=1<<t.length-1;u=-1;for(var h=t.length+e.length,f=0;f<t.length;f++){for(n=0,i=h;n<i;)l(f,r+i)<=c?n=i:h=i,i=Math.floor((h-n)/2+n);h=i;var p=Math.max(1,r-i+1),g=Math.min(r+i,e.length)+t.length,m=Array(g+2);m[g+1]=(1<<f)-1;for(var y=g;y>=p;y--){var b=o[e.charAt(y-1)];if(0===f?m[y]=(m[y+1]<<1|1)&b:m[y]=(m[y+1]<<1|1)&b|((s[y+1]|s[y])<<1|1)|s[y+1],m[y]&d){var w=l(f,y-1);if(w<=c)if(c=w,(u=y-1)>r)p=Math.max(1,2*r-u);else break}}if(l(f+1,r)>c)break;s=m}return u},t.prototype.match_alphabet_=function(e){for(var t={},r=0;r<e.length;r++)t[e.charAt(r)]=0;for(var r=0;r<e.length;r++)t[e.charAt(r)]|=1<<e.length-r-1;return t},t.prototype.patch_addContext_=function(e,r){if(0!=r.length){if(null===e.start2)throw Error("patch not initialized");for(var n=r.substring(e.start2,e.start2+e.length1),s=0;r.indexOf(n)!=r.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)s+=this.Patch_Margin,n=r.substring(e.start2-s,e.start2+e.length1+s);s+=this.Patch_Margin;var o=r.substring(e.start2-s,e.start2);o&&e.diffs.unshift(new t.Diff(i,o));var a=r.substring(e.start2+e.length1,e.start2+e.length1+s);a&&e.diffs.push(new t.Diff(i,a)),e.start1-=o.length,e.start2-=o.length,e.length1+=o.length+a.length,e.length2+=o.length+a.length}},t.prototype.patch_make=function(e,s,o){if("string"==typeof e&&"string"==typeof s&&void 0===o)a=e,(l=this.diff_main(a,s,!0)).length>2&&(this.diff_cleanupSemantic(l),this.diff_cleanupEfficiency(l));else if(e&&"object"==typeof e&&void 0===s&&void 0===o)l=e,a=this.diff_text1(l);else if("string"==typeof e&&s&&"object"==typeof s&&void 0===o)a=e,l=s;else if("string"==typeof e&&"string"==typeof s&&o&&"object"==typeof o)a=e,l=o;else throw Error("Unknown call format to patch_make.");if(0===l.length)return[];for(var a,l,c=[],u=new t.patch_obj,d=0,h=0,f=0,p=a,g=a,m=0;m<l.length;m++){var y=l[m][0],b=l[m][1];switch(!d&&y!==i&&(u.start1=h,u.start2=f),y){case n:u.diffs[d++]=l[m],u.length2+=b.length,g=g.substring(0,f)+b+g.substring(f);break;case r:u.length1+=b.length,u.diffs[d++]=l[m],g=g.substring(0,f)+g.substring(f+b.length);break;case i:b.length<=2*this.Patch_Margin&&d&&l.length!=m+1?(u.diffs[d++]=l[m],u.length1+=b.length,u.length2+=b.length):b.length>=2*this.Patch_Margin&&d&&(this.patch_addContext_(u,p),c.push(u),u=new t.patch_obj,d=0,p=g,h=f)}y!==n&&(h+=b.length),y!==r&&(f+=b.length)}return d&&(this.patch_addContext_(u,p),c.push(u)),c},t.prototype.patch_deepCopy=function(e){for(var r=[],n=0;n<e.length;n++){var i=e[n],s=new t.patch_obj;s.diffs=[];for(var o=0;o<i.diffs.length;o++)s.diffs[o]=new t.Diff(i.diffs[o][0],i.diffs[o][1]);s.start1=i.start1,s.start2=i.start2,s.length1=i.length1,s.length2=i.length2,r[n]=s}return r},t.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var s=this.patch_addPadding(e);t=s+t+s,this.patch_splitMax(e);for(var o=0,a=[],l=0;l<e.length;l++){var c=e[l].start2+o,u=this.diff_text1(e[l].diffs),d=-1;if(u.length>this.Match_MaxBits?-1!=(f=this.match_main(t,u.substring(0,this.Match_MaxBits),c))&&(-1==(d=this.match_main(t,u.substring(u.length-this.Match_MaxBits),c+u.length-this.Match_MaxBits))||f>=d)&&(f=-1):f=this.match_main(t,u,c),-1==f)a[l]=!1,o-=e[l].length2-e[l].length1;else if(a[l]=!0,o=f-c,p=-1==d?t.substring(f,f+u.length):t.substring(f,d+this.Match_MaxBits),u==p)t=t.substring(0,f)+this.diff_text2(e[l].diffs)+t.substring(f+u.length);else{var h=this.diff_main(u,p,!1);if(u.length>this.Match_MaxBits&&this.diff_levenshtein(h)/u.length>this.Patch_DeleteThreshold)a[l]=!1;else{this.diff_cleanupSemanticLossless(h);for(var f,p,g,m=0,y=0;y<e[l].diffs.length;y++){var b=e[l].diffs[y];b[0]!==i&&(g=this.diff_xIndex(h,m)),b[0]===n?t=t.substring(0,f+g)+b[1]+t.substring(f+g):b[0]===r&&(t=t.substring(0,f+g)+t.substring(f+this.diff_xIndex(h,m+b[1].length))),b[0]!==r&&(m+=b[1].length)}}}}return[t=t.substring(s.length,t.length-s.length),a]},t.prototype.patch_addPadding=function(e){for(var r=this.Patch_Margin,n="",s=1;s<=r;s++)n+=String.fromCharCode(s);for(var s=0;s<e.length;s++)e[s].start1+=r,e[s].start2+=r;var o=e[0],a=o.diffs;if(0==a.length||a[0][0]!=i)a.unshift(new t.Diff(i,n)),o.start1-=r,o.start2-=r,o.length1+=r,o.length2+=r;else if(r>a[0][1].length){var l=r-a[0][1].length;a[0][1]=n.substring(a[0][1].length)+a[0][1],o.start1-=l,o.start2-=l,o.length1+=l,o.length2+=l}if(0==(a=(o=e[e.length-1]).diffs).length||a[a.length-1][0]!=i)a.push(new t.Diff(i,n)),o.length1+=r,o.length2+=r;else if(r>a[a.length-1][1].length){var l=r-a[a.length-1][1].length;a[a.length-1][1]+=n.substring(0,l),o.length1+=l,o.length2+=l}return n},t.prototype.patch_splitMax=function(e){for(var s=this.Match_MaxBits,o=0;o<e.length;o++)if(!(e[o].length1<=s)){var a=e[o];e.splice(o--,1);for(var l=a.start1,c=a.start2,u="";0!==a.diffs.length;){var d=new t.patch_obj,h=!0;for(d.start1=l-u.length,d.start2=c-u.length,""!==u&&(d.length1=d.length2=u.length,d.diffs.push(new t.Diff(i,u)));0!==a.diffs.length&&d.length1<s-this.Patch_Margin;){var f=a.diffs[0][0],p=a.diffs[0][1];f===n?(d.length2+=p.length,c+=p.length,d.diffs.push(a.diffs.shift()),h=!1):f===r&&1==d.diffs.length&&d.diffs[0][0]==i&&p.length>2*s?(d.length1+=p.length,l+=p.length,h=!1,d.diffs.push(new t.Diff(f,p)),a.diffs.shift()):(p=p.substring(0,s-d.length1-this.Patch_Margin),d.length1+=p.length,l+=p.length,f===i?(d.length2+=p.length,c+=p.length):h=!1,d.diffs.push(new t.Diff(f,p)),p==a.diffs[0][1]?a.diffs.shift():a.diffs[0][1]=a.diffs[0][1].substring(p.length))}u=(u=this.diff_text2(d.diffs)).substring(u.length-this.Patch_Margin);var g=this.diff_text1(a.diffs).substring(0,this.Patch_Margin);""!==g&&(d.length1+=g.length,d.length2+=g.length,0!==d.diffs.length&&d.diffs[d.diffs.length-1][0]===i?d.diffs[d.diffs.length-1][1]+=g:d.diffs.push(new t.Diff(i,g))),h||e.splice(++o,0,d)}}},t.prototype.patch_toText=function(e){for(var t=[],r=0;r<e.length;r++)t[r]=e[r];return t.join("")},t.prototype.patch_fromText=function(e){var s=[];if(!e)return s;for(var o=e.split("\n"),a=0,l=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;a<o.length;){var c=o[a].match(l);if(!c)throw Error("Invalid patch string: "+o[a]);var u=new t.patch_obj;for(s.push(u),u.start1=parseInt(c[1],10),""===c[2]?(u.start1--,u.length1=1):"0"==c[2]?u.length1=0:(u.start1--,u.length1=parseInt(c[2],10)),u.start2=parseInt(c[3],10),""===c[4]?(u.start2--,u.length2=1):"0"==c[4]?u.length2=0:(u.start2--,u.length2=parseInt(c[4],10)),a++;a<o.length;){var d=o[a].charAt(0);try{var h=decodeURI(o[a].substring(1))}catch(e){throw Error("Illegal escape in patch_fromText: "+h)}if("-"==d)u.diffs.push(new t.Diff(r,h));else if("+"==d)u.diffs.push(new t.Diff(n,h));else if(" "==d)u.diffs.push(new t.Diff(i,h));else if("@"==d)break;else if(""===d);else throw Error('Invalid patch mode "'+d+'" in: '+h);a++}}return s},t.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},t.patch_obj.prototype.toString=function(){e=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1;for(var e,t,s=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2,o=["@@ -"+e+" +"+s+" @@\n"],a=0;a<this.diffs.length;a++){switch(this.diffs[a][0]){case n:t="+";break;case r:t="-";break;case i:t=" "}o[a+1]=t+encodeURI(this.diffs[a][1])+"\n"}return o.join("").replace(/%20/g," ")},e.exports=t,e.exports.diff_match_patch=t,e.exports.DIFF_DELETE=r,e.exports.DIFF_INSERT=n,e.exports.DIFF_EQUAL=i},51517:e=>{"use strict";e.exports=Math.max},52103:e=>{"use strict";function t(e){return e>=55296&&e<=56319}function r(e){return e>=56320&&e<=57343}e.exports=function(e){if("string"!=typeof e)throw Error("Input must be string");for(var n=e.length,i=0,s=null,o=null,a=0;a<n;a++)r(s=e.charCodeAt(a))?null!=o&&t(o)?i+=1:i+=3:s<=127?i+=1:s>=128&&s<=2047?i+=2:s>=2048&&s<=65535&&(i+=3),o=s;return i}},52192:e=>{"use strict";var t="Function.prototype.bind called on incompatible ",r=Object.prototype.toString,n=Math.max,i="[object Function]",s=function(e,t){for(var r=[],n=0;n<e.length;n+=1)r[n]=e[n];for(var i=0;i<t.length;i+=1)r[i+e.length]=t[i];return r},o=function(e,t){for(var r=[],n=t||0,i=0;n<e.length;n+=1,i+=1)r[i]=e[n];return r},a=function(e,t){for(var r="",n=0;n<e.length;n+=1)r+=e[n],n+1<e.length&&(r+=t);return r};e.exports=function(e){var l,c=this;if("function"!=typeof c||r.apply(c)!==i)throw TypeError(t+c);for(var u=o(arguments,1),d=function(){if(this instanceof l){var t=c.apply(this,s(u,arguments));return Object(t)===t?t:this}return c.apply(e,s(u,arguments))},h=n(0,c.length-u.length),f=[],p=0;p<h;p++)f[p]="$"+p;if(l=Function("binder","return function ("+a(f,",")+"){ return binder.apply(this,arguments); }")(d),c.prototype){var g=function(){};g.prototype=c.prototype,l.prototype=new g,g.prototype=null}return l}},52215:(e,t,r)=>{"use strict";r.d(t,{_Q:()=>d,HT:()=>u,yE:()=>p});var n=r(70834);let i=function(e,t){if(e.length>=255)throw TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw TypeError(s+" is ambiguous");r[o]=i}var a=e.length,l=e.charAt(0),c=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(e){if("string"!=typeof e)throw TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[0]){for(var n=0,i=0;e[t]===l;)n++,t++;for(var s=(e.length-t)*c+1>>>0,o=new Uint8Array(s);e[t];){var u=r[e.charCodeAt(t)];if(255===u)return;for(var d=0,h=s-1;(0!==u||d<i)&&-1!==h;h--,d++)u+=a*o[h]>>>0,o[h]=u%256>>>0,u=u/256>>>0;if(0!==u)throw Error("Non-zero carry");i=d,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),g=n;f!==s;)p[g++]=o[f++];return p}}}function h(e){var r=d(e);if(r)return r;throw Error(`Non-${t} character`)}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*u+1>>>0,c=new Uint8Array(o);i!==s;){for(var d=t[i],h=0,f=o-1;(0!==d||h<n)&&-1!==f;f--,h++)d+=256*c[f]>>>0,c[f]=d%a>>>0,d=d/a>>>0;if(0!==d)throw Error("Non-zero carry");n=h,i++}for(var p=o-n;p!==o&&0===c[p];)p++;for(var g=l.repeat(r);p<o;++p)g+=e.charAt(c[p]);return g},decodeUnsafe:d,decode:h}};class s{name;prefix;baseEncode;constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class o{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,r){this.name=e,this.prefix=t;let n=t.codePointAt(0);if(void 0===n)throw Error("Invalid prefix character");this.prefixCodePoint=n,this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return l(this,e)}}class a{decoders;constructor(e){this.decoders=e}or(e){return l(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(null!=r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function l(e,t){return new a({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}class c{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new s(e,t,r),this.decoder=new o(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function u({name:e,prefix:t,encode:r,decode:n}){return new c(e,t,r,n)}function d({name:e,prefix:t,alphabet:r}){let{encode:s,decode:o}=i(r,e);return u({prefix:t,name:e,encode:s,decode:e=>(0,n.coerce)(o(e))})}function h(e,t,r,n){let i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;let o=new Uint8Array(s*r/8|0),a=0,l=0,c=0;for(let t=0;t<s;++t){let s=i[e[t]];if(void 0===s)throw SyntaxError(`Non-${n} character`);l=l<<r|s,(a+=r)>=8&&(a-=8,o[c++]=255&l>>a)}if(a>=r||(255&l<<8-a)!=0)throw SyntaxError("Unexpected end of data");return o}function f(e,t,r){let n="="===t[t.length-1],i=(1<<r)-1,s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(0!==o&&(s+=t[i&a<<r-o]),n)for(;(s.length*r&7)!=0;)s+="=";return s}function p({name:e,prefix:t,bitsPerChar:r,alphabet:n}){return u({prefix:t,name:e,encode:e=>f(e,n,r),decode:t=>h(t,n,r,e)})}},52430:(e,t,r)=>{"use strict";var n=r(52192);e.exports=Function.prototype.bind||n},52647:(e,t,r)=>{var n=r(40662),i=r(84115);function s(e){if(!(this instanceof s))return new s(e);"number"==typeof e&&(e={max:e}),e||(e={}),n.EventEmitter.call(this),this.cache={},this.head=this.tail=null,this.length=0,this.max=e.max||1e3,this.maxAge=e.maxAge||0}e.exports=s,i(s,n.EventEmitter),Object.defineProperty(s.prototype,"keys",{get:function(){return Object.keys(this.cache)}}),s.prototype.clear=function(){this.cache={},this.head=this.tail=null,this.length=0},s.prototype.remove=function(e){if("string"!=typeof e&&(e=""+e),this.cache.hasOwnProperty(e)){var t=this.cache[e];return delete this.cache[e],this._unlink(e,t.prev,t.next),t.value}},s.prototype._unlink=function(e,t,r){this.length--,0===this.length?this.head=this.tail=null:this.head===e?(this.head=t,this.cache[this.head].next=null):this.tail===e?(this.tail=r,this.cache[this.tail].prev=null):(this.cache[t].next=r,this.cache[r].prev=t)},s.prototype.peek=function(e){if(this.cache.hasOwnProperty(e)){var t=this.cache[e];if(this._checkAge(e,t))return t.value}},s.prototype.set=function(e,t){var r;if("string"!=typeof e&&(e=""+e),this.cache.hasOwnProperty(e)){if((r=this.cache[e]).value=t,this.maxAge&&(r.modified=Date.now()),e===this.head)return t;this._unlink(e,r.prev,r.next)}else r={value:t,modified:0,next:null,prev:null},this.maxAge&&(r.modified=Date.now()),this.cache[e]=r,this.length===this.max&&this.evict();return this.length++,r.next=null,r.prev=this.head,this.head&&(this.cache[this.head].next=e),this.head=e,this.tail||(this.tail=e),t},s.prototype._checkAge=function(e,t){return!(this.maxAge&&Date.now()-t.modified>this.maxAge)||(this.remove(e),this.emit("evict",{key:e,value:t.value}),!1)},s.prototype.get=function(e){if("string"!=typeof e&&(e=""+e),this.cache.hasOwnProperty(e)){var t=this.cache[e];if(this._checkAge(e,t))return this.head!==e&&(e===this.tail?(this.tail=t.next,this.cache[this.tail].prev=null):this.cache[t.prev].next=t.next,this.cache[t.next].prev=t.prev,this.cache[this.head].next=e,t.prev=this.head,t.next=null,this.head=e),t.value}},s.prototype.evict=function(){if(this.tail){var e=this.tail,t=this.remove(this.tail);this.emit("evict",{key:e,value:t})}}},53377:(e,t,r)=>{"use strict";var n=r(28886);e.exports=function(e){return!!n(e)}},53647:(e,t,r)=>{"use strict";r.r(t),r.d(t,{base64:()=>i,base64pad:()=>s,base64url:()=>o,base64urlpad:()=>a});var n=r(52215);let i=(0,n.yE)({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),s=(0,n.yE)({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),o=(0,n.yE)({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),a=(0,n.yE)({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})},54251:e=>{"use strict";e.exports=Math.min},54954:(e,t,r)=>{"use strict";r.d(t,{f:()=>a});var n=r(24802),i=r(76520),s=r(76154),o=r(91295);class a{put(e,t,r){return Promise.reject(Error(".put is not implemented"))}get(e,t){return Promise.reject(Error(".get is not implemented"))}has(e,t){return Promise.reject(Error(".has is not implemented"))}delete(e,t){return Promise.reject(Error(".delete is not implemented"))}async *putMany(e,t={}){for await(let{key:r,value:n}of e)await this.put(r,n,t),yield r}async *getMany(e,t={}){for await(let r of e)yield{key:r,value:await this.get(r,t)}}async *deleteMany(e,t={}){for await(let r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await (0,n.A)(this.putMany(e,r)),e=[],await (0,n.A)(this.deleteMany(t,r)),t=[]}}}async *_all(e,t){throw Error("._all is not implemented")}async *_allKeys(e,t){throw Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix){let t=e.prefix;r=(0,i.A)(r,e=>e.key.toString().startsWith(t))}if(Array.isArray(e.filters)&&(r=e.filters.reduce((e,t)=>(0,i.A)(e,t),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((e,t)=>(0,s.A)(e,t),r)),null!=e.offset){let t=0,n=e.offset;r=(0,i.A)(r,()=>t++>=n)}return null!=e.limit&&(r=(0,o.A)(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix){let t=e.prefix;r=(0,i.A)(r,e=>e.toString().startsWith(t))}if(Array.isArray(e.filters)&&(r=e.filters.reduce((e,t)=>(0,i.A)(e,t),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((e,t)=>(0,s.A)(e,t),r)),null!=e.offset){let t=e.offset,n=0;r=(0,i.A)(r,()=>n++>=t)}return null!=e.limit&&(r=(0,o.A)(r,e.limit)),r}}},56335:(e,t,r)=>{"use strict";let n;r.d(t,{e:()=>m});var i=r(17849),s=r(49509);let o="test"==s.env.ETH_ENV?"http://localhost:8545":`https://sepolia.infura.io/v3/${s.env.SEPOLIA_API_KEY}`;if("undefined"!=typeof window&&void 0!==window.ethereum)window.ethereum.request({method:"eth_requestAccounts"}),n=new i.Ay$(window.ethereum);else{let e=new i.Ay$.providers.HttpProvider(o);n=new i.Ay$(e)}let a=n,l=JSON.parse('[{"inputs":[{"internalType":"string","name":"","type":"string"}],"name":"aliasToWalletAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"","type":"string"}],"name":"chatNameToAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"chatNames","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"chats","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_name","type":"string"}],"name":"createChat","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_walletAddress","type":"address"}],"name":"getAlias","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_alias","type":"string"}],"name":"setAlias","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"walletAddressToAlias","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"}]'),c=JSON.parse('[{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"id","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"parentId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"sender","type":"address"},{"indexed":false,"internalType":"string","name":"senderAlias","type":"string"},{"indexed":false,"internalType":"string","name":"content","type":"string"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"MessageSent","type":"event"},{"inputs":[],"name":"factory","outputs":[{"internalType":"contract ChatFactory","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getMessages","outputs":[{"components":[{"internalType":"bytes32","name":"id","type":"bytes32"},{"internalType":"bytes32","name":"parentId","type":"bytes32"},{"internalType":"address","name":"sender","type":"address"},{"internalType":"string","name":"senderAlias","type":"string"},{"internalType":"string","name":"content","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"internalType":"struct Chat.Message[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"messages","outputs":[{"internalType":"bytes32","name":"id","type":"bytes32"},{"internalType":"bytes32","name":"parentId","type":"bytes32"},{"internalType":"address","name":"sender","type":"address"},{"internalType":"string","name":"senderAlias","type":"string"},{"internalType":"string","name":"content","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_content","type":"string"},{"internalType":"bytes32","name":"_parentId","type":"bytes32"}],"name":"sendMessage","outputs":[],"stateMutability":"nonpayable","type":"function"}]'),u="0x73511669fd4dE447feD18BB79bAFeAC93aB7F31f",d="0x0000000000000000000000000000000000000000000000000000000000000000";class h{chatFactoryInstance;constructor(){this.chatFactoryInstance=new a.eth.Contract(l,u)}async createChat(e){let t=await a.eth.getAccounts();await this.chatFactoryInstance.methods.createChat(e).send({from:t[0]})}async listenToNewMessages(e,t){(await this.buildChatContractInstance(e)).events.MessageSent().on("data",e=>{let{id:r,parentId:n,sender:i,senderAlias:s,content:o,timestamp:a}=e.returnValues;t({id:r,parentId:n===d?void 0:n,sender:i,senderAlias:s,message:o,timestamp:Number(a)})})}async getMessages(e){let t=await this.buildChatContractInstance(e);return(await t.methods.getMessages().call()).map(e=>({id:e.id,parentId:e.parentId===d?void 0:e.parentId,sender:e.sender,senderAlias:e.senderAlias,message:e.content,timestamp:e.timestamp}))}async sendMessage(e,t,r){let n=await this.buildChatContractInstance(e),i=await a.eth.getAccounts(),s=r||d;await n.methods.sendMessage(t,s).send({from:i[0]})}async setAlias(e){let t=await a.eth.getAccounts();await this.chatFactoryInstance.methods.setAlias(e).send({from:t[0]})}async getAlias(){let e=await a.eth.getAccounts();return await this.chatFactoryInstance.methods.getAlias(e[0]).call()}async buildChatContractInstance(e){let t=await this.chatFactoryInstance.methods.chatNameToAddress(e).call();return new a.eth.Contract(c,t)}}let f=h;class p{chatRepository;constructor(){this.chatRepository=new f}async start(){throw Error("Method not implemented.")}async listenToNewMessages(e,t){this.chatRepository.listenToNewMessages(e,t)}async createChat(e){this.chatRepository.createChat(e)}async sendMessage(e,t,r){await this.chatRepository.sendMessage(e,t,r)}async getMessages(e){return(await this.chatRepository.getMessages(e)).map(e=>({id:e.id,parentId:e.parentId,sender:e.sender,senderAlias:e.senderAlias,message:e.message,timestamp:Number(e.timestamp)}))}async setAlias(e){await this.chatRepository.setAlias(e)}async getAlias(){return await this.chatRepository.getAlias()}async getChatNames(){throw Error("Method not implemented.")}}let g=p;async function m(){return new g}},56406:(e,t,r)=>{"use strict";var n="undefined"!=typeof Symbol&&Symbol,i=r(68852);e.exports=function(){return"function"==typeof n&&"function"==typeof Symbol&&"symbol"==typeof n("foo")&&"symbol"==typeof Symbol("bar")&&i()}},56765:(e,t,r)=>{let n;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:r.g):e=>(n||(n=Promise.resolve())).then(e).catch(e=>setTimeout(()=>{throw e},0))},57116:(e,t,r)=>{"use strict";r.d(t,{JL:()=>o,a6:()=>i,m9:()=>a});var n=r(51476);function i(e){let t=new n,r=e.flatMap(e=>e.patch),[i,s]=t.patch_apply(r,"");for(let e=0;e<s.length;e++)if(!s[e])throw Error(`Failed to apply patch ${e}`);return i}function s(e,t){return new n().patch_make(e,t)}function o(e,t,r){let n=crypto.randomUUID();return{id:n,date:Date.now().toString(),patch:s(e,t),parent:r??null}}var a=class{versions;lastVersion;cachedMainBranch;constructor(e){if(this.versions=new Map,e)for(let t of e)this.addVersionRaw(t);this.lastVersion=this.getLastVersion(),this.cachedMainBranch=null}addVersion(e){this.addVersionRaw(e),this.lastVersion=this.getLastVersion(),this.cachedMainBranch=null}getAllVersions(){return Array.from(this.versions.values())}getMainBranch(){if(this.cachedMainBranch)return this.cachedMainBranch;let e=this.lastVersion;if(!e)return[];let t=this.getBranch(e);return this.cachedMainBranch=t,t}getBranch(e){let t=[],r=e;for(;r;){let e=this.versions.get(r);if(!e)throw Error("Version not found while walking main version branch");t.push(e),r=e.parent}return t.reverse(),t}addVersionRaw(e){if(this.versions.has(e.id))throw Error("Version with the same ID already exists");this.versions.set(e.id,e)}getLastVersion(){let e=this.getLeaves(this.versions);if(0===e.size)return null;let t=this.getLongestBranchLeaf(e,this.versions).map(e=>this.versions.get(e));return t.sort((e,t)=>e.date<t.date?1:-1),t.pop().id}getLeaves(e){let t=new Set,r=new Set;for(let[n,i]of e)r.has(n)||(i.parent&&(r.add(i.parent),t.delete(i.parent)),t.add(n));return t}getLongestBranchLeaf(e,t){let r=new Map,n=0,i=[];for(let s of e){let e=this.getVersionRootDistance(s,r,t);i.push({leaf:s,distance:e}),e>n&&(n=e)}return i.filter(e=>e.distance===n).map(e=>e.leaf)}getVersionRootDistance(e,t,r){if(t.has(e))return t.get(e);let n=r.get(e);if(!n)throw Error(`Version not found: ${e}`);if(!n.parent)return t.set(e,0),0;let i=this.getVersionRootDistance(n.parent,t,r)+1;return t.set(e,i),i}}},57621:(e,t,r)=>{"use strict";let{fromCallback:n}=r(82813),i=r(7800),{getCallback:s,getOptions:o}=r(33534),a=Symbol("promise"),l=Symbol("status"),c=Symbol("operations"),u=Symbol("finishClose"),d=Symbol("closeCallbacks");class h{constructor(e){if("object"!=typeof e||null===e){let t=null===e?"null":typeof e;throw TypeError(`The first argument must be an abstract-level database, received ${t}`)}this[c]=[],this[d]=[],this[l]="open",this[u]=this[u].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[c].length}put(e,t,r){if("open"!==this[l])throw new i("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let n=this.db._checkKey(e)||this.db._checkValue(t);if(n)throw n;let s=r&&null!=r.sublevel?r.sublevel:this.db,o=r,a=s.keyEncoding(r&&r.keyEncoding),u=s.valueEncoding(r&&r.valueEncoding),d=a.format;r={...r,keyEncoding:d,valueEncoding:u.format},s!==this.db&&(r.sublevel=null);let h=s.prefixKey(a.encode(e),d),f=u.encode(t);return this._put(h,f,r),this[c].push({...o,type:"put",key:e,value:t}),this}_put(e,t,r){}del(e,t){if("open"!==this[l])throw new i("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let r=this.db._checkKey(e);if(r)throw r;let n=t&&null!=t.sublevel?t.sublevel:this.db,s=t,o=n.keyEncoding(t&&t.keyEncoding),a=o.format;return t={...t,keyEncoding:a},n!==this.db&&(t.sublevel=null),this._del(n.prefixKey(o.encode(e),a),t),this[c].push({...s,type:"del",key:e}),this}_del(e,t){}clear(){if("open"!==this[l])throw new i("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[c]=[],this}_clear(){}write(e,t){return t=n(t=s(e,t),a),e=o(e),"open"!==this[l]?this.nextTick(t,new i("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):0===this.length?this.close(t):(this[l]="writing",this._write(e,e=>{this[l]="closing",this[d].push(()=>t(e)),e||this.db.emit("batch",this[c]),this._close(this[u])})),t[a]}_write(e,t){}close(e){return e=n(e,a),"closing"===this[l]?this[d].push(e):"closed"===this[l]?this.nextTick(e):(this[d].push(e),"writing"!==this[l]&&(this[l]="closing",this._close(this[u]))),e[a]}_close(e){this.nextTick(e)}[u](){this[l]="closed",this.db.detachResource(this);let e=this[d];for(let t of(this[d]=[],e))t()}}t.AbstractChainedBatch=h},57719:(e,t)=>{"use strict";t.byteLength=c,t.toByteArray=d,t.fromByteArray=p;for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=s.length;o<a;++o)r[o]=s[o],n[s.charCodeAt(o)]=o;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}function c(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n}function u(e,t,r){return(t+r)*3/4-r}function d(e){var t,r,s=l(e),o=s[0],a=s[1],c=new i(u(e,o,a)),d=0,h=a>0?o-4:o;for(r=0;r<h;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],c[d++]=t>>16&255,c[d++]=t>>8&255,c[d++]=255&t;return 2===a&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,c[d++]=255&t),1===a&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,c[d++]=t>>8&255,c[d++]=255&t),c}function h(e){return r[e>>18&63]+r[e>>12&63]+r[e>>6&63]+r[63&e]}function f(e,t,r){for(var n=[],i=t;i<r;i+=3)n.push(h((e[i]<<16&0xff0000)+(e[i+1]<<8&65280)+(255&e[i+2])));return n.join("")}function p(e){for(var t,n=e.length,i=n%3,s=[],o=16383,a=0,l=n-i;a<l;a+=o)s.push(f(e,a,a+o>l?l:a+o));return 1===i?s.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===i&&s.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),s.join("")}n[45]=62,n[95]=63},59372:(e,t,r)=>{t.Level=r(80501).BrowserLevel},59615:(e,t,r)=>{"use strict";let{AbortController:n}=globalThis,i=r(24658);class s extends n{constructor(e){super(),this._ms=e,this._timer=i(()=>this.abort(),e),Object.setPrototypeOf(this,s.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=i(()=>this.abort(),this._ms)}}e.exports={TimeoutController:s}},59888:(e,t,r)=>{"use strict";var n=r(62030),i=r(61925),s=r(63674),o=r(81954);e.exports=function(e,t,r){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new s("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new s("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new s("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new s("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new s("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new s("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,u=arguments.length>6&&arguments[6],d=!!o&&o(e,t);if(n)n(e,t,{configurable:null===c&&d?d.configurable:!c,enumerable:null===a&&d?d.enumerable:!a,value:r,writable:null===l&&d?d.writable:!l});else if(!u&&(a||l||c))throw new i("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");else e[t]=r}},60261:e=>{"use strict";e.exports=Function.prototype.call},60289:(e,t,r)=>{"use strict";var n=r(94061),i=r(17001),s=r(28886),o=r(53377);function a(e){return e.call.bind(e)}var l="undefined"!=typeof BigInt,c="undefined"!=typeof Symbol,u=a(Object.prototype.toString),d=a(Number.prototype.valueOf),h=a(String.prototype.valueOf),f=a(Boolean.prototype.valueOf);if(l)var p=a(BigInt.prototype.valueOf);if(c)var g=a(Symbol.prototype.valueOf);function m(e,t){if("object"!=typeof e)return!1;try{return t(e),!0}catch(e){return!1}}function y(e){return"[object Map]"===u(e)}function b(e){return"[object Set]"===u(e)}function w(e){return"[object WeakMap]"===u(e)}function v(e){return"[object WeakSet]"===u(e)}function E(e){return"[object ArrayBuffer]"===u(e)}function A(e){return"undefined"!=typeof ArrayBuffer&&(E.working?E(e):e instanceof ArrayBuffer)}function x(e){return"[object DataView]"===u(e)}function S(e){return"undefined"!=typeof DataView&&(x.working?x(e):e instanceof DataView)}t.isArgumentsObject=n,t.isGeneratorFunction=i,t.isTypedArray=o,t.isPromise=function(e){return"undefined"!=typeof Promise&&e instanceof Promise||null!==e&&"object"==typeof e&&"function"==typeof e.then&&"function"==typeof e.catch},t.isArrayBufferView=function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):o(e)||S(e)},t.isUint8Array=function(e){return"Uint8Array"===s(e)},t.isUint8ClampedArray=function(e){return"Uint8ClampedArray"===s(e)},t.isUint16Array=function(e){return"Uint16Array"===s(e)},t.isUint32Array=function(e){return"Uint32Array"===s(e)},t.isInt8Array=function(e){return"Int8Array"===s(e)},t.isInt16Array=function(e){return"Int16Array"===s(e)},t.isInt32Array=function(e){return"Int32Array"===s(e)},t.isFloat32Array=function(e){return"Float32Array"===s(e)},t.isFloat64Array=function(e){return"Float64Array"===s(e)},t.isBigInt64Array=function(e){return"BigInt64Array"===s(e)},t.isBigUint64Array=function(e){return"BigUint64Array"===s(e)},y.working="undefined"!=typeof Map&&y(new Map),t.isMap=function(e){return"undefined"!=typeof Map&&(y.working?y(e):e instanceof Map)},b.working="undefined"!=typeof Set&&b(new Set),t.isSet=function(e){return"undefined"!=typeof Set&&(b.working?b(e):e instanceof Set)},w.working="undefined"!=typeof WeakMap&&w(new WeakMap),t.isWeakMap=function(e){return"undefined"!=typeof WeakMap&&(w.working?w(e):e instanceof WeakMap)},v.working="undefined"!=typeof WeakSet&&v(new WeakSet),t.isWeakSet=function(e){return v(e)},E.working="undefined"!=typeof ArrayBuffer&&E(new ArrayBuffer),t.isArrayBuffer=A,x.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&x(new DataView(new ArrayBuffer(1),0,1)),t.isDataView=S;var k="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:void 0;function _(e){return"[object SharedArrayBuffer]"===u(e)}function I(e){return void 0!==k&&(void 0===_.working&&(_.working=_(new k)),_.working?_(e):e instanceof k)}function T(e){return m(e,d)}function C(e){return m(e,h)}function P(e){return m(e,f)}function R(e){return l&&m(e,p)}function D(e){return c&&m(e,g)}t.isSharedArrayBuffer=I,t.isAsyncFunction=function(e){return"[object AsyncFunction]"===u(e)},t.isMapIterator=function(e){return"[object Map Iterator]"===u(e)},t.isSetIterator=function(e){return"[object Set Iterator]"===u(e)},t.isGeneratorObject=function(e){return"[object Generator]"===u(e)},t.isWebAssemblyCompiledModule=function(e){return"[object WebAssembly.Module]"===u(e)},t.isNumberObject=T,t.isStringObject=C,t.isBooleanObject=P,t.isBigIntObject=R,t.isSymbolObject=D,t.isBoxedPrimitive=function(e){return T(e)||C(e)||P(e)||R(e)||D(e)},t.isAnyArrayBuffer=function(e){return"undefined"!=typeof Uint8Array&&(A(e)||I(e))},["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(e){Object.defineProperty(t,e,{enumerable:!1,value:function(){throw Error(e+" is not supported in userland")}})})},61043:e=>{"use strict";e.exports=Function.prototype.apply},61285:(e,t,r)=>{"use strict";r.d(t,{B:()=>l});var n,i=r(12115),s=r(52712),o=(n||(n=r.t(i,2)))[" useId ".trim().toString()]||(()=>void 0),a=0;function l(e){let[t,r]=i.useState(o());return(0,s.N)(()=>{e||r(e=>e??String(a++))},[e]),e||(t?`radix-${t}`:"")}},61925:e=>{"use strict";e.exports=SyntaxError},62030:e=>{"use strict";var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch(e){t=!1}e.exports=t},62806:(e,t,r)=>{var n="/",i=r(49509);!function(){var t={782:function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},646:function(e){"use strict";let t={};function r(e,r,n){function i(e,t,n){return"string"==typeof r?r:r(e,t,n)}n||(n=Error);class s extends n{constructor(e,t,r){super(i(e,t,r))}}s.prototype.name=n.name,s.prototype.code=e,t[e]=s}function n(e,t){if(!Array.isArray(e))return`of ${t} ${String(e)}`;{let r=e.length;return(e=e.map(e=>String(e)),r>2)?`one of ${t} ${e.slice(0,r-1).join(", ")}, or `+e[r-1]:2===r?`one of ${t} ${e[0]} or ${e[1]}`:`of ${t} ${e[0]}`}}function i(e,t,r){return e.substr(!r||r<0?0:+r,t.length)===t}function s(e,t,r){return(void 0===r||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}function o(e,t,r){return"number"!=typeof r&&(r=0),!(r+t.length>e.length)&&-1!==e.indexOf(t,r)}r("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),r("ERR_INVALID_ARG_TYPE",function(e,t,r){let a,l;if("string"==typeof t&&i(t,"not ")?(a="must not be",t=t.replace(/^not /,"")):a="must be",s(e," argument"))l=`The ${e} ${a} ${n(t,"type")}`;else{let r=o(e,".")?"property":"argument";l=`The "${e}" ${r} ${a} ${n(t,"type")}`}return l+`. Received type ${typeof r}`},TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.q=t},403:function(e,t,r){"use strict";var n=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=u;var s=r(709),o=r(337);r(782)(u,s);for(var a=n(o.prototype),l=0;l<a.length;l++){var c=a[l];u.prototype[c]||(u.prototype[c]=o.prototype[c])}function u(e){if(!(this instanceof u))return new u(e);s.call(this,e),o.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",d)))}function d(){this._writableState.ended||i.nextTick(h,this)}function h(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(u.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(u.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},889:function(e,t,r){"use strict";e.exports=i;var n=r(170);function i(e){if(!(this instanceof i))return new i(e);n.call(this,e)}r(782)(i,n),i.prototype._transform=function(e,t,r){r(null,e)}},709:function(e,t,n){"use strict";e.exports=C,C.ReadableState=T,n(361).EventEmitter;var s,o,a,l,c,u=function(e,t){return e.listeners(t).length},d=n(678),h=n(300).Buffer,f=r.g.Uint8Array||function(){};function p(e){return h.from(e)}function g(e){return h.isBuffer(e)||e instanceof f}var m=n(837);o=m&&m.debuglog?m.debuglog("stream"):function(){};var y=n(379),b=n(25),w=n(776).getHighWaterMark,v=n(646).q,E=v.ERR_INVALID_ARG_TYPE,A=v.ERR_STREAM_PUSH_AFTER_EOF,x=v.ERR_METHOD_NOT_IMPLEMENTED,S=v.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;n(782)(C,d);var k=b.errorOrDestroy,_=["error","close","destroy","pause","resume"];function I(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}function T(e,t,r){s=s||n(403),e=e||{},"boolean"!=typeof r&&(r=t instanceof s),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=w(this,e,"readableHighWaterMark",r),this.buffer=new y,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(a||(a=n(704).s),this.decoder=new a(e.encoding),this.encoding=e.encoding)}function C(e){if(s=s||n(403),!(this instanceof C))return new C(e);var t=this instanceof s;this._readableState=new T(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),d.call(this)}function P(e,t,r,n,i){o("readableAddChunk",t);var s,a=e._readableState;if(null===t)a.reading=!1,O(e,a);else if(i||(s=D(a,t)),s)k(e,s);else if(a.objectMode||t&&t.length>0)if("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===h.prototype||(t=p(t)),n)a.endEmitted?k(e,new S):R(e,a,t,!0);else if(a.ended)k(e,new A);else{if(a.destroyed)return!1;a.reading=!1,a.decoder&&!r?(t=a.decoder.write(t),a.objectMode||0!==t.length?R(e,a,t,!1):U(e,a)):R(e,a,t,!1)}else n||(a.reading=!1,U(e,a));return!a.ended&&(a.length<a.highWaterMark||0===a.length)}function R(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&L(e)),U(e,t)}function D(e,t){var r;return g(t)||"string"==typeof t||void 0===t||e.objectMode||(r=new E("chunk",["string","Buffer","Uint8Array"],t)),r}Object.defineProperty(C.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),C.prototype.destroy=b.destroy,C.prototype._undestroy=b.undestroy,C.prototype._destroy=function(e,t){t(e)},C.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=h.from(e,t),t=""),r=!0),P(this,e,t,!1,r)},C.prototype.unshift=function(e){return P(this,e,null,!0,!1)},C.prototype.isPaused=function(){return!1===this._readableState.flowing},C.prototype.setEncoding=function(e){a||(a=n(704).s);var t=new a(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,i="";null!==r;)i+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var N=0x40000000;function M(e){return e>=N?e=N:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function B(e,t){if(e<=0||0===t.length&&t.ended)return 0;if(t.objectMode)return 1;if(e!=e)if(t.flowing&&t.length)return t.buffer.head.data.length;else return t.length;return(e>t.highWaterMark&&(t.highWaterMark=M(e)),e<=t.length)?e:t.ended?t.length:(t.needReadable=!0,0)}function O(e,t){if(o("onEofChunk"),!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?L(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,F(e)))}}function L(e){var t=e._readableState;o("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(o("emitReadable",t.flowing),t.emittedReadable=!0,i.nextTick(F,e))}function F(e){var t=e._readableState;o("emitReadable_",t.destroyed,t.length,t.ended),!t.destroyed&&(t.length||t.ended)&&(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,G(e)}function U(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(j,e,t))}function j(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(o("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function H(e){return function(){var t=e._readableState;o("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&u(e,"data")&&(t.flowing=!0,G(e))}}function $(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function q(e){o("readable nexttick read 0"),e.read(0)}function z(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(V,e,t))}function V(e,t){o("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),G(e),t.flowing&&!t.reading&&e.read(0)}function G(e){var t=e._readableState;for(o("flow",t.flowing);t.flowing&&null!==e.read(););}function K(e,t){var r;return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r)}function W(e){var t=e._readableState;o("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,i.nextTick(Q,t,e))}function Q(e,t){if(o("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function J(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return -1}C.prototype.read=function(e){o("read",e),e=parseInt(e,10);var t,r=this._readableState,n=e;if(0!==e&&(r.emittedReadable=!1),0===e&&r.needReadable&&((0!==r.highWaterMark?r.length>=r.highWaterMark:r.length>0)||r.ended))return o("read: emitReadable",r.length,r.ended),0===r.length&&r.ended?W(this):L(this),null;if(0===(e=B(e,r))&&r.ended)return 0===r.length&&W(this),null;var i=r.needReadable;return o("need readable",i),(0===r.length||r.length-e<r.highWaterMark)&&o("length less than watermark",i=!0),r.ended||r.reading?o("reading or ended",i=!1):i&&(o("do read"),r.reading=!0,r.sync=!0,0===r.length&&(r.needReadable=!0),this._read(r.highWaterMark),r.sync=!1,r.reading||(e=B(n,r))),null===(t=e>0?K(e,r):null)?(r.needReadable=r.length<=r.highWaterMark,e=0):(r.length-=e,r.awaitDrain=0),0===r.length&&(r.ended||(r.needReadable=!0),n!==e&&r.ended&&W(this)),null!==t&&this.emit("data",t),t},C.prototype._read=function(e){k(this,new x("_read()"))},C.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e)}n.pipesCount+=1,o("pipe count=%d opts=%j",n.pipesCount,t);var s=t&&!1===t.end||e===i.stdout||e===i.stderr?y:l;function a(e,t){o("onunpipe"),e===r&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,h())}function l(){o("onend"),e.end()}n.endEmitted?i.nextTick(s):r.once("end",s),e.on("unpipe",a);var c=H(r);e.on("drain",c);var d=!1;function h(){o("cleanup"),e.removeListener("close",g),e.removeListener("finish",m),e.removeListener("drain",c),e.removeListener("error",p),e.removeListener("unpipe",a),r.removeListener("end",l),r.removeListener("end",y),r.removeListener("data",f),d=!0,n.awaitDrain&&(!e._writableState||e._writableState.needDrain)&&c()}function f(t){o("ondata");var i=e.write(t);o("dest.write",i),!1===i&&((1===n.pipesCount&&n.pipes===e||n.pipesCount>1&&-1!==J(n.pipes,e))&&!d&&(o("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function p(t){o("onerror",t),y(),e.removeListener("error",p),0===u(e,"error")&&k(e,t)}function g(){e.removeListener("finish",m),y()}function m(){o("onfinish"),e.removeListener("close",g),y()}function y(){o("unpipe"),r.unpipe(e)}return r.on("data",f),I(e,"error",p),e.once("close",g),e.once("finish",m),e.emit("pipe",r),n.flowing||(o("pipe resume"),r.resume()),e},C.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<i;s++)n[s].emit("unpipe",this,{hasUnpiped:!1});return this}var o=J(t.pipes,e);return -1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},C.prototype.on=function(e,t){var r=d.prototype.on.call(this,e,t),n=this._readableState;return"data"===e?(n.readableListening=this.listenerCount("readable")>0,!1!==n.flowing&&this.resume()):"readable"!==e||n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,o("on readable",n.length,n.reading),n.length?L(this):n.reading||i.nextTick(q,this)),r},C.prototype.addListener=C.prototype.on,C.prototype.removeListener=function(e,t){var r=d.prototype.removeListener.call(this,e,t);return"readable"===e&&i.nextTick($,this),r},C.prototype.removeAllListeners=function(e){var t=d.prototype.removeAllListeners.apply(this,arguments);return("readable"===e||void 0===e)&&i.nextTick($,this),t},C.prototype.resume=function(){var e=this._readableState;return e.flowing||(o("resume"),e.flowing=!e.readableListening,z(this,e)),e.paused=!1,this},C.prototype.pause=function(){return o("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(o("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},C.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",function(){if(o("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){if(o("wrapped data"),r.decoder&&(i=r.decoder.write(i)),!r.objectMode||null!=i)(r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause()))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var s=0;s<_.length;s++)e.on(_[s],this.emit.bind(this,_[s]));return this._read=function(t){o("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(C.prototype[Symbol.asyncIterator]=function(){return void 0===l&&(l=n(871)),l(this)}),Object.defineProperty(C.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(C.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(C.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),C._fromList=K,Object.defineProperty(C.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(C.from=function(e,t){return void 0===c&&(c=n(727)),c(C,e,t)})},170:function(e,t,r){"use strict";e.exports=u;var n=r(646).q,i=n.ERR_METHOD_NOT_IMPLEMENTED,s=n.ERR_MULTIPLE_CALLBACK,o=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=n.ERR_TRANSFORM_WITH_LENGTH_0,l=r(403);function c(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new s);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);l.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?h(this,null,null):this._flush(function(t,r){h(e,t,r)})}function h(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new a;if(e._transformState.transforming)throw new o;return e.push(null)}r(782)(u,l),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,l.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,r){r(new i("_transform()"))},u.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){l.prototype._destroy.call(this,e,function(e){t(e)})}},337:function(e,t,n){"use strict";function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){V(t,e)}}e.exports=T,T.WritableState=I;var o,a,l={deprecate:n(769)},c=n(678),u=n(300).Buffer,d=r.g.Uint8Array||function(){};function h(e){return u.from(e)}function f(e){return u.isBuffer(e)||e instanceof d}var p=n(25),g=n(776).getHighWaterMark,m=n(646).q,y=m.ERR_INVALID_ARG_TYPE,b=m.ERR_METHOD_NOT_IMPLEMENTED,w=m.ERR_MULTIPLE_CALLBACK,v=m.ERR_STREAM_CANNOT_PIPE,E=m.ERR_STREAM_DESTROYED,A=m.ERR_STREAM_NULL_VALUES,x=m.ERR_STREAM_WRITE_AFTER_END,S=m.ERR_UNKNOWN_ENCODING,k=p.errorOrDestroy;function _(){}function I(e,t,r){o=o||n(403),e=e||{},"boolean"!=typeof r&&(r=t instanceof o),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=g(this,e,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var i=!1===e.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){O(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function T(e){var t=this instanceof(o=o||n(403));if(!t&&!a.call(T,this))return new T(e);this._writableState=new I(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),c.call(this)}function C(e,t){var r=new x;k(e,r),i.nextTick(t,r)}function P(e,t,r,n){var s;return null===r?s=new A:"string"==typeof r||t.objectMode||(s=new y("chunk",["string","Buffer"],r)),!s||(k(e,s),i.nextTick(n,s),!1)}function R(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=u.from(t,r)),t}function D(e,t,r,n,i,s){if(!r){var o=R(t,n,i);n!==o&&(r=!0,i="buffer",n=o)}var a=t.objectMode?1:n.length;t.length+=a;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:s,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else N(e,t,!1,a,n,i,s);return l}function N(e,t,r,n,i,s,o){t.writelen=n,t.writecb=o,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new E("write")):r?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function M(e,t,r,n,s){--t.pendingcb,r?(i.nextTick(s,n),i.nextTick(q,e,t),e._writableState.errorEmitted=!0,k(e,n)):(s(n),e._writableState.errorEmitted=!0,k(e,n),q(e,t))}function B(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function O(e,t){var r=e._writableState,n=r.sync,s=r.writecb;if("function"!=typeof s)throw new w;if(B(r),t)M(e,r,n,t,s);else{var o=j(r)||e.destroyed;o||r.corked||r.bufferProcessing||!r.bufferedRequest||U(e,r),n?i.nextTick(L,e,r,o,s):L(e,r,o,s)}}function L(e,t,r,n){r||F(e,t),t.pendingcb--,n(),q(e,t)}function F(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function U(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=Array(t.bufferedRequestCount),i=t.corkedRequestsFree;i.entry=r;for(var o=0,a=!0;r;)n[o]=r,r.isBuf||(a=!1),r=r.next,o+=1;n.allBuffers=a,N(e,t,!0,t.length,n,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;r;){var l=r.chunk,c=r.encoding,u=r.callback,d=t.objectMode?1:l.length;if(N(e,t,!1,d,l,c,u),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function j(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function H(e,t){e._final(function(r){t.pendingcb--,r&&k(e,r),t.prefinished=!0,e.emit("prefinish"),q(e,t)})}function $(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,i.nextTick(H,e,t)))}function q(e,t){var r=j(t);if(r&&($(e,t),0===t.pendingcb)&&(t.finished=!0,e.emit("finish"),t.autoDestroy)){var n=e._readableState;(!n||n.autoDestroy&&n.endEmitted)&&e.destroy()}return r}function z(e,t,r){t.ending=!0,q(e,t),r&&(t.finished?i.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function V(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree.next=e}n(782)(T,c),I.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(I.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(a=Function.prototype[Symbol.hasInstance],Object.defineProperty(T,Symbol.hasInstance,{value:function(e){return!!a.call(this,e)||this===T&&e&&e._writableState instanceof I}})):a=function(e){return e instanceof this},T.prototype.pipe=function(){k(this,new v)},T.prototype.write=function(e,t,r){var n=this._writableState,i=!1,s=!n.objectMode&&f(e);return s&&!u.isBuffer(e)&&(e=h(e)),"function"==typeof t&&(r=t,t=null),s?t="buffer":t||(t=n.defaultEncoding),"function"!=typeof r&&(r=_),n.ending?C(this,r):(s||P(this,n,e,r))&&(n.pendingcb++,i=D(this,n,s,e,t,r)),i},T.prototype.cork=function(){this._writableState.corked++},T.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||U(this,e))},T.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new S(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(T.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(T.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),T.prototype._write=function(e,t,r){r(new b("_write()"))},T.prototype._writev=null,T.prototype.end=function(e,t,r){var n=this._writableState;return"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||z(this,n,r),this},Object.defineProperty(T.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),T.prototype.destroy=p.destroy,T.prototype._undestroy=p.undestroy,T.prototype._destroy=function(e,t){t(e)}},871:function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s,o=r(698),a=Symbol("lastResolve"),l=Symbol("lastReject"),c=Symbol("error"),u=Symbol("ended"),d=Symbol("lastPromise"),h=Symbol("handlePromise"),f=Symbol("stream");function p(e,t){return{value:e,done:t}}function g(e){var t=e[a];if(null!==t){var r=e[f].read();null!==r&&(e[d]=null,e[a]=null,e[l]=null,t(p(r,!1)))}}function m(e){i.nextTick(g,e)}function y(e,t){return function(r,n){e.then(function(){if(t[u])return void r(p(void 0,!0));t[h](r,n)},n)}}var b=Object.getPrototypeOf(function(){}),w=Object.setPrototypeOf((n(s={get stream(){return this[f]},next:function(){var e,t=this,r=this[c];if(null!==r)return Promise.reject(r);if(this[u])return Promise.resolve(p(void 0,!0));if(this[f].destroyed)return new Promise(function(e,r){i.nextTick(function(){t[c]?r(t[c]):e(p(void 0,!0))})});var n=this[d];if(n)e=new Promise(y(n,this));else{var s=this[f].read();if(null!==s)return Promise.resolve(p(s,!1));e=new Promise(this[h])}return this[d]=e,e}},Symbol.asyncIterator,function(){return this}),n(s,"return",function(){var e=this;return new Promise(function(t,r){e[f].destroy(null,function(e){if(e)return void r(e);t(p(void 0,!0))})})}),s),b);e.exports=function(e){var t,r=Object.create(w,(n(t={},f,{value:e,writable:!0}),n(t,a,{value:null,writable:!0}),n(t,l,{value:null,writable:!0}),n(t,c,{value:null,writable:!0}),n(t,u,{value:e._readableState.endEmitted,writable:!0}),n(t,h,{value:function(e,t){var n=r[f].read();n?(r[d]=null,r[a]=null,r[l]=null,e(p(n,!1))):(r[a]=e,r[l]=t)},writable:!0}),t));return r[d]=null,o(e,function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[l];null!==t&&(r[d]=null,r[a]=null,r[l]=null,t(e)),r[c]=e;return}var n=r[a];null!==n&&(r[d]=null,r[a]=null,r[l]=null,n(p(void 0,!0))),r[u]=!0}),e.on("readable",m.bind(null,r)),r}},379:function(e,t,r){"use strict";function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach(function(t){s(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}var c=r(300).Buffer,u=r(837).inspect,d=u&&u.custom||"inspect";function h(e,t,r){c.prototype.copy.call(e,t,r)}e.exports=function(){function e(){o(this,e),this.head=null,this.tail=null,this.length=0}return l(e,[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return c.alloc(0);for(var t=c.allocUnsafe(e>>>0),r=this.head,n=0;r;)h(r.data,t,n),n+=r.data.length,r=r.next;return t}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,s=e>i.length?i.length:e;if(s===i.length?n+=i:n+=i.slice(0,e),0==(e-=s)){s===i.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(s));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=c.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var i=r.data,s=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,s),0==(e-=s)){s===i.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=i.slice(s));break}++n}return this.length-=n,t}},{key:d,value:function(e,t){return u(this,i({},t,{depth:0,customInspect:!1}))}}]),e}()},25:function(e){"use strict";function t(e,t){n(e,t),r(e)}function r(e){(!e._writableState||e._writableState.emitClose)&&(!e._readableState||e._readableState.emitClose)&&e.emit("close")}function n(e,t){e.emit("error",t)}e.exports={destroy:function(e,s){var o=this,a=this._readableState&&this._readableState.destroyed,l=this._writableState&&this._writableState.destroyed;return a||l?s?s(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,i.nextTick(n,this,e)):i.nextTick(n,this,e)):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!s&&e?o._writableState?o._writableState.errorEmitted?i.nextTick(r,o):(o._writableState.errorEmitted=!0,i.nextTick(t,o,e)):i.nextTick(t,o,e):s?(i.nextTick(r,o),s(e)):i.nextTick(r,o)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}},698:function(e,t,r){"use strict";var n=r(646).q.ERR_STREAM_PREMATURE_CLOSE;function i(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}function s(){}function o(e){return e.setHeader&&"function"==typeof e.abort}function a(e,t,r){if("function"==typeof t)return a(e,null,t);t||(t={}),r=i(r||s);var l=t.readable||!1!==t.readable&&e.readable,c=t.writable||!1!==t.writable&&e.writable,u=function(){e.writable||h()},d=e._writableState&&e._writableState.finished,h=function(){c=!1,d=!0,l||r.call(e)},f=e._readableState&&e._readableState.endEmitted,p=function(){l=!1,f=!0,c||r.call(e)},g=function(t){r.call(e,t)},m=function(){var t;return l&&!f?(e._readableState&&e._readableState.ended||(t=new n),r.call(e,t)):c&&!d?(e._writableState&&e._writableState.ended||(t=new n),r.call(e,t)):void 0},y=function(){e.req.on("finish",h)};return o(e)?(e.on("complete",h),e.on("abort",m),e.req?y():e.on("request",y)):c&&!e._writableState&&(e.on("end",u),e.on("close",u)),e.on("end",p),e.on("finish",h),!1!==t.error&&e.on("error",g),e.on("close",m),function(){e.removeListener("complete",h),e.removeListener("abort",m),e.removeListener("request",y),e.req&&e.req.removeListener("finish",h),e.removeListener("end",u),e.removeListener("close",u),e.removeListener("finish",h),e.removeListener("end",p),e.removeListener("error",g),e.removeListener("close",m)}}e.exports=a},727:function(e,t,r){"use strict";function n(e,t,r,n,i,s,o){try{var a=e[s](o),l=a.value}catch(e){r(e);return}a.done?t(l):Promise.resolve(l).then(n,i)}function i(e){return function(){var t=this,r=arguments;return new Promise(function(i,s){var o=e.apply(t,r);function a(e){n(o,i,s,a,l,"next",e)}function l(e){n(o,i,s,a,l,"throw",e)}a(void 0)})}}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach(function(t){a(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var l=r(646).q.ERR_INVALID_ARG_TYPE;e.exports=function(e,t,r){if(t&&"function"==typeof t.next)n=t;else if(t&&t[Symbol.asyncIterator])n=t[Symbol.asyncIterator]();else if(t&&t[Symbol.iterator])n=t[Symbol.iterator]();else throw new l("iterable",["Iterable"],t);var n,s=new e(o({objectMode:!0},r)),a=!1;function c(){return u.apply(this,arguments)}function u(){return(u=i(function*(){try{var e=yield n.next(),t=e.value;e.done?s.push(null):s.push((yield t))?c():a=!1}catch(e){s.destroy(e)}})).apply(this,arguments)}return s._read=function(){a||(a=!0,c())},s}},442:function(e,t,r){"use strict";function n(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}var i,s=r(646).q,o=s.ERR_MISSING_ARGS,a=s.ERR_STREAM_DESTROYED;function l(e){if(e)throw e}function c(e){return e.setHeader&&"function"==typeof e.abort}function u(e,t,s,o){o=n(o);var l=!1;e.on("close",function(){l=!0}),void 0===i&&(i=r(698)),i(e,{readable:t,writable:s},function(e){if(e)return o(e);l=!0,o()});var u=!1;return function(t){if(!l&&!u){if(u=!0,c(e))return e.abort();if("function"==typeof e.destroy)return e.destroy();o(t||new a("pipe"))}}}function d(e){e()}function h(e,t){return e.pipe(t)}function f(e){return e.length&&"function"==typeof e[e.length-1]?e.pop():l}e.exports=function(){for(var e,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=f(r);if(Array.isArray(r[0])&&(r=r[0]),r.length<2)throw new o("streams");var s=r.map(function(t,n){var o=n<r.length-1;return u(t,o,n>0,function(t){e||(e=t),t&&s.forEach(d),o||(s.forEach(d),i(e))})});return r.reduce(h)}},776:function(e,t,r){"use strict";var n=r(646).q.ERR_INVALID_OPT_VALUE;function i(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}e.exports={getHighWaterMark:function(e,t,r,s){var o=i(t,s,r);if(null!=o){if(!(isFinite(o)&&Math.floor(o)===o)||o<0)throw new n(s?r:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}},678:function(e,t,r){e.exports=r(781)},55:function(e,t,r){var n=r(300),i=n.Buffer;function s(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(s(n,t),t.Buffer=o),o.prototype=Object.create(i.prototype),s(i,o),o.from=function(e,t,r){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return n.SlowBuffer(e)}},173:function(e,t,r){e.exports=i;var n=r(361).EventEmitter;function i(){n.call(this)}r(782)(i,n),i.Readable=r(709),i.Writable=r(337),i.Duplex=r(403),i.Transform=r(170),i.PassThrough=r(889),i.finished=r(698),i.pipeline=r(442),i.Stream=i,i.prototype.pipe=function(e,t){var r=this;function i(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function s(){r.readable&&r.resume&&r.resume()}r.on("data",i),e.on("drain",s),e._isStdio||t&&!1===t.end||(r.on("end",a),r.on("close",l));var o=!1;function a(){o||(o=!0,e.end())}function l(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(u(),0===n.listenerCount(this,"error"))throw e}function u(){r.removeListener("data",i),e.removeListener("drain",s),r.removeListener("end",a),r.removeListener("close",l),r.removeListener("error",c),e.removeListener("error",c),r.removeListener("end",u),r.removeListener("close",u),e.removeListener("close",u)}return r.on("error",c),e.on("error",c),r.on("end",u),r.on("close",u),e.on("close",u),e.emit("pipe",r),e}},704:function(e,t,r){"use strict";var n=r(55).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(e){var t;if(!e)return"utf8";for(;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function o(e){var t=s(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw Error("Unknown encoding: "+e);return t||e}function a(e){var t;switch(this.encoding=o(e),this.encoding){case"utf16le":this.text=p,this.end=g,t=4;break;case"utf8":this.fillLast=d,t=4;break;case"base64":this.text=m,this.end=y,t=3;break;default:this.write=b,this.end=w;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function l(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function c(e,t,r){var n=t.length-1;if(n<r)return 0;var i=l(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||-2===i?0:(i=l(t[n]))>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||-2===i?0:(i=l(t[n]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}function u(e,t,r){if((192&t[0])!=128)return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if((192&t[1])!=128)return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&(192&t[2])!=128)return e.lastNeed=2,""}}function d(e){var t=this.lastTotal-this.lastNeed,r=u(this,e,t);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):void(e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length)}function h(e,t){var r=c(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)}function f(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t}function p(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function g(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function m(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function y(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function b(e){return e.toString(this.encoding)}function w(e){return e&&e.length?this.write(e):""}t.s=a,a.prototype.write=function(e){var t,r;if(0===e.length)return"";if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},a.prototype.end=f,a.prototype.text=h,a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},769:function(e){function t(e){try{if(!r.g.localStorage)return!1}catch(e){return!1}var t=r.g.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function e(e,r){if(t("noDeprecation"))return e;var n=!1;return function(){if(!n){if(t("throwDeprecation"))throw Error(r);t("traceDeprecation")?console.trace(r):console.warn(r),n=!0}return e.apply(this,arguments)}}},300:function(e){"use strict";e.exports=r(44134)},361:function(e){"use strict";e.exports=r(40662)},781:function(e){"use strict";e.exports=r(40662).EventEmitter},837:function(e){"use strict";e.exports=r(1504)}},s={};function o(e){var r=s[e];if(void 0!==r)return r.exports;var n=s[e]={exports:{}},i=!0;try{t[e](n,n.exports,o),i=!1}finally{i&&delete s[e]}return n.exports}o.ab=n+"/",e.exports=o(173)}()},62897:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var n=r(31133),i=r(10258);class s{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=(0,n.A)(),this.haveNext=(0,n.A)()}[Symbol.asyncIterator](){return this}async next(){if(null==this.nextResult&&await this.haveNext.promise,null==this.nextResult)throw Error("HaveNext promise resolved but nextResult was undefined");let e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=(0,n.A)(),e}async throw(e){return this.ended=!0,this.error=e,null!=e&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){let e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){null!=e?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(null!=e&&this.ended)throw this.error??Error("Cannot push value onto an ended pushable");for(;null!=this.nextResult;)await this.readNext.promise;null!=e?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=(0,n.A)(),await (0,i.W)(this.readNext.promise,t?.signal,t)}}function o(){return new s}function a(e){return null!=e[Symbol.asyncIterator]}async function l(e,t){try{await Promise.all(e.map(async e=>{for await(let r of e)await t.push(r)})),await t.end()}catch(e){await t.end(e).catch(()=>{})}}async function*c(e){let t=o();l(e,t).catch(()=>{}),yield*t}function*u(e){for(let t of e)yield*t}let d=function(...e){let t=[];for(let r of e)a(r)||t.push(r);return t.length===e.length?u(t):c(e)}},62954:(e,t,r)=>{"use strict";r.d(t,{Ny:()=>a});var n=r(31133);class i{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||(e-1&e)!=0)throw Error("Max size for a FixedFIFO should be a power of two");this.buffer=Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class s{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new i(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new i(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}class o extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function a(e={}){return l(e=>{let t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}},e)}function l(e,t){let r,i,a,l=(t=t??{}).onEnd,c=new s,u=(0,n.A)(),d=e=>null!=i?i(e):(c.push(e),r),h=e=>(c=new s,null!=i)?i({error:e}):(c.push({error:e}),r),f=e=>{if(a)return r;if(t?.objectMode!==!0&&e?.byteLength==null)throw Error("objectMode was not true but tried to push non-Uint8Array value");return d({done:!1,value:e})},p=e=>a?r:(a=!0,null!=e?h(e):d({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{if(!c.isEmpty())return e(c);if(a)return{done:!0};return await new Promise((t,n)=>{i=s=>{i=null,c.push(s);try{t(e(c))}catch(e){n(e)}return r}})}finally{c.isEmpty()&&queueMicrotask(()=>{u.resolve(),u=(0,n.A)()})}},return:()=>(c=new s,p(),{done:!0}),throw:e=>(p(e),{done:!0}),push:f,end:p,get readableLength(){return c.size},onEmpty:async e=>{let t,r,n=e?.signal;if(n?.throwIfAborted(),!c.isEmpty()){null!=n&&(t=new Promise((e,t)=>{r=()=>{t(new o)},n.addEventListener("abort",r)}));try{await Promise.race([u.promise,t])}finally{null!=r&&null!=n&&n?.removeEventListener("abort",r)}}}},null==l)return r;let g=r;return r={[Symbol.asyncIterator](){return this},next:()=>g.next(),throw:e=>(g.throw(e),null!=l&&(l(e),l=void 0),{done:!0}),return:()=>(g.return(),null!=l&&(l(),l=void 0),{done:!0}),push:f,end:e=>(g.end(e),null!=l&&(l(e),l=void 0),r),get readableLength(){return g.readableLength},onEmpty:e=>g.onEmpty(e)}}},63547:(e,t,r)=>{"use strict";let{AbstractKeyIterator:n,AbstractValueIterator:i}=r(39070),s=Symbol("iterator"),o=Symbol("callback"),a=Symbol("handleOne"),l=Symbol("handleMany");class c extends n{constructor(e,t){super(e,t),this[s]=e.iterator({...t,keys:!0,values:!1}),this[a]=this[a].bind(this),this[l]=this[l].bind(this)}}class u extends i{constructor(e,t){super(e,t),this[s]=e.iterator({...t,keys:!1,values:!0}),this[a]=this[a].bind(this),this[l]=this[l].bind(this)}}for(let e of[c,u]){let t=e===c,r=t?e=>e[0]:e=>e[1];e.prototype._next=function(e){this[o]=e,this[s].next(this[a])},e.prototype[a]=function(e,r,n){let i=this[o];e?i(e):i(null,t?r:n)},e.prototype._nextv=function(e,t,r){this[o]=r,this[s].nextv(e,t,this[l])},e.prototype._all=function(e,t){this[o]=t,this[s].all(e,this[l])},e.prototype[l]=function(e,t){let n=this[o];e?n(e):n(null,t.map(r))},e.prototype._seek=function(e,t){this[s].seek(e,t)},e.prototype._close=function(e){this[s].close(e)}}t.DefaultKeyIterator=c,t.DefaultValueIterator=u},63674:e=>{"use strict";e.exports=TypeError},64196:(e,t,r)=>{"use strict";let n=r(7800),{Buffer:i}=r(44134)||{},{AbstractSublevelIterator:s,AbstractSublevelKeyIterator:o,AbstractSublevelValueIterator:a}=r(74181),l=Symbol("prefix"),c=Symbol("upperBound"),u=Symbol("prefixRange"),d=Symbol("parent"),h=Symbol("unfix"),f=new TextEncoder,p={separator:"!"};e.exports=function({AbstractLevel:e}){class t extends e{static defaults(e){if("string"==typeof e)throw new n("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(e&&e.open)throw new n("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return null==e?p:e.separator?e:{...e,separator:"!"}}constructor(e,r,i){let{separator:s,manifest:o,...a}=t.defaults(i);r=w(r,s);let u=s.charCodeAt(0)+1,p=e[d]||e;if(!f.encode(r).every(e=>e>u&&e<127))throw new n(`Prefix must use bytes > ${u} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(g(p,o),a);let m=(e.prefix||"")+s+r+s,v=m.slice(0,-1)+String.fromCharCode(u);this[d]=p,this[l]=new y(m),this[c]=new y(v),this[h]=new b,this.nextTick=p.nextTick}prefixKey(e,t){if("utf8"===t)return this[l].utf8+e;if(0===e.byteLength)return this[l][t];if("view"===t){let t=this[l].view,r=new Uint8Array(t.byteLength+e.byteLength);return r.set(t,0),r.set(e,t.byteLength),r}{let t=this[l].buffer;return i.concat([t,e],t.byteLength+e.byteLength)}}[u](e,t){void 0!==e.gte?e.gte=this.prefixKey(e.gte,t):void 0!==e.gt?e.gt=this.prefixKey(e.gt,t):e.gte=this[l][t],void 0!==e.lte?e.lte=this.prefixKey(e.lte,t):void 0!==e.lt?e.lt=this.prefixKey(e.lt,t):e.lte=this[c][t]}get prefix(){return this[l].utf8}get db(){return this[d]}_open(e,t){this[d].open({passive:!0},t)}_put(e,t,r,n){this[d].put(e,t,r,n)}_get(e,t,r){this[d].get(e,t,r)}_getMany(e,t,r){this[d].getMany(e,t,r)}_del(e,t,r){this[d].del(e,t,r)}_batch(e,t,r){this[d].batch(e,t,r)}_clear(e,t){this[u](e,e.keyEncoding),this[d].clear(e,t)}_iterator(e){this[u](e,e.keyEncoding);let t=this[d].iterator(e),r=this[h].get(this[l].utf8.length,e.keyEncoding);return new s(this,e,t,r)}_keys(e){this[u](e,e.keyEncoding);let t=this[d].keys(e),r=this[h].get(this[l].utf8.length,e.keyEncoding);return new o(this,e,t,r)}_values(e){this[u](e,e.keyEncoding);let t=this[d].values(e);return new a(this,e,t)}}return{AbstractSublevel:t}};let g=function(e,t){return{...e.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...t,encodings:{utf8:m(e,"utf8"),buffer:m(e,"buffer"),view:m(e,"view")}}},m=function(e,t){return!!e.supports.encodings[t]&&e.keyEncoding(t).name===t};class y{constructor(e){this.utf8=e,this.view=f.encode(e),this.buffer=i?i.from(this.view.buffer,0,this.view.byteLength):{}}}class b{constructor(){this.cache=new Map}get(e,t){let r=this.cache.get(t);return void 0===r&&(r="view"===t?(function(e,t){return t.subarray(e)}).bind(null,e):(function(e,t){return t.slice(e)}).bind(null,e),this.cache.set(t,r)),r}}let w=function(e,t){let r=0,n=e.length;for(;r<n&&e[r]===t;)r++;for(;n>r&&e[n-1]===t;)n--;return e.slice(r,n)}},65639:(e,t,r)=>{"use strict";r.d(t,{H:()=>i});var n=r(87704);function i({name:e,code:t,encode:r}){return new s(e,t,r)}class s{name;code;encode;constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?n.create(this.code,t):t.then(e=>n.create(this.code,e))}throw Error("Unknown type, must be binary type")}}},67358:(e,t,r)=>{"use strict";let n;r.d(t,{W:()=>UA});var i,s,o,a,l,c,u,d,h,f,p,g,m,y,b,w,v,E,A,x,S,k,_,I,T,C,P,R,D,N,M,B,O,L,F,U,j,H,$,q,z,V,G,K,W,Q,J,Z,Y,X,ee,et,er,en,ei,es,eo,ea,el,ec,eu,ed,eh,ef,ep,eg,em,ey,eb,ew,ev,eE,eA,ex,eS,ek,e_,eI,eT,eC,eP,eR,eD,eN,eM,eB,eO,eL,eF,eU,ej,eH,e$,eq,ez,eV,eG,eK,eW,eQ,eJ,eZ,eY,eX,e0,e1,e2,e3,e4,e5,e6,e8,e7={};r.r(e7),r.d(e7,{code:()=>tG,createLink:()=>tq,createNode:()=>t$,decode:()=>tW,encode:()=>tK,name:()=>tV,prepare:()=>tj,validate:()=>tH});var e9={};r.r(e9),r.d(e9,{code:()=>ok,decode:()=>oI,decodeOptions:()=>ox,encode:()=>o_,encodeOptions:()=>ov,name:()=>oS,toByteView:()=>ob});var te={};function tt(e){return null!=e[Symbol.asyncIterator]}r.r(te),r.d(te,{code:()=>o$,decode:()=>oz,encode:()=>oq,format:()=>oV,name:()=>oH,parse:()=>oK,stringify:()=>oV});let tr=function(e){if(tt(e))return(async()=>{for await(let t of e)return t})();for(let t of e)return t};function tn(e){return null!=e[Symbol.asyncIterator]}let ti=function(e,t=1){return(t=Number(t),tn(e))?async function*(){let r=[];if(t<1&&(t=1),t!==Math.round(t))throw Error("Batch size must be an integer");for await(let n of e)for(r.push(n);r.length>=t;)yield r.slice(0,t),r=r.slice(t);for(;r.length>0;)yield r.slice(0,t),r=r.slice(t)}():function*(){let r=[];if(t<1&&(t=1),t!==Math.round(t))throw Error("Batch size must be an integer");for(let n of e)for(r.push(n);r.length>=t;)yield r.slice(0,t),r=r.slice(t);for(;r.length>0;)yield r.slice(0,t),r=r.slice(t)}()};async function*ts(e,t=1){for await(let r of ti(e,t)){let e=r.map(async e=>e().then(e=>({ok:!0,value:e}),e=>({ok:!1,err:e})));for(let t=0;t<e.length;t++){let r=await e[t];if(r.ok)yield r.value;else throw r.err}}}var to=r(18593);function ta(e){return e}function tl(e,t){null==t&&(t=e.reduce((e,t)=>e+t.length,0));let r=(0,to.K)(t),n=0;for(let t of e)r.set(t,n),n+=t.length;return ta(r)}function tc(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}let tu=Symbol.for("@achingbrain/uint8arraylist");function td(e,t){if(null==t||t<0)throw RangeError("index is out of bounds");let r=0;for(let n of e){let e=r+n.byteLength;if(t<e)return{buf:n,index:t-r};r=e}throw RangeError("index is out of bounds")}function th(e){return!!e?.[tu]}class tf{bufs;length;[tu]=!0;constructor(...e){this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(let r of e)if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.push(r);else if(th(r))t+=r.byteLength,this.bufs.push(...r.bufs);else throw Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(let r of e.reverse())if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.unshift(r);else if(th(r))t+=r.byteLength,this.bufs.unshift(...r.bufs);else throw Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){let t=td(this.bufs,e);return t.buf[t.index]}set(e,t){let r=td(this.bufs,e);r.buf[r.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let r=0;r<e.length;r++)this.set(t+r,e[r]);else if(th(e))for(let r=0;r<e.length;r++)this.set(t+r,e.get(r));else throw Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(!Number.isNaN(e=Math.trunc(e))&&!(e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){let{bufs:r,length:n}=this._subList(e,t);return tl(r,n)}subarray(e,t){let{bufs:r,length:n}=this._subList(e,t);return 1===r.length?r[0]:tl(r,n)}sublist(e,t){let{bufs:r,length:n}=this._subList(e,t),i=new tf;return i.length=n,i.bufs=[...r],i}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(0===e&&t===this.length)return{bufs:this.bufs,length:this.length};let r=[],n=0;for(let i=0;i<this.bufs.length;i++){let s=this.bufs[i],o=n,a=o+s.byteLength;if(n=a,e>=a)continue;let l=e>=o&&e<a,c=t>o&&t<=a;if(l&&c){if(e===o&&t===a){r.push(s);break}let n=e-o;r.push(s.subarray(n,n+(t-e)));break}if(l){if(0===e){r.push(s);continue}r.push(s.subarray(e-o));continue}if(c){if(t===a){r.push(s);break}r.push(s.subarray(0,t-o));break}r.push(s)}return{bufs:r,length:t-e}}indexOf(e,t=0){let r;if(!th(e)&&!(e instanceof Uint8Array))throw TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=e instanceof Uint8Array?e:e.subarray();if(isNaN(t=Number(t??0))&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),0===e.length)return t>this.length?this.length:t;let i=n.byteLength;if(0===i)throw TypeError("search must be at least 1 byte long");let s=256,o=new Int32Array(256);for(let e=0;e<s;e++)o[e]=-1;for(let e=0;e<i;e++)o[n[e]]=e;let a=o,l=this.byteLength-n.byteLength,c=n.byteLength-1;for(let e=t;e<=l;e+=r){r=0;for(let t=c;t>=0;t--){let i=this.get(e+t);if(n[t]!==i){r=Math.max(1,t-a[i]);break}}if(0===r)return e}return -1}getInt8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){let r=(0,to.K)(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt8(0,t),this.write(r,e)}getInt16(e,t){let r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt16(0,t)}setInt16(e,t,r){let n=(0,to.c)(2);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt16(0,t,r),this.write(n,e)}getInt32(e,t){let r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt32(0,t)}setInt32(e,t,r){let n=(0,to.c)(4);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt32(0,t,r),this.write(n,e)}getBigInt64(e,t){let r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigInt64(0,t)}setBigInt64(e,t,r){let n=(0,to.c)(8);new DataView(n.buffer,n.byteOffset,n.byteLength).setBigInt64(0,t,r),this.write(n,e)}getUint8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){let r=(0,to.K)(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint8(0,t),this.write(r,e)}getUint16(e,t){let r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint16(0,t)}setUint16(e,t,r){let n=(0,to.c)(2);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint16(0,t,r),this.write(n,e)}getUint32(e,t){let r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint32(0,t)}setUint32(e,t,r){let n=(0,to.c)(4);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint32(0,t,r),this.write(n,e)}getBigUint64(e,t){let r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigUint64(0,t)}setBigUint64(e,t,r){let n=(0,to.c)(8);new DataView(n.buffer,n.byteOffset,n.byteLength).setBigUint64(0,t,r),this.write(n,e)}getFloat32(e,t){let r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat32(0,t)}setFloat32(e,t,r){let n=(0,to.c)(4);new DataView(n.buffer,n.byteOffset,n.byteLength).setFloat32(0,t,r),this.write(n,e)}getFloat64(e,t){let r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat64(0,t)}setFloat64(e,t,r){let n=(0,to.c)(8);new DataView(n.buffer,n.byteOffset,n.byteLength).setFloat64(0,t,r),this.write(n,e)}equals(e){if(null==e||!(e instanceof tf)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!tc(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){let r=new tf;return r.bufs=e,null==t&&(t=e.reduce((e,t)=>e+t.byteLength,0)),r.length=t,r}}let tp=262144,tg=(e={})=>{let t=e.chunkSize??tp;return async function*(e){let r=new tf,n=0,i=!1;for await(let s of e)for(r.append(s),n+=s.length;n>=t;)if(yield r.slice(0,t),i=!0,t===r.length)r=new tf,n=0;else{let e=new tf;e.append(r.sublist(t)),r=e,n-=t}(!i||n>0)&&(yield r.subarray(0,n))}};var tm=r(69685);let ty=new TextDecoder;function tb(e,t){let r=0;for(let n=0;;n+=7){if(n>=64)throw Error("protobuf: varint overflow");if(t>=e.length)throw Error("protobuf: unexpected end of data");let i=e[t++];if(r+=n<28?(127&i)<<n:(127&i)*2**n,i<128)break}return[r,t]}function tw(e,t){let r;[r,t]=tb(e,t);let n=t+r;if(r<0||n<0)throw Error("protobuf: invalid length");if(n>e.length)throw Error("protobuf: unexpected end of data");return[e.subarray(t,n),n]}function tv(e,t){let r;return[r,t]=tb(e,t),[7&r,r>>3,t]}function tE(e){let t={},r=e.length,n=0;for(;n<r;){let r,i;if([r,i,n]=tv(e,n),1===i){if(t.Hash)throw Error("protobuf: (PBLink) duplicate Hash section");if(2!==r)throw Error(`protobuf: (PBLink) wrong wireType (${r}) for Hash`);if(void 0!==t.Name)throw Error("protobuf: (PBLink) invalid order, found Name before Hash");if(void 0!==t.Tsize)throw Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[t.Hash,n]=tw(e,n)}else if(2===i){let i;if(void 0!==t.Name)throw Error("protobuf: (PBLink) duplicate Name section");if(2!==r)throw Error(`protobuf: (PBLink) wrong wireType (${r}) for Name`);if(void 0!==t.Tsize)throw Error("protobuf: (PBLink) invalid order, found Tsize before Name");[i,n]=tw(e,n),t.Name=ty.decode(i)}else if(3===i){if(void 0!==t.Tsize)throw Error("protobuf: (PBLink) duplicate Tsize section");if(0!==r)throw Error(`protobuf: (PBLink) wrong wireType (${r}) for Tsize`);[t.Tsize,n]=tb(e,n)}else throw Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${i}`)}if(n>r)throw Error("protobuf: (PBLink) unexpected end of data");return t}function tA(e){let t,r,n=e.length,i=0,s=!1;for(;i<n;){let n,o;if([n,o,i]=tv(e,i),2!==n)throw Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${n}`);if(1===o){if(r)throw Error("protobuf: (PBNode) duplicate Data section");[r,i]=tw(e,i),t&&(s=!0)}else if(2===o){let r;if(s)throw Error("protobuf: (PBNode) duplicate Links section");t||(t=[]),[r,i]=tw(e,i),t.push(tE(r))}else throw Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${o}`)}if(i>n)throw Error("protobuf: (PBNode) unexpected end of data");let o={};return r&&(o.Data=r),o.Links=t||[],o}let tx=new TextEncoder,tS=0x100000000,tk=0x80000000;function t_(e,t){let r=t.length;if("number"==typeof e.Tsize){if(e.Tsize<0)throw Error("Tsize cannot be negative");if(!Number.isSafeInteger(e.Tsize))throw Error("Tsize too large for encoding");r=tP(t,r,e.Tsize)-1,t[r]=24}if("string"==typeof e.Name){let n=tx.encode(e.Name);r-=n.length,t.set(n,r),r=tP(t,r,n.length)-1,t[r]=18}return e.Hash&&(r-=e.Hash.length,t.set(e.Hash,r),r=tP(t,r,e.Hash.length)-1,t[r]=10),t.length-r}function tI(e){let t=tC(e),r=new Uint8Array(t),n=t;if(e.Data&&(n-=e.Data.length,r.set(e.Data,n),n=tP(r,n,e.Data.length)-1,r[n]=10),e.Links)for(let t=e.Links.length-1;t>=0;t--){let i=t_(e.Links[t],r.subarray(0,n));n-=i,n=tP(r,n,i)-1,r[n]=18}return r}function tT(e){let t=0;if(e.Hash){let r=e.Hash.length;t+=1+r+tR(r)}if("string"==typeof e.Name){let r=tx.encode(e.Name).length;t+=1+r+tR(r)}return"number"==typeof e.Tsize&&(t+=1+tR(e.Tsize)),t}function tC(e){let t=0;if(e.Data){let r=e.Data.length;t+=1+r+tR(r)}if(e.Links)for(let r of e.Links){let e=tT(r);t+=1+e+tR(e)}return t}function tP(e,t,r){let n=t-=tR(r);for(;r>=tk;)e[t++]=127&r|128,r/=128;for(;r>=128;)e[t++]=127&r|128,r>>>=7;return e[t]=r,n}function tR(e){return e%2==0&&e++,Math.floor((tD(e)+6)/7)}function tD(e){let t=0;return e>=tS&&(e=Math.floor(e/tS),t=32),e>=65536&&(e>>>=16,t+=16),e>=256&&(e>>>=8,t+=8),t+tN[e]}let tN=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],tM=["Data","Links"],tB=["Hash","Name","Tsize"],tO=new TextEncoder;function tL(e,t){if(e===t)return 0;let r=e.Name?tO.encode(e.Name):[],n=t.Name?tO.encode(t.Name):[],i=r.length,s=n.length;for(let e=0,t=Math.min(i,s);e<t;++e)if(r[e]!==n[e]){i=r[e],s=n[e];break}return i<s?-1:+(s<i)}function tF(e,t){return!Object.keys(e).some(e=>!t.includes(e))}function tU(e){if("object"==typeof e.asCID){let t=tm.TO.asCID(e);if(!t)throw TypeError("Invalid DAG-PB form");return{Hash:t}}if("object"!=typeof e||Array.isArray(e))throw TypeError("Invalid DAG-PB form");let t={};if(e.Hash){let r=tm.TO.asCID(e.Hash);try{!r&&("string"==typeof e.Hash?r=tm.TO.parse(e.Hash):e.Hash instanceof Uint8Array&&(r=tm.TO.decode(e.Hash)))}catch(e){throw TypeError(`Invalid DAG-PB form: ${e.message}`)}r&&(t.Hash=r)}if(!t.Hash)throw TypeError("Invalid DAG-PB form");return"string"==typeof e.Name&&(t.Name=e.Name),"number"==typeof e.Tsize&&(t.Tsize=e.Tsize),t}function tj(e){if((e instanceof Uint8Array||"string"==typeof e)&&(e={Data:e}),"object"!=typeof e||Array.isArray(e))throw TypeError("Invalid DAG-PB form");let t={};if(void 0!==e.Data)if("string"==typeof e.Data)t.Data=tO.encode(e.Data);else if(e.Data instanceof Uint8Array)t.Data=e.Data;else throw TypeError("Invalid DAG-PB form");if(void 0!==e.Links)if(Array.isArray(e.Links))t.Links=e.Links.map(tU),t.Links.sort(tL);else throw TypeError("Invalid DAG-PB form");else t.Links=[];return t}function tH(e){if(!e||"object"!=typeof e||Array.isArray(e)||e instanceof Uint8Array||e["/"]&&e["/"]===e.bytes)throw TypeError("Invalid DAG-PB form");if(!tF(e,tM))throw TypeError("Invalid DAG-PB form (extraneous properties)");if(void 0!==e.Data&&!(e.Data instanceof Uint8Array))throw TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(e.Links))throw TypeError("Invalid DAG-PB form (Links must be a list)");for(let t=0;t<e.Links.length;t++){let r=e.Links[t];if(!r||"object"!=typeof r||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw TypeError("Invalid DAG-PB form (bad link)");if(!tF(r,tB))throw TypeError("Invalid DAG-PB form (extraneous properties on link)");if(void 0===r.Hash)throw TypeError("Invalid DAG-PB form (link must have a Hash)");if(null==r.Hash||!r.Hash["/"]||r.Hash["/"]!==r.Hash.bytes)throw TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(void 0!==r.Name&&"string"!=typeof r.Name)throw TypeError("Invalid DAG-PB form (link Name must be a string)");if(void 0!==r.Tsize){if("number"!=typeof r.Tsize||r.Tsize%1!=0)throw TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(r.Tsize<0)throw TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(t>0&&-1===tL(r,e.Links[t-1]))throw TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function t$(e,t=[]){return tj({Data:e,Links:t})}function tq(e,t,r){return tU({Hash:r,Name:e,Tsize:t})}function tz(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}let tV="dag-pb",tG=112;function tK(e){tH(e);let t={};return e.Links&&(t.Links=e.Links.map(e=>{let t={};return e.Hash&&(t.Hash=e.Hash.bytes),void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t})),e.Data&&(t.Data=e.Data),tI(t)}function tW(e){let t=tA(tz(e)),r={};return t.Data&&(r.Data=t.Data),t.Links&&(r.Links=t.Links.map(e=>{let t={};try{t.Hash=tm.TO.decode(e.Hash)}catch(e){}if(!t.Hash)throw Error("Invalid Hash field found in link, expected CID");return void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t})),r}class tQ extends Error{static name="InvalidTypeError";static code="ERR_INVALID_TYPE";name=tQ.name;code=tQ.code;constructor(e="Invalid type"){super(e)}}let tJ=128,tZ=16384,tY=2097152,tX=0x10000000,t0=0x800000000,t1=0x40000000000,t2=0x2000000000000,t3=128,t4=127;function t5(e){if(e<tJ)return 1;if(e<tZ)return 2;if(e<tY)return 3;if(e<tX)return 4;if(e<t0)return 5;if(e<t1)return 6;if(e<t2)return 7;if(null!=Number.MAX_SAFE_INTEGER&&e>Number.MAX_SAFE_INTEGER)throw RangeError("Could not encode varint");return 8}function t6(e,t,r=0){switch(t5(e)){case 8:t[r++]=255&e|t3,e/=128;case 7:t[r++]=255&e|t3,e/=128;case 6:t[r++]=255&e|t3,e/=128;case 5:t[r++]=255&e|t3,e/=128;case 4:t[r++]=255&e|t3,e>>>=7;case 3:t[r++]=255&e|t3,e>>>=7;case 2:t[r++]=255&e|t3,e>>>=7;case 1:t[r++]=255&e,e>>>=7;break;default:throw Error("unreachable")}return t}function t8(e,t,r=0){switch(t5(e)){case 8:t.set(r++,255&e|t3),e/=128;case 7:t.set(r++,255&e|t3),e/=128;case 6:t.set(r++,255&e|t3),e/=128;case 5:t.set(r++,255&e|t3),e/=128;case 4:t.set(r++,255&e|t3),e>>>=7;case 3:t.set(r++,255&e|t3),e>>>=7;case 2:t.set(r++,255&e|t3),e>>>=7;case 1:t.set(r++,255&e),e>>>=7;break;default:throw Error("unreachable")}return t}function t7(e,t){let r,n=e[t];if(r=0+(n&t4),n<t3||(r+=((n=e[t+1])&t4)<<7,n<t3)||(r+=((n=e[t+2])&t4)<<14,n<t3)||(r+=((n=e[t+3])&t4)<<21,n<t3)||(r+=((n=e[t+4])&t4)*tX,n<t3)||(r+=((n=e[t+5])&t4)*t0,n<t3)||(r+=((n=e[t+6])&t4)*t1,n<t3)||(r+=((n=e[t+7])&t4)*t2,n<t3))return r;throw RangeError("Could not decode varint")}function t9(e,t){let r,n=e.get(t);if(r=0+(n&t4),n<t3||(r+=((n=e.get(t+1))&t4)<<7,n<t3)||(r+=((n=e.get(t+2))&t4)<<14,n<t3)||(r+=((n=e.get(t+3))&t4)<<21,n<t3)||(r+=((n=e.get(t+4))&t4)*tX,n<t3)||(r+=((n=e.get(t+5))&t4)*t0,n<t3)||(r+=((n=e.get(t+6))&t4)*t1,n<t3)||(r+=((n=e.get(t+7))&t4)*t2,n<t3))return r;throw RangeError("Could not decode varint")}function re(e,t,r=0){return(null==t&&(t=(0,to.K)(t5(e))),t instanceof Uint8Array)?t6(e,t,r):t8(e,t,r)}function rt(e,t=0){return e instanceof Uint8Array?t7(e,t):t9(e,t)}let rr=new Float32Array([-0]),rn=new Uint8Array(rr.buffer);function ri(e,t,r){rr[0]=e,t[r]=rn[0],t[r+1]=rn[1],t[r+2]=rn[2],t[r+3]=rn[3]}function rs(e,t){return rn[0]=e[t],rn[1]=e[t+1],rn[2]=e[t+2],rn[3]=e[t+3],rr[0]}let ro=new Float64Array([-0]),ra=new Uint8Array(ro.buffer);function rl(e,t,r){ro[0]=e,t[r]=ra[0],t[r+1]=ra[1],t[r+2]=ra[2],t[r+3]=ra[3],t[r+4]=ra[4],t[r+5]=ra[5],t[r+6]=ra[6],t[r+7]=ra[7]}function rc(e,t){return ra[0]=e[t],ra[1]=e[t+1],ra[2]=e[t+2],ra[3]=e[t+3],ra[4]=e[t+4],ra[5]=e[t+5],ra[6]=e[t+6],ra[7]=e[t+7],ro[0]}let ru=BigInt(Number.MAX_SAFE_INTEGER),rd=BigInt(Number.MIN_SAFE_INTEGER);class rh{lo;hi;constructor(e,t){this.lo=0|e,this.hi=0|t}toNumber(e=!1){if(!e&&this.hi>>>31>0){let e=~this.lo+1>>>0,t=~this.hi>>>0;return 0===e&&(t=t+1>>>0),-(e+0x100000000*t)}return this.lo+0x100000000*this.hi}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31!=0){let e=~this.lo+1>>>0,t=~this.hi>>>0;return 0===e&&(t=t+1>>>0),-(BigInt(e)+(BigInt(t)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){let e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){let e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){let e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}static fromBigInt(e){if(0n===e)return rf;if(e<ru&&e>rd)return this.fromNumber(Number(e));let t=e<0n;t&&(e=-e);let r=e>>32n,n=e-(r<<32n);return t&&(r=0n|~r,n=0n|~n,++n>rp&&(n=0n,++r>rp&&(r=0n))),new rh(Number(n),Number(r))}static fromNumber(e){if(0===e)return rf;let t=e<0;t&&(e=-e);let r=e>>>0,n=(e-r)/0x100000000>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>0xffffffff&&(r=0,++n>0xffffffff&&(n=0))),new rh(r,n)}static from(e){return"number"==typeof e?rh.fromNumber(e):"bigint"==typeof e?rh.fromBigInt(e):"string"==typeof e?rh.fromBigInt(BigInt(e)):null!=e.low||null!=e.high?new rh(e.low>>>0,e.high>>>0):rf}}let rf=new rh(0,0);rf.toBigInt=function(){return 0n},rf.zzEncode=rf.zzDecode=function(){return this},rf.length=function(){return 1};let rp=4294967296n;function rg(e){let t=0,r=0;for(let n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:(64512&r)==55296&&(64512&e.charCodeAt(n+1))==56320?(++n,t+=4):t+=3;return t}function rm(e,t,r){let n,i;if(r-t<1)return"";let s=[],o=0;for(;t<r;)(i=e[t++])<128?s[o++]=i:i>191&&i<224?s[o++]=(31&i)<<6|63&e[t++]:i>239&&i<365?(i=((7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[o++]=55296+(i>>10),s[o++]=56320+(1023&i)):s[o++]=(15&i)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((n??(n=[])).push(String.fromCharCode.apply(String,s)),o=0);return null!=n?(o>0&&n.push(String.fromCharCode.apply(String,s.slice(0,o))),n.join("")):String.fromCharCode.apply(String,s.slice(0,o))}function ry(e,t,r){let n,i,s=r;for(let s=0;s<e.length;++s)(n=e.charCodeAt(s))<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:((64512&n)==55296&&(64512&(i=e.charCodeAt(s+1)))==56320?(n=65536+((1023&n)<<10)+(1023&i),++s,t[r++]=n>>18|240,t[r++]=n>>12&63|128):t[r++]=n>>12|224,t[r++]=n>>6&63|128),t[r++]=63&n|128);return r-s}function rb(e,t){return RangeError(`index out of range: ${e.pos} + ${t??1} > ${e.len}`)}function rw(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}class rv{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(e){this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=0xffffffff;if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,rb(this,10);return e}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}bool(){return 0!==this.uint32()}fixed32(){if(this.pos+4>this.len)throw rb(this,4);return rw(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw rb(this,4);return 0|rw(this.buf,this.pos+=4)}float(){if(this.pos+4>this.len)throw rb(this,4);let e=rs(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw rb(this,4);let e=rc(this.buf,this.pos);return this.pos+=8,e}bytes(){let e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw rb(this,e);return this.pos+=e,t===r?new Uint8Array(0):this.buf.subarray(t,r)}string(){let e=this.bytes();return rm(e,0,e.length)}skip(e){if("number"==typeof e){if(this.pos+e>this.len)throw rb(this,e);this.pos+=e}else do if(this.pos>=this.len)throw rb(this);while((128&this.buf[this.pos++])!=0);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){let e=new rh(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw rb(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw rb(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw rb(this,8);return new rh(rw(this.buf,this.pos+=4),rw(this.buf,this.pos+=4))}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let e=t7(this.buf,this.pos);return this.pos+=t5(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function rE(e){return new rv(e instanceof Uint8Array?e:e.subarray())}function rA(e,t,r){let n=rE(e);return t.decode(n,void 0,r)}var rx=r(22938);function rS(e){let t,r=e??8192,n=r>>>1,i=r;return function(e){if(e<1||e>n)return(0,to.K)(e);i+e>r&&(t=(0,to.K)(r),i=0);let s=t.subarray(i,i+=e);return(7&i)!=0&&(i=(7|i)+1),s}}class rk{fn;len;next;val;constructor(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}}function r_(){}class rI{head;tail;len;next;constructor(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}let rT=rS();function rC(e){return null!=globalThis.Buffer?(0,to.K)(e):rT(e)}class rP{len;head;tail;states;constructor(){this.len=0,this.head=new rk(r_,0,0),this.tail=this.head,this.states=null}_push(e,t,r){return this.tail=this.tail.next=new rk(e,t,r),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new rN((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<0x10000000?4:5,e)).len,this}int32(e){return e<0?this._push(rM,10,rh.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){let t=rh.fromBigInt(e);return this._push(rM,t.length(),t)}uint64Number(e){return this._push(t6,t5(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){let t=rh.fromBigInt(e).zzEncode();return this._push(rM,t.length(),t)}sint64Number(e){let t=rh.fromNumber(e).zzEncode();return this._push(rM,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(rR,1,+!!e)}fixed32(e){return this._push(rB,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){let t=rh.fromBigInt(e);return this._push(rB,4,t.lo)._push(rB,4,t.hi)}fixed64Number(e){let t=rh.fromNumber(e);return this._push(rB,4,t.lo)._push(rB,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(ri,4,e)}double(e){return this._push(rl,8,e)}bytes(e){let t=e.length>>>0;return 0===t?this._push(rR,1,0):this.uint32(t)._push(rO,t,e)}string(e){let t=rg(e);return 0!==t?this.uint32(t)._push(ry,t,e):this._push(rR,1,0)}fork(){return this.states=new rI(this),this.head=this.tail=new rk(r_,0,0),this.len=0,this}reset(){return null!=this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new rk(r_,0,0),this.len=0),this}ldelim(){let e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),0!==r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this}finish(){let e=this.head.next,t=rC(this.len),r=0;for(;null!=e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t}}function rR(e,t,r){t[r]=255&e}function rD(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}class rN extends rk{next;constructor(e,t){super(rD,e,t),this.next=void 0}}function rM(e,t,r){for(;0!==e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function rB(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function rO(e,t,r){t.set(e,r)}function rL(e,t,r){t.set(e,r)}function rF(e,t,r){e.length<40?ry(e,t,r):null!=t.utf8Write?t.utf8Write(e,r):t.set((0,rx.s)(e),r)}function rU(){return new rP}function rj(e,t){let r=rU();return t.encode(e,r,{lengthDelimited:!1}),r.finish()}function rH(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function r$(e){function t(t){if(null==e[t.toString()])throw Error("Invalid enum value");return e[t]}let r=function(e,r){let n=t(e);r.int32(n)},n=function(e){return t(e.int32())};return rH("enum",i.VARINT,r,n)}function rq(e,t){return rH("message",i.LENGTH_DELIMITED,e,t)}null!=globalThis.Buffer&&(rP.prototype.bytes=function(e){let t=e.length>>>0;return this.uint32(t),t>0&&this._push(rL,t,e),this},rP.prototype.string=function(e){let t=globalThis.Buffer.byteLength(e);return this.uint32(t),t>0&&this._push(rF,t,e),this}),function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"}(i||(i={}));class rz extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"}class rV extends Error{code="ERR_MAX_SIZE";name="MaxSizeError"}!function(e){let t,r,n;!function(e){e.Raw="Raw",e.Directory="Directory",e.File="File",e.Metadata="Metadata",e.Symlink="Symlink",e.HAMTShard="HAMTShard"}(t=e.DataType||(e.DataType={})),function(e){e[e.Raw=0]="Raw",e[e.Directory=1]="Directory",e[e.File=2]="File",e[e.Metadata=3]="Metadata",e[e.Symlink=4]="Symlink",e[e.HAMTShard=5]="HAMTShard"}(r||(r={})),function(e){e.codec=()=>r$(r)}(t=e.DataType||(e.DataType={})),e.codec=()=>(null==n&&(n=rq((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.Type&&(r.uint32(8),e.DataType.codec().encode(t.Type,r)),null!=t.Data&&(r.uint32(18),r.bytes(t.Data)),null!=t.filesize&&(r.uint32(24),r.uint64(t.filesize)),null!=t.blocksizes)for(let e of t.blocksizes)r.uint32(32),r.uint64(e);null!=t.hashType&&(r.uint32(40),r.uint64(t.hashType)),null!=t.fanout&&(r.uint32(48),r.uint64(t.fanout)),null!=t.mode&&(r.uint32(56),r.uint32(t.mode)),null!=t.mtime&&(r.uint32(66),o.codec().encode(t.mtime,r)),!1!==n.lengthDelimited&&r.ldelim()},(t,r)=>{let n={blocksizes:[]},i=null==r?t.len:t.pos+r;for(;t.pos<i;){let r=t.uint32();switch(r>>>3){case 1:n.Type=e.DataType.codec().decode(t);break;case 2:n.Data=t.bytes();break;case 3:n.filesize=t.uint64();break;case 4:n.blocksizes.push(t.uint64());break;case 5:n.hashType=t.uint64();break;case 6:n.fanout=t.uint64();break;case 7:n.mode=t.uint32();break;case 8:n.mtime=o.codec().decode(t,t.uint32());break;default:t.skipType(7&r)}}return n})),n),e.encode=t=>rj(t,e.codec()),e.decode=t=>rA(t,e.codec())}(s||(s={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Seconds&&(t.uint32(8),t.int64(e.Seconds)),null!=e.FractionalNanoseconds&&(t.uint32(21),t.fixed32(e.FractionalNanoseconds)),!1!==r.lengthDelimited&&t.ldelim()},(e,t)=>{let r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.Seconds=e.int64();break;case 2:r.FractionalNanoseconds=e.fixed32();break;default:e.skipType(7&t)}}return r})),t),e.encode=t=>rj(t,e.codec()),e.decode=t=>rA(t,e.codec())}(o||(o={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.MimeType&&(t.uint32(10),t.string(e.MimeType)),!1!==r.lengthDelimited&&t.ldelim()},(e,t)=>{let r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){let t=e.uint32();t>>>3==1?r.MimeType=e.string():e.skipType(7&t)}return r})),t),e.encode=t=>rj(t,e.codec()),e.decode=t=>rA(t,e.codec())}(a||(a={}));let rG={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},rK=["directory","hamt-sharded-directory"],rW=parseInt("0644",8),rQ=parseInt("0755",8);class rJ{static unmarshal(e){let t=s.decode(e),r=new rJ({type:rG[null!=t.Type?t.Type.toString():"File"],data:t.Data,blockSizes:t.blocksizes,mode:t.mode,mtime:null!=t.mtime?{secs:t.mtime.Seconds??0n,nsecs:t.mtime.FractionalNanoseconds}:void 0,fanout:t.fanout});return r._originalMode=t.mode??0,r}type;data;blockSizes;hashType;fanout;mtime;_mode;_originalMode;constructor(e={type:"file"}){let{type:t,data:r,blockSizes:n,hashType:i,fanout:s,mtime:o,mode:a}=e;if(null!=t&&!Object.values(rG).includes(t))throw new tQ("Type: "+t+" is not valid");this.type=t??"file",this.data=r,this.hashType=i,this.fanout=s,this.blockSizes=n??[],this._originalMode=0,this.mode=a,this.mtime=o}set mode(e){null==e?this._mode=this.isDirectory()?rQ:rW:this._mode=4095&e}get mode(){return this._mode}isDirectory(){return rK.includes(this.type)}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0n;let e=0n;return this.blockSizes.forEach(t=>{e+=t}),null!=this.data&&(e+=BigInt(this.data.length)),e}marshal(){let e,t,r;switch(this.type){case"raw":e=s.DataType.Raw;break;case"directory":e=s.DataType.Directory;break;case"file":e=s.DataType.File;break;case"metadata":e=s.DataType.Metadata;break;case"symlink":e=s.DataType.Symlink;break;case"hamt-sharded-directory":e=s.DataType.HAMTShard;break;default:throw new tQ(`Type: ${e} is not valid`)}let n=this.data;return(null==this.data||0===this.data.length)&&(n=void 0),null!=this.mode&&((t=0xfffff000&this._originalMode|(this.mode??0))!==rW||this.isDirectory()||(t=void 0),t===rQ&&this.isDirectory()&&(t=void 0)),null!=this.mtime&&(r={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),s.encode({Type:e,Data:n,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:t,mtime:r})}}var rZ=r(34269);class rY extends Event{type;detail;constructor(e,t){super(e),this.type=e,this.detail=t}}var rX=r(97141);let r0=async(e,t,r)=>{null==r.codec&&(r.codec=e7);let n=await rX.sha256.digest(e),i=tm.TO.create(r.cidVersion,r.codec.code,n);return await t.put(i,e,r),i};function r1(e){return async function*(t,r){let n=0n;for await(let i of t.content)yield async()=>{let s,o={codec:e7,cidVersion:e.cidVersion,onProgress:e.onProgress};e.rawLeaves?(o.codec=rZ,o.cidVersion=1):i=tK({Data:(s=new rJ({type:e.leafType,data:i})).marshal(),Links:[]});let a=await r0(i,r,o);return n+=BigInt(i.byteLength),e.onProgress?.(new rY("unixfs:importer:progress:file:write",{bytesWritten:n,cid:a,path:t.path})),{cid:a,unixfs:s,size:BigInt(i.length),block:i}}}}class r2 extends Error{static name="InvalidParametersError";static code="ERR_INVALID_PARAMS";name=r2.name;code=r2.code;constructor(e="Invalid parameters"){super(e)}}class r3 extends Error{static name="InvalidAvgChunkSizeError";static code="ERR_INVALID_AVG_CHUNK_SIZE";name=r3.name;code=r3.code;constructor(e="Invalid avg chunk size"){super(e)}}class r4 extends Error{static name="InvalidChunkSizeError";static code="ERR_INVALID_CHUNK_SIZE";name=r4.name;code=r4.code;constructor(e="Invalid chunk size"){super(e)}}class r5 extends Error{static name="InvalidMinChunkSizeError";static code="ERR_INVALID_MIN_CHUNK_SIZE";name=r5.name;code=r5.code;constructor(e="Invalid min chunk size"){super(e)}}class r6 extends Error{static name="InvalidContentError";static code="ERR_INVALID_CONTENT";name=r6.name;code=r6.code;constructor(e="Invalid content"){super(e)}}let r8=async(e,t,r)=>{let n=new rJ({type:"directory",mtime:e.mtime,mode:e.mode}),i=tK(tj({Data:n.marshal()}));return{cid:await r0(i,t,r),path:e.path,unixfs:n,size:BigInt(i.length),originalPath:e.originalPath,block:i}};async function*r7(e,t,r){let n,i=-1;for await(let s of ts(r.bufferImporter(e,t),r.blockWriteConcurrency)){if(0==++i){n={...s,single:!0};continue}1===i&&null!=n&&(yield{...n,block:void 0,single:void 0},n=void 0),yield{...s,block:void 0}}null!=n&&(yield n)}function r9(e){return!0===e.single}let ne=(e,t,r)=>async function(n){if(1===n.length&&r9(n[0])&&r.reduceSingleLeafToSelf){let i=n[0],s=i.block;return r9(i)&&(void 0!==e.mtime||void 0!==e.mode)&&(i.unixfs=new rJ({type:"file",mtime:e.mtime,mode:e.mode,data:i.block}),s={Data:i.unixfs.marshal(),Links:[]},i.block=tK(tj(s)),i.cid=await r0(i.block,t,{...r,cidVersion:r.cidVersion}),i.size=BigInt(i.block.length)),r.onProgress?.(new rY("unixfs:importer:progress:file:layout",{cid:i.cid,path:i.originalPath})),{cid:i.cid,path:e.path,unixfs:i.unixfs,size:i.size,originalPath:i.originalPath}}let i=new rJ({type:"file",mtime:e.mtime,mode:e.mode}),s=n.filter(e=>!!(e.cid.code===rZ.code&&e.size>0||null!=e.unixfs&&null==e.unixfs.data&&e.unixfs.fileSize()>0n)||!!e.unixfs?.data?.length).map(e=>(e.cid.code===rZ.code?i.addBlockSize(e.size):e.unixfs?.data==null?i.addBlockSize(e.unixfs?.fileSize()??0n):i.addBlockSize(BigInt(e.unixfs.data.length)),{Name:"",Tsize:Number(e.size),Hash:e.cid})),o={Data:i.marshal(),Links:s},a=tK(tj(o)),l=await r0(a,t,r);return r.onProgress?.(new rY("unixfs:importer:progress:file:layout",{cid:l,path:e.originalPath})),{cid:l,path:e.path,unixfs:i,size:BigInt(a.length+o.Links.reduce((e,t)=>e+(t.Tsize??0),0)),originalPath:e.originalPath,block:a}},nt=async(e,t,r)=>r.layout(r7(e,t,r),ne(e,t,r));function nr(e){return Symbol.iterator in e}function nn(e){return Symbol.asyncIterator in e}function ni(e){try{if(e instanceof Uint8Array)return async function*(){yield e}();if(nr(e))return async function*(){yield*e}();if(nn(e))return e}catch{}throw new r6("Content was invalid")}function ns(e){return async function*(t,r){for await(let n of t){let t;if(null!=n.path&&(t=n.path,n.path=n.path.split("/").filter(e=>null!=e&&"."!==e).join("/")),no(n)){let i={path:n.path,mtime:n.mtime,mode:n.mode,content:async function*(){let t=0n;for await(let r of e.chunker(e.chunkValidator(ni(n.content)))){let i=BigInt(r.byteLength);t+=i,e.onProgress?.(new rY("unixfs:importer:progress:file:read",{bytesRead:t,chunkSize:i,path:n.path})),yield r}}(),originalPath:t};yield async()=>nt(i,r,e)}else if(null!=n.path){let i={path:n.path,mtime:n.mtime,mode:n.mode,originalPath:t};yield async()=>r8(i,r,e)}else throw Error("Import candidate must have content or path or both")}}}function no(e){return null!=e.content}let na=()=>async function*(e){for await(let t of e){if(void 0===t.length)throw new r6("Content was invalid");if("string"==typeof t||t instanceof String)yield(0,rx.s)(t.toString());else if(Array.isArray(t))yield Uint8Array.from(t);else if(t instanceof Uint8Array)yield t;else throw new r6("Content was invalid")}},nl=174;function nc(e){let t=e?.maxChildrenPerNode??nl;return async function e(r,n){let i=[];for await(let e of ti(r,t))i.push(await n(e));return i.length>1?e(i,n):i[0]}}class nu{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}}let nd=tm.TO.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),nh=tm.TO.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi");class nf extends nu{_children;constructor(e,t){super(e,t),this._children=new Map}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,this._children.set(e,t)}async get(e){return Promise.resolve(this._children.get(e))}childCount(){return this._children.size}directChildrenCount(){return this.childCount()}onlyChild(){return this._children.values().next().value}async *eachChildSeries(){for(let[e,t]of this._children.entries())yield{key:e,child:t}}estimateNodeSize(){if(void 0!==this.nodeSize)return this.nodeSize;for(let[e,t]of(this.nodeSize=0,this._children.entries()))null!=t.size&&null!=t.cid&&(this.nodeSize+=e.length+(1===this.options.cidVersion?nh.bytes.byteLength:nd.bytes.byteLength));return this.nodeSize}async *flush(e){let t=[];for(let[r,n]of this._children.entries()){let i=n;if(n instanceof nu)for await(let t of n.flush(e))i=t,yield t;null!=i.size&&null!=i.cid&&t.push({Name:r,Tsize:Number(i.size),Hash:i.cid})}let r=new rJ({type:"directory",mtime:this.mtime,mode:this.mode}),n={Data:r.marshal(),Links:t},i=tK(tj(n)),s=await r0(i,e,this.options),o=i.length+n.Links.reduce((e,t)=>e+(t.Tsize??0),0);this.cid=s,this.size=o,yield{cid:s,unixfs:r,path:this.path,size:BigInt(o)}}}var np=r(16121),ng=r(65639),nm=r(31588);function ny(e){let t=[,,,,];for(let r=0;r<4;r++)t[r]=255&e,e>>=8;return new Uint8Array(t)}(0,ng.H)({name:"murmur3-32",code:35,encode:e=>ny(nm.x86.hash32(e))});let nb=(0,ng.H)({name:"murmur3-128",code:34,encode:e=>np.ee.fromHex(nm.x64.hash128(e))});(0,ng.H)({name:"murmur3-x64-64",code:34,encode:e=>np.ee.fromHex(nm.x64.hash128(e)).subarray(0,8)});var nw=r(84116);class nv{_options;_popCount;_parent;_posAtParent;_children;key;constructor(e,t,r=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=r,this._children=new nw,this.key=null}async put(e,t){let r=await this._findNewBucketAndPos(e);r.bucket._putAt(r,e,t)}async get(e){let t=await this._findChild(e);if(null!=t)return t.value}async del(e){let t=await this._findPlace(e),r=t.bucket._at(t.pos);null!=r&&r.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce((e,t)=>t instanceof nv?e+t.leafCount():e+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){for(let e of this._children.compactArray())e instanceof nv?yield*e.eachLeafSeries():yield e}serialize(e,t){let r=[];return t(this._children.reduce((r,n,i)=>(null!=n&&(n instanceof nv?r.push(n.serialize(e,t)):r.push(e(n,i))),r),r))}async asyncTransform(e,t){return nS(this,e,t)}toJSON(){return this.serialize(nA,nx)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){let t=await this._findPlace(e),r=t.bucket._at(t.pos);if(!(r instanceof nv)&&null!=r&&r.key===e)return r}async _findPlace(e){let t=this._options.hash("string"==typeof e?(0,rx.s)(e):e),r=await t.take(this._options.bits),n=this._children.get(r);return n instanceof nv?n._findPlace(t):{bucket:this,pos:r,hash:t,existingChild:n}}async _findNewBucketAndPos(e){let t=await this._findPlace(e);if(null!=t.existingChild&&t.existingChild.key!==e){let e=new nv(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,e);let r=await e._findPlace(t.existingChild.hash);return r.bucket._putAt(r,t.existingChild.key,t.existingChild.value),e._findNewBucketAndPos(t.hash)}return t}_putAt(e,t,r){this._putObjectAt(e.pos,{key:t,value:r,hash:e.hash})}_putObjectAt(e,t){null==this._children.get(e)&&this._popCount++,this._children.set(e,t)}_delAt(e){if(-1===e)throw Error("Invalid position");null!=this._children.get(e)&&this._popCount--,this._children.unset(e),this._level()}_level(){if(null!=this._parent&&this._popCount<=1)if(1===this._popCount){let e=this._children.find(nE);if(null!=e&&!(e instanceof nv)){let t=e.hash;t.untake(this._options.bits);let r={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(r,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}}function nE(e){return!!e}function nA(e,t){return e.key}function nx(e){return e}async function nS(e,t,r){let n=[];for(let i of e._children.compactArray())if(i instanceof nv)await nS(i,t,r);else{let r=await t(i);n.push({bitField:e._children.bitField(),children:r})}return r(n)}let nk=[255,254,252,248,240,224,192,128],n_=[1,3,7,15,31,63,127,255];class nI{_value;_currentBytePos;_currentBitPos;constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,r=0;for(;t>0&&this._haveBits();){let e=this._value[this._currentBytePos],n=this._currentBitPos+1,i=Math.min(n,t),s=nT(e,n-i,i);r=(r<<i)+s,t-=i,this._currentBitPos-=i,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return r}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function nT(e,t,r){return(e&nC(t,r))>>>t}function nC(e,t){return nk[e]&n_[Math.min(t+e-1,7)]}function nP(e){return function(t){return t instanceof nR?t:new nR(t,e)}}class nR{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(e,t){if(!(e instanceof Uint8Array))throw Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let r=0;for(;t>0;){let e=this._buffers[this._currentBufferIndex],n=Math.min(e.availableBits(),t),i=e.take(n);r=(r<<n)+i,t-=n,this._availableBits-=n,0===e.availableBits()&&this._currentBufferIndex++}return r}untake(e){let t=e;for(;t>0;){let e=this._buffers[this._currentBufferIndex],r=Math.min(e.totalBits()-e.availableBits(),t);e.untake(r),t-=r,this._availableBits+=r,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;let e=this._depth>0?tl([this._value,Uint8Array.from([this._depth])]):this._value,t=new nI(await this._hashFn(e));this._buffers.push(t),this._availableBits+=t.availableBits()}}function nD(e){if(null==e||null==e.hashFn)throw Error("please define an options.hashFn");return new nv({bits:e.bits??8,hash:nP(e.hashFn)})}async function nN(e){return(await nb.encode(e)).slice(0,8).reverse()}let nM=BigInt(34),nB=8;class nO extends nu{_bucket;constructor(e,t){super(e,t),this._bucket=nD({hashFn:nN,bits:t.shardFanoutBits??nB})}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(e,t)}async get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async *eachChildSeries(){for await(let{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return void 0!==this.nodeSize||(this.nodeSize=nj(this._bucket,this,this.options)),this.nodeSize}async *flush(e){for await(let t of nF(this._bucket,e,this,this.options))yield{...t,path:this.path}}}let nL=nO;async function*nF(e,t,r,n){let i=e._children,s=(e.tableSize()-1).toString(16).length,o=[],a=0n;for(let e=0;e<i.length;e++){let r=i.get(e);if(null==r)continue;let l=e.toString(16).toUpperCase().padStart(s,"0");if(r instanceof nv){let e;for await(let i of nF(r,t,null,n))e=i;if(null==e)throw Error("Could not flush sharded directory, no subshard found");o.push({Name:l,Tsize:Number(e.size),Hash:e.cid}),a+=e.size}else if(nU(r.value)){let e;for await(let n of r.value.flush(t))e=n,yield e;if(null==e)throw Error("Did not flush dir");let n=l+r.key;o.push({Name:n,Tsize:Number(e.size),Hash:e.cid}),a+=e.size}else{let e=r.value;if(null==e.cid)continue;let t=l+r.key,n=e.size;o.push({Name:t,Tsize:Number(n),Hash:e.cid}),a+=BigInt(n??0)}}let l=new rJ({type:"hamt-sharded-directory",data:Uint8Array.from(i.bitField().reverse()),fanout:BigInt(e.tableSize()),hashType:nM,mtime:r?.mtime,mode:r?.mode}),c=tK(tj({Data:l.marshal(),Links:o})),u=await r0(c,t,n),d=BigInt(c.byteLength)+a;yield{cid:u,unixfs:l,size:d}}function nU(e){return"function"==typeof e.flush}function nj(e,t,r){let n=e._children,i=(e.tableSize()-1).toString(16).length,s=[];for(let e=0;e<n.length;e++){let t=n.get(e);if(null==t)continue;let o=e.toString(16).toUpperCase().padStart(i,"0");if(t instanceof nv){let e=nj(t,null,r);s.push({Name:o,Tsize:Number(e),Hash:0===r.cidVersion?nd:nh})}else if("function"==typeof t.value.flush){let e=t.value.nodeSize();s.push({Name:o+t.key,Tsize:Number(e),Hash:0===r.cidVersion?nd:nh})}else{let e=t.value;if(null==e.cid)continue;let r=o+t.key,n=e.size;s.push({Name:r,Tsize:Number(n),Hash:e.cid})}}return tK(tj({Data:new rJ({type:"hamt-sharded-directory",data:Uint8Array.from(n.bitField().reverse()),fanout:BigInt(e.tableSize()),hashType:nM,mtime:t?.mtime,mode:t?.mode}).marshal(),Links:s})).length}async function nH(e,t,r,n){let i=t;t instanceof nf&&t.estimateNodeSize()>r&&(i=await n$(t,n));let s=i.parent;if(null!=s){if(i!==t){if(null!=e&&(e.parent=i),null==i.parentKey)throw Error("No parent key found");await s.put(i.parentKey,i)}return nH(i,s,r,n)}return i}async function n$(e,t){let r=new nL({root:e.root,dir:!0,parent:e.parent,parentKey:e.parentKey,path:e.path,dirty:e.dirty,flat:!1,mtime:e.mtime,mode:e.mode},t);for await(let{key:t,child:n}of e.eachChildSeries())await r.put(t,n);return r}let nq=(e="")=>e.split(/(?<!\\)\//).filter(Boolean);async function nz(e,t,r){let n=nq(e.path??""),i=n.length-1,s=t,o="";for(let a=0;a<n.length;a++){let l=n[a];o+=`${""!==o?"/":""}${l}`;let c=a===i;if(s.dirty=!0,s.cid=void 0,s.size=void 0,c)await s.put(l,e),t=await nH(null,s,r.shardSplitThresholdBytes,r);else{let e=await s.get(l);null!=e&&e instanceof nu||(e=new nf({root:!1,dir:!0,parent:s,parentKey:l,path:o,dirty:!0,flat:!0,mtime:e?.unixfs?.mtime,mode:e?.unixfs?.mode},r)),await s.put(l,e),s=e}}return t}async function*nV(e,t){if(!(e instanceof nu)){e.unixfs?.isDirectory()===!0&&(yield e);return}yield*e.flush(t)}function nG(e){return async function*(t,r){let n,i=new nf({root:!0,dir:!0,path:"",dirty:!0,flat:!0},e),s=!1;for await(let r of t){if(null==r)continue;let t=`${r.originalPath??""}`.split("/")[0];null!=t&&""!==t&&(null==n?(n=t,s=!0):n!==t&&(s=!1)),i=await nz(r,i,e),r.unixfs?.isDirectory()!==!0&&(yield r)}if(e.wrapWithDirectory||s&&i.childCount()>1)yield*nV(i,r);else for await(let e of i.eachChildSeries())null!=e&&(yield*nV(e.child,r))}}async function*nK(e,t,r={}){let n;n=Symbol.asyncIterator in e||Symbol.iterator in e?e:[e];let i=r.wrapWithDirectory??!1,s=r.shardSplitThresholdBytes??262144,o=r.shardFanoutBits??8,a=r.cidVersion??1,l=r.rawLeaves??!0,c=r.leafType??"file",u=r.fileImportConcurrency??50,d=r.blockWriteConcurrency??10,h=r.reduceSingleLeafToSelf??!0,f=r.chunker??tg(),p=r.chunkValidator??na(),g=r.dagBuilder??ns({chunker:f,chunkValidator:p,wrapWithDirectory:i,layout:r.layout??nc(),bufferImporter:r.bufferImporter??r1({cidVersion:a,rawLeaves:l,leafType:c,onProgress:r.onProgress}),blockWriteConcurrency:d,reduceSingleLeafToSelf:h,cidVersion:a,onProgress:r.onProgress});for await(let e of(r.treeBuilder??nG({wrapWithDirectory:i,shardSplitThresholdBytes:s,shardFanoutBits:o,cidVersion:a,onProgress:r.onProgress}))(ts(g(n,t),u),t))yield{cid:e.cid,path:e.path,unixfs:e.unixfs,size:e.size}}async function nW(e,t,r={}){let n=await tr(nK([e],t,r));if(null==n)throw new r2("Nothing imported");return n}async function nQ(e,t,r={}){return nW({content:e},t,r)}async function nJ(e,t,r={}){return nW({content:e},t,r)}function nZ(e){return null!=e[Symbol.asyncIterator]}let nY=function(e){let t;if(nZ(e))return(async()=>{let t;for await(let r of e)t=r;return t})();for(let r of e)t=r;return t};class nX extends Error{name;code;constructor(e,t,r){super(e),this.name=t,this.code=r}}class n0 extends nX{constructor(e="not a Unixfs node"){super(e,"NotUnixFSError","ERR_NOT_UNIXFS")}}class n1 extends nX{constructor(e="invalid PBNode"){super(e,"InvalidPBNodeError","ERR_INVALID_PB_NODE")}}class n2 extends nX{constructor(e="unknown error"){super(e,"InvalidPBNodeError","ERR_UNKNOWN_ERROR")}}class n3 extends nX{constructor(e="path already exists"){super(e,"AlreadyExistsError","ERR_ALREADY_EXISTS")}}class n4 extends nX{constructor(e="path does not exist"){super(e,"DoesNotExistError","ERR_DOES_NOT_EXIST")}}class n5 extends nX{constructor(e="no content"){super(e,"NoContentError","ERR_NO_CONTENT")}}class n6 extends nX{constructor(e="not a file"){super(e,"NotAFileError","ERR_NOT_A_FILE")}}class n8 extends nX{constructor(e="not a directory"){super(e,"NotADirectoryError","ERR_NOT_A_DIRECTORY")}}class n7 extends nX{constructor(e="invalid parameters"){super(e,"InvalidParametersError","ERR_INVALID_PARAMETERS")}}let n9={cidVersion:1,rawLeaves:!0,layout:nc({maxChildrenPerNode:1024}),chunker:tg({chunkSize:1048576})};async function*ie(e,t,r={}){yield*nK(e,t,{...n9,...r})}async function it(e,t,r={}){let{cid:n}=await nQ(e,t,{...n9,...r});return n}async function ir(e,t,r={}){let{cid:n}=await nJ(e,t,{...n9,...r});return n}async function ii(e,t,r={}){if(null==e.path)throw new n7("path is required");if(null==e.content)throw new n7("content is required");let n=await nY(ie([e],t,{...n9,...r,wrapWithDirectory:!0}));if(null==n)throw new n7("Nothing imported");return n.cid}async function is(e,t,r={}){if(null!=e.content)throw new n7("Directories cannot have content, use addFile instead");let n=null==e.path?tr:nY,i=await n(ie([{...e,path:e.path??"-"}],t,{...n9,...r,wrapWithDirectory:null!=e.path}));if(null==i)throw new n7("Nothing imported");return i.cid}class io extends Error{static name="BadPathError";static code="ERR_BAD_PATH";name=io.name;code=io.code;constructor(e="Bad path"){super(e)}}class ia extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=ia.name;code=ia.code;constructor(e="Not found"){super(e)}}class il extends Error{static name="NoResolverError";static code="ERR_NO_RESOLVER";name=il.name;code=il.code;constructor(e="No resolver"){super(e)}}class ic extends Error{static name="NotUnixFSError";static code="ERR_NOT_UNIXFS";name=ic.name;code=ic.code;constructor(e="Not UnixFS"){super(e)}}class iu extends Error{static name="OverReadError";static code="ERR_OVER_READ";name=iu.name;code=iu.code;constructor(e="Over read"){super(e)}}class id extends Error{static name="UnderReadError";static code="ERR_UNDER_READ";name=id.name;code=id.code;constructor(e="Under read"){super(e)}}class ih extends Error{static name="NoPropError";static code="ERR_NO_PROP";name=ih.name;code=ih.code;constructor(e="No Property found"){super(e)}}class ip extends Error{static name="InvalidParametersError";static code="ERR_INVALID_PARAMS";name=ip.name;code=ip.code;constructor(e="Invalid parameters"){super(e)}}let ig=["string","number","bigint","symbol"],im=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function iy(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";let t=typeof e;if(ig.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(ib(e))return"Buffer";let r=iw(e);return r||"Object"}function ib(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}function iw(e){let t=Object.prototype.toString.call(e).slice(8,-1);if(im.includes(t))return t}class iv{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:+(this.major>e.major)}}iv.uint=new iv(0,"uint",!0),iv.negint=new iv(1,"negint",!0),iv.bytes=new iv(2,"bytes",!0),iv.string=new iv(3,"string",!0),iv.array=new iv(4,"array",!1),iv.map=new iv(5,"map",!1),iv.tag=new iv(6,"tag",!1),iv.float=new iv(7,"float",!0),iv.false=new iv(7,"false",!0),iv.true=new iv(7,"true",!0),iv.null=new iv(7,"null",!0),iv.undefined=new iv(7,"undefined",!0),iv.break=new iv(7,"break",!0);class iE{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}let iA=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,ix=new TextDecoder,iS=new TextEncoder;function ik(e){return iA&&globalThis.Buffer.isBuffer(e)}function i_(e){return e instanceof Uint8Array?ik(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}let iI=iA?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):iB(e,t,r):(e,t,r)=>r-t>64?ix.decode(e.subarray(t,r)):iB(e,t,r),iT=iA?e=>e.length>64?globalThis.Buffer.from(e):iM(e):e=>e.length>64?iS.encode(e):iM(e),iC=e=>Uint8Array.from(e),iP=iA?(e,t,r)=>ik(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),iR=iA?(e,t)=>(e=e.map(e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e)),i_(globalThis.Buffer.concat(e,t))):(e,t)=>{let r=new Uint8Array(t),n=0;for(let t of e)n+t.length>r.length&&(t=t.subarray(0,r.length-n)),r.set(t,n),n+=t.length;return r},iD=iA?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function iN(e,t){if(ik(e)&&ik(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}function iM(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t}function iB(e,t,r){let n=[];for(;t<r;){let i=e[t],s=null,o=i>239?4:i>223?3:i>191?2:1;if(t+o<=r){let r,n,a,l;switch(o){case 1:i<128&&(s=i);break;case 2:(192&(r=e[t+1]))==128&&(l=(31&i)<<6|63&r)>127&&(s=l);break;case 3:r=e[t+1],n=e[t+2],(192&r)==128&&(192&n)==128&&(l=(15&i)<<12|(63&r)<<6|63&n)>2047&&(l<55296||l>57343)&&(s=l);break;case 4:r=e[t+1],n=e[t+2],a=e[t+3],(192&r)==128&&(192&n)==128&&(192&a)==128&&(l=(15&i)<<18|(63&r)<<12|(63&n)<<6|63&a)>65535&&l<1114112&&(s=l)}}null===s?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),t+=o}return iL(n)}let iO=4096;function iL(e){let t=e.length;if(t<=iO)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=iO));return r}let iF=256;class iU{constructor(e=iF){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){let e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=iD(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(1===this.chunks.length){let r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=iP(r,0,this.cursor)}else t=iR(this.chunks,this.cursor);return e&&this.reset(),t}}let ij="CBOR decode error:",iH="CBOR encode error:",i$=[];function iq(e,t,r){if(e.length-t<r)throw Error(`${ij} not enough data for type`)}i$[23]=1,i$[24]=2,i$[25]=3,i$[26]=5,i$[27]=9;let iz=[24,256,65536,0x100000000,BigInt("18446744073709551616")];function iV(e,t,r){iq(e,t,1);let n=e[t];if(!0===r.strict&&n<iz[0])throw Error(`${ij} integer encoded in more bytes than necessary (strict decode)`);return n}function iG(e,t,r){iq(e,t,2);let n=e[t]<<8|e[t+1];if(!0===r.strict&&n<iz[1])throw Error(`${ij} integer encoded in more bytes than necessary (strict decode)`);return n}function iK(e,t,r){iq(e,t,4);let n=0x1000000*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===r.strict&&n<iz[2])throw Error(`${ij} integer encoded in more bytes than necessary (strict decode)`);return n}function iW(e,t,r){iq(e,t,8);let n=0x1000000*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],i=0x1000000*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],s=(BigInt(n)<<BigInt(32))+BigInt(i);if(!0===r.strict&&s<iz[3])throw Error(`${ij} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(!0===r.allowBigInt)return s;throw Error(`${ij} integers outside of the safe integer range are not supported`)}function iQ(e,t,r,n){return new iE(iv.uint,iV(e,t+1,n),2)}function iJ(e,t,r,n){return new iE(iv.uint,iG(e,t+1,n),3)}function iZ(e,t,r,n){return new iE(iv.uint,iK(e,t+1,n),5)}function iY(e,t,r,n){return new iE(iv.uint,iW(e,t+1,n),9)}function iX(e,t){return i0(e,0,t.value)}function i0(e,t,r){if(r<iz[0]){let n=Number(r);e.push([t|n])}else if(r<iz[1]){let n=Number(r);e.push([24|t,n])}else if(r<iz[2]){let n=Number(r);e.push([25|t,n>>>8,255&n])}else if(r<iz[3]){let n=Number(r);e.push([26|t,n>>>24&255,n>>>16&255,n>>>8&255,255&n])}else{let n=BigInt(r);if(n<iz[4]){let r=[27|t,0,0,0,0,0,0,0],i=Number(n&BigInt(0xffffffff)),s=Number(n>>BigInt(32)&BigInt(0xffffffff));r[8]=255&i,i>>=8,r[7]=255&i,i>>=8,r[6]=255&i,i>>=8,r[5]=255&i,r[4]=255&s,s>>=8,r[3]=255&s,s>>=8,r[2]=255&s,s>>=8,r[1]=255&s,e.push(r)}else throw Error(`${ij} encountered BigInt larger than allowable range`)}}function i1(e,t,r,n){return new iE(iv.negint,-1-iV(e,t+1,n),2)}function i2(e,t,r,n){return new iE(iv.negint,-1-iG(e,t+1,n),3)}function i3(e,t,r,n){return new iE(iv.negint,-1-iK(e,t+1,n),5)}iX.encodedSize=function(e){return i0.encodedSize(e.value)},i0.encodedSize=function(e){return e<iz[0]?1:e<iz[1]?2:e<iz[2]?3:e<iz[3]?5:9},iX.compareTokens=function(e,t){return e.value<t.value?-1:+(e.value>t.value)};let i4=BigInt(-1),i5=BigInt(1);function i6(e,t,r,n){let i=iW(e,t+1,n);if("bigint"!=typeof i){let e=-1-i;if(e>=Number.MIN_SAFE_INTEGER)return new iE(iv.negint,e,9)}if(!0!==n.allowBigInt)throw Error(`${ij} integers outside of the safe integer range are not supported`);return new iE(iv.negint,i4-BigInt(i),9)}function i8(e,t){let r=t.value,n="bigint"==typeof r?r*i4-i5:-1*r-1;i0(e,t.type.majorEncoded,n)}function i7(e,t,r,n){iq(e,t,r+n);let i=iP(e,t+r,t+r+n);return new iE(iv.bytes,i,r+n)}function i9(e,t,r,n){return i7(e,t,1,r)}function se(e,t,r,n){return i7(e,t,2,iV(e,t+1,n))}function st(e,t,r,n){return i7(e,t,3,iG(e,t+1,n))}function sr(e,t,r,n){return i7(e,t,5,iK(e,t+1,n))}function sn(e,t,r,n){let i=iW(e,t+1,n);if("bigint"==typeof i)throw Error(`${ij} 64-bit integer bytes lengths not supported`);return i7(e,t,9,i)}function si(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===iv.string?iT(e.value):e.value),e.encodedBytes}function ss(e,t){let r=si(t);i0(e,t.type.majorEncoded,r.length),e.push(r)}function so(e,t){return e.length<t.length?-1:e.length>t.length?1:iN(e,t)}function sa(e,t,r,n,i){let s=r+n;iq(e,t,s);let o=new iE(iv.string,iI(e,t+r,t+s),s);return!0===i.retainStringBytes&&(o.byteValue=iP(e,t+r,t+s)),o}function sl(e,t,r,n){return sa(e,t,1,r,n)}function sc(e,t,r,n){return sa(e,t,2,iV(e,t+1,n),n)}function su(e,t,r,n){return sa(e,t,3,iG(e,t+1,n),n)}function sd(e,t,r,n){return sa(e,t,5,iK(e,t+1,n),n)}function sh(e,t,r,n){let i=iW(e,t+1,n);if("bigint"==typeof i)throw Error(`${ij} 64-bit integer string lengths not supported`);return sa(e,t,9,i,n)}i8.encodedSize=function(e){let t=e.value,r="bigint"==typeof t?t*i4-i5:-1*t-1;return r<iz[0]?1:r<iz[1]?2:r<iz[2]?3:r<iz[3]?5:9},i8.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},ss.encodedSize=function(e){let t=si(e);return i0.encodedSize(t.length)+t.length},ss.compareTokens=function(e,t){return so(si(e),si(t))};let sf=ss;function sp(e,t,r,n){return new iE(iv.array,n,r)}function sg(e,t,r,n){return sp(e,t,1,r)}function sm(e,t,r,n){return sp(e,t,2,iV(e,t+1,n))}function sy(e,t,r,n){return sp(e,t,3,iG(e,t+1,n))}function sb(e,t,r,n){return sp(e,t,5,iK(e,t+1,n))}function sw(e,t,r,n){let i=iW(e,t+1,n);if("bigint"==typeof i)throw Error(`${ij} 64-bit integer array lengths not supported`);return sp(e,t,9,i)}function sv(e,t,r,n){if(!1===n.allowIndefinite)throw Error(`${ij} indefinite length items not allowed`);return sp(e,t,1,1/0)}function sE(e,t){i0(e,iv.array.majorEncoded,t.value)}function sA(e,t,r,n){return new iE(iv.map,n,r)}function sx(e,t,r,n){return sA(e,t,1,r)}function sS(e,t,r,n){return sA(e,t,2,iV(e,t+1,n))}function sk(e,t,r,n){return sA(e,t,3,iG(e,t+1,n))}function s_(e,t,r,n){return sA(e,t,5,iK(e,t+1,n))}function sI(e,t,r,n){let i=iW(e,t+1,n);if("bigint"==typeof i)throw Error(`${ij} 64-bit integer map lengths not supported`);return sA(e,t,9,i)}function sT(e,t,r,n){if(!1===n.allowIndefinite)throw Error(`${ij} indefinite length items not allowed`);return sA(e,t,1,1/0)}function sC(e,t){i0(e,iv.map.majorEncoded,t.value)}function sP(e,t,r,n){return new iE(iv.tag,r,1)}function sR(e,t,r,n){return new iE(iv.tag,iV(e,t+1,n),2)}function sD(e,t,r,n){return new iE(iv.tag,iG(e,t+1,n),3)}function sN(e,t,r,n){return new iE(iv.tag,iK(e,t+1,n),5)}function sM(e,t,r,n){return new iE(iv.tag,iW(e,t+1,n),9)}function sB(e,t){i0(e,iv.tag.majorEncoded,t.value)}sE.compareTokens=iX.compareTokens,sE.encodedSize=function(e){return i0.encodedSize(e.value)},sC.compareTokens=iX.compareTokens,sC.encodedSize=function(e){return i0.encodedSize(e.value)},sB.compareTokens=iX.compareTokens,sB.encodedSize=function(e){return i0.encodedSize(e.value)};let sO=20,sL=21,sF=22,sU=23;function sj(e,t,r,n){if(!1===n.allowUndefined)throw Error(`${ij} undefined values are not supported`);return!0===n.coerceUndefinedToNull?new iE(iv.null,null,1):new iE(iv.undefined,void 0,1)}function sH(e,t,r,n){if(!1===n.allowIndefinite)throw Error(`${ij} indefinite length items not allowed`);return new iE(iv.break,void 0,1)}function s$(e,t,r){if(r){if(!1===r.allowNaN&&Number.isNaN(e))throw Error(`${ij} NaN values are not supported`);if(!1===r.allowInfinity&&(e===1/0||e===-1/0))throw Error(`${ij} Infinity values are not supported`)}return new iE(iv.float,e,t)}function sq(e,t,r,n){return s$(sZ(e,t+1),3,n)}function sz(e,t,r,n){return s$(sX(e,t+1),5,n)}function sV(e,t,r,n){return s$(s1(e,t+1),9,n)}function sG(e,t,r){let n=t.value;if(!1===n)e.push([iv.float.majorEncoded|sO]);else if(!0===n)e.push([iv.float.majorEncoded|sL]);else if(null===n)e.push([iv.float.majorEncoded|sF]);else if(void 0===n)e.push([iv.float.majorEncoded|sU]);else{let t,i=!1;r&&!0===r.float64||(sJ(n),n===(t=sZ(sQ,1))||Number.isNaN(n)?(sQ[0]=249,e.push(sQ.slice(0,3)),i=!0):(sY(n),n===(t=sX(sQ,1))&&(sQ[0]=250,e.push(sQ.slice(0,5)),i=!0))),i||(s0(n),t=s1(sQ,1),sQ[0]=251,e.push(sQ.slice(0,9)))}}sG.encodedSize=function(e,t){let r=e.value;if(!1===r||!0===r||null==r)return 1;if(!t||!0!==t.float64){sJ(r);let e=sZ(sQ,1);if(r===e||Number.isNaN(r))return 3;if(sY(r),r===(e=sX(sQ,1)))return 5}return 9};let sK=new ArrayBuffer(9),sW=new DataView(sK,1),sQ=new Uint8Array(sK,0);function sJ(e){if(e===1/0)sW.setUint16(0,31744,!1);else if(e===-1/0)sW.setUint16(0,64512,!1);else if(Number.isNaN(e))sW.setUint16(0,32256,!1);else{sW.setFloat32(0,e);let t=sW.getUint32(0),r=(0x7f800000&t)>>23,n=8388607&t;if(255===r)sW.setUint16(0,31744,!1);else if(0===r)sW.setUint16(0,(0x80000000&e)>>16|n>>13,!1);else{let e=r-127;e<-24?sW.setUint16(0,0):e<-14?sW.setUint16(0,(0x80000000&t)>>16|1<<24+e,!1):sW.setUint16(0,(0x80000000&t)>>16|e+15<<10|n>>13,!1)}}}function sZ(e,t){let r;if(e.length-t<2)throw Error(`${ij} not enough data for float16`);let n=(e[t]<<8)+e[t+1];if(31744===n)return 1/0;if(64512===n)return-1/0;if(32256===n)return NaN;let i=n>>10&31,s=1023&n;return r=0===i?5960464477539063e-23*s:31!==i?(s+1024)*2**(i-25):0===s?1/0:NaN,32768&n?-r:r}function sY(e){sW.setFloat32(0,e,!1)}function sX(e,t){if(e.length-t<4)throw Error(`${ij} not enough data for float32`);let r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function s0(e){sW.setFloat64(0,e,!1)}function s1(e,t){if(e.length-t<8)throw Error(`${ij} not enough data for float64`);let r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}function s2(e,t,r){throw Error(`${ij} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function s3(e){return()=>{throw Error(`${ij} ${e}`)}}sG.compareTokens=iX.compareTokens;let s4=[];for(let e=0;e<=23;e++)s4[e]=s2;s4[24]=iQ,s4[25]=iJ,s4[26]=iZ,s4[27]=iY,s4[28]=s2,s4[29]=s2,s4[30]=s2,s4[31]=s2;for(let e=32;e<=55;e++)s4[e]=s2;s4[56]=i1,s4[57]=i2,s4[58]=i3,s4[59]=i6,s4[60]=s2,s4[61]=s2,s4[62]=s2,s4[63]=s2;for(let e=64;e<=87;e++)s4[e]=i9;s4[88]=se,s4[89]=st,s4[90]=sr,s4[91]=sn,s4[92]=s2,s4[93]=s2,s4[94]=s2,s4[95]=s3("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)s4[e]=sl;s4[120]=sc,s4[121]=su,s4[122]=sd,s4[123]=sh,s4[124]=s2,s4[125]=s2,s4[126]=s2,s4[127]=s3("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)s4[e]=sg;s4[152]=sm,s4[153]=sy,s4[154]=sb,s4[155]=sw,s4[156]=s2,s4[157]=s2,s4[158]=s2,s4[159]=sv;for(let e=160;e<=183;e++)s4[e]=sx;s4[184]=sS,s4[185]=sk,s4[186]=s_,s4[187]=sI,s4[188]=s2,s4[189]=s2,s4[190]=s2,s4[191]=sT;for(let e=192;e<=215;e++)s4[e]=sP;s4[216]=sR,s4[217]=sD,s4[218]=sN,s4[219]=sM,s4[220]=s2,s4[221]=s2,s4[222]=s2,s4[223]=s2;for(let e=224;e<=243;e++)s4[e]=s3("simple values are not supported");s4[244]=s2,s4[245]=s2,s4[246]=s2,s4[247]=sj,s4[248]=s3("simple values are not supported"),s4[249]=sq,s4[250]=sz,s4[251]=sV,s4[252]=s2,s4[253]=s2,s4[254]=s2,s4[255]=sH;let s5=[];for(let e=0;e<24;e++)s5[e]=new iE(iv.uint,e,1);for(let e=-1;e>=-24;e--)s5[31-e]=new iE(iv.negint,e,1);s5[64]=new iE(iv.bytes,new Uint8Array(0),1),s5[96]=new iE(iv.string,"",1),s5[128]=new iE(iv.array,0,1),s5[160]=new iE(iv.map,0,1),s5[244]=new iE(iv.false,!1,1),s5[245]=new iE(iv.true,!0,1),s5[246]=new iE(iv.null,null,1);let s6={float64:!1,mapSorter:oi,quickEncodeToken:function(e){switch(e.type){case iv.false:return iC([244]);case iv.true:return iC([245]);case iv.null:return iC([246]);case iv.bytes:if(!e.value.length)return iC([64]);return;case iv.string:if(""===e.value)return iC([96]);return;case iv.array:if(0===e.value)return iC([128]);return;case iv.map:if(0===e.value)return iC([160]);return;case iv.uint:if(e.value<24)return iC([Number(e.value)]);return;case iv.negint:if(e.value>=-24)return iC([31-Number(e.value)])}}},s8=function(){let e=[];return e[iv.uint.major]=iX,e[iv.negint.major]=i8,e[iv.bytes.major]=ss,e[iv.string.major]=sf,e[iv.array.major]=sE,e[iv.map.major]=sC,e[iv.tag.major]=sB,e[iv.float.major]=sG,e}(),s7=new iU;class s9{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw Error(`${iH} object contains circular references`);return new s9(t,e)}}let oe={null:new iE(iv.null,null),undefined:new iE(iv.undefined,void 0),true:new iE(iv.true,!0),false:new iE(iv.false,!1),emptyArray:new iE(iv.array,0),emptyMap:new iE(iv.map,0)},ot={number:(e,t,r,n)=>Number.isInteger(e)&&Number.isSafeInteger(e)?e>=0?new iE(iv.uint,e):new iE(iv.negint,e):new iE(iv.float,e),bigint:(e,t,r,n)=>e>=BigInt(0)?new iE(iv.uint,e):new iE(iv.negint,e),Uint8Array:(e,t,r,n)=>new iE(iv.bytes,e),string:(e,t,r,n)=>new iE(iv.string,e),boolean:(e,t,r,n)=>e?oe.true:oe.false,null:(e,t,r,n)=>oe.null,undefined:(e,t,r,n)=>oe.undefined,ArrayBuffer:(e,t,r,n)=>new iE(iv.bytes,new Uint8Array(e)),DataView:(e,t,r,n)=>new iE(iv.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,r,n){if(!e.length)return!0===r.addBreakTokens?[oe.emptyArray,new iE(iv.break)]:oe.emptyArray;n=s9.createCheck(n,e);let i=[],s=0;for(let t of e)i[s++]=or(t,r,n);return r.addBreakTokens?[new iE(iv.array,e.length),i,new iE(iv.break)]:[new iE(iv.array,e.length),i]},Object(e,t,r,n){let i="Object"!==t,s=i?e.keys():Object.keys(e),o=i?e.size:s.length;if(!o)return!0===r.addBreakTokens?[oe.emptyMap,new iE(iv.break)]:oe.emptyMap;n=s9.createCheck(n,e);let a=[],l=0;for(let t of s)a[l++]=[or(t,r,n),or(i?e.get(t):e[t],r,n)];return(on(a,r),r.addBreakTokens)?[new iE(iv.map,o),a,new iE(iv.break)]:[new iE(iv.map,o),a]}};for(let e of(ot.Map=ot.Object,ot.Buffer=ot.Uint8Array,"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" ")))ot[`${e}Array`]=ot.DataView;function or(e,t={},r){let n=iy(e),i=t&&t.typeEncoders&&t.typeEncoders[n]||ot[n];if("function"==typeof i){let s=i(e,n,t,r);if(null!=s)return s}let s=ot[n];if(!s)throw Error(`${iH} unsupported type: ${n}`);return s(e,n,t,r)}function on(e,t){t.mapSorter&&e.sort(t.mapSorter)}function oi(e,t){let r=Array.isArray(e[0])?e[0][0]:e[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(r.type!==n.type)return r.type.compare(n.type);let i=s8[r.type.major].compareTokens(r,n);return 0===i&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i}function os(e,t,r,n){if(Array.isArray(t))for(let i of t)os(e,i,r,n);else r[t.type.major](e,t,n)}function oo(e,t,r){let n=or(e,r);if(!Array.isArray(n)&&r.quickEncodeToken){let e=r.quickEncodeToken(n);if(e)return e;let i=t[n.type.major];if(i.encodedSize){let e=new iU(i.encodedSize(n,r));if(i(e,n,r),1!==e.chunks.length)throw Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return i_(e.chunks[0])}}return s7.reset(),os(s7,n,t,r),s7.toBytes(!0)}function oa(e,t){return oo(e,s8,t=Object.assign({},s6,t))}let ol={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class oc{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){let e=this.data[this._pos],t=s5[e];if(void 0===t){let r=s4[e];if(!r)throw Error(`${ij} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let n=31&e;t=r(this.data,this._pos,n,this.options)}return this._pos+=t.encodedLength,t}}let ou=Symbol.for("DONE"),od=Symbol.for("BREAK");function oh(e,t,r){let n=[];for(let i=0;i<e.value;i++){let s=op(t,r);if(s===od){if(e.value===1/0)break;throw Error(`${ij} got unexpected break to lengthed array`)}if(s===ou)throw Error(`${ij} found array but not enough entries (got ${i}, expected ${e.value})`);n[i]=s}return n}function of(e,t,r){let n=!0===r.useMaps,i=n?void 0:{},s=n?new Map:void 0;for(let o=0;o<e.value;o++){let a=op(t,r);if(a===od){if(e.value===1/0)break;throw Error(`${ij} got unexpected break to lengthed map`)}if(a===ou)throw Error(`${ij} found map but not enough entries (got ${o} [no key], expected ${e.value})`);if(!0!==n&&"string"!=typeof a)throw Error(`${ij} non-string keys not supported (got ${typeof a})`);if(!0===r.rejectDuplicateMapKeys&&(n&&s.has(a)||!n&&a in i))throw Error(`${ij} found repeat map key "${a}"`);let l=op(t,r);if(l===ou)throw Error(`${ij} found map but not enough entries (got ${o} [no value], expected ${e.value})`);n?s.set(a,l):i[a]=l}return n?s:i}function op(e,t){if(e.done())return ou;let r=e.next();if(r.type===iv.break)return od;if(r.type.terminal)return r.value;if(r.type===iv.array)return oh(r,e,t);if(r.type===iv.map)return of(r,e,t);if(r.type===iv.tag){if(t.tags&&"function"==typeof t.tags[r.value]){let n=op(e,t);return t.tags[r.value](n)}throw Error(`${ij} tag not supported (${r.value})`)}throw Error("unsupported")}function og(e,t){if(!(e instanceof Uint8Array))throw Error(`${ij} data to decode must be a Uint8Array`);let r=(t=Object.assign({},ol,t)).tokenizer||new oc(e,t),n=op(r,t);if(n===ou)throw Error(`${ij} did not find any content to decode`);if(n===od)throw Error(`${ij} got unexpected break`);return[n,e.subarray(r.pos())]}function om(e,t){let[r,n]=og(e,t);if(n.length>0)throw Error(`${ij} too many terminals, data makes no sense`);return r}let oy=42;function ob(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}let ow={float64:!0,typeEncoders:{Object:function(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;let t=tm.TO.asCID(e);if(!t)return null;let r=new Uint8Array(t.bytes.byteLength+1);return r.set(t.bytes,1),[new iE(iv.tag,oy),new iE(iv.bytes,r)]},undefined:function(){throw Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")},number:function(e){if(Number.isNaN(e))throw Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}}},ov={...ow,typeEncoders:{...ow.typeEncoders}};function oE(e){if(0!==e[0])throw Error("Invalid CID for CBOR tag 42; expected leading 0x00");return tm.TO.decode(e.subarray(1))}let oA={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};oA.tags[oy]=oE;let ox={...oA,tags:oA.tags.slice()},oS="dag-cbor",ok=113,o_=e=>oa(e,ow),oI=e=>om(ob(e),oA);class oT extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){let t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===iv.array&&(t.elements++,1!==t.elements&&e.push([44])),t.type===iv.map&&(t.elements++,1!==t.elements&&(t.elements%2==1?e.push([44]):e.push([58]))))}[iv.uint.major](e,t){this.prefix(e);let r=String(t.value),n=[];for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);e.push(n)}[iv.negint.major](e,t){this[iv.uint.major](e,t)}[iv.bytes.major](e,t){throw Error(`${iH} unsupported type: Uint8Array`)}[iv.string.major](e,t){this.prefix(e);let r=iT(JSON.stringify(t.value));e.push(r.length>32?i_(r):r)}[iv.array.major](e,t){this.prefix(e),this.inRecursive.push({type:iv.array,elements:0}),e.push([91])}[iv.map.major](e,t){this.prefix(e),this.inRecursive.push({type:iv.map,elements:0}),e.push([123])}[iv.tag.major](e,t){}[iv.float.major](e,t){if("break"===t.type.name){let t=this.inRecursive.pop();if(t){if(t.type===iv.array)e.push([93]);else if(t.type===iv.map)e.push([125]);else throw Error("Unexpected recursive type; this should not happen!");return}throw Error("Unexpected break; this should not happen!")}if(void 0===t.value)throw Error(`${iH} unsupported type: undefined`);if(this.prefix(e),"true"===t.type.name)return void e.push([116,114,117,101]);if("false"===t.type.name)return void e.push([102,97,108,115,101]);if("null"===t.type.name)return void e.push([110,117,108,108]);let r=String(t.value),n=[],i=!1;for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e),i||46!==n[e]&&101!==n[e]&&69!==n[e]||(i=!0);i||(n.push(46),n.push(48)),e.push(n)}}let oC={addBreakTokens:!0,mapSorter:function(e,t){if(Array.isArray(e[0])||Array.isArray(t[0]))throw Error(`${iH} complex map keys are not supported`);let r=e[0],n=t[0];if(r.type!==iv.string||n.type!==iv.string)throw Error(`${iH} non-string map keys are not supported`);if(r<n)return -1;if(r>n)return 1;throw Error(`${iH} unexpected duplicate map keys, this is not supported`)}};function oP(e,t){return t=Object.assign({},oC,t),oo(e,new oT,t)}class oR{constructor(e,t={}){this._pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;32===e||9===e||13===e||10===e;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw Error(`${ij} unexpected end of input at position ${this._pos}`);for(let t=0;t<e.length;t++)if(this.data[this._pos++]!==e[t])throw Error(`${ij} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){let e=this._pos,t=!1,r=!1,n=e=>{for(;!this.done();){let t=this.ch();if(e.includes(t))this._pos++;else break}};if(45===this.ch()&&(t=!0,this._pos++),48===this.ch()){if(this._pos++,46!==this.ch())return new iE(iv.uint,0,this._pos-e);this._pos++,r=!0}if(n([48,49,50,51,52,53,54,55,56,57]),t&&this._pos===e+1)throw Error(`${ij} unexpected token at position ${this._pos}`);if(!this.done()&&46===this.ch()){if(r)throw Error(`${ij} unexpected token at position ${this._pos}`);r=!0,this._pos++,n([48,49,50,51,52,53,54,55,56,57])}this.done()||101!==this.ch()&&69!==this.ch()||(r=!0,this._pos++,!this.done()&&(43===this.ch()||45===this.ch())&&this._pos++,n([48,49,50,51,52,53,54,55,56,57]));let i=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),s=parseFloat(i);return r?new iE(iv.float,s,this._pos-e):!0!==this.options.allowBigInt||Number.isSafeInteger(s)?new iE(s>=0?iv.uint:iv.negint,s,this._pos-e):new iE(s>=0?iv.uint:iv.negint,BigInt(i),this._pos-e)}parseString(){if(34!==this.ch())throw Error(`${ij} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let e=this._pos,t=0;e<this.data.length&&t<65536;e++,t++){let r=this.data[e];if(92===r||r<32||r>=128)break;if(34===r){let r=String.fromCharCode.apply(null,this.data.subarray(this._pos,e));return this._pos=e+1,new iE(iv.string,r,t)}}let e=this._pos,t=[],r=()=>{if(this._pos+4>=this.data.length)throw Error(`${ij} unexpected end of unicode escape sequence at position ${this._pos}`);let e=0;for(let t=0;t<4;t++){let t=this.ch();if(t>=48&&t<=57)t-=48;else if(t>=97&&t<=102)t=t-97+10;else if(t>=65&&t<=70)t=t-65+10;else throw Error(`${ij} unexpected unicode escape character at position ${this._pos}`);e=16*e+t,this._pos++}return e},n=()=>{let e,r,n,i,s=this.ch(),o=null,a=s>239?4:s>223?3:s>191?2:1;if(this._pos+a>this.data.length)throw Error(`${ij} unexpected unicode sequence at position ${this._pos}`);switch(a){case 1:s<128&&(o=s);break;case 2:(192&(e=this.data[this._pos+1]))==128&&(i=(31&s)<<6|63&e)>127&&(o=i);break;case 3:e=this.data[this._pos+1],r=this.data[this._pos+2],(192&e)==128&&(192&r)==128&&(i=(15&s)<<12|(63&e)<<6|63&r)>2047&&(i<55296||i>57343)&&(o=i);break;case 4:e=this.data[this._pos+1],r=this.data[this._pos+2],n=this.data[this._pos+3],(192&e)==128&&(192&r)==128&&(192&n)==128&&(i=(15&s)<<18|(63&e)<<12|(63&r)<<6|63&n)>65535&&i<1114112&&(o=i)}null===o?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|1023&o),t.push(o),this._pos+=a};for(;!this.done();){let i,s=this.ch();switch(s){case 92:if(this._pos++,this.done())throw Error(`${ij} unexpected string termination at position ${this._pos}`);switch(i=this.ch(),this._pos++,i){case 34:case 39:case 92:case 47:t.push(i);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(r());break;default:throw Error(`${ij} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new iE(iv.string,iL(t),this._pos-e);default:if(s<32)throw Error(`${ij} invalid control character at position ${this._pos}`);s<128?(t.push(s),this._pos++):n()}}throw Error(`${ij} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new iE(iv.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new iE(iv.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new iE(iv.null,null,4);case 102:return this.expect([102,97,108,115,101]),new iE(iv.false,!1,5);case 116:return this.expect([116,114,117,101]),new iE(iv.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw Error(`${ij} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":if(this.modeStack.pop(),93===this.ch())return this._pos++,this.skipWhitespace(),new iE(iv.break,void 0,1);if(44!==this.ch())throw Error(`${ij} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"array-start":if(this.modeStack.pop(),93===this.ch())return this._pos++,this.skipWhitespace(),new iE(iv.break,void 0,1);return this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"obj-key":if(125===this.ch())return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new iE(iv.break,void 0,1);if(44!==this.ch())throw Error(`${ij} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),125===this.ch())return this._pos++,this.skipWhitespace(),new iE(iv.break,void 0,1);let e=this.parseString();if(this.skipWhitespace(),58!==this.ch())throw Error(`${ij} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw Error(`${ij} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}}function oD(e,t){return t=Object.assign({tokenizer:new oR(e,t)},t),om(e,t)}var oN=r(53647);function oM(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}function oB(e){let t=oN.base64.encode(e).slice(1);return[new iE(iv.map,1/0,1),new iE(iv.string,"/",1),new iE(iv.map,1/0,1),new iE(iv.string,"bytes",5),new iE(iv.string,t,t.length),new iE(iv.break,void 0,1),new iE(iv.break,void 0,1)]}function oO(e){return oB(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}function oL(e){return oB(new Uint8Array(e))}let oF={typeEncoders:{Object:function(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;let t=np.TO.asCID(e);if(!t)return null;let r=t.toString();return[new iE(iv.map,1/0,1),new iE(iv.string,"/",1),new iE(iv.string,r,r.length),new iE(iv.break,void 0,1)]},Buffer:oB,Uint8Array:oB,Int8Array:oO,Uint16Array:oO,Int16Array:oO,Uint32Array:oO,Int32Array:oO,Float32Array:oO,Float64Array:oO,Uint8ClampedArray:oO,BigInt64Array:oO,BigUint64Array:oO,DataView:oO,ArrayBuffer:oL,undefined:function(){throw Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")},number:function(e){if(Number.isNaN(e))throw Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}}};class oU extends oR{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return 0===this.tokenBuffer.length&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){let e=this._next();if(e.type===iv.map){let e=this._next();if(e.type===iv.string&&"/"===e.value){let e=this._next();if(e.type===iv.string){if(this._next().type!==iv.break)throw Error("Invalid encoded CID form");return this.tokenBuffer.push(e),new iE(iv.tag,42,0)}if(e.type===iv.map){let e=this._next();if(e.type===iv.string&&"bytes"===e.value){let e=this._next();if(e.type===iv.string){for(let e=0;e<2;e++)if(this._next().type!==iv.break)throw Error("Invalid encoded Bytes form");let t=oN.base64.decode(`m${e.value}`);return new iE(iv.bytes,t,e.value.length)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}return e}}let oj={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};oj.tags[42]=np.TO.parse;let oH="dag-json",o$=297,oq=e=>oP(e,oF),oz=e=>{let t=oM(e),r=Object.assign(oj,{tokenizer:new oU(t,oj)});return oD(t,r)},oV=e=>oG.decode(oq(e)),oG=new TextDecoder,oK=e=>oz(oW.encode(e)),oW=new TextEncoder;var oQ=r(47951),oJ=r(30946);function oZ(e,t,r,n,i,s,o){let a=e,l=i;for(;s.length>0;){let c=s[0];if(c in a){s.shift(),l=`${l}/${c}`;let u=tm.TO.asCID(a[c]);if(null!=u)return{entry:{type:"object",name:n,path:i,cid:r,node:t,depth:o,size:BigInt(t.length),content:async function*(){yield e}},next:{cid:u,name:c,path:l,toResolve:s}};a=a[c]}else throw new ih(`No property named ${c} found in node ${r}`)}return{entry:{type:"object",name:n,path:i,cid:r,node:t,depth:o,size:BigInt(t.length),content:async function*(){yield e}}}}let oY=async(e,t,r,n,i,s,o,a)=>{let l=await o.get(e,a);return oZ(oI(l),l,e,t,r,n,s)},oX=async(e,t,r,n,i,s,o,a)=>{let l=await o.get(e,a);return oZ(oz(l),l,e,t,r,n,s)};var o0=r(87704);let o1=function(e,t,r,n){let i=BigInt(t+BigInt(e.length));return r>=i||n<t?new Uint8Array(0):(n>=t&&n<i&&(e=e.subarray(0,Number(n-t))),r>=t&&r<i&&(e=e.subarray(Number(r-t))),e)},o2=(e,t=0,r=e)=>{let n=BigInt(e),i=BigInt(t??0),s=BigInt(r);if(s!==n&&(s=i+s),s>n&&(s=n),i<0n)throw new ip("Offset must be greater than or equal to 0");if(i>n)throw new ip("Offset must be less than the file size");if(s<0n)throw new ip("Length must be greater than or equal to 0");if(s>n)throw new ip("Length must be less than the file size");return{start:i,end:s}},o3=e=>async function*(t={}){let{start:r,end:n}=o2(e.length,t.offset,t.length),i=o1(e,0n,r,n);t.onProgress?.(new rY("unixfs:exporter:progress:identity",{bytesRead:BigInt(i.byteLength),totalBytes:n-r,fileSize:BigInt(e.byteLength)})),yield i},o4=async(e,t,r,n,i,s,o,a)=>{if(n.length>0)throw new ia(`No link named ${r} found in raw node ${e}`);let l=o0.decode(e.multihash.bytes);return{entry:{type:"identity",name:t,path:r,cid:e,content:o3(l.digest),depth:s,size:BigInt(l.digest.length),node:l.digest}}},o5=async(e,t,r,n,i,s,o,a)=>{let l=await o.get(e,a);return oZ(oQ.decode(l),l,e,t,r,n,s)},o6=e=>async function*(t={}){let{start:r,end:n}=o2(e.length,t.offset,t.length),i=o1(e,0n,r,n);t.onProgress?.(new rY("unixfs:exporter:progress:raw",{bytesRead:BigInt(i.byteLength),totalBytes:n-r,fileSize:BigInt(e.byteLength)})),yield i},o8=async(e,t,r,n,i,s,o,a)=>{if(n.length>0)throw new ia(`No link named ${r} found in raw node ${e}`);let l=await o.get(e,a);return{entry:{type:"raw",name:t,path:r,cid:e,content:o6(l),depth:s,size:BigInt(l.length),node:l}}},o7=async function(e){return(await nb.encode(e)).slice(0,8).reverse()},o9=async(e,t,r)=>{let n=(t.tableSize()-1).toString(16).length;await Promise.all(e.map(async e=>{if(null==e.Name)throw Error("Unexpected Link without a Name");if(e.Name.length===n){let n=parseInt(e.Name,16);t._putObjectAt(n,new nv({hash:r._options.hash,bits:r._options.bits},t,n));return}await r.put(e.Name.substring(2),!0)}))},ae=(e,t)=>e.toString(16).toUpperCase().padStart(t,"0").substring(0,t),at=e=>{let t=e.bucket,r=[];for(;null!=t._parent;)r.push(t),t=t._parent;return r.push(t),r.reverse()},ar=async(e,t,r,n,i)=>{if(null==n){let t;if(null==e.Data)throw new ic("no data in PBNode");try{t=rJ.unmarshal(e.Data)}catch(e){throw new ic(e.message)}if("hamt-sharded-directory"!==t.type)throw new ic("not a HAMT");if(null==t.fanout)throw new ic("missing fanout");let r=nD({hashFn:o7,bits:Math.log2(Number(t.fanout))});n={rootBucket:r,hamtDepth:1,lastBucket:r}}let s=(n.lastBucket.tableSize()-1).toString(16).length;await o9(e.Links,n.lastBucket,n.rootBucket);let o=await n.rootBucket._findNewBucketAndPos(t),a=ae(o.pos,s),l=at(o);l.length>n.hamtDepth&&(n.lastBucket=l[n.hamtDepth],a=ae(n.lastBucket._posAtParent,s));let c=e.Links.find(e=>{if(null==e.Name)return!1;let r=e.Name.substring(0,s),n=e.Name.substring(s);return r===a&&(""===n||n===t)});return null==c?void 0:null!=c.Name&&c.Name.substring(s)===t?c.Hash:(n.hamtDepth++,ar(e=tW(await r.get(c.Hash,i)),t,r,n,i))},an=ar;var ai=r(76520),as=r(7786),ao=r(31133);let aa=globalThis.CustomEvent??Event;async function*al(e,t={}){let r,n=t.concurrency??1/0;n<1&&(n=1/0);let i=t.ordered??!1,s=new EventTarget,o=[],a=(0,ao.A)(),l=(0,ao.A)(),c=!1,u=!1;function d(){return i?o[0]?.done:!!o.find(e=>e.done)}function*h(){for(;o.length>0&&o[0].done;){let e=o[0];if(o.shift(),e.ok)yield e.value;else throw u=!0,a.resolve(),e.err;a.resolve()}}function*f(){for(;d();)for(let e=0;e<o.length;e++)if(o[e].done){let t=o[e];if(o.splice(e,1),e--,t.ok)yield t.value;else throw u=!0,a.resolve(),t.err;a.resolve()}}for(s.addEventListener("task-complete",()=>{l.resolve()}),Promise.resolve().then(async()=>{try{for await(let t of e){if(o.length===n&&(a=(0,ao.A)(),await a.promise),u)break;let e={done:!1};o.push(e),t().then(t=>{e.done=!0,e.ok=!0,e.value=t,s.dispatchEvent(new aa("task-complete"))},t=>{e.done=!0,e.err=t,s.dispatchEvent(new aa("task-complete"))})}c=!0,s.dispatchEvent(new aa("task-complete"))}catch(e){r=e,s.dispatchEvent(new aa("task-complete"))}});;){if(d()||(l=(0,ao.A)(),await l.promise),null!=r||(i?yield*h():yield*f(),null!=r))throw r;if(c&&0===o.length)break}}var ac=r(45346);let au=(e,t,r,n,i,s,o)=>async function*(r={}){let a=r.offset??0,l=r.length??t.Links.length,c=t.Links.slice(a,l);r.onProgress?.(new rY("unixfs:exporter:walk:directory",{cid:e})),yield*(0,ac.F)(c,e=>(0,as.A)(e,e=>async()=>{let t=e.Name??"",a=`${n}/${t}`;return(await i(e.Hash,t,a,[],s+1,o,r)).entry}),e=>al(e,{ordered:!0,concurrency:r.blockReadConcurrency}),e=>(0,ai.A)(e,e=>null!=e))};var ad=r(62954),ah=r(15484);class af extends Error{constructor(e){super(e),this.name="TimeoutError"}}class ap extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}let ag=e=>void 0===globalThis.DOMException?new ap(e):new DOMException(e),am=e=>{let t=void 0===e.reason?ag("This operation was aborted."):e.reason;return t instanceof Error?t:ag(t)};function ay(e,t){let r,n,{milliseconds:i,fallback:s,message:o,customTimers:a={setTimeout,clearTimeout}}=t,l=new Promise((l,c)=>{if("number"!=typeof i||1!==Math.sign(i))throw TypeError(`Expected \`milliseconds\` to be a positive number, got \`${i}\``);if(t.signal){let{signal:e}=t;e.aborted&&c(am(e)),n=()=>{c(am(e))},e.addEventListener("abort",n,{once:!0})}if(i===Number.POSITIVE_INFINITY)return void e.then(l,c);let u=new af;r=a.setTimeout.call(void 0,()=>{if(s){try{l(s())}catch(e){c(e)}return}"function"==typeof e.cancel&&e.cancel(),!1===o?l():o instanceof Error?c(o):(u.message=o??`Promise timed out after ${i} milliseconds`,c(u))},i),(async()=>{try{l(await e)}catch(e){c(e)}})()}).finally(()=>{l.clear(),n&&t.signal&&t.signal.removeEventListener("abort",n)});return l.clear=()=>{a.clearTimeout.call(void 0,r),r=void 0},l}function ab(e,t,r){let n=0,i=e.length;for(;i>0;){let s=Math.trunc(i/2),o=n+s;0>=r(e[o],t)?(n=++o,i-=s+1):i=s}return n}class aw{#n=[];enqueue(e,t){let r={priority:(t={priority:0,...t}).priority,id:t.id,run:e};if(0===this.size||this.#n[this.size-1].priority>=t.priority)return void this.#n.push(r);let n=ab(this.#n,r,(e,t)=>t.priority-e.priority);this.#n.splice(n,0,r)}setPriority(e,t){let r=this.#n.findIndex(t=>t.id===e);if(-1===r)throw ReferenceError(`No promise function with the id "${e}" exists in the queue.`);let[n]=this.#n.splice(r,1);this.enqueue(n.run,{priority:t,id:e})}dequeue(){let e=this.#n.shift();return e?.run}filter(e){return this.#n.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this.#n.length}}class av extends ah.b{#i;#s;#o=0;#a;#l;#c=0;#u;#d;#n;#h;#f=0;#p;#g;#m;#y=1n;timeout;constructor(e){if(super(),!("number"==typeof(e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:aw,...e}).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap?.toString()??""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval?.toString()??""}\` (${typeof e.interval})`);this.#i=e.carryoverConcurrencyCount,this.#s=e.intervalCap===Number.POSITIVE_INFINITY||0===e.interval,this.#a=e.intervalCap,this.#l=e.interval,this.#n=new e.queueClass,this.#h=e.queueClass,this.concurrency=e.concurrency,this.timeout=e.timeout,this.#m=!0===e.throwOnTimeout,this.#g=!1===e.autoStart}get #b(){return this.#s||this.#o<this.#a}get #w(){return this.#f<this.#p}#v(){this.#f--,this.#E(),this.emit("next")}#A(){this.#x(),this.#S(),this.#d=void 0}get #k(){let e=Date.now();if(void 0===this.#u){let t=this.#c-e;if(!(t<0))return void 0===this.#d&&(this.#d=setTimeout(()=>{this.#A()},t)),!0;this.#o=this.#i?this.#f:0}return!1}#E(){if(0===this.#n.size)return this.#u&&clearInterval(this.#u),this.#u=void 0,this.emit("empty"),0===this.#f&&this.emit("idle"),!1;if(!this.#g){let e=!this.#k;if(this.#b&&this.#w){let t=this.#n.dequeue();return!!t&&(this.emit("active"),t(),e&&this.#S(),!0)}}return!1}#S(){this.#s||void 0!==this.#u||(this.#u=setInterval(()=>{this.#x()},this.#l),this.#c=Date.now()+this.#l)}#x(){0===this.#o&&0===this.#f&&this.#u&&(clearInterval(this.#u),this.#u=void 0),this.#o=this.#i?this.#f:0,this.#_()}#_(){for(;this.#E(););}get concurrency(){return this.#p}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this.#p=e,this.#_()}async #I(e){return new Promise((t,r)=>{e.addEventListener("abort",()=>{r(e.reason)},{once:!0})})}setPriority(e,t){this.#n.setPriority(e,t)}async add(e,t={}){return t.id??=(this.#y++).toString(),t={timeout:this.timeout,throwOnTimeout:this.#m,...t},new Promise((r,n)=>{this.#n.enqueue(async()=>{this.#f++,this.#o++;try{t.signal?.throwIfAborted();let n=e({signal:t.signal});t.timeout&&(n=ay(Promise.resolve(n),{milliseconds:t.timeout})),t.signal&&(n=Promise.race([n,this.#I(t.signal)]));let i=await n;r(i),this.emit("completed",i)}catch(e){if(e instanceof af&&!t.throwOnTimeout)return void r();n(e),this.emit("error",e)}finally{this.#v()}},t),this.emit("add"),this.#E()})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this.#g&&(this.#g=!1,this.#_()),this}pause(){this.#g=!0}clear(){this.#n=new this.#h}async onEmpty(){0!==this.#n.size&&await this.#T("empty")}async onSizeLessThan(e){this.#n.size<e||await this.#T("next",()=>this.#n.size<e)}async onIdle(){(0!==this.#f||0!==this.#n.size)&&await this.#T("idle")}async #T(e,t){return new Promise(r=>{let n=()=>{(!t||t())&&(this.off(e,n),r())};this.on(e,n)})}get size(){return this.#n.size}sizeBy(e){return this.#n.filter(e).length}get pending(){return this.#f}get isPaused(){return this.#g}}async function aE(e,t,r,n,i,s,o){let a;if(t instanceof Uint8Array){let e=o1(t,n,i,s);r.push(e);return}if(null==t.Data)throw new ic("no data in PBNode");try{a=rJ.unmarshal(t.Data)}catch(e){throw new ic(e.message)}if(null!=a.data){let e=o1(a.data,n,i,s);r.push(e),n+=BigInt(e.byteLength)}let l=[];if(t.Links.length!==a.blockSizes.length)throw new ic("Inconsistent block sizes and dag links");for(let e=0;e<t.Links.length;e++){let r=t.Links[e],o=n,c=o+a.blockSizes[e];if((i>=o&&i<c||s>=o&&s<=c||i<o&&s>c)&&l.push({link:r,blockStart:n}),(n=c)>s)break}await (0,ac.F)(l,t=>(0,as.A)(t,t=>async()=>{let r=await e.get(t.link.Hash,o);return{...t,block:r}}),e=>al(e,{ordered:!0,concurrency:o.blockReadConcurrency}),async t=>{for await(let{link:n,block:a,blockStart:l}of t){let t;switch(n.Hash.code){case tG:t=tW(a);break;case rZ.code:t=a;break;default:r.end(new ic(`Unsupported codec: ${n.Hash.code}`));return}let c=new av({concurrency:1});c.on("error",e=>{r.end(e)}),c.add(async()=>{o.onProgress?.(new rY("unixfs:exporter:walk:file",{cid:n.Hash})),await aE(e,t,r,l,i,s,o)}),await c.onIdle()}}),n>=s&&r.end()}let aA=(e,t,r,n,i,s,o)=>async function*(n={}){let i=r.fileSize();if(void 0===i)throw Error("File was a directory");let{start:s,end:a}=o2(i,n.offset,n.length);if(0n===a)return;let l=0n,c=a-s,u=(0,ad.Ny)();for await(let r of(n.onProgress?.(new rY("unixfs:exporter:walk:file",{cid:e})),aE(o,t,u,0n,s,a,n).catch(e=>{u.end(e)}),u))if(null!=r){if(l+=BigInt(r.byteLength),l>c)throw u.end(),new iu("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect");l===c&&u.end(),n.onProgress?.(new rY("unixfs:exporter:progress:unixfs:file",{bytesRead:l,totalBytes:c,fileSize:i})),yield r}if(l<c)throw new id("Traversed entire DAG but did not read enough bytes")};async function*ax(e,t,r,n,i,s){let o,a=e.Links;if(null==e.Data)throw new ic("no data in PBNode");try{o=rJ.unmarshal(e.Data)}catch(e){throw new ic(e.message)}if(null==o.fanout)throw new ic("missing fanout");let l=(o.fanout-1n).toString(16).length;for await(let{entries:o}of(0,ac.F)(a,o=>(0,as.A)(o,o=>async()=>{let a=null!=o.Name?o.Name.substring(l):null;if(null==a||""===a)return e=tW(await i.get(o.Hash,s)),s.onProgress?.(new rY("unixfs:exporter:walk:hamt-sharded-directory",{cid:o.Hash})),{entries:ax(e,t,r,n,i,s)};{let e=await r(o.Hash,a,`${t}/${a}`,[],n+1,i,s);return{entries:null==e.entry?[]:[e.entry]}}}),e=>al(e,{ordered:!0,concurrency:s.blockReadConcurrency})))yield*o}let aS=(e,t)=>{let r=e.Links.find(e=>e.Name===t);return r?.Hash},ak={raw:aA,file:aA,directory:au,"hamt-sharded-directory":(e,t,r,n,i,s,o)=>function(r={}){return r.onProgress?.(new rY("unixfs:exporter:walk:hamt-sharded-directory",{cid:e})),ax(t,n,i,s,o,r)},metadata:(e,t,r,n,i,s,o)=>()=>[],symlink:(e,t,r,n,i,s,o)=>()=>[]},a_={[tG]:async(e,t,r,n,i,s,o,a)=>{let l,c,u=tW(await o.get(e,a));if(null==t&&(t=e.toString()),null==u.Data)throw new ic("no data in PBNode");try{l=rJ.unmarshal(u.Data)}catch(e){throw new ic(e.message)}if(null==r&&(r=t),n.length>0){let e;if(null==(e=l?.type==="hamt-sharded-directory"?await an(u,n[0],o):aS(u,n[0])))throw new ia("file does not exist");let t=n.shift(),i=`${r}/${t}`;c={cid:e,toResolve:n,name:t??"",path:i}}let d=ak[l.type](e,u,l,r,i,s,o);if(null==d)throw new ia("could not find content exporter");return l.isDirectory()?{entry:{type:"directory",name:t,path:r,cid:e,content:d,unixfs:l,depth:s,node:u,size:l.fileSize()},next:c}:{entry:{type:"file",name:t,path:r,cid:e,content:d,unixfs:l,depth:s,node:u,size:l.fileSize()},next:c}},[rZ.code]:o8,[ok]:oY,[o$]:oX,[oJ.identity.code]:o4,[oQ.code]:o5},aI=async(e,t,r,n,i,s,o)=>{let a=a_[e.code];if(null==a)throw new il(`No resolver for code ${e.code}`);return a(e,t,r,n,aI,i,s,o)},aT=aI,aC=(e="")=>(e.trim().match(/([^\\^/]|\\\/)+/g)??[]).filter(Boolean),aP=e=>{if(e instanceof Uint8Array)return{cid:tm.TO.decode(e),toResolve:[]};let t=tm.TO.asCID(e);if(null!=t)return{cid:t,toResolve:[]};if("string"==typeof e){0===e.indexOf("/ipfs/")&&(e=e.substring(6));let t=aC(e);return{cid:tm.TO.parse(t[0]),toResolve:t.slice(1)}}throw new io(`Unknown path type ${e}`)};async function*aR(e,t,r={}){let{cid:n,toResolve:i}=aP(e),s=n.toString(),o=s,a=i.length;for(;;){let l=await aT(n,s,o,i,a,t,r);if(null==l.entry&&null==l.next)throw new ia(`Could not resolve ${e}`);if(null!=l.entry&&(yield l.entry),null==l.next)return;i=l.next.toResolve,n=l.next.cid,s=l.next.name,o=l.next.path}}async function aD(e,t,r={}){let n=await nY(aR(e,t,r));if(null==n)throw new ia(`Could not resolve ${e}`);return n}async function*aN(e,t,r={}){let n=await aD(e,t,r);if(null!=n&&(yield n,"directory"===n.type))for await(let e of i(n,r))yield e;async function*i(e,t){for await(let r of e.content(t))yield r,r instanceof Uint8Array||"directory"===r.type&&(yield*i(r,t))}}let aM=r(73737);var aB=r(3204),aO=r(4157);function aL(e){return function(t){return t instanceof aF?t:new aF(t,e)}}class aF{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(e,t){if(!(e instanceof Uint8Array))throw Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let r=0;for(;t>0;){let e=this._buffers[this._currentBufferIndex],n=Math.min(e.availableBits(),t),i=e.take(n);r=(r<<n)+i,t-=n,this._availableBits-=n,0===e.availableBits()&&this._currentBufferIndex++}return r}untake(e){let t=e;for(;t>0;){let e=this._buffers[this._currentBufferIndex],r=Math.min(e.totalBits()-e.availableBits(),t);e.untake(r),t-=r,this._availableBits+=r,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;let e=this._depth>0?tl([this._value,Uint8Array.from([this._depth])]):this._value,t=new aH(await this._hashFn(e));this._buffers.push(t),this._availableBits+=t.availableBits()}}let aU=[255,254,252,248,240,224,192,128],aj=[1,3,7,15,31,63,127,255];class aH{_value;_currentBytePos;_currentBitPos;constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,r=0;for(;t>0&&this._haveBits();){let e=this._value[this._currentBytePos],n=this._currentBitPos+1,i=Math.min(n,t),s=a$(e,n-i,i);r=(r<<i)+s,t-=i,this._currentBitPos-=i,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return r}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function a$(e,t,r){return(e&aq(t,r))>>>t}function aq(e,t){return aU[e]&aj[Math.min(t+e-1,7)]}let az=BigInt(nb.code),aV=8;async function aG(e){return(await nb.encode(e)).subarray(0,8).reverse()}let aK=async(e,t,r)=>{null==r.codec&&(r.codec=e7);let n=await rX.sha256.digest(e),i=tm.TO.create(r.cidVersion,r.codec.code,n);return await t.put(i,e,{...r,signal:r.signal}),i};class aW{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}}class aQ extends aW{_bucket;constructor(e,t){super(e,t),this._bucket=nD({hashFn:aG,bits:8})}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(e,t)}async get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async *eachChildSeries(){for await(let{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return void 0!==this.nodeSize||(this.nodeSize=aY(this._bucket,this,this.options)),this.nodeSize}async *flush(e){for await(let t of aJ(this._bucket,e,this,this.options))yield{...t,path:this.path}}}async function*aJ(e,t,r,n){let i=e._children,s=[],o=0n;for(let e=0;e<i.length;e++){let r=i.get(e);if(null==r)continue;let a=e.toString(16).toUpperCase().padStart(2,"0");if(r instanceof nv){let e;for await(let i of aJ(r,t,null,n))e=i;if(null==e)throw Error("Could not flush sharded directory, no sub-shard found");s.push({Name:a,Tsize:Number(e.size),Hash:e.cid}),o+=e.size}else if(aZ(r.value)){let e;for await(let n of r.value.flush(t))e=n,yield e;if(null==e)throw Error("Did not flush dir");let n=a+r.key;s.push({Name:n,Tsize:Number(e.size),Hash:e.cid}),o+=e.size}else{let e=r.value;if(null==e.cid)continue;let t=a+r.key,n=e.size;s.push({Name:t,Tsize:Number(n),Hash:e.cid}),o+=BigInt(n??0)}}let a=new rJ({type:"hamt-sharded-directory",data:Uint8Array.from(i.bitField().reverse()),fanout:BigInt(e.tableSize()),hashType:az,mtime:r?.mtime,mode:r?.mode}),l=tK(tj({Data:a.marshal(),Links:s})),c=await aK(l,t,n),u=BigInt(l.byteLength)+o;yield{cid:c,unixfs:a,size:u}}function aZ(e){return"function"==typeof e.flush}function aY(e,t,r){let n=e._children,i=[];for(let e=0;e<n.length;e++){let t=n.get(e);if(null==t)continue;let s=e.toString(16).toUpperCase().padStart(2,"0");if(t instanceof nv){let e=aY(t,null,r);i.push({Name:s,Tsize:Number(e),Hash:0===r.cidVersion?aX:a0})}else if("function"==typeof t.value.flush){let e=t.value.nodeSize();i.push({Name:s+t.key,Tsize:Number(e),Hash:0===r.cidVersion?aX:a0})}else{let e=t.value;if(null==e.cid)continue;let r=s+t.key,n=e.size;i.push({Name:r,Tsize:Number(n),Hash:e.cid})}}return tK(tj({Data:new rJ({type:"hamt-sharded-directory",data:Uint8Array.from(n.bitField().reverse()),fanout:BigInt(e.tableSize()),hashType:az,mtime:t?.mtime,mode:t?.mode}).marshal(),Links:i})).length}let aX=tm.TO.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),a0=tm.TO.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi"),a1=(0,aB.vF)("helia:unixfs:commands:utils:hamt-utils"),a2=e=>e.toString(16).toUpperCase().padStart(2,"0").substring(0,2),a3=async(e,t,r)=>{let n=new aQ({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:r.mtime,mode:r.mode},r);for(let e=0;e<t.length;e++)await n._bucket.put(t[e].name,{size:t[e].size,cid:t[e].cid});let i=await nY(n.flush(e));if(null==i)throw Error("Flushing shard yielded no result");return i},a4=async(e,t,r)=>{let n,i,s=rJ.unmarshal(e[0].node.Data??new Uint8Array(0)),o=BigInt(Math.pow(2,aV));e.reverse();for(let a=0;a<e.length;a++){let l=a===e.length-1,c=e[a],u=new rJ({type:"hamt-sharded-directory",data:Uint8Array.from(c.children.bitField().reverse()),fanout:o,hashType:az});l&&(u.mtime=s.mtime,u.mode=s.mode);let d=tK(tj(i={Data:u.marshal(),Links:c.node.Links}));if(n=await aK(d,t,r),!l){let t=e[a+1];if(null==t)throw Error("Was not operating on shard root but also had no parent?");a1("updating link in parent sub-shard with prefix %s",t.prefix),t.node.Links=t.node.Links.filter(e=>e.Name!==t.prefix),t.node.Links.push({Name:t.prefix,Hash:n,Tsize:c.node.Links.reduce((e,t)=>e+(t.Tsize??0),d.byteLength)})}}if(null==n||null==i)throw Error("Noting persisted");return{cid:n,node:i}},a5=async(e,t,r,n)=>{let i=aL(aG)((0,rx.s)(t)),s=[];for(;;){let o,a=tW(await r.get(e,n)),l=new nw,c=a2(await i.take(aV));for(let e of(s.push({prefix:c,children:l,node:a}),a.Links)){let t=e.Name??"";if(t.length<2)throw Error("Invalid HAMT - link name was too short");let r=parseInt(t.substring(0,2),16);l.set(r,!0),t.startsWith(c)&&(o=e)}if(null==o){a1("no link found with prefix %s for %s",c,t);break}let u=o.Name??"";if(u.length<2)throw Error("Invalid HAMT - link name was too short");if(2===u.length){e=o.Hash,a1("descend into sub-shard with prefix %s",u);continue}break}return{path:s,hash:i}};async function a6(e,t,r,n){let i;if(null==e.Data)throw Error("DagPB node had no data");let s=rJ.unmarshal(e.Data);if("directory"===s.type)i=a8(e);else if("hamt-sharded-directory"===s.type)i=await a7(e,0,r,t,n);else throw Error("Can only estimate the size of directories or shards");return i>r}function a8(e){let t=0;for(let r of e.Links)t+=(r.Name??"").length,t+=1===r.Hash.version?a0.bytes.byteLength:aX.bytes.byteLength;return t}async function a7(e,t,r,n,i){if(t>r)return r;if(null==e.Data||!rJ.unmarshal(e.Data).isDirectory())return t;for(let s of e.Links){let e=s.Name??"";if(t+=(e=e.substring(2)).length,t+=s.Hash.bytes.byteLength,s.Hash.code===tG){let e=tW(await n.get(s.Hash,i));t+=await a7(e,t,r,n,i)}}return t}let a9=(0,aB.vF)("helia:unixfs:components:utils:add-link");async function le(e,t,r,n){if(null==e.node.Data)throw new n7("Invalid parent passed to addLink");if("hamt-sharded-directory"===rJ.unmarshal(e.node.Data).type)return a9("adding link to sharded directory"),ln(e,t,r,n);a9(`adding ${t.Name} (${t.Hash}) to regular directory`);let i=await lr(e,t,r,n);if(await a6(i.node,r,n.shardSplitThresholdBytes,n)){a9("converting directory to sharded directory");let e=await lt(i,r);i.cid=e.cid,i.node=tW(await r.get(e.cid,n))}return i}let lt=async(e,t)=>{if(null==e.node.Data)throw new n7("Invalid parent passed to convertToShardedDirectory");let r=rJ.unmarshal(e.node.Data),n=await a3(t,e.node.Links.map(e=>({name:e.Name??"",size:BigInt(e.Tsize??0),cid:e.Hash})),{mode:r.mode,mtime:r.mtime,cidVersion:e.cid.version});return a9(`converted directory to sharded directory ${n.cid}`),n},lr=async(e,t,r,n)=>{let i,s=e.node.Links.filter(e=>{let r=e.Name===t.Name;if(r&&!n.allowOverwriting)throw new n3;return!r});if(s.push(t),null==e.node.Data)throw new n1("Parent node with no data passed to addToDirectory");let o=rJ.unmarshal(e.node.Data);if(null!=o.mtime){let e=Date.now(),t=Math.floor(e/1e3);o.mtime={secs:BigInt(t),nsecs:(e-1e3*t)*1e3},i=o.marshal()}else i=e.node.Data;e.node=tj({Data:i,Links:s});let a=tK(e.node),l=await rX.sha256.digest(a),c=tm.TO.create(e.cid.version,tG,l);return await r.put(c,a),{node:e.node,cid:c}},ln=async(e,t,r,n)=>{let{path:i,hash:s}=await a5(e.cid,t.Name,r,n),o=i[i.length-1];if(null==o)throw Error("Invalid HAMT, could not generate path");let a=o.prefix,l=parseInt(a,16);a9("next prefix for %s is %s",t.Name,a);let c=`${a}${t.Name}`,u=o.node.Links.find(e=>(e.Name??"").startsWith(a));if(null!=u)if(a9("link %s was present in shard",c),u.Name===c){if(!n.allowOverwriting)throw new n3;a9("overwriting %s in sub-shard",t.Name),o.node.Links=o.node.Links.filter(e=>e.Name!==c),o.node.Links.push({Name:c,Hash:t.Hash,Tsize:t.Tsize})}else if(u.Name?.length===2)throw Error("Existing link was sub-shard?!");else{a9("prefix %s already exists, creating new sub-shard",a);let e=o.node.Links.findIndex(e=>e.Name?.startsWith(a)),r=o.node.Links.splice(e,1)[0],n=(r.Name??"").substring(2),l=aL(aG)((0,rx.s)(n));for(let e=0;e<i.length;e++)await l.take(aV);for(;;){let e=await l.take(aV),o=a2(e);r.Name=`${o}${n}`;let c=await s.take(aV),u=a2(c);if(o===u){let e=new nw;e.set(c,!0),i.push({prefix:u,children:e,node:{Links:[]}});continue}let d=new nw;d.set(c,!0),d.set(e,!0),i.push({prefix:a,children:d,node:{Links:[r,{Name:`${u}${t.Name}`,Hash:t.Hash,Tsize:t.Tsize}]}});break}}else a9("link %s was not present in sub-shard",c),t.Name=c,o.node.Links.push(t),o.children.set(l,!0),a9("adding %s to existing sub-shard",c);return a4(i,r,n)};async function li(e,t,r={}){let n=await aD(e,t,r);if("directory"!==n.type)throw new n8(`${e.toString()} was not a UnixFS directory`);return{cid:e,node:n.node}}async function ls(e,t,r,n){let i=await aD(e,r,n);if("directory"!==i.type&&"file"!==i.type&&"raw"!==i.type)throw new n0(`${e.toString()} was not a UnixFS node`);return{Name:t,Tsize:i.node instanceof Uint8Array?i.node.byteLength:lo(i.node),Hash:e}}function lo(e){let t=e.Links.reduce((e,t)=>e+(t.Tsize??0),0);return tK(e).byteLength+t}let la=(0,aB.vF)("helia:unixfs:components:utils:resolve");async function ll(e,t,r,n){if(null==t||""===t)return{cid:e};let i=`/ipfs/${e}${null==t?"":`/${t}`}`,s=await (0,aO.A)(aR(i,r,n));if(0===s.length)throw new n4("Could not find path in directory");return la("resolved %s to %c",t,e),{cid:s[s.length-1].cid,path:t,segments:s}}async function lc(e,t,r,n){if(null==t.segments||0===t.segments.length)return e;let i=t.segments.pop();if(null==i)throw Error("Insufficient segments");for(let s of(i.cid=e,t.segments.reverse(),t.segments)){let[t,o]=await Promise.all([li(s.cid,r,n),ls(i.cid,i.name,r,n)]);s.cid=e=(await le(t,o,r,{...n,allowOverwriting:!0,cidVersion:e.version})).cid,i=s}return e}let lu=aM.bind({ignoreUndefined:!0}),ld={};async function*lh(e,t,r={}){let n=lu(ld,r),i=await ll(e,n.path,t,n),s=await aD(i.cid,t,n);if("file"!==s.type&&"raw"!==s.type)throw new n6;if(null==s.content)throw new n5;yield*s.content(n)}let lf=262144,lp=aM.bind({ignoreUndefined:!0}),lg=(0,aB.vF)("helia:unixfs:chmod"),lm={recursive:!1,shardSplitThresholdBytes:lf};async function ly(e,t,r,n={}){let i,s=lp(lm,n),o=await ll(e,s.path,r,n);if(lg("chmod %c %d",o.cid,t),s.recursive){let i=await (0,ac.F)(async function*(){for await(let e of aN(o.cid,r,n)){let r,n=[];if("raw"===e.type)r=new rJ({type:"file",data:e.node});else if("file"===e.type||"directory"===e.type)r=e.unixfs,n=e.node.Links;else throw new n0;r.mode=t;let i={Data:r.marshal(),Links:n};yield{path:e.path,content:i}}},t=>nK(t,r,{...s,dagBuilder:async function*(t,r){for await(let n of t)yield async function(){let t=n.content,i=tK(t),o=await aK(i,r,{...s,cidVersion:e.version});if(null==t.Data)throw new n1(`${o} had no data`);let a=rJ.unmarshal(t.Data);return{cid:o,size:BigInt(i.length),path:n.path,unixfs:a}}}}),async e=>nY(e));if(null==i)throw new n2(`Could not chmod ${o.cid.toString()}`);return lc(i.cid,o,r,s)}let a=await r.get(o.cid,n),l=[];if(o.cid.code===rZ.code)i=new rJ({type:"file",data:a});else{let e=tW(a);if(null==e.Data)throw new n1(`${o.cid.toString()} had no data`);l=e.Links,i=rJ.unmarshal(e.Data)}i.mode=t;let c=tK({Data:i.marshal(),Links:l}),u=await rX.sha256.digest(c),d=tm.TO.create(o.cid.version,tG,u);return await r.put(d,c),lc(d,o,r,s)}let lb=aM.bind({ignoreUndefined:!0}),lw=(0,aB.vF)("helia:unixfs:cp"),lv={force:!1,shardSplitThresholdBytes:lf};async function lE(e,t,r,n,i={}){let s=lb(lv,i);if(r.includes("/"))throw new n7("Name must not have slashes");let[o,a]=await Promise.all([li(t,n,s),ls(e,r,n,s)]);return lw('Adding %c as "%s" to %c',e,r,t),(await le(o,a,n,{allowOverwriting:s.force,cidVersion:t.version,...s})).cid}let lA=aM.bind({ignoreUndefined:!0}),lx={};async function*lS(e,t,r={}){let n=lA(lx,r),i=await ll(e,n.path,t,n),s=await aD(i.cid,t);if("file"===s.type||"raw"===s.type)return void(yield s);if(null==s.content)throw new n5;if("directory"!==s.type)throw new n8;yield*s.content({offset:r.offset,length:r.length})}let lk=aM.bind({ignoreUndefined:!0}),l_=(0,aB.vF)("helia:unixfs:mkdir"),lI={cidVersion:1,force:!1,shardSplitThresholdBytes:lf};async function lT(e,t,r,n={}){let i=lk(lI,n);if(t.includes("/"))throw new n7("Path must not have slashes");if("directory"!==(await aD(e,r,n)).type)throw new n8(`${e.toString()} was not a UnixFS directory`);l_("creating %s",t);let s=tK({Data:new rJ({type:"directory",mode:i.mode,mtime:i.mtime}).marshal(),Links:[]}),o=await rX.sha256.digest(s),a=tm.TO.create(i.cidVersion,tG,o);await r.put(a,s);let[l,c]=await Promise.all([li(e,r,i),ls(a,t,r,i)]);return l_("adding empty dir called %s to %c",t,e),(await le(l,c,r,{...i,allowOverwriting:i.force})).cid}let lC=(0,aB.vF)("helia:unixfs:utils:remove-link");async function lP(e,t,r,n){if(null==e.node.Data)throw new n1("Parent node had no data");if("hamt-sharded-directory"===rJ.unmarshal(e.node.Data).type){lC(`removing ${t} from sharded directory`);let i=await lD(e,t,r,n);return await a6(i.node,r,n.shardSplitThresholdBytes,n)?i:(lC("converting shard to flat directory %c",e.cid),lN(i,r,n))}return lC(`removing link ${t} regular directory`),lR(e,t,r,n)}let lR=async(e,t,r,n)=>{e.node.Links=e.node.Links.filter(e=>e.Name!==t);let i=tK(e.node),s=await aK(i,r,{...n,cidVersion:e.cid.version});return lC(`Updated regular directory ${s}`),{node:e.node,cid:s}},lD=async(e,t,r,n)=>{let{path:i}=await a5(e.cid,t,r,n),s=i[i.length-1];if(null==s)throw Error("Invalid HAMT, could not generate path");let o=s.node.Links.filter(e=>(e.Name??"").substring(2)===t).map(e=>e.Name).pop();if(null==o)throw Error("File not found");let a=parseInt(o.substring(0,2),16);if(s.node.Links=s.node.Links.filter(e=>e.Name!==o),s.children.unset(a),1===s.node.Links.length)for(;1!==i.length;){let e=i[i.length-1];if(null==e||e.node.Links.length>1)break;i.pop();let t=i[i.length-1];if(null==t)break;let r=e.node.Links[0];t.node.Links=t.node.Links.filter(e=>!(e.Name??"").startsWith(t.prefix)),t.node.Links.push({Hash:r.Hash,Name:`${t.prefix}${(r.Name??"").substring(2)}`,Tsize:r.Tsize})}return a4(i,r,n)},lN=async(e,t,r)=>{if(null==e.node.Data)throw new n7("Invalid parent passed to convertToFlatDirectory");let n={Links:[]},i=await aD(e.cid,t);if("directory"!==i.type)throw Error("Unexpected node type");for await(let e of i.content()){let t=0;t=e.node instanceof Uint8Array?e.node.byteLength:tK(e.node).length,n.Links.push({Hash:e.cid,Name:e.name,Tsize:t})}let s=rJ.unmarshal(e.node.Data);n.Data=new rJ({type:"directory",mode:s.mode,mtime:s.mtime}).marshal();let o=tK(tj(n));return{cid:await aK(o,t,{codec:e7,cidVersion:e.cid.version,signal:r.signal}),node:n}},lM=aM.bind({ignoreUndefined:!0}),lB=(0,aB.vF)("helia:unixfs:rm"),lO={shardSplitThresholdBytes:lf};async function lL(e,t,r,n={}){let i=lM(lO,n);if(t.includes("/"))throw new n7("Name must not have slashes");let s=await li(e,r,i);return lB("Removing %s from %c",t,e),(await lP(s,t,r,{...i,cidVersion:e.version})).cid}let lF=64;class lU{fp;h;seed;constructor(e,t,r,n=2){if(n>lF)throw TypeError("Invalid Fingerprint Size");let i=t.hashV(e,r),s=(0,to.c)(n);for(let e=0;e<s.length;e++)s[e]=i[e];0===s.length&&(s[0]=7),this.fp=s,this.h=t,this.seed=r}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return e?.fp instanceof Uint8Array&&tc(this.fp,e.fp)}}function lj(e,t){return Math.floor(Math.random()*(t-e))+e}class lH{contents;constructor(e){this.contents=Array(e).fill(null)}has(e){if(!(e instanceof lU))throw TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof lU))throw TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(null==this.contents[t]){this.contents[t]=e;break}return!0}swap(e){if(!(e instanceof lU))throw TypeError("Invalid Fingerprint");let t=lj(0,this.contents.length-1),r=this.contents[t];return this.contents[t]=e,r}remove(e){if(!(e instanceof lU))throw TypeError("Invalid Fingerprint");let t=this.contents.findIndex(t=>e.equals(t));return t>-1&&(this.contents[t]=null,!0)}}let l$={32:16777619n,64:1099511628211n,128:0x1000000000000000000013bn,256:0x1000000000000000000000000000000000000000163n,512:0x100000000000000000000000000000000000000000000000000000000000000000000000000000000000157n,1024:0x10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000018dn},lq={32:2166136261n,64:0xcbf29ce484222325n,128:0x6c62272e07bb014262b821756295c58dn,256:0xdd268dbcaac550362d98c384c4e576ccc8b1536847b6bbb31023b4c8caee0535n,512:0xb86db0b1171f4416dca1e50f309990acac87d059c90000000000000000000d21e948f68a34c192f62ea79bc942dbe7ce182036415f56e34bac982aac4afe9fd9n,1024:0x5f7a76758ecc4d32e56d5a591028b74b29fc4223fdada16c3bf34eda3674da9a21d9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004c6d7eb6e73802734510a555f256cc005ae556bde8cc9c6a93b21aff4b16c71ee90b3n},lz=new globalThis.TextEncoder;function lV(e,t){let r=l$[t],n=lq[t];for(let i=0;i<e.length;i++)n^=BigInt(e[i]),n=BigInt.asUintN(t,n*r);return n}function lG(e,t,r){if(0===r.length)throw Error("The `utf8Buffer` option must have a length greater than zero");let n=l$[t],i=lq[t],s=e;for(;s.length>0;){let e=lz.encodeInto(s,r);s=s.slice(e.read);for(let s=0;s<e.written;s++)i^=BigInt(r[s]),i=BigInt.asUintN(t,i*n)}return i}function lK(e,{size:t=32,utf8Buffer:r}={}){if(!l$[t])throw Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if("string"==typeof e){if(r)return lG(e,t,r);e=lz.encode(e)}return lV(e,t)}let lW={hash:e=>Number(lK(e,{size:32})),hashV:(e,t)=>lQ(lW.hash(e,t))};function lQ(e){let t=e.toString(16);return t.length%2==1&&(t=`0${t}`),(0,rx.s)(t,"base16")}let lJ=500;class lZ{bucketSize;filterSize;fingerprintSize;buckets;count;hash;seed;constructor(e){this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??lW,this.seed=e.seed??lj(0,1024)}add(e){"string"==typeof e&&(e=(0,rx.s)(e));let t=new lU(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,n=(r^t.hash())%this.filterSize;if(null==this.buckets[r]&&(this.buckets[r]=new lH(this.bucketSize)),null==this.buckets[n]&&(this.buckets[n]=new lH(this.bucketSize)),this.buckets[r].add(t)||this.buckets[n].add(t))return this.count++,!0;let i=[r,n],s=i[lj(0,i.length-1)];null==this.buckets[s]&&(this.buckets[s]=new lH(this.bucketSize));for(let e=0;e<lJ;e++){let e=this.buckets[s].swap(t);if(null!=e){if(s=(s^e.hash())%this.filterSize,null==this.buckets[s]&&(this.buckets[s]=new lH(this.bucketSize)),this.buckets[s].add(e))return this.count++,!0;continue}}return!1}has(e){"string"==typeof e&&(e=(0,rx.s)(e));let t=new lU(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,n=this.buckets[r]?.has(t)??!1;if(n)return n;let i=(r^t.hash())%this.filterSize;return this.buckets[i]?.has(t)??!1}remove(e){"string"==typeof e&&(e=(0,rx.s)(e));let t=new lU(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,n=this.buckets[r]?.remove(t)??!1;if(n)return this.count--,n;let i=(r^t.hash())%this.filterSize,s=this.buckets[i]?.remove(t)??!1;return s&&this.count--,s}get reliable(){return 90>=Math.floor(100*(this.count/this.filterSize))}}let lY={1:.5,2:.84,4:.95,8:.98};function lX(e=.001){return e>.002?2:e>1e-5?4:8}function l0(e,t=.001){let r=lX(t),n=Math.round(e/lY[r]),i=Math.min(Math.ceil(Math.log2(1/t)+Math.log2(2*r)),lF);return{filterSize:n,bucketSize:r,fingerprintSize:i}}class l1{filterSize;bucketSize;fingerprintSize;scale;filterSeries;hash;seed;constructor(e){this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??262144/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??lW,this.seed=e.seed??lj(0,1024),this.filterSeries=[new lZ({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if("string"==typeof e&&(e=(0,rx.s)(e)),this.has(e))return!0;let t=this.filterSeries.find(e=>e.reliable);return null==t&&(t=new lZ({filterSize:this.filterSize*Math.pow(this.scale,this.filterSeries.length),bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)),t.add(e)}has(e){"string"==typeof e&&(e=(0,rx.s)(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){"string"==typeof e&&(e=(0,rx.s)(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}}function l2(e,t=.001,r){return new l1({...l0(e,t),...r??{}})}let l3=1877,l4=1604,l5=aM.bind({ignoreUndefined:!0}),l6=(0,aB.vF)("helia:unixfs:stat"),l8={};async function l7(e,t,r={}){let n=l5(l8,r),i=await ll(e,r.path,t,n);l6("stat %c",i.cid);let s=await aD(i.cid,t,n);if("raw"===s.type)return!0===r.extended?cr(s):ct(s);if("file"===s.type||"directory"===s.type)return!0===r.extended?ce(s,t,r.filter??new l1({filterSize:1024}),r):l9(s);throw new n0}function l9(e){return{type:e.type,cid:e.cid,unixfs:e.unixfs,mode:e.unixfs.mode??(e.unixfs.isDirectory()?l3:l4),mtime:e.unixfs.mtime,size:e.unixfs.fileSize()}}async function ce(e,t,r,n){let i=await cn(e.cid,t,!1,r,n);return{type:e.type,cid:e.cid,unixfs:e.unixfs,size:e.unixfs.isDirectory()?i.dirSize:e.unixfs.fileSize(),mode:e.unixfs.mode??(e.unixfs.isDirectory()?l3:l4),mtime:e.unixfs.mtime,localSize:i.localSize,dagSize:i.dagSize,deduplicatedDagSize:i.deduplicatedDagSize,blocks:i.blocks,uniqueBlocks:i.uniqueBlocks}}function ct(e){return{type:e.type,cid:e.cid,unixfs:void 0,mode:l4,mtime:void 0,size:BigInt(e.node.byteLength)}}function cr(e){return{type:e.type,cid:e.cid,unixfs:void 0,mode:l4,mtime:void 0,size:BigInt(e.node.byteLength),localSize:BigInt(e.node.byteLength),dagSize:BigInt(e.node.byteLength),deduplicatedDagSize:BigInt(e.node.byteLength),blocks:1n,uniqueBlocks:1n}}async function cn(e,t,r,n,i){let s={dirSize:0n,localSize:0n,dagSize:0n,deduplicatedDagSize:0n,blocks:0n,uniqueBlocks:0n};try{let o=n.has(e.bytes);n.add(e.bytes);let a=await t.get(e,i);if(s.blocks++,s.dagSize+=BigInt(a.byteLength),o||(s.uniqueBlocks++,s.deduplicatedDagSize+=BigInt(a.byteLength)),e.code===rZ.code)s.localSize+=BigInt(a.byteLength),r&&(s.dirSize+=BigInt(a.byteLength));else if(e.code===tG){let o,l=tW(a);if(null!=l.Data&&(o=rJ.unmarshal(l.Data)),l.Links.length>0){for(let e of l.Links){let r=await cn(e.Hash,t,ci(e,o),n,i);s.localSize+=r.localSize,s.dagSize+=r.dagSize,s.deduplicatedDagSize+=r.deduplicatedDagSize,s.blocks+=r.blocks,s.uniqueBlocks+=r.uniqueBlocks,s.dirSize+=r.dirSize}r&&null!=o&&(s.dirSize+=o.fileSize())}else{if(null==o)throw new n1(`PBNode ${e.toString()} had no data`);null!=o.data&&(s.localSize+=BigInt(o.data.byteLength??0)),r&&(s.dirSize+=o.fileSize())}}else throw new n2(`${e.toString()} was neither DAG_PB nor RAW`)}catch(e){if("NotFoundError"!==e.name||!0!==i.offline)throw e}return s}function ci(e,t){if(null==t)return!1;let r=e.Name;return null!=r&&("directory"===t.type||"hamt-sharded-directory"===t.type&&!!(r.length>2))}let cs=aM.bind({ignoreUndefined:!0}),co=(0,aB.vF)("helia:unixfs:touch"),ca={recursive:!1,shardSplitThresholdBytes:lf};async function cl(e,t,r={}){let n,i=cs(ca,r),s=await ll(e,i.path,t,i),o=i.mtime??{secs:BigInt(Math.round(Date.now()/1e3)),nsecs:0};if(co("touch %c %o",s.cid,o),i.recursive){let r=await (0,ac.F)(async function*(){for await(let e of aN(s.cid,t)){let t,r;if("raw"===e.type)t=new rJ({data:e.node}),r=[];else if("file"===e.type||"directory"===e.type)t=e.unixfs,r=e.node.Links;else throw new n0;t.mtime=o;let n={Data:t.marshal(),Links:r};yield{path:e.path,content:n}}},r=>nK(r,t,{...i,dagBuilder:async function*(t,r){for await(let n of t)yield async function(){let t=n.content,s=tK(t),o=await aK(s,r,{...i,cidVersion:e.version});if(null==t.Data)throw new n1(`${o} had no data`);let a=rJ.unmarshal(t.Data);return{cid:o,size:BigInt(s.length),path:n.path,unixfs:a}}}}),async e=>nY(e));if(null==r)throw new n2(`Could not chmod ${s.cid.toString()}`);return lc(r.cid,s,t,i)}let a=await t.get(s.cid,r),l=[];if(s.cid.code===rZ.code)n=new rJ({data:a});else{let e=tW(a);if(l=e.Links,null==e.Data)throw new n1(`${s.cid.toString()} had no data`);n=rJ.unmarshal(e.Data)}n.mtime=o;let c=tK({Data:n.marshal(),Links:l}),u=await rX.sha256.digest(c),d=tm.TO.create(s.cid.version,tG,u);return await t.put(d,c),lc(d,s,t,i)}class cc{components;constructor(e){this.components=e}async *addAll(e,t={}){yield*ie(e,this.components.blockstore,t)}async addBytes(e,t={}){return it(e,this.components.blockstore,t)}async addByteStream(e,t={}){return ir(e,this.components.blockstore,t)}async addFile(e,t={}){return ii(e,this.components.blockstore,t)}async addDirectory(e={},t={}){return is(e,this.components.blockstore,t)}async *cat(e,t={}){yield*lh(e,this.components.blockstore,t)}async chmod(e,t,r={}){return ly(e,t,this.components.blockstore,r)}async cp(e,t,r,n={}){return lE(e,t,r,this.components.blockstore,n)}async *ls(e,t={}){yield*lS(e,this.components.blockstore,t)}async mkdir(e,t,r={}){return lT(e,t,this.components.blockstore,r)}async rm(e,t,r={}){return lL(e,t,this.components.blockstore,r)}async stat(e,t={}){return l7(e,this.components.blockstore,t)}async touch(e,t={}){return cl(e,this.components.blockstore,t)}}function cu(e){return new cc(e)}class cd{dbName;ipfs;providerCID;fs;protocol;constructor(e,t){this.dbName=e,this.ipfs=t,this.protocol=`/astradb/${this.dbName}`}async init(e){this.providerCID=await this.constructProviderCID(this.dbName),await this.ipfs.libp2p.handle(this.protocol,({stream:e})=>{console.log(`Received connection from /astradb/${this.dbName} peer`)}),this.startService(async()=>{await this.connectToProviders()}),e&&this.startService(async()=>{await this.provideDB(this.providerCID)}),this.setupEvents()}async constructProviderCID(e){this.fs=cu(this.ipfs);let t=new TextEncoder,r=await this.fs.addBytes(t.encode(e));if(!await this.ipfs.pins.isPinned(r))for await(let e of this.ipfs.pins.add(r))console.log(`Pinned CID: ${e}`);return console.log(`Provider CID created: ${r}`),r}async provideDB(e){let t=!1;for(console.log("Providing CID address...");!t;)try{let r=performance.now();await this.ipfs.routing.provide(e);let n=performance.now();t=!0,console.log(`CID ${e} provided, took ${(n-r)/1e3} seconds`)}catch(e){console.error("Error providing CID:",e),console.log("Retrying provide...")}}async connectToProviders(){try{for await(let e of this.ipfs.libp2p.contentRouting.findProviders(this.providerCID))try{if(e.id.equals(this.ipfs.libp2p.peerId)||this.ipfs.libp2p.getConnections(e.id).length>0)continue;console.log(`New provider found, connecting: ${e.id}`),this.ipfs.libp2p.dial(e.id).then(t=>{console.log(`Connected to provider ${e.id}`),this.manageNewConnection(e.id)},t=>{console.error(`Error connecting to provider ${e.id}: ${t}`)})}catch(t){console.error(`Error connecting to provider ${e.id}: ${t}`)}}catch(e){console.error("Error finding providers:",e)}}setupEvents(){this.ipfs.libp2p.addEventListener("peer:connect",e=>{let t=e.detail;this.manageNewConnection(t)})}async manageNewConnection(e){let t,r=!1,n=0;for(;!r;){if(!await this.ipfs.libp2p.peerStore.has(e)){if(n>10)return void console.log("Warning: New connection peer info not found, skipping peer. Triggered by: ",e);n++,await new Promise(e=>setTimeout(e,100));continue}t=await this.ipfs.libp2p.peerStore.get(e),r=!0}t.protocols.includes(this.protocol)&&(console.log(`Provider is an /astradb/${this.dbName} peer: ${e}`),await this.ipfs.libp2p.peerStore.merge(e,{tags:{"astradb-peer":{value:100}}}))}async startService(e){for(;;){try{await e()}catch(e){console.error("Error in service function:",e)}await new Promise(e=>setTimeout(e,6e4))}}}function ch(e){let t=new globalThis.AbortController;function r(){for(let n of(t.abort(),e))n?.removeEventListener!=null&&n.removeEventListener("abort",r)}for(let t of e){if(t?.aborted===!0){r();break}t?.addEventListener!=null&&t.addEventListener("abort",r)}function n(){for(let t of e)t?.removeEventListener!=null&&t.removeEventListener("abort",r)}let i=t.signal;return i.clear=n,i}class cf extends EventTarget{#C=new Map;constructor(){super()}listenerCount(e){let t=this.#C.get(e);return null==t?0:t.length}addEventListener(e,t,r){super.addEventListener(e,t,r);let n=this.#C.get(e);null==n&&(n=[],this.#C.set(e,n)),n.push({callback:t,once:(!0!==r&&!1!==r&&r?.once)??!1})}removeEventListener(e,t,r){super.removeEventListener(e.toString(),t??null,r);let n=this.#C.get(e);null!=n&&(n=n.filter(({callback:e})=>e!==t),this.#C.set(e,n))}dispatchEvent(e){let t=super.dispatchEvent(e),r=this.#C.get(e.type);return null==r||(r=r.filter(({once:e})=>!e),this.#C.set(e.type,r)),t}safeDispatchEvent(e,t={}){return this.dispatchEvent(new CustomEvent(e,t))}}class cp extends Error{static name="AbortError";constructor(e="The operation was aborted"){super(e),this.name="AbortError"}}class cg extends Error{static name="UnexpectedPeerError";constructor(e="Unexpected Peer"){super(e),this.name="UnexpectedPeerError"}}class cm extends Error{static name="InvalidCryptoExchangeError";constructor(e="Invalid crypto exchange"){super(e),this.name="InvalidCryptoExchangeError"}}class cy extends Error{static name="InvalidParametersError";constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}}class cb extends Error{static name="InvalidPublicKeyError";constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}}class cw extends Error{static name="InvalidPrivateKeyError";constructor(e="Invalid private key"){super(e),this.name="InvalidPrivateKeyError"}}class cv extends Error{static name="ConnectionClosingError";constructor(e="The connection is closing"){super(e),this.name="ConnectionClosingError"}}class cE extends Error{static name="ConnectionClosedError";constructor(e="The connection is closed"){super(e),this.name="ConnectionClosedError"}}class cA extends Error{static name="ConnectionFailedError";constructor(e="Connection failed"){super(e),this.name="ConnectionFailedError"}}class cx extends Error{static name="MuxerClosedError";constructor(e="The muxer is closed"){super(e),this.name="MuxerClosedError"}}class cS extends Error{static name="StreamResetError";constructor(e="The stream has been reset"){super(e),this.name="StreamResetError"}}class ck extends Error{static name="StreamStateError";constructor(e="The stream is in an invalid state"){super(e),this.name="StreamStateError"}}class c_ extends Error{static name="NotFoundError";constructor(e="Not found"){super(e),this.name="NotFoundError"}}class cI extends Error{static name="InvalidPeerIdError";constructor(e="Invalid PeerID"){super(e),this.name="InvalidPeerIdError"}}class cT extends Error{static name="InvalidMultiaddrError";constructor(e="Invalid multiaddr"){super(e),this.name="InvalidMultiaddrError"}}class cC extends Error{static name="InvalidCIDError";constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}}class cP extends Error{static name="InvalidMultihashError";constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}}class cR extends Error{static name="UnsupportedProtocolError";constructor(e="Unsupported protocol error"){super(e),this.name="UnsupportedProtocolError"}}class cD extends Error{static name="InvalidMessageError";constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}}class cN extends Error{static name="ProtocolError";constructor(e="Protocol error"){super(e),this.name="ProtocolError"}}class cM extends Error{static name="TimeoutError";constructor(e="Timed out"){super(e),this.name="TimeoutError"}}class cB extends Error{static name="NotStartedError";constructor(e="Not started"){super(e),this.name="NotStartedError"}}class cO extends Error{static name="DialError";constructor(e="Dial error"){super(e),this.name="DialError"}}class cL extends Error{static name="ListenError";constructor(e="Listen error"){super(e),this.name="ListenError"}}class cF extends Error{static name="LimitedConnectionError";constructor(e="Limited connection"){super(e),this.name="LimitedConnectionError"}}class cU extends Error{static name="TooManyInboundProtocolStreamsError";constructor(e="Too many inbound protocol streams"){super(e),this.name="TooManyInboundProtocolStreamsError"}}class cj extends Error{static name="TooManyOutboundProtocolStreamsError";constructor(e="Too many outbound protocol streams"){super(e),this.name="TooManyOutboundProtocolStreamsError"}}class cH extends Error{static name="UnsupportedKeyTypeError";constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}}class c$ extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.name="AbortError",this.code=t??"ABORT_ERR"}}async function cq(e,t,r,n){let i=new c$(n?.errorMessage,n?.errorCode);return r?.aborted===!0?Promise.reject(i):new Promise((s,o)=>{function a(){r?.removeEventListener("abort",u),e.removeEventListener(t,l),n?.errorEvent!=null&&e.removeEventListener(n.errorEvent,c)}let l=e=>{try{if(n?.filter?.(e)===!1)return}catch(e){a(),o(e);return}a(),s(e)},c=e=>{a(),o(e.detail)},u=()=>{a(),o(i)};r?.addEventListener("abort",u),e.addEventListener(t,l),n?.errorEvent!=null&&e.addEventListener(n.errorEvent,c)})}class cz extends Error{remainingPoints;msBeforeNext;consumedPoints;isFirstInDuration;constructor(e="Rate limit exceeded",t){super(e),this.name="RateLimitError",this.remainingPoints=t.remainingPoints,this.msBeforeNext=t.msBeforeNext,this.consumedPoints=t.consumedPoints,this.isFirstInDuration=t.isFirstInDuration}}class cV extends Error{static name="QueueFullError";constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}var cG=r(10258);class cK{deferred;signal;constructor(e){this.signal=e,this.deferred=(0,ao.A)(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new cp)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}}function cW(){return`${parseInt(String(1e9*Math.random()),10).toString()}${Date.now()}`}class cQ{id;fn;options;recipients;status;timeline;controller;constructor(e,t){this.id=cW(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((e,t)=>e&&t.signal?.aborted===!0,!0)&&(this.controller.abort(new cp),this.cleanup())}async join(e={}){let t=new cK(e.signal);return this.recipients.push(t),e.signal?.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();let e=await (0,cG.W)(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{e.cleanup(),e.signal?.removeEventListener("abort",this.onAbort)})}}class cJ extends cf{concurrency;maxSize;queue;pending;sort;constructor(e={}){super(),this.concurrency=e.concurrency??Number.POSITIVE_INFINITY,this.maxSize=e.maxSize??Number.POSITIVE_INFINITY,this.pending=0,null!=e.metricName&&e.metrics?.registerMetricGroup(e.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})}),this.sort=e.sort,this.queue=[]}tryToStartAnother(){if(0===this.size)return queueMicrotask(()=>{this.safeDispatchEvent("empty")}),0===this.running&&queueMicrotask(()=>{this.safeDispatchEvent("idle")}),!1;if(this.pending<this.concurrency){let e;for(let t of this.queue)if("queued"===t.status){e=t;break}return null!=e&&(this.safeDispatchEvent("active"),this.pending++,e.run().finally(()=>{for(let t=0;t<this.queue.length;t++)if(this.queue[t]===e){this.queue.splice(t,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(e){this.queue.push(e),null!=this.sort&&this.queue.sort(this.sort)}async add(e,t){if(t?.signal?.throwIfAborted(),this.size===this.maxSize)throw new cV;let r=new cQ(e,t);return this.enqueue(r),this.safeDispatchEvent("add"),this.tryToStartAnother(),r.join(t).then(e=>(this.safeDispatchEvent("completed",{detail:e}),this.safeDispatchEvent("success",{detail:{job:r,result:e}}),e)).catch(e=>{if("queued"===r.status){for(let e=0;e<this.queue.length;e++)if(this.queue[e]===r){this.queue.splice(e,1);break}}throw this.safeDispatchEvent("error",{detail:e}),this.safeDispatchEvent("failure",{detail:{job:r,error:e}}),e})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(e=>{e.abort(new cp)}),this.clear()}async onEmpty(e){0!==this.size&&await cq(this,"empty",e?.signal)}async onSizeLessThan(e,t){this.size<e||await cq(this,"next",t?.signal,{filter:()=>this.size<e})}async onIdle(e){(0!==this.pending||0!==this.size)&&await cq(this,"idle",e?.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async *toGenerator(e){e?.signal?.throwIfAborted();let t=(0,ad.Ny)({objectMode:!0}),r=e=>{null!=e?this.abort():this.clear(),t.end(e)},n=e=>{null!=e.detail&&t.push(e.detail)},i=e=>{r(e.detail)},s=()=>{r()},o=()=>{r(new cp("Queue aborted"))};this.addEventListener("completed",n),this.addEventListener("error",i),this.addEventListener("idle",s),e?.signal?.addEventListener("abort",o);try{yield*t}finally{this.removeEventListener("completed",n),this.removeEventListener("error",i),this.removeEventListener("idle",s),e?.signal?.removeEventListener("abort",o),r()}}}class cZ extends cJ{has(e){return null!=this.find(e)}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}}var cY=r(24802);let cX=8,c0=4194304;class c1 extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class c2 extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class c3 extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}class c4 extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}function c5(e){return null!=e[Symbol.asyncIterator]}function c6(e,t){if(e.byteLength>t)throw new c2("Message length too long")}let c8=e=>{let t=t5(e),r=(0,to.K)(t);return re(e,r),c8.bytes=t,r};function c7(e,t){let r=(t=t??{}).lengthEncoder??c8,n=t?.maxDataLength??c0;function*i(e){c6(e,n);let t=r(e.byteLength);t instanceof Uint8Array?yield t:yield*t,e instanceof Uint8Array?yield e:yield*e}return c5(e)?async function*(){for await(let t of e)yield*i(t)}():function*(){for(let t of e)yield*i(t)}()}c8.bytes=0,c7.single=(e,t)=>{let r=(t=t??{}).lengthEncoder??c8;return c6(e,t?.maxDataLength??c0),new tf(r(e.byteLength),e)},function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(l||(l={}));let c9=e=>{let t=rt(e);return c9.bytes=t5(t),t};function ue(e,t){let r=new tf,n=l.LENGTH,i=-1,s=t?.lengthDecoder??c9,o=t?.maxLengthLength??cX,a=t?.maxDataLength??c0;function*c(){for(;r.byteLength>0;){if(n===l.LENGTH)try{if((i=s(r))<0)throw new c1("Invalid message length");if(i>a)throw new c2("Message length too long");let e=s.bytes;r.consume(e),t?.onLength!=null&&t.onLength(i),n=l.DATA}catch(e){if(e instanceof RangeError){if(r.byteLength>o)throw new c3("Message length length too long");break}throw e}if(n===l.DATA){if(r.byteLength<i)break;let e=r.sublist(0,i);r.consume(i),t?.onData!=null&&t.onData(e),yield e,n=l.LENGTH}}}return c5(e)?async function*(){for await(let t of e)r.append(t),yield*c();if(r.byteLength>0)throw new c4("Unexpected end of input")}():function*(){for(let t of e)r.append(t),yield*c();if(r.byteLength>0)throw new c4("Unexpected end of input")}()}c9.bytes=0,ue.fromReader=(e,t)=>{let r=1,n=async function*(){for(;;)try{let{done:t,value:n}=await e.next(r);if(!0===t)return;null!=n&&(yield n)}catch(e){if("ERR_UNDER_READ"===e.code)return{done:!0,value:null};throw e}finally{r=1}}(),i=e=>{r=e};return ue(n,{...t??{},onLength:i})};var ut=r(91295);let ur="/ipfs/bitswap/1.2.0",un=1024,ui=1024,us=1024,uo=5e3,ua=10,ul=50,uc=!1,uu=3,ud=4194304,uh=4194304;function uf(e,t){for(let[r,n]of t.wantlist.entries()){let t=e.wantlist.get(r);null!=t&&(t.priority>n.priority&&(n.priority=t.priority),n.cancel=n.cancel??t.cancel,n.wantType=n.wantType??t.wantType,n.sendDontHave=n.sendDontHave??t.sendDontHave),e.wantlist.set(r,n)}for(let[r,n]of t.blockPresences.entries())e.blockPresences.set(r,n);for(let[r,n]of t.blocks.entries())e.blocks.set(r,n);return t.full&&!e.full&&(e.full=!0),e}!function(e){e.WantBlock="WantBlock",e.WantHave="WantHave"}(c||(c={})),function(e){e[e.WantBlock=0]="WantBlock",e[e.WantHave=1]="WantHave"}(u||(u={})),function(e){e.codec=()=>r$(u)}(c||(c={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.cid&&e.cid.byteLength>0&&(t.uint32(10),t.bytes(e.cid)),null!=e.priority&&0!==e.priority&&(t.uint32(16),t.int32(e.priority)),null!=e.cancel&&(t.uint32(24),t.bool(e.cancel)),null!=e.wantType&&(t.uint32(32),c.codec().encode(e.wantType,t)),null!=e.sendDontHave&&(t.uint32(40),t.bool(e.sendDontHave)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={cid:(0,to.c)(0),priority:0},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.cid=e.bytes();break;case 2:n.priority=e.int32();break;case 3:n.cancel=e.bool();break;case 4:n.wantType=c.codec().decode(e);break;case 5:n.sendDontHave=e.bool();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(d||(d={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.entries)for(let r of e.entries)t.uint32(10),d.codec().encode(r,t);null!=e.full&&(t.uint32(16),t.bool(e.full)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={entries:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:if(r.limits?.entries!=null&&n.entries.length===r.limits.entries)throw new rz('Decode error - map field "entries" had too many elements');n.entries.push(d.codec().decode(e,e.uint32(),{limits:r.limits?.entries$}));break;case 2:n.full=e.bool();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(h||(h={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.prefix&&e.prefix.byteLength>0&&(t.uint32(10),t.bytes(e.prefix)),null!=e.data&&e.data.byteLength>0&&(t.uint32(18),t.bytes(e.data)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={prefix:(0,to.c)(0),data:(0,to.c)(0)},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.prefix=e.bytes();break;case 2:n.data=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(f||(f={})),function(e){e.HaveBlock="HaveBlock",e.DoNotHaveBlock="DoNotHaveBlock"}(p||(p={})),function(e){e[e.HaveBlock=0]="HaveBlock",e[e.DoNotHaveBlock=1]="DoNotHaveBlock"}(g||(g={})),function(e){e.codec=()=>r$(g)}(p||(p={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.cid&&e.cid.byteLength>0&&(t.uint32(10),t.bytes(e.cid)),null!=e.type&&0!==g[e.type]&&(t.uint32(16),p.codec().encode(e.type,t)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={cid:(0,to.c)(0),type:p.HaveBlock},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.cid=e.bytes();break;case 2:n.type=p.codec().decode(e);break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(m||(m={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.wantlist&&(t.uint32(10),h.codec().encode(e.wantlist,t)),null!=e.blocks)for(let r of e.blocks)t.uint32(26),f.codec().encode(r,t);if(null!=e.blockPresences)for(let r of e.blockPresences)t.uint32(34),m.codec().encode(r,t);null!=e.pendingBytes&&0!==e.pendingBytes&&(t.uint32(40),t.int32(e.pendingBytes)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={blocks:[],blockPresences:[],pendingBytes:0},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.wantlist=h.codec().decode(e,e.uint32(),{limits:r.limits?.wantlist});break;case 3:if(r.limits?.blocks!=null&&n.blocks.length===r.limits.blocks)throw new rz('Decode error - map field "blocks" had too many elements');n.blocks.push(f.codec().decode(e,e.uint32(),{limits:r.limits?.blocks$}));break;case 4:if(r.limits?.blockPresences!=null&&n.blockPresences.length===r.limits.blockPresences)throw new rz('Decode error - map field "blockPresences" had too many elements');n.blockPresences.push(m.codec().decode(e,e.uint32(),{limits:r.limits?.blockPresences$}));break;case 5:n.pendingBytes=e.int32();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(y||(y={}));class up extends Error{static name="BlockTooLargeError";constructor(e="Block too large"){super(e),this.name="BlockTooLargeError"}}let ug=4193664;function*um(e,t){let r=[...e.wantlist.values()],n=[...e.blockPresences.values()],i=[...e.blocks.values()],s=0,o=0,a=0,l=!1;for(;;){let c={wantlist:{full:e.full??!1,entries:[]},blockPresences:[],blocks:[],pendingBytes:0},u=y.encode(c).byteLength,{added:d,hasMore:h,newSize:f}=uy(i,c.blocks,a,t,u,ub);a+=d,u=f;let p=h;({added:d,hasMore:h,newSize:f}=uy(n,c.blockPresences,o,t,u,uw)),o+=d,u=f;let g=h;({added:d,hasMore:h,newSize:f}=uy(r,c.wantlist.entries,s,t,u,uv)),s+=d,u=f;let m=h;if((l=!p&&!g&&!m)||(c.wantlist.full=!1),yield y.encode(c),l)break}}function uy(e,t,r,n,i,s){let o=0,a=!1;for(let l=r;l<e.length;l++){let r=e[l],c=s(r);if(c>ug)throw new up("Cannot send block as after encoding it is over the max message size");let u=i+c;if(u>n){a=!0;break}t.push(r),o++,i=u}return{hasMore:a,added:o,newSize:i}}function ub(e){return uE(3,f.encode(e))}function uw(e){return uE(4,m.encode(e))}function uv(e){return uE(1,d.encode(e))}function uE(e,t){return t5(e)+t5(t.byteLength)+t.byteLength}class uA extends cf{log;libp2p;routing;protocols;running;maxInboundStreams;maxOutboundStreams;messageReceiveTimeout;registrarIds;metrics;sendQueue;runOnLimitedConnections;maxOutgoingMessageSize;maxIncomingMessageSize;constructor(e,t={}){super(),this.log=e.logger.forComponent("helia:bitswap:network"),this.libp2p=e.libp2p,this.routing=e.routing,this.protocols=t.protocols??[ur],this.registrarIds=[],this.running=!1,this._onStream=this._onStream.bind(this),this.maxInboundStreams=t.maxInboundStreams??ui,this.maxOutboundStreams=t.maxOutboundStreams??us,this.messageReceiveTimeout=t.messageReceiveTimeout??uo,this.runOnLimitedConnections=t.runOnLimitedConnections??uc,this.maxIncomingMessageSize=t.maxIncomingMessageSize??ud,this.maxOutgoingMessageSize=t.maxOutgoingMessageSize??t.maxIncomingMessageSize??uh,this.metrics={blocksSent:e.metrics?.registerCounter("helia_bitswap_sent_blocks_total"),dataSent:e.metrics?.registerCounter("helia_bitswap_sent_data_bytes_total")},this.sendQueue=new cZ({concurrency:t.messageSendConcurrency??ul,metrics:e.metrics,metricName:"helia_bitswap_message_send_queue"}),this.sendQueue.addEventListener("error",e=>{this.log.error("error sending wantlist to peer",e.detail)})}async start(){if(this.running)return;this.running=!0,await this.libp2p.handle(this.protocols,this._onStream,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnections});let e={onConnect:e=>{this.safeDispatchEvent("peer:connected",{detail:e})},onDisconnect:e=>{this.safeDispatchEvent("peer:disconnected",{detail:e})}};for(let t of(this.registrarIds=[],this.protocols))this.registrarIds.push(await this.libp2p.register(t,e));this.libp2p.getConnections().forEach(e=>{this.safeDispatchEvent("peer:connected",{detail:e.remotePeer})})}async stop(){if(this.running=!1,await this.libp2p.unhandle(this.protocols),null!=this.registrarIds){for(let e of this.registrarIds)this.libp2p.unregister(e);this.registrarIds=[]}}_onStream(e){if(!this.running)return;let{stream:t,connection:r}=e;Promise.resolve().then(async()=>{this.log("incoming new bitswap %s stream from %p",t.protocol,r.remotePeer);let e=()=>{"open"===t.status?t.abort(new cM(`Incoming Bitswap stream timed out after ${this.messageReceiveTimeout}ms`)):this.log("stream aborted with status %s",t.status)},n=AbortSignal.timeout(this.messageReceiveTimeout);n.addEventListener("abort",e),await t.closeWrite(),await (0,ac.F)(t,e=>ue(e,{maxDataLength:this.maxIncomingMessageSize}),async i=>{for await(let s of i)try{let i=y.decode(s);this.log("incoming new bitswap %s message from %p on stream",t.protocol,r.remotePeer,t.id),this.safeDispatchEvent("bitswap:message",{detail:{peer:r.remotePeer,message:i}}),n.removeEventListener("abort",e),(n=AbortSignal.timeout(this.messageReceiveTimeout)).addEventListener("abort",e)}catch(e){this.log.error("error reading incoming bitswap message from %p on stream",r.remotePeer,t.id,e),t.abort(e);break}})}).catch(e=>{this.log.error("error handling incoming stream from %p",r.remotePeer,e),t.abort(e)})}async *findProviders(e,t){for await(let r of(t?.onProgress?.(new rY("bitswap:network:find-providers",e)),this.routing.findProviders(e,t)))await this.libp2p.isDialable(r.multiaddrs,{runOnLimitedConnection:this.runOnLimitedConnections})&&(yield r)}async findAndConnect(e,t){await (0,cY.A)((0,as.A)((0,ut.A)(this.findProviders(e,t),t?.maxProviders??uu),async e=>this.connectTo(e.id,t))).catch(e=>{this.log.error(e)})}async sendMessage(e,t,r){if(!this.running)throw Error("network isn't running");let n=this.sendQueue.queue.find(t=>e.equals(t.options.peerId)&&"queued"===t.status);if(null!=n){n.options.message=uf(n.options.message,t),await n.join({signal:r?.signal});return}await this.sendQueue.add(async t=>{let r=t?.message;if(null==r)throw new cy("No message to send");this.log("sendMessage to %p",e),t?.onProgress?.(new rY("bitswap:network:send-wantlist",e));let n=await this.libp2p.dialProtocol(e,ur,t);await n.closeRead();try{await (0,ac.F)(um(r,this.maxOutgoingMessageSize),e=>c7(e),n),await n.close(t)}catch(r){t?.onProgress?.(new rY("bitswap:network:send-wantlist:error",{peer:e,error:r})),this.log.error("error sending message to %p",e,r),n.abort(r)}this._updateSentStats(r.blocks)},{peerId:e,signal:r?.signal,message:t})}async connectTo(e,t){if(!this.running)throw new cB("Network isn't running");t?.onProgress?.(new rY("bitswap:network:dial",e));let[r]=await Promise.all([this.libp2p.dial(e,t),cq(this.libp2p,"peer:identify",t?.signal,{filter:t=>{if(!t.detail.peerId.equals(e))return!1;if(t.detail.protocols.includes(ur))return!0;throw new cR(`${e} did not support ${ur}`)}})]);return r}_updateSentStats(e){let t=0;for(let r of e.values())t+=r.data.byteLength;this.metrics.dataSent?.increment(t),this.metrics.blocksSent?.increment(e.size)}}let ux="1.2.840.10045.3.1.7",uS="1.3.132.0.34",uk="1.3.132.0.35";async function u_(e="P-256"){let t=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:e},!0,["sign","verify"]);return{publicKey:await crypto.subtle.exportKey("jwk",t.publicKey),privateKey:await crypto.subtle.exportKey("jwk",t.privateKey)}}async function uI(e,t){let r=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["sign"]),n=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},r,t.subarray());return new Uint8Array(n,0,n.byteLength)}async function uT(e,t,r){let n=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["verify"]);return crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},n,t,r.subarray())}var uC=r(77477);let uP=parseInt("11111",2),uR=parseInt("10000000",2),uD=parseInt("01111111",2),uN={0:uO,1:uO,2:uL,3:uj,4:uH,5:uU,6:uF,16:uO,22:uO,48:uO};function uM(e,t={offset:0}){let r=e[t.offset]&uP;if(t.offset++,null!=uN[r])return uN[r](e,t);throw Error("No decoder for tag "+r)}function uB(e,t){let r=0;if((e[t.offset]&uR)===uR){let n=e[t.offset]&uD,i="0x";t.offset++;for(let r=0;r<n;r++,t.offset++)i+=e[t.offset].toString(16).padStart(2,"0");r=parseInt(i,16)}else r=e[t.offset],t.offset++;return r}function uO(e,t){uB(e,t);let r=[];for(;!(t.offset>=e.byteLength);){let n=uM(e,t);if(null===n)break;r.push(n)}return r}function uL(e,t){let r=uB(e,t),n=t.offset,i=t.offset+r,s=[];for(let t=n;t<i;t++)(t!==n||0!==e[t])&&s.push(e[t]);return t.offset+=r,Uint8Array.from(s)}function uF(e,t){let r=uB(e,t),n=t.offset+r,i=e[t.offset];t.offset++;let s=0,o=0;i<40?(s=0,o=i):i<80?(s=1,o=i-40):(s=2,o=i-80);let a=`${s}.${o}`,l=[];for(;t.offset<n;){let r=e[t.offset];if(t.offset++,l.push(127&r),r<128){l.reverse();let e=0;for(let t=0;t<l.length;t++)e+=l[t]<<7*t;a+=`.${e}`,l=[]}}return a}function uU(e,t){return t.offset++,null}function uj(e,t){let r=uB(e,t),n=e[t.offset];t.offset++;let i=e.subarray(t.offset,t.offset+r-1);if(t.offset+=r,0!==n)throw Error("Unused bits in bit string is unimplemented");return i}function uH(e,t){let r=uB(e,t),n=e.subarray(t.offset,t.offset+r);return t.offset+=r,n}function u$(e){let t=e.toString(16);t.length%2==1&&(t="0"+t);let r=new tf;for(let e=0;e<t.length;e+=2)r.append(Uint8Array.from([parseInt(`${t[e]}${t[e+1]}`,16)]));return r}function uq(e){if(e.byteLength<128)return Uint8Array.from([e.byteLength]);let t=u$(e.byteLength);return new tf(Uint8Array.from([t.byteLength|uR]),t)}function uz(e){let t=new tf,r=128;return(e.subarray()[0]&r)===r&&t.append(Uint8Array.from([0])),t.append(e),new tf(Uint8Array.from([2]),uq(t),t)}function uV(e){let t=new tf(Uint8Array.from([0]),e);return new tf(Uint8Array.from([3]),uq(t),t)}function uG(e){return new tf(Uint8Array.from([4]),uq(e),e)}function uK(e,t=48){let r=new tf;for(let t of e)r.append(t);return new tf(Uint8Array.from([t]),uq(r),r)}var uW=r(7796);class uQ{type="ECDSA";jwk;_raw;constructor(e){this.jwk=e}get raw(){return null==this._raw&&(this._raw=dt(this.jwk)),this._raw}toMultihash(){return oJ.identity.digest(p5(this))}toCID(){return tm.TO.createV1(114,this.toMultihash())}toString(){return uW.base58btc.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&tc(this.raw,e.raw)}async verify(e,t){return uT(this.jwk,t,e)}}class uJ{type="ECDSA";jwk;publicKey;_raw;constructor(e){this.jwk=e,this.publicKey=new uQ({crv:e.crv,ext:e.ext,key_ops:["verify"],kty:"EC",x:e.x,y:e.y})}get raw(){return null==this._raw&&(this._raw=de(this.jwk)),this._raw}equals(e){return null!=e&&e.raw instanceof Uint8Array&&tc(this.raw,e.raw)}async sign(e){return uI(this.jwk,e)}}let uZ=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),uY=Uint8Array.from([6,5,43,129,4,0,34]),uX=Uint8Array.from([6,5,43,129,4,0,35]),u0={ext:!0,kty:"EC",crv:"P-256"},u1={ext:!0,kty:"EC",crv:"P-384"},u2={ext:!0,kty:"EC",crv:"P-521"},u3=32,u4=48,u5=66;function u6(e){return u8(uM(e))}function u8(e){let t,r,n=e[1],i=(0,uC.d)(n,"base64url"),s=e[2][1][0],o=1;if(n.byteLength===u3)return t=(0,uC.d)(s.subarray(o,o+u3),"base64url"),r=(0,uC.d)(s.subarray(o+u3),"base64url"),new uJ({...u0,key_ops:["sign"],d:i,x:t,y:r});if(n.byteLength===u4)return t=(0,uC.d)(s.subarray(o,o+u4),"base64url"),r=(0,uC.d)(s.subarray(o+u4),"base64url"),new uJ({...u1,key_ops:["sign"],d:i,x:t,y:r});if(n.byteLength===u5)return t=(0,uC.d)(s.subarray(o,o+u5),"base64url"),r=(0,uC.d)(s.subarray(o+u5),"base64url"),new uJ({...u2,key_ops:["sign"],d:i,x:t,y:r});throw new cy(`Private key length was wrong length, got ${n.byteLength}, expected 32, 48 or 66`)}function u7(e){return u9(uM(e))}function u9(e){let t,r,n=e[1][1][0],i=1;if(n.byteLength===2*u3+1)return t=(0,uC.d)(n.subarray(i,i+u3),"base64url"),r=(0,uC.d)(n.subarray(i+u3),"base64url"),new uQ({...u0,key_ops:["verify"],x:t,y:r});if(n.byteLength===2*u4+1)return t=(0,uC.d)(n.subarray(i,i+u4),"base64url"),r=(0,uC.d)(n.subarray(i+u4),"base64url"),new uQ({...u1,key_ops:["verify"],x:t,y:r});if(n.byteLength===2*u5+1)return t=(0,uC.d)(n.subarray(i,i+u5),"base64url"),r=(0,uC.d)(n.subarray(i+u5),"base64url"),new uQ({...u2,key_ops:["verify"],x:t,y:r});throw new cy(`coordinates were wrong length, got ${n.byteLength}, expected 65, 97 or 133`)}function de(e){return uK([uz(Uint8Array.from([1])),uG((0,rx.s)(e.d??"","base64url")),uK([dr(e.crv)],160),uK([uV(new tf(Uint8Array.from([4]),(0,rx.s)(e.x??"","base64url"),(0,rx.s)(e.y??"","base64url")))],161)]).subarray()}function dt(e){return uK([uz(Uint8Array.from([1])),uK([dr(e.crv)],160),uK([uV(new tf(Uint8Array.from([4]),(0,rx.s)(e.x??"","base64url"),(0,rx.s)(e.y??"","base64url")))],161)]).subarray()}function dr(e){if("P-256"===e)return uZ;if("P-384"===e)return uY;if("P-521"===e)return uX;throw new cy(`Invalid curve ${e}`)}async function dn(e="P-256"){return new uJ((await u_(e)).privateKey)}let di="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function ds(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function da(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function dl(e,...t){if(!ds(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function dc(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.createHasher");da(e.outputLen),da(e.blockLen)}function du(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function dd(e,t){dl(e);let r=t.outputLen;if(e.length<r)throw Error("digestInto() expects output buffer of length at least "+r)}function dh(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function df(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function dp(e,t){return e<<32-t|e>>>t}function dg(e,t){return e<<t|e>>>32-t>>>0}(e,t)=>t.toString(16).padStart(2,"0");let dm={_0:48,_9:57,A:65,F:70,a:97,f:102},dy=async()=>{};async function db(e,t,r){let n=Date.now();for(let i=0;i<e;i++){r(i);let e=Date.now()-n;e>=0&&e<t||(await dy(),n+=e)}}function dw(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function dv(e){return"string"==typeof e&&(e=dw(e)),dl(e),e}function dE(e){return"string"==typeof e&&(e=dw(e)),dl(e),e}function dA(...e){let t=0;for(let r=0;r<e.length;r++){let n=e[r];dl(n),t+=n.length}let r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){let i=e[t];r.set(i,n),n+=i.length}return r}function dx(e,t){if(void 0!==t&&"[object Object]"!==({}).toString.call(t))throw Error("options should be object or undefined");return Object.assign(e,t)}class dS{}function dk(e){let t=t=>e().update(dv(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function d_(e=32){if(di&&"function"==typeof di.getRandomValues)return di.getRandomValues(new Uint8Array(e));if(di&&"function"==typeof di.randomBytes)return Uint8Array.from(di.randomBytes(e));throw Error("crypto.getRandomValues must be defined")}function dI(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);let i=BigInt(32),s=BigInt(0xffffffff),o=Number(r>>i&s),a=Number(r&s),l=4*!!n,c=4*!n;e.setUint32(t+l,o,n),e.setUint32(t+c,a,n)}function dT(e,t,r){return e&t^~e&r}function dC(e,t,r){return e&t^e&r^t&r}class dP extends dS{constructor(e,t,r,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=n,this.buffer=new Uint8Array(e),this.view=df(this.buffer)}update(e){du(this),dl(e=dv(e));let{view:t,buffer:r,blockLen:n}=this,i=e.length;for(let s=0;s<i;){let o=Math.min(n-this.pos,i-s);if(o===n){let t=df(e);for(;n<=i-s;s+=n)this.process(t,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){du(this),dd(e,this),this.finished=!0;let{buffer:t,view:r,blockLen:n,isLE:i}=this,{pos:s}=this;t[s++]=128,dh(this.buffer.subarray(s)),this.padOffset>n-s&&(this.process(r,0),s=0);for(let e=s;e<n;e++)t[e]=0;dI(r,n-8,BigInt(8*this.length),i),this.process(r,0);let o=df(e),a=this.outputLen;if(a%4)throw Error("_sha2: outputLen should be aligned to 32bit");let l=a/4,c=this.get();if(l>c.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<l;e++)o.setUint32(4*e,c[e],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:n,finished:i,destroyed:s,pos:o}=this;return e.destroyed=s,e.finished=i,e.length=n,e.pos=o,n%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}let dR=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),dD=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),dN=BigInt(0x100000000-1),dM=BigInt(32);function dB(e,t=!1){return t?{h:Number(e&dN),l:Number(e>>dM&dN)}:{h:0|Number(e>>dM&dN),l:0|Number(e&dN)}}function dO(e,t=!1){let r=e.length,n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){let{h:r,l:o}=dB(e[s],t);[n[s],i[s]]=[r,o]}return[n,i]}let dL=(e,t,r)=>e>>>r,dF=(e,t,r)=>e<<32-r|t>>>r,dU=(e,t,r)=>e>>>r|t<<32-r,dj=(e,t,r)=>e<<32-r|t>>>r,dH=(e,t,r)=>e<<64-r|t>>>r-32,d$=(e,t,r)=>e>>>r-32|t<<64-r;function dq(e,t,r,n){let i=(t>>>0)+(n>>>0);return{h:e+r+(i/0x100000000|0)|0,l:0|i}}let dz=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),dV=(e,t,r,n)=>t+r+n+(e/0x100000000|0)|0,dG=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),dK=(e,t,r,n,i)=>t+r+n+i+(e/0x100000000|0)|0,dW=(e,t,r,n,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(i>>>0),dQ=(e,t,r,n,i,s)=>t+r+n+i+s+(e/0x100000000|0)|0,dJ=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),dZ=new Uint32Array(64);class dY extends dP{constructor(e=32){super(64,e,8,!1),this.A=0|dR[0],this.B=0|dR[1],this.C=0|dR[2],this.D=0|dR[3],this.E=0|dR[4],this.F=0|dR[5],this.G=0|dR[6],this.H=0|dR[7]}get(){let{A:e,B:t,C:r,D:n,E:i,F:s,G:o,H:a}=this;return[e,t,r,n,i,s,o,a]}set(e,t,r,n,i,s,o,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)dZ[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=dZ[e-15],r=dZ[e-2],n=dp(t,7)^dp(t,18)^t>>>3,i=dp(r,17)^dp(r,19)^r>>>10;dZ[e]=i+dZ[e-7]+n+dZ[e-16]|0}let{A:r,B:n,C:i,D:s,E:o,F:a,G:l,H:c}=this;for(let e=0;e<64;e++){let t=c+(dp(o,6)^dp(o,11)^dp(o,25))+dT(o,a,l)+dJ[e]+dZ[e]|0,u=(dp(r,2)^dp(r,13)^dp(r,22))+dC(r,n,i)|0;c=l,l=a,a=o,o=s+t|0,s=i,i=n,n=r,r=t+u|0}r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(r,n,i,s,o,a,l,c)}roundClean(){dh(dZ)}destroy(){this.set(0,0,0,0,0,0,0,0),dh(this.buffer)}}let dX=dO(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),d0=dX[0],d1=dX[1],d2=new Uint32Array(80),d3=new Uint32Array(80);class d4 extends dP{constructor(e=64){super(128,e,16,!1),this.Ah=0|dD[0],this.Al=0|dD[1],this.Bh=0|dD[2],this.Bl=0|dD[3],this.Ch=0|dD[4],this.Cl=0|dD[5],this.Dh=0|dD[6],this.Dl=0|dD[7],this.Eh=0|dD[8],this.El=0|dD[9],this.Fh=0|dD[10],this.Fl=0|dD[11],this.Gh=0|dD[12],this.Gl=0|dD[13],this.Hh=0|dD[14],this.Hl=0|dD[15]}get(){let{Ah:e,Al:t,Bh:r,Bl:n,Ch:i,Cl:s,Dh:o,Dl:a,Eh:l,El:c,Fh:u,Fl:d,Gh:h,Gl:f,Hh:p,Hl:g}=this;return[e,t,r,n,i,s,o,a,l,c,u,d,h,f,p,g]}set(e,t,r,n,i,s,o,a,l,c,u,d,h,f,p,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|n,this.Ch=0|i,this.Cl=0|s,this.Dh=0|o,this.Dl=0|a,this.Eh=0|l,this.El=0|c,this.Fh=0|u,this.Fl=0|d,this.Gh=0|h,this.Gl=0|f,this.Hh=0|p,this.Hl=0|g}process(e,t){for(let r=0;r<16;r++,t+=4)d2[r]=e.getUint32(t),d3[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){let t=0|d2[e-15],r=0|d3[e-15],n=dU(t,r,1)^dU(t,r,8)^dL(t,r,7),i=dj(t,r,1)^dj(t,r,8)^dF(t,r,7),s=0|d2[e-2],o=0|d3[e-2],a=dU(s,o,19)^dH(s,o,61)^dL(s,o,6),l=dG(i,dj(s,o,19)^d$(s,o,61)^dF(s,o,6),d3[e-7],d3[e-16]),c=dK(l,n,a,d2[e-7],d2[e-16]);d2[e]=0|c,d3[e]=0|l}let{Ah:r,Al:n,Bh:i,Bl:s,Ch:o,Cl:a,Dh:l,Dl:c,Eh:u,El:d,Fh:h,Fl:f,Gh:p,Gl:g,Hh:m,Hl:y}=this;for(let e=0;e<80;e++){let t=dU(u,d,14)^dU(u,d,18)^dH(u,d,41),b=dj(u,d,14)^dj(u,d,18)^d$(u,d,41),w=u&h^~u&p,v=dW(y,b,d&f^~d&g,d1[e],d3[e]),E=dQ(v,m,t,w,d0[e],d2[e]),A=0|v,x=dU(r,n,28)^dH(r,n,34)^dH(r,n,39),S=dj(r,n,28)^d$(r,n,34)^d$(r,n,39),k=r&i^r&o^i&o,_=n&s^n&a^s&a;m=0|p,y=0|g,p=0|h,g=0|f,h=0|u,f=0|d,({h:u,l:d}=dq(0|l,0|c,0|E,0|A)),l=0|o,c=0|a,o=0|i,a=0|s,i=0|r,s=0|n;let I=dz(A,S,_);r=dV(I,E,x,k),n=0|I}({h:r,l:n}=dq(0|this.Ah,0|this.Al,0|r,0|n)),({h:i,l:s}=dq(0|this.Bh,0|this.Bl,0|i,0|s)),({h:o,l:a}=dq(0|this.Ch,0|this.Cl,0|o,0|a)),({h:l,l:c}=dq(0|this.Dh,0|this.Dl,0|l,0|c)),({h:u,l:d}=dq(0|this.Eh,0|this.El,0|u,0|d)),({h:h,l:f}=dq(0|this.Fh,0|this.Fl,0|h,0|f)),({h:p,l:g}=dq(0|this.Gh,0|this.Gl,0|p,0|g)),({h:m,l:y}=dq(0|this.Hh,0|this.Hl,0|m,0|y)),this.set(r,n,i,s,o,a,l,c,u,d,h,f,p,g,m,y)}roundClean(){dh(d2,d3)}destroy(){dh(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let d5=dk(()=>new dY),d6=dk(()=>new d4),d8=BigInt(0),d7=BigInt(1);function d9(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function he(e){if(!d9(e))throw Error("Uint8Array expected")}function ht(e,t){if("boolean"!=typeof t)throw Error(e+" boolean expected, got "+t)}function hr(e){let t=e.toString(16);return 1&t.length?"0"+t:t}function hn(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);return""===e?d8:BigInt("0x"+e)}let hi="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,hs=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function ho(e){if(he(e),hi)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=hs[e[r]];return t}let ha={_0:48,_9:57,A:65,F:70,a:97,f:102};function hl(e){return e>=ha._0&&e<=ha._9?e-ha._0:e>=ha.A&&e<=ha.F?e-(ha.A-10):e>=ha.a&&e<=ha.f?e-(ha.a-10):void 0}function hc(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);if(hi)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let t=0,i=0;t<r;t++,i+=2){let r=hl(e.charCodeAt(i)),s=hl(e.charCodeAt(i+1));if(void 0===r||void 0===s)throw Error('hex string expected, got non-hex character "'+(e[i]+e[i+1])+'" at index '+i);n[t]=16*r+s}return n}function hu(e){return hn(ho(e))}function hd(e){return he(e),hn(ho(Uint8Array.from(e).reverse()))}function hh(e,t){return hc(e.toString(16).padStart(2*t,"0"))}function hf(e,t){return hh(e,t).reverse()}function hp(e,t,r){let n;if("string"==typeof t)try{n=hc(t)}catch(t){throw Error(e+" must be hex string or Uint8Array, cause: "+t)}else if(d9(t))n=Uint8Array.from(t);else throw Error(e+" must be hex string or Uint8Array");let i=n.length;if("number"==typeof r&&i!==r)throw Error(e+" of length "+r+" expected, got "+i);return n}function hg(...e){let t=0;for(let r=0;r<e.length;r++){let n=e[r];he(n),t+=n.length}let r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){let i=e[t];r.set(i,n),n+=i.length}return r}let hm=e=>"bigint"==typeof e&&d8<=e;function hy(e,t,r){return hm(e)&&hm(t)&&hm(r)&&t<=e&&e<r}function hb(e,t,r,n){if(!hy(t,r,n))throw Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function hw(e){let t;for(t=0;e>d8;e>>=d7,t+=1);return t}let hv=e=>(d7<<BigInt(e))-d7,hE=e=>new Uint8Array(e),hA=e=>Uint8Array.from(e);function hx(e,t,r){if("number"!=typeof e||e<2)throw Error("hashLen must be a number");if("number"!=typeof t||t<2)throw Error("qByteLen must be a number");if("function"!=typeof r)throw Error("hmacFn must be a function");let n=hE(e),i=hE(e),s=0,o=()=>{n.fill(1),i.fill(0),s=0},a=(...e)=>r(i,n,...e),l=(e=hE(0))=>{i=a(hA([0]),e),n=a(),0!==e.length&&(i=a(hA([1]),e),n=a())},c=()=>{if(s++>=1e3)throw Error("drbg: tried 1000 values");let e=0,r=[];for(;e<t;){let t=(n=a()).slice();r.push(t),e+=n.length}return hg(...r)};return(e,t)=>{let r;for(o(),l(e);!(r=t(c()));)l();return o(),r}}let hS={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||d9(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function hk(e,t,r={}){let n=(t,r,n)=>{let i=hS[r];if("function"!=typeof i)throw Error("invalid validator function");let s=e[t];if((!n||void 0!==s)&&!i(s,e))throw Error("param "+String(t)+" is invalid. Expected "+r+", got "+s)};for(let[e,r]of Object.entries(t))n(e,r,!1);for(let[e,t]of Object.entries(r))n(e,t,!0);return e}function h_(e){let t=new WeakMap;return(r,...n)=>{let i=t.get(r);if(void 0!==i)return i;let s=e(r,...n);return t.set(r,s),s}}let hI=BigInt(0),hT=BigInt(1),hC=BigInt(2),hP=BigInt(3),hR=BigInt(4),hD=BigInt(5),hN=BigInt(8);function hM(e,t){let r=e%t;return r>=hI?r:t+r}function hB(e,t,r){let n=e;for(;t-- >hI;)n*=n,n%=r;return n}function hO(e,t){if(e===hI)throw Error("invert: expected non-zero number");if(t<=hI)throw Error("invert: expected positive modulus, got "+t);let r=hM(e,t),n=t,i=hI,s=hT,o=hT,a=hI;for(;r!==hI;){let e=n/r,t=n%r,l=i-o*e,c=s-a*e;n=r,r=t,i=o,s=a,o=l,a=c}if(n!==hT)throw Error("invert: does not exist");return hM(i,t)}function hL(e){let t=e-hT,r=0;for(;t%hC===hI;)t/=hC,r++;let n=hC,i=hK(e);for(;n<e&&hV(i,n);)if(n++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===r){let t=(e+hT)/hR;return function(e,r){let n=e.pow(r,t);if(!e.eql(e.sqr(n),r))throw Error("Cannot find square root");return n}}let s=(t+hT)/hC;return function(e,i){if(!hV(e,i))throw Error("Cannot find square root");let o=r,a=e.pow(e.mul(e.ONE,n),t),l=e.pow(i,s),c=e.pow(i,t);for(;!e.eql(c,e.ONE);){if(e.eql(c,e.ZERO))return e.ZERO;let t=1;for(let r=e.sqr(c);t<o&&!e.eql(r,e.ONE);t++)r=e.sqr(r);let r=e.pow(a,hT<<BigInt(o-t-1));a=e.sqr(r),l=e.mul(l,r),c=e.mul(c,a),o=t}return l}}function hF(e){return e%hR===hP?function(t,r){let n=(e+hT)/hR,i=t.pow(r,n);if(!t.eql(t.sqr(i),r))throw Error("Cannot find square root");return i}:e%hN===hD?function(t,r){let n=t.mul(r,hC),i=(e-hD)/hN,s=t.pow(n,i),o=t.mul(r,s),a=t.mul(t.mul(o,hC),s),l=t.mul(o,t.sub(a,t.ONE));if(!t.eql(t.sqr(l),r))throw Error("Cannot find square root");return l}:hL(e)}let hU=(e,t)=>(hM(e,t)&hT)===hT,hj=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function hH(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"};return hk(e,hj.reduce((e,t)=>(e[t]="function",e),t))}function h$(e,t,r){if(r<hI)throw Error("invalid exponent, negatives unsupported");if(r===hI)return e.ONE;if(r===hT)return t;let n=e.ONE,i=t;for(;r>hI;)r&hT&&(n=e.mul(n,i)),i=e.sqr(i),r>>=hT;return n}function hq(e,t,r=!1){let n=Array(t.length).fill(r?e.ZERO:void 0),i=t.reduce((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r)),e.ONE),s=e.inv(i);return t.reduceRight((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r)),s),n}function hz(e,t){let r=(e.ORDER-hT)/hC,n=e.pow(t,r),i=e.eql(n,e.ONE),s=e.eql(n,e.ZERO),o=e.eql(n,e.neg(e.ONE));if(!i&&!s&&!o)throw Error("Cannot find square root: probably non-prime P");return i?1:s?0:-1}function hV(e,t){let r=hz(e,t);return 0===r||1===r}function hG(e,t){void 0!==t&&da(t);let r=void 0!==t?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function hK(e,t,r=!1,n={}){let i;if(e<=hI)throw Error("invalid field: expected ORDER > 0, got "+e);let{nBitLength:s,nByteLength:o}=hG(e,t);if(o>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let a=Object.freeze({ORDER:e,isLE:r,BITS:s,BYTES:o,MASK:hv(s),ZERO:hI,ONE:hT,create:t=>hM(t,e),isValid:t=>{if("bigint"!=typeof t)throw Error("invalid field element: expected bigint, got "+typeof t);return hI<=t&&t<e},is0:e=>e===hI,isOdd:e=>(e&hT)===hT,neg:t=>hM(-t,e),eql:(e,t)=>e===t,sqr:t=>hM(t*t,e),add:(t,r)=>hM(t+r,e),sub:(t,r)=>hM(t-r,e),mul:(t,r)=>hM(t*r,e),pow:(e,t)=>h$(a,e,t),div:(t,r)=>hM(t*hO(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>hO(t,e),sqrt:n.sqrt||(t=>(i||(i=hF(e)),i(a,t))),toBytes:e=>r?hf(e,o):hh(e,o),fromBytes:e=>{if(e.length!==o)throw Error("Field.fromBytes: expected "+o+" bytes, got "+e.length);return r?hd(e):hu(e)},invertBatch:e=>hq(a,e),cmov:(e,t,r)=>r?t:e});return Object.freeze(a)}function hW(e){if("bigint"!=typeof e)throw Error("field order must be bigint");return Math.ceil(e.toString(2).length/8)}function hQ(e){let t=hW(e);return t+Math.ceil(t/2)}function hJ(e,t,r=!1){let n=e.length,i=hW(t),s=hQ(t);if(n<16||n<s||n>1024)throw Error("expected "+s+"-1024 bytes of input, got "+n);let o=hM(r?hd(e):hu(e),t-hT)+hT;return r?hf(o,i):hh(o,i)}let hZ=BigInt(0),hY=BigInt(1);function hX(e,t){let r=t.negate();return e?r:t}function h0(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw Error("invalid window size, expected [1.."+t+"], got W="+e)}function h1(e,t){h0(e,t);let r=Math.ceil(t/e)+1,n=2**(e-1),i=2**e;return{windows:r,windowSize:n,mask:hv(e),maxNumber:i,shiftBy:BigInt(e)}}function h2(e,t,r){let{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r,a=Number(e&i),l=e>>o;a>n&&(a-=s,l+=hY);let c=t*n,u=c+Math.abs(a)-1;return{nextN:l,offset:u,isZero:0===a,isNeg:a<0,isNegF:t%2!=0,offsetF:c}}function h3(e,t){if(!Array.isArray(e))throw Error("array expected");e.forEach((e,r)=>{if(!(e instanceof t))throw Error("invalid point at index "+r)})}function h4(e,t){if(!Array.isArray(e))throw Error("array of scalars expected");e.forEach((e,r)=>{if(!t.isValid(e))throw Error("invalid scalar at index "+r)})}let h5=new WeakMap,h6=new WeakMap;function h8(e){return h6.get(e)||1}function h7(e,t){return{constTimeNegate:hX,hasPrecomputes:e=>1!==h8(e),unsafeLadder(t,r,n=e.ZERO){let i=t;for(;r>hZ;)r&hY&&(n=n.add(i)),i=i.double(),r>>=hY;return n},precomputeWindow(e,r){let{windows:n,windowSize:i}=h1(r,t),s=[],o=e,a=o;for(let e=0;e<n;e++){a=o,s.push(a);for(let e=1;e<i;e++)a=a.add(o),s.push(a);o=a.double()}return s},wNAF(r,n,i){let s=e.ZERO,o=e.BASE,a=h1(r,t);for(let e=0;e<a.windows;e++){let{nextN:t,offset:r,isZero:l,isNeg:c,isNegF:u,offsetF:d}=h2(i,e,a);i=t,l?o=o.add(hX(u,n[d])):s=s.add(hX(c,n[r]))}return{p:s,f:o}},wNAFUnsafe(r,n,i,s=e.ZERO){let o=h1(r,t);for(let e=0;e<o.windows&&i!==hZ;e++){let{nextN:t,offset:r,isZero:a,isNeg:l}=h2(i,e,o);if(i=t,!a){let e=n[r];s=s.add(l?e.negate():e)}}return s},getPrecomputes(e,t,r){let n=h5.get(t);return n||(n=this.precomputeWindow(t,e),1!==e&&h5.set(t,r(n))),n},wNAFCached(e,t,r){let n=h8(e);return this.wNAF(n,this.getPrecomputes(n,e,r),t)},wNAFCachedUnsafe(e,t,r,n){let i=h8(e);return 1===i?this.unsafeLadder(e,t,n):this.wNAFUnsafe(i,this.getPrecomputes(i,e,r),t,n)},setWindowSize(e,r){h0(r,t),h6.set(e,r),h5.delete(e)}}}function h9(e,t,r,n){if(h3(r,e),h4(n,t),r.length!==n.length)throw Error("arrays of points and scalars must have equal length");let i=e.ZERO,s=hw(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=hv(o),l=Array(Number(a)+1).fill(i),c=Math.floor((t.BITS-1)/o)*o,u=i;for(let e=c;e>=0;e-=o){l.fill(i);for(let t=0;t<n.length;t++){let i=Number(n[t]>>BigInt(e)&a);l[i]=l[i].add(r[t])}let t=i;for(let e=l.length-1,r=i;e>0;e--)r=r.add(l[e]),t=t.add(r);if(u=u.add(t),0!==e)for(let e=0;e<o;e++)u=u.double()}return u}function fe(e){return hH(e.Fp),hk(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...hG(e.n,e.nBitLength),...e,...{p:e.Fp.ORDER}})}let ft=BigInt(0),fr=BigInt(1),fn=BigInt(2),fi=BigInt(8),fs={zip215:!0};function fo(e){let t=fe(e);return hk(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function fa(e){let t=fo(e),{Fp:r,n:n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:l}=t,c=fn<<BigInt(8*a)-fr,u=r.create,d=hK(t.n,t.nBitLength),h=t.uvRatio||((e,t)=>{try{return{isValid:!0,value:r.sqrt(e*r.inv(t))}}catch(e){return{isValid:!1,value:ft}}}),f=t.adjustScalarBytes||(e=>e),p=t.domain||((e,t,r)=>{if(ht("phflag",r),t.length||r)throw Error("Contexts/pre-hash are not supported");return e});function g(e,t,r=!1){hb("coordinate "+e,t,r?fr:ft,c)}function m(e){if(!(e instanceof w))throw Error("ExtendedPoint expected")}let y=h_((e,t)=>{let{ex:n,ey:i,ez:s}=e,o=e.is0();null==t&&(t=o?fi:r.inv(s));let a=u(n*t),l=u(i*t),c=u(s*t);if(o)return{x:ft,y:fr};if(c!==fr)throw Error("invZ was invalid");return{x:a,y:l}}),b=h_(e=>{let{a:r,d:n}=t;if(e.is0())throw Error("bad point: ZERO");let{ex:i,ey:s,ez:o,et:a}=e,l=u(i*i),c=u(s*s),d=u(o*o),h=u(d*d),f=u(l*r);if(u(d*u(f+c))!==u(h+u(n*u(l*c))))throw Error("bad point: equation left != right (1)");if(u(i*s)!==u(o*a))throw Error("bad point: equation left != right (2)");return!0});class w{constructor(e,t,r,n){g("x",e),g("y",t),g("z",r,!0),g("t",n),this.ex=e,this.ey=t,this.ez=r,this.et=n,Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(e){if(e instanceof w)throw Error("extended point not allowed");let{x:t,y:r}=e||{};return g("x",t),g("y",r),new w(t,r,fr,u(t*r))}static normalizeZ(e){let t=hq(r,e.map(e=>e.ez));return e.map((e,r)=>e.toAffine(t[r])).map(w.fromAffine)}static msm(e,t){return h9(w,d,e,t)}_setWindowSize(e){A.setWindowSize(this,e)}assertValidity(){b(this)}equals(e){m(e);let{ex:t,ey:r,ez:n}=this,{ex:i,ey:s,ez:o}=e,a=u(t*o),l=u(i*n),c=u(r*o),d=u(s*n);return a===l&&c===d}is0(){return this.equals(w.ZERO)}negate(){return new w(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){let{a:e}=t,{ex:r,ey:n,ez:i}=this,s=u(r*r),o=u(n*n),a=u(fn*u(i*i)),l=u(e*s),c=r+n,d=u(u(c*c)-s-o),h=l+o,f=h-a,p=l-o,g=u(d*f),m=u(h*p),y=u(d*p);return new w(g,m,u(f*h),y)}add(e){m(e);let{a:r,d:n}=t,{ex:i,ey:s,ez:o,et:a}=this,{ex:l,ey:c,ez:d,et:h}=e,f=u(i*l),p=u(s*c),g=u(a*n*h),y=u(o*d),b=u((i+s)*(l+c)-f-p),v=y-g,E=y+g,A=u(p-r*f),x=u(b*v),S=u(E*A),k=u(b*A);return new w(x,S,u(v*E),k)}subtract(e){return this.add(e.negate())}wNAF(e){return A.wNAFCached(this,e,w.normalizeZ)}multiply(e){let t=e;hb("scalar",t,fr,n);let{p:r,f:i}=this.wNAF(t);return w.normalizeZ([r,i])[0]}multiplyUnsafe(e,t=w.ZERO){let r=e;return(hb("scalar",r,ft,n),r===ft)?E:this.is0()||r===fr?this:A.wNAFCachedUnsafe(this,r,w.normalizeZ,t)}isSmallOrder(){return this.multiplyUnsafe(l).is0()}isTorsionFree(){return A.unsafeLadder(this,n).is0()}toAffine(e){return y(this,e)}clearCofactor(){let{h:e}=t;return e===fr?this:this.multiplyUnsafe(e)}static fromHex(e,n=!1){let{d:i,a:s}=t,o=r.BYTES;e=hp("pointHex",e,o),ht("zip215",n);let a=e.slice(),l=e[o-1];a[o-1]=-129&l;let d=hd(a);hb("pointHex.y",d,ft,n?c:r.ORDER);let f=u(d*d),{isValid:p,value:g}=h(u(f-fr),u(i*f-s));if(!p)throw Error("Point.fromHex: invalid y coordinate");let m=(g&fr)===fr,y=(128&l)!=0;if(!n&&g===ft&&y)throw Error("Point.fromHex: x=0 and x_0=1");return y!==m&&(g=u(-g)),w.fromAffine({x:g,y:d})}static fromPrivateKey(e){let{scalar:t}=k(e);return v.multiply(t)}toRawBytes(){let{x:e,y:t}=this.toAffine(),n=hf(t,r.BYTES);return n[n.length-1]|=e&fr?128:0,n}toHex(){return ho(this.toRawBytes())}}w.BASE=new w(t.Gx,t.Gy,fr,u(t.Gx*t.Gy)),w.ZERO=new w(ft,fr,fr,ft);let{BASE:v,ZERO:E}=w,A=h7(w,8*a);function x(e){return hM(e,n)}function S(e){return x(hd(e))}function k(e){let t=r.BYTES;e=hp("private key",e,t);let n=hp("hashed private key",s(e),2*t),i=f(n.slice(0,t)),o=n.slice(t,2*t),a=S(i);return{head:i,prefix:o,scalar:a}}function _(e){let{head:t,prefix:r,scalar:n}=k(e),i=v.multiply(n),s=i.toRawBytes();return{head:t,prefix:r,scalar:n,point:i,pointBytes:s}}function I(e){return _(e).pointBytes}function T(e=Uint8Array.of(),...t){return S(s(p(hg(...t),hp("context",e),!!i)))}function C(e,t,s={}){e=hp("message",e),i&&(e=i(e));let{prefix:o,scalar:a,pointBytes:l}=_(t),c=T(s.context,o,e),u=v.multiply(c).toRawBytes(),d=x(c+T(s.context,u,l,e)*a);return hb("signature.s",d,ft,n),hp("result",hg(u,hf(d,r.BYTES)),2*r.BYTES)}let P=fs;function R(e,t,n,s=P){let o,a,l,{context:c,zip215:u}=s,d=r.BYTES;e=hp("signature",e,2*d),t=hp("message",t),n=hp("publicKey",n,d),void 0!==u&&ht("zip215",u),i&&(t=i(t));let h=hd(e.slice(d,2*d));try{o=w.fromHex(n,u),a=w.fromHex(e.slice(0,d),u),l=v.multiplyUnsafe(h)}catch(e){return!1}if(!u&&o.isSmallOrder())return!1;let f=T(c,a.toRawBytes(),o.toRawBytes(),t);return a.add(o.multiplyUnsafe(f)).subtract(l).clearCofactor().equals(w.ZERO)}v._setWindowSize(8);let D={getExtendedPublicKey:_,randomPrivateKey:()=>o(r.BYTES),precompute:(e=8,t=w.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};return{CURVE:t,getPublicKey:I,sign:C,verify:R,ExtendedPoint:w,utils:D}}let fl=BigInt(0),fc=BigInt(1);function fu(e){return hk(e,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...e})}function fd(e){let t=fu(e),{P:r}=t,n=hK(r),i=e=>hM(e,r),s=t.montgomeryBits,o=Math.ceil(s/8),a=t.nByteLength,l=t.adjustScalarBytes||(e=>e),c=t.powPminus2||(e=>n.pow(e,r-BigInt(2)));function u(e,t,r){let n=i(e*(t-r));return[t=i(t-n),r=i(r+n)]}let d=(t.a-BigInt(2))/BigInt(4);function h(e,t){let n;hb("u",e,fl,r),hb("scalar",t,fl,r);let o=t,a=e,l=fc,h=fl,f=e,p=fc,g=fl;for(let e=BigInt(s-1);e>=fl;e--){let t=o>>e&fc;g^=t,l=(n=u(g,l,f))[0],f=n[1],h=(n=u(g,h,p))[0],p=n[1],g=t;let r=l+h,s=i(r*r),c=l-h,m=i(c*c),y=s-m,b=f+p,w=i((f-p)*r),v=i(b*c),E=w+v,A=w-v;f=i(E*E),p=i(a*i(A*A)),l=i(s*m),h=i(y*(s+i(d*y)))}return l=(n=u(g,l,f))[0],f=n[1],h=(n=u(g,h,p))[0],p=n[1],i(l*c(h))}function f(e){return hf(i(e),o)}function p(e){let t=hp("u coordinate",e,o);return 32===a&&(t[31]&=127),hd(t)}function g(e){let t=hp("scalar",e),r=t.length;if(r!==o&&r!==a)throw Error("invalid scalar, expected "+(""+o+" or ")+a+" bytes, got "+r);return hd(l(t))}function m(e,t){let r=h(p(t),g(e));if(r===fl)throw Error("invalid private or public key received");return f(r)}let y=f(t.Gu);function b(e){return m(e,y)}return{scalarMult:m,scalarMultBase:b,getSharedSecret:(e,t)=>m(e,t),getPublicKey:e=>b(e),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:y}}let fh=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),ff=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);let fp=BigInt(1),fg=BigInt(2),fm=BigInt(3),fy=BigInt(5),fb=BigInt(8);function fw(e){let t=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=fh,o=e*e%s*e%s,a=hB(o,fg,s)*o%s,l=hB(a,fp,s)*e%s,c=hB(l,fy,s)*l%s,u=hB(c,t,s)*c%s,d=hB(u,r,s)*u%s,h=hB(d,n,s)*d%s,f=hB(h,i,s)*h%s,p=hB(f,i,s)*h%s,g=hB(p,t,s)*c%s;return{pow_p_5_8:hB(g,fg,s)*e%s,b2:o}}function fv(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}function fE(e,t){let r=fh,n=hM(t*t*t,r),i=fw(e*hM(n*n*t,r)).pow_p_5_8,s=hM(e*n*i,r),o=hM(t*s*s,r),a=s,l=hM(s*ff,r),c=o===e,u=o===hM(-e,r),d=o===hM(-e*ff,r);return c&&(s=a),(u||d)&&(s=l),hU(s,r)&&(s=hM(-s,r)),{isValid:c||u,value:s}}let fA=hK(fh,void 0,!0),fx=fa({a:fA.create(BigInt(-1)),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:fA,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:fb,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:d6,randomBytes:d_,adjustScalarBytes:fv,uvRatio:fE}),fS=fd({P:fh,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:e=>{let t=fh,{pow_p_5_8:r,b2:n}=fw(e);return hM(hB(r,fm,t)*n,t)},adjustScalarBytes:fv,randomBytes:d_}),fk=null,f_=null,fI=32,fT=64,fC=32;function fP(){let e=fx.utils.randomPrivateKey(),t=fx.getPublicKey(e);return{privateKey:fN(e,t),publicKey:t}}function fR(e,t){let r=e.subarray(0,fC);return fx.sign(t instanceof Uint8Array?t:t.subarray(),r)}function fD(e,t,r){return fx.verify(t,r instanceof Uint8Array?r:r.subarray(),e)}function fN(e,t){let r=new Uint8Array(fT);for(let n=0;n<fC;n++)r[n]=e[n],r[fC+n]=t[n];return r}class fM{type="Ed25519";raw;constructor(e){this.raw=fU(e,fI)}toMultihash(){return oJ.identity.digest(p5(this))}toCID(){return tm.TO.createV1(114,this.toMultihash())}toString(){return uW.base58btc.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&tc(this.raw,e.raw)}verify(e,t){return fD(this.raw,t,e)}}class fB{type="Ed25519";raw;publicKey;constructor(e,t){this.raw=fU(e,fT),this.publicKey=new fM(t)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&tc(this.raw,e.raw)}sign(e){return fR(this.raw,e)}}function fO(e){return e.length>fT?new fB((e=fU(e,fT+fI)).subarray(0,fT),e.subarray(fT,e.length)):new fB((e=fU(e,fT)).subarray(0,fT),e.subarray(fI))}function fL(e){return new fM(e=fU(e,fI))}async function fF(){let{privateKey:e,publicKey:t}=fP();return new fB(e,t)}function fU(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw new cy(`Key must be a Uint8Array of length ${t}, got ${e.length}`);return e}!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.secp256k1="secp256k1",e.ECDSA="ECDSA"}(b||(b={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.secp256k1=2]="secp256k1",e[e.ECDSA=3]="ECDSA"}(w||(w={})),function(e){e.codec=()=>r$(w)}(b||(b={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),b.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.Type=b.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(v||(v={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),b.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.Type=b.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(E||(E={}));class fj extends Error{constructor(e="An error occurred while signing a message"){super(e),this.name="SigningError"}}class fH extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class f$ extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}let fq={get(e=globalThis){let t=e.crypto;if(t?.subtle==null)throw new f$("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}},fz="1.2.840.113549.1.1.1";async function fV(e){let t=await fq.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await fW(t);return{privateKey:r[0],publicKey:r[1]}}async function fG(e,t){let r=await fq.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await fq.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,t instanceof Uint8Array?t:t.subarray());return new Uint8Array(n,0,n.byteLength)}async function fK(e,t,r){let n=await fq.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return fq.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r instanceof Uint8Array?r:r.subarray())}async function fW(e){if(null==e.privateKey||null==e.publicKey)throw new cy("Private and public key are required");return Promise.all([fq.get().subtle.exportKey("jwk",e.privateKey),fq.get().subtle.exportKey("jwk",e.publicKey)])}function fQ(e){if("RSA"!==e.kty)throw new cy("invalid key type");if(null==e.n)throw new cy("invalid key modulus");return 8*(0,rx.s)(e.n,"base64url").length}let fJ=d5;class fZ{type="RSA";jwk;_raw;_multihash;constructor(e,t){this.jwk=e,this._multihash=t}get raw(){return null==this._raw&&(this._raw=f6(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return tm.TO.createV1(114,this._multihash)}toString(){return uW.base58btc.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&tc(this.raw,e.raw)}verify(e,t){return fK(this.jwk,t,e)}}class fY{type="RSA";jwk;_raw;publicKey;constructor(e,t){this.jwk=e,this.publicKey=t}get raw(){return null==this._raw&&(this._raw=f4(this.jwk)),this._raw}equals(e){return null!=e&&e.raw instanceof Uint8Array&&tc(this.raw,e.raw)}sign(e){return fG(this.jwk,e)}}let fX=8192,f0=18,f1=1062,f2=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function f3(e){return{n:(0,uC.d)(e[1],"base64url"),e:(0,uC.d)(e[2],"base64url"),d:(0,uC.d)(e[3],"base64url"),p:(0,uC.d)(e[4],"base64url"),q:(0,uC.d)(e[5],"base64url"),dp:(0,uC.d)(e[6],"base64url"),dq:(0,uC.d)(e[7],"base64url"),qi:(0,uC.d)(e[8],"base64url"),kty:"RSA"}}function f4(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new cy("JWK was missing components");return uK([uz(Uint8Array.from([0])),uz((0,rx.s)(e.n,"base64url")),uz((0,rx.s)(e.e,"base64url")),uz((0,rx.s)(e.d,"base64url")),uz((0,rx.s)(e.p,"base64url")),uz((0,rx.s)(e.q,"base64url")),uz((0,rx.s)(e.dp,"base64url")),uz((0,rx.s)(e.dq,"base64url")),uz((0,rx.s)(e.qi,"base64url"))]).subarray()}function f5(e){let t=uM(e[1],{offset:0});return{kty:"RSA",n:(0,uC.d)(t[0],"base64url"),e:(0,uC.d)(t[1],"base64url")}}function f6(e){if(null==e.n||null==e.e)throw new cy("JWK was missing components");return uK([f2,uV(uK([uz((0,rx.s)(e.n,"base64url")),uz((0,rx.s)(e.e,"base64url"))]))]).subarray()}function f8(e){return f7(uM(e))}function f7(e){return pt(f3(e))}function f9(e,t){if(e.byteLength>=f1)throw new cb("Key size is too large");return pe(uM(e,{offset:0}),e,t)}function pe(e,t,r){let n=f5(e);if(null==r){let e=fJ(v.encode({Type:b.RSA,Data:t}));r=(0,o0.create)(f0,e)}return new fZ(n,r)}function pt(e){if(fQ(e)>fX)throw new cy("Key size is too large");let t=pn(e),r=fJ(v.encode({Type:b.RSA,Data:f6(t.publicKey)})),n=(0,o0.create)(f0,r);return new fY(t.privateKey,new fZ(t.publicKey,n))}async function pr(e){if(e>fX)throw new cy("Key size is too large");let t=await fV(e),r=fJ(v.encode({Type:b.RSA,Data:f6(t.publicKey)})),n=(0,o0.create)(f0,r);return new fY(t.privateKey,new fZ(t.publicKey,n))}function pn(e){if(null==e)throw new cy("Missing key parameter");return{privateKey:e,publicKey:{kty:e.kty,n:e.n,e:e.e}}}class pi extends dS{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,dc(e);let r=dv(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let n=this.blockLen,i=new Uint8Array(n);i.set(r.length>n?e.create().update(r).digest():r);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),dh(i)}update(e){return du(this),this.iHash.update(e),this}digestInto(e){du(this),dl(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:r,finished:n,destroyed:i,blockLen:s,outputLen:o}=this;return e.finished=n,e.destroyed=i,e.blockLen=s,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let ps=(e,t,r)=>new pi(e,t).update(r).digest();function po(e){void 0!==e.lowS&&ht("lowS",e.lowS),void 0!==e.prehash&&ht("prehash",e.prehash)}function pa(e){let t=fe(e);hk(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:r,Fp:n,a:i}=t;if(r){if(!n.eql(i,n.ZERO))throw Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if("object"!=typeof r||"bigint"!=typeof r.beta||"function"!=typeof r.splitScalar)throw Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...t})}ps.create=(e,t)=>new pi(e,t);class pl extends Error{constructor(e=""){super(e)}}let pc={Err:pl,_tlv:{encode:(e,t)=>{let{Err:r}=pc;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(1&t.length)throw new r("tlv.encode: unpadded data");let n=t.length/2,i=hr(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");let s=n>127?hr(i.length/2|128):"";return hr(e)+s+i+t},decode(e,t){let{Err:r}=pc,n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");let i=t[n++],s=0;if(128&i){let e=127&i;if(!e)throw new r("tlv.decode(long): indefinite length not supported");if(e>4)throw new r("tlv.decode(long): byte length is too big");let o=t.subarray(n,n+e);if(o.length!==e)throw new r("tlv.decode: length bytes not complete");if(0===o[0])throw new r("tlv.decode(long): zero leftmost byte");for(let e of o)s=s<<8|e;if(n+=e,s<128)throw new r("tlv.decode(long): not minimal encoding")}else s=i;let o=t.subarray(n,n+s);if(o.length!==s)throw new r("tlv.decode: wrong value length");return{v:o,l:t.subarray(n+s)}}},_int:{encode(e){let{Err:t}=pc;if(e<pu)throw new t("integer: negative integers are not allowed");let r=hr(e);if(8&Number.parseInt(r[0],16)&&(r="00"+r),1&r.length)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=pc;if(128&e[0])throw new t("invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new t("invalid signature integer: unnecessary leading zero");return hu(e)}},toSig(e){let{Err:t,_int:r,_tlv:n}=pc,i=hp("signature",e),{v:s,l:o}=n.decode(48,i);if(o.length)throw new t("invalid signature: left bytes after parsing");let{v:a,l:l}=n.decode(2,s),{v:c,l:u}=n.decode(2,l);if(u.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(c)}},hexFromSig(e){let{_tlv:t,_int:r}=pc,n=t.encode(2,r.encode(e.r))+t.encode(2,r.encode(e.s));return t.encode(48,n)}},pu=BigInt(0),pd=BigInt(1),ph=BigInt(2),pf=BigInt(3),pp=BigInt(4);function pg(e){let t=pa(e),{Fp:r}=t,n=hK(t.n,t.nBitLength),i=t.toBytes||((e,t,n)=>{let i=t.toAffine();return hg(Uint8Array.from([4]),r.toBytes(i.x),r.toBytes(i.y))}),s=t.fromBytes||(e=>{let t=e.subarray(1);return{x:r.fromBytes(t.subarray(0,r.BYTES)),y:r.fromBytes(t.subarray(r.BYTES,2*r.BYTES))}});function o(e){let{a:n,b:i}=t,s=r.sqr(e),o=r.mul(s,e);return r.add(r.add(o,r.mul(e,n)),i)}if(!r.eql(r.sqr(t.Gy),o(t.Gx)))throw Error("bad generator point: equation left != right");function a(e){return hy(e,pd,t.n)}function l(e){let r,{allowedPrivateKeyLengths:n,nByteLength:i,wrapPrivateKey:s,n:o}=t;if(n&&"bigint"!=typeof e){if(d9(e)&&(e=ho(e)),"string"!=typeof e||!n.includes(e.length))throw Error("invalid private key");e=e.padStart(2*i,"0")}try{r="bigint"==typeof e?e:hu(hp("private key",e,i))}catch(t){throw Error("invalid private key, expected hex or "+i+" bytes, got "+typeof e)}return s&&(r=hM(r,o)),hb("private key",r,pd,o),r}function c(e){if(!(e instanceof h))throw Error("ProjectivePoint expected")}let u=h_((e,t)=>{let{px:n,py:i,pz:s}=e;if(r.eql(s,r.ONE))return{x:n,y:i};let o=e.is0();null==t&&(t=o?r.ONE:r.inv(s));let a=r.mul(n,t),l=r.mul(i,t),c=r.mul(s,t);if(o)return{x:r.ZERO,y:r.ZERO};if(!r.eql(c,r.ONE))throw Error("invZ was invalid");return{x:a,y:l}}),d=h_(e=>{if(e.is0()){if(t.allowInfinityPoint&&!r.is0(e.py))return;throw Error("bad point: ZERO")}let{x:n,y:i}=e.toAffine();if(!r.isValid(n)||!r.isValid(i))throw Error("bad point: x or y not FE");let s=r.sqr(i),a=o(n);if(!r.eql(s,a))throw Error("bad point: equation left != right");if(!e.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});class h{constructor(e,t,n){if(null==e||!r.isValid(e))throw Error("x required");if(null==t||!r.isValid(t)||r.is0(t))throw Error("y required");if(null==n||!r.isValid(n))throw Error("z required");this.px=e,this.py=t,this.pz=n,Object.freeze(this)}static fromAffine(e){let{x:t,y:n}=e||{};if(!e||!r.isValid(t)||!r.isValid(n))throw Error("invalid affine point");if(e instanceof h)throw Error("projective point not allowed");let i=e=>r.eql(e,r.ZERO);return i(t)&&i(n)?h.ZERO:new h(t,n,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){let t=hq(r,e.map(e=>e.pz));return e.map((e,r)=>e.toAffine(t[r])).map(h.fromAffine)}static fromHex(e){let t=h.fromAffine(s(hp("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return h.BASE.multiply(l(e))}static msm(e,t){return h9(h,n,e,t)}_setWindowSize(e){p.setWindowSize(this,e)}assertValidity(){d(this)}hasEvenY(){let{y:e}=this.toAffine();if(r.isOdd)return!r.isOdd(e);throw Error("Field doesn't support isOdd")}equals(e){c(e);let{px:t,py:n,pz:i}=this,{px:s,py:o,pz:a}=e,l=r.eql(r.mul(t,a),r.mul(s,i)),u=r.eql(r.mul(n,a),r.mul(o,i));return l&&u}negate(){return new h(this.px,r.neg(this.py),this.pz)}double(){let{a:e,b:n}=t,i=r.mul(n,pf),{px:s,py:o,pz:a}=this,l=r.ZERO,c=r.ZERO,u=r.ZERO,d=r.mul(s,s),f=r.mul(o,o),p=r.mul(a,a),g=r.mul(s,o);return g=r.add(g,g),u=r.mul(s,a),u=r.add(u,u),l=r.mul(e,u),c=r.mul(i,p),c=r.add(l,c),l=r.sub(f,c),c=r.add(f,c),c=r.mul(l,c),l=r.mul(g,l),u=r.mul(i,u),p=r.mul(e,p),g=r.sub(d,p),g=r.mul(e,g),g=r.add(g,u),u=r.add(d,d),d=r.add(u,d),d=r.add(d,p),d=r.mul(d,g),c=r.add(c,d),p=r.mul(o,a),p=r.add(p,p),d=r.mul(p,g),l=r.sub(l,d),u=r.mul(p,f),u=r.add(u,u),new h(l,c,u=r.add(u,u))}add(e){c(e);let{px:n,py:i,pz:s}=this,{px:o,py:a,pz:l}=e,u=r.ZERO,d=r.ZERO,f=r.ZERO,p=t.a,g=r.mul(t.b,pf),m=r.mul(n,o),y=r.mul(i,a),b=r.mul(s,l),w=r.add(n,i),v=r.add(o,a);w=r.mul(w,v),v=r.add(m,y),w=r.sub(w,v),v=r.add(n,s);let E=r.add(o,l);return v=r.mul(v,E),E=r.add(m,b),v=r.sub(v,E),E=r.add(i,s),u=r.add(a,l),E=r.mul(E,u),u=r.add(y,b),E=r.sub(E,u),f=r.mul(p,v),u=r.mul(g,b),f=r.add(u,f),u=r.sub(y,f),f=r.add(y,f),d=r.mul(u,f),y=r.add(m,m),y=r.add(y,m),b=r.mul(p,b),v=r.mul(g,v),y=r.add(y,b),b=r.sub(m,b),b=r.mul(p,b),v=r.add(v,b),m=r.mul(y,v),d=r.add(d,m),m=r.mul(E,v),u=r.mul(w,u),u=r.sub(u,m),m=r.mul(w,y),f=r.mul(E,f),new h(u,d,f=r.add(f,m))}subtract(e){return this.add(e.negate())}is0(){return this.equals(h.ZERO)}wNAF(e){return p.wNAFCached(this,e,h.normalizeZ)}multiplyUnsafe(e){let{endo:n,n:i}=t;hb("scalar",e,pu,i);let s=h.ZERO;if(e===pu)return s;if(this.is0()||e===pd)return this;if(!n||p.hasPrecomputes(this))return p.wNAFCachedUnsafe(this,e,h.normalizeZ);let{k1neg:o,k1:a,k2neg:l,k2:c}=n.splitScalar(e),u=s,d=s,f=this;for(;a>pu||c>pu;)a&pd&&(u=u.add(f)),c&pd&&(d=d.add(f)),f=f.double(),a>>=pd,c>>=pd;return o&&(u=u.negate()),l&&(d=d.negate()),d=new h(r.mul(d.px,n.beta),d.py,d.pz),u.add(d)}multiply(e){let n,i,{endo:s,n:o}=t;if(hb("scalar",e,pd,o),s){let{k1neg:t,k1:o,k2neg:a,k2:l}=s.splitScalar(e),{p:c,f:u}=this.wNAF(o),{p:d,f:f}=this.wNAF(l);c=p.constTimeNegate(t,c),d=p.constTimeNegate(a,d),d=new h(r.mul(d.px,s.beta),d.py,d.pz),n=c.add(d),i=u.add(f)}else{let{p:t,f:r}=this.wNAF(e);n=t,i=r}return h.normalizeZ([n,i])[0]}multiplyAndAddUnsafe(e,t,r){let n=h.BASE,i=(e,t)=>t!==pu&&t!==pd&&e.equals(n)?e.multiply(t):e.multiplyUnsafe(t),s=i(this,t).add(i(e,r));return s.is0()?void 0:s}toAffine(e){return u(this,e)}isTorsionFree(){let{h:e,isTorsionFree:r}=t;if(e===pd)return!0;if(r)return r(h,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:e,clearCofactor:r}=t;return e===pd?this:r?r(h,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return ht("isCompressed",e),this.assertValidity(),i(h,this,e)}toHex(e=!0){return ht("isCompressed",e),ho(this.toRawBytes(e))}}h.BASE=new h(t.Gx,t.Gy,r.ONE),h.ZERO=new h(r.ZERO,r.ONE,r.ZERO);let f=t.nBitLength,p=h7(h,t.endo?Math.ceil(f/2):f);return{CURVE:t,ProjectivePoint:h,normPrivateKeyToScalar:l,weierstrassEquation:o,isWithinCurveOrder:a}}function pm(e){let t=fe(e);return hk(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function py(e){let t=pm(e),{Fp:r,n:n}=t,i=r.BYTES+1,s=2*r.BYTES+1;function o(e){return hM(e,n)}function a(e){return hO(e,n)}let{ProjectivePoint:l,normPrivateKeyToScalar:c,weierstrassEquation:u,isWithinCurveOrder:d}=pg({...t,toBytes(e,t,n){let i=t.toAffine(),s=r.toBytes(i.x),o=hg;return(ht("isCompressed",n),n)?o(Uint8Array.from([t.hasEvenY()?2:3]),s):o(Uint8Array.from([4]),s,r.toBytes(i.y))},fromBytes(e){let t=e.length,n=e[0],o=e.subarray(1);if(t===i&&(2===n||3===n)){let e,t=hu(o);if(!hy(t,pd,r.ORDER))throw Error("Point is not on curve");let i=u(t);try{e=r.sqrt(i)}catch(e){throw Error("Point is not on curve"+(e instanceof Error?": "+e.message:""))}return(1&n)==1!=((e&pd)===pd)&&(e=r.neg(e)),{x:t,y:e}}if(t===s&&4===n)return{x:r.fromBytes(o.subarray(0,r.BYTES)),y:r.fromBytes(o.subarray(r.BYTES,2*r.BYTES))};throw Error("invalid Point, expected length of "+i+", or uncompressed "+s+", got "+t)}}),h=e=>ho(hh(e,t.nByteLength));function f(e){return e>n>>pd}function p(e){return f(e)?o(-e):e}let g=(e,t,r)=>hu(e.slice(t,r));class m{constructor(e,t,r){hb("r",e,pd,n),hb("s",t,pd,n),this.r=e,this.s=t,null!=r&&(this.recovery=r),Object.freeze(this)}static fromCompact(e){let r=t.nByteLength;return new m(g(e=hp("compactSignature",e,2*r),0,r),g(e,r,2*r))}static fromDER(e){let{r:t,s:r}=pc.toSig(hp("DER",e));return new m(t,r)}assertValidity(){}addRecoveryBit(e){return new m(this.r,this.s,e)}recoverPublicKey(e){let{r:n,s:i,recovery:s}=this,c=A(hp("msgHash",e));if(null==s||![0,1,2,3].includes(s))throw Error("recovery id invalid");let u=2===s||3===s?n+t.n:n;if(u>=r.ORDER)throw Error("recovery id 2 or 3 invalid");let d=(1&s)==0?"02":"03",f=l.fromHex(d+h(u)),p=a(u),g=o(-c*p),m=o(i*p),y=l.BASE.multiplyAndAddUnsafe(f,g,m);if(!y)throw Error("point at infinify");return y.assertValidity(),y}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new m(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return hc(this.toDERHex())}toDERHex(){return pc.hexFromSig(this)}toCompactRawBytes(){return hc(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}let y={isValidPrivateKey(e){try{return c(e),!0}catch(e){return!1}},normPrivateKeyToScalar:c,randomPrivateKey:()=>{let e=hQ(t.n);return hJ(t.randomBytes(e),t.n)},precompute:(e=8,t=l.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function b(e,t=!0){return l.fromPrivateKey(e).toRawBytes(t)}function w(e){let t=d9(e),r="string"==typeof e,n=(t||r)&&e.length;return t?n===i||n===s:r?n===2*i||n===2*s:e instanceof l}function v(e,t,r=!0){if(w(e))throw Error("first arg must be private key");if(!w(t))throw Error("second arg must be public key");return l.fromHex(t).multiply(c(e)).toRawBytes(r)}let E=t.bits2int||function(e){if(e.length>8192)throw Error("input is too large");let r=hu(e),n=8*e.length-t.nBitLength;return n>0?r>>BigInt(n):r},A=t.bits2int_modN||function(e){return o(E(e))},x=hv(t.nBitLength);function S(e){return hb("num < 2^"+t.nBitLength,e,pu,x),hh(e,t.nByteLength)}function k(e,n,i=_){if(["recovered","canonical"].some(e=>e in i))throw Error("sign() legacy options not supported");let{hash:s,randomBytes:u}=t,{lowS:h,prehash:g,extraEntropy:y}=i;null==h&&(h=!0),e=hp("msgHash",e),po(i),g&&(e=hp("prehashed msgHash",s(e)));let b=A(e),w=c(n),v=[S(w),S(b)];if(null!=y&&!1!==y){let e=!0===y?u(r.BYTES):y;v.push(hp("extraEntropy",e))}let x=hg(...v),I=b;return{seed:x,k2sig:function(e){let t=E(e);if(!d(t))return;let r=a(t),n=l.BASE.multiply(t).toAffine(),i=o(n.x);if(i===pu)return;let s=o(r*o(I+i*w));if(s===pu)return;let c=2*(n.x!==i)|Number(n.y&pd),u=s;return h&&f(s)&&(u=p(s),c^=1),new m(i,u,c)}}}let _={lowS:t.lowS,prehash:!1},I={lowS:t.lowS,prehash:!1};function T(e,r,n=_){let{seed:i,k2sig:s}=k(e,r,n),o=t;return hx(o.hash.outputLen,o.nByteLength,o.hmac)(i,s)}function C(e,r,n,i=I){let s,c,u=e;r=hp("msgHash",r),n=hp("publicKey",n);let{lowS:d,prehash:h,format:f}=i;if(po(i),"strict"in i)throw Error("options.strict was renamed to lowS");if(void 0!==f&&"compact"!==f&&"der"!==f)throw Error("format must be compact or der");let p="string"==typeof u||d9(u),g=!p&&!f&&"object"==typeof u&&null!==u&&"bigint"==typeof u.r&&"bigint"==typeof u.s;if(!p&&!g)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");try{if(g&&(c=new m(u.r,u.s)),p){try{"compact"!==f&&(c=m.fromDER(u))}catch(e){if(!(e instanceof pc.Err))throw e}c||"der"===f||(c=m.fromCompact(u))}s=l.fromHex(n)}catch(e){return!1}if(!c||d&&c.hasHighS())return!1;h&&(r=t.hash(r));let{r:y,s:b}=c,w=A(r),v=a(b),E=o(w*v),x=o(y*v),S=l.BASE.multiplyAndAddUnsafe(s,E,x)?.toAffine();return!!S&&o(S.x)===y}return l.BASE._setWindowSize(8),{CURVE:t,getPublicKey:b,getSharedSecret:v,sign:T,verify:C,ProjectivePoint:l,Signature:m,utils:y}}function pb(e){return{hash:e,hmac:(t,...r)=>ps(e,t,dA(...r)),randomBytes:d_}}function pw(e,t){let r=t=>py({...e,...pb(t)});return{...r(t),create:r}}let pv=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),pE=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),pA=BigInt(1),px=BigInt(2),pS=(e,t)=>(e+t/px)/t;function pk(e){let t=pv,r=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=e*e*e%t,u=c*c*e%t,d=hB(u,r,t)*u%t,h=hB(d,r,t)*u%t,f=hB(h,px,t)*c%t,p=hB(f,i,t)*f%t,g=hB(p,s,t)*p%t,m=hB(g,a,t)*g%t,y=hB(m,l,t)*m%t,b=hB(y,a,t)*g%t,w=hB(b,r,t)*u%t,v=hB(w,o,t)*p%t,E=hB(v,n,t)*c%t,A=hB(E,px,t);if(!p_.eql(p_.sqr(A),e))throw Error("Cannot find square root");return A}let p_=hK(pv,void 0,void 0,{sqrt:pk}),pI=pw({a:BigInt(0),b:BigInt(7),Fp:p_,n:pE,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=pE,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-pA*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=pS(s*e,t),l=pS(-n*e,t),c=hM(e-a*r-l*i,t),u=hM(-a*n-l*s,t),d=c>o,h=u>o;if(d&&(c=t-c),h&&(u=t-u),c>o||u>o)throw Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:d,k1:c,k2neg:h,k2:u}}}},d5),pT=BigInt(0),pC={};function pP(e,...t){let r=pC[e];if(void 0===r){let t=sha256(Uint8Array.from(e,e=>e.charCodeAt(0)));r=concatBytes(t,t),pC[e]=r}return sha256(concatBytes(r,...t))}let pR=e=>e.toRawBytes(!0).slice(1),pD=e=>numberToBytesBE(e,32),pN=e=>mod(e,pv),pM=e=>mod(e,pE),pB=pI.ProjectivePoint,pO=(e,t,r)=>pB.BASE.multiplyAndAddUnsafe(e,t,r);function pL(e){aInRange("x",e,pA,pv);let t=pN(e*e),r=pk(pN(t*e+BigInt(7)));r%px!==pT&&(r=pN(-r));let n=new pB(e,r,pA);return n.assertValidity(),n}let pF=null;function pU(...e){return pM(pF(pP("BIP0340/challenge",...e)))}function pj(e){return null!=e&&"function"==typeof e.then&&"function"==typeof e.catch&&"function"==typeof e.finally}let pH=33,p$=32;function pq(e,t){let r=rX.sha256.digest(t instanceof Uint8Array?t:t.subarray());if(pj(r))return r.then(({digest:t})=>pI.sign(t,e).toDERRawBytes()).catch(e=>{throw new fj(String(e))});try{return pI.sign(r.digest,e).toDERRawBytes()}catch(e){throw new fj(String(e))}}function pz(e,t,r){let n=rX.sha256.digest(r instanceof Uint8Array?r:r.subarray());if(pj(n))return n.then(({digest:r})=>pI.verify(t,r,e)).catch(e=>{throw new fH(String(e))});try{return pI.verify(t,n.digest,e)}catch(e){throw new fH(String(e))}}class pV{type="secp256k1";raw;_key;constructor(e){this._key=pY(e),this.raw=pJ(this._key)}toMultihash(){return oJ.identity.digest(p5(this))}toCID(){return tm.TO.createV1(114,this.toMultihash())}toString(){return uW.base58btc.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&tc(this.raw,e.raw)}verify(e,t){return pz(this._key,t,e)}}class pG{type="secp256k1";raw;publicKey;constructor(e,t){this.raw=pZ(e),this.publicKey=new pV(t??pX(e))}equals(e){return null!=e&&e.raw instanceof Uint8Array&&tc(this.raw,e.raw)}sign(e){return pq(this.raw,e)}}function pK(e){return new pG(e)}function pW(e){return new pV(e)}async function pQ(){return new pG(p0())}function pJ(e){return pI.ProjectivePoint.fromHex(e).toRawBytes(!0)}function pZ(e){try{return pI.getPublicKey(e,!0),e}catch(e){throw new cw(String(e))}}function pY(e){try{return pI.ProjectivePoint.fromHex(e),e}catch(e){throw new cb(String(e))}}function pX(e){try{return pI.getPublicKey(e,!0)}catch(e){throw new cw(String(e))}}function p0(){return pI.utils.randomPrivateKey()}async function p1(e,t){if("Ed25519"===e)return fF();if("secp256k1"===e)return pQ();if("RSA"===e)return pr(p9(t));if("ECDSA"===e)return dn(ge(t));throw new cH}function p2(e,t){let{Type:r,Data:n}=v.decode(e),i=n??new Uint8Array;switch(r){case b.RSA:return f9(i,t);case b.Ed25519:return fL(i);case b.secp256k1:return pW(i);case b.ECDSA:return u7(i);default:throw new cH}}function p3(e){if(e.byteLength===fI)return fL(e);if(e.byteLength===pH)return pW(e);let t=uM(e),r=t[1]?.[0];if(r===ux||r===uS||r===uk)return u9(t);if(t[0]?.[0]===fz)return pe(t,e);throw new cy("Could not extract public key from raw bytes")}function p4(e){let{Type:t,Data:r}=v.decode(e.digest),n=r??new Uint8Array;switch(t){case b.Ed25519:return fL(n);case b.secp256k1:return pW(n);case b.ECDSA:return u7(n);default:throw new cH}}function p5(e){return v.encode({Type:b[e.type],Data:e.raw})}function p6(e){let t=E.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case b.RSA:return f8(r);case b.Ed25519:return fO(r);case b.secp256k1:return pK(r);case b.ECDSA:return u6(r);default:throw new cH}}function p8(e){if(e.byteLength===fT)return fO(e);if(e.byteLength===p$)return pK(e);let t=uM(e),r=t[2]?.[0];if(r===ux||r===uS||r===uk)return u8(t);if(t.length>8)return f7(t);throw new cy("Could not extract private key from raw bytes")}function p7(e){return E.encode({Type:b[e.type],Data:e.raw})}function p9(e){return null==e?2048:parseInt(e,10)}function ge(e){if("P-256"===e||null==e)return"P-256";if("P-384"===e)return"P-384";if("P-521"===e)return"P-521";throw new cy("Unsupported curve, should be P-256, P-384 or P-521")}let gt=Symbol.for("@libp2p/peer-id");function gr(e){return!!e?.[gt]}let gn=Symbol.for("nodejs.util.inspect.custom"),gi=114;class gs{type;multihash;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[gt]=!0;toString(){return null==this.string&&(this.string=uW.base58btc.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return tm.TO.createV1(gi,this.multihash)}toJSON(){return this.toString()}equals(e){if(null==e)return!1;if(e instanceof Uint8Array)return tc(this.multihash.bytes,e);if("string"==typeof e)return this.toString()===e;if(e?.toMultihash()?.bytes!=null)return tc(this.multihash.bytes,e.toMultihash().bytes);throw Error("not valid Id")}[gn](){return`PeerId(${this.toString()})`}}class go extends gs{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class ga extends gs{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.publicKey}}class gl extends gs{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.publicKey}}let gc=2336;class gu{type="url";multihash;publicKey;url;constructor(e){this.url=e.toString(),this.multihash=oJ.identity.digest((0,rx.s)(this.url))}[gn](){return`PeerId(${this.url})`}[gt]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return tm.TO.createV1(gc,this.toMultihash())}toJSON(){return this.toString()}equals(e){return null!=e&&(e instanceof Uint8Array&&(e=(0,uC.d)(e)),e.toString()===this.toString())}}let gd=114,gh=2336;function gf(e,t){let r;if("1"===e.charAt(0)||"Q"===e.charAt(0))r=o0.decode(uW.base58btc.decode(`z${e}`));else{if(e.startsWith("k51qzi5uqu5")||e.startsWith("kzwfwjn5ji4")||e.startsWith("k2k4r8")||e.startsWith("bafz"))return gy(tm.TO.parse(e));if(null==t)throw new cy('Please pass a multibase decoder for strings that do not start with "1" or "Q"');r=o0.decode(t.decode(e))}return gm(r)}function gp(e){if("Ed25519"===e.type)return new ga({multihash:e.toCID().multihash,publicKey:e});if("secp256k1"===e.type)return new gl({multihash:e.toCID().multihash,publicKey:e});if("RSA"===e.type)return new go({multihash:e.toCID().multihash,publicKey:e});throw new cH}function gg(e){return gp(e.publicKey)}function gm(e){if(gw(e))return new go({multihash:e});if(gb(e))try{let t=p4(e);if("Ed25519"===t.type)return new ga({multihash:e,publicKey:t});if("secp256k1"===t.type)return new gl({multihash:e,publicKey:t})}catch(t){return new gu(new URL((0,uC.d)(e.digest)))}throw new cP("Supplied PeerID Multihash is invalid")}function gy(e){if(e?.multihash==null||null==e.version||1===e.version&&e.code!==gd&&e.code!==gh)throw new cC("Supplied PeerID CID is invalid");return e.code===gh?new gu(new URL((0,uC.d)(e.multihash.digest))):gm(e.multihash)}function gb(e){return e.code===oJ.identity.code}function gw(e){return e.code===rX.sha256.code}function gv(e,t){let r={[Symbol.iterator]:()=>r,next:()=>{let r=e.next(),n=r.value;return!0===r.done||null==n?{done:!0,value:void 0}:{done:!1,value:t(n)}}};return r}function gE(e){return gm(o0.decode(uW.base58btc.decode(`z${e}`)))}class gA{map;constructor(e){if(this.map=new Map,null!=e)for(let[t,r]of e.entries())this.map.set(t.toString(),{key:t,value:r})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return gv(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,r)=>{e(t.value,t.key,this)})}get(e){return this.map.get(e.toString())?.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return gv(this.map.values(),e=>e.key)}values(){return gv(this.map.values(),e=>e.value)}get size(){return this.map.size}}class gx extends gA{metric;constructor(e){super();let{name:t,metrics:r}=e;this.metric=r.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){let t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function gS(e){let t,{name:r,metrics:n}=e;return null!=n?new gx({name:r,metrics:n}):new gA}class gk{full;pendingBytes;wantlist;blocks;blockPresences;constructor(e=!1,t=0){this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}addWantlistEntry(e,t){let r=oN.base64.encode(e.multihash.bytes);this.wantlist.set(r,t)}addBlockPresence(e,t){let r=oN.base64.encode(e.multihash.bytes);this.blockPresences.set(r,t)}addBlock(e,t){let r=oN.base64.encode(e.multihash.bytes);this.blocks.set(r,t)}}let g_=function(e){let t=new Uint8Array(e.reduce((e,t)=>e+t5(t),0)),r=0;for(let n of e)t=re(n,t,r),r+=t5(n);return t};function gI(e){return g_([e.version,e.code,e.multihash.code,e.multihash.digest.byteLength])}class gT{peerId;blockstore;network;wants;exchangeCount;bytesSent;bytesReceived;lastExchange;maxSizeReplaceHasWithBlock;log;constructor(e,t){this.peerId=e.peerId,this.blockstore=e.blockstore,this.network=e.network,this.wants=new Map,this.log=e.logger.forComponent(`helia:bitswap:ledger:${e.peerId}`),this.exchangeCount=0,this.bytesSent=0,this.bytesReceived=0,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock??un}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesReceived+=e}debtRatio(){return this.bytesSent/(this.bytesReceived+1)}async sendBlocksToPeer(e){let t=new gk,r=new Set;for(let[n,i]of this.wants.entries())try{let s=await this.blockstore.get(i.cid,e);i.wantType===c.WantHave?s.byteLength<this.maxSizeReplaceHasWithBlock?(this.log("sending have and block for %c",i.cid),r.add(n),t.addBlock(i.cid,{data:s,prefix:gI(i.cid)})):(this.log("sending have for %c",i.cid),t.addBlockPresence(i.cid,{cid:i.cid.bytes,type:p.HaveBlock})):(this.log("sending block for %c",i.cid),r.add(n),t.addBlock(i.cid,{data:s,prefix:gI(i.cid)}))}catch(e){if("NotFoundError"!==e.name)throw e;if(this.log("do not have block for %c",i.cid),!i.sendDontHave||!0===i.sentDoNotHave)continue;i.sentDoNotHave=!0,t.addBlockPresence(i.cid,{cid:i.cid.bytes,type:p.DoNotHaveBlock})}if(t.blocks.size>0||t.blockPresences.size>0)for(let n of(this.log("sending message"),await this.network.sendMessage(this.peerId,t,e),this.log("sent message"),this.sentBytes([...t.blocks.values()].reduce((e,t)=>e+t.data.byteLength,0)),r))this.wants.delete(n)}}class gC{blockstore;network;ledgerMap;maxSizeReplaceHasWithBlock;log;logger;constructor(e,t={}){this.blockstore=e.blockstore,this.network=e.network,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock,this.log=e.logger.forComponent("helia:bitswap:peer-want-lists"),this.logger=e.logger,this.ledgerMap=gS({name:"helia_bitswap_ledger_map",metrics:e.metrics}),this.network.addEventListener("bitswap:message",e=>{this.receiveMessage(e.detail.peer,e.detail.message).catch(t=>{this.log.error("error receiving bitswap message from %p",e.detail.peer,t)})}),this.network.addEventListener("peer:disconnected",e=>{this.peerDisconnected(e.detail)})}ledgerForPeer(e){let t=this.ledgerMap.get(e);if(null!=t)return{peer:t.peerId,value:t.debtRatio(),sent:t.bytesSent,received:t.bytesReceived,exchanged:t.exchangeCount}}wantListForPeer(e){let t=this.ledgerMap.get(e);if(null!=t)return[...t.wants.values()]}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.peerId)}async receiveMessage(e,t){let r=this.ledgerMap.get(e);if(null==r&&(r=new gT({peerId:e,blockstore:this.blockstore,network:this.network,logger:this.logger},{maxSizeReplaceHasWithBlock:this.maxSizeReplaceHasWithBlock}),this.ledgerMap.set(e,r)),r.receivedBytes(t.blocks?.reduce((e,t)=>e+t.data.byteLength,0)??0),null!=t.wantlist)for(let n of(!0===t.wantlist.full&&r.wants.clear(),t.wantlist.entries)){let t=tm.TO.decode(n.cid),i=(0,uC.d)(t.multihash.bytes,"base64");!0===n.cancel?(this.log("peer %p cancelled want of block for %c",e,t),r.wants.delete(i)):(n.wantType===c.WantHave?this.log("peer %p wanted block presence for %c",e,t):this.log("peer %p wanted block for %c",e,t),r.wants.set(i,{cid:t,priority:n.priority,wantType:n.wantType??c.WantBlock,sendDontHave:n.sendDontHave??!1}))}this.log("send blocks to peer"),await r.sendBlocksToPeer()}async receivedBlock(e,t){let r=(0,uC.d)(e.multihash.bytes,"base64"),n=[];for(let e of this.ledgerMap.values())e.wants.has(r)&&n.push(e);await Promise.all(n.map(async e=>e.sendBlocksToPeer(t)))}peerDisconnected(e){this.ledgerMap.delete(e)}}let gP=1,gR=5;class gD extends Error{static name="InsufficientProvidersError";constructor(e="Insufficient providers found"){super(e),this.name="InsufficientProvidersError"}}class gN extends Error{static name="NoRoutersAvailableError";constructor(e="No routers available"){super(e),this.name="NoRoutersAvailableError"}}class gM extends Error{static name="UnknownHashAlgorithmError";constructor(e="Unknown hash algorithm"){super(e),this.name="UnknownHashAlgorithmError"}}class gB extends Error{static name="UnknownCodecError";constructor(e="Unknown codec"){super(e),this.name="UnknownCodecError"}}class gO extends cf{initialPeerSearchComplete;requests;name;log;logger;minProviders;maxProviders;providers;evictionFilter;constructor(e,t){super(),this.name=t.name,this.logger=e.logger,this.log=e.logger.forComponent(this.name),this.requests=new Map,this.minProviders=t.minProviders??gP,this.maxProviders=t.maxProviders??gR,this.providers=[],this.evictionFilter=l2(this.maxProviders)}async retrieve(e,t={}){let r=oN.base64.encode(e.multihash.bytes),n=this.requests.get(r);if(null!=n)return this.log("join existing request for %c",e),n;let i=(0,ao.A)();if(this.requests.set(r,i.promise),0===this.providers.length){let r=!1;null==this.initialPeerSearchComplete&&(r=!0,this.log=this.logger.forComponent(`${this.name}:${e}`),this.initialPeerSearchComplete=this.findProviders(e,this.minProviders,t)),await this.initialPeerSearchComplete,r&&this.log("found initial session peers for %c",e)}let s=!1,o=new cJ({concurrency:this.maxProviders});o.addEventListener("error",()=>{}),o.addEventListener("failure",e=>{this.log.error("error querying provider %o, evicting from session",e.detail.job.options.provider,e.detail.error),this.evict(e.detail.job.options.provider)}),o.addEventListener("success",e=>{s=!0,i.resolve(e.detail.result)}),o.addEventListener("idle",()=>{s||t.signal?.aborted===!0||Promise.resolve().then(async()=>{this.log("no session peers had block for for %c, finding new providers",e);for(let e=0;e<this.minProviders&&0!==this.providers.length;e++){let e=this.providers[Math.floor(Math.random()*this.providers.length)];this.evict(e)}await this.findProviders(e,this.minProviders,t),this.log("found new providers re-retrieving %c",e),this.requests.delete(r),i.resolve(await this.retrieve(e,t))}).catch(t=>{this.log.error("could not find new providers for %c",e,t),i.reject(t)})});let a=r=>{o.add(async()=>this.queryProvider(e,r.detail,t),{provider:r.detail}).catch(r=>{t.signal?.aborted!==!0&&this.log.error("error retrieving session block for %c",e,r)})};this.addEventListener("provider",a),Promise.all([...this.providers].map(async r=>o.add(async()=>this.queryProvider(e,r,t),{provider:r}))).catch(r=>{t.signal?.aborted!==!0&&this.log.error("error retrieving session block for %c",e,r)});try{return await i.promise}finally{this.removeEventListener("provider",a),o.clear(),this.requests.delete(r)}}evict(e){this.evictionFilter.add(this.toEvictionKey(e));let t=this.providers.findIndex(t=>this.equals(t,e));-1!==t&&this.providers.splice(t,1)}isEvicted(e){return this.evictionFilter.has(this.toEvictionKey(e))}hasProvider(e){return!!(null!=this.providers.find(t=>this.equals(t,e))||this.isEvicted(e))}async findProviders(e,t,r){let n=(0,ao.A)(),i=0;return Promise.resolve().then(async()=>{for await(let s of(this.log("finding %d-%d new provider(s) for %c",t,this.maxProviders,e),this.findNewProviders(e,r))){if(i===this.maxProviders||r.signal?.aborted===!0)break;if(!this.hasProvider(s)&&(this.log("found %d/%d new providers",i,this.maxProviders),this.providers.push(s),this.safeDispatchEvent("provider",{detail:s}),++i===t&&(this.log("session is ready"),n.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",i);break}}if(this.log("found %d/%d new session peers",i,this.maxProviders),i<t)throw new gD(`Found ${i} of ${t} ${this.name} providers for ${e}`)}).catch(t=>{this.log.error("error searching routing for potential session peers for %c",e,t.errors??t),n.reject(t)}),n.promise}}class gL extends gO{wantList;network;constructor(e,t){super(e,{...t,name:"helia:bitswap:session"}),this.wantList=e.wantList,this.network=e.network}async queryProvider(e,t,r){this.log("sending WANT-BLOCK for %c to %p",e,t);let n=await this.wantList.wantSessionBlock(e,t,r);if(this.log("%p %s %c",t,n.has?"has":"does not have",e),n.has&&null!=n.block)return n.block;throw Error("Provider did not have block")}async *findNewProviders(e,t={}){for await(let r of this.network.findProviders(e,t))yield r.id}toEvictionKey(e){return e.toMultihash().bytes}equals(e,t){return e.equals(t)}}function gF(e,t){return new gL(e,t)}class gU{blocksReceived;duplicateBlocksReceived;dataReceived;duplicateDataReceived;constructor(e){this.blocksReceived=e.metrics?.registerMetricGroup("helia_bitswap_received_blocks"),this.duplicateBlocksReceived=e.metrics?.registerMetricGroup("helia_bitswap_duplicate_received_blocks"),this.dataReceived=e.metrics?.registerMetricGroup("helia_bitswap_data_received_bytes"),this.duplicateDataReceived=e.metrics?.registerMetricGroup("helia_bitswap_duplicate_data_received_bytes")}updateBlocksReceived(e=1,t){let r={global:e};null!=t&&(r[t.toString()]=e),this.blocksReceived?.increment(r)}updateDuplicateBlocksReceived(e=1,t){let r={global:e};null!=t&&(r[t.toString()]=e),this.duplicateBlocksReceived?.increment(r)}updateDataReceived(e,t){let r={global:e};null!=t&&(r[t.toString()]=e),this.dataReceived?.increment(r)}updateDuplicateDataReceived(e,t){let r={global:e};null!=t&&(r[t.toString()]=e),this.duplicateDataReceived?.increment(r)}}class gj extends Map{metric;constructor(e){super();let{name:t,metrics:r}=e;this.metric=r.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){let t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function gH(e){let t,{name:r,metrics:n}=e;return null!=n?new gj({name:r,metrics:n}):new Map}let g$=function(e){if(!(e instanceof Uint8Array))throw Error("arg needs to be a Uint8Array");let t=[];for(;e.length>0;){let r=rt(e);t.push(r),e=e.slice(t5(r))}return t};class gq extends cf{peers;wants;network;log;sendMessagesDelay;sendMessagesTimeout;hashLoader;sendingMessages;constructor(e,t={}){super(),this.peers=gS({name:"helia_bitswap_peers",metrics:e.metrics}),this.wants=gH({name:"helia_bitswap_wantlist",metrics:e.metrics}),this.network=e.network,this.sendMessagesDelay=t.sendMessagesDelay??ua,this.log=e.logger.forComponent("helia:bitswap:wantlist"),this.hashLoader=t.hashLoader,this.network.addEventListener("bitswap:message",e=>{this.receiveMessage(e.detail.peer,e.detail.message).catch(t=>{this.log.error("error receiving bitswap message from %p",e.detail.peer,t)})}),this.network.addEventListener("peer:connected",e=>{this.peerConnected(e.detail).catch(t=>{this.log.error("error processing newly connected bitswap peer %p",e.detail,t)})}),this.network.addEventListener("peer:disconnected",e=>{this.peerDisconnected(e.detail)})}async addEntry(e,t){let r=(0,uC.d)(e.multihash.bytes,"base64"),n=this.wants.get(r);null==n&&(n={cid:e,priority:t.priority??1,wantType:t.wantType??c.WantBlock,cancel:!1,sendDontHave:!0},this.wants.set(r,n)),n.wantType===c.WantHave&&t.wantType===c.WantBlock&&(n.wantType=c.WantBlock),await this.sendMessagesDebounced();try{if(t.wantType===c.WantBlock)return(await cq(this,"block",t?.signal,{filter:t=>tc(e.multihash.digest,t.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail;return(await cq(this,"presence",t?.signal,{filter:t=>tc(e.multihash.digest,t.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail}finally{t.signal?.aborted===!0&&(this.log("want for %c was aborted, cancelling want",e),n.cancel=!0,await this.sendMessagesDebounced())}}async sendMessagesDebounced(){await this.sendingMessages?.promise,clearTimeout(this.sendMessagesTimeout),this.sendMessagesTimeout=setTimeout(()=>{this.sendMessages().catch(e=>{this.log("error sending messages to peers",e)})},this.sendMessagesDelay)}async sendMessages(){for(let[e,t]of(this.sendingMessages=(0,ao.A)(),await Promise.all([...this.peers.entries()].map(async([e,t])=>{let r=new Set,n=new gk;for(let[e,i]of this.wants.entries())t.has(e)||i.cancel||(r.add(e),n.addWantlistEntry(i.cid,{cid:i.cid.bytes,priority:i.priority,wantType:i.wantType,cancel:i.cancel,sendDontHave:i.sendDontHave}));if(0!==n.wantlist.size)try{for(let i of(await this.network.sendMessage(e,n),r))t.add(i)}catch(e){this.log.error("error sending full wantlist to new peer",e)}})).catch(e=>{this.log.error("error sending messages",e)}),this.wants))if(t.cancel)for(let t of(this.wants.delete(e),this.peers.values()))t.delete(e);this.sendingMessages.resolve()}has(e){let t=(0,uC.d)(e.multihash.bytes,"base64");return this.wants.has(t)}async wantSessionPresence(e,t,r={}){let n=new gk;return n.addWantlistEntry(e,{cid:e.bytes,sendDontHave:!0,wantType:c.WantHave,priority:1}),await this.network.sendMessage(t,n),(await cq(this,"presence",r.signal,{filter:r=>t.equals(r.detail.sender)&&tc(e.multihash.digest,r.detail.cid.multihash.digest)})).detail}async wantBlock(e,t={}){return this.addEntry(e,{...t,wantType:c.WantBlock})}async wantSessionBlock(e,t,r={}){let n=new gk;return n.addWantlistEntry(e,{cid:e.bytes,sendDontHave:!0,wantType:c.WantBlock,priority:1}),await this.network.sendMessage(t,n),(await cq(this,"presence",r.signal,{filter:r=>t.equals(r.detail.sender)&&tc(e.multihash.digest,r.detail.cid.multihash.digest)})).detail}async receivedBlock(e,t){let r=(0,uC.d)(e.multihash.bytes,"base64"),n=this.wants.get(r);null!=n&&(n.cancel=!0,await this.sendMessagesDebounced())}async receiveMessage(e,t){this.log("received message from %p with %d blocks",e,t.blocks.length);let r=!1;for(let n of t.blocks){if(null==n.prefix||null==n.data)continue;let t=g$(n.prefix),i=t[0],s=t[1],o=t[2],a=o===rX.sha256.code?rX.sha256:await this.hashLoader?.getHasher(o);if(null==a){this.log.error("unknown hash algorithm",o);continue}let l=a.digest(n.data);null!=l.then&&(l=await l);let c=tm.TO.create(+(0!==i),s,l);this.log("received block from %p for %c",e,c),this.safeDispatchEvent("block",{detail:{sender:e,cid:c,block:n.data}}),this.safeDispatchEvent("presence",{detail:{sender:e,cid:c,has:!0,block:n.data}});let u=(0,uC.d)(c.multihash.bytes,"base64"),d=this.wants.get(u);null!=d&&(d.cancel=!0,r=!0)}for(let{cid:r,type:n}of t.blockPresences){let t=tm.TO.decode(r);this.log("received %s from %p for %c",n,e,t),this.safeDispatchEvent("presence",{detail:{sender:e,cid:t,has:n===p.HaveBlock}})}r&&await this.sendMessagesDebounced()}async peerConnected(e){let t=new Set,r=new gk(!0);for(let[e,n]of this.wants.entries())n.cancel||(t.add(e),r.addWantlistEntry(n.cid,{cid:n.cid.bytes,priority:1,wantType:c.WantBlock,cancel:!1,sendDontHave:!1}));if(0===r.wantlist.size)return void this.peers.set(e,t);try{await this.network.sendMessage(e,r),this.peers.set(e,t)}catch(t){this.log.error("error sending full wantlist to new peer %p",e,t)}}peerDisconnected(e){this.peers.delete(e)}start(){}stop(){this.peers.clear(),clearTimeout(this.sendMessagesTimeout)}}class gz{log;logger;stats;network;blockstore;peerWantLists;wantList;constructor(e,t={}){this.logger=e.logger,this.log=e.logger.forComponent("helia:bitswap"),this.blockstore=e.blockstore,this.stats=new gU(e),this.network=new uA(e,t),this.peerWantLists=new gC({...e,network:this.network},t),this.wantList=new gq({...e,network:this.network},t)}createSession(e={}){return gF({wantList:this.wantList,network:this.network,logger:this.logger},e)}async want(e,t={}){let r=new AbortController,n=ch([r.signal,t.signal]);r.signal,this.network.findAndConnect(e,{...t,signal:n}).catch(t=>{r.signal.aborted||this.log.error("error during finding and connect for cid %c",e,t)});try{return(await this.wantList.wantBlock(e,{...t,signal:n})).block}finally{r.abort(),n.clear()}}async notify(e,t,r={}){await Promise.all([this.peerWantLists.receivedBlock(e,r),this.wantList.receivedBlock(e,r)])}getWantlist(){return[...this.wantList.wants.values()].filter(e=>!e.cancel).map(e=>({cid:e.cid,priority:e.priority,wantType:e.wantType}))}getPeerWantlist(e){return this.peerWantLists.wantListForPeer(e)}async start(){this.wantList.start(),await this.network.start()}async stop(){this.wantList.stop(),await this.network.stop()}}let gV=(e,t={})=>new gz(e,t);class gG{bitswap;started;constructor(e,t={}){let{getHasher:r}=e;this.bitswap=gV(e,{hashLoader:{getHasher:async e=>r(e)},...t}),this.started=!1}isStarted(){return this.started}async start(){await this.bitswap.start(),this.started=!0}async stop(){await this.bitswap.stop(),this.started=!1}async announce(e,t,r){await this.bitswap.notify(e,t,r)}async retrieve(e,t={}){return this.bitswap.want(e,t)}createSession(e){let t=this.bitswap.createSession(e);return{announce:async(e,t,r)=>{await this.bitswap.notify(e,t,r)},retrieve:async(e,r)=>t.retrieve(e,r)}}}function gK(e={}){return t=>new gG(t,e)}class gW{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){let t=this.index,r=e();return void 0===r&&(this.index=t),r}parseWith(e){let t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{let t=this.readChar();if(t===e)return t})}readSeparator(e,t,r){return this.readAtomically(()=>{if(!(t>0)||void 0!==this.readGivenChar(e))return r()})}readNumber(e,t,r,n){return this.readAtomically(()=>{let i=0,s=0,o=this.peekChar();if(void 0===o)return;let a="0"===o,l=2**(8*n)-1;for(;;){let r=this.readAtomically(()=>{let t=this.readChar();if(void 0===t)return;let r=Number.parseInt(t,e);if(!Number.isNaN(r))return r});if(void 0===r)break;if(i*=e,(i+=r)>l||(s+=1,void 0!==t&&s>t))return}return 0===s||!r&&a&&s>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{let e=new Uint8Array(4);for(let t=0;t<e.length;t++){let r=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(void 0===r)return;e[t]=r}return e})}readIPv6Addr(){let e=e=>{for(let t=0;t<e.length/2;t++){let r=2*t;if(t<e.length-3){let n=this.readSeparator(":",t,()=>this.readIPv4Addr());if(void 0!==n)return e[r]=n[0],e[r+1]=n[1],e[r+2]=n[2],e[r+3]=n[3],[r+4,!0]}let n=this.readSeparator(":",t,()=>this.readNumber(16,4,!0,2));if(void 0===n)return[r,!1];e[r]=n>>8,e[r+1]=255&n}return[e.length,!1]};return this.readAtomically(()=>{let t=new Uint8Array(16),[r,n]=e(t);if(16===r)return t;if(n||void 0===this.readGivenChar(":")||void 0===this.readGivenChar(":"))return;let i=new Uint8Array(14),s=16-(r+2),[o]=e(i.subarray(0,s));return t.set(i.subarray(0,o),16-o),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}let gQ=45,gJ=15,gZ=new gW;function gY(e){if(!(e.length>gJ))return gZ.new(e).parseWith(()=>gZ.readIPv4Addr())}function gX(e){if(e.includes("%")&&(e=e.split("%")[0]),!(e.length>gQ))return gZ.new(e).parseWith(()=>gZ.readIPv6Addr())}function g0(e,t=!1){if(e.includes("%")&&(e=e.split("%")[0]),e.length>gQ)return;let r=gZ.new(e).parseWith(()=>gZ.readIPAddr());if(r)return t&&4===r.length?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,r[0],r[1],r[2],r[3]]):r}function g1(e){return!!gY(e)}function g2(e){return!!gX(e)}function g3(e){return!!g0(e)}var g4=r(73002);let g5=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"].map(e=>new g4.Netmask(e));function g6(e){for(let t of g5)if(t.contains(e))return!0;return!1}function g8(e){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(e)}function g7(e){let t=e.split(":");if(t.length<2)return!1;let r=t[t.length-1].padStart(4,"0"),n=t[t.length-2].padStart(4,"0");return g6(`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(r.substring(0,2),16)}.${parseInt(r.substring(2),16)}`)}function g9(e){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)}function me(e){let t=e.split(":");return g6(t[t.length-1])}function mt(e){return/^::$/.test(e)||/^::1$/.test(e)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(e)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(e)||/^ff([0-9a-fA-F]{2,2}):/i.test(e)}function mr(e){return g1(e)?g6(e):g8(e)?g7(e):g9(e)?me(e):g2(e)?mt(e):void 0}let mn=e=>e.toString().split("/").slice(1),mi=e=>({match:t=>!(t.length<1)&&!!e(t[0])&&t.slice(1),pattern:"fn"}),ms=e=>({match:t=>mi(t=>t===e).match(t),pattern:e}),mo=()=>({match:e=>mi(e=>"string"==typeof e).match(e),pattern:"{string}"}),ma=()=>({match:e=>mi(e=>!isNaN(parseInt(e))).match(e),pattern:"{number}"}),ml=()=>({match:e=>{if(e.length<2||"p2p"!==e[0]&&"ipfs"!==e[0]||!(e[1].startsWith("Q")||e[1].startsWith("1")))return!1;try{uW.base58btc.decode(`z${e[1]}`)}catch(e){return!1}return e.slice(2)},pattern:"/p2p/{peerid}"}),mc=()=>({match:e=>{if(e.length<2||"certhash"!==e[0])return!1;try{oN.base64url.decode(e[1])}catch{return!1}return e.slice(2)},pattern:"/certhash/{certhash}"}),mu=e=>({match:t=>{let r=e.match(t);return!1===r?t:r},pattern:`optional(${e.pattern})`}),md=(...e)=>({match:t=>{let r;for(let n of e){let e=n.match(t);!1!==e&&(null==r||e.length<r.length)&&(r=e)}return null!=r&&r},pattern:`or(${e.map(e=>e.pattern).join(", ")})`}),mh=(...e)=>({match:t=>{for(let r of e){let e=r.match(t);if(!1===e)return!1;t=e}return t},pattern:`and(${e.map(e=>e.pattern).join(", ")})`});function mf(...e){function t(t){let r=mn(t);for(let t of e){let e=t.match(r);if(!1===e)return!1;r=e}return r}return{matchers:e,matches:function(e){return!1!==t(e)},exactMatch:function(e){let r=t(e);return!1!==r&&0===r.length}}}mf(ml());let mp=mh(ms("dns4"),mo()),mg=mh(ms("dns6"),mo()),mm=mh(ms("dnsaddr"),mo()),my=mh(ms("dns"),mo());mf(mp,mu(ml())),mf(mg,mu(ml())),mf(mm,mu(ml()));let mb=mf(md(my,mm,mp,mg),mu(ml())),mw=mh(ms("ip4"),mi(g1)),mv=mh(ms("ip6"),mi(g2)),mE=md(mw,mv),mA=md(mE,my,mp,mg,mm),mx=mf(md(mE,mh(md(my,mm,mp,mg),mu(ml())))),mS=mf(mw),mk=mf(mv),m_=mf(mE),mI=mh(mA,ms("tcp"),ma()),mT=mh(mA,ms("udp"),ma()),mC=mf(mh(mI,mu(ml())));mf(mT);let mP=mh(mT,ms("quic"),mu(ml())),mR=mh(mT,ms("quic-v1"),mu(ml())),mD=md(mP,mR);mf(mP);let mN=mf(mR),mM=md(mA,mI,mT,mP,mR),mB=md(mh(mM,ms("ws"),mu(ml()))),mO=mf(mB),mL=md(mh(mM,ms("wss"),mu(ml())),mh(mM,ms("tls"),mu(mh(ms("sni"),mo())),ms("ws"),mu(ml()))),mF=mf(mL),mU=mh(mT,ms("webrtc-direct"),mu(mc()),mu(mc()),mu(ml())),mj=mf(mU),mH=mh(mR,ms("webtransport"),mu(mc()),mu(mc()),mu(ml())),m$=mf(mH),mq=md(mB,mL,mh(mI,mu(ml())),mh(mD,mu(ml())),mh(mA,mu(ml())),mU,mH,ml()),mz=mf(mq),mV=mf(mh(mq,ms("p2p-circuit"),ml())),mG=mf(md(mh(mq,ms("p2p-circuit"),ms("webrtc"),mu(ml())),mh(mq,ms("webrtc"),mu(ml())),mh(ms("webrtc"),mu(ml())))),mK=mf(md(mh(mA,ms("tcp"),ma(),ms("http"),mu(ml())),mh(mA,ms("http"),mu(ml())))),mW=mf(md(mh(mA,ms("tcp"),md(mh(ms("443"),ms("http")),mh(ma(),ms("https"))),mu(ml())),mh(mA,ms("tls"),ms("http"),mu(ml())),mh(mA,ms("https"),mu(ml()))));function mQ(e,t,r){let n=0;for(let i of e)if(!(n<t)){if(n>r)break;if(255!==i)return!1;n++}return!0}function mJ(e,t,r,n){let i=0;for(let s of e)if(!(i<r)){if(i>n)break;if(s!==t[i])return!1;i++}return!0}function mZ(e){switch(e.length){case m0:return e.join(".");case m1:{let t=[];for(let r=0;r<e.length;r++)r%2==0&&t.push(e[r].toString(16).padStart(2,"0")+e[r+1].toString(16).padStart(2,"0"));return t.join(":")}default:throw Error("Invalid ip length")}}function mY(e){let t=0;for(let[r,n]of e.entries()){if(255===n){t+=8;continue}for(;(128&n)!=0;)t++,n<<=1;if((128&n)!=0)return -1;for(let t=r+1;t<e.length;t++)if(0!=e[t])return -1;break}return t}function mX(e){let t="0x";for(let r of e)t+=(r>>4).toString(16)+(15&r).toString(16);return t}mf(md(mh(ms("memory"),mo(),mu(ml()))));let m0=4,m1=16;parseInt("0xFFFF",16);let m2=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function m3(e,t){t.length===m1&&e.length===m0&&mQ(t,0,11)&&(t=t.slice(12)),t.length===m0&&e.length===m1&&mJ(e,m2,0,11)&&(e=e.slice(12));let r=e.length;if(r!=t.length)throw Error("Failed to mask ip");let n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=e[i]&t[i];return n}function m4(e,t){if("string"==typeof t&&(t=g0(t)),null==t)throw Error("Invalid ip");if(t.length!==e.network.length)return!1;for(let r=0;r<t.length;r++)if((e.network[r]&e.mask[r])!=(t[r]&e.mask[r]))return!1;return!0}function m5(e){let[t,r]=e.split("/");if(!t||!r)throw Error("Failed to parse given CIDR: "+e);let n=m0,i=gY(t);if(null==i&&(n=m1,null==(i=gX(t))))throw Error("Failed to parse given CIDR: "+e);let s=parseInt(r,10);if(Number.isNaN(s)||String(s).length!==r.length||s<0||s>8*n)throw Error("Failed to parse given CIDR: "+e);let o=m6(s,8*n);return{network:m3(i,o),mask:o}}function m6(e,t){if(t!==8*m0&&t!==8*m1||e<0||e>t)throw Error("Invalid CIDR mask");let r=t/8,n=new Uint8Array(r);for(let t=0;t<r;t++){if(e>=8){n[t]=255,e-=8;continue}n[t]=255-(255>>e),e=0}return n}class m8{constructor(e,t){if(null==t)({network:this.network,mask:this.mask}=m5(e));else{let r=g0(e);if(null==r)throw Error("Failed to parse network");let n=parseInt(t=String(t),10);if(Number.isNaN(n)||String(n).length!==t.length||n<0||n>8*r.length){let e=g0(t);if(null==e)throw Error("Failed to parse mask");this.mask=e}else this.mask=m6(n,8*r.length);this.network=m3(r,this.mask)}}contains(e){return m4({network:this.network,mask:this.mask},e)}toString(){let e=mY(this.mask),t=-1!==e?String(e):mX(this.mask);return mZ(this.network)+"/"+t}}function m7(e,t){return new m8(e).contains(t)}var m9=r(43716),ye=r(69600);let yt=g1,yr=g2,yn=function(e){let t=0;if(yt(e=e.toString().trim())){let r=new Uint8Array(t+4);return e.split(/\./g).forEach(e=>{r[t++]=255&parseInt(e,10)}),r}if(yr(e)){let r,n=e.split(":",8);for(r=0;r<n.length;r++){let e;yt(n[r])&&(e=yn(n[r]),n[r]=(0,uC.d)(e.slice(0,2),"base16")),null!=e&&++r<8&&n.splice(r,0,(0,uC.d)(e.slice(2,4),"base16"))}if(""===n[0])for(;n.length<8;)n.unshift("0");else if(""===n[n.length-1])for(;n.length<8;)n.push("0");else if(n.length<8){for(r=0;r<n.length&&""!==n[r];r++);let e=[r,1];for(r=9-n.length;r>0;r--)e.push("0");n.splice.apply(n,e)}let i=new Uint8Array(t+16);for(r=0;r<n.length;r++){let e=parseInt(n[r],16);i[t++]=e>>8&255,i[t++]=255&e}return i}throw Error("invalid ip address")},yi=function(e,t=0,r){t=~~t,r=r??e.length-t;let n=new DataView(e.buffer);if(4===r){let n=[];for(let i=0;i<r;i++)n.push(e[t+i]);return n.join(".")}if(16===r){let e=[];for(let i=0;i<r;i+=2)e.push(n.getUint16(t+i).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},ys={},yo={};function ya(e,t,r,n,i){return{code:e,size:t,name:r,resolvable:!!n,path:!!i}}function yl(e){if("number"==typeof e){if(null!=yo[e])return yo[e];throw Error(`no protocol with code: ${e}`)}if("string"==typeof e){if(null!=ys[e])return ys[e];throw Error(`no protocol with name: ${e}`)}throw Error(`invalid protocol id type: ${typeof e}`)}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,-1,"http-path"],[777,-1,"memory"]].forEach(e=>{let t=ya(...e);yo[t.code]=t,ys[t.name]=t});let yc=yl("ip4"),yu=yl("ip6"),yd=yl("ipcidr");function yh(e,t){switch(yl(e).code){case 4:case 41:return yb(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return yA(t);case 43:return(0,uC.d)(t,"base10");case 6:case 273:case 33:case 132:return yv(t).toString();case 421:return y_(t);case 444:case 445:return yC(t);case 466:return yk(t);case 481:return globalThis.encodeURIComponent(yA(t));default:return(0,uC.d)(t,"base16")}}function yf(e,t){switch(yl(e).code){case 4:case 41:return yy(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return yE(t);case 43:return(0,rx.s)(t,"base10");case 6:case 273:case 33:case 132:return yw(parseInt(t,10));case 421:return yx(t);case 444:return yI(t);case 445:return yT(t);case 466:return yS(t);case 481:return yE(globalThis.decodeURIComponent(t));default:return(0,rx.s)(t,"base16")}}function yp(e){let t,r;if(e.stringTuples().forEach(([e,n])=>{(e===yc.code||e===yu.code)&&(r=n),e===yd.code&&(t=n)}),null==t||null==r)throw Error("Invalid multiaddr");return new m8(r,t)}let yg=Object.values(ye.Fo).map(e=>e.decoder),ym=function(){let e=yg[0].or(yg[1]);return yg.slice(2).forEach(t=>e=e.or(t)),e}();function yy(e){if(!g3(e))throw Error("invalid ip address");return yn(e)}function yb(e){let t=yi(e,0,e.length);if(null==t)throw Error("ipBuff is required");if(!g3(t))throw Error("invalid ip address");return t}function yw(e){let t=new ArrayBuffer(2);return new DataView(t).setUint16(0,e),new Uint8Array(t)}function yv(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function yE(e){let t=(0,rx.s)(e),r=Uint8Array.from(re(t.length));return tl([r,t],r.length+t.length)}function yA(e){let t=rt(e);if((e=e.slice(t5(t))).length!==t)throw Error("inconsistent lengths");return(0,uC.d)(e)}function yx(e){let t;t="Q"===e[0]||"1"===e[0]?o0.decode(uW.base58btc.decode(`z${e}`)).bytes:tm.TO.parse(e).multihash.bytes;let r=Uint8Array.from(re(t.length));return tl([r,t],r.length+t.length)}function yS(e){let t=ym.decode(e),r=Uint8Array.from(re(t.length));return tl([r,t],r.length+t.length)}function yk(e){let t=rt(e),r=e.slice(t5(t));if(r.length!==t)throw Error("inconsistent lengths");return"u"+(0,uC.d)(r,"base64url")}function y_(e){let t=rt(e),r=e.slice(t5(t));if(r.length!==t)throw Error("inconsistent lengths");return(0,uC.d)(r,"base58btc")}function yI(e){let t=e.split(":");if(2!==t.length)throw Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(16!==t[0].length)throw Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);let r=m9.base32.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw Error("Port number is not in range(1, 65536)");let i=yw(n);return tl([r,i],r.length+i.length)}function yT(e){let t=e.split(":");if(2!==t.length)throw Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(56!==t[0].length)throw Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);let r=m9.base32.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw Error("Port number is not in range(1, 65536)");let i=yw(n);return tl([r,i],r.length+i.length)}function yC(e){let t=e.slice(0,e.length-2),r=e.slice(e.length-2),n=(0,uC.d)(t,"base32"),i=yv(r);return`${n}:${i}`}function yP(e){e=yB(e);let t=[],r=[],n=null,i=e.split("/").slice(1);if(1===i.length&&""===i[0])return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let s=0;s<i.length;s++){let o=yl(i[s]);if(0===o.size){t.push([o.code]),r.push([o.code]);continue}if(++s>=i.length)throw new yO("invalid address: "+e);if(!0===o.path){n=yB(i.slice(s).join("/")),t.push([o.code,yf(o.code,n)]),r.push([o.code,n]);break}let a=yf(o.code,i[s]);t.push([o.code,a]),r.push([o.code,yh(o.code,a)])}return{string:yD(r),bytes:yN(t),tuples:t,stringTuples:r,path:n}}function yR(e){let t=[],r=[],n=null,i=0;for(;i<e.length;){let s=rt(e,i),o=t5(s),a=yl(s),l=yM(a,e.slice(i+o));if(0===l){t.push([s]),r.push([s]),i+=o;continue}let c=e.slice(i+o,i+o+l);if((i+=l+o)>e.length)throw new yO("Invalid address Uint8Array: "+(0,uC.d)(e,"base16"));t.push([s,c]);let u=yh(s,c);if(r.push([s,u]),!0===a.path){n=u;break}}return{bytes:Uint8Array.from(e),string:yD(r),tuples:t,stringTuples:r,path:n}}function yD(e){let t=[];return e.map(e=>{let r=yl(e[0]);return t.push(r.name),e.length>1&&null!=e[1]&&t.push(e[1]),null}),yB(t.join("/"))}function yN(e){return tl(e.map(e=>{let t=yl(e[0]),r=Uint8Array.from(re(t.code));return e.length>1&&null!=e[1]&&(r=tl([r,e[1]])),r}))}function yM(e,t){if(e.size>0)return e.size/8;{if(0===e.size)return 0;let r=rt(t instanceof Uint8Array?t:Uint8Array.from(t));return r+t5(r)}}function yB(e){return"/"+e.trim().split("/").filter(e=>e).join("/")}class yO extends Error{static name="ParseError";name="ParseError";constructor(e){super(`Error parsing address: ${e}`)}}let yL=Symbol.for("nodejs.util.inspect.custom"),yF=Symbol.for("@multiformats/js-multiaddr/multiaddr"),yU=[yl("dns").code,yl("dns4").code,yl("dns6").code,yl("dnsaddr").code];class yj extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}}class yH{bytes;#P;#R;#D;#N;[yF]=!0;constructor(e){let t;if(null==e&&(e=""),e instanceof Uint8Array)t=yR(e);else if("string"==typeof e){if(e.length>0&&"/"!==e.charAt(0))throw Error(`multiaddr "${e}" must start with a "/"`);t=yP(e)}else if(yq(e))t=yR(e.bytes);else throw Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,this.#P=t.string,this.#R=t.tuples,this.#D=t.stringTuples,this.#N=t.path}toString(){return this.#P}toJSON(){return this.toString()}toOptions(){let e,t,r,n,i="",s=yl("tcp"),o=yl("udp"),a=yl("ip4"),l=yl("ip6"),c=yl("dns6"),u=yl("ip6zone");for(let[d,h]of this.stringTuples())d===u.code&&(i=`%${h??""}`),yU.includes(d)&&(t="tcp"===s.name?"tcp":"udp",n=443,r=`${h??""}${i}`,e=d===c.code?6:4),(d===s.code||d===o.code)&&(t="tcp"===yl(d).name?"tcp":"udp",n=parseInt(h??"")),(d===a.code||d===l.code)&&(t="tcp"===yl(d).name?"tcp":"udp",r=`${h??""}${i}`,e=d===l.code?6:4);if(null==e||null==t||null==r||null==n)throw Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:r,transport:t,port:n}}protos(){return this.#R.map(([e])=>Object.assign({},yl(e)))}protoCodes(){return this.#R.map(([e])=>e)}protoNames(){return this.#R.map(([e])=>yl(e).name)}tuples(){return this.#R.map(([e,t])=>null==t?[e]:[e,t])}stringTuples(){return this.#D.map(([e,t])=>null==t?[e]:[e,t])}encapsulate(e){return e=new yH(e),new yH(this.toString()+e.toString())}decapsulate(e){let t=e.toString(),r=this.toString(),n=r.lastIndexOf(t);if(n<0)throw Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new yH(r.slice(0,n))}decapsulateCode(e){let t=this.tuples();for(let r=t.length-1;r>=0;r--)if(t[r][0]===e)return new yH(yN(t.slice(0,r)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([t,r])=>{t===ys.p2p.code&&e.push([t,r]),t===ys["p2p-circuit"].code&&(e=[])});let t=e.pop();if(t?.[1]!=null){let e=t[1];if("Q"===e[0]||"1"===e[0])return(0,uC.d)(uW.base58btc.decode(`z${e}`),"base58btc");return(0,uC.d)(tm.TO.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){return this.#N}equals(e){return tc(this.bytes,e.bytes)}async resolve(e){let t=this.protos().find(e=>e.resolvable);if(null==t)return[this];let r=y$.get(t.name);if(null==r)throw new yj(`no available resolver for ${t.name}`);return(await r(this,e)).map(e=>yz(e))}nodeAddress(){let e=this.toOptions();if("tcp"!==e.transport&&"udp"!==e.transport)throw Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){let t=(e??this).protos();return 2===t.length&&(4===t[0].code||41===t[0].code)&&(6===t[1].code||273===t[1].code)}[yL](){return`Multiaddr(${this.#P})`}}let y$=new Map;function yq(e){return!!e?.[yF]}function yz(e){return new yH(e)}let yV=[yl("tcp").code,yl("dns").code,yl("dnsaddr").code,yl("dns4").code,yl("dns6").code];function yG(e){return yW("sni",e)?.[1]}function yK(e){let t=yW("tcp",e)?.[1];return null==t?"":`:${t}`}function yW(e,t){let r;try{r=yl(e).code}catch(e){return}for(let[e,n]of t)if(e===r&&null!=n)return[e,n]}function yQ(e){return e.some(([e,t])=>e===yl("tls").code)}function yJ(e,t,r){let n=yZ[yl(e).name];if(null==n)throw Error(`Can't interpret protocol ${yl(e).name}`);let i=n(t,r);return e===yl("ip6").code?`[${i}]`:i}let yZ={ip4:(e,t)=>e,ip6:(e,t)=>0===t.length?e:`[${e}]`,tcp:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return`tcp://${yJ(r[0],r[1]??"",t)}:${e}`},udp:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return`udp://${yJ(r[0],r[1]??"",t)}:${e}`},dnsaddr:(e,t)=>e,dns4:(e,t)=>e,dns6:(e,t)=>e,dns:(e,t)=>e,ipfs:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return`${yJ(r[0],r[1]??"",t)}`},p2p:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return`${yJ(r[0],r[1]??"",t)}`},http:(e,t)=>{let r=yQ(t),n=yG(t),i=yK(t);if(r&&null!=n)return`https://${n}${i}`;let s=r?"https://":"http://",o=t.pop();if(null==o)throw Error("Unexpected end of multiaddr");let a=yJ(o[0],o[1]??"",t);return a=a.replace("tcp://",""),`${s}${a}`},"http-path":(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");let n=yJ(r[0],r[1]??"",t),i=decodeURIComponent(e);return`${n}/${i}`},tls:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return yJ(r[0],r[1]??"",t)},sni:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return yJ(r[0],r[1]??"",t)},https:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");let n=yJ(r[0],r[1]??"",t);return n=n.replace("tcp://",""),`https://${n}`},ws:(e,t)=>{let r=yQ(t),n=yG(t),i=yK(t);if(r&&null!=n)return`wss://${n}${i}`;let s=r?"wss://":"ws://",o=t.pop();if(null==o)throw Error("Unexpected end of multiaddr");let a=yJ(o[0],o[1]??"",t);return a=a.replace("tcp://",""),`${s}${a}`},wss:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");let n=yJ(r[0],r[1]??"",t);return n=n.replace("tcp://",""),`wss://${n}`}};function yY(e,t){let r=yz(e).stringTuples(),n=r.pop();if(null==n)throw Error("Unexpected end of multiaddr");let i=yl(n[0]),s=yZ[i.name];if(null==s)throw Error(`No interpreter found for ${i.name}`);let o=s(n[1]??"",r);return t?.assumeHttp!==!1&&yV.includes(n[0])&&(o=o.replace(/^.*:\/\//,""),o="443"===n[1]?`https://${o}`:`http://${o}`),(o.startsWith("http://")||o.startsWith("https://")||o.startsWith("ws://")||o.startsWith("wss://"))&&(o=new URL(o).toString()).endsWith("/")&&(o=o.substring(0,o.length-1)),o}class yX{url;#M=0;#B=0;#O=0;#L=0;#F=new Map;log;transformRequestInit;constructor(e,{logger:t,transformRequestInit:r}){this.url=e instanceof URL?e:new URL(e),this.transformRequestInit=r,this.log=t.forComponent(`helia:trustless-gateway-block-broker:${this.url.hostname}`)}#U(e){let t=e.multihash.bytes;return oN.base64.encode(t)}async getRawBlock(e,t){let r=new URL(this.url.toString());if(r.pathname=`/ipfs/${e.toString()}`,r.search="?format=raw",t?.aborted===!0)throw Error(`Signal to fetch raw block for CID ${e} from gateway ${this.url} was aborted prior to fetch`);let n=this.#U(e),i=new AbortController,s=()=>{i.abort()};t?.addEventListener("abort",s);try{let t=this.#F.get(n);if(null==t){this.#M++;let s={signal:i.signal,headers:{Accept:"application/vnd.ipld.raw"},cache:"force-cache"},o=null!=this.transformRequestInit?await this.transformRequestInit(s):s;t=fetch(r.toString(),o).then(async t=>{if(this.log("GET %s %d",r,t.status),!t.ok)throw this.#B++,Error(`unable to fetch raw block for CID ${e} from gateway ${this.url}`);return this.#L++,new Uint8Array(await t.arrayBuffer())}),this.#F.set(n,t)}return await t}catch(r){if(t?.aborted===!0)throw Error(`fetching raw block for CID ${e} from gateway ${this.url} was aborted`);throw this.#B++,Error(`unable to fetch raw block for CID ${e}`)}finally{t?.removeEventListener("abort",s),this.#F.delete(n)}}reliability(){return 0===this.#M?1:this.#O>0?-1/0:this.#L/(this.#M+3*this.#B)}incrementInvalidBlocks(){this.#O++}getStats(){return{attempts:this.#M,errors:this.#B,invalidBlocks:this.#O,successes:this.#L,pendingResponses:this.#F.size}}}function y0(e,t,r){return e.filter(e=>{if(mW.matches(e)||t&&mK.matches(e))return!!(r||mb.matches(e))||!1===mr(e.toOptions().host);if(!t&&r){let{host:t}=e.toOptions();if("127.0.0.1"===t||"localhost"===t||t.endsWith(".localhost"))return!0}return!1})}async function*y1(e,t,r,n,i,s={}){for await(let o of t.findProviders(e,s)){let e=y0(o.multiaddrs,n,i);if(0===e.length)continue;let t=yY(e[0]);yield new yX(t,{logger:r,transformRequestInit:s.transformRequestInit})}}class y2 extends gO{routing;allowInsecure;allowLocal;transformRequestInit;constructor(e,t){super(e,{...t,name:"helia:trustless-gateway:session"}),this.routing=e.routing,this.allowInsecure=t.allowInsecure??y5,this.allowLocal=t.allowLocal??y6,this.transformRequestInit=t.transformRequestInit}async queryProvider(e,t,r){this.log("fetching BLOCK for %c from %s",e,t.url);let n=await t.getRawBlock(e,r.signal);return this.log.trace("got block for %c from %s",e,t.url),await r.validateFn?.(n),n}async *findNewProviders(e,t={}){yield*y1(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...t,transformRequestInit:this.transformRequestInit})}toEvictionKey(e){return e.url.toString()}equals(e,t){return e.url.toString()===t.url.toString()}}function y3(e,t){return new y2(e,t)}class y4{allowInsecure;allowLocal;transformRequestInit;routing;log;logger;constructor(e,t={}){this.log=e.logger.forComponent("helia:trustless-gateway-block-broker"),this.logger=e.logger,this.routing=e.routing,this.allowInsecure=t.allowInsecure??y5,this.allowLocal=t.allowLocal??y6,this.transformRequestInit=t.transformRequestInit}async retrieve(e,t={}){let r=[];for await(let n of y1(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...t,transformRequestInit:this.transformRequestInit})){this.log("getting block for %c from %s",e,n.url);try{let r=await n.getRawBlock(e,t.signal);this.log.trace("got block for %c from %s",e,n.url);try{await t.validateFn?.(r)}catch(t){this.log.error("failed to validate block for %c from %s",e,n.url,t);continue}return r}catch(i){if(this.log.error("failed to get block for %c from %s",e,n.url,i),i instanceof Error?r.push(i):r.push(Error(`Unable to fetch raw block for CID ${e} from gateway ${n.url}`)),t.signal?.aborted===!0){this.log.trace("request aborted while fetching raw block for CID %c from gateway %s",e,n.url);break}}}if(r.length>0)throw AggregateError(r,`Unable to fetch raw block for CID ${e} from any gateway`);throw Error(`Unable to fetch raw block for CID ${e} from any gateway`)}createSession(e={}){return y3({logger:this.logger,routing:this.routing},{...e,allowLocal:this.allowLocal,allowInsecure:this.allowInsecure,transformRequestInit:this.transformRequestInit})}}let y5=!1,y6=!1;function y8(e={}){return t=>new y4(t,e)}class y7{libp2p;constructor(e){this.libp2p=e}async provide(e,t){await this.libp2p.contentRouting.provide(e,t)}async cancelReprovide(e,t){await this.libp2p.contentRouting.cancelReprovide(e,t)}async *findProviders(e,t){yield*this.libp2p.contentRouting.findProviders(e,t)}async put(e,t,r){await this.libp2p.contentRouting.put(e,t,r)}async get(e,t){return this.libp2p.contentRouting.get(e,t)}async findPeer(e,t){return this.libp2p.peerRouting.findPeer(e,t)}async *getClosestPeers(e,t){yield*this.libp2p.peerRouting.getClosestPeers(e,t)}}function y9(e){return new y7(e)}let be="[a-fA-F\\d:]",bt=e=>e&&e.includeBoundaries?`(?:(?<=\\s|^)(?=${be})|(?<=${be})(?=\\s|$))`:"",br="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",bn="[a-fA-F\\d]{1,4}",bi=`
(?:
(?:${bn}:){7}(?:${bn}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${bn}:){6}(?:${br}|:${bn}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${bn}:){5}(?::${br}|(?::${bn}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${bn}:){4}(?:(?::${bn}){0,1}:${br}|(?::${bn}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${bn}:){3}(?:(?::${bn}){0,2}:${br}|(?::${bn}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${bn}:){2}(?:(?::${bn}){0,3}:${br}|(?::${bn}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${bn}:){1}(?:(?::${bn}){0,4}:${br}|(?::${bn}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${bn}){0,5}:${br}|(?::${bn}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),bs=RegExp(`(?:^${br}$)|(?:^${bi}$)`),bo=RegExp(`^${br}$`),ba=RegExp(`^${bi}$`),bl=e=>e&&e.exact?bs:RegExp(`(?:${bt(e)}${br}${bt(e)})|(?:${bt(e)}${bi}${bt(e)})`,"g");bl.v4=e=>e&&e.exact?bo:RegExp(`${bt(e)}${br}${bt(e)}`,"g"),bl.v6=e=>e&&e.exact?ba:RegExp(`${bt(e)}${bi}${bt(e)}`,"g");let bc=bl;function bu(e){let t=(...t)=>e(...t);return Object.defineProperty(t,"name",{value:`functionTimeout(${e.name||"<anonymous>"})`,configurable:!0}),t}function bd(){return!1}let{toString:bh}=Object.prototype;function bf(e){return"[object RegExp]"===bh.call(e)}let bp={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function bg(e,t={}){if(!bf(e))throw TypeError("Expected a RegExp instance");let r=Object.keys(bp).map(r=>("boolean"==typeof t[r]?t[r]:e[r])?bp[r]:"").join(""),n=new RegExp(t.source||e.source,r);return n.lastIndex="number"==typeof t.lastIndex?t.lastIndex:e.lastIndex,n}function bm(e,t,{timeout:r}={}){try{return bu(()=>bg(e).test(t),{timeout:r})()}catch(e){if(bd(e))return!1;throw e}}let by=15,bb=45,bw={timeout:400};function bv(e){return!(e.length>bb)&&bm(bc.v6({exact:!0}),e,bw)}function bE(e){return!(e.length>by)&&bm(bc.v4({exact:!0}),e,bw)}let bA={http:"80",https:"443",ws:"80",wss:"443"},bx=["http","https","ws","wss"];function bS(e,t){let r=(t=t??{}).defaultDnsType??"dns4",{scheme:n,hostname:i,port:s,path:o}=bk(e),a=[b_(i,r),bI(s,n),bT(n)];return null!=o&&a.push(bC(o)),yz("/"+a.filter(e=>!!e).reduce((e,t)=>e.concat(t),[]).join("/"))}function bk(e){let t,[r]=e.split(":");bx.includes(r)||(e="http"+e.substring(r.length));let{protocol:n,hostname:i,port:s,pathname:o,search:a}=new URL(e);if(null==s||""===s){let e=bP(r);null!=e&&(s=e),null==e&&"http:"===n&&(s="80")}return null!=o&&""!==o&&"/"!==o&&(o.startsWith("/")&&(o=o.substring(1)),t=o),null!=a&&""!==a&&(t=(t??"")+a),{scheme:r,hostname:i,port:s,path:t}}function b_(e,t){if(null!=e&&""!==e){if(bE(e))return["ip4",e];if(bv(e))return["ip6",e];if("["===e[0]){let t=e.substring(1,e.length-1);if(bv(t))return["ip6",t]}return[t,e]}}function bI(e,t){if(null!=e&&""!==e)return"udp"===t?["udp",e]:["tcp",e]}function bT(e){if(null==e.match(/^tcp$|^udp$/))return[e]}function bC(e){if(null!=e&&""!==e)return["http-path",encodeURIComponent(e)]}function bP(e){if(null!=e&&""!==e&&null!=bA[e])return bA[e]}let bR=["https://trustless-gateway.link","https://4everland.io"],bD=2336;function bN(e){return e=e.toString(),{id:gy(tm.TO.createV1(bD,oJ.identity.digest((0,rx.s)(e)))),multiaddrs:[bS(e)]}}class bM{gateways;constructor(e={}){this.gateways=(e.gateways??bR).map(e=>bN(e))}async *findProviders(e,t){yield*this.gateways.toSorted(()=>Math.random()>.5?1:-1).map(e=>({...e,protocols:["transport-ipfs-gateway-http"]}))}}function bB(e={}){return new bM(e)}var bO=r(46923),bL=r(68250);let bF=Symbol.for("@libp2p/content-routing"),bU=Symbol.for("@libp2p/peer-routing");function bj(e){return null!=e&&"function"==typeof e.start&&"function"==typeof e.stop}async function bH(...e){let t=[];for(let r of e)bj(r)&&t.push(r);await Promise.all(t.map(async e=>{null!=e.beforeStart&&await e.beforeStart()})),await Promise.all(t.map(async e=>{await e.start()})),await Promise.all(t.map(async e=>{null!=e.afterStart&&await e.afterStart()}))}async function b$(...e){let t=[];for(let r of e)bj(r)&&t.push(r);await Promise.all(t.map(async e=>{null!=e.beforeStop&&await e.beforeStop()})),await Promise.all(t.map(async e=>{await e.stop()})),await Promise.all(t.map(async e=>{null!=e.afterStop&&await e.afterStop()}))}function bq(e){let t=[A.A];return null==e?t:Array.isArray(e)?0===e.length?t:e:[e]}let bz=60;function bV(e){return{Status:e.Status??0,TC:e.TC??e.flag_tc??!1,RD:e.RD??e.flag_rd??!1,RA:e.RA??e.flag_ra??!1,AD:e.AD??e.flag_ad??!1,CD:e.CD??e.flag_cd??!1,Question:(e.Question??e.questions??[]).map(e=>({name:e.name,type:A[e.type]})),Answer:(e.Answer??e.answers??[]).map(e=>({name:e.name,type:A[e.type],TTL:e.TTL??e.ttl??bz,data:e.data instanceof Uint8Array?(0,uC.d)(e.data):e.data}))}}let bG=4;function bK(e,t={}){let r=new av({concurrency:t.queryConcurrency??bG});return async(t,n={})=>{let i=new URLSearchParams;i.set("name",t),bq(n.types).forEach(e=>{i.append("type",A[e])}),n.onProgress?.(new rY("dns:query",{detail:t}));let s=await r.add(async()=>{let t=await fetch(`${e}?${i}`,{headers:{accept:"application/dns-json"},signal:n?.signal});if(200!==t.status)throw Error(`Unexpected HTTP status: ${t.status} - ${t.statusText}`);let r=bV(await t.json());return n.onProgress?.(new rY("dns:response",{detail:r})),r},{signal:n.signal});if(null==s)throw Error("No DNS response received");return s}}function bW(){return[bK("https://cloudflare-dns.com/dns-query"),bK("https://dns.google/resolve")]}var bQ=r(91011);class bJ{lru;constructor(e){this.lru=bQ(e)}get(e,t){let r=!0,n=[];for(let i of t){let t=this.getAnswers(e,i);if(0===t.length){r=!1;break}n.push(...t)}if(r)return bV({answers:n})}getAnswers(e,t){let r=`${e.toLowerCase()}-${t}`,n=this.lru.get(r);if(null!=n){let e=n.filter(e=>e.expires>Date.now()).map(({expires:e,value:t})=>({...t,TTL:Math.round((e-Date.now())/1e3),type:A[t.type]}));return 0===e.length&&this.lru.remove(r),e}return[]}add(e,t){let r=`${e.toLowerCase()}-${t.type}`,n=this.lru.get(r)??[];n.push({expires:Date.now()+(t.TTL??bz)*1e3,value:t}),this.lru.set(r,n)}remove(e,t){let r=`${e.toLowerCase()}-${t}`;this.lru.remove(r)}clear(){this.lru.clear()}}function bZ(e){return new bJ(e)}let bY=1e3;class bX{resolvers;cache;constructor(e){this.resolvers={},this.cache=bZ(e.cacheSize??bY),Object.entries(e.resolvers??{}).forEach(([e,t])=>{Array.isArray(t)||(t=[t]),e.endsWith(".")||(e=`${e}.`),this.resolvers[e]=t}),null==this.resolvers["."]&&(this.resolvers["."]=bW())}async query(e,t={}){let r=bq(t.types),n=!1!==t.cached?this.cache.get(e,r):void 0;if(null!=n)return t.onProgress?.(new rY("dns:cache",{detail:n})),n;let i=`${e.split(".").pop()}.`,s=(this.resolvers[i]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),o=[];for(let n of s){if(t.signal?.aborted===!0)break;try{let i=await n(e,{...t,types:r});for(let t of i.Answer)this.cache.add(e,t);return i}catch(e){o.push(e),t.onProgress?.(new rY("dns:error",{detail:e}))}}if(1===o.length)throw o[0];throw AggregateError(o,`DNS lookup of ${e} ${r} failed`)}}function b0(e={}){return new bX(e)}!function(e){e[e.A=1]="A",e[e.CNAME=5]="CNAME",e[e.TXT=16]="TXT",e[e.AAAA=28]="AAAA"}(A||(A={}));var b1=r(31987),b2=r(41472);function b3({enumerable:e=!0,configurable:t=!1}={}){return{enumerable:e,configurable:t,writable:!1}}function*b4(e,t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))for(let[r,n]of t.entries()){let t=[...e,r],i=np.TO.asCID(n);null!=i?yield[t.join("/"),i]:"object"==typeof n&&(yield*b5(n,t))}else{let r=np.TO.asCID(t);null!=r?yield[e.join("/"),r]:yield*b5(t,e)}}function*b5(e,t){if(null==e||e instanceof Uint8Array)return;let r=np.TO.asCID(e);for(let[n,i]of(null!=r&&(yield[t.join("/"),r]),Object.entries(e))){let e=[...t,n];yield*b4(e,i)}}function*b6(e,t){if(Array.isArray(t))for(let[r,n]of t.entries()){let t=[...e,r];yield t.join("/"),"object"==typeof n&&null==np.TO.asCID(n)&&(yield*b8(n,t))}else yield*b8(t,e)}function*b8(e,t){if(null!=e&&"object"==typeof e)for(let[r,n]of Object.entries(e)){let e=[...t,r];yield e.join("/"),null==n||n instanceof Uint8Array||"object"!=typeof n||null!=np.TO.asCID(n)||(yield*b6(e,n))}}function b7(e,t){let r=e;for(let[e,n]of t.entries()){if(null==(r=r[n]))throw Error(`Object has no property at ${t.slice(0,e+1).map(e=>`[${JSON.stringify(e)}]`).join("")}`);let i=np.TO.asCID(r);if(null!=i)return{value:i,remaining:t.slice(e+1).join("/")}}return{value:r}}class b9{cid;bytes;value;asBlock;constructor({cid:e,bytes:t,value:r}){if(null==e||null==t||void 0===r)throw Error("Missing required argument");this.cid=e,this.bytes=t,this.value=r,this.asBlock=this,Object.defineProperties(this,{cid:b3(),bytes:b3(),value:b3(),asBlock:b3()})}links(){return b5(this.value,[])}tree(){return b8(this.value,[])}get(e="/"){return b7(this.value,e.split("/").filter(Boolean))}}function we({bytes:e,cid:t,value:r,codec:n}){let i=void 0!==r?r:n?.decode(e);if(void 0===i)throw Error('Missing required argument, must either provide "value" or "codec"');return new b9({cid:t,bytes:e,value:i})}let wt="/pin/",wr="/pinned-block/",wn=b2.base36,wi=1;function ws(e){return 0===e.version&&(e=e.toV1()),new b1.U(`${wt}${e.toString(wn)}`)}class wo{datastore;blockstore;getCodec;constructor(e,t,r){this.datastore=e,this.blockstore=t,this.getCodec=r}async *add(e,t={}){let r=ws(e);if(await this.datastore.has(r))throw Error("Already pinned");let n=Math.round(t.depth??1/0);if(n<0)throw Error("Depth must be greater than or equal to 0");let i=new cJ({concurrency:wi});for await(let r of this.#j(e,i,{...t,depth:n}))await this.#H(r,t=>null==t.pinnedBy.find(t=>tc(t,e.bytes))&&(t.pinCount++,t.pinnedBy.push(e.bytes),!0),t),yield r;let s={depth:n,metadata:t.metadata??{}};await this.datastore.put(r,oa(s),t)}async *#j(e,t,r){if(-1===r.depth)return;let n=await this.getCodec(e.code),i=we({bytes:await this.blockstore.get(e,r),cid:e,codec:n});for await(let[,n]of(yield e,i.links()))yield*await t.add(async()=>this.#j(n,t,{...r,depth:r.depth-1}))}async #H(e,t,r){let n=new b1.U(`${wr}${wn.encode(e.multihash.bytes)}`),i={pinCount:0,pinnedBy:[]};try{i=om(await this.datastore.get(n,r))}catch(e){if("NotFoundError"!==e.name)throw e}if(t(i)){if(0===i.pinCount&&await this.datastore.has(n))return void await this.datastore.delete(n);await this.datastore.put(n,oa(i),r),r.onProgress?.(new rY("helia:pin:add",e))}}async *rm(e,t={}){let r=ws(e),n=om(await this.datastore.get(r,t));await this.datastore.delete(r,t);let i=new cJ({concurrency:wi});for await(let r of this.#j(e,i,{...t,depth:n.depth}))await this.#H(r,t=>(t.pinCount--,t.pinnedBy=t.pinnedBy.filter(t=>tc(t,e.bytes)),!0),{...t,depth:n.depth}),yield r}async *ls(e={}){for await(let{key:t,value:r}of this.datastore.query({prefix:wt+(null!=e.cid?`${e.cid.toString(b2.base36)}`:"")},e)){let e=tm.TO.parse(t.toString().substring(5),b2.base36),n=om(r);yield{cid:e,...n}}}async isPinned(e,t={}){let r=new b1.U(`${wr}${wn.encode(e.multihash.bytes)}`);return this.datastore.has(r,t)}async get(e,t){let r=ws(e);return om(await this.datastore.get(r,t))}async setMetadata(e,t,r){let n=ws(e),i=om(await this.datastore.get(n,r));i.metadata=t??{},await this.datastore.put(n,oa(i),r)}}var wa=r(62897);let wl=5;class wc{log;routers;providerLookupConcurrency;constructor(e,t){this.log=e.logger.forComponent("helia:routing"),this.routers=t.routers??[],this.providerLookupConcurrency=t.providerLookupConcurrency??wl,this.findProviders=e.metrics?.traceFunction("helia.routing.findProviders",this.findProviders.bind(this),{optionsIndex:1})??this.findProviders,this.provide=e.metrics?.traceFunction("helia.routing.provide",this.provide.bind(this),{optionsIndex:1})??this.provide,this.cancelReprovide=e.metrics?.traceFunction("helia.routing.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1})??this.cancelReprovide,this.put=e.metrics?.traceFunction("helia.routing.put",this.put.bind(this),{optionsIndex:2})??this.put,this.get=e.metrics?.traceFunction("helia.routing.get",this.get.bind(this),{optionsIndex:1})??this.get,this.findPeer=e.metrics?.traceFunction("helia.routing.findPeer",this.findPeer.bind(this),{optionsIndex:1})??this.findPeer,this.getClosestPeers=e.metrics?.traceFunction("helia.routing.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1})??this.getClosestPeers}async start(){await bH(...this.routers)}async stop(){await b$(...this.routers)}async *findProviders(e,t={}){if(0===this.routers.length)throw new gN("No content routers available");let r=new cZ({concurrency:this.providerLookupConcurrency});for await(let n of(r.addEventListener("error",()=>{}),(0,wa.A)(r.toGenerator(),...wu(this.routers,"findProviders").map(r=>r.findProviders(e,t)))))if(null!=n){if(0===n.multiaddrs.length){if(null!=r.find(n.id))continue;r.add(async()=>{try{let e=await this.findPeer(n.id,t);if(0===e.multiaddrs.length)return null;return e}catch(e){return this.log.error("could not load multiaddrs for peer %p",n.id,e),null}},{peerId:n.id,signal:t.signal}).catch(e=>{this.log.error("could not load multiaddrs for peer %p",n.id,e)})}yield n}}async provide(e,t={}){if(0===this.routers.length)throw new gN("No content routers available");await Promise.all(wu(this.routers,"provide").map(async r=>{await r.provide(e,t)}))}async cancelReprovide(e,t={}){await Promise.all(wu(this.routers,"cancelReprovide").map(async r=>{await r.cancelReprovide(e,t)}))}async put(e,t,r){await Promise.all(wu(this.routers,"put").map(async n=>{await n.put(e,t,r)}))}async get(e,t){return Promise.any(wu(this.routers,"get").map(async r=>r.get(e,t)))}async findPeer(e,t){if(0===this.routers.length)throw new gN("No peer routers available");let r=this;for await(let n of(0,wa.A)(...wu(this.routers,"findPeer").map(n=>(async function*(){try{yield await n.findPeer(e,t)}catch(e){r.log.error(e)}})())))if(null!=n)return n;throw new c_("Could not find peer in routing")}async *getClosestPeers(e,t={}){if(0===this.routers.length)throw new gN("No peer routers available");for await(let r of(0,wa.A)(...wu(this.routers,"getClosestPeers").map(r=>r.getClosestPeers(e,t))))null!=r&&(yield r)}}function wu(e,t){return e.filter(e=>null!=e[t])}let wd={},wh=e=>{e.addEventListener("message",t=>{wh.dispatchEvent("message",e,t)}),null!=e.port&&e.port.addEventListener("message",t=>{wh.dispatchEvent("message",e,t)})};wh.addEventListener=(e,t)=>{null==wd[e]&&(wd[e]=[]),wd[e].push(t)},wh.removeEventListener=(e,t)=>{null!=wd[e]&&(wd[e]=wd[e].filter(e=>e===t))},wh.dispatchEvent=function(e,t,r){null!=wd[e]&&wd[e].forEach(e=>e(t,r))};let wf=wh,wp="lock:worker:request-read",wg="lock:worker:release-read",wm="lock:master:grant-read",wy="lock:worker:request-write",wb="lock:worker:release-write",ww="lock:master:grant-write",wv=(e=21)=>Math.random().toString().substring(2),wE=(e,t,r,n,i)=>(s,o)=>{if(o.data.type!==r)return;let a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};e.dispatchEvent(new MessageEvent(t,{data:{name:a.name,handler:async()=>{s.postMessage({type:i,name:a.name,identifier:a.identifier}),await new Promise(e=>{let t=r=>{if(r?.data==null)return;let i={type:r.data.type,name:r.data.name,identifier:r.data.identifier};i.type===n&&i.identifier===a.identifier&&(s.removeEventListener("message",t),e())};s.addEventListener("message",t)})}}}))},wA=(e,t,r,n)=>async()=>{let i=wv();return globalThis.postMessage({type:t,identifier:i,name:e}),new Promise(t=>{let s=o=>{if(o?.data==null)return;let a={type:o.data.type,identifier:o.data.identifier};a.type===r&&a.identifier===i&&(globalThis.removeEventListener("message",s),t(()=>{globalThis.postMessage({type:n,identifier:i,name:e})}))};globalThis.addEventListener("message",s)})},wx={singleProcess:!1},wS=e=>{if(e=Object.assign({},wx,e),globalThis.document||e.singleProcess){let e=new EventTarget;return wf.addEventListener("message",wE(e,"requestReadLock",wp,wg,wm)),wf.addEventListener("message",wE(e,"requestWriteLock",wy,wb,ww)),e}return{isWorker:!0,readLock:e=>wA(e,wp,wm,wg),writeLock:e=>wA(e,wy,ww,wb)}},wk={};async function w_(e,t){let r,n=new Promise(e=>{r=e});return e.add(async()=>ay((async()=>{await new Promise(e=>{r(()=>{e()})})})(),{milliseconds:t.timeout})),n}let wI=(e,t)=>{let r;if(!0===n.isWorker)return{readLock:n.readLock(e,t),writeLock:n.writeLock(e,t)};let i=new av({concurrency:1});return{async readLock(){if(null!=r)return w_(r,t);let e=r=new av({concurrency:t.concurrency,autoStart:!1}),n=w_(r,t);return i.add(async()=>{e.start(),await e.onIdle().then(()=>{r===e&&(r=null)})}),n},writeLock:async()=>(r=null,w_(i,t))}},wT={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function wC(e){let t=Object.assign({},wT,e);return null==n&&!0!==(n=wS(t)).isWorker&&(n.addEventListener("requestReadLock",e=>{null!=wk[e.data.name]&&wk[e.data.name].readLock().then(async t=>e.data.handler().finally(()=>{t()}))}),n.addEventListener("requestWriteLock",async e=>{null!=wk[e.data.name]&&wk[e.data.name].writeLock().then(async t=>e.data.handler().finally(()=>{t()}))})),null==wk[t.name]&&(wk[t.name]=wI(t.name,t)),wk[t.name]}class wP{lock;child;pins;started;constructor(e,t,r={}){this.child=e,this.pins=t,this.lock=wC({singleProcess:r.holdGcLock}),this.started=!1}isStarted(){return this.started}async start(){await bH(this.child),this.started=!0}async stop(){await b$(this.child),this.started=!1}unwrap(){return this.child}async put(e,t,r={}){r?.signal?.throwIfAborted();let n=await this.lock.readLock();try{return await this.child.put(e,t,r)}finally{n()}}async *putMany(e,t={}){t?.signal?.throwIfAborted();let r=await this.lock.readLock();try{yield*this.child.putMany(e,t)}finally{r()}}async get(e,t={}){t?.signal?.throwIfAborted();let r=await this.lock.readLock();try{return await this.child.get(e,t)}finally{r()}}async *getMany(e,t={}){t?.signal?.throwIfAborted();let r=await this.lock.readLock();try{yield*this.child.getMany(e,t)}finally{r()}}async delete(e,t={}){t?.signal?.throwIfAborted();let r=await this.lock.writeLock();try{if(await this.pins.isPinned(e))throw Error("CID was pinned");await this.child.delete(e,t)}finally{r()}}async *deleteMany(e,t={}){t?.signal?.throwIfAborted();let r=await this.lock.writeLock();try{let r=this;yield*this.child.deleteMany(async function*(){for await(let t of e){if(await r.pins.isPinned(t))throw Error("CID was pinned");yield t}}(),t)}finally{r()}}async has(e,t={}){t?.signal?.throwIfAborted();let r=await this.lock.readLock();try{return await this.child.has(e,t)}finally{r()}}async *getAll(e={}){e?.signal?.throwIfAborted();let t=await this.lock.readLock();try{yield*this.child.getAll(e)}finally{t()}}createSession(e,t){return t?.signal?.throwIfAborted(),this.child.createSession(e,t)}}let wR=new b1.U("/version"),wD=1;async function wN(e){if(!await e.has(wR))return void await e.put(wR,(0,rx.s)(`${wD}`));let t=await e.get(wR);if(parseInt((0,uC.d)(t),10)!==wD)throw Error("Unknown datastore version, a datastore migration may be required")}function wM(e){return e?.then!=null}function wB(e=[],t){let r={[tG]:e7,[rZ.code]:rZ,[ok]:e9,[o$]:te,[oQ.code]:oQ};return e.forEach(e=>{r[e.code]=e}),async e=>{let n=r[e];if(null==n&&null!=t){let i=t(e);r[(n=wM(i)?await i:i).code]=n}if(null!=n)return n;throw new gB(`Could not load codec for ${e}`)}}function wO(e=[],t){let r={[rX.sha256.code]:rX.sha256,[rX.sha512.code]:rX.sha512,[oJ.identity.code]:oJ.identity};return e.forEach(e=>{r[e.code]=e}),async e=>{let n=r[e];if(null==n&&null!=t){let i=t(e);r[(n=wM(i)?await i:i).code]=n}if(null!=n)return n;throw new gM(`No hasher configured for multihash code 0x${e.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`)}}var wL=r(98897),wF=r(90161);let wU=0;class wj extends wF.i{child;constructor(e){super(),this.child=e}put(e,t){return e.multihash.code===wU||null==this.child?e:this.child.put(e,t)}get(e){if(e.multihash.code===wU)return e.multihash.digest;if(null==this.child)throw new wL.m_;return this.child.get(e)}has(e){return e.multihash.code===wU||null!=this.child&&this.child.has(e)}delete(e){if(e.code!==wU&&null!=this.child)return this.child.delete(e)}getAll(e){return null!=this.child?this.child.getAll(e):[]}}var wH=r(1707);function w$(e){return null!=e[Symbol.asyncIterator]}function wq(e){return e?.then!=null}let wz=function(e,t){let r=0;if(w$(e))return async function*(){for await(let n of e){let e=t(n,r++);wq(e)&&await e,yield n}}();let n=(0,wH.A)(e),{value:i,done:s}=n.next();if(!0===s)return function*(){}();let o=t(i,r++);if("function"==typeof o?.then)return async function*(){for await(let e of(yield i,n)){let n=t(e,r++);wq(n)&&await n,yield e}}();let a=t;return function*(){for(let e of(yield i,n))a(e,r++),yield e}()};class wV{child;getHasher;log;logger;components;constructor(e){this.log=e.logger.forComponent("helia:networked-storage"),this.logger=e.logger,this.components=e,this.child=new wj(e.blockstore),this.getHasher=e.getHasher}async put(e,t,r={}){return await this.child.has(e,r)?(r.onProgress?.(new rY("blocks:put:duplicate",e)),e):(r.onProgress?.(new rY("blocks:put:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async n=>n.announce?.(e,t,r))),r.onProgress?.(new rY("blocks:put:blockstore:put",e)),this.child.put(e,t,r))}async *putMany(e,t={}){let r=wz((0,ai.A)(e,async({cid:e})=>{let r=await this.child.has(e,t);return r&&t.onProgress?.(new rY("blocks:put-many:duplicate",e)),!r}),async({cid:e,block:r})=>{t.onProgress?.(new rY("blocks:put-many:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async n=>n.announce?.(e,r,t)))});t.onProgress?.(new rY("blocks:put-many:blockstore:put-many")),yield*this.child.putMany(r,t)}async get(e,t={}){if(!0!==t.offline&&!await this.child.has(e,t)){let r=await this.getHasher(e.multihash.code);t.onProgress?.(new rY("blocks:get:providers:get",e));let n=await wJ(e,this.components.blockBrokers,r,{...t,log:this.log});return t.onProgress?.(new rY("blocks:get:blockstore:put",e)),await this.child.put(e,n,t),t.onProgress?.(new rY("blocks:get:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async r=>r.announce?.(e,n,t))),n}return t.onProgress?.(new rY("blocks:get:blockstore:get",e)),this.child.get(e,t)}async *getMany(e,t={}){t.onProgress?.(new rY("blocks:get-many:blockstore:get-many")),yield*this.child.getMany(wz(e,async e=>{if(!0!==t.offline&&!await this.child.has(e,t)){let r=await this.getHasher(e.multihash.code);t.onProgress?.(new rY("blocks:get-many:providers:get",e));let n=await wJ(e,this.components.blockBrokers,r,{...t,log:this.log});t.onProgress?.(new rY("blocks:get-many:blockstore:put",e)),await this.child.put(e,n,t),t.onProgress?.(new rY("blocks:get-many:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async r=>r.announce?.(e,n,t)))}}))}async delete(e,t={}){t.onProgress?.(new rY("blocks:delete:blockstore:delete",e)),await this.child.delete(e,t)}async *deleteMany(e,t={}){t.onProgress?.(new rY("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany(async function*(){for await(let t of e)yield t}(),t)}async has(e,t={}){return this.child.has(e,t)}async *getAll(e={}){e.onProgress?.(new rY("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(e)}}class wG extends wV{started;constructor(e){super(e),this.started=!1}isStarted(){return this.started}async start(){await bH(this.child,...this.components.blockBrokers),this.started=!0}async stop(){await b$(this.child,...this.components.blockBrokers),this.started=!1}unwrap(){return this.child}createSession(e,t){let r=this.components.blockBrokers.map(e=>null==e.createSession?e:e.createSession(t));return new wK({blockstore:this.child,blockBrokers:r,getHasher:this.getHasher,logger:this.logger},{root:e})}}class wK extends wV{closeController;constructor(e,t){super(e),this.closeController=new AbortController,this.closeController.signal,this.log=e.logger.forComponent(`helia:session-storage:${t.root}`)}close(){this.closeController.abort()}async put(e,t,r={}){let n=ch([this.closeController.signal,r.signal]);try{return await super.put(e,t,{...r,signal:n})}finally{n.clear()}}async *putMany(e,t={}){let r=ch([this.closeController.signal,t.signal]);try{yield*super.putMany(e,{...t,signal:r})}finally{r.clear()}}async get(e,t={}){let r=ch([this.closeController.signal,t.signal]);try{return await super.get(e,{...t,signal:r})}finally{r.clear()}}async *getMany(e,t={}){let r=ch([this.closeController.signal,t.signal]);try{yield*super.getMany(e,{...t,signal:r})}finally{r.clear()}}async delete(e,t={}){let r=ch([this.closeController.signal,t.signal]);try{await super.delete(e,{...t,signal:r})}finally{r.clear()}}async *deleteMany(e,t={}){let r=ch([this.closeController.signal,t.signal]);try{yield*super.deleteMany(e,{...t,signal:r})}finally{r.clear()}}async has(e,t={}){let r=ch([this.closeController.signal,t.signal]);try{return await super.has(e,{...t,signal:r})}finally{r.clear()}}async *getAll(e={}){let t=ch([this.closeController.signal,e.signal]);try{yield*super.getAll({...e,signal:t})}finally{t.clear()}}}function wW(e){return"function"==typeof e.retrieve}let wQ=(e,t)=>{if(null==t)throw new cy(`No hasher configured for multihash code 0x${e.multihash.code.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`);return async r=>{let n,i=t.digest(r);if(!tc((n=wM(i)?await i:i).digest,e.multihash.digest))throw new cP("Hash of downloaded block did not match multihash from passed CID")}};async function wJ(e,t,r,n){let i=wQ(e,r),s=new AbortController,o=ch([s.signal,n.signal]);s.signal;let a=[];for(let e of t)wW(e)&&a.push(e);try{return await Promise.any(a.map(async t=>{try{let r=!1,s=await t.retrieve(e,{...n,signal:o,validateFn:async e=>{await i(e),r=!0}});return r||await i(s),s}catch(t){throw n.log.error("could not retrieve verified block for %c",e,t),t}}))}finally{s.abort(),o.clear()}}class wZ{blockstore;datastore;pins;logger;routing;getCodec;getHasher;dns;metrics;log;constructor(e){this.logger=e.logger??(0,aB.Um)(),this.log=this.logger.forComponent("helia"),this.getHasher=wO(e.hashers,e.loadHasher),this.getCodec=wB(e.codecs,e.loadCodec),this.dns=e.dns??b0(),this.metrics=e.metrics;let t={blockstore:e.blockstore,datastore:e.datastore,logger:this.logger,blockBrokers:[],getHasher:this.getHasher,getCodec:this.getCodec,dns:this.dns,metrics:this.metrics,...e.components??{}};this.routing=t.routing=new wc(t,{routers:(e.routers??[]).flatMap(e=>{let t=[e];return null!=e[bF]&&t.push(e[bF]),null!=e[bU]&&t.push(e[bU]),t}),providerLookupConcurrency:e.providerLookupConcurrency});let r=new wG(t);this.pins=new wo(e.datastore,r,this.getCodec),this.blockstore=new wP(r,this.pins,{holdGcLock:e.holdGcLock??!0}),this.datastore=e.datastore,t.blockBrokers=e.blockBrokers.map(e=>e(t))}async start(){await wN(this.datastore),await bH(this.blockstore,this.datastore,this.routing)}async stop(){await b$(this.blockstore,this.datastore,this.routing)}async gc(e={}){let t=await this.blockstore.lock.writeLock();try{let t=this,r=this.blockstore.unwrap();this.log("gc start"),await (0,cY.A)(r.deleteMany(async function*(){for await(let{cid:n}of r.getAll())try{if(await t.pins.isPinned(n,e))continue;yield n,e.onProgress?.(new rY("helia:gc:deleted",n))}catch(r){t.log.error("Error during gc",r),e.onProgress?.(new rY("helia:gc:error",r))}}()))}finally{t()}this.log("gc finished")}}class wY extends wZ{libp2p;constructor(e){super({...e,components:{libp2p:e.libp2p}}),this.libp2p=e.libp2p}async start(){await super.start(),await this.libp2p.start()}async stop(){await super.stop(),await this.libp2p.stop()}}function wX(e,t,r,n){dc(e);let{c:i,dkLen:s,asyncTick:o}=dx({dkLen:32,asyncTick:10},n);if(da(i),da(s),da(o),i<1)throw Error("iterations (c) should be >= 1");let a=dE(t),l=dE(r),c=new Uint8Array(s),u=ps.create(e,a),d=u._cloneInto().update(l);return{c:i,dkLen:s,asyncTick:o,DK:c,PRF:u,PRFSalt:d}}function w0(e,t,r,n,i){return e.destroy(),t.destroy(),n&&n.destroy(),dh(i),r}function w1(e,t,r,n){let i,{c:s,dkLen:o,DK:a,PRF:l,PRFSalt:c}=wX(e,t,r,n),u=new Uint8Array(4),d=df(u),h=new Uint8Array(l.outputLen);for(let e=1,t=0;t<o;e++,t+=l.outputLen){let r=a.subarray(t,t+l.outputLen);d.setInt32(0,e,!1),(i=c._cloneInto(i)).update(u).digestInto(h),r.set(h.subarray(0,r.length));for(let e=1;e<s;e++){l._cloneInto(i).update(h).digestInto(h);for(let e=0;e<r.length;e++)r[e]^=h[e]}}return w0(l,c,a,i,h)}async function w2(e,t,r,n){let i,{c:s,dkLen:o,asyncTick:a,DK:l,PRF:c,PRFSalt:u}=wX(e,t,r,n),d=new Uint8Array(4),h=df(d),f=new Uint8Array(c.outputLen);for(let e=1,t=0;t<o;e++,t+=c.outputLen){let r=l.subarray(t,t+c.outputLen);h.setInt32(0,e,!1),(i=u._cloneInto(i)).update(d).digestInto(f),r.set(f.subarray(0,r.length)),await db(s-1,a,()=>{c._cloneInto(i).update(f).digestInto(f);for(let e=0;e<r.length;e++)r[e]^=f[e]})}return w0(c,u,l,i,f)}let w3=Uint32Array.from([0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0]),w4=new Uint32Array(80);class w5 extends dP{constructor(){super(64,20,8,!1),this.A=0|w3[0],this.B=0|w3[1],this.C=0|w3[2],this.D=0|w3[3],this.E=0|w3[4]}get(){let{A:e,B:t,C:r,D:n,E:i}=this;return[e,t,r,n,i]}set(e,t,r,n,i){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i}process(e,t){for(let r=0;r<16;r++,t+=4)w4[r]=e.getUint32(t,!1);for(let e=16;e<80;e++)w4[e]=dg(w4[e-3]^w4[e-8]^w4[e-14]^w4[e-16],1);let{A:r,B:n,C:i,D:s,E:o}=this;for(let e=0;e<80;e++){let t,a;e<20?(t=dT(n,i,s),a=0x5a827999):e<40?(t=n^i^s,a=0x6ed9eba1):e<60?(t=dC(n,i,s),a=0x8f1bbcdc):(t=n^i^s,a=0xca62c1d6);let l=dg(r,5)+t+o+a+w4[e]|0;o=s,s=i,i=dg(n,30),n=r,r=l}r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,this.set(r,n,i,s,o)}roundClean(){dh(w4)}destroy(){this.set(0,0,0,0,0),dh(this.buffer)}}let w6=dk(()=>new w5),w8=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),w7=Uint8Array.from(Array(16).fill(0).map((e,t)=>t)),w9=w7.map(e=>(9*e+5)%16),ve=(()=>{let e=[[w7],[w9]];for(let t=0;t<4;t++)for(let r of e)r.push(r[t].map(e=>w8[e]));return e})();ve[0],ve[1],e=>Uint8Array.from(e);let vt=d6,vr={sha1:w6,"sha2-256":fJ,"sha2-512":vt};function vn(e,t,r,n,i){if("sha1"!==i&&"sha2-256"!==i&&"sha2-512"!==i){let e=Object.keys(vr).join(" / ");throw new cy(`Hash '${i}' is unknown or not supported. Must be ${e}`)}let s=w1(vr[i],e,t,{c:r,dkLen:n});return oN.base64.encode(s).substring(1)}function vi(e){if(isNaN(e)||e<=0)throw new cy("random bytes length must be a Number bigger than 0");return d_(e)}let vs=Symbol.for("@libp2p/service-capabilities"),vo=Symbol.for("@libp2p/service-dependencies");var va=r(86620),vl=r(3305);let vc={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function vu(e){let t=e?.algorithm??"AES-GCM",r=e?.keyLength??16,n=e?.nonceLength??12,i=e?.digest??"SHA-256",s=e?.saltLength??16,o=e?.iterations??32767,a=fq.get();return r*=8,{encrypt:async function(e,l){let c,u=a.getRandomValues(new Uint8Array(s)),d={name:t,iv:a.getRandomValues(new Uint8Array(n))};if("string"==typeof l&&(l=(0,rx.s)(l)),0===l.length){c=await a.subtle.importKey("jwk",vc,{name:"AES-GCM"},!0,["encrypt"]);try{let e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",l,{name:"PBKDF2"},!1,["deriveKey"]);c=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}catch{c=await a.subtle.importKey("jwk",vc,{name:"AES-GCM"},!0,["encrypt"])}}else{let e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",l,{name:"PBKDF2"},!1,["deriveKey"]);c=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}let h=await a.subtle.encrypt(d,c,e);return tl([u,d.iv,new Uint8Array(h)])},decrypt:async function(e,l){let c,u=e.subarray(0,s),d=e.subarray(s,s+n),h=e.subarray(s+n),f={name:t,iv:d};if("string"==typeof l&&(l=(0,rx.s)(l)),0===l.length)try{let e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",l,{name:"PBKDF2"},!1,["deriveKey"]);c=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}catch{c=await a.subtle.importKey("jwk",vc,{name:"AES-GCM"},!0,["decrypt"])}else{let e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",l,{name:"PBKDF2"},!1,["deriveKey"]);c=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}return new Uint8Array(await a.subtle.decrypt(f,c,h))}}}var vd=r(19169);function vh(e,t){let r=0;if(1===e.length)return e[0];for(let n=e.length-1;n>=0;n--)r+=e[e.length-1-n]*Math.pow(2,t*n);return r}function vf(e,t,r=-1){let n=r,i=e,s=0,o=Math.pow(2,t);for(let r=1;r<8;r++){if(e<o){let e;if(n<0)e=new ArrayBuffer(r),s=r;else{if(n<r)return new ArrayBuffer(0);e=new ArrayBuffer(n),s=n}let o=new Uint8Array(e);for(let e=r-1;e>=0;e--){let r=Math.pow(2,e*t);o[s-e-1]=Math.floor(i/r),i-=o[s-e-1]*r}return e}o*=Math.pow(2,t)}return new ArrayBuffer(0)}function vp(...e){let t=0,r=0;for(let r of e)t+=r.length;let n=new Uint8Array(new ArrayBuffer(t));for(let t of e)n.set(t,r),r+=t.length;return n}function vg(){let e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){let t=255===e[0]&&128&e[1],r=0===e[0]&&(128&e[1])==0;(t||r)&&this.warnings.push("Needlessly long format")}let t=new Uint8Array(new ArrayBuffer(this.valueHex.byteLength));for(let e=0;e<this.valueHex.byteLength;e++)t[e]=0;t[0]=128&e[0];let r=vh(t,8),n=new Uint8Array(new ArrayBuffer(this.valueHex.byteLength));for(let t=0;t<this.valueHex.byteLength;t++)n[t]=e[t];return n[0]&=127,vh(n,8)-r}function vm(e){let t=e<0?-1*e:e,r=128;for(let n=1;n<8;n++){if(t<=r){if(e<0){let e=vf(r-t,8,n),i=new Uint8Array(e);return i[0]|=128,e}let i=vf(t,8,n),s=new Uint8Array(i);if(128&s[0]){let e=i.slice(0),t=new Uint8Array(e);s=new Uint8Array(i=new ArrayBuffer(i.byteLength+1));for(let r=0;r<e.byteLength;r++)s[r+1]=t[r];s[0]=0}return i}r*=256}return new ArrayBuffer(0)}function vy(e,t){if(e.byteLength!==t.byteLength)return!1;let r=new Uint8Array(e),n=new Uint8Array(t);for(let e=0;e<r.length;e++)if(r[e]!==n[e])return!1;return!0}function vb(e,t){let r=e.toString(10);if(t<r.length)return"";let n=t-r.length,i=Array(n);for(let e=0;e<n;e++)i[e]="0";return i.join("").concat(r)}function vw(){if("undefined"==typeof BigInt)throw Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function vv(e){let t=0,r=0;for(let r=0;r<e.length;r++)t+=e[r].byteLength;let n=new Uint8Array(t);for(let t=0;t<e.length;t++){let i=e[t];n.set(new Uint8Array(i),r),r+=i.byteLength}return n.buffer}function vE(e,t,r,n){return t instanceof Uint8Array?t.byteLength?r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):n<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-n<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class vA{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return vv(this.items)}}let vx=[new Uint8Array([1])],vS="0123456789",vk="name",v_="valueHexView",vI="isHexOnly",vT="idBlock",vC="tagClass",vP="tagNumber",vR="isConstructed",vD="fromBER",vN="toBER",vM="local",vB="",vO=new ArrayBuffer(0),vL=new Uint8Array(0),vF="EndOfContent",vU="OCTET STRING",vj="BIT STRING";function vH(e){var t;return(t=class extends e{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(e){this.valueHexView=new Uint8Array(e)}constructor(...e){var t;super(...e);let r=e[0]||{};this.isHexOnly=null!=(t=r.isHexOnly)&&t,this.valueHexView=r.valueHex?vd._H.toUint8Array(r.valueHex):vL}fromBER(e,t,r){let n=e instanceof ArrayBuffer?new Uint8Array(e):e;if(!vE(this,n,t,r))return -1;let i=t+r;return(this.valueHexView=n.subarray(t,i),this.valueHexView.length)?(this.blockLength=r,i):(this.warnings.push("Zero buffer length"),t)}toBER(e=!1){return this.isHexOnly?e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",vO)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:vd.U$.ToHex(this.valueHexView)}}}).NAME="hexBlock",t}class v${static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=vB,warnings:r=[],valueBeforeDecode:n=vL}={}){this.blockLength=e,this.error=t,this.warnings=r,this.valueBeforeDecodeView=vd._H.toUint8Array(n)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:vd.U$.ToHex(this.valueBeforeDecodeView)}}}v$.NAME="baseBlock";class vq extends v${fromBER(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}vq.NAME="valueBlock";class vz extends vH(v$){constructor({idBlock:e={}}={}){var t,r,n,i;super(),e?(this.isHexOnly=null!=(t=e.isHexOnly)&&t,this.valueHexView=e.valueHex?vd._H.toUint8Array(e.valueHex):vL,this.tagClass=null!=(r=e.tagClass)?r:-1,this.tagNumber=null!=(n=e.tagNumber)?n:-1,this.isConstructed=null!=(i=e.isConstructed)&&i):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",vO}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){let r=new Uint8Array(1);if(!e){let e=this.tagNumber;e&=31,t|=e,r[0]=t}return r.buffer}if(!this.isHexOnly){let r=vf(this.tagNumber,7),n=new Uint8Array(r),i=r.byteLength,s=new Uint8Array(i+1);if(s[0]=31|t,!e){for(let e=0;e<i-1;e++)s[e+1]=128|n[e];s[i]=n[i-1]}return s.buffer}let r=new Uint8Array(this.valueHexView.byteLength+1);if(r[0]=31|t,!e){let e=this.valueHexView;for(let t=0;t<e.length-1;t++)r[t+1]=128|e[t];r[this.valueHexView.byteLength]=e[e.length-1]}return r.buffer}fromBER(e,t,r){let n=vd._H.toUint8Array(e);if(!vE(this,n,t,r))return -1;let i=n.subarray(t,t+r);if(0===i.length)return this.error="Zero buffer length",-1;switch(192&i[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(32&i[0])==32,this.isHexOnly=!1;let s=31&i[0];if(31!==s)this.tagNumber=s,this.blockLength=1;else{let e=1,t=this.valueHexView=new Uint8Array(255),r=255;for(;128&i[e];){if(t[e-1]=127&i[e],++e>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(e===r){let e=new Uint8Array(r+=255);for(let r=0;r<t.length;r++)e[r]=t[r];t=this.valueHexView=new Uint8Array(r)}}this.blockLength=e+1,t[e-1]=127&i[e];let n=new Uint8Array(e);for(let r=0;r<e;r++)n[r]=t[r];(t=this.valueHexView=new Uint8Array(e)).set(n),this.blockLength<=9?this.tagNumber=vh(t,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}vz.NAME="identificationBlock";class vV extends v${constructor({lenBlock:e={}}={}){var t,r,n;super(),this.isIndefiniteForm=null!=(t=e.isIndefiniteForm)&&t,this.longFormUsed=null!=(r=e.longFormUsed)&&r,this.length=null!=(n=e.length)?n:0}fromBER(e,t,r){let n=vd._H.toUint8Array(e);if(!vE(this,n,t,r))return -1;let i=n.subarray(t,t+r);if(0===i.length)return this.error="Zero buffer length",-1;if(255===i[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===i[0],this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&i[0]),!1===this.longFormUsed)return this.length=i[0],this.blockLength=1,t+this.blockLength;let s=127&i[0];if(s>8)return this.error="Too big integer",-1;if(s+1>i.length)return this.error="End of input reached before message was fully decoded",-1;let o=t+1,a=n.subarray(o,o+s);return 0===a[s-1]&&this.warnings.push("Needlessly long encoded length"),this.length=vh(a,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=s+1,t+this.blockLength}toBER(e=!1){let t,r;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),!1===e&&((r=new Uint8Array(t))[0]=128),t;if(this.longFormUsed){let n=vf(this.length,8);if(n.byteLength>127)return this.error="Too big length",vO;if(t=new ArrayBuffer(n.byteLength+1),e)return t;let i=new Uint8Array(n);(r=new Uint8Array(t))[0]=128|n.byteLength;for(let e=0;e<n.byteLength;e++)r[e+1]=i[e];return t}return t=new ArrayBuffer(1),!1===e&&((r=new Uint8Array(t))[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}vV.NAME="lengthBlock";let vG={};class vK extends v${constructor({name:e=vB,optional:t=!1,primitiveSchema:r,...n}={},i){super(n),this.name=e,this.optional=t,r&&(this.primitiveSchema=r),this.idBlock=new vz(n),this.lenBlock=new vV(n),this.valueBlock=i?new i(n):new vq(n)}fromBER(e,t,r){let n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return -1===n?this.error=this.valueBlock.error:(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength)),n}toBER(e,t){let r=t||new vA;t||vW(this);let n=this.idBlock.toBER(e);if(r.write(n),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{let t=this.valueBlock.toBER(e);this.lenBlock.length=t.byteLength;let n=this.lenBlock.toBER(e);r.write(n),r.write(t)}return t?vO:r.final()}toJSON(){let e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return"ascii"===e?this.onAsciiEncoding():vd.U$.ToHex(this.toBER())}onAsciiEncoding(){let e=this.constructor.NAME,t=vd.U$.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){return this===e||e instanceof this.constructor&&vy(this.toBER(),e.toBER())}}function vW(e){var t;if(e instanceof vG.Constructed)for(let t of e.valueBlock.value)vW(t)&&(e.lenBlock.isIndefiniteForm=!0);return!!(null==(t=e.lenBlock)?void 0:t.isIndefiniteForm)}vK.NAME="BaseBlock";class vQ extends vK{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=vB,...t}={},r){super(t,r),e&&this.fromString(e)}fromBER(e,t,r){let n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return -1===n?this.error=this.valueBlock.error:(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength)),n}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}vQ.NAME="BaseStringBlock";class vJ extends vH(vq){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}vJ.NAME="PrimitiveValueBlock";class vZ extends vK{constructor(e={}){super(e,vJ),this.idBlock.isConstructed=!1}}function vY(e,t){if(e instanceof t)return e;let r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecodeView=e.valueBeforeDecodeView,r}function vX(e,t=0,r=e.length){let n=t,i=new vK({},vq),s=new v$;if(!vE(s,e,t,r))return i.error=s.error,{offset:-1,result:i};if(!e.subarray(t,t+r).length)return i.error="Zero buffer length",{offset:-1,result:i};let o=i.idBlock.fromBER(e,t,r);if(i.idBlock.warnings.length&&i.warnings.concat(i.idBlock.warnings),-1===o)return i.error=i.idBlock.error,{offset:-1,result:i};if(t=o,r-=i.idBlock.blockLength,o=i.lenBlock.fromBER(e,t,r),i.lenBlock.warnings.length&&i.warnings.concat(i.lenBlock.warnings),-1===o)return i.error=i.lenBlock.error,{offset:-1,result:i};if(t=o,r-=i.lenBlock.blockLength,!i.idBlock.isConstructed&&i.lenBlock.isIndefiniteForm)return i.error="Indefinite length form used for primitive encoding form",{offset:-1,result:i};let a=vK;if(1===i.idBlock.tagClass){if(i.idBlock.tagNumber>=37&&!1===i.idBlock.isHexOnly)return i.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:i};switch(i.idBlock.tagNumber){case 0:if(i.idBlock.isConstructed&&i.lenBlock.length>0)return i.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:i};a=vG.EndOfContent;break;case 1:a=vG.Boolean;break;case 2:a=vG.Integer;break;case 3:a=vG.BitString;break;case 4:a=vG.OctetString;break;case 5:a=vG.Null;break;case 6:a=vG.ObjectIdentifier;break;case 10:a=vG.Enumerated;break;case 12:a=vG.Utf8String;break;case 13:a=vG.RelativeObjectIdentifier;break;case 14:a=vG.TIME;break;case 15:return i.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:i};case 16:a=vG.Sequence;break;case 17:a=vG.Set;break;case 18:a=vG.NumericString;break;case 19:a=vG.PrintableString;break;case 20:a=vG.TeletexString;break;case 21:a=vG.VideotexString;break;case 22:a=vG.IA5String;break;case 23:a=vG.UTCTime;break;case 24:a=vG.GeneralizedTime;break;case 25:a=vG.GraphicString;break;case 26:a=vG.VisibleString;break;case 27:a=vG.GeneralString;break;case 28:a=vG.UniversalString;break;case 29:a=vG.CharacterString;break;case 30:a=vG.BmpString;break;case 31:a=vG.DATE;break;case 32:a=vG.TimeOfDay;break;case 33:a=vG.DateTime;break;case 34:a=vG.Duration;break;default:{let e=i.idBlock.isConstructed?new vG.Constructed:new vG.Primitive;e.idBlock=i.idBlock,e.lenBlock=i.lenBlock,e.warnings=i.warnings,i=e}}}else a=i.idBlock.isConstructed?vG.Constructed:vG.Primitive;return o=(i=vY(i,a)).fromBER(e,t,i.lenBlock.isIndefiniteForm?r:i.lenBlock.length),i.valueBeforeDecodeView=e.subarray(n,n+i.blockLength),{offset:o,result:i}}function v0(e){if(!e.byteLength){let e=new vK({},vq);return e.error="Input buffer has zero length",{offset:-1,result:e}}return vX(vd._H.toUint8Array(e).slice(),0,e.byteLength)}function v1(e,t){return e?1:t}x=vZ,(()=>{vG.Primitive=x})(),vZ.NAME="PRIMITIVE";class v2 extends vq{constructor({value:e=[],isIndefiniteForm:t=!1,...r}={}){super(r),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,r){let n=vd._H.toUint8Array(e);if(!vE(this,n,t,r))return -1;if(this.valueBeforeDecodeView=n.subarray(t,t+r),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),t;let i=t;for(;v1(this.isIndefiniteForm,r)>0;){let e=vX(n,i,r);if(-1===e.offset)return this.error=e.result.error,this.warnings.concat(e.result.warnings),-1;if(i=e.offset,this.blockLength+=e.result.blockLength,r-=e.result.blockLength,this.value.push(e.result),this.isIndefiniteForm&&e.result.constructor.NAME===vF)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===vF?this.value.pop():this.warnings.push("No EndOfContent block encoded")),i}toBER(e,t){let r=t||new vA;for(let t=0;t<this.value.length;t++)this.value[t].toBER(e,r);return t?vO:r.final()}toJSON(){let e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(let t of this.value)e.value.push(t.toJSON());return e}}v2.NAME="ConstructedValueBlock";class v3 extends vK{constructor(e={}){super(e,v2),this.idBlock.isConstructed=!0}fromBER(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;let n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return -1===n?this.error=this.valueBlock.error:(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength)),n}onAsciiEncoding(){let e=[];for(let t of this.valueBlock.value)e.push(t.toString("ascii").split("\n").map(e=>`  ${e}`).join("\n"));let t=3===this.idBlock.tagClass?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join("\n")}`:`${t} :`}}S=v3,(()=>{vG.Constructed=S})(),v3.NAME="CONSTRUCTED";class v4 extends vq{fromBER(e,t,r){return t}toBER(e){return vO}}v4.override="EndOfContentValueBlock";class v5 extends vK{constructor(e={}){super(e,v4),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}k=v5,(()=>{vG.EndOfContent=k})(),v5.NAME=vF;class v6 extends vK{constructor(e={}){super(e,vq),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,r){return(this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength)?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}toBER(e,t){let r=new ArrayBuffer(2);if(!e){let e=new Uint8Array(r);e[0]=5,e[1]=0}return t&&t.write(r),r}onAsciiEncoding(){return`${this.constructor.NAME}`}}_=v6,(()=>{vG.Null=_})(),v6.NAME="NULL";class v8 extends vH(vq){get value(){for(let e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=255*!!e}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=vd._H.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,r){let n=vd._H.toUint8Array(e);return vE(this,n,t,r)?(this.valueHexView=n.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,vg.call(this),this.blockLength=r,t+r):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}v8.NAME="BooleanValueBlock";class v7 extends vK{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,v8),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}}I=v7,(()=>{vG.Boolean=I})(),v7.NAME="BOOLEAN";class v9 extends vH(v2){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,r){let n=0;if(this.isConstructed){if(this.isHexOnly=!1,-1===(n=v2.prototype.fromBER.call(this,e,t,r)))return n;for(let e=0;e<this.value.length;e++){let t=this.value[e].constructor.NAME;if(t===vF)if(!this.isIndefiniteForm)return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1;else break;if(t!==vU)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,n=super.fromBER(e,t,r),this.blockLength=r;return n}toBER(e,t){return this.isConstructed?v2.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}v9.NAME="OctetStringValueBlock";class Ee extends vK{constructor({idBlock:e={},lenBlock:t={},...r}={}){var n,i;null!=(n=r.isConstructed)||(r.isConstructed=!!(null==(i=r.value)?void 0:i.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},v9),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,r){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===r)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){let n=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+r);try{if(n.byteLength){let e=vX(n,0,n.byteLength);-1!==e.offset&&e.offset===r&&(this.valueBlock.value=[e.result])}}catch{}}return super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return v3.prototype.onAsciiEncoding.call(this);let e=this.constructor.NAME,t=vd.U$.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;let e=[];for(let t of this.valueBlock.value)t instanceof T&&e.push(t.valueBlock.valueHexView);return vd._H.concat(e)}}T=Ee,(()=>{vG.OctetString=T})(),Ee.NAME=vU;class Et extends vH(v2){constructor({unusedBits:e=0,isConstructed:t=!1,...r}={}){super(r),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,r){if(!r)return t;let n=-1;if(this.isConstructed){if(-1===(n=v2.prototype.fromBER.call(this,e,t,r)))return n;for(let e of this.value){let t=e.constructor.NAME;if(t===vF)if(!this.isIndefiniteForm)return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1;else break;if(t!==vj)return this.error="BIT STRING may consists of BIT STRINGs only",-1;let r=e.valueBlock;if(this.unusedBits>0&&r.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=r.unusedBits}return n}let i=vd._H.toUint8Array(e);if(!vE(this,i,t,r))return -1;let s=i.subarray(t,t+r);if(this.unusedBits=s[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){let e=s.subarray(1);try{if(e.byteLength){let t=vX(e,0,e.byteLength);-1!==t.offset&&t.offset===r-1&&(this.value=[t.result])}}catch{}}return this.valueHexView=s.subarray(1),this.blockLength=s.length,t+r}toBER(e,t){if(this.isConstructed)return v2.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return vO;let r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}Et.NAME="BitStringValueBlock";class Er extends vK{constructor({idBlock:e={},lenBlock:t={},...r}={}){var n,i;null!=(n=r.isConstructed)||(r.isConstructed=!!(null==(i=r.value)?void 0:i.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},Et),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,r){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return v3.prototype.onAsciiEncoding.call(this);{let e=[];for(let t of this.valueBlock.valueHexView)e.push(t.toString(2).padStart(8,"0"));let t=e.join(""),r=this.constructor.NAME,n=t.substring(0,t.length-this.valueBlock.unusedBits);return`${r} : ${n}`}}}function En(e,t){let r=new Uint8Array([0]),n=new Uint8Array(e),i=new Uint8Array(t),s=n.slice(0),o=s.length-1,a=i.slice(0),l=a.length-1,c=0,u=l<o?o:l,d=0;for(let e=u;e>=0;e--,d++)c=!0==d<a.length?s[o-d]+a[l-d]+r[0]:s[o-d]+r[0],r[0]=c/10,!0==d>=s.length?s=vp(new Uint8Array([c%10]),s):s[o-d]=c%10;return r[0]>0&&(s=vp(r,s)),s}function Ei(e){if(e>=vx.length)for(let t=vx.length;t<=e;t++){let e=new Uint8Array([0]),r=vx[t-1].slice(0);for(let t=r.length-1;t>=0;t--){let n=new Uint8Array([(r[t]<<1)+e[0]]);e[0]=n[0]/10,r[t]=n[0]%10}e[0]>0&&(r=vp(e,r)),vx.push(r)}return vx[e]}function Es(e,t){let r,n=0,i=new Uint8Array(e),s=new Uint8Array(t),o=i.slice(0),a=o.length-1,l=s.slice(0),c=l.length-1,u=0;for(let e=c;e>=0;e--,u++)!0==(r=o[a-u]-l[c-u]-n)<0?(n=1,o[a-u]=r+10):(n=0,o[a-u]=r);if(n>0)for(let e=a-c+1;e>=0;e--,u++)if((r=o[a-u]-n)<0)n=1,o[a-u]=r+10;else{n=0,o[a-u]=r;break}return o.slice()}C=Er,(()=>{vG.BitString=C})(),Er.NAME=vj;class Eo extends vH(vq){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=vg.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),void 0!==e&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(vm(e))}get valueDec(){return this._valueDec}fromDER(e,t,r,n=0){let i=this.fromBER(e,t,r);if(-1===i)return i;let s=this.valueHexView;return 0===s[0]&&(128&s[1])!=0?this.valueHexView=s.subarray(1):0!==n&&s.length<n&&(n-s.length>1&&(n=s.length+1),this.valueHexView=s.subarray(n-s.length)),i}toDER(e=!1){let t=this.valueHexView;switch(!0){case(128&t[0])!=0:{let e=new Uint8Array(this.valueHexView.length+1);e[0]=0,e.set(t,1),this.valueHexView=e}break;case 0===t[0]&&(128&t[1])==0:this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(e)}fromBER(e,t,r){let n=super.fromBER(e,t,r);return -1===n||this.setValueHex(),n}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){let e,t=8*this.valueHexView.length-1,r=new Uint8Array(8*this.valueHexView.length/3),n=0,i=this.valueHexView,s="",o=!1;for(let o=i.byteLength-1;o>=0;o--){e=i[o];for(let i=0;i<8;i++)(1&e)==1&&(n===t?(r=Es(Ei(n),r),s="-"):r=En(r,Ei(n))),n++,e>>=1}for(let e=0;e<r.length;e++)r[e]&&(o=!0),o&&(s+=vS.charAt(r[e]));return!1===o&&(s+=vS.charAt(0)),s}}P=Eo,Eo.NAME="IntegerValueBlock",(()=>{Object.defineProperty(P.prototype,"valueHex",{set:function(e){this.valueHexView=new Uint8Array(e),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}})})();class Ea extends vK{constructor(e={}){super(e,Eo),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return vw(),BigInt(this.valueBlock.toString())}static fromBigInt(e){vw();let t=BigInt(e),r=new vA,n=t.toString(16).replace(/^-/,""),i=new Uint8Array(vd.U$.FromHex(n));if(t<0){let e=new Uint8Array(i.length+(128&i[0]?1:0));e[0]|=128;let n=BigInt(`0x${vd.U$.ToHex(e)}`)+t,s=vd._H.toUint8Array(vd.U$.FromHex(n.toString(16)));s[0]|=128,r.write(s)}else 128&i[0]&&r.write(new Uint8Array([0])),r.write(i);return new R({valueHex:r.final()})}convertToDER(){let e=new R({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new R({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}R=Ea,(()=>{vG.Integer=R})(),Ea.NAME="INTEGER";class El extends Ea{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}D=El,(()=>{vG.Enumerated=D})(),El.NAME="ENUMERATED";class Ec extends vH(vq){constructor({valueDec:e=-1,isFirstSid:t=!1,...r}={}){super(r),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,r){if(!r)return t;let n=vd._H.toUint8Array(e);if(!vE(this,n,t,r))return -1;let i=n.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let e=0;e<r&&(this.valueHexView[e]=127&i[e],this.blockLength++,(128&i[e])!=0);e++);let s=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength;e++)s[e]=this.valueHexView[e];return(this.valueHexView=s,(128&i[this.blockLength-1])!=0)?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=vh(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){vw();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;let r=new Uint8Array(t.length/7);for(let e=0;e<r.length;e++)r[e]=parseInt(t.slice(7*e,7*e+7),2)+128*(e+1<r.length);this.fromBER(r.buffer,0,r.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let t=this.valueHexView,r=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)r[e]=128|t[e];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}let t=vf(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",vO;let r=new Uint8Array(t.byteLength);if(!e){let e=new Uint8Array(t),n=t.byteLength-1;for(let t=0;t<n;t++)r[t]=128|e[t];r[n]=e[n]}return r}toString(){let e="";if(this.isHexOnly)e=vd.U$.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}Ec.NAME="sidBlock";class Eu extends vq{constructor({value:e=vB,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let n=t;for(;r>0;){let t=new Ec;if(-1===(n=t.fromBER(e,n,r))){this.blockLength=0,this.error=t.error;break}0===this.value.length&&(t.isFirstSid=!0),this.blockLength+=t.blockLength,r-=t.blockLength,this.value.push(t)}return n}toBER(e){let t=[];for(let r=0;r<this.value.length;r++){let n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,vO;t.push(n)}return vv(t)}fromString(e){this.value=[];let t=0,r=0,n="",i=!1;do if(n=-1===(r=e.indexOf(".",t))?e.substring(t):e.substring(t,r),t=r+1,i){let e=this.value[0],t=0;switch(e.valueDec){case 0:break;case 1:t=40;break;case 2:t=80;break;default:this.value=[];return}let r=parseInt(n,10);if(isNaN(r))return;e.valueDec=r+t,i=!1}else{let e=new Ec;if(n>Number.MAX_SAFE_INTEGER)vw(),e.valueBigInt=BigInt(n);else if(e.valueDec=parseInt(n,10),isNaN(e.valueDec))return;this.value.length||(e.isFirstSid=!0,i=!0),this.value.push(e)}while(-1!==r)}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let n=this.value[r].toString();0!==r&&(e=`${e}.`),t?(n=`{${n}}`,this.value[r].isFirstSid?e=`2.{${n} - 80}`:e+=n):e+=n}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}Eu.NAME="ObjectIdentifierValueBlock";class Ed extends vK{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,Eu),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}N=Ed,(()=>{vG.ObjectIdentifier=N})(),Ed.NAME="OBJECT IDENTIFIER";class Eh extends vH(v$){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,r){if(0===r)return t;let n=vd._H.toUint8Array(e);if(!vE(this,n,t,r))return -1;let i=n.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let e=0;e<r&&(this.valueHexView[e]=127&i[e],this.blockLength++,(128&i[e])!=0);e++);let s=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength;e++)s[e]=this.valueHexView[e];return(this.valueHexView=s,(128&i[this.blockLength-1])!=0)?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=vh(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let t=this.valueHexView,r=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)r[e]=128|t[e];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}let t=vf(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",vO;let r=new Uint8Array(t.byteLength);if(!e){let e=new Uint8Array(t),n=t.byteLength-1;for(let t=0;t<n;t++)r[t]=128|e[t];r[n]=e[n]}return r.buffer}toString(){let e="";return this.isHexOnly?vd.U$.ToHex(this.valueHexView):this.valueDec.toString()}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}Eh.NAME="relativeSidBlock";class Ef extends vq{constructor({value:e=vB,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let n=t;for(;r>0;){let t=new Eh;if(-1===(n=t.fromBER(e,n,r))){this.blockLength=0,this.error=t.error;break}this.blockLength+=t.blockLength,r-=t.blockLength,this.value.push(t)}return n}toBER(e,t){let r=[];for(let t=0;t<this.value.length;t++){let n=this.value[t].toBER(e);if(0===n.byteLength)return this.error=this.value[t].error,vO;r.push(n)}return vv(r)}fromString(e){this.value=[];let t=0,r=0,n="";do{n=-1===(r=e.indexOf(".",t))?e.substring(t):e.substring(t,r),t=r+1;let i=new Eh;if(i.valueDec=parseInt(n,10),isNaN(i.valueDec))break;this.value.push(i)}while(-1!==r);return!0}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let n=this.value[r].toString();0!==r&&(e=`${e}.`),t?e+=n=`{${n}}`:e+=n}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}Ef.NAME="RelativeObjectIdentifierValueBlock";class Ep extends vK{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,Ef),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}M=Ep,(()=>{vG.RelativeObjectIdentifier=M})(),Ep.NAME="RelativeObjectIdentifier";class Eg extends v3{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}B=Eg,(()=>{vG.Sequence=B})(),Eg.NAME="SEQUENCE";class Em extends v3{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}O=Em,(()=>{vG.Set=O})(),Em.NAME="SET";class Ey extends vH(vq){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=vB}toJSON(){return{...super.toJSON(),value:this.value}}}Ey.NAME="StringValueBlock";class Eb extends Ey{}Eb.NAME="SimpleStringValueBlock";class Ew extends vQ{constructor({...e}={}){super(e,Eb)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,vd._H.toUint8Array(e))}fromString(e){let t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);this.valueBlock.value=e}}Ew.NAME="SIMPLE STRING";class Ev extends Ew{fromBuffer(e){this.valueBlock.valueHexView=vd._H.toUint8Array(e);try{this.valueBlock.value=vd.U$.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=vd.U$.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(vd.U$.FromUtf8String(e)),this.valueBlock.value=e}}Ev.NAME="Utf8StringValueBlock";class EE extends Ev{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}L=EE,(()=>{vG.Utf8String=L})(),EE.NAME="UTF8String";class EA extends Ew{fromBuffer(e){this.valueBlock.value=vd.U$.ToUtf16String(e),this.valueBlock.valueHexView=vd._H.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(vd.U$.FromUtf16String(e))}}EA.NAME="BmpStringValueBlock";class Ex extends EA{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}F=Ex,(()=>{vG.BmpString=F})(),Ex.NAME="BMPString";class ES extends Ew{fromBuffer(e){let t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t);for(let e=0;e<r.length;e+=4)r[e]=r[e+3],r[e+1]=r[e+2],r[e+2]=0,r[e+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){let t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(4*t);for(let n=0;n<t;n++){let t=new Uint8Array(vf(e.charCodeAt(n),8));if(t.length>4)continue;let i=4-t.length;for(let e=t.length-1;e>=0;e--)r[4*n+e+i]=t[e]}this.valueBlock.value=e}}ES.NAME="UniversalStringValueBlock";class Ek extends ES{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}U=Ek,(()=>{vG.UniversalString=U})(),Ek.NAME="UniversalString";class E_ extends Ew{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}j=E_,(()=>{vG.NumericString=j})(),E_.NAME="NumericString";class EI extends Ew{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}H=EI,(()=>{vG.PrintableString=H})(),EI.NAME="PrintableString";class ET extends Ew{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}$=ET,(()=>{vG.TeletexString=$})(),ET.NAME="TeletexString";class EC extends Ew{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}q=EC,(()=>{vG.VideotexString=q})(),EC.NAME="VideotexString";class EP extends Ew{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}z=EP,(()=>{vG.IA5String=z})(),EP.NAME="IA5String";class ER extends Ew{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}V=ER,(()=>{vG.GraphicString=V})(),ER.NAME="GraphicString";class ED extends Ew{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}G=ED,(()=>{vG.VisibleString=G})(),ED.NAME="VisibleString";class EN extends Ew{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}K=EN,(()=>{vG.GeneralString=K})(),EN.NAME="GeneralString";class EM extends Ew{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}W=EM,(()=>{vG.CharacterString=W})(),EM.NAME="CharacterString";class EB extends ED{constructor({value:e,valueDate:t,...r}={}){if(super(r),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let t=0;t<e.length;t++)this.valueBlock.valueHexView[t]=e.charCodeAt(t)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,vd._H.toUint8Array(e)))}toBuffer(){let e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){let t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(null===t){this.error="Wrong input string for conversion";return}let r=parseInt(t[1],10);r>=50?this.year=1900+r:this.year=2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}toString(e="iso"){if("iso"===e){let e=Array(7);return e[0]=vb(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=vb(this.month,2),e[2]=vb(this.day,2),e[3]=vb(this.hour,2),e[4]=vb(this.minute,2),e[5]=vb(this.second,2),e[6]="Z",e.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}Q=EB,(()=>{vG.UTCTime=Q})(),EB.NAME="UTCTime";class EO extends EB{constructor(e={}){var t;super(e),null!=(t=this.millisecond)||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(e){let t,r=!1,n="",i="",s=0,o=0,a=0;if("Z"===e[e.length-1])n=e.substring(0,e.length-1),r=!0;else{if(isNaN(new Number(e[e.length-1]).valueOf()))throw Error("Wrong input string for conversion");n=e}if(r){if(-1!==n.indexOf("+")||-1!==n.indexOf("-"))throw Error("Wrong input string for conversion")}else{let e=1,t=n.indexOf("+"),r="";if(-1===t&&(t=n.indexOf("-"),e=-1),-1!==t){if(r=n.substring(t+1),n=n.substring(0,t),2!==r.length&&4!==r.length)throw Error("Wrong input string for conversion");let i=parseInt(r.substring(0,2),10);if(isNaN(i.valueOf()))throw Error("Wrong input string for conversion");if(o=e*i,4===r.length){if(isNaN((i=parseInt(r.substring(2,4),10)).valueOf()))throw Error("Wrong input string for conversion");a=e*i}}}let l=n.indexOf(".");if(-1===l&&(l=n.indexOf(",")),-1!==l){let e=new Number(`0${n.substring(l)}`);if(isNaN(e.valueOf()))throw Error("Wrong input string for conversion");s=e.valueOf(),i=n.substring(0,l)}else i=n;switch(!0){case 8===i.length:if(t=/(\d{4})(\d{2})(\d{2})/ig,-1!==l)throw Error("Wrong input string for conversion");break;case 10===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,-1!==l){let e=60*s;this.minute=Math.floor(e),e=60*(e-this.minute),this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 12===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,-1!==l){let e=60*s;this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 14===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,-1!==l){let e=1e3*s;this.millisecond=Math.floor(e)}break;default:throw Error("Wrong input string for conversion")}let c=t.exec(i);if(null===c)throw Error("Wrong input string for conversion");for(let e=1;e<c.length;e++)switch(e){case 1:this.year=parseInt(c[e],10);break;case 2:this.month=parseInt(c[e],10);break;case 3:this.day=parseInt(c[e],10);break;case 4:this.hour=parseInt(c[e],10)+o;break;case 5:this.minute=parseInt(c[e],10)+a;break;case 6:this.second=parseInt(c[e],10);break;default:throw Error("Wrong input string for conversion")}if(!1===r){let e=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=e.getUTCFullYear(),this.month=e.getUTCMonth(),this.day=e.getUTCDay(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}}toString(e="iso"){if("iso"===e){let e=[];return e.push(vb(this.year,4)),e.push(vb(this.month,2)),e.push(vb(this.day,2)),e.push(vb(this.hour,2)),e.push(vb(this.minute,2)),e.push(vb(this.second,2)),0!==this.millisecond&&(e.push("."),e.push(vb(this.millisecond,3))),e.push("Z"),e.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}J=EO,(()=>{vG.GeneralizedTime=J})(),EO.NAME="GeneralizedTime";class EL extends EE{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}Z=EL,(()=>{vG.DATE=Z})(),EL.NAME="DATE";class EF extends EE{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}Y=EF,(()=>{vG.TimeOfDay=Y})(),EF.NAME="TimeOfDay";class EU extends EE{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}X=EU,(()=>{vG.DateTime=X})(),EU.NAME="DateTime";class Ej extends EE{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}ee=Ej,(()=>{vG.Duration=ee})(),Ej.NAME="Duration";class EH extends EE{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}et=EH,(()=>{vG.TIME=et})(),EH.NAME="TIME";class E${constructor({name:e=vB,optional:t=!1}={}){this.name=e,this.optional=t}}class Eq extends E${constructor({value:e=[],...t}={}){super(t),this.value=e}}class Ez extends E${constructor({value:e=new E$,local:t=!1,...r}={}){super(r),this.value=e,this.local=t}}let EV=16,EG=32,EK=1e4;async function EW(e,t){let r=vu(),n=await r.encrypt(e,t);return oN.base64.encode(n)}async function EQ(e,t,r){if("RSA"===e.type)return EX(e,t,r);if("Ed25519"===e.type)return EJ(e,t,r);if("secp256k1"===e.type)return EZ(e,t,r);if("ECDSA"===e.type)return EY(e,t,r);throw new cH}async function EJ(e,t,r="libp2p-key"){if("libp2p-key"===r)return EW(p7(e),t);throw new cy(`export format '${r}' is not supported`)}async function EZ(e,t,r="libp2p-key"){if("libp2p-key"===r)return EW(p7(e),t);throw new cy("Export format is not supported")}async function EY(e,t,r="libp2p-key"){if("libp2p-key"===r)return EW(p7(e),t);throw new cy(`export format '${r}' is not supported`)}async function EX(e,t,r="pkcs-8"){if("pkcs-8"===r)return E0(e,t);if("libp2p-key"===r)return EW(p7(e),t);throw new cy("Export format is not supported")}async function E0(e,t){let r=fq.get(),n=new Eg({value:[new Ea({value:0}),new Eg({value:[new Ed({value:"1.2.840.113549.1.1.1"}),new v6]}),new Ee({valueHex:e.raw})]}).toBER(),i=new Uint8Array(n,0,n.byteLength),s=vi(EV),o=await w2(vt,t,s,{c:EK,dkLen:EG}),a=vi(16),l=await r.subtle.importKey("raw",o,"AES-CBC",!1,["encrypt"]),c=await r.subtle.encrypt({name:"AES-CBC",iv:a},l,i),u=new Eg({value:[new Ee({valueHex:s}),new Ea({value:EK}),new Ea({value:EG}),new Eg({value:[new Ed({value:"1.2.840.113549.2.11"}),new v6]})]}),d=new Eg({value:[new Ed({value:"1.2.840.113549.1.5.13"}),new Eg({value:[new Eg({value:[new Ed({value:"1.2.840.113549.1.5.12"}),u]}),new Eg({value:[new Ed({value:"2.16.840.1.101.3.4.1.42"}),new Ee({valueHex:a})]})]})]}),h=new Eg({value:[d,new Ee({valueHex:c})]}).toBER(),f=new Uint8Array(h,0,h.byteLength);return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...(0,uC.d)(f,"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join("\n")}async function E1(e,t){try{let r=await E2(e,t);return p6(r)}catch{}if(!e.includes("BEGIN"))throw new cy("Encrypted key was not a libp2p-key or a PEM file");return E3(e,t)}async function E2(e,t){let r=oN.base64.decode(e);return vu().decrypt(r,t)}async function E3(e,t){let r,n=fq.get();if(e.includes("-----BEGIN ENCRYPTED PRIVATE KEY-----")){let{result:i}=v0((0,rx.s)(e.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad")),{iv:s,salt:o,iterations:a,keySize:l,cipherText:c}=E4(i),u=await w2(vt,t,o,{c:a,dkLen:l}),d=await n.subtle.importKey("raw",u,"AES-CBC",!1,["decrypt"]),{result:h}=v0(E6(await n.subtle.decrypt({name:"AES-CBC",iv:s},d,c)));r=E5(h)}else if(e.includes("-----BEGIN PRIVATE KEY-----")){let{result:t}=v0((0,rx.s)(e.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"));r=E5(t)}else throw new cy("Could not parse private key from PEM data");let i=p8(r);if("RSA"!==i.type)throw new cy("Could not parse RSA private key from PEM data");return i}function E4(e){let t=e.valueBlock.value[0];if("OBJECT IDENTIFIER : 1.2.840.113549.1.5.13"!==t.valueBlock.value[0].toString())throw new cy("Only pkcs5PBES2 encrypted private keys are supported");let r=t.valueBlock.value[1].valueBlock.value[0];if("OBJECT IDENTIFIER : 1.2.840.113549.1.5.12"!==r.valueBlock.value[0].toString())throw new cy("Only pkcs5PBKDF2 key derivation functions are supported");let n=r.valueBlock.value[1],i=E6(n.valueBlock.value[0].getValue()),s=EK,o=EG;if(3===n.valueBlock.value.length)s=Number(n.valueBlock.value[1].toBigInt()),o=Number(n.valueBlock.value[2].toBigInt());else if(2===n.valueBlock.value.length)throw new cy("Could not derive key size and iterations from PEM file - please use @libp2p/rsa to re-import your key");let a=t.valueBlock.value[1].valueBlock.value[1],l=a.valueBlock.value[0].toString();if("OBJECT IDENTIFIER : 1.2.840.113549.3.7"===l);else if("OBJECT IDENTIFIER : 1.3.14.3.2.7"===l);else if("OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.2"===l);else if("OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.22"===l);else if("OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.42"===l);else throw new cy("Only AES-CBC encryption schemes are supported");let c=E6(a.valueBlock.value[1].getValue());return{cipherText:E6(e.valueBlock.value[1].getValue()),salt:i,iterations:s,keySize:o,iv:c}}function E5(e){return E6(e.valueBlock.value[2].getValue())}function E6(e){return new Uint8Array(e,0,e.byteLength)}let E8="/pkcs8/",E7="/info/",E9=new WeakMap,Ae={minKeyLength:14,minSaltLength:16,minIterationCount:1e3},At={dek:{keyLength:64,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function Ar(e){return null!=e&&"string"==typeof e&&e===vl(e.trim())&&e.length>0}async function An(){let e=800*Math.random()+200;await new Promise(t=>setTimeout(t,e))}function Ai(e){return new va.U(E8+e)}function As(e){return new va.U(E7+e)}async function Ao(e){let t=p7(e),r=await rX.sha256.digest(t);return uW.base58btc.encode(r.bytes).substring(1)}class Aa{components;init;log;self;constructor(e,t){if(this.components=e,this.log=e.logger.forComponent("libp2p:keychain"),this.init=aM(At,t),this.self=t.selfKey??"self",null!=this.init.pass&&this.init.pass?.length<20)throw Error("pass must be least 20 characters");if(this.init.dek?.keyLength!=null&&this.init.dek.keyLength<Ae.minKeyLength)throw Error(`dek.keyLength must be least ${Ae.minKeyLength} bytes`);if(this.init.dek?.salt?.length!=null&&this.init.dek.salt.length<Ae.minSaltLength)throw Error(`dek.saltLength must be least ${Ae.minSaltLength} bytes`);if(this.init.dek?.iterationCount!=null&&this.init.dek.iterationCount<Ae.minIterationCount)throw Error(`dek.iterationCount must be least ${Ae.minIterationCount}`);let r=null!=this.init.pass&&this.init.dek?.salt!=null?vn(this.init.pass,this.init.dek?.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";E9.set(this,{dek:r})}[Symbol.toStringTag]="@libp2p/keychain";[vs]=["@libp2p/keychain"];static generateOptions(){let e=Object.assign({},At),t=3*Math.ceil(Ae.minSaltLength/3);return e.dek.salt=(0,uC.d)(vi(t),"base64"),e}static get options(){return At}async findKeyByName(e){if(!Ar(e))throw await An(),new cy(`Invalid key name '${e}'`);let t=As(e);try{let e=await this.components.datastore.get(t);return JSON.parse((0,uC.d)(e))}catch(t){throw await An(),this.log.error(t),new c_(`Key '${e}' does not exist.`)}}async findKeyById(e){try{let t={prefix:E7};for await(let r of this.components.datastore.query(t)){let t=JSON.parse((0,uC.d)(r.value));if(t.id===e)return t}throw new cy(`Key with id '${e}' does not exist.`)}catch(e){throw await An(),e}}async importKey(e,t){let r,n;if(!Ar(e))throw await An(),new cy(`Invalid key name '${e}'`);if(null==t)throw await An(),new cy("Key is required");let i=Ai(e);if(await this.components.datastore.has(i))throw await An(),new cy(`Key '${e}' already exists`);try{r=await Ao(t);let e=E9.get(this);if(null==e)throw new cy("dek missing");let i=e.dek;n=await EQ(t,i,"RSA"===t.type?"pkcs-8":"libp2p-key")}catch(e){throw await An(),e}let s={name:e,id:r},o=this.components.datastore.batch();return o.put(i,(0,rx.s)(n)),o.put(As(e),(0,rx.s)(JSON.stringify(s))),await o.commit(),s}async exportKey(e){if(!Ar(e))throw await An(),new cy(`Invalid key name '${e}'`);let t=Ai(e);try{let e=await this.components.datastore.get(t),r=(0,uC.d)(e),n=E9.get(this);if(null==n)throw new cy("dek missing");let i=n.dek;return await E1(r,i)}catch(e){throw await An(),e}}async removeKey(e){if(!Ar(e)||e===this.self)throw await An(),new cy(`Invalid key name '${e}'`);let t=Ai(e),r=await this.findKeyByName(e),n=this.components.datastore.batch();return n.delete(t),n.delete(As(e)),await n.commit(),r}async listKeys(){let e={prefix:E7},t=[];for await(let r of this.components.datastore.query(e))t.push(JSON.parse((0,uC.d)(r.value)));return t}async renameKey(e,t){if(!Ar(e)||e===this.self)throw await An(),new cy(`Invalid old key name '${e}'`);if(!Ar(t)||t===this.self)throw await An(),new cy(`Invalid new key name '${t}'`);let r=Ai(e),n=Ai(t),i=As(e),s=As(t);if(await this.components.datastore.has(n))throw await An(),new cy(`Key '${t}' already exists`);try{let e=await this.components.datastore.get(r),o=await this.components.datastore.get(i),a=JSON.parse((0,uC.d)(o));a.name=t;let l=this.components.datastore.batch();return l.put(n,e),l.put(s,(0,rx.s)(JSON.stringify(a))),l.delete(r),l.delete(i),await l.commit(),a}catch(e){throw await An(),e}}async rotateKeychainPass(e,t){if("string"!=typeof e)throw await An(),new cy(`Invalid old pass type '${typeof e}'`);if("string"!=typeof t)throw await An(),new cy(`Invalid new pass type '${typeof t}'`);if(t.length<20)throw await An(),new cy(`Invalid pass length ${t.length}`);this.log("recreating keychain");let r=E9.get(this);if(null==r)throw new cy("dek missing");let n=r.dek;this.init.pass=t;let i=null!=t&&this.init.dek?.salt!=null?vn(t,this.init.dek.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";for(let e of(E9.set(this,{dek:i}),await this.listKeys())){let t=await this.components.datastore.get(Ai(e.name)),r=(0,uC.d)(t),s=await E1(r,n),o=i.toString(),a=await EQ(s,o,"RSA"===s.type?"pkcs-8":"libp2p-key"),l=this.components.datastore.batch(),c={name:e.name,id:e.id};l.put(Ai(e.name),(0,rx.s)(a)),l.put(As(e.name),(0,rx.s)(JSON.stringify(c))),await l.commit()}this.log("keychain reconstructed")}}function Al(e={}){return t=>new Aa(t,e)}async function Ac(e,t={}){let r,n=t.selfKey??"self",i=Al(t)({datastore:e,logger:(0,aB.Um)()});return await e.has(new b1.U(`/pkcs8/${n}`))?r=await i.exportKey(n):(r=await p1(t.keyType??"Ed25519"),await i.importKey(n,r)),r}let Au=Symbol.for("@libp2p/transport");!function(e){e[e.FATAL_ALL=0]="FATAL_ALL",e[e.NO_FATAL=1]="NO_FATAL"}(er||(er={}));let Ad=32,{code:Ah}=yl("dnsaddr");class Af extends Error{constructor(e="Max recursive depth reached"){super(e),this.name="RecursionLimitError"}}let Ap=async function(e,t={}){let r=t.maxRecursiveDepth??Ad;if(0===r)throw new Af("Max recursive depth reached");let[,n]=e.stringTuples().find(([e])=>e===Ah)??[],i=t?.dns??b0(),s=await i.query(`_dnsaddr.${n}`,{signal:t?.signal,types:[A.TXT]}),o=e.getPeerId(),a=[];for(let e of s.Answer){let n=e.data.replace(/["']/g,"").trim().split("=")[1];if(null==n||null!=o&&!n.includes(o))continue;let i=yz(n);if(n.startsWith("/dnsaddr")){let e=await i.resolve({...t,maxRecursiveDepth:r-1});a.push(...e.map(e=>e.toString()))}else a.push(i.toString())}return a},Ag={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:e=>e},connectionManager:{resolvers:{dnsaddr:Ap}},transportManager:{faultTolerance:er.FATAL_ALL}};async function Am(e){let t=aM(Ag,e);if(null===t.connectionProtector&&globalThis.process?.env?.LIBP2P_FORCE_PNET!=null)throw new cy("Private network is enforced, but no protector was provided");return t}let Ay=Symbol.for("@libp2p/peer-discovery");class Ab{set;constructor(e){if(this.set=new Set,null!=e)for(let t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return gv(this.set.entries(),e=>{let t=gE(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{let r=gE(t);e(r,r,this)})}has(e){return this.set.has(e.toString())}values(){return gv(this.set.values(),e=>gE(e))}intersection(e){let t=new Ab;for(let r of e)this.has(r)&&t.add(r);return t}difference(e){let t=new Ab;for(let r of this)e.has(r)||t.add(r);return t}union(e){let t=new Ab;for(let r of e)t.add(r);for(let e of this)t.add(e);return t}}function Aw(){return new Ab}!function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.publicKey&&e.publicKey.byteLength>0&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.payloadType&&e.payloadType.byteLength>0&&(t.uint32(18),t.bytes(e.payloadType)),null!=e.payload&&e.payload.byteLength>0&&(t.uint32(26),t.bytes(e.payload)),null!=e.signature&&e.signature.byteLength>0&&(t.uint32(42),t.bytes(e.signature)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={publicKey:(0,to.c)(0),payloadType:(0,to.c)(0),payload:(0,to.c)(0),signature:(0,to.c)(0)},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.publicKey=e.bytes();break;case 2:n.payloadType=e.bytes();break;case 3:n.payload=e.bytes();break;case 5:n.signature=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(en||(en={}));class Av extends Error{constructor(e="Invalid signature"){super(e),this.name="InvalidSignatureError"}}class AE{static createFromProtobuf=async e=>{let t=en.decode(e);return new AE({publicKey:p2(t.publicKey),payloadType:t.payloadType,payload:t.payload,signature:t.signature})};static seal=async(e,t)=>{if(null==t)throw Error("Missing private key");let r=e.domain,n=e.codec,i=e.marshal(),s=AA(r,n,i),o=await t.sign(s.subarray());return new AE({publicKey:t.publicKey,payloadType:n,payload:i,signature:o})};static openAndCertify=async(e,t)=>{let r=await AE.createFromProtobuf(e);if(!await r.validate(t))throw new Av("Envelope signature is not valid for the given domain");return r};publicKey;payloadType;payload;signature;marshaled;constructor(e){let{publicKey:t,payloadType:r,payload:n,signature:i}=e;this.publicKey=t,this.payloadType=r,this.payload=n,this.signature=i}marshal(){return null==this.marshaled&&(this.marshaled=en.encode({publicKey:p5(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return tc(this.marshal(),e.marshal())}async validate(e){let t=AA(e,this.payloadType,this.payload);return this.publicKey.verify(t.subarray(),this.signature)}}let AA=(e,t,r)=>{let n=(0,rx.s)(e),i=re(n.byteLength);return new tf(i,n,re(t.length),t,re(r.length),r)};function Ax(e,t){let r=(e,t)=>e.toString().localeCompare(t.toString());return e.length===t.length&&(t.sort(r),e.sort(r).every((e,r)=>t[r].equals(e)))}let AS="libp2p-peer-record",Ak=Uint8Array.from([3,1]);!function(e){let t,r;!function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.multiaddr&&e.multiaddr.byteLength>0&&(t.uint32(10),t.bytes(e.multiaddr)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={multiaddr:(0,to.c)(0)},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();t>>>3==1?n.multiaddr=e.bytes():e.skipType(7&t)}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(t=e.AddressInfo||(e.AddressInfo={})),e.codec=()=>(null==r&&(r=rq((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.peerId&&t.peerId.byteLength>0&&(r.uint32(10),r.bytes(t.peerId)),null!=t.seq&&0n!==t.seq&&(r.uint32(16),r.uint64(t.seq)),null!=t.addresses)for(let n of t.addresses)r.uint32(26),e.AddressInfo.codec().encode(n,r);!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={peerId:(0,to.c)(0),seq:0n,addresses:[]},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.peerId=t.bytes();break;case 2:i.seq=t.uint64();break;case 3:if(n.limits?.addresses!=null&&i.addresses.length===n.limits.addresses)throw new rz('Decode error - map field "addresses" had too many elements');i.addresses.push(e.AddressInfo.codec().decode(t,t.uint32(),{limits:n.limits?.addresses$}));break;default:t.skipType(7&r)}}return i})),r),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(ei||(ei={}));class A_{static createFromProtobuf=e=>{let t=ei.decode(e),r=gm(o0.decode(t.peerId));return new A_({peerId:r,multiaddrs:(t.addresses??[]).map(e=>yz(e.multiaddr)),seqNumber:t.seq})};static DOMAIN=AS;static CODEC=Ak;peerId;multiaddrs;seqNumber;domain=A_.DOMAIN;codec=A_.CODEC;marshaled;constructor(e){let{peerId:t,multiaddrs:r,seqNumber:n}=e;this.peerId=t,this.multiaddrs=r??[],this.seqNumber=n??BigInt(Date.now())}marshal(){return null==this.marshaled&&(this.marshaled=ei.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return e instanceof A_&&!!this.peerId.equals(e.peerId)&&this.seqNumber===e.seqNumber&&!!Ax(this.multiaddrs,e.multiaddrs)}}let AI=36e5,AT=216e5;function AC(e,t){let r;if(null!=e.publicKey||null==t.publicKey)return e;if("RSA"===e.type){let t=uW.base58btc.decode(`z${e}`);r=o0.decode(t)}return gp(p2(t.publicKey,r))}function AP(e,t,r){return AR(e,es.decode(t),r)}function AR(e,t,r){let n=new Map,i=BigInt(Date.now());for(let[e,r]of t.tags.entries())null!=r.expiry&&r.expiry<i||n.set(e,r);return{...t,id:AC(e,t),addresses:t.addresses.filter(({observed:e})=>null!=e&&e>Date.now()-r).map(({multiaddr:e,isCertified:t})=>({multiaddr:yz(e),isCertified:t??!1})),metadata:t.metadata,peerRecordEnvelope:t.peerRecordEnvelope??void 0,tags:n}}function AD(e,t){return AN(e.addresses,t.addresses)&&AM(e.protocols,t.protocols)&&AB(e.publicKey,t.publicKey)&&AO(e.peerRecordEnvelope,t.peerRecordEnvelope)&&AL(e.metadata,t.metadata)&&AF(e.tags,t.tags)}function AN(e,t){return Aj(e,t,(e,t)=>e.isCertified===t.isCertified&&!!tc(e.multiaddr,t.multiaddr))}function AM(e,t){return Aj(e,t,(e,t)=>e===t)}function AB(e,t){return AU(e,t)}function AO(e,t){return AU(e,t)}function AL(e,t){return AH(e,t,(e,t)=>tc(e,t))}function AF(e,t){return AH(e,t,(e,t)=>e.value===t.value&&e.expiry===t.expiry)}function AU(e,t){return null==e&&null==t||null!=e&&null!=t&&tc(e,t)}function Aj(e,t,r){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!r(e[n],t[n]))return!1;return!0}function AH(e,t,r){if(e.size!==t.size)return!1;for(let[n,i]of e.entries()){let e=t.get(n);if(null==e||!r(i,e))return!1}return!0}!function(e){let t,r,n;!function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.key&&""!==e.key&&(t.uint32(10),t.string(e.key)),null!=e.value&&e.value.byteLength>0&&(t.uint32(18),t.bytes(e.value)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={key:"",value:(0,to.c)(0)},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.key=e.string();break;case 2:n.value=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(t=e.Peer$metadataEntry||(e.Peer$metadataEntry={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.key&&""!==e.key&&(t.uint32(10),t.string(e.key)),null!=e.value&&(t.uint32(18),ea.codec().encode(e.value,t)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={key:""},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.key=e.string();break;case 2:n.value=ea.codec().decode(e,e.uint32(),{limits:r.limits?.value});break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(r=e.Peer$tagsEntry||(e.Peer$tagsEntry={})),e.codec=()=>(null==n&&(n=rq((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.addresses)for(let e of t.addresses)r.uint32(10),eo.codec().encode(e,r);if(null!=t.protocols)for(let e of t.protocols)r.uint32(18),r.string(e);if(null!=t.publicKey&&(r.uint32(34),r.bytes(t.publicKey)),null!=t.peerRecordEnvelope&&(r.uint32(42),r.bytes(t.peerRecordEnvelope)),null!=t.metadata&&0!==t.metadata.size)for(let[n,i]of t.metadata.entries())r.uint32(50),e.Peer$metadataEntry.codec().encode({key:n,value:i},r);if(null!=t.tags&&0!==t.tags.size)for(let[n,i]of t.tags.entries())r.uint32(58),e.Peer$tagsEntry.codec().encode({key:n,value:i},r);null!=t.updated&&(r.uint32(64),r.uint64Number(t.updated)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={addresses:[],protocols:[],metadata:new Map,tags:new Map},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:if(n.limits?.addresses!=null&&i.addresses.length===n.limits.addresses)throw new rz('Decode error - map field "addresses" had too many elements');i.addresses.push(eo.codec().decode(t,t.uint32(),{limits:n.limits?.addresses$}));break;case 2:if(n.limits?.protocols!=null&&i.protocols.length===n.limits.protocols)throw new rz('Decode error - map field "protocols" had too many elements');i.protocols.push(t.string());break;case 4:i.publicKey=t.bytes();break;case 5:i.peerRecordEnvelope=t.bytes();break;case 6:{if(n.limits?.metadata!=null&&i.metadata.size===n.limits.metadata)throw new rV('Decode error - map field "metadata" had too many elements');let r=e.Peer$metadataEntry.codec().decode(t,t.uint32());i.metadata.set(r.key,r.value);break}case 7:{if(n.limits?.tags!=null&&i.tags.size===n.limits.tags)throw new rV('Decode error - map field "tags" had too many elements');let r=e.Peer$tagsEntry.codec().decode(t,t.uint32(),{limits:{value:n.limits?.tags$value}});i.tags.set(r.key,r.value);break}case 8:i.updated=t.uint64Number();break;default:t.skipType(7&r)}}return i})),n),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(es||(es={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.multiaddr&&e.multiaddr.byteLength>0&&(t.uint32(10),t.bytes(e.multiaddr)),null!=e.isCertified&&(t.uint32(16),t.bool(e.isCertified)),null!=e.observed&&(t.uint32(24),t.uint64Number(e.observed)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={multiaddr:(0,to.c)(0)},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.multiaddr=e.bytes();break;case 2:n.isCertified=e.bool();break;case 3:n.observed=e.uint64Number();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(eo||(eo={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.value&&0!==e.value&&(t.uint32(8),t.uint32(e.value)),null!=e.expiry&&(t.uint32(16),t.uint64(e.expiry)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={value:0},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.value=e.uint32();break;case 2:n.expiry=e.uint64();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(ea||(ea={}));let A$="/peers/";function Aq(e){if(!gr(e)||null==e.type)throw new cy("Invalid PeerId");let t=e.toCID().toString();return new va.U(`${A$}${t}`)}async function Az(e,t,r,n){let i=new Map;for(let n of r){if(null==n)continue;if(n.multiaddr instanceof Uint8Array&&(n.multiaddr=yz(n.multiaddr)),!yq(n.multiaddr))throw new cy("Multiaddr was invalid");if(!await t(e,n.multiaddr))continue;let r=n.isCertified??!1,s=n.multiaddr.toString(),o=i.get(s);null!=o?n.isCertified=o.isCertified||r:i.set(s,{multiaddr:n.multiaddr,isCertified:r})}return[...i.values()].sort((e,t)=>e.multiaddr.toString().localeCompare(t.multiaddr.toString())).map(({isCertified:e,multiaddr:t})=>({isCertified:e,multiaddr:t.bytes}))}async function AV(e,t,r,n){let i;if(null==t)throw new cy("Invalid PeerData");if(null!=t.publicKey&&null!=e.publicKey&&!t.publicKey.equals(e.publicKey))throw new cy("publicKey bytes do not match peer id publicKey bytes");let s=n.existingPeer?.peer;if(null!=s&&!e.equals(s.id))throw new cy("peer id did not match existing peer id");let o=s?.addresses??[],a=new Set(s?.protocols??[]),l=s?.metadata??new Map,c=s?.tags??new Map,u=s?.peerRecordEnvelope;if("patch"===r&&((null!=t.multiaddrs||null!=t.addresses)&&(o=[],null!=t.multiaddrs&&o.push(...t.multiaddrs.map(e=>({isCertified:!1,multiaddr:e}))),null!=t.addresses&&o.push(...t.addresses)),null!=t.protocols&&(a=new Set(t.protocols)),null!=t.metadata&&(l=AG(t.metadata instanceof Map?[...t.metadata.entries()]:Object.entries(t.metadata),{validate:AK})),null!=t.tags&&(c=AG(t.tags instanceof Map?[...t.tags.entries()]:Object.entries(t.tags),{validate:AW,map:AQ})),null!=t.peerRecordEnvelope&&(u=t.peerRecordEnvelope)),"merge"===r){if(null!=t.multiaddrs&&o.push(...t.multiaddrs.map(e=>({isCertified:!1,multiaddr:e}))),null!=t.addresses&&o.push(...t.addresses),null!=t.protocols&&(a=new Set([...a,...t.protocols])),null!=t.metadata){for(let[e,r]of t.metadata instanceof Map?[...t.metadata.entries()]:Object.entries(t.metadata))null==r?l.delete(e):l.set(e,r);l=AG([...l.entries()],{validate:AK})}if(null!=t.tags){let e=t.tags instanceof Map?[...t.tags.entries()]:Object.entries(t.tags),r=new Map(c);for(let[t,n]of e)null==n?r.delete(t):r.set(t,n);c=AG([...r.entries()],{validate:AW,map:AQ})}null!=t.peerRecordEnvelope&&(u=t.peerRecordEnvelope)}s?.id.publicKey!=null?i=p5(s.id.publicKey):null!=t.publicKey?i=p5(t.publicKey):null!=e.publicKey&&(i=p5(e.publicKey));let d={addresses:await Az(e,n.addressFilter??(async()=>!0),o,n.existingPeer?.peerPB.addresses),protocols:[...a.values()].sort((e,t)=>e.localeCompare(t)),metadata:l,tags:c,publicKey:i,peerRecordEnvelope:u};return d.addresses.forEach(e=>{e.observed=n.existingPeer?.peerPB.addresses?.find(e=>tc(e.multiaddr,e.multiaddr))?.observed??Date.now()}),"RSA"!==e.type&&delete d.publicKey,d}function AG(e,t){let r=new Map;for(let[r,n]of e)null!=n&&t.validate(r,n);for(let[n,i]of e.sort(([e],[t])=>e.localeCompare(t)))null!=i&&r.set(n,t.map?.(n,i)??i);return r}function AK(e,t){if("string"!=typeof e)throw new cy("Metadata key must be a string");if(!(t instanceof Uint8Array))throw new cy("Metadata value must be a Uint8Array")}function AW(e,t){if("string"!=typeof e)throw new cy("Tag name must be a string");if(null!=t.value){if(parseInt(`${t.value}`,10)!==t.value)throw new cy("Tag value must be an integer");if(t.value<0||t.value>100)throw new cy("Tag value must be between 0-100")}if(null!=t.ttl){if(parseInt(`${t.ttl}`,10)!==t.ttl)throw new cy("Tag ttl must be an integer");if(t.ttl<0)throw new cy("Tag ttl must be between greater than 0")}}function AQ(e,t){let r;return null!=t.expiry&&(r=t.expiry),null!=t.ttl&&(r=BigInt(Date.now()+Number(t.ttl))),{value:t.value??0,expiry:r}}function AJ(e){let t=e.toString().split("/")[2];return gy(tm.TO.parse(t,m9.base32))}function AZ(e,t,r){return AP(AJ(e),t,r)}function AY(e,t){return{prefix:A$,filters:(e.filters??[]).map(e=>({key:r,value:n})=>e(AZ(r,n,t))),orders:(e.orders??[]).map(e=>(r,n)=>e(AZ(r.key,r.value,t),AZ(n.key,n.value,t)))}}class AX{peerId;datastore;lock;addressFilter;log;maxAddressAge;maxPeerAge;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-store"),this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.lock=wC({name:"peer-store",singleProcess:!0}),this.maxAddressAge=t.maxAddressAge??AI,this.maxPeerAge=t.maxPeerAge??AT}async has(e){try{return await this.load(e),!0}catch(e){if("NotFoundError"!==e.name)throw e}return!1}async delete(e){this.peerId.equals(e)||await this.datastore.delete(Aq(e))}async load(e){let t=Aq(e),r=await this.datastore.get(t),n=es.decode(r);if(this.#$(e,n))throw await this.datastore.delete(t),new c_;return AR(e,n,this.peerId.equals(e)?1/0:this.maxAddressAge)}async save(e,t){let r=await this.#q(e),n=await AV(e,t,"patch",{addressFilter:this.addressFilter});return this.#z(e,n,r)}async patch(e,t){let r=await this.#q(e),n=await AV(e,t,"patch",{addressFilter:this.addressFilter,existingPeer:r});return this.#z(e,n,r)}async merge(e,t){let r=await this.#q(e),n=await AV(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:r});return this.#z(e,n,r)}async *all(e){for await(let{key:t,value:r}of this.datastore.query(AY(e??{},this.maxAddressAge))){let e=AJ(t);if(e.equals(this.peerId))continue;let n=es.decode(r);if(this.#$(e,n)){await this.datastore.delete(t);continue}yield AR(e,n,this.peerId.equals(e)?1/0:this.maxAddressAge)}}async #q(e){try{let t=Aq(e),r=await this.datastore.get(t),n=es.decode(r);if(this.#$(e,n))throw await this.datastore.delete(t),new c_;return{peerPB:n,peer:AP(e,r,this.maxAddressAge)}}catch(e){"NotFoundError"!==e.name&&this.log.error("invalid peer data found in peer store - %e",e)}}async #z(e,t,r){t.updated=Date.now();let n=es.encode(t);return await this.datastore.put(Aq(e),n),{peer:AP(e,n,this.maxAddressAge),previous:r?.peer,updated:null==r||!AD(t,r.peerPB)}}#$(e,t){if(null==t.updated)return!0;if(this.peerId.equals(e))return!1;let r=t.updated<Date.now()-this.maxPeerAge,n=Date.now()-this.maxAddressAge,i=t.addresses.filter(e=>null!=e.observed&&e.observed>n);return r&&0===i.length}}class A0{store;events;peerId;log;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new AX(e,t)}[Symbol.toStringTag]="@libp2p/peer-store";async forEach(e,t){this.log.trace("forEach await read lock");let r=await this.store.lock.readLock();this.log.trace("forEach got read lock");try{for await(let r of this.store.all(t))e(r)}finally{this.log.trace("forEach release read lock"),r()}}async all(e){this.log.trace("all await read lock");let t=await this.store.lock.readLock();this.log.trace("all got read lock");try{return await (0,aO.A)(this.store.all(e))}finally{this.log.trace("all release read lock"),t()}}async delete(e){this.log.trace("delete await write lock");let t=await this.store.lock.writeLock();this.log.trace("delete got write lock");try{await this.store.delete(e)}finally{this.log.trace("delete release write lock"),t()}}async has(e){this.log.trace("has await read lock");let t=await this.store.lock.readLock();this.log.trace("has got read lock");try{return await this.store.has(e)}finally{this.log.trace("has release read lock"),t()}}async get(e){this.log.trace("get await read lock");let t=await this.store.lock.readLock();this.log.trace("get got read lock");try{return await this.store.load(e)}finally{this.log.trace("get release read lock"),t()}}async save(e,t){this.log.trace("save await write lock");let r=await this.store.lock.writeLock();this.log.trace("save got write lock");try{let r=await this.store.save(e,t);return this.#V(e,r),r.peer}finally{this.log.trace("save release write lock"),r()}}async patch(e,t){this.log.trace("patch await write lock");let r=await this.store.lock.writeLock();this.log.trace("patch got write lock");try{let r=await this.store.patch(e,t);return this.#V(e,r),r.peer}finally{this.log.trace("patch release write lock"),r()}}async merge(e,t){this.log.trace("merge await write lock");let r=await this.store.lock.writeLock();this.log.trace("merge got write lock");try{let r=await this.store.merge(e,t);return this.#V(e,r),r.peer}finally{this.log.trace("merge release write lock"),r()}}async consumePeerRecord(e,t){let r,n=await AE.openAndCertify(e,A_.DOMAIN),i=gy(n.publicKey.toCID());if(t?.equals(i)===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",t,i),!1;let s=A_.createFromProtobuf(n.payload);try{r=await this.get(i)}catch(e){if("NotFoundError"!==e.name)throw e}if(r?.peerRecordEnvelope!=null){let e=await AE.createFromProtobuf(r.peerRecordEnvelope),t=A_.createFromProtobuf(e.payload);if(t.seqNumber>=s.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",t.seqNumber,s.seqNumber),!1}return await this.patch(s.peerId,{peerRecordEnvelope:e,addresses:s.multiaddrs.map(e=>({isCertified:!0,multiaddr:e}))}),!0}#V(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))}}function A1(e,t={}){return new A0(e,t)}var A2=r(3972);function A3(e,t){let r,n=function(){let n=function(){r=void 0,e()};clearTimeout(r),r=setTimeout(n,t)};return n.start=()=>{},n.stop=()=>{clearTimeout(r)},n}let A4=864e13,A5=448,A6=449,A8=53,A7=54,A9=55,xe=56;class xt{log;mappings;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=new Map}has(e){let t=this.findHost(e);for(let e of this.mappings.values())if(e.domain===t)return!0;return!1}add(e,t){t.forEach(t=>{this.log("add DNS mapping %s to %s",t,e);let r=!0===mr(t);this.mappings.set(t,{domain:e,verified:r,expires:r?A4-Date.now():0,lastVerified:r?A4-Date.now():void 0})})}remove(e){let t=this.findHost(e),r=!1;for(let[e,n]of this.mappings.entries())n.domain===t&&(this.log("removing %s to %s DNS mapping %e",e,n.domain,Error("where")),this.mappings.delete(e),r=r||n.verified);return r}getAll(e){let t=[];for(let r=0;r<e.length;r++){let n=e[r].multiaddr.stringTuples(),i=n[0][1];if(null!=i)for(let[s,o]of this.mappings.entries())i===s&&this.maybeAddSNITuple(n,o.domain)&&(e.splice(r,1),r--,t.push({multiaddr:yz(`/${n.map(e=>[yl(e[0]).name,e[1]].join("/")).join("/")}`),verified:o.verified,type:"dns-mapping",expires:o.expires,lastVerified:o.lastVerified}))}return t}maybeAddSNITuple(e,t){for(let r=0;r<e.length;r++)if(e[r][0]===A5&&e[r+1]?.[0]!==A6)return e.splice(r+1,0,[A6,t]),!0;return!1}confirm(e,t){let r=this.findHost(e),n=!1;for(let[e,i]of this.mappings.entries())i.domain===r&&(this.log("marking %s to %s DNS mapping as verified",e,i.domain),n=i.verified,i.verified=!0,i.expires=Date.now()+t,i.lastVerified=Date.now());return n}unconfirm(e,t){let r=this.findHost(e),n=!1;for(let[e,i]of this.mappings.entries())i.domain===r&&(this.log("removing verification of %s to %s DNS mapping",e,i.domain),n=n||i.verified,i.verified=!1,i.expires=Date.now()+t);return n}findHost(e){for(let t of e.stringTuples())if(t[0]===A6||t[0]===A8||t[0]===A7||t[0]===A9||t[0]===xe)return t[1]}}let xr=4,xn=41,xi=6,xs=273;class xo{log;mappings;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=new Map}has(e){let t=e.stringTuples();for(let e of this.mappings.values())for(let r of e)if(r.externalIp===t[0][1])return!0;return!1}add(e,t,r,n=t,i="tcp"){let s=`${e}-${t}-${i}`,o=this.mappings.get(s)??[],a={internalIp:e,internalPort:t,externalIp:r,externalPort:n,externalFamily:g1(r)?4:6,protocol:i,verified:!1,expires:0};o.push(a),this.mappings.set(s,o)}remove(e){let t=e.stringTuples(),r=t[0][1]??"",n=t[1][0]===xi?"tcp":"udp",i=parseInt(t[1][1]??"0"),s=!1;for(let[e,t]of this.mappings.entries()){for(let e=0;e<t.length;e++){let o=t[e];o.externalIp===r&&o.externalPort===i&&o.protocol===n&&(this.log("removing %s:%s to %s:%s %s IP mapping",o.externalIp,o.externalPort,r,i,n),s=s||o.verified,t.splice(e,1),e--)}0===t.length&&this.mappings.delete(e)}return s}getAll(e){let t=[];for(let{multiaddr:r}of e){let e,n=r.stringTuples();if((n[0][0]===xr||n[0][0]===xn)&&n[1][0]===xi?e=`${n[0][1]}-${n[1][1]}-tcp`:(n[0][0]===xr||n[0][0]===xn)&&n[1][0]===xs&&(e=`${n[0][1]}-${n[1][1]}-udp`),null==e)continue;let i=this.mappings.get(e);if(null!=i)for(let e of i)n[0][0]=4===e.externalFamily?xr:xn,n[0][1]=e.externalIp,n[1][1]=`${e.externalPort}`,t.push({multiaddr:yz(`/${n.map(e=>[yl(e[0]).name,e[1]].join("/")).join("/")}`),verified:e.verified,type:"ip-mapping",expires:e.expires,lastVerified:e.lastVerified})}return t}confirm(e,t){let r=e.stringTuples()[0][1],n=!1;for(let e of this.mappings.values())for(let i of e)i.externalIp===r&&(this.log("marking %s to %s IP mapping as verified",i.internalIp,i.externalIp),n=i.verified,i.verified=!0,i.expires=Date.now()+t,i.lastVerified=Date.now());return n}unconfirm(e,t){let r=e.stringTuples(),n=r[0][1]??"",i=r[1][0]===xi?"tcp":"udp",s=parseInt(r[1][1]??"0"),o=!1;for(let e of this.mappings.values())for(let r=0;r<e.length;r++){let a=e[r];a.externalIp===n&&a.externalPort===s&&a.protocol===i&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",a.externalIp,a.externalPort,n,s,i),o=o||a.verified,a.verified=!1,a.expires=Date.now()+t)}return o}}let xa=4,xl=41;function xc(e){try{let[[t,r]]=e.stringTuples();if(null==r)return!1;if(t===xa)return r.startsWith("169.254.");if(t===xl)return r.toLowerCase().startsWith("fe80")}catch{}return!1}let xu=4,xd=41;function xh(e){try{let[[t]]=e.stringTuples();return t===xu||t===xd}catch{}return!1}function xf(e){try{if(!xh(e))return!1;let[[,t]]=e.stringTuples();if(null==t)return!1;return mr(t)??!1}catch{}return!0}let xp={maxObservedAddresses:10};class xg{log;addresses;maxObservedAddresses;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??xp.maxObservedAddresses}has(e){return this.addresses.has(e.toString())}removePrefixed(e){for(let t of this.addresses.keys())t.toString().startsWith(e)&&this.addresses.delete(t)}add(e){this.addresses.size!==this.maxObservedAddresses&&(xf(e)||xc(e)||(this.log("adding observed address %a",e),this.addresses.set(e.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([e,t])=>({multiaddr:yz(e),verified:t.verified,type:"observed",expires:t.expires,lastVerified:t.lastVerified}))}remove(e){let t=this.addresses.get(e.toString())?.verified??!1;return this.log("removing observed address %a",e),this.addresses.delete(e.toString()),t}confirm(e,t){let r=e.toString(),n=this.addresses.get(r)??{verified:!1,expires:Date.now()+t,lastVerified:Date.now()},i=n.verified;return n.verified=!0,n.expires=Date.now()+t,n.lastVerified=Date.now(),this.log("marking observed address %a as verified",r),this.addresses.set(r,n),i}}let xm=[4,41,53,54,55,56];function xy(e){try{let[[t]]=e.stringTuples();return xm.includes(t)}catch{}return!1}let xb={maxObservedAddresses:10};class xw{log;addresses;maxObservedAddresses;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??xb.maxObservedAddresses}get(e,t){if(xf(e))return{multiaddr:e,verified:!0,type:"transport",expires:Date.now()+t,lastVerified:Date.now()};let r=this.toKey(e),n=this.addresses.get(r);return null==n&&(n={verified:!xy(e),expires:0},this.addresses.set(r,n)),{multiaddr:e,verified:n.verified,type:"transport",expires:n.expires,lastVerified:n.lastVerified}}has(e){let t=this.toKey(e);return this.addresses.has(t)}remove(e){let t=this.toKey(e),r=this.addresses.get(t)?.verified??!1;return this.log("removing observed address %a",e),this.addresses.delete(t),r}confirm(e,t){let r=this.toKey(e),n=this.addresses.get(r)??{verified:!1,expires:0,lastVerified:0},i=n.verified;return n.verified=!0,n.expires=Date.now()+t,n.lastVerified=Date.now(),this.addresses.set(r,n),i}unconfirm(e,t){let r=this.toKey(e),n=this.addresses.get(r)??{verified:!1,expires:0},i=n.verified;return n.verified=!1,n.expires=Date.now()+t,this.addresses.set(r,n),i}toKey(e){if(xy(e)){let t=e.toOptions();return`${t.host}-${t.port}-${t.transport}`}return e.toString()}}let xv={addressVerificationTTL:6e5,addressVerificationRetry:3e5},xE=e=>e;function xA(e,t){let r=e.getPeerId();return null!=r&&gf(r).equals(t)&&(e=e.decapsulate(yz(`/p2p/${t.toString()}`))),e}class xx{log;components;listen;announce;appendAnnounce;announceFilter;observed;dnsMappings;ipMappings;transportAddresses;observedAddressFilter;addressVerificationTTL;addressVerificationRetry;constructor(e,t={}){let{listen:r=[],announce:n=[],appendAnnounce:i=[]}=t;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=r.map(e=>e.toString()),this.announce=new Set(n.map(e=>e.toString())),this.appendAnnounce=new Set(i.map(e=>e.toString())),this.observed=new xg(e,t),this.dnsMappings=new xt(e,t),this.ipMappings=new xo(e,t),this.transportAddresses=new xw(e,t),this.announceFilter=t.announceFilter??xE,this.observedAddressFilter=l2(1024),this.addressVerificationTTL=t.addressVerificationTTL??xv.addressVerificationTTL,this.addressVerificationRetry=t.addressVerificationRetry??xv.addressVerificationRetry,this._updatePeerStoreAddresses=A3(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}[Symbol.toStringTag]="@libp2p/address-manager";_updatePeerStoreAddresses(){let e=this.getAddresses().map(e=>e.getPeerId()===this.components.peerId.toString()?e.decapsulate(`/p2p/${this.components.peerId.toString()}`):e);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(e=>{this.log.error("error updating addresses",e)})}getListenAddrs(){return Array.from(this.listen).map(e=>yz(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>yz(e))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(e=>yz(e))}getObservedAddrs(){return this.observed.getAll().map(e=>e.multiaddr)}addObservedAddr(e){let t=e.stringTuples(),r=`${t[0][1]}:${t[1][1]}`;if(!this.observedAddressFilter.has(r))this.observedAddressFilter.add(r),e=xA(e,this.components.peerId),!this.ipMappings.has(e)&&(this.dnsMappings.has(e)||this.observed.add(e))}confirmObservedAddr(e,t){e=xA(e,this.components.peerId);let r=!0;(t?.type==="transport"||this.transportAddresses.has(e))&&!this.transportAddresses.confirm(e,t?.ttl??this.addressVerificationTTL)&&r&&(r=!1),(t?.type==="dns-mapping"||this.dnsMappings.has(e))&&!this.dnsMappings.confirm(e,t?.ttl??this.addressVerificationTTL)&&r&&(r=!1),(t?.type==="ip-mapping"||this.ipMappings.has(e))&&!this.ipMappings.confirm(e,t?.ttl??this.addressVerificationTTL)&&r&&(r=!1),(t?.type==="observed"||this.observed.has(e))&&(this.maybeUpgradeToIPMapping(e)?(this.ipMappings.confirm(e,t?.ttl??this.addressVerificationTTL),r=!1):!this.observed.confirm(e,t?.ttl??this.addressVerificationTTL)&&r&&(r=!1)),r||this._updatePeerStoreAddresses()}removeObservedAddr(e,t){e=xA(e,this.components.peerId);let r=!1;this.observed.has(e)&&!this.observed.remove(e)&&r&&(r=!1),this.transportAddresses.has(e)&&!this.transportAddresses.unconfirm(e,t?.ttl??this.addressVerificationRetry)&&r&&(r=!1),this.dnsMappings.has(e)&&!this.dnsMappings.unconfirm(e,t?.ttl??this.addressVerificationRetry)&&r&&(r=!1),this.ipMappings.has(e)&&!this.ipMappings.unconfirm(e,t?.ttl??this.addressVerificationRetry)&&r&&(r=!1),r&&this._updatePeerStoreAddresses()}getAddresses(){let e=new Set,t=this.getAddressesWithMetadata().filter(t=>{if(!t.verified)return!1;let r=t.multiaddr.toString();return!e.has(r)&&(e.add(r),!0)}).map(e=>e.multiaddr);return this.announceFilter(t.map(e=>{let t=yz(e);return t.protos().pop()?.path===!0||t.getPeerId()===this.components.peerId.toString()?t:t.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){let e=this.getAnnounceAddrs();if(e.length>0)return this.components.transportManager.getListeners().forEach(t=>{t.updateAnnounceAddrs(e)}),e.map(e=>({multiaddr:e,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let t=[];return(t=(t=(t=(t=t.concat(this.components.transportManager.getAddrs().map(e=>this.transportAddresses.get(e,this.addressVerificationTTL)))).concat(this.getAppendAnnounceAddrs().map(e=>({multiaddr:e,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))).concat(this.observed.getAll())).concat(this.ipMappings.getAll(t))).concat(this.dnsMappings.getAll(t))}addDNSMapping(e,t){this.dnsMappings.add(e,t)}removeDNSMapping(e){this.dnsMappings.remove(yz(`/dns/${e}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(e,t,r,n=t,i="tcp"){this.ipMappings.add(e,t,r,n,i),this.observed.removePrefixed(`/ip${g1(r)?4:6}/${r}/${i}/${n}`)}removePublicAddressMapping(e,t,r,n=t,i="tcp"){this.ipMappings.remove(yz(`/ip${g1(r)?4:6}/${r}/${i}/${n}`))&&this._updatePeerStoreAddresses()}maybeUpgradeToIPMapping(e){if(this.ipMappings.has(e))return!1;let t=e.toOptions();if(6===t.family||"127.0.0.1"===t.host||!0===mr(t.host))return!1;let r=this.components.transportManager.getListeners();for(let n of[e=>mO.exactMatch(e)||mF.exactMatch(e),e=>mC.exactMatch(e),e=>mN.exactMatch(e)]){if(!n(e))continue;let i=r.filter(e=>e.getAddrs().filter(e=>4===e.toOptions().family&&n(e)).length>0);if(1!==i.length)continue;let s=i[0].getAddrs().filter(e=>"127.0.0.1"!==e.toOptions().host).pop();if(null==s)continue;let o=s.toOptions();return this.observed.remove(e),this.ipMappings.add(o.host,o.port,t.host,t.port,t.transport),!0}return!1}}!function(e){e.NOT_STARTED_YET="The libp2p node is not started yet",e.NOT_FOUND="Not found"}(el||(el={}));class xS extends Error{constructor(e="Missing service"){super(e),this.name="MissingServiceError"}}class xk extends Error{constructor(e="Unmet service dependencies"){super(e),this.name="UnmetServiceDependenciesError"}}class x_ extends Error{constructor(e="No content routers available"){super(e),this.name="NoContentRoutersError"}}class xI extends Error{constructor(e="No peer routers available"){super(e),this.name="NoPeerRoutersError"}}class xT extends Error{constructor(e="Should not try to find self"){super(e),this.name="QueriedForSelfError"}}class xC extends Error{constructor(e="Unhandled protocol error"){super(e),this.name="UnhandledProtocolError"}}class xP extends Error{constructor(e="Duplicate protocol handler error"){super(e),this.name="DuplicateProtocolHandlerError"}}class xR extends Error{constructor(e="Dial denied error"){super(e),this.name="DialDeniedError"}}class xD extends Error{constructor(e="No transport was configured to listen on this address"){super(e),this.name="UnsupportedListenAddressError"}}class xN extends Error{constructor(e="Configured listen addresses could not be listened on"){super(e),this.name="UnsupportedListenAddressesError"}}class xM extends Error{constructor(e="No valid addresses"){super(e),this.name="NoValidAddressesError"}}class xB extends Error{constructor(e="Connection intercepted"){super(e),this.name="ConnectionInterceptedError"}}class xO extends Error{constructor(e="Connection denied"){super(e),this.name="ConnectionDeniedError"}}class xL extends Error{constructor(e="Stream is not multiplexed"){super(e),this.name="MuxerUnavailableError"}}class xF extends Error{constructor(e="Encryption failed"){super(e),this.name="EncryptionFailedError"}}class xU extends Error{constructor(e="Transport unavailable"){super(e),this.name="TransportUnavailableError"}}class xj{components={};_started=!1;constructor(e={}){for(let[t,r]of(this.components={},Object.entries(e)))this.components[t]=r;null==this.components.logger&&(this.components.logger=(0,aB.Um)())}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter(e=>bj(e)).map(async t=>{await t[e]?.()}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}let xH=["metrics","connectionProtector","dns"],x$=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function xq(e={}){let t=new xj(e);return new Proxy(t,{get(e,r,n){if("string"==typeof r&&!x$.includes(r)){let e=t.components[r];if(null==e&&!xH.includes(r))throw new xS(`${r} not set`);return e}return Reflect.get(e,r,n)},set:(e,r,n)=>("string"==typeof r?t.components[r]=n:Reflect.set(e,r,n),!0)})}function xz(e){let t={};for(let r of Object.values(e.components))for(let e of xV(r))t[e]=!0;for(let r of Object.values(e.components))for(let e of xG(r))if(!0!==t[e])throw new xk(`Service "${xK(r)}" required capability "${e}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}function xV(e){return Array.isArray(e?.[vs])?e[vs]:[]}function xG(e){return Array.isArray(e?.[vo])?e[vo]:[]}function xK(e){return e?.[Symbol.toStringTag]??e?.toString()??"unknown"}let xW=4,xQ=41;function xJ(e={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{if(mO.matches(e))return!1;let t=e.stringTuples();return(t[0][0]===xW||t[0][0]===xQ)&&!!mr(`${t[0][1]}`)},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...e}}let xZ=()=>{let e=Error("Delay aborted");return e.name="AbortError",e},xY=new WeakMap,xX=function({clearTimeout:e,setTimeout:t}={}){return(r,{value:n,signal:i}={})=>{let s,o,a;if(i?.aborted)return Promise.reject(xZ());let l=e??clearTimeout,c=()=>{l(s),a(xZ())},u=()=>{i&&i.removeEventListener("abort",c)},d=new Promise((e,i)=>{o=()=>{u(),e(n)},a=i,s=(t??setTimeout)(o,r)});return i&&i.addEventListener("abort",c,{once:!0}),xY.set(d,()=>{l(s),s=null,o()}),d}}();class x0{memoryStorage;points;duration;blockDuration;execEvenly;execEvenlyMinDelayMs;keyPrefix;constructor(e={}){this.points=e.points??4,this.duration=e.duration??1,this.blockDuration=e.blockDuration??0,this.execEvenly=e.execEvenly??!1,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs??1e3*this.duration/this.points,this.keyPrefix=e.keyPrefix??"rlflx",this.memoryStorage=new x1}async consume(e,t=1,r={}){let n=this.getKey(e),i=this._getKeySecDuration(r),s=this.memoryStorage.incrby(n,t,i);if(s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s.consumedPoints>this.points)throw this.blockDuration>0&&s.consumedPoints<=this.points+t&&(s=this.memoryStorage.set(n,s.consumedPoints,this.blockDuration)),new cz("Rate limit exceeded",s);if(this.execEvenly&&s.msBeforeNext>0&&!s.isFirstInDuration){let e=Math.ceil(s.msBeforeNext/(s.remainingPoints+2));e<this.execEvenlyMinDelayMs&&(e=s.consumedPoints*this.execEvenlyMinDelayMs),await xX(e)}return s}penalty(e,t=1,r={}){let n=this.getKey(e),i=this._getKeySecDuration(r),s=this.memoryStorage.incrby(n,t,i);return s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s}reward(e,t=1,r={}){let n=this.getKey(e),i=this._getKeySecDuration(r),s=this.memoryStorage.incrby(n,-t,i);return s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s}block(e,t){let r=1e3*t,n=this.points+1;return this.memoryStorage.set(this.getKey(e),n,t),{remainingPoints:0,msBeforeNext:0===r?-1:r,consumedPoints:n,isFirstInDuration:!1}}set(e,t,r=0){let n=(r>=0?r:this.duration)*1e3;return this.memoryStorage.set(this.getKey(e),t,r),{remainingPoints:0,msBeforeNext:0===n?-1:n,consumedPoints:t,isFirstInDuration:!1}}get(e){let t=this.memoryStorage.get(this.getKey(e));return null!=t&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return e?.customDuration!=null&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}}class x1{storage;constructor(){this.storage=new Map}incrby(e,t,r){let n=this.storage.get(e);if(null!=n){let e=null!=n.expiresAt?n.expiresAt.getTime()-new Date().getTime():-1;if(null==n.expiresAt||e>0)return n.value+=t,{remainingPoints:0,msBeforeNext:e,consumedPoints:n.value,isFirstInDuration:!1}}return this.set(e,t,r)}set(e,t,r){let n=1e3*r,i=this.storage.get(e);null!=i&&clearTimeout(i.timeoutId);let s={value:t,expiresAt:n>0?new Date(Date.now()+n):void 0};return this.storage.set(e,s),n>0&&(s.timeoutId=setTimeout(()=>{this.storage.delete(e)},n),null!=s.timeoutId.unref&&s.timeoutId.unref()),{remainingPoints:0,msBeforeNext:0===n?-1:n,consumedPoints:s.value,isFirstInDuration:!0}}get(e){let t=this.storage.get(e);if(null!=t)return{remainingPoints:0,msBeforeNext:null!=t.expiresAt?t.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}delete(e){let t=this.storage.get(e);return null!=t&&(null!=t.timeoutId&&clearTimeout(t.timeoutId),this.storage.delete(e),!0)}}function x2(e){let t;if(gr(e))return{peerId:e,multiaddrs:[]};if(Array.isArray(e)||(e=[e]),e.length>0){let r=e[0].getPeerId();t=null==r?void 0:gf(r),e.forEach(e=>{if(!yq(e))throw new cT("Invalid multiaddr");let r=e.getPeerId();if(null==r){if(null!=t)throw new cy("Multiaddrs must all have the same peer id or have no peer id")}else{let e=gf(r);if(t?.equals(e)!==!0)throw new cy("Multiaddrs must all have the same peer id or have no peer id")}})}return{peerId:t,multiaddrs:e}}let x3=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];async function x4(e,t){let r=e?.streams?.map(e=>e.protocol)??[],n=t?.closableProtocols??x3;if(!(r.filter(e=>null!=e&&!n.includes(e)).length>0))try{await e?.close(t)}catch(t){e?.abort(t)}}let x5=100,x6=50;async function x8(e,t){let r=!1;for(let t of y$.keys())if(r=e.protoNames().includes(t))break;if(!r)return[e];let n=await e.resolve(t);return t.log("resolved %s to",e,n.map(e=>e.toString())),n}function x7(e){try{let t;if(!(t="string"==typeof e?yz(e):e).protoNames().includes("ipcidr")){let e=t.protoNames().includes("ip6")?"/ipcidr/128":"/ipcidr/32";t=t.encapsulate(e)}return yp(t)}catch(t){throw Error(`Can't convert to IpNet, Invalid multiaddr format: ${e}`)}}let x9={maxConnections:100};class Se{maxConnections;connectionManager;peerStore;allow;events;log;constructor(e,t={}){this.maxConnections=t.maxConnections??x9.maxConnections,this.allow=(t.allow??[]).map(e=>x7(e)),this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(e=>{this.log.error("error while pruning connections %e",e)})}async _maybePruneConnections(){let e=this.connectionManager.getConnections(),t=e.length;if(this.log("checking max connections limit %d/%d",t,this.maxConnections),t<=this.maxConnections)return;let r=new gA;for(let t of e){let e=t.remotePeer;if(!r.has(e)){r.set(e,0);try{let t=await this.peerStore.get(e);r.set(e,[...t.tags.values()].reduce((e,t)=>e+t.value,0))}catch(e){"NotFoundError"!==e.name&&this.log.error("error loading peer tags",e)}}}let n=this.sortConnections(e,r),i=Math.max(t-this.maxConnections,0),s=[];for(let e of n)if(this.log("too many connections open - closing a connection to %p",e.remotePeer),this.allow.some(t=>t.contains(e.remoteAddr.nodeAddress().address))||s.push(e),s.length===i)break;await Promise.all(s.map(async e=>{await x4(e,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:s})}sortConnections(e,t){return e.sort((e,t)=>{let r=e.timeline.open,n=t.timeline.open;return r<n?1:r>n?-1:0}).sort((e,t)=>"outbound"===e.direction&&"inbound"===t.direction?1:"inbound"===e.direction&&"outbound"===t.direction?-1:0).sort((e,t)=>e.streams.length>t.streams.length?1:e.streams.length<t.streams.length?-1:0).sort((e,r)=>{let n=t.get(e.remotePeer)??0,i=t.get(r.remotePeer)??0;return n>i?1:n<i?-1:0})}}let St=1e4,Sr=1e4,Sn=1e4,Si=25,Ss=5,So=10,Sa=5,Sl="last-dial-failure",Sc="last-dial-success",Su=500;class Sd extends cJ{constructor(e={}){super({...e,sort:(e,t)=>e.options.priority>t.options.priority?-1:+(e.options.priority<t.options.priority)})}}function Sh(e){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^::1$/.test(e)}function Sf(e){if(!xh(e))return!1;let{address:t}=e.nodeAddress();return Sh(t)}function Sp(e,t){let r=mC.exactMatch(e.multiaddr),n=mC.exactMatch(t.multiaddr);if(r&&!n)return -1;if(!r&&n)return 1;let i=mF.exactMatch(e.multiaddr),s=mF.exactMatch(t.multiaddr);if(i&&!s)return -1;if(!i&&s)return 1;let o=mO.exactMatch(e.multiaddr),a=mO.exactMatch(t.multiaddr);if(o&&!a)return -1;if(!o&&a)return 1;let l=mG.exactMatch(e.multiaddr),c=mG.exactMatch(t.multiaddr);if(l&&!c)return -1;if(!l&&c)return 1;let u=mj.exactMatch(e.multiaddr),d=mj.exactMatch(t.multiaddr);if(u&&!d)return -1;if(!u&&d)return 1;let h=m$.exactMatch(e.multiaddr),f=m$.exactMatch(t.multiaddr);return h&&!f?-1:!h&&f?1:0}function Sg(e,t){let r=Sf(e.multiaddr),n=Sf(t.multiaddr);return r&&!n?1:!r&&n?-1:0}function Sm(e,t){let r=xf(e.multiaddr),n=xf(t.multiaddr);return r&&!n?1:!r&&n?-1:0}function Sy(e,t){return e.isCertified&&!t.isCertified?-1:!e.isCertified&&t.isCertified?1:0}function Sb(e,t){let r=mV.exactMatch(e.multiaddr),n=mV.exactMatch(t.multiaddr);return r&&!n?1:!r&&n?-1:0}function Sw(e){return e.sort(Sp).sort(Sy).sort(Sb).sort(Sm).sort(Sg)}let Sv={maxParallelDials:x6,maxDialQueueLength:Su,maxPeerAddrsToDial:Si,dialTimeout:St};class SE{queue;components;addressSorter;maxPeerAddrsToDial;maxDialQueueLength;dialTimeout;shutDownController;connections;log;constructor(e,t={}){for(let[r,n]of(this.addressSorter=t.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??Sv.maxPeerAddrsToDial,this.maxDialQueueLength=t.maxDialQueueLength??Sv.maxDialQueueLength,this.dialTimeout=t.dialTimeout??Sv.dialTimeout,this.connections=t.connections??new gA,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.shutDownController=new AbortController,this.shutDownController.signal,Object.entries(t.resolvers??{})))y$.set(r,n);this.queue=new Sd({concurrency:t.maxParallelDials??Sv.maxParallelDials,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("error",e=>{e.detail.name!==cp.name&&this.log.error("error in dial queue - %e",e.detail)})}start(){this.shutDownController=new AbortController,this.shutDownController.signal}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(e,t={}){let{peerId:r,multiaddrs:n}=x2(e),i=Array.from(this.connections.values()).flat().find(e=>!0!==t.force&&(!!e.remotePeer.equals(r)||n.find(t=>t.equals(e.remoteAddr))));if(i?.status==="open")return this.log("already connected to %a",i.remoteAddr),t.onProgress?.(new rY("dial-queue:already-connected")),i;let s=this.queue.queue.find(e=>{if(r?.equals(e.options.peerId)===!0)return!0;let t=e.options.multiaddrs;if(null==t)return!1;for(let e of n)if(t.has(e.toString()))return!0;return!1});if(null!=s){for(let e of(this.log("joining existing dial target for %p",r),n))s.options.multiaddrs.add(e.toString());return t.onProgress?.(new rY("dial-queue:already-in-dial-queue")),s.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new cO("Dial queue is full");return this.log("creating dial target for %p",r,n.map(e=>e.toString())),t.onProgress?.(new rY("dial-queue:add-to-dial-queue")),this.queue.add(async e=>{e.onProgress?.(new rY("dial-queue:start-dial"));let t=ch([this.shutDownController.signal,e.signal]);try{return await this.dialPeer(e,t)}finally{t.clear()}},{peerId:r,priority:t.priority??SN,multiaddrs:new Set(n.map(e=>e.toString())),signal:t.signal??AbortSignal.timeout(this.dialTimeout),onProgress:t.onProgress})}async dialPeer(e,t){let r=e.peerId,n=e.multiaddrs,i=new Set,s=0===e.multiaddrs.size,o=0,a=0,l=[];for(this.log("starting dial to %p",r);s||n.size>0;){a++,s=!1;let c=[],u=new Set(e.multiaddrs);for(let s of(n.clear(),this.log("calculating addrs to dial %p from %s",r,[...u]),await this.calculateMultiaddrs(r,u,{...e,signal:t}))){if(i.has(s.multiaddr.toString())){this.log.trace("skipping previously failed multiaddr %a while dialing %p",s.multiaddr,r);continue}c.push(s)}for(let n of(this.log("%s dial to %p with %s",1===a?"starting":"continuing",r,c.map(e=>e.multiaddr.toString())),e?.onProgress?.(new rY("dial-queue:calculated-addresses",c)),c)){if(o===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",o,e.peerId),new cO("Peer had more than maxPeerAddrsToDial");o++;try{let i=await this.components.transportManager.dial(n.multiaddr,{...e,signal:t});this.log("dial to %a succeeded",n.multiaddr);try{await this.components.peerStore.merge(i.remotePeer,{multiaddrs:[i.remoteAddr],metadata:{[Sc]:(0,rx.s)(Date.now().toString())}})}catch(e){this.log.error("could not update last dial failure key for %p",r,e)}return i}catch(e){if(this.log.error("dial failed to %a",n.multiaddr,e),i.add(n.multiaddr.toString()),null!=r)try{await this.components.peerStore.merge(r,{metadata:{[Sl]:(0,rx.s)(Date.now().toString())}})}catch(e){this.log.error("could not update last dial failure key for %p",r,e)}if(t.aborted)throw new cM(e.message);l.push(e)}}}if(1===l.length)throw l[0];throw AggregateError(l,"All multiaddr dials failed")}async calculateMultiaddrs(e,t=new Set,r={}){let n=[...t].map(e=>({multiaddr:yz(e),isCertified:!1}));if(null!=e){if(this.components.peerId.equals(e))throw new cO("Tried to dial self");if(await this.components.connectionGater.denyDialPeer?.(e)===!0)throw new xR("The dial request is blocked by gater.allowDialPeer");if(0===n.length){this.log("loading multiaddrs for %p",e);try{let t=await this.components.peerStore.get(e);n.push(...t.addresses),this.log("loaded multiaddrs for %p",e,n.map(({multiaddr:e})=>e.toString()))}catch(e){if("NotFoundError"!==e.name)throw e}}if(0===n.length){this.log("looking up multiaddrs for %p in the peer routing",e);try{let t=await this.components.peerRouting.findPeer(e,r);this.log("found multiaddrs for %p in the peer routing",e,n.map(({multiaddr:e})=>e.toString())),n.push(...t.multiaddrs.map(e=>({multiaddr:e,isCertified:!1})))}catch(t){"NoPeerRoutersError"===t.name?this.log("no peer routers configured",e):this.log.error("looking up multiaddrs for %p in the peer routing failed - %e",e,t)}}}let i=(await Promise.all(n.map(async e=>{let t=await x8(e.multiaddr,{dns:this.components.dns,...r,log:this.log});return 1===t.length&&t[0].equals(e.multiaddr)?e:t.map(e=>({multiaddr:e,isCertified:!1}))}))).flat();if(null!=e){let t=`/p2p/${e.toString()}`;i=i.map(e=>{let r=e.multiaddr.protos().pop();return r?.path===!0?e:null==e.multiaddr.getPeerId()?{multiaddr:e.multiaddr.encapsulate(t),isCertified:e.isCertified}:e})}let s=i.filter(t=>{if(null==this.components.transportManager.dialTransportForMultiaddr(t.multiaddr))return!1;let r=t.multiaddr.getPeerId();return null==e||null==r||e.equals(r)}),o=new Map;for(let e of s){let t=e.multiaddr.toString(),r=o.get(t);if(null!=r){r.isCertified=r.isCertified||e.isCertified||!1;continue}o.set(t,e)}let a=[...o.values()];if(0===a.length)throw new xM("The dial request has no valid addresses");let l=[];for(let e of a)null!=this.components.connectionGater.denyDialMultiaddr&&await this.components.connectionGater.denyDialMultiaddr(e.multiaddr)||l.push(e);let c=null==this.addressSorter?Sw(l):l.sort(this.addressSorter);if(0===c.length)throw new xR("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",e??"unknown peer",i.map(({multiaddr:e})=>e.toString())),this.log.trace("addresses for %p after filtering",e??"unknown peer",c.map(({multiaddr:e})=>e.toString())),c}async isDialable(e,t={}){Array.isArray(e)||(e=[e]);try{let r=await this.calculateMultiaddrs(void 0,new Set(e.map(e=>e.toString())),t);if(!1===t.runOnLimitedConnection)return null!=r.find(e=>!mV.matches(e.multiaddr));return!0}catch(e){this.log.trace("error calculating if multiaddr(s) were dialable",e)}return!1}}let SA="keep-alive";var Sx=r(84896);let SS=Object.prototype.toString,Sk=e=>"[object Error]"===SS.call(e),S_=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);function SI(e){return!!(e&&Sk(e)&&"TypeError"===e.name&&"string"==typeof e.message)&&("Load failed"===e.message?void 0===e.stack:S_.has(e.message))}class ST extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}let SC=(e,t,r)=>{let n=r.retries-(t-1);return e.attemptNumber=t,e.retriesLeft=n,e};async function SP(e,t){return new Promise((r,n)=>{t={...t},t.onFailedAttempt??=()=>{},t.shouldRetry??=()=>!0,t.retries??=10;let i=Sx.operation(t),s=()=>{i.stop(),n(t.signal?.reason)};t.signal&&!t.signal.aborted&&t.signal.addEventListener("abort",s,{once:!0});let o=()=>{t.signal?.removeEventListener("abort",s),i.stop()};i.attempt(async s=>{try{let t=await e(s);o(),r(t)}catch(e){try{if(!(e instanceof Error))throw TypeError(`Non-error was thrown: "${e}". You should only throw errors.`);if(e instanceof ST)throw e.originalError;if(e instanceof TypeError&&!SI(e))throw e;if(SC(e,s,t),await t.shouldRetry(e)||(i.stop(),n(e)),await t.onFailedAttempt(e),!i.retry(e))throw i.mainError()}catch(e){SC(e,s,t),o(),n(e)}}})})}class SR{log;queue;started;peerStore;retries;retryInterval;backoffFactor;connectionManager;events;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.queue=new cZ({concurrency:t.maxParallelReconnects??Sa,metricName:"libp2p_reconnect_queue",metrics:e.metrics}),this.started=!1,this.retries=t.retries??5,this.backoffFactor=t.backoffFactor,this.retryInterval=t.retryInterval,this.events=e.events,e.events.addEventListener("peer:disconnect",e=>{this.maybeReconnect(e.detail).catch(t=>{this.log.error("failed to maybe reconnect to %p - %e",e.detail,t)})})}async maybeReconnect(e){if(!this.started)return;let t=await this.peerStore.get(e);SD(t)&&(this.queue.has(e)||this.queue.add(async t=>{await SP(async r=>{if(this.started)try{await this.connectionManager.openConnection(e,{signal:t?.signal})}catch(t){throw this.log("reconnecting to %p attempt %d of %d failed - %e",e,r,this.retries,t),t}},{signal:t?.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})},{peerId:e}).catch(async r=>{this.log.error("failed to reconnect to %p - %e",e,r);let n={};[...t.tags.keys()].forEach(e=>{e.startsWith(SA)&&(n[e]=void 0)}),await this.peerStore.merge(e,{tags:n}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:e})}).catch(async t=>{this.log.error("failed to remove keep-alive tag from %p - %e",e,t)}))}start(){this.started=!0}async afterStart(){Promise.resolve().then(async()=>{let e=await this.peerStore.all({filters:[e=>SD(e)]});await Promise.all(e.map(async e=>{await this.connectionManager.openConnection(e.id).catch(e=>{this.log.error(e)})}))}).catch(e=>{this.log.error(e)})}stop(){this.started=!1,this.queue.abort()}}function SD(e){for(let t of e.tags.keys())if(t.startsWith(SA))return!0;return!1}let SN=50,SM={maxConnections:x5,inboundConnectionThreshold:Ss,maxIncomingPendingConnections:So};class SB{started;connections;allow;deny;maxIncomingPendingConnections;incomingPendingConnections;outboundPendingConnections;maxConnections;dialQueue;reconnectQueue;connectionPruner;inboundConnectionRateLimiter;peerStore;metrics;events;log;peerId;constructor(e,t={}){if(this.maxConnections=t.maxConnections??SM.maxConnections,this.maxConnections<1)throw new cy("Connection Manager maxConnections must be greater than 0");this.connections=new gA,this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(t.allow??[]).map(e=>x7(e)),this.deny=(t.deny??[]).map(e=>x7(e)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??SM.maxIncomingPendingConnections,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new x0({points:t.inboundConnectionThreshold??SM.inboundConnectionThreshold,duration:1}),this.connectionPruner=new Se({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{maxConnections:this.maxConnections,allow:t.allow?.map(e=>yz(e))}),this.dialQueue=new SE(e,{addressSorter:t.addressSorter,maxParallelDials:t.maxParallelDials??x6,maxDialQueueLength:t.maxDialQueueLength??Su,maxPeerAddrsToDial:t.maxPeerAddrsToDial??Si,dialTimeout:t.dialTimeout??St,resolvers:t.resolvers??{dnsaddr:Ap},connections:this.connections}),this.reconnectQueue=new SR({events:e.events,peerStore:e.peerStore,logger:e.logger,connectionManager:this},{retries:t.reconnectRetries,retryInterval:t.reconnectRetryInterval,backoffFactor:t.reconnectBackoffFactor,maxParallelReconnects:t.maxParallelReconnects})}[Symbol.toStringTag]="@libp2p/connection-manager";async start(){this.metrics?.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{let e={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(let t of this.connections.values())for(let r of t)e[r.direction]++;return e}}),this.metrics?.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{let e={};for(let t of this.connections.values())for(let r of t)for(let t of r.streams){let r=`${t.direction} ${t.protocol??"unnegotiated"}`;e[r]=(e[r]??0)+1}return e}}),this.metrics?.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{let e={};for(let t of this.connections.values())for(let r of t){let t={};for(let e of r.streams){let r=`${e.direction} ${e.protocol??"unnegotiated"}`;t[r]=(t[r]??0)+1}for(let[r,n]of Object.entries(t))e[r]=e[r]??[],e[r].push(n)}let t={};for(let[r,n]of Object.entries(e)){let e=Math.floor(.9*(n=n.sort((e,t)=>e-t)).length);t[r]=n[e]}return t}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),await bH(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")}async stop(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),await b$(this.reconnectQueue,this.dialQueue,this.connectionPruner);let e=[];for(let t of this.connections.values())for(let r of t)e.push((async()=>{try{await r.close()}catch(e){this.log.error(e)}})());this.log("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),this.log("stopped")}getMaxConnections(){return this.maxConnections}onConnect(e){this._onConnect(e).catch(e=>{this.log.error(e)})}async _onConnect(e){let{detail:t}=e;if(!this.started)return void await t.close();if("open"!==t.status)return;let r=t.remotePeer,n=!this.connections.has(r),i=this.connections.get(r)??[];i.push(t),this.connections.set(r,i),null!=r.publicKey&&"RSA"===r.type&&await this.peerStore.patch(r,{publicKey:r.publicKey}),n&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){let{detail:t}=e,r=t.remotePeer,n=(this.connections.get(r)??[]).filter(e=>e.id!==t.id);this.connections.set(r,n),0===n.length&&(this.log("onDisconnect remove all connections for peer %p",r),this.connections.delete(r),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(null!=e)return this.connections.get(e)??[];let t=[];for(let e of this.connections.values())t=t.concat(e);return t}getConnectionsMap(){return this.connections}async openConnection(e,t={}){if(!this.started)throw new cB("Not started");this.outboundPendingConnections++;try{t.signal?.throwIfAborted();let{peerId:r}=x2(e);if(this.peerId.equals(r))throw new cI("Can not dial self");if(null!=r&&!0!==t.force){this.log("dial %p",r);let e=this.getConnections(r).find(e=>null==e.limits);if(null!=e)return this.log("had an existing non-limited connection to %p",r),t.onProgress?.(new rY("dial-queue:already-connected")),e}let n=await this.dialQueue.dial(e,{...t,priority:t.priority??SN});if("open"!==n.status)throw new cE("Remote closed connection during opening");let i=this.connections.get(n.remotePeer);null==i&&(i=[],this.connections.set(n.remotePeer,i));let s=!1;for(let e of i)if(e.id===n.id&&(s=!0),!0!==t.force&&e.id!==n.id&&e.remoteAddr.equals(n.remoteAddr))return n.abort(new cT("Duplicate multiaddr connection")),e;return s||i.push(n),n}finally{this.outboundPendingConnections--}}async closeConnections(e,t={}){let r=this.connections.get(e)??[];await Promise.all(r.map(async e=>{try{await e.close(t)}catch(t){e.abort(t)}}))}async acceptIncomingConnection(e){if(this.deny.some(t=>t.contains(e.remoteAddr.nodeAddress().address)))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(t=>t.contains(e.remoteAddr.nodeAddress().address)))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){let t=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(t,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,t),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){let e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map(e=>yz(e))}))}async isDialable(e,t={}){return this.dialQueue.isDialable(e,t)}}class SO{movingAverage;variance;deviation;forecast;timeSpan;previousTime;constructor(e){this.timeSpan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timeSpan)}push(e,t=Date.now()){if(null!=this.previousTime){let r=this.alpha(t,this.previousTime),n=e-this.movingAverage,i=r*n;this.movingAverage=r*e+(1-r)*this.movingAverage,this.variance=(1-r)*(this.variance+n*i),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+r*n}else this.movingAverage=e;this.previousTime=t}}let SL=1.2,SF=2,SU=2e3;class Sj{success;failure;next;metric;timeoutMultiplier;failureMultiplier;minTimeout;constructor(e={}){this.success=new SO(e.interval??5e3),this.failure=new SO(e.interval??5e3),this.next=new SO(e.interval??5e3),this.failureMultiplier=e.failureMultiplier??SF,this.timeoutMultiplier=e.timeoutMultiplier??SL,this.minTimeout=e.minTimeout??SU,null!=e.metricName&&(this.metric=e.metrics?.registerMetricGroup(e.metricName))}getTimeoutSignal(e={}){let t=Math.max(Math.round(this.next.movingAverage*(e.timeoutFactor??this.timeoutMultiplier)),this.minTimeout),r=AbortSignal.timeout(t),n=ch([e.signal,r]);return n.start=Date.now(),n.timeout=t,n}cleanUp(e){let t=Date.now()-e.start;e.aborted?(this.failure.push(t),this.next.push(t*this.failureMultiplier),this.metric?.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:t})):(this.success.push(t),this.next.push(t),this.metric?.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:t}))}}class SH{readNext;haveNext;ended;nextResult;constructor(){this.ended=!1,this.readNext=(0,ao.A)(),this.haveNext=(0,ao.A)()}[Symbol.asyncIterator](){return this}async next(){if(null==this.nextResult&&await this.haveNext.promise,null==this.nextResult)throw Error("HaveNext promise resolved but nextResult was undefined");let e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=(0,ao.A)(),e}async throw(e){return this.ended=!0,null!=e&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){let e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){null!=e?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(null!=e&&this.ended)throw Error("Cannot push value onto an ended pushable");for(;null!=this.nextResult;)await this.readNext.promise;null!=e?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=(0,ao.A)(),await (0,cG.W)(this.readNext.promise,t?.signal,t)}}function S$(){return new SH}class Sq extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}class Sz extends Error{code;constructor(e,t){super(e),this.code=t}}class SV extends Sz{type;constructor(e){super(e,"ABORT_ERR"),this.type="aborted",this.name="AbortError"}}function SG(e,t){let r=S$();e.sink(r).catch(async e=>{await r.end(e)}),e.sink=async e=>{for await(let t of e)await r.push(t);await r.end()};let n=e.source;null!=e.source[Symbol.iterator]?n=e.source[Symbol.iterator]():null!=e.source[Symbol.asyncIterator]&&(n=e.source[Symbol.asyncIterator]());let i=new tf;return{read:async(e,t)=>{let r;t?.signal?.throwIfAborted();let s=new Promise((e,n)=>{r=()=>{n(new SV("Read aborted"))},t?.signal?.addEventListener("abort",r)});try{if(null==e){let{done:e,value:t}=await Promise.race([n.next(),s]);if(!0===e)return new tf;return t}for(;i.byteLength<e;){let{value:e,done:t}=await Promise.race([n.next(),s]);if(!0===t)throw new Sq("unexpected end of input");i.append(e)}let t=i.sublist(0,e);return i.consume(e),t}finally{null!=r&&t?.signal?.removeEventListener("abort",r)}},write:async(e,t)=>{t?.signal?.throwIfAborted(),e instanceof Uint8Array?await r.push(e,t):await r.push(e.subarray(),t)},unwrap:()=>{if(i.byteLength>0){let r=e.source;e.source=async function*(){t?.yieldBytes===!1?yield i:yield*i,yield*r}()}return e}}}let SK=1e4,SW="1.0.0",SQ="ping",SJ="ipfs",SZ=32,SY=!0;class SX{protocol;components;log;heartbeatInterval;pingIntervalMs;abortController;timeout;abortConnectionOnPingFailure;constructor(e,t={}){this.components=e,this.protocol=`/${t.protocolPrefix??SJ}/${SQ}/${SW}`,this.log=e.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=t.pingInterval??SK,this.abortConnectionOnPingFailure=t.abortConnectionOnPingFailure??SY,this.timeout=new Sj({...t.pingTimeout??{},metrics:e.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}[Symbol.toStringTag]="@libp2p/connection-monitor";[vs]=["@libp2p/connection-monitor"];start(){this.abortController=new AbortController,this.abortController.signal,this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(e=>{Promise.resolve().then(async()=>{let t=Date.now();try{let r=this.timeout.getTimeoutSignal({signal:this.abortController?.signal}),n=await e.newStream(this.protocol,{signal:r,runOnLimitedConnection:!0}),i=SG(n);t=Date.now(),await Promise.all([i.write(vi(SZ),{signal:r}),i.read(SZ,{signal:r})]),e.rtt=Date.now()-t,await i.unwrap().close({signal:r})}catch(r){if("UnsupportedProtocolError"!==r.name)throw r;e.rtt=(Date.now()-t)/2}}).catch(t=>{this.log.error("error during heartbeat",t),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),e.abort(t)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){this.abortController?.abort(),null!=this.heartbeatInterval&&clearInterval(this.heartbeatInterval)}}class S0{routers;started;components;constructor(e,t){this.routers=t.routers??[],this.started=!1,this.components=e,this.findProviders=e.metrics?.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([e],t)=>({...t,cid:e.toString()}),getAttributesFromYieldedValue:(e,t)=>({...t,providers:[...Array.isArray(t.providers)?t.providers:[],e.id.toString()]})})??this.findProviders,this.provide=e.metrics?.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([e],t)=>({...t,cid:e.toString()})})??this.provide,this.cancelReprovide=e.metrics?.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([e],t)=>({...t,cid:e.toString()})})??this.cancelReprovide,this.put=e.metrics?.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([e])=>({key:(0,uC.d)(e,"base36")})})??this.put,this.get=e.metrics?.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([e])=>({key:(0,uC.d)(e,"base36")})})??this.get}[Symbol.toStringTag]="@libp2p/content-routing";isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async *findProviders(e,t={}){if(0===this.routers.length)throw new x_("No content routers available");let r=this,n=new Ab;for await(let i of(0,wa.A)(...r.routers.map(r=>r.findProviders(e,t))))null!=i&&(i.multiaddrs.length>0&&await this.components.peerStore.merge(i.id,{multiaddrs:i.multiaddrs}),n.has(i.id)||(n.add(i.id),yield i))}async provide(e,t={}){if(0===this.routers.length)throw new x_("No content routers available");await Promise.all(this.routers.map(async r=>{await r.provide(e,t)}))}async cancelReprovide(e,t={}){if(0===this.routers.length)throw new x_("No content routers available");await Promise.all(this.routers.map(async r=>{await r.cancelReprovide(e,t)}))}async put(e,t,r){if(!this.isStarted())throw new cB;await Promise.all(this.routers.map(async n=>{await n.put(e,t,r)}))}async get(e,t){if(!this.isStarted())throw new cB;return Promise.any(this.routers.map(async r=>r.get(e,t)))}}class S1{log;peerId;peerStore;routers;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=t.routers??[],this.findPeer=e.metrics?.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([e],t)=>({...t,peer:e.toString()})})??this.findPeer,this.getClosestPeers=e.metrics?.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([e],t)=>({...t,key:(0,uC.d)(e,"base36")}),getAttributesFromYieldedValue:(e,t)=>({...t,peers:[...Array.isArray(t.peers)?t.peers:[],e.id.toString()]})})??this.getClosestPeers}[Symbol.toStringTag]="@libp2p/peer-routing";async findPeer(e,t){if(0===this.routers.length)throw new xI("No peer routers available");if(e.toString()===this.peerId.toString())throw new xT("Should not try to find self");let r=this;for await(let n of(0,wa.A)(...this.routers.map(n=>(async function*(){try{yield await n.findPeer(e,t)}catch(e){r.log.error(e)}})())))if(null!=n)return n.multiaddrs.length>0&&await this.peerStore.merge(n.id,{multiaddrs:n.multiaddrs}),n;throw new c_}async *getClosestPeers(e,t={}){if(0===this.routers.length)throw new xI("No peer routers available");let r=this,n=l2(1024);for await(let i of al(async function*(){for await(let n of(0,wa.A)(...r.routers.map(r=>r.getClosestPeers(e,t))))yield async()=>{if(0===n.multiaddrs.length)try{n=await r.findPeer(n.id,{...t,useCache:!1})}catch(e){r.log.error("could not find peer multiaddrs",e);return}return n}}()))null!=i&&(i.multiaddrs.length>0&&await this.peerStore.merge(i.id,{multiaddrs:i.multiaddrs}),n.has(i.id.toMultihash().bytes)||(n.add(i.id.toMultihash().bytes),yield i))}}class S2 extends cf{peerRouting;log;walking;walkers;shutdownController;walkController;needNext;constructor(e){super(),this.log=e.logger.forComponent("libp2p:random-walk"),this.peerRouting=e.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,this.shutdownController.signal}[Symbol.toStringTag]="@libp2p/random-walk";start(){this.shutdownController=new AbortController,this.shutdownController.signal}stop(){this.shutdownController.abort()}async *walk(e){this.walking||this.startWalk(),this.walkers++;let t=ch([this.shutdownController.signal,e?.signal]);try{for(;;){this.needNext?.resolve(),this.needNext=(0,ao.A)();let e=await cq(this,"walk:peer",t,{errorEvent:"walk:error"});yield e.detail}}finally{t.clear(),this.walkers--,0===this.walkers&&(this.walkController?.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,this.walkController.signal;let e=ch([this.walkController.signal,this.shutdownController.signal]),t=Date.now(),r=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{let t=vi(32),n=Date.now();for await(let i of this.peerRouting.getClosestPeers(t,{signal:e}))e.aborted&&this.log("aborting walk"),e.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",i.id,Date.now()-n,this.walkers),r++,this.safeDispatchEvent("walk:peer",{detail:i}),1===this.walkers&&null!=this.needNext&&(this.log("wait for need next"),await (0,cG.W)(this.needNext.promise,e)),n=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",t,this.walkers,r)}catch(e){this.log.error("random walk errored",e),this.safeDispatchEvent("walk:error",{detail:e})}this.log("no walkers left, ended walk")}).catch(e=>{this.log.error("random walk errored",e)}).finally(()=>{this.log("finished walk, found %d peers after %dms",r,Date.now()-t),this.walking=!1})}}let S3=32,S4=64;class S5{log;topologies;handlers;components;constructor(e){this.log=e.logger.forComponent("libp2p:registrar"),this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}[Symbol.toStringTag]="@libp2p/registrar";getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){let t=this.handlers.get(e);if(null==t)throw new xC(`No handler registered for protocol ${e}`);return t}getTopologies(e){let t=this.topologies.get(e);return null==t?[]:[...t.values()]}async handle(e,t,r){if(this.handlers.has(e)&&r?.force!==!0)throw new xP(`Handler already registered for protocol ${e}`);let n=aM.bind({ignoreUndefined:!0})({maxInboundStreams:S3,maxOutboundStreams:S4},r);this.handlers.set(e,{handler:t,options:n}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]})}async unhandle(e){(Array.isArray(e)?e:[e]).forEach(e=>{this.handlers.delete(e)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()})}async register(e,t){if(null==t)throw new cy("invalid topology");let r=`${(1e9*Math.random()).toString(36)}${Date.now()}`,n=this.topologies.get(e);return null==n&&(n=new Map,this.topologies.set(e,n)),n.set(r,t),r}unregister(e){for(let[t,r]of this.topologies.entries())r.has(e)&&(r.delete(e),0===r.size&&this.topologies.delete(t))}_onDisconnect(e){let t=e.detail;this.components.peerStore.get(t).then(e=>{for(let r of e.protocols){let e=this.topologies.get(r);if(null!=e)for(let r of e.values())r.filter?.has(t)!==!1&&(r.filter?.remove(t),r.onDisconnect?.(t))}}).catch(e=>{"NotFoundError"!==e.name&&this.log.error("could not inform topologies of disconnecting peer %p",t,e)})}_onPeerUpdate(e){let{peer:t,previous:r}=e.detail;for(let e of(r?.protocols??[]).filter(e=>!t.protocols.includes(e))){let r=this.topologies.get(e);if(null!=r)for(let e of r.values())e.filter?.has(t.id)!==!1&&(e.filter?.remove(t.id),e.onDisconnect?.(t.id))}}_onPeerIdentify(e){let t=e.detail.protocols,r=e.detail.connection,n=e.detail.peerId;for(let e of t){let t=this.topologies.get(e);if(null!=t)for(let e of t.values())(null==r.limits||!0===e.notifyOnLimitedConnection)&&e.filter?.has(n)!==!0&&(e.filter?.add(n),e.onConnect?.(n,r))}}}class S6{log;components;transports;listeners;faultTolerance;started;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=new Map,this.listeners=gH({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??er.FATAL_ALL}[Symbol.toStringTag]="@libp2p/transport-manager";add(e){let t=e[Symbol.toStringTag];if(null==t)throw new cy("Transport must have a valid tag");if(this.transports.has(t))throw new cy(`There is already a transport with the tag ${t}`);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){let e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){let e=[];for(let[t,r]of this.listeners)for(this.log("closing listeners for %s",t);r.length>0;){let t=r.pop();null!=t&&e.push(t.close())}for(let t of(await Promise.all(e),this.log("all listeners closed"),this.listeners.keys()))this.listeners.set(t,[]);this.started=!1}async dial(e,t){let r=this.dialTransportForMultiaddr(e);if(null==r)throw new xU(`No transport available for address ${String(e)}`);return t?.onProgress?.(new rY("transport-manager:selected-transport",r[Symbol.toStringTag])),r.dial(e,{...t,upgrader:this.components.upgrader})}getAddrs(){let e=[];for(let t of this.listeners.values())for(let r of t)e=[...e,...r.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(e){for(let t of this.transports.values())if(t.dialFilter([e]).length>0)return t}listenTransportForMultiaddr(e){for(let t of this.transports.values())if(t.listenFilter([e]).length>0)return t}async listen(e){if(!this.isStarted())throw new cB("Not started");if(null==e||0===e.length)return void this.log("no addresses were provided for listening, this node is dial only");let t={errors:new Map,ipv4:{success:0,attempts:0},ipv6:{success:0,attempts:0}};e.forEach(e=>{t.errors.set(e.toString(),new xD)});let r=[];for(let[n,i]of this.transports.entries())for(let s of i.listenFilter(e)){this.log("creating listener for %s on %a",n,s);let e=i.createListener({upgrader:this.components.upgrader}),o=this.listeners.get(n)??[];null==o&&(o=[],this.listeners.set(n,o)),o.push(e),e.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:e})}),e.addEventListener("close",()=>{let t=o.findIndex(t=>t===e);o.splice(t,1),this.components.events.safeDispatchEvent("transport:close",{detail:e})}),mS.matches(s)?t.ipv4.attempts++:mk.matches(s)&&t.ipv6.attempts++,r.push(e.listen(s).then(()=>{t.errors.delete(s.toString()),mS.matches(s)&&t.ipv4.success++,mk.matches(s)&&t.ipv6.success++},e=>{throw this.log.error("transport %s could not listen on address %a - %e",n,s,e),t.errors.set(s.toString(),e),e}))}let n=await Promise.allSettled(r);if(!(n.length>0&&n.every(e=>"fulfilled"===e.status))){if(this.ipv6Unsupported(t))return void this.log("all IPv4 addresses succeed but all IPv6 failed");if(this.faultTolerance===er.NO_FATAL)return void this.log("failed to listen on any address but fault tolerance allows this");throw new xN(`Some configured addresses failed to be listened on, you may need to remove one or more listen addresses from your configuration or set \`transportManager.faultTolerance\` to NO_FATAL:
${[...t.errors.entries()].map(([e,t])=>`
  ${e}: ${`${t.stack??t}`.split("\n").join("\n  ")}
`).join("")}`)}}ipv6Unsupported(e){if(0===e.ipv4.attempts||0===e.ipv6.attempts)return!1;let t=e.ipv4.attempts===e.ipv4.success,r=0===e.ipv6.success;return t&&r}async remove(e){let t=this.listeners.get(e)??[];this.log.trace("removing transport %s",e);let r=[];for(this.log.trace("closing listeners for %s",e);t.length>0;){let e=t.pop();null!=e&&r.push(e.close())}await Promise.all(r),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){let e=[];for(let t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}let S8=8,S7=4194304;class S9 extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class ke extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class kt extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}class kr extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}function kn(e){return null!=e[Symbol.asyncIterator]}function ki(e,t){if(e.byteLength>t)throw new ke("Message length too long")}let ks=e=>{let t=t5(e),r=(0,to.K)(t);return re(e,r),ks.bytes=t,r};function ko(e,t){let r=(t=t??{}).lengthEncoder??ks,n=t?.maxDataLength??S7;function*i(e){ki(e,n);let t=r(e.byteLength);t instanceof Uint8Array?yield t:yield*t,e instanceof Uint8Array?yield e:yield*e}return kn(e)?async function*(){for await(let t of e)yield*i(t)}():function*(){for(let t of e)yield*i(t)}()}ks.bytes=0,ko.single=(e,t)=>{let r=(t=t??{}).lengthEncoder??ks;return ki(e,t?.maxDataLength??S7),new tf(r(e.byteLength),e)},function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(ec||(ec={}));let ka=e=>{let t=rt(e);return ka.bytes=t5(t),t};function kl(e,t){let r=new tf,n=ec.LENGTH,i=-1,s=t?.lengthDecoder??ka,o=t?.maxLengthLength??S8,a=t?.maxDataLength??S7;function*l(){for(;r.byteLength>0;){if(n===ec.LENGTH)try{if((i=s(r))<0)throw new S9("Invalid message length");if(i>a)throw new ke("Message length too long");let e=s.bytes;r.consume(e),t?.onLength!=null&&t.onLength(i),n=ec.DATA}catch(e){if(e instanceof RangeError){if(r.byteLength>o)throw new kt("Message length length too long");break}throw e}if(n===ec.DATA){if(r.byteLength<i)break;let e=r.sublist(0,i);r.consume(i),t?.onData!=null&&t.onData(e),yield e,n=ec.LENGTH}}}return kn(e)?async function*(){for await(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new kr("Unexpected end of input")}():function*(){for(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new kr("Unexpected end of input")}()}ka.bytes=0,kl.fromReader=(e,t)=>{let r=1,n=async function*(){for(;;)try{let{done:t,value:n}=await e.next(r);if(!0===t)return;null!=n&&(yield n)}catch(e){if("ERR_UNDER_READ"===e.code)return{done:!0,value:null};throw e}finally{r=1}}(),i=e=>{r=e};return kl(n,{...t??{},onLength:i})};class kc{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=(0,ao.A)(),this.haveNext=(0,ao.A)()}[Symbol.asyncIterator](){return this}async next(){if(null==this.nextResult&&await this.haveNext.promise,null==this.nextResult)throw Error("HaveNext promise resolved but nextResult was undefined");let e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=(0,ao.A)(),e}async throw(e){return this.ended=!0,this.error=e,null!=e&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){let e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){null!=e?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(null!=e&&this.ended)throw this.error??Error("Cannot push value onto an ended pushable");for(;null!=this.nextResult;)await this.readNext.promise;null!=e?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=(0,ao.A)(),await (0,cG.W)(this.readNext.promise,t?.signal,t)}}function ku(){return new kc}class kd extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}function kh(e,t){let r=ku();e.sink(r).catch(async e=>{await r.end(e)}),e.sink=async e=>{for await(let t of e)await r.push(t);await r.end()};let n=e.source;null!=e.source[Symbol.iterator]?n=e.source[Symbol.iterator]():null!=e.source[Symbol.asyncIterator]&&(n=e.source[Symbol.asyncIterator]());let i=new tf;return{read:async e=>{if(e?.signal?.throwIfAborted(),e?.bytes==null){let{done:t,value:r}=await (0,cG.W)(n.next(),e?.signal);return!0===t?null:r}for(;i.byteLength<e.bytes;){let{value:t,done:r}=await (0,cG.W)(n.next(),e?.signal);if(!0===r)throw new kd("unexpected end of input");i.append(t)}let t=i.sublist(0,e.bytes);return i.consume(e.bytes),t},write:async(e,t)=>{t?.signal?.throwIfAborted(),e instanceof Uint8Array?await r.push(e,t):await r.push(e.subarray(),t)},unwrap:()=>{if(i.byteLength>0){let r=e.source;e.source=async function*(){t?.yieldBytes===!1?yield i:yield*i,yield*r}()}return e}}}class kf extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class kp extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class kg extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}function km(e,t={}){let r=kh(e,t);null!=t.maxDataLength&&null==t.maxLengthLength&&(t.maxLengthLength=t5(t.maxDataLength));let n=t?.lengthDecoder??rt,i=t?.lengthEncoder??re;return{read:async e=>{let i=-1,s=new tf;for(;;){s.append(await r.read({...e,bytes:1}));try{i=n(s)}catch(e){if(e instanceof RangeError)continue;throw e}if(i<0)throw new kf("Invalid message length");if(t?.maxLengthLength!=null&&s.byteLength>t.maxLengthLength)throw new kg("message length length too long");if(i>-1)break}if(t?.maxDataLength!=null&&i>t.maxDataLength)throw new kp("message length too long");return r.read({...e,bytes:i})},write:async(e,t)=>{await r.write(new tf(i(e.byteLength),e),t)},writeV:async(e,t)=>{let n=new tf(...e.flatMap(e=>[i(e.byteLength),e]));await r.write(n,t)},unwrap:()=>r.unwrap()}}let ky="/multistream/1.0.0",kb=1024,kw=(0,rx.s)("\n");async function kv(e,t,r){await e.write(t,r)}async function kE(e,t,r){await e.writeV(t,r)}async function kA(e,t){let r=await e.read(t);if(0===r.byteLength||r.get(r.byteLength-1)!==kw[0])throw t.log.error("Invalid mss message - missing newline",r),new cD("Missing newline");return r.sublist(0,-1)}async function kx(e,t){let r=await kA(e,t);return(0,uC.d)(r.subarray())}async function kS(e,t,r){t=Array.isArray(t)?t:[t],r.log.trace("handle: available protocols %s",t);let n=km(e,{...r,maxDataLength:kb,maxLengthLength:2});for(;;){r.log.trace("handle: reading incoming string");let e=await kx(n,r);if(r.log.trace('handle: read "%s"',e),e===ky){r.log.trace('handle: respond with "%s" for "%s"',ky,e),await kv(n,(0,rx.s)(`${ky}
`),r),r.log.trace('handle: responded with "%s" for "%s"',ky,e);continue}if(t.includes(e))return r.log.trace('handle: respond with "%s" for "%s"',e,e),await kv(n,(0,rx.s)(`${e}
`),r),r.log.trace('handle: responded with "%s" for "%s"',e,e),{stream:n.unwrap(),protocol:e};if("ls"===e){let i=new tf(...t.map(e=>ko.single((0,rx.s)(`${e}
`))),(0,rx.s)("\n"));r.log.trace('handle: respond with "%s" for %s',t,e),await kv(n,i,r),r.log.trace('handle: responded with "%s" for %s',t,e);continue}r.log.trace('handle: respond with "na" for "%s"',e),await kv(n,(0,rx.s)("na\n"),r),r.log('handle: responded with "na" for "%s"',e)}}async function kk(e,t,r){if(1===(t=Array.isArray(t)?[...t]:[t]).length&&!1===r.negotiateFully)return k_(e,t[0],r);let n=km(e,{...r,maxDataLength:kb}),i=t.shift();if(null==i)throw Error("At least one protocol must be specified");r.log.trace('select: write ["%s", "%s"]',ky,i);let s=(0,rx.s)(`${ky}
`),o=(0,rx.s)(`${i}
`);await kE(n,[s,o],r),r.log.trace("select: reading multistream-select header");let a=await kx(n,r);if(r.log.trace('select: read "%s"',a),a===ky&&(r.log.trace("select: reading protocol response"),a=await kx(n,r),r.log.trace('select: read "%s"',a)),a===i)return{stream:n.unwrap(),protocol:i};for(let e of t){r.log.trace('select: write "%s"',e),await kv(n,(0,rx.s)(`${e}
`),r),r.log.trace("select: reading protocol response");let t=await kx(n,r);if(r.log.trace('select: read "%s" for "%s"',t,e),t===e)return{stream:n.unwrap(),protocol:e}}throw new cR("protocol selection failed")}function k_(e,t,r){let n=e.sink.bind(e),i=e.source,s=!1,o=!1,a=(0,ao.A)(),l=!1,c=!1,u=(0,ao.A)(),d=!1,h=!1,f=(0,ao.A)(),p=km({sink:n,source:i},{...r,maxDataLength:kb});async function g(){if(o){r.log.trace("optimistic: already negotiating %s stream",t),await a.promise;return}o=!0;try{l||(r.log.trace("optimistic: doing send protocol for %s stream",t),await m()),d||(r.log.trace("optimistic: doing read protocol for %s stream",t),await y())}finally{o=!1,s=!0,a.resolve()}}async function m(){if(c)return void await u.promise;c=!0;try{r.log.trace('optimistic: write ["%s", "%s", data] in source',ky,t),await p.writeV([(0,rx.s)(`${ky}
`),(0,rx.s)(`${t}
`)]),r.log.trace('optimistic: wrote ["%s", "%s", data] in source',ky,t)}finally{l=!0,c=!1,u.resolve()}}async function y(){if(h)return void await f.promise;h=!0;try{r.log.trace("optimistic: reading multistream select header");let e=await kx(p,r);if(r.log.trace('optimistic: read multistream select header "%s"',e),e===ky&&(e=await kx(p,r)),r.log.trace('optimistic: read protocol "%s", expecting "%s"',e,t),e!==t)throw new cR("protocol selection failed")}finally{d=!0,h=!1,f.resolve()}}if(e.sink=async e=>{let{sink:n}=p.unwrap();await n(async function*(){let n=!1;for await(let i of e){if(c&&await u.promise,l)yield i;else{c=!0,r.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',ky,t,i.byteLength);let e=`${t}
`;yield new tf(Uint8Array.from([19]),(0,rx.s)(`${ky}
`),re(e.length),(0,rx.s)(e),i).subarray(),r.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',ky,t,i.byteLength),l=!0,c=!1,u.resolve(),g().catch(e=>{r.log.error("could not finish optimistic protocol negotiation of %s",t,e)})}n=!0}n||await g()}())},e.source=async function*(){await g(),r.log.trace('optimistic: reading data from "%s" stream',t),yield*p.unwrap().source}(),null!=e.closeRead){let t=e.closeRead.bind(e);e.closeRead=async e=>{s||await g().catch(e=>{r.log.error("could not negotiate protocol before close read",e)}),await t(e)}}if(null!=e.closeWrite){let t=e.closeWrite.bind(e);e.closeWrite=async e=>{s||await g().catch(e=>{r.log.error("could not negotiate protocol before close write",e)}),await t(e)}}if(null!=e.close){let t=e.close.bind(e);e.close=async e=>{let r=[];c&&r.push(u.promise),h&&r.push(f.promise),r.length>0?await (0,cG.W)(Promise.all(r),e?.signal):(s=!0,o=!1,a.resolve()),await t(e)}}return{stream:e,protocol:t}}let kI=Symbol.for("@libp2p/connection"),kT=500;class kC{id;remoteAddr;remotePeer;direction;timeline;multiplexer;encryption;status;limits;log;tags;_newStream;_close;_abort;_getStreams;constructor(e){let{remoteAddr:t,remotePeer:r,newStream:n,close:i,abort:s,getStreams:o}=e;this.id=`${parseInt(String(1e9*Math.random())).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=r,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.limits=e.limits,this.log=e.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),null==this.remoteAddr.getPeerId()&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=n,this._close=i,this._abort=s,this._getStreams=o,this.tags=[]}[Symbol.toStringTag]="Connection";[kI]=!0;get streams(){return this._getStreams()}async newStream(e,t){if("closing"===this.status)throw new cv("the connection is being closed");if("closed"===this.status)throw new cE("the connection is closed");if(Array.isArray(e)||(e=[e]),null!=this.limits&&t?.runOnLimitedConnection!==!0)throw new cF("Cannot open protocol stream on limited connection");let r=await this._newStream(e,t);return r.direction="outbound",r}async close(e={}){if("closed"!==this.status&&"closing"!==this.status){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",null==e.signal){let t=AbortSignal.timeout(kT);e={...e,signal:t}}try{this.log.trace("closing underlying transport"),await this._close(e),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(e){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,e),this.abort(e)}}}abort(e){"closed"!==this.status&&(this.log.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this._abort(e),this.status="closed",this.timeline.close=Date.now())}}function kP(e){return new kC(e)}function kR(e,t){try{let{options:r}=t.getHandler(e);return r.maxInboundStreams}catch(e){if("UnhandledProtocolError"!==e.name)throw e}return S3}function kD(e,t,r={}){try{let{options:r}=t.getHandler(e);if(null!=r.maxOutboundStreams)return r.maxOutboundStreams}catch(e){if("UnhandledProtocolError"!==e.name)throw e}return r.maxOutboundStreams??S4}function kN(e,t,r){let n=0;return r.streams.forEach(r=>{r.direction===t&&r.protocol===e&&n++}),n}class kM{components;connectionEncrypters;streamMuxers;inboundUpgradeTimeout;inboundStreamProtocolNegotiationTimeout;outboundStreamProtocolNegotiationTimeout;events;metrics;constructor(e,t){this.components=e,this.connectionEncrypters=new Map,t.connectionEncrypters.forEach(e=>{this.connectionEncrypters.set(e.protocol,e)}),this.streamMuxers=new Map,t.streamMuxers.forEach(e=>{this.streamMuxers.set(e.protocol,e)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??Sr,this.inboundStreamProtocolNegotiationTimeout=t.inboundStreamProtocolNegotiationTimeout??Sn,this.outboundStreamProtocolNegotiationTimeout=t.outboundStreamProtocolNegotiationTimeout??Sn,this.events=e.events,this.metrics={dials:e.metrics?.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:e.metrics?.registerCounterGroup("libp2p_connection_manager_dial_errors_total")}}[Symbol.toStringTag]="@libp2p/upgrader";async shouldBlockConnection(e,...t){let r=this.components.connectionGater[e];if(null!=r&&!0===await r.apply(this.components.connectionGater,t))throw new xB(`The multiaddr connection is blocked by gater.${e}`)}createInboundAbortSignal(e){return ch([AbortSignal.timeout(this.inboundUpgradeTimeout),e])}async upgradeInbound(e,t){let r=!1,n=this.createInboundAbortSignal(t.signal);try{if(this.metrics.dials?.increment({inbound:!0}),!(r=await this.components.connectionManager.acceptIncomingConnection(e)))throw new xO("Connection denied");await this.shouldBlockConnection("denyInboundConnection",e),await this._performUpgrade(e,"inbound",{...t,signal:n})}catch(e){throw this.metrics.errors?.increment({inbound:!0}),e}finally{n.clear(),r&&this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,t){try{let r;this.metrics.dials?.increment({outbound:!0});let n=e.remoteAddr.getPeerId();null!=n&&(r=gf(n),await this.shouldBlockConnection("denyOutboundConnection",r,e));let i="outbound";return!1===t.initiator&&(i="inbound"),await this._performUpgrade(e,i,t)}catch(e){throw this.metrics.errors?.increment({outbound:!0}),e}}async _performUpgrade(e,t,r){let n,i,s,o,a;this.components.metrics?.trackMultiaddrConnection(e),e.log.trace("starting the %s connection upgrade",t);let l=e;if(r?.skipProtection!==!0){let n=this.components.connectionProtector;null!=n&&(e.log("protecting the %s connection",t),l=await n.protect(e,r))}try{if(n=l,r?.skipEncryption!==!0){r?.onProgress?.(new rY(`upgrader:encrypt-${t}-connection`)),{conn:n,remotePeer:i,protocol:a,streamMuxer:o}=await ("inbound"===t?this._encryptInbound(l,r):this._encryptOutbound(l,r));let e={...l,...n};await this.shouldBlockConnection("inbound"===t?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",i,e)}else{let r=e.remoteAddr.getPeerId();if(null==r)throw new cT(`${t} connection that skipped encryption must have a peer id`);let n=gf(r);a="native",i=n}if(i.equals(this.components.peerId)){let t=new cI("Can not dial self");throw e.abort(t),t}if(s=n,r?.muxerFactory!=null)o=r.muxerFactory;else if(null==o&&this.streamMuxers.size>0){r?.onProgress?.(new rY(`upgrader:multiplex-${t}-connection`));let e=await ("inbound"===t?this._multiplexInbound({...l,...n},this.streamMuxers,r):this._multiplexOutbound({...l,...n},this.streamMuxers,r));o=e.muxerFactory,s=e.stream}}catch(r){throw e.log.error("failed to upgrade inbound connection %s %a - %e","inbound"===t?"from":"to",e.remoteAddr,r),r}return await this.shouldBlockConnection("inbound"===t?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",i,e),e.log("successfully upgraded %s connection",t),this._createConnection({cryptoProtocol:a,direction:t,maConn:e,upgradedConn:s,muxerFactory:o,remotePeer:i,limits:r?.limits})}_createConnection(e){let t,r,n,{cryptoProtocol:i,direction:s,maConn:o,upgradedConn:a,remotePeer:l,muxerFactory:c,limits:u}=e;null!=c&&(t=c.createStreamMuxer({direction:s,onIncomingStream:e=>{null!=n&&Promise.resolve().then(async()=>{let t=this.components.registrar.getProtocols(),r=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout),{stream:i,protocol:s}=await kS(e,t,{signal:r,log:e.log,yieldBytes:!1});if(null==n)return;n.log("incoming stream opened on %s",s);let o=kR(s,this.components.registrar);if(kN(s,"inbound",n)===o){let t=new cU(`Too many inbound protocol streams for protocol "${s}" - limit ${o}`);throw e.abort(t),t}e.source=i.source,e.sink=i.sink,e.protocol=s,null!=i.closeWrite&&(e.closeWrite=i.closeWrite),null!=i.closeRead&&(e.closeRead=i.closeRead),null!=i.close&&(e.close=i.close),await this.components.peerStore.merge(l,{protocols:[s]}),this.components.metrics?.trackProtocolStream(e,n),this._onStream({connection:n,stream:e,protocol:s})}).catch(async t=>{n.log.error("error handling incoming stream id %s - %e",e.id,t),null==e.timeline.close&&await e.close()})}}),r=async(r,i={})=>{if(null==t)throw new xL("Connection is not multiplexed");n.log.trace("starting new stream for protocols %s",r);let o=await t.newStream();n.log.trace("started new stream %s for protocols %s",o.id,r);try{if(null==i.signal){o.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",r);let e=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);i={...i,signal:e}}o.log.trace("selecting protocol from protocols %s",r);let{stream:e,protocol:t}=await kk(o,r,{...i,log:o.log,yieldBytes:!0});o.log.trace("selected protocol %s",t);let s=kD(t,this.components.registrar,i),a=kN(t,"outbound",n);if(a>=s){let e=new cj(`Too many outbound protocol streams for protocol "${t}" - ${a}/${s}`);throw o.abort(e),e}return await this.components.peerStore.merge(l,{protocols:[t]}),o.source=e.source,o.sink=e.sink,o.protocol=t,null!=e.closeWrite&&(o.closeWrite=e.closeWrite),null!=e.closeRead&&(o.closeRead=e.closeRead),null!=e.close&&(o.close=e.close),this.components.metrics?.trackProtocolStream(o,n),o}catch(t){throw n.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e","inbound"===s?"from":"to",e.maConn.remoteAddr,r,t),null==o.timeline.close&&o.abort(t),t}},Promise.all([t.sink(a.source),a.sink(t.source)]).catch(e=>{n.log.error("error piping data through muxer - %e",e)}));let d=o.timeline;o.timeline=new Proxy(d,{set:(...e)=>("close"===e[1]&&null!=e[2]&&null==d.close&&(async()=>{try{"open"===n.status&&await n.close()}catch(e){n.log.error("error closing connection after timeline close %e",e)}finally{this.events.safeDispatchEvent("connection:close",{detail:n})}})().catch(e=>{n.log.error("error thrown while dispatching connection:close event %e",e)}),Reflect.set(...e))}),o.timeline.upgraded=Date.now();let h=()=>{throw new xL("Connection is not multiplexed")};return n=kP({remoteAddr:o.remoteAddr,remotePeer:l,status:"open",direction:s,timeline:o.timeline,multiplexer:t?.protocol,encryption:i,limits:u,logger:this.components.logger,newStream:r??h,getStreams:()=>t?.streams??[],close:async e=>{await t?.close(e),await o.close(e)},abort:e=>{o.abort(e),t?.abort(e)}}),this.events.safeDispatchEvent("connection:open",{detail:n}),n.__maConnTimeline=d,n}_onStream(e){let{connection:t,stream:r,protocol:n}=e,{handler:i,options:s}=this.components.registrar.getHandler(n);if(null!=t.limits&&!0!==s.runOnLimitedConnection)throw new cF("Cannot open protocol stream on limited connection");i({connection:t,stream:r})}async _encryptInbound(e,t){let r=Array.from(this.connectionEncrypters.keys());try{let{stream:n,protocol:i}=await kS(e,r,{...t,log:e.log}),s=this.connectionEncrypters.get(i);if(null==s)throw new xF(`no crypto module found for ${i}`);return e.log("encrypting inbound connection to %a using %s",e.remoteAddr,i),{...await s.secureInbound(n,t),protocol:i}}catch(t){throw e.log.error("encrypting inbound connection from %a failed",e.remoteAddr,t),new xF(t.message)}}async _encryptOutbound(e,t){let r=Array.from(this.connectionEncrypters.keys());try{e.log.trace("selecting encrypter from %s",r);let{stream:n,protocol:i}=await kk(e,r,{...t,log:e.log,yieldBytes:!0}),s=this.connectionEncrypters.get(i);if(null==s)throw new xF(`no crypto module found for ${i}`);return e.log("encrypting outbound connection to %a using %s",e.remoteAddr,i),{...await s.secureOutbound(n,t),protocol:i}}catch(t){throw e.log.error("encrypting outbound connection to %a failed",e.remoteAddr,t),new xF(t.message)}}async _multiplexOutbound(e,t,r){let n=Array.from(t.keys());e.log("outbound selecting muxer %s",n);try{e.log.trace("selecting stream muxer from %s",n);let{stream:i,protocol:s}=await kk(e,n,{...r,log:e.log,yieldBytes:!0});e.log("selected %s as muxer protocol",s);let o=t.get(s);return{stream:i,muxerFactory:o}}catch(t){throw e.log.error("error multiplexing outbound connection",t),new xL(String(t))}}async _multiplexInbound(e,t,r){let n=Array.from(t.keys());e.log("inbound handling muxers %s",n);try{let{stream:i,protocol:s}=await kS(e,n,{...r,log:e.log}),o=t.get(s);return{stream:i,muxerFactory:o}}catch(t){throw e.log.error("error multiplexing inbound connection",t),new xL(String(t))}}getConnectionEncrypters(){return this.connectionEncrypters}getStreamMuxers(){return this.streamMuxers}}let kB="2.8.2",kO="js-libp2p";function kL(e,t){return`${e??kO}/${t??kB} browser/${globalThis.navigator.userAgent}`}class kF extends cf{peerId;peerStore;contentRouting;peerRouting;metrics;services;logger;status;components;log;constructor(e){super(),this.status="stopped";let t=new cf,r=t.dispatchEvent.bind(t);t.dispatchEvent=e=>{let t=r(e),n=this.dispatchEvent(new CustomEvent(e.type,{detail:e.detail}));return t||n},this.peerId=e.peerId,this.logger=e.logger??(0,aB.Um)(),this.log=this.logger.forComponent("libp2p"),this.services={};let n=e.nodeInfo?.name??kO,i=e.nodeInfo?.version??kB,s=this.components=xq({peerId:e.peerId,privateKey:e.privateKey,nodeInfo:{name:n,version:i,userAgent:e.nodeInfo?.userAgent??kL(n,i)},logger:this.logger,events:t,datastore:e.datastore??new A2.b,connectionGater:xJ(e.connectionGater),dns:e.dns});this.peerStore=this.configureComponent("peerStore",A1(s,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...e.peerStore})),null!=e.metrics&&(this.metrics=this.configureComponent("metrics",e.metrics(this.components))),s.events.addEventListener("peer:update",e=>{if(null==e.detail.previous){let t={id:e.detail.peer.id,multiaddrs:e.detail.peer.addresses.map(e=>e.multiaddr)};s.events.safeDispatchEvent("peer:discovery",{detail:t})}}),null!=e.connectionProtector&&this.configureComponent("connectionProtector",e.connectionProtector(s)),this.components.upgrader=new kM(this.components,{connectionEncrypters:(e.connectionEncrypters??[]).map((e,t)=>this.configureComponent(`connection-encryption-${t}`,e(this.components))),streamMuxers:(e.streamMuxers??[]).map((e,t)=>this.configureComponent(`stream-muxers-${t}`,e(this.components))),inboundUpgradeTimeout:e.connectionManager?.inboundUpgradeTimeout,inboundStreamProtocolNegotiationTimeout:e.connectionManager?.inboundStreamProtocolNegotiationTimeout??e.connectionManager?.protocolNegotiationTimeout,outboundStreamProtocolNegotiationTimeout:e.connectionManager?.outboundStreamProtocolNegotiationTimeout??e.connectionManager?.protocolNegotiationTimeout}),this.configureComponent("transportManager",new S6(this.components,e.transportManager)),this.configureComponent("connectionManager",new SB(this.components,e.connectionManager)),e.connectionMonitor?.enabled!==!1&&this.configureComponent("connectionMonitor",new SX(this.components,e.connectionMonitor)),this.configureComponent("registrar",new S5(this.components)),this.configureComponent("addressManager",new xx(this.components,e.addresses));let o=(e.peerRouters??[]).map((e,t)=>this.configureComponent(`peer-router-${t}`,e(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new S1(this.components,{routers:o}));let a=(e.contentRouters??[]).map((e,t)=>this.configureComponent(`content-router-${t}`,e(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new S0(this.components,{routers:a})),this.configureComponent("randomWalk",new S2(this.components)),(e.peerDiscovery??[]).forEach((e,t)=>{this.configureComponent(`peer-discovery-${t}`,e(this.components)).addEventListener("peer",e=>{this.#G(e)})}),e.transports?.forEach((e,t)=>{this.components.transportManager.add(this.configureComponent(`transport-${t}`,e(this.components)))}),null!=e.services)for(let t of Object.keys(e.services)){let r=(0,e.services[t])(this.components);if(null==r){this.log.error("service factory %s returned null or undefined instance",t);continue}this.services[t]=r,this.configureComponent(t,r),null!=r[bF]&&(this.log("registering service %s for content routing",t),a.push(r[bF])),null!=r[bU]&&(this.log("registering service %s for peer routing",t),o.push(r[bU])),null!=r[Ay]&&(this.log("registering service %s for peer discovery",t),r[Ay].addEventListener?.("peer",e=>{this.#G(e)}))}xz(s)}configureComponent(e,t){return null==t&&this.log.error("component %s was null or undefined",e),this.components[e]=t,t}async start(){if("stopped"===this.status){this.status="starting",this.log("libp2p is starting");try{await this.components.beforeStart?.(),await this.components.start(),await this.components.afterStart?.(),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(e){throw this.log.error("An error occurred starting libp2p",e),this.status="started",await this.stop(),e}}}async stop(){"started"===this.status&&(this.log("libp2p is stopping"),this.status="stopping",await this.components.beforeStop?.(),await this.components.stop(),await this.components.afterStop?.(),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(e){return this.components.connectionManager.getConnections(e)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){let e=new Ab;for(let t of this.components.connectionManager.getConnections())e.add(t.remotePeer);return Array.from(e)}async dial(e,t={}){return this.components.connectionManager.openConnection(e,{priority:75,...t})}async dialProtocol(e,t,r={}){if(null==t||0===(t=Array.isArray(t)?t:[t]).length)throw new cy("no protocols were provided to open a stream");return(await this.dial(e,r)).newStream(t,r)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(e,t={}){yq(e)&&(e=gf(e.getPeerId()??"")),await this.components.connectionManager.closeConnections(e,t)}async getPublicKey(e,t={}){if(this.log("getPublicKey %p",e),null!=e.publicKey)return e.publicKey;try{let t=await this.peerStore.get(e);if(null!=t.id.publicKey)return t.id.publicKey}catch(e){if("NotFoundError"!==e.name)throw e}let r=tl([(0,rx.s)("/pk/"),e.toMultihash().bytes]),n=p2(await this.contentRouting.get(r,t));return await this.peerStore.patch(e,{publicKey:n}),n}async handle(e,t,r){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async e=>{await this.components.registrar.handle(e,t,r)}))}async unhandle(e){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async e=>{await this.components.registrar.unhandle(e)}))}async register(e,t){return this.components.registrar.register(e,t)}unregister(e){this.components.registrar.unregister(e)}async isDialable(e,t={}){return this.components.connectionManager.isDialable(e,t)}#G(e){let{detail:t}=e;if(t.id.toString()===this.peerId.toString())return void this.log.error("peer discovery mechanism discovered self");this.components.peerStore.merge(t.id,{multiaddrs:t.multiaddrs}).catch(e=>{this.log.error(e)})}}async function kU(e={}){e.privateKey??=await p1("Ed25519");let t=new kF({...await Am(e),peerId:gg(e.privateKey)});return!1!==e.start&&await t.start(),t}let kj=8,kH=4194304;class k$ extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class kq extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class kz extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}class kV extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}function kG(e){return null!=e[Symbol.asyncIterator]}function kK(e,t){if(e.byteLength>t)throw new kq("Message length too long")}let kW=e=>{let t=t5(e),r=(0,to.K)(t);return re(e,r),kW.bytes=t,r};kW.bytes=0,function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(eu||(eu={}));let kQ=e=>{let t=rt(e);return kQ.bytes=t5(t),t};function kJ(e,t){let r=new tf,n=eu.LENGTH,i=-1,s=t?.lengthDecoder??kQ,o=t?.maxLengthLength??kj,a=t?.maxDataLength??kH;function*l(){for(;r.byteLength>0;){if(n===eu.LENGTH)try{if((i=s(r))<0)throw new k$("Invalid message length");if(i>a)throw new kq("Message length too long");let e=s.bytes;r.consume(e),t?.onLength!=null&&t.onLength(i),n=eu.DATA}catch(e){if(e instanceof RangeError){if(r.byteLength>o)throw new kz("Message length length too long");break}throw e}if(n===eu.DATA){if(r.byteLength<i)break;let e=r.sublist(0,i);r.consume(i),t?.onData!=null&&t.onData(e),yield e,n=eu.LENGTH}}}return kG(e)?async function*(){for await(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new kV("Unexpected end of input")}():function*(){for(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new kV("Unexpected end of input")}()}kQ.bytes=0,kJ.fromReader=(e,t)=>{let r=1,n=async function*(){for(;;)try{let{done:t,value:n}=await e.next(r);if(!0===t)return;null!=n&&(yield n)}catch(e){if("ERR_UNDER_READ"===e.code)return{done:!0,value:null};throw e}finally{r=1}}(),i=e=>{r=e};return kJ(n,{...t??{},onLength:i})};class kZ extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class kY extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class kX extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}function k0(e,t={}){let r=SG(e,t);null!=t.maxDataLength&&null==t.maxLengthLength&&(t.maxLengthLength=t5(t.maxDataLength));let n=t?.lengthDecoder??rt,i=t?.lengthEncoder??re;return{read:async e=>{let i=-1,s=new tf;for(;;){s.append(await r.read(1,e));try{i=n(s)}catch(e){if(e instanceof RangeError)continue;throw e}if(i<0)throw new kZ("Invalid message length");if(t?.maxLengthLength!=null&&s.byteLength>t.maxLengthLength)throw new kX("message length length too long");if(i>-1)break}if(t?.maxDataLength!=null&&i>t.maxDataLength)throw new kY("message length too long");return r.read(i,e)},write:async(e,t)=>{await r.write(new tf(i(e.byteLength),e),t)},writeV:async(e,t)=>{let n=new tf(...e.flatMap(e=>[i(e.byteLength),e]));await r.write(n,t)},unwrap:()=>r.unwrap()}}function k1(){let e=(0,ao.A)(),t=!1;return{sink:async r=>{if(t)throw Error("already piped");t=!0,e.resolve(r)},source:async function*(){let t=await e.promise;yield*t}()}}function k2(){let e=k1(),t=k1();return[{source:e.source,sink:t.sink},{source:t.source,sink:e.sink}]}let k3=65535,k4=65519,k5=!!globalThis.process?.env?.DUMP_SESSION_KEYS;function k6(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function k8(e){if("boolean"!=typeof e)throw Error(`boolean expected, not ${e}`)}function k7(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function k9(e,...t){if(!k6(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function _e(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function _t(e,t){k9(e);let r=t.outputLen;if(e.length<r)throw Error("digestInto() expects output buffer of length at least "+r)}function _r(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function _n(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function _i(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}let _s=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0],_o=null,_a=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0")),_l={_0:48,_9:57,A:65,F:70,a:97,f:102};function _c(e){return e>=_l._0&&e<=_l._9?e-_l._0:e>=_l.A&&e<=_l.F?e-(_l.A-10):e>=_l.a&&e<=_l.f?e-(_l.a-10):void 0}function _u(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function _d(e){if("string"==typeof e)e=_u(e);else if(k6(e))e=_w(e);else throw Error("Uint8Array expected, got "+typeof e);return e}function _h(e,t){if(null==t||"object"!=typeof t)throw Error("options must be defined");return Object.assign(e,t)}function _f(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r}let _p=(e,t)=>{function r(n,...i){if(k9(n),!_s)throw Error("Non little-endian hardware is not yet supported");if(void 0!==e.nonceLength){let t=i[0];if(!t)throw Error("nonce / iv required");e.varSizeNonce?k9(t):k9(t,e.nonceLength)}let s=e.tagLength;s&&void 0!==i[1]&&k9(i[1]);let o=t(n,...i),a=(e,t)=>{if(void 0!==t){if(2!==e)throw Error("cipher output not supported");k9(t)}},l=!1;return{encrypt(e,t){if(l)throw Error("cannot encrypt() twice with same key + nonce");return l=!0,k9(e),a(o.encrypt.length,t),o.encrypt(e,t)},decrypt(e,t){if(k9(e),s&&e.length<s)throw Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,t),o.decrypt(e,t)}}}return Object.assign(r,e),r};function _g(e,t,r=!0){if(void 0===t)return new Uint8Array(e);if(t.length!==e)throw Error("invalid output length, expected "+e+", got: "+t.length);if(r&&!_b(t))throw Error("invalid output, must be aligned");return t}function _m(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);let i=BigInt(32),s=BigInt(0xffffffff),o=Number(r>>i&s),a=Number(r&s),l=4*!!n,c=4*!n;e.setUint32(t+l,o,n),e.setUint32(t+c,a,n)}function _y(e,t,r){k8(r);let n=new Uint8Array(16),i=_i(n);return _m(i,0,BigInt(t),r),_m(i,8,BigInt(e),r),n}function _b(e){return e.byteOffset%4==0}function _w(e){return Uint8Array.from(e)}let _v=e=>Uint8Array.from(e.split("").map(e=>e.charCodeAt(0))),_E=_v("expand 16-byte k"),_A=_v("expand 32-byte k"),_x=_r(_E),_S=_r(_A);function _k(e,t){return e<<t|e>>>32-t}function __(e){return e.byteOffset%4==0}let _I=64,_T=16,_C=0x100000000-1,_P=new Uint32Array;function _R(e,t,r,n,i,s,o,a){let l=i.length,c=new Uint8Array(_I),u=_r(c),d=__(i)&&__(s),h=d?_r(i):_P,f=d?_r(s):_P;for(let p=0;p<l;o++){if(e(t,r,n,u,o,a),o>=_C)throw Error("arx: counter overflow");let g=Math.min(_I,l-p);if(d&&g===_I){let e=p/4;if(p%4!=0)throw Error("arx: invalid block position");for(let t=0,r;t<_T;t++)f[r=e+t]=h[r]^u[t];p+=_I;continue}for(let e=0,t;e<g;e++)s[t=p+e]=i[t]^c[e];p+=g}}function _D(e,t){let{allowShortKeys:r,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=_h({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw Error("core must be a function");return k7(i),k7(o),k8(s),k8(r),(t,a,l,c,u=0)=>{let d,h;k9(t),k9(a),k9(l);let f=l.length;if(void 0===c&&(c=new Uint8Array(f)),k9(c),k7(u),u<0||u>=_C)throw Error("arx: counter overflow");if(c.length<f)throw Error(`arx: output (${c.length}) is shorter than data (${f})`);let p=[],g=t.length;if(32===g)p.push(d=_w(t)),h=_S;else if(16===g&&r)(d=new Uint8Array(32)).set(t),d.set(t,16),h=_x,p.push(d);else throw Error(`arx: invalid 32-byte key, got length=${g}`);__(a)||p.push(a=_w(a));let m=_r(d);if(n){if(24!==a.length)throw Error("arx: extended nonce must be 24 bytes");n(h,m,_r(a.subarray(0,16)),m),a=a.subarray(16)}let y=16-i;if(y!==a.length)throw Error(`arx: nonce must be ${y} or 16 bytes`);if(12!==y){let e=new Uint8Array(12);e.set(a,s?0:12-a.length),a=e,p.push(a)}return _R(e,h,m,_r(a),l,c,u,o),_n(...p),c}}let _N=(e,t)=>255&e[t++]|(255&e[t++])<<8;class _M{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,k9(e=_d(e),32);let t=_N(e,0),r=_N(e,2),n=_N(e,4),i=_N(e,6),s=_N(e,8),o=_N(e,10),a=_N(e,12),l=_N(e,14);this.r[0]=8191&t,this.r[1]=(t>>>13|r<<3)&8191,this.r[2]=(r>>>10|n<<6)&7939,this.r[3]=(n>>>7|i<<9)&8191,this.r[4]=(i>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|o<<2)&8191,this.r[7]=(o>>>11|a<<5)&8065,this.r[8]=(a>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let t=0;t<8;t++)this.pad[t]=_N(e,16+2*t)}process(e,t,r=!1){let n=2048*!r,{h:i,r:s}=this,o=s[0],a=s[1],l=s[2],c=s[3],u=s[4],d=s[5],h=s[6],f=s[7],p=s[8],g=s[9],m=_N(e,t+0),y=_N(e,t+2),b=_N(e,t+4),w=_N(e,t+6),v=_N(e,t+8),E=_N(e,t+10),A=_N(e,t+12),x=_N(e,t+14),S=i[0]+(8191&m),k=i[1]+((m>>>13|y<<3)&8191),_=i[2]+((y>>>10|b<<6)&8191),I=i[3]+((b>>>7|w<<9)&8191),T=i[4]+((w>>>4|v<<12)&8191),C=i[5]+(v>>>1&8191),P=i[6]+((v>>>14|E<<2)&8191),R=i[7]+((E>>>11|A<<5)&8191),D=i[8]+((A>>>8|x<<8)&8191),N=i[9]+(x>>>5|n),M=0,B=0+S*o+5*g*k+5*p*_+5*f*I+5*h*T;M=B>>>13,B&=8191,B+=5*d*C+5*u*P+5*c*R+5*l*D+5*a*N,M+=B>>>13,B&=8191;let O=M+S*a+k*o+5*g*_+5*p*I+5*f*T;M=O>>>13,O&=8191,O+=5*h*C+5*d*P+5*u*R+5*c*D+5*l*N,M+=O>>>13,O&=8191;let L=M+S*l+k*a+_*o+5*g*I+5*p*T;M=L>>>13,L&=8191,L+=5*f*C+5*h*P+5*d*R+5*u*D+5*c*N,M+=L>>>13,L&=8191;let F=M+S*c+k*l+_*a+I*o+5*g*T;M=F>>>13,F&=8191,F+=5*p*C+5*f*P+5*h*R+5*d*D+5*u*N,M+=F>>>13,F&=8191;let U=M+S*u+k*c+_*l+I*a+T*o;M=U>>>13,U&=8191,U+=5*g*C+5*p*P+5*f*R+5*h*D+5*d*N,M+=U>>>13,U&=8191;let j=M+S*d+k*u+_*c+I*l+T*a;M=j>>>13,j&=8191,j+=C*o+5*g*P+5*p*R+5*f*D+5*h*N,M+=j>>>13,j&=8191;let H=M+S*h+k*d+_*u+I*c+T*l;M=H>>>13,H&=8191,H+=C*a+P*o+5*g*R+5*p*D+5*f*N,M+=H>>>13,H&=8191;let $=M+S*f+k*h+_*d+I*u+T*c;M=$>>>13,$&=8191,$+=C*l+P*a+R*o+5*g*D+5*p*N,M+=$>>>13,$&=8191;let q=M+S*p+k*f+_*h+I*d+T*u;M=q>>>13,q&=8191,q+=C*c+P*l+R*a+D*o+5*g*N,M+=q>>>13,q&=8191;let z=M+S*g+k*p+_*f+I*h+T*d;M=z>>>13,z&=8191,z+=C*u+P*c+R*l+D*a+N*o,M+=z>>>13,z&=8191,B=8191&(M=(M=(M<<2)+M|0)+B|0),M>>>=13,O+=M,i[0]=B,i[1]=O,i[2]=L,i[3]=F,i[4]=U,i[5]=j,i[6]=H,i[7]=$,i[8]=q,i[9]=z}finalize(){let{h:e,pad:t}=this,r=new Uint16Array(10),n=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=n,n=e[t]>>>13,e[t]&=8191;e[0]+=5*n,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,r[0]=e[0]+5,n=r[0]>>>13,r[0]&=8191;for(let t=1;t<10;t++)r[t]=e[t]+n,n=r[t]>>>13,r[t]&=8191;r[9]-=8192;let i=(1^n)-1;for(let e=0;e<10;e++)r[e]&=i;i=~i;for(let t=0;t<10;t++)e[t]=e[t]&i|r[t];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let s=e[0]+t[0];e[0]=65535&s;for(let r=1;r<8;r++)s=(e[r]+t[r]|0)+(s>>>16)|0,e[r]=65535&s;_n(r)}update(e){_e(this),k9(e=_d(e));let{buffer:t,blockLen:r}=this,n=e.length;for(let i=0;i<n;){let s=Math.min(r-this.pos,n-i);if(s===r){for(;r<=n-i;i+=r)this.process(e,i);continue}t.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===r&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){_n(this.h,this.r,this.buffer,this.pad)}digestInto(e){_e(this),_t(e,this),this.finished=!0;let{buffer:t,h:r}=this,{pos:n}=this;if(n){for(t[n++]=1;n<16;n++)t[n]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let t=0;t<8;t++)e[i++]=r[t]>>>0,e[i++]=r[t]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}}let _B=function(e){let t=(t,r)=>e(r).update(_d(t)).digest(),r=e(new Uint8Array(32));return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}(e=>new _M(e));function _O(e,t,r,n,i,s=20){let o=e[0],a=e[1],l=e[2],c=e[3],u=t[0],d=t[1],h=t[2],f=t[3],p=t[4],g=t[5],m=t[6],y=t[7],b=i,w=r[0],v=r[1],E=r[2],A=o,x=a,S=l,k=c,_=u,I=d,T=h,C=f,P=p,R=g,D=m,N=y,M=b,B=w,O=v,L=E;for(let e=0;e<s;e+=2)P=P+(M=_k(M^(A=A+_|0),16))|0,A=A+(_=_k(_^P,12))|0,P=P+(M=_k(M^A,8))|0,_=_k(_^P,7),R=R+(B=_k(B^(x=x+I|0),16))|0,x=x+(I=_k(I^R,12))|0,R=R+(B=_k(B^x,8))|0,I=_k(I^R,7),D=D+(O=_k(O^(S=S+T|0),16))|0,S=S+(T=_k(T^D,12))|0,D=D+(O=_k(O^S,8))|0,T=_k(T^D,7),N=N+(L=_k(L^(k=k+C|0),16))|0,k=k+(C=_k(C^N,12))|0,N=N+(L=_k(L^k,8))|0,C=_k(C^N,7),D=D+(L=_k(L^(A=A+I|0),16))|0,A=A+(I=_k(I^D,12))|0,D=D+(L=_k(L^A,8))|0,I=_k(I^D,7),N=N+(M=_k(M^(x=x+T|0),16))|0,x=x+(T=_k(T^N,12))|0,N=N+(M=_k(M^x,8))|0,T=_k(T^N,7),P=P+(B=_k(B^(S=S+C|0),16))|0,S=S+(C=_k(C^P,12))|0,P=P+(B=_k(B^S,8))|0,C=_k(C^P,7),R=R+(O=_k(O^(k=k+_|0),16))|0,k=k+(_=_k(_^R,12))|0,R=R+(O=_k(O^k,8))|0,_=_k(_^R,7);let F=0;n[F++]=o+A|0,n[F++]=a+x|0,n[F++]=l+S|0,n[F++]=c+k|0,n[F++]=u+_|0,n[F++]=d+I|0,n[F++]=h+T|0,n[F++]=f+C|0,n[F++]=p+P|0,n[F++]=g+R|0,n[F++]=m+D|0,n[F++]=y+N|0,n[F++]=b+M|0,n[F++]=w+B|0,n[F++]=v+O|0,n[F++]=E+L|0}function _L(e,t,r,n){let i=e[0],s=e[1],o=e[2],a=e[3],l=t[0],c=t[1],u=t[2],d=t[3],h=t[4],f=t[5],p=t[6],g=t[7],m=r[0],y=r[1],b=r[2],w=r[3];for(let e=0;e<20;e+=2)h=h+(m=_k(m^(i=i+l|0),16))|0,i=i+(l=_k(l^h,12))|0,h=h+(m=_k(m^i,8))|0,l=_k(l^h,7),f=f+(y=_k(y^(s=s+c|0),16))|0,s=s+(c=_k(c^f,12))|0,f=f+(y=_k(y^s,8))|0,c=_k(c^f,7),p=p+(b=_k(b^(o=o+u|0),16))|0,o=o+(u=_k(u^p,12))|0,p=p+(b=_k(b^o,8))|0,u=_k(u^p,7),g=g+(w=_k(w^(a=a+d|0),16))|0,a=a+(d=_k(d^g,12))|0,g=g+(w=_k(w^a,8))|0,d=_k(d^g,7),p=p+(w=_k(w^(i=i+c|0),16))|0,i=i+(c=_k(c^p,12))|0,p=p+(w=_k(w^i,8))|0,c=_k(c^p,7),g=g+(m=_k(m^(s=s+u|0),16))|0,s=s+(u=_k(u^g,12))|0,g=g+(m=_k(m^s,8))|0,u=_k(u^g,7),h=h+(y=_k(y^(o=o+d|0),16))|0,o=o+(d=_k(d^h,12))|0,h=h+(y=_k(y^o,8))|0,d=_k(d^h,7),f=f+(b=_k(b^(a=a+l|0),16))|0,a=a+(l=_k(l^f,12))|0,f=f+(b=_k(b^a,8))|0,l=_k(l^f,7);let v=0;n[v++]=i,n[v++]=s,n[v++]=o,n[v++]=a,n[v++]=m,n[v++]=y,n[v++]=b,n[v++]=w}let _F=_D(_O,{counterRight:!1,counterLength:4,allowShortKeys:!1}),_U=_D(_O,{counterRight:!1,counterLength:8,extendNonceFn:_L,allowShortKeys:!1}),_j=new Uint8Array(16),_H=(e,t)=>{e.update(t);let r=t.length%16;r&&e.update(_j.subarray(r))},_$=new Uint8Array(32);function _q(e,t,r,n,i){let s=e(t,r,_$),o=_B.create(s);i&&_H(o,i),_H(o,n);let a=_y(n.length,i?i.length:0,!0);o.update(a);let l=o.digest();return _n(s,a),l}let _z=e=>(t,r,n)=>{let i=16;return{encrypt(s,o){let a=s.length;(o=_g(a+i,o,!1)).set(s);let l=o.subarray(0,-i);e(t,r,l,l,1);let c=_q(e,t,r,l,n);return o.set(c,a),_n(c),o},decrypt(s,o){o=_g(s.length-i,o,!1);let a=s.subarray(0,-i),l=s.subarray(-i),c=_q(e,t,r,a,n);if(!_f(l,c))throw Error("invalid tag");return o.set(s.subarray(0,-i)),e(t,r,o,o,1),_n(c),o}}},_V=_p({blockSize:64,nonceLength:12,tagLength:16},_z(_F));function _G(e,t,r){return dc(e),void 0===r&&(r=new Uint8Array(e.outputLen)),ps(e,dv(r),dv(t))}_z(_U);let _K=Uint8Array.from([0]),_W=Uint8Array.of();function _Q(e,t,r,n=32){dc(e),da(n);let i=e.outputLen;if(n>255*i)throw Error("Length should be <= 255*HashLen");let s=Math.ceil(n/i);void 0===r&&(r=_W);let o=new Uint8Array(s*i),a=ps.create(e,t),l=a._cloneInto(),c=new Uint8Array(a.outputLen);for(let e=0;e<s;e++)_K[0]=e+1,l.update(0===e?_W:c).update(r).update(_K).digestInto(c),o.set(c,i*e),a._cloneInto(l);return a.destroy(),l.destroy(),dh(c,_K),o.slice(0,n)}let _J={hashSHA256:e=>fJ(e.subarray()),getHKDF(e,t){let r=_G(fJ,t,e),n=_Q(fJ,r,void 0,96),i=n.subarray(0,32);return[i,n.subarray(32,64),n.subarray(64,96)]},generateX25519KeyPair(){let e=fS.utils.randomPrivateKey();return{publicKey:fS.getPublicKey(e),privateKey:e}},generateX25519KeyPairFromSeed:e=>({publicKey:fS.getPublicKey(e),privateKey:e}),generateX25519SharedKey:(e,t)=>fS.getSharedSecret(e.subarray(),t.subarray()),chaCha20Poly1305Encrypt:(e,t,r,n)=>_V(n,t,r).encrypt(e.subarray()),chaCha20Poly1305Decrypt:(e,t,r,n,i)=>_V(n,t,r).decrypt(e.subarray(),i)};function _Z(e){return{generateKeypair:e.generateX25519KeyPair,dh:(t,r)=>e.generateX25519SharedKey(t.privateKey,r).subarray(0,32),encrypt:e.chaCha20Poly1305Encrypt,decrypt:e.chaCha20Poly1305Decrypt,hash:e.hashSHA256,hkdf:e.getHKDF}}let _Y=e=>{let t=(0,to.K)(2);return t[0]=e>>8,t[1]=e,t};_Y.bytes=2;let _X=e=>{if(e.length<2)throw RangeError("Could not decode int16BE");if(e instanceof Uint8Array){let t;return 0+(e[0]<<8)+e[1]}return e.getUint16(0)};function _0(e){return{xxHandshakeSuccesses:e.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:e.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:e.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:e.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:e.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function _1(e,t){t.enabled&&k5&&(e?(t(`LOCAL_STATIC_PUBLIC_KEY ${(0,uC.d)(e.publicKey,"hex")}`),t(`LOCAL_STATIC_PRIVATE_KEY ${(0,uC.d)(e.privateKey,"hex")}`)):t("Missing local static keys."))}function _2(e,t){t.enabled&&k5&&(e?(t(`LOCAL_PUBLIC_EPHEMERAL_KEY ${(0,uC.d)(e.publicKey,"hex")}`),t(`LOCAL_PRIVATE_EPHEMERAL_KEY ${(0,uC.d)(e.privateKey,"hex")}`)):t("Missing local ephemeral keys."))}function _3(e,t){t.enabled&&k5&&t(e?`REMOTE_STATIC_PUBLIC_KEY ${(0,uC.d)(e.subarray(),"hex")}`:"Missing remote static public key.")}function _4(e,t){t.enabled&&k5&&t(e?`REMOTE_EPHEMERAL_PUBLIC_KEY ${(0,uC.d)(e.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function _5(e,t,r){r.enabled&&k5&&(r(`CIPHER_STATE_1 ${e.n.getUint64()} ${e.k&&(0,uC.d)(e.k,"hex")}`),r(`CIPHER_STATE_2 ${t.n.getUint64()} ${t.k&&(0,uC.d)(t.k,"hex")}`))}_X.bytes=2;class _6 extends Error{code;constructor(e="Invalid crypto exchange"){super(e),this.code=_6.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"}let _8=0,_7=0xffffffff,_9="Cipherstate has reached maximum n, a new handshake must be performed";class Ie{n;bytes;view;constructor(e=_8){this.n=e,this.bytes=(0,to.c)(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>_7)throw Error(_9)}}let It=(0,to.c)(0);class Ir{k;n;crypto;constructor(e,t,r=0){this.crypto=e,this.k=t,this.n=new Ie(r)}hasKey(){return!!this.k}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();let r=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),r}decryptWithAd(e,t,r){if(!this.hasKey())return t;this.n.assertValue();let n=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,r);return this.n.increment(),n}}class In{cs;ck;h;crypto;constructor(e,t){this.crypto=e;let r=(0,rx.s)(t,"utf-8");this.h=Io(e,r),this.ck=this.h,this.cs=new Ir(e)}mixKey(e){let[t,r]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new Ir(this.crypto,r)}mixHash(e){this.h=this.crypto.hash(new tf(this.h,e))}encryptAndHash(e){let t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){let t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){let[e,t]=this.crypto.hkdf(this.ck,It);return[new Ir(this.crypto,e),new Ir(this.crypto,t)]}}class Ii{ss;s;e;rs;re;initiator;crypto;constructor(e){let{crypto:t,protocolName:r,prologue:n,initiator:i,s,e:o,rs:a,re:l}=e;this.crypto=t,this.ss=new In(t,r),this.ss.mixHash(n),this.initiator=i,this.s=s,this.e=o,this.rs=a,this.re=l}writeE(){if(this.e)throw Error("ephemeral keypair is already set");let e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw Error("ephemeral keypair is not set");if(!this.re)throw Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw Error("ephemeral keypair is not set");if(!this.rs)throw Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw Error("static keypair is not set");if(!this.re)throw Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw Error("static keypair is not set");if(!this.re)throw Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw Error("ephemeral keypair is not set");if(!this.rs)throw Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e,t=0){if(this.re)throw Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e,t=0){if(this.rs)throw Error("remote static public key is already set");let r=32+16*!!this.ss.cs.hasKey();if(e.byteLength<t+r)throw Error("message is not long enough");let n=e.sublist(t,t+r);return this.rs=this.ss.decryptAndHash(n),r}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}}class Is extends Ii{writeMessageA(e){return new tf(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){let t=this.writeE();this.writeEE();let r=this.writeS();return this.writeES(),new tf(t,r,this.ss.encryptAndHash(e))}writeMessageC(e){let t=this.writeS();return this.writeSE(),new tf(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(e){throw new _6(`handshake stage 0 validation fail: ${e.message}`)}}readMessageB(e){try{this.readE(e),this.readEE();let t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(e){throw new _6(`handshake stage 1 validation fail: ${e.message}`)}}readMessageC(e){try{let t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(e){throw new _6(`handshake stage 2 validation fail: ${e.message}`)}}}function Io(e,t){if(!(t.length<=32))return e.hash(t);{let e=(0,to.c)(32);return e.set(t),e}}async function Ia(e,t,r){let n=await e.sign(Ic(t));return eh.encode({identityKey:p5(e.publicKey),identitySig:n,extensions:r})}async function Il(e,t,r){try{let n=eh.decode(e),i=p2(n.identityKey);if(r?.equals(i)===!1)throw Error(`Payload identity key ${i} does not match expected remote identity key ${r}`);if(!t)throw Error("Remote static does not exist");let s=Ic(t);if(!await i.verify(s,n.identitySig))throw Error("Invalid payload signature");return n}catch(e){throw new cg(e.message)}}function Ic(e){let t=(0,rx.s)("noise-libp2p-static-key:");return e instanceof Uint8Array?tl([t,e],t.length+e.length):(e.prepend(t),e)}async function Iu(e,t){let{log:r,connection:n,crypto:i,privateKey:s,prologue:o,s:a,remoteIdentityKey:l,extensions:c}=e,u=await Ia(s,a.publicKey,c),d=new Is({crypto:i,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:o,s:a});_1(d.s,r),r.trace("Stage 0 - Initiator starting to send first message."),await n.write(d.writeMessageA(It),t),r.trace("Stage 0 - Initiator finished sending first message."),_2(d.e,r),r.trace("Stage 1 - Initiator waiting to receive first message from responder...");let h=d.readMessageB(await n.read(t));r.trace("Stage 1 - Initiator received the message."),_4(d.re,r),_3(d.rs,r),r.trace("Initiator going to check remote's signature...");let f=await Il(h,d.rs,l);r.trace("All good with the signature!"),r.trace("Stage 2 - Initiator sending third handshake message."),await n.write(d.writeMessageC(u),t),r.trace("Stage 2 - Initiator sent message with signed payload.");let[p,g]=d.ss.split();return _5(p,g,r),{payload:f,encrypt:e=>p.encryptWithAd(It,e),decrypt:(e,t)=>g.decryptWithAd(It,e,t)}}async function Id(e,t){let{log:r,connection:n,crypto:i,privateKey:s,prologue:o,s:a,remoteIdentityKey:l,extensions:c}=e,u=await Ia(s,a.publicKey,c),d=new Is({crypto:i,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:o,s:a});_1(d.s,r),r.trace("Stage 0 - Responder waiting to receive first message."),d.readMessageA(await n.read(t)),r.trace("Stage 0 - Responder received first message."),_4(d.re,r),r.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(d.writeMessageB(u),t),r.trace("Stage 1 - Responder sent the second handshake message with signed payload."),_2(d.e,r),r.trace("Stage 2 - Responder waiting for third handshake message...");let h=d.readMessageC(await n.read(t));r.trace("Stage 2 - Responder received the message, finished handshake.");let f=await Il(h,d.rs,l),[p,g]=d.ss.split();return _5(p,g,r),{payload:f,encrypt:e=>g.encryptWithAd(It,e),decrypt:(e,t)=>p.decryptWithAd(It,e,t)}}!function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.webtransportCerthashes)for(let r of e.webtransportCerthashes)t.uint32(10),t.bytes(r);if(null!=e.streamMuxers)for(let r of e.streamMuxers)t.uint32(18),t.string(r);!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={webtransportCerthashes:[],streamMuxers:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:if(r.limits?.webtransportCerthashes!=null&&n.webtransportCerthashes.length===r.limits.webtransportCerthashes)throw new rz('Decode error - map field "webtransportCerthashes" had too many elements');n.webtransportCerthashes.push(e.bytes());break;case 2:if(r.limits?.streamMuxers!=null&&n.streamMuxers.length===r.limits.streamMuxers)throw new rz('Decode error - map field "streamMuxers" had too many elements');n.streamMuxers.push(e.string());break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(ed||(ed={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.identityKey&&e.identityKey.byteLength>0&&(t.uint32(10),t.bytes(e.identityKey)),null!=e.identitySig&&e.identitySig.byteLength>0&&(t.uint32(18),t.bytes(e.identitySig)),null!=e.extensions&&(t.uint32(34),ed.codec().encode(e.extensions,t)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={identityKey:(0,to.c)(0),identitySig:(0,to.c)(0)},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.identityKey=e.bytes();break;case 2:n.identitySig=e.bytes();break;case 4:n.extensions=ed.codec().decode(e,e.uint32(),{limits:r.limits?.extensions});break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(eh||(eh={}));let Ih=16;function If(e,t){return async function*(r){for await(let n of r)for(let r=0;r<n.length;r+=k4){let i,s=r+k4;s>n.length&&(s=n.length),i=n instanceof Uint8Array?e.encrypt(n.subarray(r,s)):e.encrypt(n.sublist(r,s)),t?.encryptedPackets.increment(),yield new tf(_Y(i.byteLength),i)}}}function Ip(e,t){return async function*(r){for await(let n of r)for(let r=0;r<n.length;r+=k3){let i=r+k3;if(i>n.length&&(i=n.length),i-Ih<r)throw Error("Invalid chunk");let s=n.sublist(r,i),o=n.subarray(r,i-Ih);try{let r=e.decrypt(s,o);t?.decryptedPackets.increment(),yield r}catch(e){throw t?.decryptErrors.increment(),e}}}}class Ig{protocol="/noise";crypto;prologue;staticKey;extensions;metrics;components;constructor(e,t={}){let{staticNoiseKey:r,extensions:n,crypto:i,prologueBytes:s}=t,{metrics:o}=e;this.components=e;let a=i??_J;this.crypto=_Z(a),this.extensions={webtransportCerthashes:[],...n},this.metrics=o?_0(o):void 0,r?this.staticKey=a.generateX25519KeyPairFromSeed(r):this.staticKey=a.generateX25519KeyPair(),this.prologue=s??(0,to.c)(0)}[Symbol.toStringTag]="@chainsafe/libp2p-noise";[vs]=["@libp2p/connection-encryption","@chainsafe/libp2p-noise"];async secureOutbound(e,t){let r=k0(e,{lengthEncoder:_Y,lengthDecoder:_X,maxDataLength:k3}),n=await this.performHandshakeInitiator(r,this.components.privateKey,t?.remotePeer?.publicKey,t),i=await this.createSecureConnection(r,n);e.source=i.source,e.sink=i.sink;let s=p2(n.payload.identityKey);return{conn:e,remoteExtensions:n.payload.extensions,remotePeer:gp(s),streamMuxer:this.getStreamMuxer(n.payload.extensions?.streamMuxers)}}getStreamMuxer(e){if(null==e)return;let t=this.components.upgrader.getStreamMuxers();if(null!=t)for(let r of e){let e=t.get(r);if(null!=e)return e}if(e.length)throw new cm("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(e,t){let r=k0(e,{lengthEncoder:_Y,lengthDecoder:_X,maxDataLength:k3}),n=await this.performHandshakeResponder(r,this.components.privateKey,t?.remotePeer?.publicKey,t),i=await this.createSecureConnection(r,n);e.source=i.source,e.sink=i.sink;let s=p2(n.payload.identityKey);return{conn:e,remoteExtensions:n.payload.extensions,remotePeer:gp(s),streamMuxer:this.getStreamMuxer(n.payload.extensions?.streamMuxers)}}async performHandshakeInitiator(e,t,r,n){let i;try{i=await Iu({connection:e,privateKey:t,remoteIdentityKey:r,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:[...this.components.upgrader.getStreamMuxers().keys()],webtransportCerthashes:[],...this.extensions}},n),this.metrics?.xxHandshakeSuccesses.increment()}catch(e){throw this.metrics?.xxHandshakeErrors.increment(),e}return i}async performHandshakeResponder(e,t,r,n){let i;try{i=await Id({connection:e,privateKey:t,remoteIdentityKey:r,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:[...this.components.upgrader.getStreamMuxers().keys()],webtransportCerthashes:[],...this.extensions}},n),this.metrics?.xxHandshakeSuccesses.increment()}catch(e){throw this.metrics?.xxHandshakeErrors.increment(),e}return i}async createSecureConnection(e,t){let[r,n]=k2(),i=e.unwrap();return await (0,ac.F)(r,If(t,this.metrics),i,e=>kJ(e,{lengthDecoder:_X}),Ip(t,this.metrics),r),n}}function Im(e={}){return t=>new Ig(t,e)}function Iy(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw Error("argument is not an iterator or iterable")}class Ib extends Error{static name="InvalidFrameError";constructor(e="The frame was invalid"){super(e),this.name="InvalidFrameError"}}class Iw extends Error{static name="UnrequestedPingError";constructor(e="Unrequested ping error"){super(e),this.name="UnrequestedPingError"}}class Iv extends Error{static name="NotMatchingPingError";constructor(e="Unrequested ping error"){super(e),this.name="NotMatchingPingError"}}class IE extends Error{static name="InvalidStateError";constructor(e="Invalid state"){super(e),this.name="InvalidStateError"}}class IA extends Error{static name="StreamAlreadyExistsError";constructor(e="Strean already exists"){super(e),this.name="StreamAlreadyExistsError"}}class Ix extends Error{static name="DecodeInvalidVersionError";constructor(e="Decode invalid version"){super(e),this.name="DecodeInvalidVersionError"}}class IS extends Error{static name="BothClientsError";constructor(e="Both clients"){super(e),this.name="BothClientsError"}}class Ik extends Error{static name="ReceiveWindowExceededError";constructor(e="Receive window exceeded"){super(e),this.name="ReceiveWindowExceededError"}}let I_=new Set([Ib.name,Iw.name,Iv.name,IA.name,Ix.name,IS.name,Ik.name]),II=262144,IT={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:262144,maxStreamWindowSize:0x1000000,maxMessageSize:65536};function IC(e){if(e.keepAliveInterval<=0)throw new cy("keep-alive interval must be positive");if(e.maxInboundStreams<0)throw new cy("max inbound streams must be larger or equal 0");if(e.maxOutboundStreams<0)throw new cy("max outbound streams must be larger or equal 0");if(e.initialStreamWindowSize<II)throw new cy("InitialStreamWindowSize must be larger or equal 256 kB");if(e.maxStreamWindowSize<e.initialStreamWindowSize)throw new cy("MaxStreamWindowSize must be larger than the InitialStreamWindowSize");if(e.maxStreamWindowSize>0x100000000-1)throw new cy("MaxStreamWindowSize must be less than equal MAX_UINT32");if(e.maxMessageSize<1024)throw new cy("MaxMessageSize must be greater than a kilobyte")}!function(e){e[e.Data=0]="Data",e[e.WindowUpdate=1]="WindowUpdate",e[e.Ping=2]="Ping",e[e.GoAway=3]="GoAway"}(ef||(ef={})),function(e){e[e.SYN=1]="SYN",e[e.ACK=2]="ACK",e[e.FIN=4]="FIN",e[e.RST=8]="RST"}(ep||(ep={})),Object.values(ep).filter(e=>"string"!=typeof e);let IP=0;!function(e){e[e.NormalTermination=0]="NormalTermination",e[e.ProtocolError=1]="ProtocolError",e[e.InternalError=2]="InternalError"}(eg||(eg={}));let IR=12,ID=0x1000000;function IN(e){if(e[0]!==IP)throw new Ib("Invalid frame version");return{type:e[1],flag:(e[2]<<8)+e[3],streamID:e[4]*ID+(e[5]<<16)+(e[6]<<8)+e[7],length:e[8]*ID+(e[9]<<16)+(e[10]<<8)+e[11]}}class IM{source;buffer;frameInProgress;constructor(e){this.source=IB(e),this.buffer=new tf,this.frameInProgress=!1}async *emitFrames(){for await(let e of this.source)for(this.buffer.append(e);;){let e=this.readHeader();if(void 0===e)break;let{type:t,length:r}=e;t===ef.Data?(this.frameInProgress=!0,yield{header:e,readData:this.readBytes.bind(this,r)}):yield{header:e}}}readHeader(){if(this.frameInProgress)throw new IE("decoding frame already in progress");if(this.buffer.length<IR)return;let e=IN(this.buffer.subarray(0,IR));return this.buffer.consume(IR),e}async readBytes(e){if(this.buffer.length<e){for await(let t of this.source)if(this.buffer.append(t),this.buffer.length>=e)break}let t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t}}function IB(e){if(void 0!==e[Symbol.iterator]){let t=e[Symbol.iterator]();return t.return=void 0,{[Symbol.iterator]:()=>t}}if(void 0!==e[Symbol.asyncIterator]){let t=e[Symbol.asyncIterator]();return t.return=void 0,{[Symbol.asyncIterator]:()=>t}}throw Error("a source must be either an iterable or an async iterable")}function IO(e){let t=new Uint8Array(IR);return t[1]=e.type,t[2]=e.flag>>>8,t[3]=e.flag,t[4]=e.streamID>>>24,t[5]=e.streamID>>>16,t[6]=e.streamID>>>8,t[7]=e.streamID,t[8]=e.length>>>24,t[9]=e.length>>>16,t[10]=e.length>>>8,t[11]=e.length,t}function IL(e){return null!=e&&"function"==typeof e.then&&"function"==typeof e.catch&&"function"==typeof e.finally}function IF(e,t){let r=Iy(e).return?.();IL(r)&&r.catch(e=>{t.error("could not cause iterator to return",e)})}let IU=5e3;function Ij(e){return null!=e&&"function"==typeof e.then&&"function"==typeof e.catch&&"function"==typeof e.finally}class IH{id;direction;timeline;protocol;metadata;source;status;readStatus;writeStatus;log;sinkController;sinkEnd;closed;endErr;streamSource;onEnd;onCloseRead;onCloseWrite;onReset;onAbort;sendCloseWriteTimeout;sendingData;constructor(e){this.sinkController=new AbortController,this.sinkEnd=(0,ao.A)(),this.closed=(0,ao.A)(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=e.sendCloseWriteTimeout??IU,this.onEnd=e.onEnd,this.onCloseRead=e?.onCloseRead,this.onCloseWrite=e?.onCloseWrite,this.onReset=e?.onReset,this.onAbort=e?.onAbort,this.source=this.streamSource=(0,ad.Ny)({onEnd:e=>{null!=e?this.log.trace("source ended with error",e):this.log.trace("source ended"),this.onSourceEnd(e)}}),this.sink=this.sink.bind(this)}async sink(e){if("ready"!==this.writeStatus)throw new ck(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";let t={signal:this.sinkController.signal};if("outbound"===this.direction){let e=this.sendNewStream(t);Ij(e)&&await e}let r=()=>{IF(e,this.log)};try{for await(let n of(this.sinkController.signal.addEventListener("abort",r),this.log.trace("sink reading from source"),e)){n=n instanceof Uint8Array?new tf(n):n;let e=this.sendData(n,t);Ij(e)&&(this.sendingData=(0,ao.A)(),await e,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",r)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),"writing"===this.writeStatus&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(e){throw this.log.trace("sink ended with error, calling abort with error",e),this.abort(e),e}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){null==this.timeline.closeRead&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",null!=e&&null==this.endErr&&(this.endErr=e),this.onCloseRead?.(),null!=this.timeline.closeWrite?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),"aborted"!==this.status&&"reset"!==this.status&&(this.status="closed"),null!=this.onEnd&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){null==this.timeline.closeWrite&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",null!=e&&null==this.endErr&&(this.endErr=e),this.onCloseWrite?.(),null!=this.timeline.closeRead?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),"aborted"!==this.status&&"reset"!==this.status&&(this.status="closed"),null!=this.onEnd&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(e){"open"===this.status&&(this.log.trace("closing gracefully"),this.status="closing",await (0,cG.W)(Promise.all([this.closeWrite(e),this.closeRead(e),this.closed.promise]),e?.signal),this.status="closed",this.log.trace("closed gracefully"))}async closeRead(e={}){if("closing"===this.readStatus||"closed"===this.readStatus)return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);let t=this.readStatus;this.readStatus="closing","reset"!==this.status&&"aborted"!==this.status&&null==this.timeline.closeRead&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),"ready"===t&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(e={}){"closing"!==this.writeStatus&&"closed"!==this.writeStatus&&(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),"ready"===this.writeStatus&&(this.log.trace("sink was never sunk, sink an empty array"),await (0,cG.W)(this.sink([]),e.signal)),"writing"===this.writeStatus&&(null!=this.sendingData&&await (0,cG.W)(this.sendingData.promise,e.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await (0,cG.W)(this.sinkEnd.promise,e.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){if("closed"===this.status||"aborted"===this.status||"reset"===this.status)return;this.log("abort with error",e),this.log("try to send reset to remote");let t=this.sendReset();Ij(t)&&t.catch(e=>{this.log.error("error sending reset message",e)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),this.onAbort?.(e)}reset(){if("closed"===this.status||"aborted"===this.status||"reset"===this.status)return;let e=new cS("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(e),this.onReset?.()}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){"writing"===this.writeStatus&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){"closing"!==this.readStatus&&"closed"!==this.readStatus&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){if("closing"===this.readStatus||"closed"===this.readStatus)return void this.log("received remote close write but local source is already closed");this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if("closing"===this.writeStatus||"closed"===this.writeStatus)return void this.log("received remote close read but local sink is already closed");this.log.trace("remote close read"),this._closeSink()}destroy(){if("closed"===this.status||"aborted"===this.status||"reset"===this.status)return void this.log("received destroy but we are already closed");this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}!function(e){e[e.Init=0]="Init",e[e.SYNSent=1]="SYNSent",e[e.SYNReceived=2]="SYNReceived",e[e.Established=3]="Established",e[e.Finished=4]="Finished"}(em||(em={}));class I$ extends IH{name;state;config;_id;sendWindowCapacity;sendWindowCapacityUpdate;recvWindow;recvWindowCapacity;epochStart;getRTT;sendFrame;constructor(e){super({...e,onEnd:t=>{this.state=em.Finished,e.onEnd?.(t)}}),this.config=e.config,this._id=parseInt(e.id,10),this.name=e.name,this.state=e.state,this.sendWindowCapacity=II,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=e.getRTT,this.sendFrame=e.sendFrame,this.source=wz(this.source,()=>{this.sendWindowUpdate()})}async sendNewStream(){}async sendData(e,t={}){for(e=e.sublist();0!==e.byteLength;){if(0===this.sendWindowCapacity&&(this.log?.trace("wait for send window capacity, status %s",this.status),await this.waitForSendWindowCapacity(t),"closed"===this.status||"aborted"===this.status||"reset"===this.status))return void this.log?.trace("%s while waiting for send window capacity",this.status);let r=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-IR,e.length),n=this.getSendFlags();this.sendFrame({type:ef.Data,flag:n,streamID:this._id,length:r},e.sublist(0,r)),this.sendWindowCapacity-=r,e.consume(r)}}async sendReset(){this.sendFrame({type:ef.WindowUpdate,flag:ep.RST,streamID:this._id,length:0})}async sendCloseWrite(){let e=this.getSendFlags()|ep.FIN;this.sendFrame({type:ef.WindowUpdate,flag:e,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(e={}){let t,r;if(this.sendWindowCapacity>0)return;let n=()=>{"open"===this.status||"closing"===this.status?r(new cp("Stream aborted")):t()};e.signal?.addEventListener("abort",n);try{await new Promise((e,n)=>{this.sendWindowCapacityUpdate=()=>{e()},r=n,t=e})}finally{e.signal?.removeEventListener("abort",n)}}handleWindowUpdate(e){this.log?.trace("stream received window update id=%s",this._id),this.processFlags(e.flag);let t=this.sendWindowCapacity;this.sendWindowCapacity+=e.length,0===t&&e.length>0&&this.sendWindowCapacityUpdate?.()}async handleData(e,t){if(this.log?.trace("stream received data id=%s",this._id),this.processFlags(e.flag),this.recvWindowCapacity<e.length)throw new Ik("Receive window exceeded");let r=await t();this.recvWindowCapacity-=e.length,this.sourcePush(r)}processFlags(e){(e&ep.ACK)===ep.ACK&&this.state===em.SYNSent&&(this.state=em.Established),(e&ep.FIN)===ep.FIN&&this.remoteCloseWrite(),(e&ep.RST)===ep.RST&&this.reset()}getSendFlags(){switch(this.state){case em.Init:return this.state=em.SYNSent,ep.SYN;case em.SYNReceived:return this.state=em.Established,ep.ACK;default:return 0}}sendWindowUpdate(){let e=this.getSendFlags(),t=Date.now(),r=this.getRTT();if(0===e&&r>-1&&t-this.epochStart<4*r&&(this.recvWindow=Math.min(2*this.recvWindow,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&0===e)return;let n=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=t,this.sendFrame({type:ef.WindowUpdate,flag:e,streamID:this._id,length:n})}}let Iq="/yamux/1.0.0",Iz=500;class IV{protocol=Iq;_components;_init;constructor(e,t={}){this._components=e,this._init=t}[Symbol.toStringTag]="@chainsafe/libp2p-yamux";[vs]=["@libp2p/stream-multiplexing"];createStreamMuxer(e){return new IG(this._components,{...this._init,...e})}}class IG{protocol=Iq;source;sink;config;log;logger;closeController;nextStreamID;_streams;nextPingID;activePing;rtt;client;localGoAway;remoteGoAway;numInboundStreams;numOutboundStreams;onIncomingStream;onStreamEnd;constructor(e,t){this.client="outbound"===t.direction,this.config={...IT,...t},this.logger=e.logger,this.log=this.logger.forComponent("libp2p:yamux"),IC(this.config),this.closeController=new AbortController,this.closeController.signal,this.onIncomingStream=t.onIncomingStream,this.onStreamEnd=t.onStreamEnd,this._streams=new Map,this.source=(0,ad.Ny)({onEnd:()=>{this.log?.trace("muxer source ended"),this._streams.forEach(e=>{e.destroy()})}}),this.sink=async e=>{let t,r,n=()=>{let t=Iy(e);if(null!=t.return){let e=t.return();IK(e)&&e.catch(e=>{this.log?.("could not cause sink source to return",e)})}};try{let r=new IM(e);try{for await(let e of(this.closeController.signal.addEventListener("abort",n),r.emitFrames()))await this.handleFrame(e.header,e.readData)}finally{this.closeController.signal.removeEventListener("abort",n)}t=eg.NormalTermination}catch(e){I_.has(e.name)?(this.log?.error("protocol error in sink",e),t=eg.ProtocolError):(this.log?.error("internal error in sink",e),t=eg.InternalError),r=e}this.log?.trace("muxer sink ended"),null!=r?this.abort(r,t):await this.close({reason:t})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,this.log?.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch(e=>this.log?.error("keepalive error: %s",e)),this.ping().catch(e=>this.log?.error("ping error: %s",e))}get streams(){return Array.from(this._streams.values())}newStream(e){if(void 0!==this.remoteGoAway)throw new cx("Muxer closed remotely");if(void 0!==this.localGoAway)throw new cx("Muxer closed locally");let t=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new cj("max outbound streams exceeded");this.log?.trace("new outgoing stream id=%s",t);let r=this._newStream(t,e,em.Init,"outbound");return this._streams.set(t,r),this.numOutboundStreams++,r.sendWindowUpdate(),r}async ping(){if(void 0!==this.remoteGoAway)throw new cx("Muxer closed remotely");if(void 0!==this.localGoAway)throw new cx("Muxer closed locally");if(void 0===this.activePing){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise((t,r)=>{let n=()=>{r(new cx("Muxer closed locally"))};this.closeController.signal.addEventListener("abort",n,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",n),t()}}),resolve:e};let t=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}let r=Date.now();this.rtt=r-t}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(e={}){if(this.closeController.signal.aborted)return;let t=e?.reason??eg.NormalTermination;if(this.log?.trace("muxer close reason=%s",t),null==e.signal){let t=AbortSignal.timeout(Iz);e={...e,signal:t}}try{await Promise.all([...this._streams.values()].map(async t=>t.close(e))),this.sendGoAway(t),this._closeMuxer()}catch(e){this.abort(e)}}abort(e,t){if(!this.closeController.signal.aborted){for(let r of(t=t??eg.InternalError,this.log?.error("muxer abort reason=%s error=%s",t,e),this._streams.values()))r.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,r,n){if(null!=this._streams.get(e))throw new cy("Stream already exists with that id");let i=new I$({id:e.toString(),name:t,state:r,direction:n,sendFrame:this.sendFrame.bind(this),onEnd:()=>{this.closeStream(e),this.onStreamEnd?.(i)},log:this.logger.forComponent(`libp2p:yamux:${n}:${e}`),config:this.config,getRTT:this.getRTT.bind(this)});return i}closeStream(e){this.client===(e%2==0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}async keepAliveLoop(){let e=new Promise((e,t)=>{this.closeController.signal.addEventListener("abort",t,{once:!0})});for(this.log?.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let t;try{await Promise.race([e,new Promise(e=>{t=setTimeout(e,this.config.keepAliveInterval)})]),this.ping().catch(e=>this.log?.error("ping error: %s",e))}catch(e){clearInterval(t);return}}}async handleFrame(e,t){let{streamID:r,type:n,length:i}=e;if(this.log?.trace("received frame %o",e),0===r)switch(n){case ef.Ping:return void this.handlePing(e);case ef.GoAway:return void this.handleGoAway(i);default:throw new Ib("Invalid frame type")}switch(e.type){case ef.Data:case ef.WindowUpdate:return void await this.handleStreamMessage(e,t);default:throw new Ib("Invalid frame type")}}handlePing(e){if(e.flag===ep.SYN)this.log?.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,ep.ACK);else if(e.flag===ep.ACK)this.log?.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length);else throw new Ib("Invalid frame flag")}handlePingResponse(e){if(void 0===this.activePing)throw new Iw("ping not requested");if(this.activePing.id!==e)throw new Iv("ping doesn't match our id");this.activePing.resolve()}handleGoAway(e){for(let t of(this.log?.trace("received GoAway reason=%s",eg[e]??"unknown"),this.remoteGoAway=e,this._streams.values()))t.reset();this._closeMuxer()}async handleStreamMessage(e,t){let{streamID:r,flag:n,type:i}=e;(n&ep.SYN)===ep.SYN&&this.incomingStream(r);let s=this._streams.get(r);if(void 0===s){if(i===ef.Data){if(this.log?.("discarding data for stream id=%s",r),void 0===t)throw Error("unreachable");await t()}else this.log?.trace("frame for missing stream id=%s",r);return}switch(i){case ef.WindowUpdate:return void s.handleWindowUpdate(e);case ef.Data:if(void 0===t)throw Error("unreachable");await s.handleData(e,t);return;default:throw Error("unreachable")}}incomingStream(e){if(this.client!==(e%2==0))throw new cy("Both endpoints are clients");if(this._streams.has(e))return;if(this.log?.trace("new incoming stream id=%s",e),void 0!==this.localGoAway)return void this.sendFrame({type:ef.WindowUpdate,flag:ep.RST,streamID:e,length:0});if(this.numInboundStreams>=this.config.maxInboundStreams){this.log?.("maxIncomingStreams exceeded, forcing stream reset"),this.sendFrame({type:ef.WindowUpdate,flag:ep.RST,streamID:e,length:0});return}let t=this._newStream(e,void 0,em.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,t),this.onIncomingStream?.(t)}sendFrame(e,t){if(this.log?.trace("sending frame %o",e),e.type===ef.Data){if(void 0===t)throw new Ib("Invalid frame");this.source.push(new tf(IO(e),t))}else this.source.push(IO(e))}sendPing(e,t=ep.SYN){t===ep.SYN?this.log?.trace("sending ping request pingId=%s",e):this.log?.trace("sending ping response pingId=%s",e),this.sendFrame({type:ef.Ping,flag:t,streamID:0,length:e})}sendGoAway(e=eg.NormalTermination){this.log?.("sending GoAway reason=%s",eg[e]),this.localGoAway=e,this.sendFrame({type:ef.GoAway,flag:0,streamID:0,length:e})}}function IK(e){return null!=e&&"function"==typeof e.then}function IW(e={}){return t=>new IV(t,e)}async function*IQ(e,t={}){let r=e.getReader();try{for(;;){let e=await r.read();if(e.done)return;yield e.value}}finally{!0!==t.preventCancel&&await r.cancel(),r.releaseLock()}}class IJ extends Error{static name="SignatureVerificationError";constructor(e="Record signature verification failed"){super(e),this.name="SignatureVerificationError"}}class IZ extends Error{static name="RecordExpiredError";constructor(e="Record has expired"){super(e),this.name="RecordExpiredError"}}class IY extends Error{static name="UnsupportedValidityError";constructor(e="The validity type is unsupported"){super(e),this.name="UnsupportedValidityError"}}class IX extends Error{static name="RecordTooLargeError";constructor(e="The record is too large"){super(e),this.name="RecordTooLargeError"}}class I0 extends Error{static name="InvalidValueError";constructor(e="Value must be a valid content path starting with /"){super(e),this.name="InvalidValueError"}}class I1 extends Error{static name="InvalidRecordDataError";constructor(e="Invalid record data"){super(e),this.name="InvalidRecordDataError"}}class I2 extends Error{static name="InvalidEmbeddedPublicKeyError";constructor(e="Invalid embedded public key"){super(e),this.name="InvalidEmbeddedPublicKeyError"}}!function(e){let t,r,n;!function(e){e.EOL="EOL"}(t=e.ValidityType||(e.ValidityType={})),function(e){e[e.EOL=0]="EOL"}(r||(r={})),function(e){e.codec=()=>r$(r)}(t=e.ValidityType||(e.ValidityType={})),e.codec=()=>(null==n&&(n=rq((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.value&&(r.uint32(10),r.bytes(t.value)),null!=t.signatureV1&&(r.uint32(18),r.bytes(t.signatureV1)),null!=t.validityType&&(r.uint32(24),e.ValidityType.codec().encode(t.validityType,r)),null!=t.validity&&(r.uint32(34),r.bytes(t.validity)),null!=t.sequence&&(r.uint32(40),r.uint64(t.sequence)),null!=t.ttl&&(r.uint32(48),r.uint64(t.ttl)),null!=t.pubKey&&(r.uint32(58),r.bytes(t.pubKey)),null!=t.signatureV2&&(r.uint32(66),r.bytes(t.signatureV2)),null!=t.data&&(r.uint32(74),r.bytes(t.data)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.value=t.bytes();break;case 2:i.signatureV1=t.bytes();break;case 3:i.validityType=e.ValidityType.codec().decode(t);break;case 4:i.validity=t.bytes();break;case 5:i.sequence=t.uint64();break;case 6:i.ttl=t.uint64();break;case 7:i.pubKey=t.bytes();break;case 8:i.signatureV2=t.bytes();break;case 9:i.data=t.bytes();break;default:t.skipType(7&r)}}return i})),n),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(ey||(ey={}));let I3=(0,aB.vF)("ipns:utils"),I4=(0,rx.s)("/ipns/"),I5=0,I6=18;function I8(e){let t;if(null!=e.pubKey)try{t=p2(e.pubKey)}catch(e){throw I3.error(e),e}if(null!=t)return t}function I7(e){return tl([(0,rx.s)("ipns-signature:"),e])}function I9(e){return"signatureV1"in e?ey.encode({value:(0,rx.s)(e.value),signatureV1:e.signatureV1,validityType:e.validityType,validity:(0,rx.s)(e.validity),sequence:e.sequence,ttl:e.ttl,pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data}):ey.encode({pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data})}function Te(e){let t=ey.decode(e);if(null!=t.sequence&&(t.sequence=BigInt(t.sequence)),null!=t.ttl&&(t.ttl=BigInt(t.ttl)),null==t.signatureV2||null==t.data)throw new IJ("Missing data or signatureV2");let r=Tn(t.data),n=Ti(r.Value),i=(0,uC.d)(r.Validity);if(null!=t.value&&null!=t.signatureV1)return Ts(t),{value:n,validityType:ey.ValidityType.EOL,validity:i,sequence:r.Sequence,ttl:r.TTL,pubKey:t.pubKey,signatureV1:t.signatureV1,signatureV2:t.signatureV2,data:t.data};if(null!=t.signatureV2)return{value:n,validityType:ey.ValidityType.EOL,validity:i,sequence:r.Sequence,ttl:r.TTL,pubKey:t.pubKey,signatureV2:t.signatureV2,data:t.data};throw Error("invalid record: does not include signatureV1 or signatureV2")}function Tt(e){return tl([I4,e.bytes])}function Tr(e){let t=o0.decode(e.slice(I4.length));if(!Ta(t,I5)&&!Ta(t,I6))throw new cP("Multihash in IPNS key was not identity or sha2-256");return t}function Tn(e){let t=om(e);if(0===t.ValidityType)t.ValidityType=ey.ValidityType.EOL;else throw new IY("The validity type is unsupported");return Number.isInteger(t.Sequence)&&(t.Sequence=BigInt(t.Sequence)),Number.isInteger(t.TTL)&&(t.TTL=BigInt(t.TTL)),t}function Ti(e){let t=(0,uC.d)(e).trim();if(t.startsWith("/"))return t;try{return`/ipfs/${tm.TO.decode(e).toV1().toString()}`}catch{}try{return`/ipfs/${tm.TO.parse(t).toV1().toString()}`}catch{}throw new I0("Value must be a valid content path starting with /")}function Ts(e){if(null==e.data)throw new I1("Record data is missing");let t=Tn(e.data);if(!tc(t.Value,e.value??new Uint8Array(0)))throw new IJ('Field "value" did not match between protobuf and CBOR');if(!tc(t.Validity,e.validity??new Uint8Array(0)))throw new IJ('Field "validity" did not match between protobuf and CBOR');if(t.ValidityType!==e.validityType)throw new IJ('Field "validityType" did not match between protobuf and CBOR');if(t.Sequence!==e.sequence)throw new IJ('Field "sequence" did not match between protobuf and CBOR');if(t.TTL!==e.ttl)throw new IJ('Field "ttl" did not match between protobuf and CBOR')}function To(e){return"function"==typeof e?.toCID}function Ta(e,t){return e.code===t}var Tl=r(77338);let Tc=(0,aB.vF)("ipns:validator"),Tu=10240,Td=async(e,t)=>{let r,n=Te(t);try{let t=I7(n.data);r=await e.verify(t,n.signatureV2)}catch(e){r=!1}if(!r)throw Tc.error("record signature verification failed"),new IJ("Record signature verification failed");if(n.validityType===ey.ValidityType.EOL){if(Tl.fromString(n.validity).toDate().getTime()<Date.now())throw Tc.error("record has expired"),new IZ("record has expired")}else if(null!=n.validityType)throw Tc.error("the validity type is unsupported"),new IY("The validity type is unsupported");Tc("ipns record for %s is valid",n.value)};async function Th(e,t){let r;if(t.byteLength>Tu)throw new IX("The record is too large");let n=Tr(e);Ta(n,0)&&(r=p4(n));let i=I8(Te(t))??r;if(null==i)throw new I2("Could not extract public key from IPNS record or routing key");if(!tc(Tt(i.toMultihash()),e))throw new I2("Embedded public key did not match routing key");await Td(i,t)}class Tf extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MESSAGE_LENGTH"}async function*Tp(e,t={}){let r=/\r?\n/,n=new TextDecoder("utf8"),i="";for await(let s of e){if("string"==typeof s&&(s=new TextEncoder().encode(s)),th(s)&&(s=s.subarray()),(i+=n.decode(s,{stream:!0})).length>(t?.maxMessageLength??i.length))throw new Tf("Incoming message too long");let e=i.split(r);i=e.pop()??"";for(let t=0;t<e.length;t++)yield JSON.parse(e[t])}""!==(i+=n.decode())&&(yield JSON.parse(i))}class Tg extends Error{static name="InvalidRequestError";constructor(e="Invalid request"){super(e),this.name="InvalidRequestError"}}class Tm extends Error{static name="BadResponseError";constructor(e="Bad response"){super(e),this.name="BadResponseError"}}let Ty=(0,rx.s)("/ipns/");function Tb(e){return tc(e.subarray(0,Ty.byteLength),Ty)}class Tw{client;constructor(e){this.client=e}async *findProviders(e,t={}){yield*(0,as.A)(this.client.getProviders(e,t),e=>({id:e.ID,multiaddrs:e.Addrs??[]}))}async provide(){}async cancelReprovide(){}async put(e,t,r){if(!Tb(e))return;let n=Tr(e),i=tm.TO.createV1(114,n),s=Te(t);await this.client.putIPNS(i,s,r)}async get(e,t){if(!Tb(e))throw new c_("Not found");let r=Tr(e),n=tm.TO.createV1(114,r);try{let e=await this.client.getIPNS(n,t);return I9(e)}catch(e){if("BadResponseError"===e.name)throw new c_("Not found");throw e}}}class Tv{client;constructor(e){this.client=e}async findPeer(e,t={}){let r=await tr(this.client.getPeers(e,t));if(null!=r)return{id:r.ID,multiaddrs:r.Addrs??[]};throw new c_("Not found")}async *getClosestPeers(e,t={}){}}let TE=(0,aB.vF)("delegated-routing-v1-http-api-client"),TA={concurrentRequests:4,timeout:3e4,cacheTTL:3e5,cacheName:"delegated-routing-v1-cache"};class Tx{started;httpQueue;shutDownController;clientUrl;timeout;contentRouting;peerRouting;filterAddrs;filterProtocols;inFlightRequests;cacheName;cache;cacheTTL;constructor(e,t={}){this.started=!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.httpQueue=new av({concurrency:t.concurrentRequests??TA.concurrentRequests}),this.inFlightRequests=new Map,this.clientUrl=e instanceof URL?e:new URL(e),this.timeout=t.timeout??TA.timeout,this.filterAddrs=t.filterAddrs,this.filterProtocols=t.filterProtocols,this.contentRouting=new Tw(this),this.peerRouting=new Tv(this),this.cacheName=t.cacheName??TA.cacheName,this.cacheTTL=t.cacheTTL??TA.cacheTTL}get[bF](){return this.contentRouting}get[bU](){return this.peerRouting}isStarted(){return this.started}async start(){!this.started&&(this.started=!0,this.cacheTTL>0&&(this.cache=await globalThis.caches?.open(this.cacheName),null!=this.cache&&TE("cache enabled with ttl %d",this.cacheTTL)))}async stop(){this.httpQueue.clear(),this.shutDownController.abort(),await globalThis.caches?.delete(this.cacheName),this.started=!1}async *getProviders(e,t={}){TE("getProviders starts: %c",e);let r=AbortSignal.timeout(this.timeout),n=ch([this.shutDownController.signal,r,t.signal]),i=(0,ao.A)(),s=(0,ao.A)();this.httpQueue.add(async()=>(i.resolve(),s.promise));try{await i.promise;let r=new URL(`${this.clientUrl}routing/v1/providers/${e.toString()}`);this.#K(r,t.filterAddrs,t.filterProtocols);let s={headers:{Accept:"application/x-ndjson"},signal:n},o=await this.#W(r.toString(),s);if(null==o)throw new Tm("No response received");if(!o.ok){if(404===o.status)throw new c_("No matching records found");if(422===o.status)throw new Tg("Request does not conform to schema or semantic constraints");throw new Tm(`Unexpected status code: ${o.status}`)}if(null==o.body)throw new Tm("Routing response had no body");let a=o.headers.get("Content-Type");if(null==a)throw new Tm("No Content-Type header received");if(a?.startsWith("application/json"))for(let e of(await o.json()).Providers){let t=this.#Q(e);null!=t&&(yield t)}else if(a.includes("application/x-ndjson"))for await(let e of Tp(IQ(o.body))){let t=this.#Q(e);null!=t&&(yield t)}else throw new Tm(`Unsupported Content-Type: ${a}`)}catch(e){TE.error("getProviders errored:",e)}finally{n.clear(),s.resolve(),TE("getProviders finished: %c",e)}}async *getPeers(e,t={}){TE("getPeers starts: %c",e);let r=AbortSignal.timeout(this.timeout),n=ch([this.shutDownController.signal,r,t.signal]),i=(0,ao.A)(),s=(0,ao.A)();this.httpQueue.add(async()=>(i.resolve(),s.promise));try{await i.promise;let r=new URL(`${this.clientUrl}routing/v1/peers/${e.toCID().toString()}`);this.#K(r,t.filterAddrs,t.filterProtocols);let s={headers:{Accept:"application/x-ndjson"},signal:n},o=await this.#W(r.toString(),s);if(404===o.status)throw new c_("No matching records found");if(422===o.status)throw new Tg("Request does not conform to schema or semantic constraints");if(null==o.body)throw new Tm("Routing response had no body");let a=o.headers.get("Content-Type");if("application/json"===a)for(let e of(await o.json()).Peers){let t=this.#Q(e);null!=t&&(yield t)}else for await(let e of Tp(IQ(o.body))){let t=this.#Q(e);null!=t&&(yield t)}}catch(e){TE.error("getPeers errored:",e)}finally{n.clear(),s.resolve(),TE("getPeers finished: %c",e)}}async getIPNS(e,t={}){TE("getIPNS starts: %s",e);let r=AbortSignal.timeout(this.timeout),n=ch([this.shutDownController.signal,r,t.signal]),i=(0,ao.A)(),s=(0,ao.A)();this.httpQueue.add(async()=>(i.resolve(),s.promise));let o=`${this.clientUrl}routing/v1/ipns/${e}`;try{await i.promise;let r={headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:n},s=await this.#W(o,r);if(TE("getIPNS GET %s %d",o,s.status),404===s.status)throw new c_("No matching records found");if(422===s.status)throw new Tg("Request does not conform to schema or semantic constraints");if(null==s.body)throw new Tm("GET ipns response had no body");let a=await s.arrayBuffer(),l=new Uint8Array(a,0,a.byteLength);return!1!==t.validate&&await Th(Tt(e.multihash),l),Te(l)}catch(e){throw TE.error("getIPNS GET %s error:",o,e),e}finally{n.clear(),s.resolve(),TE("getIPNS finished: %s",e)}}async putIPNS(e,t,r={}){TE("putIPNS starts: %c",e);let n=AbortSignal.timeout(this.timeout),i=ch([this.shutDownController.signal,n,r.signal]),s=(0,ao.A)(),o=(0,ao.A)();this.httpQueue.add(async()=>(s.resolve(),o.promise));let a=`${this.clientUrl}routing/v1/ipns/${e}`;try{await s.promise;let e=I9(t),r={method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:e,signal:i},n=await this.#W(a,r);if(TE("putIPNS PUT %s %d",a,n.status),200!==n.status)throw new Tm("PUT ipns response had status other than 200")}catch(e){throw TE.error("putIPNS PUT %s error:",a,e.stack),e}finally{i.clear(),o.resolve(),TE("putIPNS finished: %c",e)}}#Q(e){try{let t=[],r=e.Addrs?.map(yz)??[];return null!=e.Protocols&&t.push(...e.Protocols),null!=e.Protocol&&(t.push(e.Protocol),delete e.Protocol),{...e,Schema:"peer",ID:gf(e.ID),Addrs:r,Protocols:t}}catch(e){TE.error("could not conform record to peer schema",e)}}#K(e,t,r){if(null!=t||null!=this.filterAddrs){let r=t?.join(",")??this.filterAddrs?.join(",")??"";""!==r&&e.searchParams.set("filter-addrs",r)}if(null!=r||null!=this.filterProtocols){let t=r?.join(",")??this.filterProtocols?.join(",")??"";""!==t&&e.searchParams.set("filter-protocols",t)}}async #W(e,t){let r=t.method??"GET",n=`${r}-${e}`;if("GET"===r){let t=await this.cache?.match(e);if(null!=t){if(parseInt(t.headers.get("x-cache-expires")??"0",10)>Date.now())return TE("returning cached response for %s",n),t;await this.cache?.delete(e)}}let i=this.inFlightRequests.get(n);if(null!=i){let e=await i;return TE("deduplicating outgoing request for %s",n),e.clone()}let s=fetch(e,t).then(async t=>{if(null!=this.cache&&t.ok&&"GET"===r){let r=Date.now()+this.cacheTTL,n=new Headers(t.headers);n.set("x-cache-expires",r.toString());let i=new Response(t.clone().body,{status:t.status,statusText:t.statusText,headers:n});await this.cache.put(e,i)}return t}).finally(()=>{this.inFlightRequests.delete(n)});return this.inFlightRequests.set(n,s),await s}}function TS(e,t={}){return new Tx(new URL(e),t)}function Tk(){return{filterProtocols:["unknown","transport-bitswap","transport-ipfs-gateway-http"],filterAddrs:["https","webtransport","webrtc","webrtc-direct","wss","tls"]}}let T_=41;function TI(e){try{let[[t,r]]=e.stringTuples();if(null==r)return!1;if(t===T_)return m7("2000::/3",r)}catch{}return!1}function TT(e,t,r){let n,i;function s(){let o={signal:i.signal};r?.timeout!=null&&(o.signal=ch([i.signal,AbortSignal.timeout(r.timeout)])),Promise.resolve().then(async()=>{await e(o)}).catch(()=>{}).finally(()=>{i.signal.aborted||(n=setTimeout(s,t))})}let o=!1;return{setInterval:e=>{t=e,null!=n&&(clearTimeout(n),n=setTimeout(s,t))},setTimeout:e=>{null==r&&(r={}),r.timeout=e},start:()=>{o||(o=!0,(i=new AbortController).signal,r?.runImmediately===!0?queueMicrotask(()=>{s()}):n=setTimeout(s,t))},stop:()=>{clearTimeout(n),i?.abort(),o=!1}}}function TC(e,t){let r=k0(e,t),n={read:async(e,t)=>{let n=await r.read(t);return e.decode(n)},write:async(e,t,n)=>{await r.write(t.encode(e),n)},writeV:async(e,t,n)=>{await r.writeV(e.map(e=>t.encode(e)),n)},pb:e=>({read:async t=>n.read(e,t),write:async(t,r)=>n.write(t,e,r),writeV:async(t,r)=>n.writeV(t,e,r),unwrap:()=>n}),unwrap:()=>r.unwrap()};return n}let TP="libp2p",TR="autonat",TD="1.0.0",TN=3e4,TM=2,TB=20,TO=80,TL=8192;!function(e){let t,r,n,i,s,o,a,l;!function(e){e.DIAL="DIAL",e.DIAL_RESPONSE="DIAL_RESPONSE"}(t=e.MessageType||(e.MessageType={})),function(e){e[e.DIAL=0]="DIAL",e[e.DIAL_RESPONSE=1]="DIAL_RESPONSE"}(r||(r={})),function(e){e.codec=()=>r$(r)}(t=e.MessageType||(e.MessageType={})),function(e){e.OK="OK",e.E_DIAL_ERROR="E_DIAL_ERROR",e.E_DIAL_REFUSED="E_DIAL_REFUSED",e.E_BAD_REQUEST="E_BAD_REQUEST",e.E_INTERNAL_ERROR="E_INTERNAL_ERROR"}(n=e.ResponseStatus||(e.ResponseStatus={})),function(e){e[e.OK=0]="OK",e[e.E_DIAL_ERROR=100]="E_DIAL_ERROR",e[e.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",e[e.E_BAD_REQUEST=200]="E_BAD_REQUEST",e[e.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"}(i||(i={})),function(e){e.codec=()=>r$(i)}(n=e.ResponseStatus||(e.ResponseStatus={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.id&&(t.uint32(10),t.bytes(e.id)),null!=e.addrs)for(let r of e.addrs)t.uint32(18),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={addrs:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.id=e.bytes();break;case 2:if(r.limits?.addrs!=null&&n.addrs.length===r.limits.addrs)throw new rz('Decode error - map field "addrs" had too many elements');n.addrs.push(e.bytes());break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(s=e.PeerInfo||(e.PeerInfo={})),function(t){let r;t.codec=()=>(null==r&&(r=rq((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.peer&&(r.uint32(10),e.PeerInfo.codec().encode(t.peer,r)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();r>>>3==1?i.peer=e.PeerInfo.codec().decode(t,t.uint32(),{limits:n.limits?.peer}):t.skipType(7&r)}return i})),r),t.encode=e=>rj(e,t.codec()),t.decode=(e,r)=>rA(e,t.codec(),r)}(o=e.Dial||(e.Dial={})),function(t){let r;t.codec=()=>(null==r&&(r=rq((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.status&&(r.uint32(8),e.ResponseStatus.codec().encode(t.status,r)),null!=t.statusText&&(r.uint32(18),r.string(t.statusText)),null!=t.addr&&(r.uint32(26),r.bytes(t.addr)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.status=e.ResponseStatus.codec().decode(t);break;case 2:i.statusText=t.string();break;case 3:i.addr=t.bytes();break;default:t.skipType(7&r)}}return i})),r),t.encode=e=>rj(e,t.codec()),t.decode=(e,r)=>rA(e,t.codec(),r)}(a=e.DialResponse||(e.DialResponse={})),e.codec=()=>(null==l&&(l=rq((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.MessageType.codec().encode(t.type,r)),null!=t.dial&&(r.uint32(18),e.Dial.codec().encode(t.dial,r)),null!=t.dialResponse&&(r.uint32(26),e.DialResponse.codec().encode(t.dialResponse,r)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.type=e.MessageType.codec().decode(t);break;case 2:i.dial=e.Dial.codec().decode(t,t.uint32(),{limits:n.limits?.dial});break;case 3:i.dialResponse=e.DialResponse.codec().decode(t,t.uint32(),{limits:n.limits?.dialResponse});break;default:t.skipType(7&r)}}return i})),l),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(eb||(eb={}));let TF=4,TU=8;class Tj{components;protocol;timeout;maxInboundStreams;maxOutboundStreams;maxMessageSize;started;log;topologyId;dialResults;findPeers;addressFilter;connectionThreshold;constructor(e,t){this.components=e,this.log=e.logger.forComponent("libp2p:auto-nat"),this.started=!1,this.protocol=`/${t.protocolPrefix??TP}/${TR}/${TD}`,this.timeout=t.timeout??TN,this.maxInboundStreams=t.maxInboundStreams??TM,this.maxOutboundStreams=t.maxOutboundStreams??TB,this.connectionThreshold=t.connectionThreshold??TO,this.maxMessageSize=t.maxMessageSize??TL,this.dialResults=new Map,this.findPeers=TT(this.findRandomPeers.bind(this),6e4),this.addressFilter=l2(1024)}[Symbol.toStringTag]="@libp2p/autonat";[vs]=["@libp2p/autonat"];get[vo](){return["@libp2p/identify"]}isStarted(){return this.started}async start(){this.started||(await this.components.registrar.handle(this.protocol,e=>{this.handleIncomingAutonatStream(e).catch(e=>{this.log.error("error handling incoming autonat stream - %e",e)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.topologyId=await this.components.registrar.register(this.protocol,{onConnect:(e,t)=>{this.verifyExternalAddresses(t).catch(e=>{this.log.error("could not verify addresses - %e",e)})}}),this.findPeers.start(),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),null!=this.topologyId&&await this.components.registrar.unhandle(this.topologyId),this.dialResults.clear(),this.findPeers.stop(),this.started=!1}allAddressesAreVerified(){return this.components.addressManager.getAddressesWithMetadata().every(e=>e.expires>Date.now()||e.verified)}async findRandomPeers(e){if(this.allAddressesAreVerified())return;let t=ch([AbortSignal.timeout(1e4),e?.signal]);try{for await(let e of(this.log("starting random walk to find peers to run AutoNAT"),this.components.randomWalk.walk({signal:t}))){if(!await this.components.connectionManager.isDialable(e.multiaddrs)){this.log.trace("random peer %p was not dialable %s",e.id,e.multiaddrs.map(e=>e.toString()).join(", "));continue}try{this.log.trace("dial random peer %p",e.id),await this.components.connectionManager.openConnection(e.multiaddrs,{signal:t})}catch{}if(this.allAddressesAreVerified())return void this.log("stopping random walk, all addresses are verified");if(!this.hasConnectionCapacity())return void this.log("stopping random walk, too close to max connections")}}catch{}}async handleIncomingAutonatStream(e){let t=AbortSignal.timeout(this.timeout),r=TC(e.stream,{maxDataLength:this.maxMessageSize}).pb(eb);try{let n=await r.read({signal:t}),i=await this.handleAutonatMessage(n,e.connection,{signal:t});await r.write(i,{signal:t}),await r.unwrap().unwrap().close({signal:t})}catch(t){this.log.error("error handling incoming autonat stream - %e",t),e.stream.abort(t)}}async handleAutonatMessage(e,t,r){let n,i=this.components.addressManager.getAddresses().map(e=>e.toOptions().host),s=e.dial;if(null==s)return this.log.error("dial was missing from message"),{type:eb.MessageType.DIAL_RESPONSE,dialResponse:{status:eb.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}};let o=s.peer;if(o?.id==null)return this.log.error("PeerId missing from message"),{type:eb.MessageType.DIAL_RESPONSE,dialResponse:{status:eb.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}};try{let e=o0.decode(o.id);n=gm(e)}catch(e){return this.log.error("invalid PeerId - %e",e),{type:eb.MessageType.DIAL_RESPONSE,dialResponse:{status:eb.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}}}if(this.log("incoming request from %p",n),!t.remotePeer.equals(n))return this.log("target peer %p did not equal sending peer %p",n,t.remotePeer),{type:eb.MessageType.DIAL_RESPONSE,dialResponse:{status:eb.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}};let a=o.addrs.map(e=>yz(e)).filter(e=>{let r=e.toOptions();return!xf(e)&&(r.host!==t.remoteAddr.toOptions().host?(this.log.trace("not dialing %a - target host did not match remote host %a",e,t.remoteAddr),!1):!i.includes(r.host)&&(null!=this.components.transportManager.dialTransportForMultiaddr(e)||(this.log.trace("not dialing %a - transport unsupported",e),!1)))}).map(e=>(null==e.getPeerId()&&(e=e.encapsulate(`/p2p/${n.toString()}`)),e));if(0===a.length)return this.log("refused to dial all multiaddrs for %p from message",n),{type:eb.MessageType.DIAL_RESPONSE,dialResponse:{status:eb.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}};this.log("dial multiaddrs %s for peer %p",a.map(e=>e.toString()).join(", "),n);let l="",c=a[0];for await(let e of a){let t;c=e;try{if(!(t=await this.components.connectionManager.openConnection(e,r)).remoteAddr.equals(e))throw this.log.error("tried to dial %a but dialed %a",e,t.remoteAddr),Error("Unexpected remote address");return this.log("successfully dialed %p via %a",n,e),{type:eb.MessageType.DIAL_RESPONSE,dialResponse:{status:eb.ResponseStatus.OK,addr:t.remoteAddr.decapsulateCode(yl("p2p").code).bytes}}}catch(e){this.log.error("could not dial %p - %e",n,e),l=e.message}finally{null!=t&&await t.close()}}return{type:eb.MessageType.DIAL_RESPONSE,dialResponse:{status:eb.ResponseStatus.E_DIAL_ERROR,statusText:l,addr:c.bytes}}}getFirstUnverifiedMultiaddr(e,t){for(let r of this.components.addressManager.getAddressesWithMetadata().sort((e,t)=>"observed"===e.type&&"observed"!==t.type?1:"observed"===t.type&&"observed"!==e.type?-1:0).filter(e=>!!(e.expires<Date.now())&&(6!==e.multiaddr.toOptions().family||!!t&&!!TI(e.multiaddr))&&!xf(e.multiaddr))){let t=r.multiaddr.toString(),n=this.dialResults.get(t);if(null!=n){if(n.networkSegments.includes(e)){this.log.trace("%a already has a network segment result from %s",n.multiaddr,e);continue}if(n.queue.size>10){this.log.trace("%a already has enough peers queued",n.multiaddr);continue}}if(null==n){let e=r.expires<Date.now();if(e&&this.addressFilter.remove?.(t),this.addressFilter.has(t))continue;this.addressFilter.add(t),this.log.trace("creating dial result %s %s",e?"to revalidate":"for",t),n={multiaddr:r.multiaddr,success:0,failure:0,networkSegments:[],verifyingPeers:Aw(),queue:new cZ({concurrency:3,maxSize:50}),type:r.type,lastVerified:r.lastVerified},this.dialResults.set(t,n)}return n}}removeOutdatedMultiaddrResults(){let e=new Set(this.components.addressManager.getAddressesWithMetadata().filter(({expires:e})=>e<Date.now()).map(({multiaddr:e})=>e.toString()));for(let t of this.dialResults.keys())e.has(t)||(this.log.trace("remove results for %a",t),this.dialResults.delete(t))}async verifyExternalAddresses(e){if(!this.isStarted())return;this.removeOutdatedMultiaddrResults();let t=(await this.components.peerStore.get(e.remotePeer)).addresses.some(({multiaddr:e})=>6===e.toOptions().family),r=this.getNetworkSegment(e.remoteAddr),n=this.getFirstUnverifiedMultiaddr(r,t);return null==n?void this.log.trace("no unverified public addresses found for peer %p to verify, not requesting verification",e.remotePeer):this.hasConnectionCapacity()?void n.queue.add(async t=>{await this.askPeerToVerify(e,r,t)},{peerId:e.remotePeer,multiaddr:n.multiaddr}).catch(t=>{n?.result==null&&this.log.error("error from %p verifying address %a - %e",e.remotePeer,n?.multiaddr,t)}):void(null!=n.lastVerified?(this.log("automatically re-verifying %a because we are too close to the connection limit",n.multiaddr),this.confirmAddress(n)):this.log("skipping verifying %a because we are too close to the connection limit",n.multiaddr))}async askPeerToVerify(e,t,r){let n=this.dialResults.get(r.multiaddr.toString());if(null==n)return void this.log("%a was verified while %p was queued",r.multiaddr,e.remotePeer);let i=AbortSignal.timeout(this.timeout);this.log.trace("asking %p to verify multiaddr %s",e.remotePeer,r.multiaddr);let s=await e.newStream(this.protocol,{signal:i});try{let o=TC(s).pb(eb),[,a]=await Promise.all([o.write({type:eb.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toMultihash().bytes,addrs:[r.multiaddr.bytes]}}},{signal:i}),o.read({signal:i})]);if(a.type!==eb.MessageType.DIAL_RESPONSE||null==a.dialResponse)return void this.log("invalid autonat response from %p - %j",e.remotePeer,a);let l=a.dialResponse.status;if(this.log.trace("autonat response from %p for %a is %s",e.remotePeer,r.multiaddr,l),l!==eb.ResponseStatus.OK&&l!==eb.ResponseStatus.E_DIAL_ERROR)return;if(n=this.dialResults.get(r.multiaddr.toString()),null==n)return void this.log.trace("peer reported %a as %s but there is no result object",r.multiaddr,a.dialResponse.status);if(n.networkSegments.includes(t))return void this.log.trace("%a results included network segment %s",r.multiaddr,t);if(null!=n.result)return void this.log.trace("already resolved result for %a, ignoring response from",r.multiaddr,e.remotePeer);if(n.verifyingPeers.has(e.remotePeer))return void this.log.trace("peer %p has already verified %a, ignoring response",e.remotePeer,r.multiaddr);if(n.verifyingPeers.add(e.remotePeer),n.networkSegments.push(t),l===eb.ResponseStatus.OK){if(n.success++,"observed"!==n.type)return void this.confirmAddress(n)}else l===eb.ResponseStatus.E_DIAL_ERROR&&n.failure++;this.log("%a success %d failure %d",n.multiaddr,n.success,n.failure),n.success===TF&&this.confirmAddress(n),n.failure===TU&&this.unconfirmAddress(n)}finally{try{await s.close({signal:i})}catch(e){s.abort(e)}}}hasConnectionCapacity(){return this.components.connectionManager.getConnections().length/this.components.connectionManager.getMaxConnections()*100<this.connectionThreshold}confirmAddress(e){this.log("%s address %a is externally dialable",e.type,e.multiaddr),this.components.addressManager.confirmObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!0,e.queue.abort()}unconfirmAddress(e){this.log("%s address %a is not externally dialable",e.type,e.multiaddr),this.components.addressManager.removeObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!1,e.queue.abort()}getNetworkSegment(e){let t=e.toOptions();return 4===t.family?t.host.split(".")[0].padStart(3,"0"):t.host.split(":")[0].padStart(4,"0")}}function TH(e={}){return t=>new Tj(t,e)}let T$=Cc("dns4"),Tq=Cc("dns6"),Tz=Cc("dnsaddr"),TV=Cl(Cc("dns"),Tz,T$,Tq),TG=Cl(Cc("ip4"),Cc("ip6")),TK=Cl(Ca(TG,Cc("tcp")),Ca(TV,Cc("tcp"))),TW=Ca(TG,Cc("udp")),TQ=Ca(TW,Cc("utp")),TJ=Ca(TW,Cc("quic")),TZ=Ca(TW,Cc("quic-v1")),TY=Cl(Ca(TK,Cc("ws")),Ca(TV,Cc("ws"))),TX=Cl(Ca(TY,Cc("p2p")),TY),T0=Cl(Ca(TK,Cc("wss")),Ca(TV,Cc("wss")),Ca(TK,Cc("tls"),Cc("ws")),Ca(TV,Cc("tls"),Cc("ws"))),T1=Cl(Ca(T0,Cc("p2p")),T0),T2=Cl(Ca(TK,Cc("http")),Ca(TG,Cc("http")),Ca(TV,Cc("http"))),T3=Cl(Ca(TK,Cc("https")),Ca(TG,Cc("https")),Ca(TV,Cc("https"))),T4=Ca(TW,Cc("webrtc-direct"),Cc("certhash")),T5=Cl(Ca(T4,Cc("p2p")),T4),T6=Ca(TZ,Cc("webtransport"),Cc("certhash"),Cc("certhash")),T8=Cl(Ca(T6,Cc("p2p")),T6),T7=Cl(Ca(TX,Cc("p2p-webrtc-star"),Cc("p2p")),Ca(T1,Cc("p2p-webrtc-star"),Cc("p2p")),Ca(TX,Cc("p2p-webrtc-star")),Ca(T1,Cc("p2p-webrtc-star")));Cl(Ca(TX,Cc("p2p-websocket-star"),Cc("p2p")),Ca(T1,Cc("p2p-websocket-star"),Cc("p2p")),Ca(TX,Cc("p2p-websocket-star")),Ca(T1,Cc("p2p-websocket-star")));let T9=Cl(Ca(T2,Cc("p2p-webrtc-direct"),Cc("p2p")),Ca(T3,Cc("p2p-webrtc-direct"),Cc("p2p")),Ca(T2,Cc("p2p-webrtc-direct")),Ca(T3,Cc("p2p-webrtc-direct"))),Ce=Cl(TY,T0,T2,T3,T7,T9,TK,TQ,TJ,TV,T5,T8);Cl(Ca(Ce,Cc("p2p-stardust"),Cc("p2p")),Ca(Ce,Cc("p2p-stardust")));let Ct=Cl(Ca(Ce,Cc("p2p")),T7,T9,T5,T8,Cc("p2p")),Cr=Cl(Ca(Ct,Cc("p2p-circuit"),Ct),Ca(Ct,Cc("p2p-circuit")),Ca(Cc("p2p-circuit"),Ct),Ca(Ce,Cc("p2p-circuit")),Ca(Cc("p2p-circuit"),Ce),Cc("p2p-circuit")),Cn=()=>Cl(Ca(Cr,Cn),Cr),Ci=Cn(),Cs=Cl(Ca(Ci,Ct,Ci),Ca(Ct,Ci),Ca(Ci,Ct),Ci,Ct);function Co(e){return function(t){let r;try{r=yz(t)}catch(e){return!1}let n=e(r.protoNames());return null!==n&&(!0===n||!1===n?n:0===n.length)}}function Ca(...e){function t(t){if(t.length<e.length)return null;let r=t;return e.some(e=>(Array.isArray(r="function"==typeof e?e().partialMatch(t):e.partialMatch(t))&&(t=r),null===r)),r}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:Co(t),partialMatch:t}}function Cl(...e){function t(t){let r=null;return e.some(e=>{let n="function"==typeof e?e().partialMatch(t):e.partialMatch(t);return null!=n&&(r=n,!0)}),r}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:Co(t),partialMatch:t}}function Cc(e){let t=e;return{toString:function(){return t},matches:function(e){let r;try{r=yz(e)}catch(e){return!1}let n=r.protoNames();return 1===n.length&&n[0]===t},partialMatch:function(e){return 0===e.length?null:e[0]===t?e.slice(1):null}}}Cl(Ca(Ci,Cc("webrtc"),Cc("p2p")),Ca(Ci,Cc("webrtc")),Ca(Ce,Cc("webrtc"),Cc("p2p")),Ca(Ce,Cc("webrtc")),Cc("webrtc"));let Cu="bootstrap",Cd=50,Ch=1e3;class Cf extends cf{static tag="bootstrap";log;timer;list;timeout;components;_init;constructor(e,t={list:[]}){if(null==t.list||0===t.list.length)throw Error("Bootstrap requires a list of peer addresses");for(let r of(super(),this.components=e,this.log=e.logger.forComponent("libp2p:bootstrap"),this.timeout=t.timeout??Ch,this.list=[],t.list)){if(!Cs.matches(r)){this.log.error("Invalid multiaddr");continue}let e=yz(r),t=e.getPeerId();if(null==t){this.log.error("Invalid bootstrap multiaddr without peer id");continue}let n={id:gf(t),multiaddrs:[e]};this.list.push(n)}this._init=t}[Ay]=this;[Symbol.toStringTag]="@libp2p/bootstrap";[vs]=["@libp2p/peer-discovery"];isStarted(){return!!this.timer}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(e=>{this.log.error(e)})},this.timeout))}async _discoverBootstrapPeers(){if(null!=this.timer)for(let e of this.list){if(await this.components.peerStore.merge(e.id,{tags:{[this._init.tagName??Cu]:{value:this._init.tagValue??Cd,ttl:this._init.tagTTL}},multiaddrs:e.multiaddrs}),null==this.timer)return;this.safeDispatchEvent("peer",{detail:e}),this.components.connectionManager.openConnection(e.id).catch(t=>{this.log.error("could not dial bootstrap peer %p",e.id,t)})}}stop(){null!=this.timer&&clearTimeout(this.timer),this.timer=void 0}}function Cp(e){return t=>new Cf(t,e)}class Cg{filter;constructor(e,t){this.filter=l2(e,t)}has(e){return this.filter.has(e.toMultihash().bytes)}add(e){this.filter.add(e.toMultihash().bytes)}remove(e){this.filter.remove?.(e.toMultihash().bytes)}}function Cm(e,t=.001){return new Cg(e,t)}function Cy(e){let{stream:t,remoteAddr:r,logger:n,onDataRead:i,onDataWrite:s}=e,o=n.forComponent("libp2p:stream:converter"),a=!1,l=!1,c=t.close.bind(t);t.close=async e=>{await c(e),f(!0)};let u=t.abort.bind(t);t.abort=e=>{u(e),f(!0)};let d=t.sink.bind(t);t.sink=async e=>{try{await d((0,ac.F)(e,e=>wz(e,e=>s?.(e))))}catch(e){"aborted"!==e.type&&o.error("%s error in sink",r,e)}finally{l=!0,f()}};let h={log:o,sink:t.sink,source:async function*(){try{for await(let e of t.source)i?.(e),yield e}finally{a=!0,f()}}(),remoteAddr:r,timeline:{open:Date.now(),close:void 0},close:t.close,abort:t.abort};function f(e){!0===e&&(a=!0,l=!0),a&&l&&null==h.timeline.close&&(h.timeline.close=Date.now())}return h}let Cb=290,Cw=1,Cv=2e3,CE=100,CA=`${SA}-circuit-relay`;BigInt(131072);let Cx="/libp2p/circuit/relay/0.2.0/hop",CS="/libp2p/circuit/relay/0.2.0/stop",Ck=300,C_=4096,CI=.001;function CT(e){return Number(e*BigInt(1e3)-BigInt(new Date().getTime()))}!function(e){let t,r,n;!function(e){e.RESERVE="RESERVE",e.CONNECT="CONNECT",e.STATUS="STATUS"}(t=e.Type||(e.Type={})),function(e){e[e.RESERVE=0]="RESERVE",e[e.CONNECT=1]="CONNECT",e[e.STATUS=2]="STATUS"}(r||(r={})),function(e){e.codec=()=>r$(r)}(t=e.Type||(e.Type={})),e.codec=()=>(null==n&&(n=rq((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.Type.codec().encode(t.type,r)),null!=t.peer&&(r.uint32(18),eE.codec().encode(t.peer,r)),null!=t.reservation&&(r.uint32(26),eA.codec().encode(t.reservation,r)),null!=t.limit&&(r.uint32(34),ex.codec().encode(t.limit,r)),null!=t.status&&(r.uint32(40),eS.codec().encode(t.status,r)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.type=e.Type.codec().decode(t);break;case 2:i.peer=eE.codec().decode(t,t.uint32(),{limits:n.limits?.peer});break;case 3:i.reservation=eA.codec().decode(t,t.uint32(),{limits:n.limits?.reservation});break;case 4:i.limit=ex.codec().decode(t,t.uint32(),{limits:n.limits?.limit});break;case 5:i.status=eS.codec().decode(t);break;default:t.skipType(7&r)}}return i})),n),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(ew||(ew={})),function(e){let t,r,n;!function(e){e.CONNECT="CONNECT",e.STATUS="STATUS"}(t=e.Type||(e.Type={})),function(e){e[e.CONNECT=0]="CONNECT",e[e.STATUS=1]="STATUS"}(r||(r={})),function(e){e.codec=()=>r$(r)}(t=e.Type||(e.Type={})),e.codec=()=>(null==n&&(n=rq((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.Type.codec().encode(t.type,r)),null!=t.peer&&(r.uint32(18),eE.codec().encode(t.peer,r)),null!=t.limit&&(r.uint32(26),ex.codec().encode(t.limit,r)),null!=t.status&&(r.uint32(32),eS.codec().encode(t.status,r)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.type=e.Type.codec().decode(t);break;case 2:i.peer=eE.codec().decode(t,t.uint32(),{limits:n.limits?.peer});break;case 3:i.limit=ex.codec().decode(t,t.uint32(),{limits:n.limits?.limit});break;case 4:i.status=eS.codec().decode(t);break;default:t.skipType(7&r)}}return i})),n),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(ev||(ev={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.id&&e.id.byteLength>0&&(t.uint32(10),t.bytes(e.id)),null!=e.addrs)for(let r of e.addrs)t.uint32(18),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={id:(0,to.c)(0),addrs:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.id=e.bytes();break;case 2:if(r.limits?.addrs!=null&&n.addrs.length===r.limits.addrs)throw new rz('Decode error - map field "addrs" had too many elements');n.addrs.push(e.bytes());break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(eE||(eE={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.expire&&0n!==e.expire&&(t.uint32(8),t.uint64(e.expire)),null!=e.addrs)for(let r of e.addrs)t.uint32(18),t.bytes(r);null!=e.voucher&&(t.uint32(26),eI.codec().encode(e.voucher,t)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={expire:0n,addrs:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.expire=e.uint64();break;case 2:if(r.limits?.addrs!=null&&n.addrs.length===r.limits.addrs)throw new rz('Decode error - map field "addrs" had too many elements');n.addrs.push(e.bytes());break;case 3:n.voucher=eI.codec().decode(e,e.uint32(),{limits:r.limits?.voucher});break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(eA||(eA={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.duration&&(t.uint32(8),t.uint32(e.duration)),null!=e.data&&(t.uint32(16),t.uint64(e.data)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.duration=e.uint32();break;case 2:n.data=e.uint64();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(ex||(ex={})),function(e){e.UNUSED="UNUSED",e.OK="OK",e.RESERVATION_REFUSED="RESERVATION_REFUSED",e.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONNECTION_FAILED="CONNECTION_FAILED",e.NO_RESERVATION="NO_RESERVATION",e.MALFORMED_MESSAGE="MALFORMED_MESSAGE",e.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"}(eS||(eS={})),function(e){e[e.UNUSED=0]="UNUSED",e[e.OK=100]="OK",e[e.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",e[e.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",e[e.PERMISSION_DENIED=202]="PERMISSION_DENIED",e[e.CONNECTION_FAILED=203]="CONNECTION_FAILED",e[e.NO_RESERVATION=204]="NO_RESERVATION",e[e.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",e[e.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"}(ek||(ek={})),function(e){e.codec=()=>r$(ek)}(eS||(eS={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.relay&&e.relay.byteLength>0&&(t.uint32(10),t.bytes(e.relay)),null!=e.peer&&e.peer.byteLength>0&&(t.uint32(18),t.bytes(e.peer)),null!=e.expiration&&0n!==e.expiration&&(t.uint32(24),t.uint64(e.expiration)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={relay:(0,to.c)(0),peer:(0,to.c)(0),expiration:0n},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.relay=e.bytes();break;case 2:n.peer=e.bytes();break;case 3:n.expiration=e.uint64();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(e_||(e_={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.publicKey&&e.publicKey.byteLength>0&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.payloadType&&e.payloadType.byteLength>0&&(t.uint32(18),t.bytes(e.payloadType)),null!=e.payload&&(t.uint32(26),e_.codec().encode(e.payload,t)),null!=e.signature&&e.signature.byteLength>0&&(t.uint32(42),t.bytes(e.signature)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={publicKey:(0,to.c)(0),payloadType:(0,to.c)(0),signature:(0,to.c)(0)},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.publicKey=e.bytes();break;case 2:n.payloadType=e.bytes();break;case 3:n.payload=e_.codec().decode(e,e.uint32(),{limits:r.limits?.payload});break;case 5:n.signature=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(eI||(eI={}));class CC{expires;bytes;constructor(e){e?.duration!=null&&e?.duration!==0&&(this.expires=Date.now()+1e3*e.duration),this.bytes=e?.data,0n===this.bytes&&(this.bytes=void 0),this.onData=this.onData.bind(this)}onData(e){null!=this.bytes&&(this.bytes-=BigInt(e.byteLength),this.bytes<0n&&(this.bytes=0n))}getLimits(){if(null==this.expires&&null==this.bytes)return;let e={};if(null!=this.bytes){let t=this;Object.defineProperty(e,"bytes",{get:()=>t.bytes})}if(null!=this.expires){let t=this;Object.defineProperty(e,"seconds",{get:()=>Math.round(((t.expires??0)-Date.now())/1e3)})}return e}}let CP=mf(mh(mz.matchers[0],ms("p2p-circuit"))),CR=mf(ms("p2p-circuit"));class CD extends cf{peerStore;registrar;connectionManager;randomWalk;started;running;topologyId;log;discoveryController;filter;queue;constructor(e,t={}){super(),this.log=e.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.started=!1,this.running=!1,this.peerStore=e.peerStore,this.registrar=e.registrar,this.connectionManager=e.connectionManager,this.randomWalk=e.randomWalk,this.filter=t.filter,this.discoveryController=new AbortController,this.discoveryController.signal}isStarted(){return this.started}async start(){this.topologyId=await this.registrar.register(Cx,{filter:this.filter,onConnect:e=>{this.log.trace("discovered relay %p queue (length: %d, active %d)",e,this.queue?.size,this.queue?.running),this.safeDispatchEvent("relay:discover",{detail:e})}}),this.started=!0}stop(){null!=this.topologyId&&this.registrar.unregister(this.topologyId),this.discoveryController?.abort(),this.started=!1}startDiscovery(){this.running||(this.log("start discovery"),this.running=!0,this.discoveryController=new AbortController,this.discoveryController.signal,Promise.resolve().then(async()=>{this.log("searching peer store for relays");let e=await this.peerStore.all({filters:[e=>e.protocols.includes(Cx)],orders:[()=>.5>Math.random()?1:-1,(e,t)=>{let r=CN(e),n=CN(t);return r>n?-1:+(n>r)}]});for(let t of e)this.log.trace("found relay peer %p in peer store",t.id),this.safeDispatchEvent("relay:discover",{detail:t.id});this.log("found %d relay peers in peer store",e.length);let t=this.queue=new cZ({concurrency:5});for await(let e of(this.log("start random walk"),this.randomWalk.walk({signal:this.discoveryController.signal}))){if(this.log.trace("found random peer %p",e.id),t.has(e.id)){this.log.trace("random peer %p was already in queue",e.id);continue}if(this.connectionManager.getConnections(e.id)?.length>0){this.log.trace("random peer %p was already connected",e.id);continue}if(!await this.connectionManager.isDialable(e.multiaddrs)){this.log.trace("random peer %p was not dialable",e.id,e.multiaddrs.map(e=>e.toString()));continue}t.queued>10&&(this.log.trace("wait for space in queue for %p",e.id),await t.onSizeLessThan(10,{signal:this.discoveryController.signal})),this.log("adding random peer %p to dial queue (length: %d, active %d)",e.id,t.size,t.running),t.add(async()=>{let t=ch([this.discoveryController.signal,AbortSignal.timeout(5e3)]);try{await this.connectionManager.openConnection(e.id,{signal:t})}finally{t.clear()}},{peerId:e.id,signal:this.discoveryController.signal}).catch(t=>{this.log.error("error opening connection to random peer %p",e.id,t)})}this.log("stop random walk"),await t.onIdle()}).catch(e=>{this.discoveryController.signal.aborted||this.log.error("failed when finding relays on the network",e)}))}stopDiscovery(){this.log("stop discovery"),this.running=!1,this.discoveryController?.abort()}}function CN(e){let t=e.metadata.get("last-dial-success");return null==t?0:new Date((0,uC.d)(t)).getTime()}class CM extends cf{connectionManager;addressManager;reservationStore;listeningAddrs;log;listenTimeout;reservationId;relay;constructor(e,t={}){super(),this.log=e.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.connectionManager=e.connectionManager,this.addressManager=e.addressManager,this.reservationStore=e.reservationStore,this.listeningAddrs=[],this.listenTimeout=t.listenTimeout??Cv,this.reservationStore.addEventListener("relay:removed",this._onRemoveRelayPeer),this.reservationStore.addEventListener("relay:created-reservation",this._onAddRelayPeer)}_onRemoveRelayPeer=e=>{this.log("relay removed %p our relay %p",e.detail.relay,this.relay,this.relay?.equals(e.detail.relay)),this.relay?.equals(e.detail.relay)===!0&&(this.log("relay peer removed %p",e.detail.relay),this.listeningAddrs.forEach(e=>{this.addressManager.removeObservedAddr(e)}),this.listeningAddrs=[],this.safeDispatchEvent("listening"))};_onAddRelayPeer=e=>{let{details:t}=e.detail;"configured"!==t.type&&t.id===this.reservationId&&this.addedRelay(e.detail)};async listen(e){if(CR.exactMatch(e))this.log("searching for circuit relay servers"),this.reservationId=this.reservationStore.reserveRelay();else if(CP.exactMatch(e)){this.log("listen on specific relay server %a",e);let t=AbortSignal.timeout(this.listenTimeout),r=e.decapsulate("/p2p-circuit"),n=await this.connectionManager.openConnection(r,{signal:t});if(!this.reservationStore.hasReservation(n.remotePeer)){this.log("making reservation on peer %p",n.remotePeer);let e=await this.reservationStore.addRelay(n.remotePeer,"configured");this.addedRelay(e)}}else throw new cL(`Could not listen on p2p-circuit address "${e}"`)}getAddrs(){return[...this.listeningAddrs.values()].flat()}updateAnnounceAddrs(){}async close(){this.reservationStore.cancelReservations(),this.listeningAddrs=[],this.reservationStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),queueMicrotask(()=>{this.safeDispatchEvent("close")})}addedRelay(e){this.log("relay peer added %p",e.relay),this.relay=e.relay,this.listeningAddrs=e.details.reservation.addrs.map(e=>yz(e).encapsulate("/p2p-circuit")),this.listeningAddrs.forEach(e=>{this.addressManager.confirmObservedAddr(e,{type:"transport"})}),queueMicrotask(()=>{this.safeDispatchEvent("listening")})}}function CB(e){return new CM(e)}let CO="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",CL=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=CO[63&r[e]];return t};class CF extends Error{static name="HadEnoughRelaysError";name="HadEnoughRelaysError"}class CU extends Error{static name="DoubleRelayError";name="DoubleRelayError"}class Cj extends Error{static name="RelayQueueFullError";name="RelayQueueFullError"}let CH=6e5,C$=3e5,Cq=3e4;class Cz extends cf{peerId;connectionManager;peerStore;events;reserveQueue;reservations;pendingReservations;maxReservationQueueLength;reservationCompletionTimeout;started;log;relayFilter;constructor(e,t){super(),this.log=e.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.reservations=new gA,this.pendingReservations=[],this.maxReservationQueueLength=t?.maxReservationQueueLength??CE,this.reservationCompletionTimeout=t?.reservationCompletionTimeout??Cv,this.started=!1,this.relayFilter=l2(100),this.reserveQueue=new cZ({concurrency:t?.reservationConcurrency??Cw,metricName:"libp2p_relay_reservation_queue",metrics:e.metrics}),this.events.addEventListener("connection:close",e=>{null!=[...this.reservations.values()].find(t=>t.connection===e.detail.id)&&this.#J(e.detail.remotePeer).catch(t=>{this.log("could not remove relay %p - %e",e.detail,t)})})}isStarted(){return this.started}start(){this.started=!0}afterStart(){Promise.resolve().then(async()=>{let e=await this.peerStore.all({filters:[e=>e.tags.has(CA)]});this.log("removing tag from %d old relays",e.length),await Promise.all(e.map(async e=>{await this.peerStore.merge(e.id,{tags:{[CA]:void 0}})})),this.log("redialing %d old relays",e.length),await Promise.all(e.map(async e=>this.addRelay(e.id,"discovered"))),this.#Z()}).catch(e=>{this.log.error(e)})}stop(){this.reserveQueue.clear(),this.reservations.forEach(({timeout:e})=>{clearTimeout(e)}),this.reservations.clear(),this.started=!1}reserveRelay(){let e=CL();return this.pendingReservations.push(e),this.#Z(),e}async addRelay(e,t){if(this.peerId.equals(e))throw this.log.trace("not trying to use self as relay"),new cL("Cannot use self as relay");if(this.reserveQueue.size>this.maxReservationQueueLength)throw new Cj("The reservation queue is full");let r=this.reserveQueue.find(e);if(null!=r)return this.log.trace("potential relay peer %p is already in the reservation queue",e),r.join();if(this.relayFilter.has(e.toMultihash().bytes))throw new cL("The relay was previously invalid");return this.log.trace("try to reserve relay slot with %p",e),this.reserveQueue.add(async()=>{let r=Date.now();try{let r,n=this.reservations.get(e);if(null!=n){let t=this.connectionManager.getConnections(e),r=!1;if(0===t.length&&this.log("already have relay reservation with %p but we are no longer connected",e),t.map(e=>e.id).includes(n.connection)&&(this.log("already have relay reservation with %p and the original connection is still open",e),r=!0),r&&CT(n.reservation.expire)>CH)return this.log("already have relay reservation with %p but we are still connected and it does not expire soon",e),{relay:e,details:n};await this.#J(e)}if("discovered"===t&&0===this.pendingReservations.length)throw new CF("Not making reservation on discovered relay because we do not need any more relays");let i=AbortSignal.timeout(this.reservationCompletionTimeout),s=await this.connectionManager.openConnection(e,{signal:i});if(mV.matches(s.remoteAddr))throw new CU("not creating reservation over relayed connection");let o=await this.#Y(s,{signal:i}),a=CT(o.expire);this.log("created reservation on relay peer %p, expiry date is %s",e,new Date(Date.now()+a).toString());let l=Math.min(Math.max(a-C$,Cq),0x7fffffff),c=setTimeout(()=>{this.log("refresh reservation to relay %p",e),this.addRelay(e,t).catch(async t=>{this.log.error("could not refresh reservation to relay %p - %e",e,t),await this.#J(e)}).catch(t=>{this.log.error("could not remove expired reservation to relay %p - %e",e,t)})},l);if("discovered"===t){let e=this.pendingReservations.pop();if(null==e)throw new CF("Made reservation on relay but did not need any more discovered relays");r={timeout:c,reservation:o,type:t,connection:s.id,id:e}}else r={timeout:c,reservation:o,type:t,connection:s.id};this.reservations.set(e,r),await this.peerStore.merge(e,{tags:{[CA]:{value:1,ttl:a}}}),this.#Z();let u={relay:e,details:r};return this.safeDispatchEvent("relay:created-reservation",{detail:u}),u}catch(n){throw("discovered"!==t||"HadEnoughRelaysError"!==n.name)&&this.log.error("could not reserve slot on %p after %dms - %e",e,Date.now()-r,n),("DialError"===n.name||"UnsupportedProtocolError"===n.name)&&this.relayFilter.add(e.toMultihash().bytes),this.#J(e).catch(t=>{this.log.error("could not remove reservation on %p after reserving slot failed - %e",e,t)}),n}},{peerId:e})}hasReservation(e){return this.reservations.has(e)}getReservation(e){return this.reservations.get(e)?.reservation}reservationCount(e){return null==e?this.reservations.size:[...this.reservations.values()].reduce((t,r)=>(r.type===e&&t++,t),0)}cancelReservations(){[...this.reservations.values()].forEach(e=>{clearTimeout(e.timeout)}),this.reservations.clear()}async #Y(e,t){let r;t.signal?.throwIfAborted(),this.log("requesting reservation from %p",e.remotePeer);let n=await e.newStream(Cx,t),i=TC(n).pb(ew);this.log.trace("send RESERVE to %p",e.remotePeer),await i.write({type:ew.Type.RESERVE},t);try{this.log.trace("reading response from %p",e.remotePeer),r=await i.read(t)}catch(e){throw n.abort(e),e}finally{"closed"!==n.status&&await n.close(t)}if(this.log.trace("read response %o",r),r.status===eS.OK&&null!=r.reservation){let t=new Set;for(let n of(t.add(e.remoteAddr.toString()),r.reservation.addrs)){let r=yz(n);null==r.getPeerId()&&(r=r.encapsulate(`/p2p/${e.remotePeer}`)),r=yz(r.toString().replace(`/p2p/${e.remotePeer}/p2p/${e.remotePeer}`,`/p2p/${e.remotePeer}`)),t.add(r.toString())}return r.reservation.addrs=[...t].map(e=>yz(e).bytes),r.reservation}let s=`reservation failed with status ${r.status??"undefined"}`;throw this.log.error(s),Error(s)}async #J(e){let t=this.reservations.get(e);null!=t&&(this.log("removing relay reservation with %p from local store",e),clearTimeout(t.timeout),this.reservations.delete(e),"discovered"===t.type&&this.pendingReservations.push(t.id),await this.peerStore.merge(e,{tags:{[CA]:void 0}}),this.safeDispatchEvent("relay:removed",{detail:{relay:e,details:t}}),this.#Z())}#Z(){if(0===this.pendingReservations.length){this.log.trace("have discovered enough relays"),this.reserveQueue.clear(),this.safeDispatchEvent("relay:found-enough-relays");return}this.relayFilter=l2(100),this.log("not discovered enough relays %d/%d",this.reservations.size,this.pendingReservations.length),this.safeDispatchEvent("relay:not-enough-relays")}}let CV=e=>{if(null==e.peer)return!1;try{e.peer.addrs.forEach(yz)}catch{return!1}return!0},CG={maxInboundStopStreams:Ck,maxOutboundStopStreams:Ck};class CK{discovery;registrar;peerStore;connectionManager;transportManager;peerId;upgrader;addressManager;connectionGater;reservationStore;logger;maxInboundStopStreams;maxOutboundStopStreams;started;log;shutdownController;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:circuit-relay:transport"),this.registrar=e.registrar,this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.logger=e.logger,this.peerId=e.peerId,this.upgrader=e.upgrader,this.addressManager=e.addressManager,this.connectionGater=e.connectionGater,this.maxInboundStopStreams=t.maxInboundStopStreams??CG.maxInboundStopStreams,this.maxOutboundStopStreams=t.maxOutboundStopStreams??CG.maxOutboundStopStreams,this.shutdownController=new AbortController,this.discovery=new CD(e,{filter:t.discoveryFilter??Cm(C_,CI)}),this.discovery.addEventListener("relay:discover",e=>{this.reservationStore.addRelay(e.detail,"discovered").catch(t=>{"HadEnoughRelaysError"!==t.name&&"RelayQueueFullError"!==t.name&&this.log.error("could not add discovered relay %p",e.detail,t)})}),this.reservationStore=new Cz(e,t),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{this.discovery?.startDiscovery()}),this.reservationStore.addEventListener("relay:found-enough-relays",()=>{this.discovery?.stopDiscovery()}),this.started=!1}[Symbol.toStringTag]="@libp2p/circuit-relay-v2-transport";[vs]=["@libp2p/transport","@libp2p/circuit-relay-v2-transport"];get[vo](){return null!=this.discovery?["@libp2p/identify"]:[]}[Au]=!0;isStarted(){return this.started}async start(){this.shutdownController=new AbortController,await this.registrar.handle(CS,e=>{let t=this.upgrader.createInboundAbortSignal(this.shutdownController.signal);this.onStop(e,t).catch(t=>{this.log.error("error while handling STOP protocol",t),e.stream.abort(t)}).finally(()=>{t.clear()})},{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnLimitedConnection:!0}),await bH(this.discovery,this.reservationStore),this.started=!0}async stop(){this.shutdownController.abort(),await b$(this.discovery,this.reservationStore),await this.registrar.unhandle(CS),this.started=!1}async dial(e,t){let r;if(1!==e.protoCodes().filter(e=>e===Cb).length){let t="Invalid circuit relay address";throw this.log.error(t,e),new cO(t)}let n=e.toString().split("/p2p-circuit"),i=yz(n[0]),s=yz(n[n.length-1]),o=i.getPeerId(),a=s.getPeerId();if(null==o||null==a){let t=`ircuit relay dial to ${e.toString()} failed as address did not have both relay and destination PeerIDs`;throw this.log.error(`c${t}`),new cO(`C${t}`)}let l=gf(o),c=gf(a),u=this.connectionManager.getConnections(l)[0];null==u?(await this.peerStore.merge(l,{multiaddrs:[i]}),t.onProgress?.(new rY("circuit-relay:open-connection")),u=await this.connectionManager.openConnection(l,t)):t.onProgress?.(new rY("circuit-relay:reuse-connection"));try{t.onProgress?.(new rY("circuit-relay:open-hop-stream")),r=await u.newStream(Cx,t);let n=TC(r),o=n.pb(ew);t.onProgress?.(new rY("circuit-relay:write-connect-message")),await o.write({type:ew.Type.CONNECT,peer:{id:c.toMultihash().bytes,addrs:[yz(s).bytes]}},t),t.onProgress?.(new rY("circuit-relay:read-connect-response"));let a=await o.read(t);if(a.status!==eS.OK)throw new cD(`failed to connect via relay with status ${a?.status?.toString()??"undefined"}`);let l=new CC(a.limit),d=Cy({stream:n.unwrap(),remoteAddr:e,localAddr:i.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`),logger:this.logger,onDataRead:l.onData,onDataWrite:l.onData});return this.log("new outbound relayed connection %a",d.remoteAddr),await this.upgrader.upgradeOutbound(d,{...t,limits:l.getLimits()})}catch(e){throw this.log.error("circuit relay dial to destination %p via relay %p failed",c,l,e),r?.abort(e),e}}createListener(e){return CB({peerId:this.peerId,connectionManager:this.connectionManager,addressManager:this.addressManager,reservationStore:this.reservationStore,logger:this.logger})}listenFilter(e){return(e=Array.isArray(e)?e:[e]).filter(e=>CP.exactMatch(e)||CR.exactMatch(e))}dialFilter(e){return(e=Array.isArray(e)?e:[e]).filter(e=>mV.exactMatch(e))}async onStop({connection:e,stream:t},r){if(!this.reservationStore.hasReservation(e.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),await this.transportManager.listen([e.remoteAddr.encapsulate("/p2p-circuit")])}catch(e){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on",e)}let n=TC(t).pb(ev),i=await n.read({signal:r});if(this.log("new circuit relay v2 stop stream from %p with type %s",e.remotePeer,i.type),i?.type===void 0){this.log.error("type was missing from circuit v2 stop protocol request from %s",e.remotePeer),await n.write({type:ev.Type.STATUS,status:eS.MALFORMED_MESSAGE},{signal:r}),await t.close();return}if(i.type!==ev.Type.CONNECT){this.log.error("invalid stop connect request via peer %p",e.remotePeer),await n.write({type:ev.Type.STATUS,status:eS.UNEXPECTED_MESSAGE},{signal:r}),await t.close();return}if(!CV(i)){this.log.error("invalid stop connect request via peer %p",e.remotePeer),await n.write({type:ev.Type.STATUS,status:eS.MALFORMED_MESSAGE},{signal:r}),await t.close({signal:r});return}let s=gm(o0.decode(i.peer.id));if(await this.connectionGater.denyInboundRelayedConnection?.(e.remotePeer,s)===!0){this.log.error("connection gater denied inbound relayed connection from %p",e.remotePeer),await n.write({type:ev.Type.STATUS,status:eS.PERMISSION_DENIED},{signal:r}),await t.close({signal:r});return}this.log.trace("sending success response to %p",e.remotePeer),await n.write({type:ev.Type.STATUS,status:eS.OK},{signal:r});let o=new CC(i.limit),a=e.remoteAddr.encapsulate(`/p2p-circuit/p2p/${s.toString()}`),l=this.addressManager.getAddresses()[0],c=Cy({stream:n.unwrap().unwrap(),remoteAddr:a,localAddr:l,logger:this.logger,onDataRead:o.onData,onDataWrite:o.onData});this.log("new inbound relayed connection %a",c.remoteAddr),await this.upgrader.upgradeInbound(c,{limits:o.getLimits(),signal:r}),this.log("%s connection %a upgraded","inbound",c.remoteAddr)}}function CW(e={}){return t=>new CK(t,e)}function CQ(e,t){return!mV.matches(e)&&null!=t.dialTransportForMultiaddr(e)&&(!!mb.matches(e)||!!m_.matches(e)&&!1===mr(e.toOptions().host))}!function(e){let t,r,n;!function(e){e.UNUSED="UNUSED",e.CONNECT="CONNECT",e.SYNC="SYNC"}(t=e.Type||(e.Type={})),function(e){e[e.UNUSED=0]="UNUSED",e[e.CONNECT=100]="CONNECT",e[e.SYNC=300]="SYNC"}(r||(r={})),function(e){e.codec=()=>r$(r)}(t=e.Type||(e.Type={})),e.codec=()=>(null==n&&(n=rq((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.Type.codec().encode(t.type,r)),null!=t.observedAddresses)for(let e of t.observedAddresses)r.uint32(18),r.bytes(e);!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={observedAddresses:[]},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.type=e.Type.codec().decode(t);break;case 2:if(n.limits?.observedAddresses!=null&&i.observedAddresses.length===n.limits.observedAddresses)throw new rz('Decode error - map field "observedAddresses" had too many elements');i.observedAddresses.push(t.bytes());break;default:t.skipType(7&r)}}return i})),n),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(eT||(eT={}));let CJ=4096,CZ=100,CY={timeout:5e3,retries:3,maxInboundStreams:1,maxOutboundStreams:1};class CX{started;timeout;retries;maxInboundStreams;maxOutboundStreams;peerStore;registrar;connectionManager;addressManager;transportManager;topologyId;log;constructor(e,t){this.log=e.logger.forComponent("libp2p:dcutr"),this.started=!1,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.timeout=t.timeout??CY.timeout,this.retries=t.retries??CY.retries,this.maxInboundStreams=t.maxInboundStreams??CY.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??CY.maxOutboundStreams}[Symbol.toStringTag]="@libp2p/dcutr";[vo]=["@libp2p/identify"];isStarted(){return this.started}async start(){this.started||(this.topologyId=await this.registrar.register(C0,{notifyOnLimitedConnection:!0,onConnect:(e,t)=>{mV.exactMatch(t.remoteAddr)&&"inbound"===t.direction&&this.upgradeInbound(t).catch(e=>{this.log.error("error during outgoing DCUtR attempt",e)})}}),await this.registrar.handle(C0,e=>{this.handleIncomingUpgrade(e.stream,e.connection).catch(t=>{this.log.error("error during incoming DCUtR attempt",t),e.stream.abort(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:!0}),this.started=!0)}async stop(){await this.registrar.unhandle(C0),null!=this.topologyId&&this.registrar.unregister(this.topologyId),this.started=!1}async upgradeInbound(e){let t;if(!await this.attemptUnilateralConnectionUpgrade(e))for(let r=0;r<this.retries;r++){let n={signal:AbortSignal.timeout(this.timeout)};try{t=await e.newStream([C0],{signal:n.signal,runOnLimitedConnection:!0});let r=TC(t,{maxDataLength:CJ}).pb(eT);this.log("B sending connect to %p",e.remotePeer);let i=Date.now();await r.write({type:eT.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(e=>e.bytes)},n),this.log("B receiving connect from %p",e.remotePeer);let s=await r.read(n);if(s.type!==eT.Type.CONNECT)throw this.log("A sent wrong message type"),new cD("DCUtR message type was incorrect");let o=this.getDialableMultiaddrs(s.observedAddresses);if(0===o.length)throw this.log("A did not have any dialable multiaddrs"),new cD("DCUtR connect message had no multiaddrs");let a=Date.now()-i;this.log("A sending sync, rtt %dms",a),await r.write({type:eT.Type.SYNC,observedAddresses:[]},n),this.log("A waiting for half RTT"),await xX(a/2),this.log("B dialing",o);let l=await this.connectionManager.openConnection(o,{signal:n.signal,priority:CZ,force:!0,initiator:!1});this.log("DCUtR to %p succeeded to address %a, closing relayed connection",e.remotePeer,l.remoteAddr),await e.close(n);break}catch(e){if(this.log.error("error while attempting DCUtR on attempt %d of %d",r+1,this.retries,e),t?.abort(e),r===this.retries)throw e}finally{null!=t&&await t.close(n)}}}async attemptUnilateralConnectionUpgrade(e){let t=(await this.peerStore.get(e.remotePeer)).addresses.map(t=>{let r=t.multiaddr;return null==r.getPeerId()?r.encapsulate(`/p2p/${e.remotePeer}`):r}).filter(e=>CQ(e,this.transportManager));if(t.length>0){let r=AbortSignal.timeout(this.timeout);try{this.log("attempting unilateral connection upgrade to %a",t);let n=await this.connectionManager.openConnection(t,{signal:r,force:!0});if(mV.exactMatch(n.remoteAddr))throw Error("Could not open a new, non-limited, connection");return this.log("unilateral connection upgrade to %p succeeded via %a, closing relayed connection",e.remotePeer,n.remoteAddr),await e.close({signal:r}),!0}catch(r){this.log.error("unilateral connection upgrade to %p on addresses %a failed",e.remotePeer,t,r)}}else this.log("peer %p has no public addresses, not attempting unilateral connection upgrade",e.remotePeer);return!1}async handleIncomingUpgrade(e,t){let r={signal:AbortSignal.timeout(this.timeout)};try{let n=TC(e,{maxDataLength:CJ}).pb(eT);this.log("A receiving connect");let i=await n.read(r);if(i.type!==eT.Type.CONNECT)throw this.log("B sent wrong message type"),new cD("DCUtR message type was incorrect");if(0===i.observedAddresses.length)throw this.log("B sent no multiaddrs"),new cD("DCUtR connect message had no multiaddrs");let s=this.getDialableMultiaddrs(i.observedAddresses);if(0===s.length)throw this.log("B had no dialable multiaddrs"),new cD("DCUtR connect message had no dialable multiaddrs");if(this.log("A sending connect"),await n.write({type:eT.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(e=>e.bytes)}),this.log("A receiving sync"),(await n.read(r)).type!==eT.Type.SYNC)throw new cD("DCUtR message type was incorrect");this.log("A dialing",s);let o=await this.connectionManager.openConnection(s,{signal:r.signal,priority:CZ,force:!0});this.log("DCUtR to %p succeeded via %a, closing relayed connection",t.remotePeer,o.remoteAddr),await t.close(r)}catch(r){this.log.error("incoming DCUtR from %p failed",t.remotePeer,r),e.abort(r)}finally{await e.close(r)}}getDialableMultiaddrs(e){let t=[];for(let r of e)if(null!=r&&0!==r.length)try{let e=yz(r);if(!CQ(e,this.transportManager))continue;t.push(e)}catch{}return t}}let C0="/libp2p/dcutr";function C1(e={}){return t=>new CX(t,e)}let C2="0.1.0",C3="id",C4="id/push",C5="1.0.0",C6="1.0.0",C8=8192,C7=32;!function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.protocolVersion&&(t.uint32(42),t.string(e.protocolVersion)),null!=e.agentVersion&&(t.uint32(50),t.string(e.agentVersion)),null!=e.publicKey&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.listenAddrs)for(let r of e.listenAddrs)t.uint32(18),t.bytes(r);if(null!=e.observedAddr&&(t.uint32(34),t.bytes(e.observedAddr)),null!=e.protocols)for(let r of e.protocols)t.uint32(26),t.string(r);null!=e.signedPeerRecord&&(t.uint32(66),t.bytes(e.signedPeerRecord)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={listenAddrs:[],protocols:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 5:n.protocolVersion=e.string();break;case 6:n.agentVersion=e.string();break;case 1:n.publicKey=e.bytes();break;case 2:if(r.limits?.listenAddrs!=null&&n.listenAddrs.length===r.limits.listenAddrs)throw new rz('Decode error - map field "listenAddrs" had too many elements');n.listenAddrs.push(e.bytes());break;case 4:n.observedAddr=e.bytes();break;case 3:if(r.limits?.protocols!=null&&n.protocols.length===r.limits.protocols)throw new rz('Decode error - map field "protocols" had too many elements');n.protocols.push(e.string());break;case 8:n.signedPeerRecord=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(eC||(eC={}));let C9={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:C8,runOnConnectionOpen:!0,runOnSelfUpdate:!0,runOnLimitedConnection:!0,concurrency:C7};function Pe(e){if(null!=e&&e.length>0)try{return yz(e)}catch{}}function Pt(e,t){return null!=t?t:e.userAgent}async function Pr(e,t,r,n,i){let s;if(r("received identify from %p",n.remotePeer),null==i)throw new cD("message was null or undefined");let o={};if(i.listenAddrs.length>0&&(o.addresses=i.listenAddrs.map(e=>({isCertified:!1,multiaddr:yz(e)}))),i.protocols.length>0&&(o.protocols=i.protocols),null!=i.publicKey){let e=p2(i.publicKey);if(!gp(e).equals(n.remotePeer))throw new cD("public key did not match remote PeerId");o.publicKey=e}if(null!=i.signedPeerRecord){let t;r.trace("received signedPeerRecord from %p",n.remotePeer);let a=i.signedPeerRecord,l=await AE.openAndCertify(a,A_.DOMAIN),c=A_.createFromProtobuf(l.payload),u=gy(l.publicKey.toCID());if(!c.peerId.equals(u))throw new cD("signing key does not match PeerId in the PeerRecord");if(!n.remotePeer.equals(c.peerId))throw new cD("signing key does not match remote PeerId");try{t=await e.get(c.peerId)}catch(e){if("NotFoundError"!==e.name)throw e}if(null!=t&&(o.metadata=t.metadata,null!=t.peerRecordEnvelope)){let e=await AE.createFromProtobuf(t.peerRecordEnvelope),n=A_.createFromProtobuf(e.payload);n.seqNumber>=c.seqNumber&&(r("sequence number was lower or equal to existing sequence number - stored: %d received: %d",n.seqNumber,c.seqNumber),c=n,a=t.peerRecordEnvelope)}o.peerRecordEnvelope=a,o.addresses=c.multiaddrs.map(e=>({isCertified:!0,multiaddr:e})),s={seq:c.seqNumber,addresses:c.multiaddrs}}else r("%p did not send a signed peer record",n.remotePeer);if(r.trace("patching %p with",n.remotePeer,o),await e.patch(n.remotePeer,o),null!=i.agentVersion||null!=i.protocolVersion){let t={};null!=i.agentVersion&&(t.AgentVersion=(0,rx.s)(i.agentVersion)),null!=i.protocolVersion&&(t.ProtocolVersion=(0,rx.s)(i.protocolVersion)),r.trace("merging %p metadata",n.remotePeer,t),await e.merge(n.remotePeer,{metadata:t})}let a={peerId:n.remotePeer,protocolVersion:i.protocolVersion,agentVersion:i.agentVersion,publicKey:i.publicKey,listenAddrs:i.listenAddrs.map(e=>yz(e)),observedAddr:null==i.observedAddr?void 0:yz(i.observedAddr),protocols:i.protocols,signedPeerRecord:s,connection:n};return t.safeDispatchEvent("peer:identify",{detail:a}),a}class Pn{host;protocol;started;timeout;peerId;privateKey;peerStore;registrar;addressManager;maxInboundStreams;maxOutboundStreams;maxMessageSize;maxObservedAddresses;events;runOnLimitedConnection;log;constructor(e,t){this.protocol=t.protocol,this.started=!1,this.peerId=e.peerId,this.privateKey=e.privateKey,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.events=e.events,this.log=t.log,this.timeout=t.timeout??C9.timeout,this.maxInboundStreams=t.maxInboundStreams??C9.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??C9.maxOutboundStreams,this.maxMessageSize=t.maxMessageSize??C9.maxMessageSize,this.maxObservedAddresses=t.maxObservedAddresses??C9.maxObservedAddresses,this.runOnLimitedConnection=t.runOnLimitedConnection??C9.runOnLimitedConnection,this.host={protocolVersion:`${t.protocolPrefix??C9.protocolPrefix}/${C2}`,agentVersion:Pt(e.nodeInfo,t.agentVersion)}}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:(0,rx.s)(this.host.agentVersion),ProtocolVersion:(0,rx.s)(this.host.protocolVersion)}}),await this.registrar.handle(this.protocol,e=>{this.handleProtocol(e).catch(e=>{this.log.error(e)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.protocol),this.started=!1}}class Pi extends Pn{connectionManager;concurrency;constructor(e,t={}){super(e,{...t,protocol:`/${t.protocolPrefix??C9.protocolPrefix}/${C4}/${C6}`,log:e.logger.forComponent("libp2p:identify-push")}),this.connectionManager=e.connectionManager,this.concurrency=t.concurrency??C9.concurrency,(t.runOnSelfUpdate??C9.runOnSelfUpdate)&&e.events.addEventListener("self:peer:update",e=>{this.push().catch(e=>{this.log.error(e)})})}[vs]=["@libp2p/identify-push"];async push(){if(!this.isStarted())return;let e=this.addressManager.getAddresses().map(e=>e.decapsulateCode(yl("p2p").code)),t=new A_({peerId:this.peerId,multiaddrs:e}),r=await AE.seal(t,this.privateKey),n=this.registrar.getProtocols(),i=await this.peerStore.get(this.peerId),s=(0,uC.d)(i.metadata.get("AgentVersion")??(0,rx.s)(this.host.agentVersion)),o=(0,uC.d)(i.metadata.get("ProtocolVersion")??(0,rx.s)(this.host.protocolVersion)),a=this;async function*l(){for(let t of a.connectionManager.getConnections())(await a.peerStore.get(t.remotePeer)).protocols.includes(a.protocol)&&(yield async()=>{let i,l=AbortSignal.timeout(a.timeout);try{i=await t.newStream(a.protocol,{signal:l,runOnLimitedConnection:a.runOnLimitedConnection});let c=TC(i,{maxDataLength:a.maxMessageSize}).pb(eC);await c.write({listenAddrs:e.map(e=>e.bytes),signedPeerRecord:r.marshal(),protocols:n,agentVersion:s,protocolVersion:o},{signal:l}),await i.close({signal:l})}catch(e){a.log.error("could not push identify update to peer",e),i?.abort(e)}})}await (0,cY.A)(al(l(),{concurrency:this.concurrency}))}async handleProtocol(e){let{connection:t,stream:r}=e;try{if(this.peerId.equals(t.remotePeer))throw Error("received push from ourselves?");let e={signal:AbortSignal.timeout(this.timeout)},n=TC(r,{maxDataLength:this.maxMessageSize}).pb(eC),i=await n.read(e);await r.close(e),await Pr(this.peerStore,this.events,this.log,t,i)}catch(e){this.log.error("received invalid message",e),r.abort(e);return}this.log.trace("handled push from %p",t.remotePeer)}}let Ps=41;class Po extends Pn{constructor(e,t={}){super(e,{...t,protocol:`/${t.protocolPrefix??C9.protocolPrefix}/${C3}/${C5}`,log:e.logger.forComponent("libp2p:identify")}),(t.runOnConnectionOpen??C9.runOnConnectionOpen)&&e.events.addEventListener("connection:open",e=>{let t=e.detail;this.identify(t).catch(e=>{e.name!==cR.name&&this.log.error("error during identify trigged by connection:open",e)})})}[vs]=["@libp2p/identify"];async _identify(e,t={}){let r;if(null==t.signal){let e=AbortSignal.timeout(this.timeout);t={...t,signal:e}}try{r=await e.newStream(this.protocol,{...t,runOnLimitedConnection:this.runOnLimitedConnection});let n=TC(r,{maxDataLength:this.maxMessageSize}).pb(eC),i=await n.read(t);return await r.close(t),i}catch(e){throw r?.abort(e),e}}async identify(e,t={}){let r=await this._identify(e,t),{publicKey:n,protocols:i,observedAddr:s}=r;if(null==n)throw new cD("public key was missing from identify message");let o=gy(p2(n).toCID());if(!e.remotePeer.equals(o))throw new cD("identified peer does not match the expected peer");if(this.peerId.equals(o))throw new cD("identified peer is our own peer id?");return this.maybeAddObservedAddress(s),this.log("identify completed for peer %p and protocols %o",o,i),Pr(this.peerStore,this.events,this.log,e,r)}maybeAddObservedAddress(e){let t=Pe(e);return null==t?void 0:(this.log.trace("our observed address was %a",t),xf(t))?void this.log.trace("our observed address was private"):t.stringTuples()[0][0]!==Ps||TI(t)?void(!mC.exactMatch(t)&&(this.log.trace("storing the observed address"),this.addressManager.addObservedAddr(t))):void this.log.trace("our observed address was IPv6 but not a global unicast address")}async handleProtocol(e){let{connection:t,stream:r}=e,n=AbortSignal.timeout(this.timeout);try{let e=await this.peerStore.get(this.peerId),i=this.addressManager.getAddresses().map(e=>e.decapsulateCode(yl("p2p").code)),s=e.peerRecordEnvelope;if(i.length>0&&null==s){let e=new A_({peerId:this.peerId,multiaddrs:i});s=(await AE.seal(e,this.privateKey)).marshal().subarray()}let o=t.remoteAddr.bytes;mx.matches(t.remoteAddr)||(o=void 0);let a=TC(r).pb(eC);await a.write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:p5(this.privateKey.publicKey),listenAddrs:i.map(e=>e.bytes),signedPeerRecord:s,observedAddr:o,protocols:e.protocols},{signal:n}),await r.close({signal:n})}catch(e){this.log.error("could not respond to identify request",e),r.abort(e)}}}function Pa(e={}){return t=>new Po(t,e)}function Pl(e={}){return t=>new Pi(t,e)}let Pc=1296e5,Pu="/ipfs/kad/1.0.0",Pd=1728e5,Ph=864e5,Pf=10,Pp=16384,Pg=36e5,Pm=20,Py=3,Pb=3e5,Pw=1e3,Pv=5e3,PE=3e5,PA=3e4,Px=18e4,PS=`${SA}-kad-dht`;function Pk(e){let t=e.getUTCFullYear(),r=String(e.getUTCMonth()+1).padStart(2,"0"),n=String(e.getUTCDate()).padStart(2,"0"),i=String(e.getUTCHours()).padStart(2,"0"),s=String(e.getUTCMinutes()).padStart(2,"0"),o=String(e.getUTCSeconds()).padStart(2,"0"),a=String(1e3*e.getUTCMilliseconds()*1e3).padStart(9,"0");return`${t}-${r}-${n}T${i}:${s}:${o}.${a}Z`}function P_(e){let t=RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),r=String(e).trim().match(t);if(null==r)throw Error("Invalid format");let n=parseInt(r[1],10),i=parseInt(r[2],10)-1,s=parseInt(r[3],10),o=parseInt(r[4],10),a=parseInt(r[5],10);return new Date(Date.UTC(n,i,s,o,a,parseInt(r[6],10),parseInt(r[7].slice(0,-6),10)))}!function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.key&&e.key.byteLength>0&&(t.uint32(10),t.bytes(e.key)),null!=e.value&&e.value.byteLength>0&&(t.uint32(18),t.bytes(e.value)),null!=e.timeReceived&&""!==e.timeReceived&&(t.uint32(42),t.string(e.timeReceived)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={key:(0,to.c)(0),value:(0,to.c)(0),timeReceived:""},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.key=e.bytes();break;case 2:n.value=e.bytes();break;case 5:n.timeReceived=e.string();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(eP||(eP={}));class PI{key;value;timeReceived;constructor(e,t,r){if(!(e instanceof Uint8Array))throw Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=r}serialize(){return eP.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:Pk(this.timeReceived)}}static deserialize(e){let t=eP.decode(e);return new PI(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){let t=P_(e.timeReceived);if(null==e.key)throw Error("key missing from deserialized object");if(null==e.value)throw Error("value missing from deserialized object");return new PI(e.key,e.value,t)}}class PT extends Error{constructor(e="Query error"){super(e),this.name="QueryError"}}class PC extends Error{constructor(e="Query aborted"){super(e),this.name="QueryAbortedError"}}class PP extends Error{constructor(e="Invalid record"){super(e),this.name="InvalidRecordError"}}class PR extends Error{constructor(e="No selector function configured for prefix"){super(e),this.name="MissingSelectorError"}}function PD(e,t={}){let r={...e,name:"SEND_QUERY",type:0,messageName:e.type,messageType:e.type};return t.onProgress?.(new CustomEvent("kad-dht:query:send-query",{detail:r})),r}function PN(e,t={}){let r={...e,name:"PEER_RESPONSE",type:1,messageName:e.messageType,closer:e.closer??[],providers:e.providers??[]};return t.onProgress?.(new CustomEvent("kad-dht:query:peer-response",{detail:r})),r}function PM(e,t={}){let r={...e,name:"FINAL_PEER",type:2};return t.onProgress?.(new CustomEvent("kad-dht:query:final-peer",{detail:r})),r}function PB(e,t={}){let r={...e,name:"QUERY_ERROR",type:3};return t.onProgress?.(new CustomEvent("kad-dht:query:query-error",{detail:r})),r}function PO(e,t={}){let r={...e,name:"PROVIDER",type:4};return t.onProgress?.(new CustomEvent("kad-dht:query:provider",{detail:r})),r}function PL(e,t={}){let r={...e,name:"VALUE",type:5};return t.onProgress?.(new CustomEvent("kad-dht:query:value",{detail:r})),r}function PF(e,t={}){let r={...e,name:"DIAL_PEER",type:7};return t.onProgress?.(new CustomEvent("kad-dht:query:dial-peer",{detail:r})),r}function PU(e,t,r){if(0===r.length)throw new cy("No records given");let n=(0,uC.d)(t).split("/");if(n.length<3)throw new cy("Record key does not have a selector function");let i=e[n[1].toString()];if(null==i)throw new PR(`No selector function configured for key type "${n[1]}"`);return 1===r.length?0:i(t,r)}!function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.key&&(t.uint32(10),t.bytes(e.key)),null!=e.value&&(t.uint32(18),t.bytes(e.value)),null!=e.author&&(t.uint32(26),t.bytes(e.author)),null!=e.signature&&(t.uint32(34),t.bytes(e.signature)),null!=e.timeReceived&&(t.uint32(42),t.string(e.timeReceived)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.key=e.bytes();break;case 2:n.value=e.bytes();break;case 3:n.author=e.bytes();break;case 4:n.signature=e.bytes();break;case 5:n.timeReceived=e.string();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(eR||(eR={})),function(e){e.PUT_VALUE="PUT_VALUE",e.GET_VALUE="GET_VALUE",e.ADD_PROVIDER="ADD_PROVIDER",e.GET_PROVIDERS="GET_PROVIDERS",e.FIND_NODE="FIND_NODE",e.PING="PING"}(eD||(eD={})),function(e){e[e.PUT_VALUE=0]="PUT_VALUE",e[e.GET_VALUE=1]="GET_VALUE",e[e.ADD_PROVIDER=2]="ADD_PROVIDER",e[e.GET_PROVIDERS=3]="GET_PROVIDERS",e[e.FIND_NODE=4]="FIND_NODE",e[e.PING=5]="PING"}(eN||(eN={})),function(e){e.codec=()=>r$(eN)}(eD||(eD={})),function(e){e.NOT_CONNECTED="NOT_CONNECTED",e.CONNECTED="CONNECTED",e.CAN_CONNECT="CAN_CONNECT",e.CANNOT_CONNECT="CANNOT_CONNECT"}(eM||(eM={})),function(e){e[e.NOT_CONNECTED=0]="NOT_CONNECTED",e[e.CONNECTED=1]="CONNECTED",e[e.CAN_CONNECT=2]="CAN_CONNECT",e[e.CANNOT_CONNECT=3]="CANNOT_CONNECT"}(eB||(eB={})),function(e){e.codec=()=>r$(eB)}(eM||(eM={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.id&&e.id.byteLength>0&&(t.uint32(10),t.bytes(e.id)),null!=e.multiaddrs)for(let r of e.multiaddrs)t.uint32(18),t.bytes(r);null!=e.connection&&(t.uint32(24),eM.codec().encode(e.connection,t)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={id:(0,to.c)(0),multiaddrs:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.id=e.bytes();break;case 2:if(r.limits?.multiaddrs!=null&&n.multiaddrs.length===r.limits.multiaddrs)throw new rz('Decode error - map field "multiaddrs" had too many elements');n.multiaddrs.push(e.bytes());break;case 3:n.connection=eM.codec().decode(e);break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(eO||(eO={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.type&&0!==eN[e.type]&&(t.uint32(8),eD.codec().encode(e.type,t)),null!=e.clusterLevel&&(t.uint32(80),t.int32(e.clusterLevel)),null!=e.key&&(t.uint32(18),t.bytes(e.key)),null!=e.record&&(t.uint32(26),t.bytes(e.record)),null!=e.closer)for(let r of e.closer)t.uint32(66),eO.codec().encode(r,t);if(null!=e.providers)for(let r of e.providers)t.uint32(74),eO.codec().encode(r,t);!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={type:eD.PUT_VALUE,closer:[],providers:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.type=eD.codec().decode(e);break;case 10:n.clusterLevel=e.int32();break;case 2:n.key=e.bytes();break;case 3:n.record=e.bytes();break;case 8:if(r.limits?.closer!=null&&n.closer.length===r.limits.closer)throw new rz('Decode error - map field "closer" had too many elements');n.closer.push(eO.codec().decode(e,e.uint32(),{limits:r.limits?.closer$}));break;case 9:if(r.limits?.providers!=null&&n.providers.length===r.limits.providers)throw new rz('Decode error - map field "providers" had too many elements');n.providers.push(eO.codec().decode(e,e.uint32(),{limits:r.limits?.providers$}));break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(eL||(eL={}));let Pj={pk:function(e,t){return 0}};async function PH(e,t){let r=t.key,n=(0,uC.d)(r).split("/");if(n.length<3)return;let i=e[n[1].toString()];if(null==i)throw new cy(`No validator available for key type "${n[1]}"`);await i(r,t.value)}let P$={pk:async(e,t)=>{if(!(e instanceof Uint8Array))throw new cy('"key" must be a Uint8Array');if(e.byteLength<5)throw new cy("Invalid public key record");if("/pk/"!==(0,uC.d)(e.subarray(0,4)))throw new cy("key was not prefixed with /pk/");let r=p2(t);if(!tc(e.slice(4),r.toMultihash().bytes))throw new cy("public key does not match passed in key")}},Pq=(0,rx.s)("/pk/");function Pz(e){return{...e,multiaddrs:e.multiaddrs.filter(e=>{let[[t,r]]=e.stringTuples();if(53===t||54===t||55===t)return"localhost"!==r;if(4!==t&&6!==t||null==r)return!1;let n=mr(r);return null==n||!n})}}async function PV(e){return(await rX.sha256.digest(e)).digest}async function PG(e){return PV(e.toMultihash().bytes)}function PK(e,t){return new va.U(`${e}/${(0,uC.d)(t,"base32")}`,!1)}function PW(e){return tl([Pq,e.toMultihash().bytes])}function PQ(e){return"/pk/"===(0,uC.d)(e.subarray(0,4))}function PJ(e){return gm(o0.decode(e.subarray(4)))}function PZ(e,t){return new PI(e,t,new Date).serialize()}let PY=290,PX=54,P0=55,P1=56,P2=4,P3=41;function P4(e){let t=e.stringTuples();for(let e of t)if(e[0]===PY)return!1;if(t[0][0]===PX||t[0][0]===P0||t[0][0]===P1)return!0;if(t[0][0]===P2||t[0][0]===P3){let e=mr(`${t[0][1]}`);return null==e||!e}return!1}function P5(e){let t=e.toString().split("/"),r=t.pop(),n=t.pop();if(null==r||null==n)throw Error(`incorrectly formatted provider entry key in datastore: ${e.toString()}`);return{cid:tm.TO.createV1(rZ.code,o0.decode((0,rx.s)(n,"base32"))),peerId:gf(r)}}function P6(e,t,r){let n=[e,"string"==typeof t?t:(0,uC.d)(t.multihash.bytes,"base32")];return null!=r&&n.push(r.toString()),new va.U(n.join("/"))}function P8(e){return new Date(rt(e))}function P7(e,t,r){return async function*(...n){let i=t.queryTime?.timer(r),s=t.errorTime?.timer(r),o=!1;try{t.queries?.increment({[r]:!0}),yield*e(...n)}catch(e){throw o=!0,s?.(),t.errors?.increment({[r]:!0}),e}finally{t.queries?.decrement({[r]:!0}),o||i?.()}}}function P9(e,t,r){return async function(...n){let i=t?.queryTime?.timer(r),s=t?.errorTime?.timer(r),o=!1;try{return t.queries?.increment({[r]:!0}),await e(...n)}catch(e){throw o=!0,s?.(),t.errors?.increment({[r]:!0}),e}finally{t.queries?.decrement({[r]:!0}),o||i?.()}}}class Re{log;components;validators;selectors;peerRouting;queryManager;network;datastorePrefix;constructor(e,t){let{validators:r,selectors:n,peerRouting:i,queryManager:s,network:o,logPrefix:a}=t;this.components=e,this.log=e.logger.forComponent(`${a}:content-fetching`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=r,this.selectors=n,this.peerRouting=i,this.queryManager=s,this.network=o,this.get=e.metrics?.traceFunction("libp2p.kadDHT.get",this.get.bind(this),{optionsIndex:1})??this.get,this.put=e.metrics?.traceFunction("libp2p.kadDHT.put",this.put.bind(this),{optionsIndex:2})??this.put}async getLocal(e){this.log("getLocal %b",e);let t=PK(this.datastorePrefix,e);this.log("fetching record for key %k",t);let r=await this.components.datastore.get(t);this.log("found %k in local datastore",t);let n=PI.deserialize(r);return await PH(this.validators,n),n}async *sendCorrectionRecord(e,t,r,n={}){this.log("sendCorrection for %b",e);let i=PZ(e,r);for(let{value:s,from:o}of t){if(tc(s,r)){this.log("record was ok");continue}if(this.components.peerId.equals(o)){try{let t=PK(this.datastorePrefix,e);this.log(`Storing corrected record for key ${t.toString()}`),await this.components.datastore.put(t,i.subarray())}catch(e){this.log.error("Failed error correcting self",e)}continue}let t=!1,a={type:eD.PUT_VALUE,key:e,record:i};for await(let e of this.network.sendRequest(o,a,n))"PEER_RESPONSE"===e.name&&null!=e.record&&tc(e.record.value,PI.deserialize(i).value)&&(t=!0),yield e;t||(yield PB({from:o,error:new PT("Value not put correctly")},n)),this.log.error("Failed error correcting entry")}}async *put(e,t,r={}){this.log("put key %b value %b",e,t);let n=PZ(e,t),i=PK(this.datastorePrefix,e);this.log(`storing record for key ${i.toString()}`),await this.components.datastore.put(i,n.subarray()),yield*(0,ac.F)(this.peerRouting.getClosestPeers(e,{...r,signal:r.signal}),t=>(0,as.A)(t,t=>async()=>{if("FINAL_PEER"!==t.name)return[t];let i=[],s={type:eD.PUT_VALUE,key:e,record:n};for await(let e of(this.log("send put to %p",t.peer.id),this.network.sendRequest(t.peer.id,s,r)))i.push(e),"PEER_RESPONSE"===e.name&&(null!=e.record&&tc(e.record.value,PI.deserialize(n).value)||i.push(PB({from:t.peer.id,error:new PT("Value not put correctly")},r)));return i}),e=>al(e,{ordered:!1,concurrency:Py}),async function*(e){for await(let t of e)yield*t})}async *get(e,t={}){this.log("get %b",e);let r=[];for await(let n of this.getMany(e,t))"VALUE"===n.name&&r.push(n),yield n;if(0===r.length)return;let n=r.map(e=>e.value),i=0;try{i=PU(this.selectors,e,n)}catch(e){if("InvalidParametersError"!==e.name)throw e}let s=n[i];if(this.log("GetValue %b %b",e,s),null==s)throw new c_("Best value was not found");yield*this.sendCorrectionRecord(e,r,s,t),yield r[i]}async *getMany(e,t={}){this.log("getMany values for %b",e);try{let r=await this.getLocal(e);yield PL({value:r.value,from:this.components.peerId},t)}catch(t){this.log("error getting local value for %b",e,t)}let r=this,n=async function*({peer:n,signal:i}){for await(let s of r.peerRouting.getValueOrPeers(n,e,{...t,signal:i}))yield s,"PEER_RESPONSE"===s.name&&null!=s.record&&(yield PL({from:n,value:s.record.value},t))};yield*this.queryManager.run(e,n,t)}}function Rt(e,t){return{id:e.id.toMultihash().bytes,multiaddrs:(e.multiaddrs??[]).map(e=>e.bytes),connection:t}}function Rr(e){if(null==e.id)throw Error("Invalid peer in message");return{id:gm(o0.decode(e.id)),multiaddrs:(e.multiaddrs??[]).map(e=>yz(e))}}class Rn{log;components;network;peerRouting;queryManager;routingTable;providers;constructor(e,t){let{network:r,peerRouting:n,queryManager:i,routingTable:s,providers:o,logPrefix:a}=t;this.components=e,this.log=e.logger.forComponent(`${a}:content-routing`),this.network=r,this.peerRouting=n,this.queryManager=i,this.routingTable=s,this.providers=o,this.findProviders=e.metrics?.traceFunction("libp2p.kadDHT.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(e,t)=>("PROVIDER"===e.name&&(t.providers??=[],t.providers.push(...e.providers.map(e=>e.id.toString()))),t)})??this.findProviders,this.provide=e.metrics?.traceFunction("libp2p.kadDHT.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(e,t)=>("PEER_RESPONSE"===e.name&&"ADD_PROVIDER"===e.messageName&&(t.providers??=[],t.providers.push(e.from.toString())),t)})??this.provide}async *provide(e,t,r={}){this.log("provide %s",e);let n=e.multihash.bytes;await this.providers.addProvider(e,this.components.peerId);let i={type:eD.ADD_PROVIDER,key:n,providers:[Rt({id:this.components.peerId,multiaddrs:t})]},s=0,o=t=>async()=>{if("FINAL_PEER"!==t.name)return[t];let n=[];this.log("putProvider %s to %p",e,t.peer.id);try{for await(let o of(this.log("sending provider record for %s to %p",e,t.peer.id),this.network.sendMessage(t.peer.id,i,r)))"PEER_RESPONSE"===o.name&&(this.log("sent provider record for %s to %p",e,t.peer.id),s++),n.push(o)}catch(e){this.log.error("error sending provide record to peer %p",t.peer.id,e),n.push(PB({from:t.peer.id,error:e},r))}return n};yield*(0,ac.F)(this.peerRouting.getClosestPeers(n,r),e=>(0,as.A)(e,e=>o(e)),e=>al(e,{ordered:!1,concurrency:Py}),async function*(e){for await(let t of e)yield*t}),this.log("sent provider records to %d peers",s)}async *findProviders(e,t){let r=this.routingTable.kBucketSize,n=0,i=e.multihash.bytes,s=this;this.log("findProviders %c",e);let o=await this.providers.getProviders(e);if(o.length>0){let e=[];for(let t of o.slice(0,r))try{let r=await this.components.peerStore.get(t);e.push({id:t,multiaddrs:r.addresses.map(({multiaddr:e})=>e)})}catch(e){if("NotFoundError"!==e.name)throw e;this.log("no peer store entry for %p",t)}if(yield PN({from:this.components.peerId,messageType:eD.GET_PROVIDERS,providers:e},t),yield PO({from:this.components.peerId,providers:e},t),(n+=e.length)>=r)return}let a=async function*({peer:e,signal:r}){let n={type:eD.GET_PROVIDERS,key:i};yield*s.network.sendRequest(e,n,{...t,signal:r})},l=new Ab(o);for await(let s of this.queryManager.run(i,a,t))if(yield s,"PEER_RESPONSE"===s.name){this.log("Found %d provider entries for %c and %d closer peers",s.providers.length,e,s.closer.length);let i=[];for(let e of s.providers)l.has(e.id)||(l.add(e.id),i.push(e));if(i.length>0&&(yield PO({from:s.from,providers:i},t),(n+=i.length)>=r))return}}}class Ri extends cf{log;protocol;running;components;timeout;metrics;constructor(e,t){super(),this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:network`),this.running=!1,this.protocol=t.protocol,this.timeout=new Sj({...t.timeout??{},metrics:e.metrics,metricName:`${t.metricsPrefix}_network_message_send_times_milliseconds`}),this.metrics={operations:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_outbound_rpc_requests_total`),errors:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_outbound_rpc_errors_total`)},this.sendRequest=e.metrics?.traceFunction("libp2p.kadDHT.sendRequest",this.sendRequest.bind(this),{optionsIndex:2,getAttributesFromArgs:([e,t],r)=>({...r,to:e.toString(),"message type":`${t.type}`}),getAttributesFromYieldedValue:(e,t)=>("PEER_RESPONSE"===e.name&&(e.providers.length>0&&e.providers.forEach((e,r)=>{t[`providers-${r}`]=e.id.toString()}),e.closer.length>0&&e.closer.forEach((e,r)=>{t[`closer-${r}`]=e.id.toString()})),t)})??this.sendRequest,this.sendMessage=e.metrics?.traceFunction("libp2p.kadDHT.sendMessage",this.sendMessage.bind(this),{optionsIndex:2,getAttributesFromArgs:([e,t],r)=>({...r,to:e.toString(),"message type":`${t.type}`}),getAttributesFromYieldedValue:(e,t)=>("PEER_RESPONSE"===e.name&&(e.providers.length>0&&e.providers.forEach((e,r)=>{t[`providers-${r}`]=e.id.toString()}),e.closer.length>0&&e.closer.forEach((e,r)=>{t[`closer-${r}`]=e.id.toString()})),t)})??this.sendMessage}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async *sendRequest(e,t,r={}){let n;if(!this.running)return;let i=t.type;if(null==i)throw new cy("Message type was missing");this.log("sending %s to %p",t.type,e),yield PF({peer:e},r),yield PD({to:e,type:i},r);let s=this.timeout.getTimeoutSignal(r);r={...r,signal:s};try{this.metrics.operations?.increment({[i]:!0});let s=await this.components.connectionManager.openConnection(e,r);n=await s.newStream(this.protocol,r);let o=await this._writeReadMessage(n,t,r);n.close(r).catch(t=>{this.log.error("error closing stream to %p",e,t),n?.abort(t)}),yield PN({from:e,messageType:o.type,closer:o.closer.map(Rr),providers:o.providers.map(Rr),record:null==o.record?void 0:PI.deserialize(o.record)},r)}catch(s){this.metrics.errors?.increment({[i]:!0}),n?.abort(s),r.signal?.aborted!==!0&&this.log.error("could not send %s to %p - %e",t.type,e,s),yield PB({from:e,error:s},r)}finally{this.timeout.cleanUp(s)}}async *sendMessage(e,t,r={}){let n;if(!this.running)return;let i=t.type;if(null==i)throw new cy("Message type was missing");this.log("sending %s to %p",t.type,e),yield PF({peer:e},r),yield PD({to:e,type:i},r);let s=this.timeout.getTimeoutSignal(r);r={...r,signal:s};try{this.metrics.operations?.increment({[i]:!0});let s=await this.components.connectionManager.openConnection(e,r);n=await s.newStream(this.protocol,r),await this._writeMessage(n,t,r),n.close(r).catch(t=>{this.log.error("error closing stream to %p",e,t),n?.abort(t)}),yield PN({from:e,messageType:i},r)}catch(t){this.metrics.errors?.increment({[i]:!0}),n?.abort(t),yield PB({from:e,error:t},r)}finally{this.timeout.cleanUp(s)}}async _writeMessage(e,t,r){let n=TC(e);await n.write(t,eL,r)}async _writeReadMessage(e,t,r){let n=TC(e);await n.write(t,eL,r);let i=await n.read(eL,r);return i.closer.forEach(e=>{this.safeDispatchEvent("peer",{detail:Rr(e)})}),i.providers.forEach(e=>{this.safeDispatchEvent("peer",{detail:Rr(e)})}),i}}function Rs(e,t){if(e.length!==t.length)throw Error("Inputs should have the same length");let r=(0,to.K)(e.length);for(let n=0;n<e.length;n++)r[n]=e[n]^t[n];return ta(r)}function Ro(e,t){if(e.byteLength!==t.byteLength)throw Error("Inputs should have the same length");for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}class Ra{originDhtKey;capacity;peerDistances;constructor(e,t){this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(e=>e.peer)}async add(e){let t=await PG(e.id);this.addWithKadId(e,t)}addWithKadId(e,t){if(null!=this.peerDistances.find(t=>t.peer.id.equals(e.id)))return;let r={peer:e,distance:Rs(this.originDhtKey,t)},n=!1;for(let e=0;e<this.peerDistances.length;e++){let t=Ro(this.peerDistances[e].distance,r.distance);if(0===t||1===t){n=!0,this.peerDistances.splice(e,0,r);break}}n||this.peerDistances.push(r),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async isCloser(e){return 0===this.length||-1===Ro(Rs(await PG(e),this.originDhtKey),this.peerDistances[this.peerDistances.length-1].distance)}async anyCloser(e){return 0!==e.length&&Promise.any(e.map(async e=>this.isCloser(e)))}}class Rl{log;routingTable;network;validators;queryManager;peerStore;peerId;constructor(e,t){this.routingTable=t.routingTable,this.network=t.network,this.validators=t.validators,this.queryManager=t.queryManager,this.peerStore=e.peerStore,this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:peer-routing`),this.findPeer=e.metrics?.traceFunction("libp2p.kadDHT.findPeer",this.findPeer.bind(this),{optionsIndex:1})??this.findPeer,this.getClosestPeers=e.metrics?.traceFunction("libp2p.kadDHT.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1})??this.getClosestPeers}async findPeerLocal(e){let t,r=await this.routingTable.find(e);if(null!=r){this.log("findPeerLocal found %p in routing table",e);try{t=await this.peerStore.get(r)}catch(e){if("NotFoundError"!==e.name)throw e}}if(null==t)try{t=await this.peerStore.get(e)}catch(e){if("NotFoundError"!==e.name)throw e}if(null!=t)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map(e=>e.multiaddr)}}async *_getValueSingle(e,t,r={}){let n={type:eD.GET_VALUE,key:t};yield*this.network.sendRequest(e,n,r)}async *getPublicKeyFromNode(e,t={}){let r=PW(e);for await(let n of this._getValueSingle(e,r,t))if(yield n,"PEER_RESPONSE"===n.name&&null!=n.record){let r=gp(p2(n.record.value));if(!r.equals(e))throw new cb("public key does not match id");if(null==r.publicKey)throw new cb("public key missing");yield PL({from:e,value:n.record.value},t)}throw new PT(`Node not responding with its public key: ${e.toString()}`)}async *findPeer(e,t={}){if(this.log("findPeer %p",e),!1!==t.useCache){let r=await this.findPeerLocal(e);if(null!=r){this.log("found local"),yield PM({from:this.peerId,peer:r},t);return}}let r=!1;if(!1!==t.useNetwork){let n=this,i=async function*({peer:r,signal:i}){let s={type:eD.FIND_NODE,key:e.toMultihash().bytes};for await(let o of n.network.sendRequest(r,s,{...t,signal:i}))if(yield o,"PEER_RESPONSE"===o.name){let r=o.closer.find(t=>t.id.equals(e));null!=r&&(yield PM({from:o.from,peer:r},t))}};for await(let n of this.queryManager.run(e.toMultihash().bytes,i,t))"FINAL_PEER"===n.name&&(r=!0),yield n}r||(yield PB({from:this.peerId,error:new c_("Not found")},t))}async *getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);let r=await PV(e),n=this.routingTable.closestPeers(r),i=this,s=new Ra(r,this.routingTable.kBucketSize);await Promise.all(n.map(async e=>{await s.add({id:e,multiaddrs:[]})}));let o=async function*({peer:r,signal:n}){i.log("closerPeersSingle %s from %p",(0,uC.d)(e,"base32"),r);let s={type:eD.FIND_NODE,key:e};yield*i.network.sendRequest(r,s,{...t,signal:n})};for await(let r of this.queryManager.run(e,o,t))"PEER_RESPONSE"===r.name&&await Promise.all(r.closer.map(async e=>{await s.add(e)})),yield r;for(let r of(this.log("found %d peers close to %b",s.length,e),s.peers))yield PM({from:this.peerId,peer:r},t)}async *getValueOrPeers(e,t,r={}){for await(let n of this._getValueSingle(e,t,r)){if("PEER_RESPONSE"===n.name&&null!=n.record)try{await this._verifyRecordOnline(n.record)}catch(t){let e="invalid record received, discarded";this.log(e),yield PB({from:n.from,error:new PT(e)},r);continue}yield n}}async _verifyRecordOnline(e){if(null==e.timeReceived)throw new PP("invalid record received");await PH(this.validators,new PI(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){let r=[];try{let t=o0.decode(e),n=gm(t),i=await this.peerStore.get(n);r.push({id:i.id,multiaddrs:i.addresses.map(({multiaddr:e})=>e)})}catch{}let n=await PV(e),i=this.routingTable.closestPeers(n),s=Rs(await PG(t),n);for(let e of i)if(-1===Ro(Rs(await PG(e),n),s))try{let t=await this.peerStore.get(e);r.push({id:e,multiaddrs:t.addresses.map(({multiaddr:e})=>e)})}catch(e){if("NotFoundError"!==e.name)throw e}return r.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",r.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p with %d peers in the routing table",e,t,this.routingTable.size),r}}class Rc{log;datastore;datastorePrefix;lock;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:providers`),this.datastorePrefix=`${t.datastorePrefix}/provider`,this.datastore=e.datastore,this.lock=t.lock}async addProvider(e,t){let r=await this.lock.readLock();try{this.log("%p provides %s",t,e),await this.writeProviderEntry(e,t)}finally{r()}}async removeProvider(e,t){let r=await this.lock.writeLock();try{let r=P6(this.datastorePrefix,e,t);this.log("%p no longer provides %s",t,e),await this.datastore.delete(r)}finally{r()}}async getProviders(e){let t=await this.lock.readLock();try{this.log("get providers for %c",e);let t=await this.loadProviders(e);return this.log("got %d providers for %c",t.size,e),[...t.keys()]}finally{t()}}async writeProviderEntry(e,t,r=new Date){let n=P6(this.datastorePrefix,e,t),i=re(r.getTime());await this.datastore.put(n,i)}async loadProviders(e){let t=new gA,r=P6(this.datastorePrefix,e);for await(let e of this.datastore.query({prefix:r.toString()})){let{peerId:r}=P5(e.key);t.set(r,P8(e.value))}return t}}async function*Ru(e){let{key:t,startingPeer:r,ourPeerId:n,signal:i,query:s,alpha:o,pathIndex:a,numPaths:l,queryFuncTimeout:c,log:u,peersSeen:d,connectionManager:h}=e,f=new cJ({concurrency:o,sort:(e,t)=>Ro(e.options.distance,t.options.distance)}),p=await PV(t);function g(r,o){if(null==r)return;d.add(r);let m=Rs(o,p);f.add(async()=>{let o=[i];null!=c&&o.push(AbortSignal.timeout(c));let y=ch(o);try{for await(let i of s({...e,key:t,peer:r,signal:y,pathIndex:a,numPaths:l})){if(y.aborted)return;if("PEER_RESPONSE"===i.name)for(let e of i.closer){if(d.has(e.id)){u.trace("already seen %p in query",e.id);continue}if(n.equals(e.id)){u("not querying ourselves");continue}if(!await h.isDialable(e.multiaddrs)){u("not querying undialable peer");continue}let i=await PG(e.id),s=Rs(i,p);if(-1!==Ro(s,m)){u.trace("skipping %p as they are not closer to %b than %p",e.id,t,r);continue}u.trace("querying closer peer %p",e.id),g(e.id,i)}f.safeDispatchEvent("completed",{detail:i})}}catch(t){if(!i.aborted)return PB({from:r,error:t},e)}finally{y.clear()}},{distance:m}).catch(e=>{u.error(e)})}g(r,await PG(r));try{for await(let e of f.toGenerator({signal:i}))null!=e&&(yield e)}catch(e){if(i.aborted)throw new PC("Query aborted");throw e}}class Rd{disjointPaths;alpha;shutDownController;running;logger;peerId;connectionManager;routingTable;initialQuerySelfHasRun;logPrefix;constructor(e,t){this.logPrefix=t.logPrefix,this.disjointPaths=t.disjointPaths??Pm,this.alpha=t.alpha??Py,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.logger=e.logger,this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.shutDownController=new AbortController,this.shutDownController.signal,this.running=!1}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.shutDownController=new AbortController,this.shutDownController.signal)}async stop(){this.running=!1,this.shutDownController.abort()}async *run(e,t,r={}){if(!this.running)throw Error("QueryManager not started");if(null==r.signal){let e=AbortSignal.timeout(Px);r={...r,signal:e}}let n=new AbortController,i=ch([this.shutDownController.signal,n.signal,r.signal]);n.signal;let s=this.logger.forComponent(`${this.logPrefix}:query:`+(0,uC.d)(e,"base58btc")),o=!1;try{!0!==r.isSelfQuery&&null!=this.initialQuerySelfHasRun&&(s("waiting for initial query-self query before continuing"),await (0,cG.W)(this.initialQuerySelfHasRun.promise,i),this.initialQuerySelfHasRun=void 0),s("query:start");let n=await PV(e),a=this.routingTable.closestPeers(n),l=a.slice(0,Math.min(this.disjointPaths,a.length));if(0===a.length)return void s.error("Running query with no peers");let c=new Ab,u=l.map((n,o)=>Ru({...r,key:e,startingPeer:n,ourPeerId:this.peerId,signal:i,query:t,pathIndex:o,numPaths:l.length,alpha:this.alpha,queryFuncTimeout:r.queryFuncTimeout,log:s,peersSeen:c,onProgress:r.onProgress,connectionManager:this.connectionManager}));for await(let e of(0,wa.A)(...u)){if("QUERY_ERROR"===e.name&&s.error("query error",e.error),"PEER_RESPONSE"===e.name)for(let t of[...e.closer,...e.providers])await this.connectionManager.isDialable(t.multiaddrs)&&await this.routingTable.add(t.id);yield e}o=!0}catch(e){if(this.running||"QueryAbortedError"!==e.name)throw e}finally{o||(s("query exited early"),n.abort()),i.clear(),s("query:done")}}}function Rh(e){return null!=e[Symbol.asyncIterator]}let Rf=function(e){if(Rh(e))return(async()=>{let t=0;for await(let r of e)t++;return t})();{let t=0;for(let r of e)t++;return t}},Rp=e=>{let t=e.addEventListener||e.on||e.addListener,r=e.removeEventListener||e.off||e.removeListener;if(!t||!r)throw TypeError("Emitter is not compatible");return{addListener:t.bind(e),removeListener:r.bind(e)}};function Rg(e,t,r){let n,i=new Promise((i,s)=>{if(!((r={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...r}).count>=0&&(r.count===Number.POSITIVE_INFINITY||Number.isInteger(r.count))))throw TypeError("The `count` option should be at least 0 or more");r.signal?.throwIfAborted();let o=[t].flat(),a=[],{addListener:l,removeListener:c}=Rp(e),u=(...e)=>{let t=r.multiArgs?e:e[0];(!r.filter||r.filter(t))&&(a.push(t),r.count===a.length&&(n(),i(a)))},d=e=>{n(),s(e)};for(let e of(n=()=>{for(let e of o)c(e,u);for(let e of r.rejectionEvents)c(e,d)},o))l(e,u);for(let e of r.rejectionEvents)l(e,d);r.signal&&r.signal.addEventListener("abort",()=>{d(r.signal.reason)},{once:!0}),r.resolveImmediately&&i(a)});if(i.cancel=n,"number"==typeof r.timeout){let e=ay(i,{milliseconds:r.timeout});return e.cancel=n,e}return i}function Rm(e,t,r){"function"==typeof r&&(r={filter:r});let n=Rg(e,t,r={...r,count:1,resolveImmediately:!1}),i=n.then(e=>e[0]);return i.cancel=n.cancel,i}class Ry{log;peerId;peerRouting;routingTable;count;interval;initialInterval;queryTimeout;running;timeoutId;controller;initialQuerySelfHasRun;querySelfPromise;constructor(e,t){this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:query-self`),this.running=!1,this.peerRouting=t.peerRouting,this.routingTable=t.routingTable,this.count=t.count??Pm,this.interval=t.interval??Pb,this.initialInterval=t.initialInterval??Pw,this.queryTimeout=t.queryTimeout??Pv,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.querySelf=P9(this.querySelf.bind(this),t.operationMetrics,"SELF_QUERY")}isStarted(){return this.running}start(){this.running||(this.running=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.initialInterval))}stop(){this.running=!1,null!=this.timeoutId&&clearTimeout(this.timeoutId),null!=this.controller&&this.controller.abort()}async querySelf(){if(!this.running)return void this.log("skip self-query because we are not started");if(null!=this.querySelfPromise)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=(0,ao.A)(),this.running){this.controller=new AbortController;let e=[this.controller.signal];if(null==this.initialQuerySelfHasRun){let t=AbortSignal.timeout(this.queryTimeout);e.push(t)}let t=ch(e);this.controller.signal;try{0===this.routingTable.size&&(this.log("routing table was empty, waiting for some peers before running query"),await Rm(this.routingTable,"peer:add",{signal:t,filter:e=>!this.peerId.equals(e.detail)}),this.log("routing table has peers, continuing with query")),this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);let e=Date.now(),r=await (0,ac.F)(this.peerRouting.getClosestPeers(this.peerId.toMultihash().bytes,{signal:t,isSelfQuery:!0}),e=>(0,ut.A)(e,this.count),async e=>Rf(e));this.log("self-query found %d peers in %dms",r,Date.now()-e)}catch(e){this.log.error("self-query error",e)}finally{t.clear(),null!=this.initialQuerySelfHasRun&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.running&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.interval))}}class Rb extends cf{log;reprovideQueue;maxQueueSize;datastore;timeout;reprovideTimeout;running;shutdownController;reprovideThreshold;contentRouting;datastorePrefix;addressManager;validity;interval;lock;peerId;constructor(e,t){super(),this.log=e.logger.forComponent(`${t.logPrefix}:reprovider`),this.peerId=e.peerId,this.reprovideQueue=new cJ({concurrency:t.concurrency??Pf,metrics:e.metrics,metricName:`${t.metricsPrefix}_reprovide_queue`}),this.reprovideTimeout=new Sj({...t.timeout??{},metrics:e.metrics,metricName:`${t.metricsPrefix}_reprovide_timeout_milliseconds`}),this.datastore=e.datastore,this.addressManager=e.addressManager,this.datastorePrefix=`${t.datastorePrefix}/provider`,this.reprovideThreshold=t.threshold??Ph,this.maxQueueSize=t.maxQueueSize??Pp,this.validity=t.validity??Pd,this.interval=t.interval??Pg,this.contentRouting=t.contentRouting,this.lock=t.lock,this.running=!1,this.reprovide=P9(this.reprovide.bind(this),t.operationMetrics,"PROVIDE")}start(){this.running||(this.running=!0,this.shutdownController=new AbortController,this.shutdownController.signal,this.timeout=setTimeout(()=>{this.cleanUp().catch(e=>{this.log.error("error running reprovide/cleanup - %e",e)})},this.interval))}stop(){this.running=!1,this.reprovideQueue.clear(),clearTimeout(this.timeout),this.shutdownController?.abort()}async cleanUp(){let e=await this.lock.writeLock();try{for await(let e of(this.safeDispatchEvent("reprovide:start"),this.datastore.query({prefix:this.datastorePrefix})))try{let{cid:t,peerId:r}=P5(e.key),n=P8(e.value).getTime(),i=n+this.validity,s=Date.now(),o=s>i;this.log.trace("comparing: %d < %d = %s %s",n,s-this.validity,o,o?"(expired)":""),o&&await this.datastore.delete(e.key),this.peerId.equals(r)&&s-i<this.reprovideThreshold&&this.queueReprovide(t).catch(e=>{this.log.error("could not reprovide %c - %e",t,e)})}catch(t){this.log.error("error processing datastore key %s - %e",e.key,t.message)}this.log("reprovide/cleanup successful")}finally{e(),this.safeDispatchEvent("reprovide:end"),this.running&&(this.timeout=setTimeout(()=>{this.cleanUp().catch(e=>{this.log.error("error running re-provide - %e",e)})},this.interval))}}async queueReprovide(e){if(!this.running)return;this.log.trace("waiting for queue capacity before adding %c to re-provide queue",e),await this.reprovideQueue.onSizeLessThan(this.maxQueueSize);let t=this.reprovideQueue.queue.find(t=>t.options.cid.equals(e));if(null!=t)return this.log.trace("not adding %c to re-provide queue - already in queue",e),t.join();this.log.trace("adding %c to re-provide queue",e),this.reprovideQueue.add(async t=>{if(t.signal?.throwIfAborted(),!this.running)return;this.log.trace("re-providing %c",e);let r=this.reprovideTimeout.getTimeoutSignal(t);try{await this.reprovide(t.cid,t)}finally{this.reprovideTimeout.cleanUp(r)}this.log.trace("re-provided %c",e)},{signal:this.shutdownController?.signal,cid:e}).catch(t=>{this.log.error("could not re-provide key %c - %e",e,t)})}async reprovide(e,t){await (0,cY.A)(this.contentRouting.provide(e,this.addressManager.getAddresses(),t))}}let Rw=20,Rv=5e3,RE="kad-close",RA=50;class Rx{routingTable;components;closestPeers;newPeers;refreshInterval;peerSetSize;timeout;closeTagName;closeTagValue;log;running;constructor(e,t){this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.routingTable=t.routingTable,this.refreshInterval=t.refreshInterval??Rv,this.peerSetSize=t.peerSetSize??Rw,this.closeTagName=t.closeTagName??RE,this.closeTagValue=t.closeTagValue??RA,this.closestPeers=new Ab,this.onPeerPing=this.onPeerPing.bind(this),this.running=!1}async start(){if(this.running)return;this.running=!0;let e=await PG(this.components.peerId);this.newPeers=new Ra(e,this.peerSetSize),this.routingTable.addEventListener("peer:ping",this.onPeerPing),this.timeout=setInterval(()=>{this.updatePeerTags().catch(e=>{this.log.error("error updating peer tags - %e",e)})},this.refreshInterval)}stop(){this.running=!1,this.routingTable.removeEventListener("peer:ping",this.onPeerPing),clearTimeout(this.timeout)}onPeerPing(e){this.newPeers?.add({id:e.detail,multiaddrs:[]}).catch(e=>{this.log.error("error adding peer to distance list - %e",e)})}async updatePeerTags(){let e=new Ab(this.newPeers?.peers.map(e=>e.id)),t=e.difference(this.closestPeers),r=this.closestPeers.difference(e);this.closestPeers=e,await Promise.all([...[...t].map(async e=>{await this.components.peerStore.merge(e,{tags:{[this.closeTagName]:{value:this.closeTagValue},[PS]:{value:1}}})}),...[...r].map(async e=>{await this.components.peerStore.merge(e,{tags:{[this.closeTagName]:void 0,[PS]:void 0}})})])}}function RS(e){return Array.isArray(e?.peers)}class Rk{root;localPeer;prefixLength;splitThreshold;kBucketSize;numberOfNodesToPing;lastPingThreshold;ping;verify;onAdd;onRemove;onMove;addingPeerMap;constructor(e){this.prefixLength=e.prefixLength??RC,this.kBucketSize=e.kBucketSize??RT,this.splitThreshold=e.splitThreshold??this.kBucketSize,this.numberOfNodesToPing=e.numberOfOldContactsToPing??RD,this.lastPingThreshold=e.lastPingThreshold??RL,this.ping=e.ping,this.verify=e.verify,this.onAdd=e.onAdd,this.onRemove=e.onRemove,this.addingPeerMap=new gA,this.root={prefix:"",depth:0,peers:[]}}async addSelfPeer(e){this.localPeer={peerId:e,kadId:await PG(e),lastPing:Date.now()}}async add(e,t){let r={peerId:e,kadId:await PG(e),lastPing:0},n=this.addingPeerMap.get(e);if(null!=n)return n;try{let n=this._add(r,t);this.addingPeerMap.set(e,n),await n}finally{this.addingPeerMap.delete(e)}}async _add(e,t){let r=this._determineBucket(e.kadId);if(this._indexOf(r,e.kadId)>-1)return;if(r.peers.length===this.splitThreshold&&r.depth<this.prefixLength){await this._split(r),await this._add(e,t);return}if(r.peers.length<this.kBucketSize){if(!RI(e,this.lastPingThreshold)){r.peers.push(e),await this.onAdd?.(e,r);return}await this.verify(e,t)&&(e.lastPing=Date.now(),await this._add(e,t));return}let n=r.peers.filter(e=>!(e.peerId.equals(this.localPeer?.peerId)||e.lastPing>Date.now()-this.lastPingThreshold)).sort((e,t)=>e.lastPing<t.lastPing?-1:+(e.lastPing>t.lastPing)).slice(0,this.numberOfNodesToPing),i=!1;for await(let e of this.ping(n,t))i=!0,await this.remove(e.kadId);i&&await this._add(e,t)}*closest(e,t=this.kBucketSize){let r=new Ra(e,t);for(let e of this.toIterable())r.addWithKadId({id:e.peerId,multiaddrs:[]},e.kadId);yield*(0,as.A)(r.peers,e=>e.id)}count(){function e(t){if(RS(t))return t.peers.length;let r=0;return null!=t.left&&(r+=e(t.left)),null!=t.right&&(r+=e(t.right)),r}return e(this.root)}get(e){let t=this._determineBucket(e),r=this._indexOf(t,e);return t.peers[r]}async remove(e){let t=this._determineBucket(e),r=this._indexOf(t,e);if(r>-1){let e=t.peers.splice(r,1)[0];await this.onRemove?.(e,t)}}*toIterable(){function*e(t){if(RS(t))return void(yield*t.peers);yield*e(t.left),yield*e(t.right)}yield*e(this.root)}distance(e,t){return BigInt("0x"+(0,uC.d)(Rs(e,t),"base16"))}_determineBucket(e){let t=(0,uC.d)(e,"base2");function r(e,n=0){return RS(e)?e:"0"===t[n]?r(e.left,n+1):r(e.right,n+1)}return r(this.root)}_indexOf(e,t){return e.peers.findIndex(e=>tc(e.kadId,t))}async _split(e){let t={prefix:"0",depth:e.depth+1,peers:[]},r={prefix:"1",depth:e.depth+1,peers:[]};for(let n of e.peers)"0"===(0,uC.d)(n.kadId,"base2")[e.depth]?(t.peers.push(n),await this.onMove?.(n,e,t)):(r.peers.push(n),await this.onMove?.(n,e,r));R_(e,t,r)}}function R_(e,t,r){return delete e.peers,e.left=t,e.right=r,""===e.prefix&&(delete e.depth,delete e.prefix),!0}function RI(e,t){return e.lastPing<Date.now()-t}let RT=20,RC=6,RP=20,RR=100,RD=3,RN=20,RM=100,RB="kad-peer",RO=1,RL=6e5,RF=!0,RU=1e3;class Rj extends cf{kBucketSize;kb;network;closestPeerTagger;log;components;running;pingNewContactTimeout;pingNewContactQueue;pingOldContactTimeout;pingOldContactQueue;populateFromDatastoreOnStart;populateFromDatastoreLimit;protocol;peerTagName;peerTagValue;metrics;constructor(e,t){super(),this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.kBucketSize=t.kBucketSize??RT,this.running=!1,this.protocol=t.protocol,this.network=t.network,this.peerTagName=t.peerTagName??RB,this.peerTagValue=t.peerTagValue??RO,this.pingOldContacts=this.pingOldContacts.bind(this),this.verifyNewContact=this.verifyNewContact.bind(this),this.peerAdded=this.peerAdded.bind(this),this.peerRemoved=this.peerRemoved.bind(this),this.populateFromDatastoreOnStart=t.populateFromDatastoreOnStart??RF,this.populateFromDatastoreLimit=t.populateFromDatastoreLimit??RU,this.pingOldContactQueue=new cZ({concurrency:t.pingOldContactConcurrency??RN,metricName:`${t.metricsPrefix}_ping_old_contact_queue`,metrics:this.components.metrics,maxSize:t.pingOldContactMaxQueueSize??RM}),this.pingOldContactTimeout=new Sj({...t.pingOldContactTimeout??{},metrics:this.components.metrics,metricName:`${t.metricsPrefix}_routing_table_ping_old_contact_time_milliseconds`}),this.pingNewContactQueue=new cZ({concurrency:t.pingNewContactConcurrency??RP,metricName:`${t.metricsPrefix}_ping_new_contact_queue`,metrics:this.components.metrics,maxSize:t.pingNewContactMaxQueueSize??RR}),this.pingNewContactTimeout=new Sj({...t.pingNewContactTimeout??{},metrics:this.components.metrics,metricName:`${t.metricsPrefix}_routing_table_ping_new_contact_time_milliseconds`}),this.kb=new Rk({kBucketSize:t.kBucketSize,prefixLength:t.prefixLength,splitThreshold:t.splitThreshold,numberOfOldContactsToPing:t.numberOfOldContactsToPing,lastPingThreshold:t.lastPingThreshold,ping:this.pingOldContacts,verify:this.verifyNewContact,onAdd:this.peerAdded,onRemove:this.peerRemoved}),this.closestPeerTagger=new Rx(this.components,{logPrefix:t.logPrefix,routingTable:this,peerSetSize:t.closestPeerSetSize,refreshInterval:t.closestPeerSetRefreshInterval,closeTagName:t.closeTagName,closeTagValue:t.closeTagValue}),null!=this.components.metrics&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_size`),routingTableKadBucketTotal:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_total`),routingTableKadBucketAverageOccupancy:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_average_occupancy`),routingTableKadBucketMinOccupancy:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_min_occupancy`),routingTableKadBucketMaxOccupancy:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_max_occupancy`),routingTableKadBucketMaxDepth:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_max_depth`),kadBucketEvents:this.components.metrics.registerCounterGroup(`${t.metricsPrefix}_kad_bucket_events_total`)})}isStarted(){return this.running}async start(){this.running||(this.running=!0,await bH(this.closestPeerTagger),await this.kb.addSelfPeer(this.components.peerId))}async afterStart(){Promise.resolve().then(async()=>{if(!this.populateFromDatastoreOnStart)return;let e=0;for(let t of(await this.components.peerStore.all({filters:[e=>e.protocols.includes(this.protocol)&&e.tags.has(RB)],limit:this.populateFromDatastoreLimit}))){if(!this.running)return;try{await this.add(t.id),e++}catch(e){this.log("failed to add peer %p to routing table, removing kad-dht peer tags - %e"),await this.components.peerStore.merge(t.id,{tags:{[this.peerTagName]:void 0}})}}this.log("added %d peer store peers to the routing table",e)}).catch(e=>{this.log.error("error adding peer store peers to the routing table %e",e)})}async stop(){this.running=!1,await b$(this.closestPeerTagger),this.pingOldContactQueue.abort(),this.pingNewContactQueue.abort()}async peerAdded(e,t){this.components.peerId.equals(e.peerId)||await this.components.peerStore.merge(e.peerId,{tags:{[this.peerTagName]:{value:this.peerTagValue}}}),this.updateMetrics(),this.metrics?.kadBucketEvents.increment({peer_added:!0}),this.safeDispatchEvent("peer:add",{detail:e.peerId})}async peerRemoved(e,t){this.components.peerId.equals(e.peerId)||await this.components.peerStore.merge(e.peerId,{tags:{[this.peerTagName]:void 0}}),this.updateMetrics(),this.metrics?.kadBucketEvents.increment({peer_removed:!0}),this.safeDispatchEvent("peer:remove",{detail:e.peerId})}async *pingOldContacts(e,t){if(!this.running)return;let r=[];for(let n of e){if(null==this.kb.get(n.kadId)){this.log("asked to ping contact %p that was not in routing table",n.peerId);continue}this.metrics?.kadBucketEvents.increment({ping_old_contact:!0}),r.push(async()=>{let e=this.pingOldContactQueue.find(n.peerId);return null!=e?(this.log("asked to ping contact %p was already being pinged",n.peerId),await e.join(t))?void 0:n:await this.pingOldContactQueue.add(async e=>{let t=this.pingOldContactTimeout.getTimeoutSignal(),r=ch([t,e?.signal]);try{return await this.pingContact(n,e)}catch{return this.metrics?.kadBucketEvents.increment({ping_old_contact_error:!0}),!0}finally{this.pingOldContactTimeout.cleanUp(t),r.clear()}},{peerId:n.peerId,signal:t?.signal})?void 0:n})}for await(let e of al(r))null!=e&&(yield e)}async verifyNewContact(e,t){let r=this.pingNewContactTimeout.getTimeoutSignal(),n=ch([r,t?.signal]);try{let t=this.pingNewContactQueue.find(e.peerId);if(null!=t)return this.log("joining existing ping to add new peer %p to routing table",e.peerId),await t.join({signal:n});return await this.pingNewContactQueue.add(async t=>(this.metrics?.kadBucketEvents.increment({ping_new_contact:!0}),this.log("pinging new peer %p before adding to routing table",e.peerId),this.pingContact(e,t)),{peerId:e.peerId,signal:n})}catch(t){return this.log.trace("tried to add peer %p but they were not online",e.peerId),this.metrics?.kadBucketEvents.increment({ping_new_contact_error:!0}),!1}finally{this.pingNewContactTimeout.cleanUp(r),n.clear()}}async pingContact(e,t){let r;try{for await(let r of(this.log("pinging contact %p",e.peerId),this.network.sendRequest(e.peerId,{type:eD.PING},t)))if(r.type===eU.PEER_RESPONSE){if(r.messageType===eD.PING)return this.log("contact %p ping ok",e.peerId),this.safeDispatchEvent("peer:ping",{detail:e.peerId}),!0;break}return!1}catch(t){return this.log("error pinging old contact %p - %e",e.peerId,t),r?.abort(t),!1}}get size(){return null==this.kb?0:this.kb.count()}async find(e){let t=await PG(e);return this.kb.get(t)?.peerId}closestPeer(e){let t=this.closestPeers(e,1);if(t.length>0)return t[0]}closestPeers(e,t=this.kBucketSize){return null==this.kb?[]:[...this.kb.closest(e,t)]}async add(e,t){if(null==this.kb)throw Error("RoutingTable is not started");await this.kb.add(e,t)}async remove(e){if(null==this.kb)throw Error("RoutingTable is not started");let t=await PG(e);await this.kb.remove(t)}updateMetrics(){if(null==this.metrics||null==this.kb)return;let e=0,t=0,r=0,n=20,i=0;function s(o){if(RS(o)){o.depth>r&&(r=o.depth),t++,e+=o.peers.length,o.peers.length<n&&(n=o.peers.length),o.peers.length>i&&(i=o.peers.length);return}s(o.left),s(o.right)}s(this.kb.root),this.metrics.routingTableSize.update(e),this.metrics.routingTableKadBucketTotal.update(t),this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(e/t)),this.metrics.routingTableKadBucketMinOccupancy.update(n),this.metrics.routingTableKadBucketMaxOccupancy.update(i),this.metrics.routingTableKadBucketMaxDepth.update(r)}}let RH=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782],R$=15;class Rq{log;peerRouting;routingTable;refreshInterval;refreshQueryTimeout;commonPrefixLengthRefreshedAt;refreshTimeoutId;constructor(e,t){let{peerRouting:r,routingTable:n,refreshInterval:i,refreshQueryTimeout:s,logPrefix:o}=t;this.log=e.logger.forComponent(`${o}:routing-table:refresh`),this.peerRouting=r,this.routingTable=n,this.refreshInterval=i??PE,this.refreshQueryTimeout=s??PA,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async afterStart(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){null!=this.refreshTimeoutId&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");let t=this._maxCommonPrefix(),r=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${r.map(e=>e.toISOString()).join(", ")} ]`),Promise.all(r.map(async(n,i)=>{try{if(await this._refreshCommonPrefixLength(i,n,e),0===this._numPeersForCpl(t)){let t=Math.min(2*(i+1),r.length-1);for(let r=i+1;r<t+1;r++)try{await this._refreshCommonPrefixLength(r,n,e)}catch(e){this.log.error(e)}}}catch(e){this.log.error(e)}})).catch(e=>{this.log.error(e)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),null!=this.refreshTimeoutId.unref&&this.refreshTimeoutId.unref()}).catch(e=>{this.log.error(e)})}async _refreshCommonPrefixLength(e,t,r){if(!r&&t.getTime()>Date.now()-this.refreshInterval)return void this.log("not running refresh for cpl %s as time since last refresh not above interval",e);let n=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,n,this.routingTable.size);let i=AbortSignal.timeout(this.refreshQueryTimeout),s=await Rf(this.peerRouting.getClosestPeers(n.toMultihash().bytes,{signal:i}));this.log(`found ${s} peers that were close to imaginary peer %p`,n),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,n,this.routingTable.size)}_getTrackedCommonPrefixLengthsForRefresh(e){e>R$&&(e=R$);let t=[];for(let r=0;r<=e;r++)t[r]=this.commonPrefixLengthRefreshedAt[r]??new Date;return t}async _generateRandomPeerId(e){if(null==this.routingTable.kb)throw Error("Routing table not started");if(null==this.routingTable.kb.localPeer)throw Error("Local peer not set");let t=vi(2),r=(t[1]<<8)+t[0],n=await this._makePeerId(this.routingTable.kb.localPeer.kadId,r,e);return gm(o0.decode(n))}async _makePeerId(e,t,r){if(r>R$)throw Error(`Cannot generate peer ID for common prefix length greater than ${R$}`);let n=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>r,i=65535<<16-(r+1),s=RH[n&i|t&~i],o=new ArrayBuffer(34),a=new DataView(o,0,o.byteLength);return a.setUint8(0,rX.sha256.code),a.setUint8(1,32),a.setUint32(2,s,!1),new Uint8Array(a.buffer,a.byteOffset,a.byteLength)}_maxCommonPrefix(){let e=0;for(let t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(let r of this._prefixLengths())r===e&&t++;return t}*_prefixLengths(){if(this.routingTable.kb?.localPeer!=null)for(let{kadId:e}of this.routingTable.kb.toIterable()){let t=Rs(this.routingTable.kb.localPeer.kadId,e),r=0;for(let e of t)if(0===e)r++;else break;yield r}}}let Rz=8,RV=4194304;class RG extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class RK extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class RW extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}class RQ extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}function RJ(e){return null!=e[Symbol.asyncIterator]}function RZ(e,t){if(e.byteLength>t)throw new RK("Message length too long")}let RY=e=>{let t=t5(e),r=(0,to.K)(t);return re(e,r),RY.bytes=t,r};function RX(e,t){let r=(t=t??{}).lengthEncoder??RY,n=t?.maxDataLength??RV;function*i(e){RZ(e,n);let t=r(e.byteLength);t instanceof Uint8Array?yield t:yield*t,e instanceof Uint8Array?yield e:yield*e}return RJ(e)?async function*(){for await(let t of e)yield*i(t)}():function*(){for(let t of e)yield*i(t)}()}RY.bytes=0,RX.single=(e,t)=>{let r=(t=t??{}).lengthEncoder??RY;return RZ(e,t?.maxDataLength??RV),new tf(r(e.byteLength),e)},function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(eF||(eF={}));let R0=e=>{let t=rt(e);return R0.bytes=t5(t),t};function R1(e,t){let r=new tf,n=eF.LENGTH,i=-1,s=t?.lengthDecoder??R0,o=t?.maxLengthLength??Rz,a=t?.maxDataLength??RV;function*l(){for(;r.byteLength>0;){if(n===eF.LENGTH)try{if((i=s(r))<0)throw new RG("Invalid message length");if(i>a)throw new RK("Message length too long");let e=s.bytes;r.consume(e),t?.onLength!=null&&t.onLength(i),n=eF.DATA}catch(e){if(e instanceof RangeError){if(r.byteLength>o)throw new RW("Message length length too long");break}throw e}if(n===eF.DATA){if(r.byteLength<i)break;let e=r.sublist(0,i);r.consume(i),t?.onData!=null&&t.onData(e),yield e,n=eF.LENGTH}}}return RJ(e)?async function*(){for await(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new RQ("Unexpected end of input")}():function*(){for(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new RQ("Unexpected end of input")}()}R0.bytes=0,R1.fromReader=(e,t)=>{let r=1,n=async function*(){for(;;)try{let{done:t,value:n}=await e.next(r);if(!0===t)return;null!=n&&(yield n)}catch(e){if("ERR_UNDER_READ"===e.code)return{done:!0,value:null};throw e}finally{r=1}}(),i=e=>{r=e};return R1(n,{...t??{},onLength:i})};class R2{peerId;providers;peerStore;log;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:add-provider`),this.peerId=e.peerId,this.providers=t.providers,this.peerStore=e.peerStore}async handle(e,t){let r;if(null==t.key||0===t.key.length)throw new cD("Missing key");try{r=tm.TO.decode(t.key)}catch(e){throw new cD("Invalid CID")}(null==t.providers||0===t.providers.length)&&this.log.error("no providers found in message"),this.log("%p asked us, %p to store provider record for for %c",e,this.peerId,r),await Promise.all(t.providers.map(async t=>{let n=gm(o0.decode(t.id)),i=t.multiaddrs.map(e=>yz(e));return e.equals(n)?t.multiaddrs.length<1?void this.log("no valid addresses for provider %p. Ignore",e):void(this.log.trace("received provider %p for %s (addrs %s)",e,r,i),await this.providers.addProvider(r,n),await this.peerStore.merge(n,{multiaddrs:i})):void this.log("invalid provider peer %p from %p",t.id,e)}))}}class R3{peerRouting;peerInfoMapper;peerId;addressManager;log;constructor(e,t){let{peerRouting:r,logPrefix:n}=t;this.log=e.logger.forComponent(`${n}:rpc:handlers:find-node`),this.peerId=e.peerId,this.addressManager=e.addressManager,this.peerRouting=r,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(this.log("incoming request from %p for peers closer to %b",e,t.key),null==t.key)throw new cD("Invalid FIND_NODE message received - key was missing");let r=await this.peerRouting.getCloserPeersOffline(t.key,e);tc(this.peerId.toMultihash().bytes,t.key)&&r.push({id:this.peerId,multiaddrs:this.addressManager.getAddresses().map(e=>e.decapsulateCode(yl("p2p").code))});let n={type:eD.FIND_NODE,clusterLevel:t.clusterLevel,closer:r.map(this.peerInfoMapper).filter(({multiaddrs:e})=>e.length).map(e=>({id:e.id.toMultihash().bytes,multiaddrs:e.multiaddrs.map(e=>e.bytes)})),providers:[]};return 0===n.closer.length&&this.log("could not find any peers closer to %b than %p",t.key,e),n}}class R4{peerId;peerRouting;providers;peerStore;peerInfoMapper;log;constructor(e,t){let{peerRouting:r,providers:n,logPrefix:i}=t;this.log=e.logger.forComponent(`${i}:rpc:handlers:get-providers`),this.peerId=e.peerId,this.peerStore=e.peerStore,this.peerRouting=r,this.providers=n,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){let r;if(null==t.key)throw new cD("Invalid GET_PROVIDERS message received - key was missing");try{r=tm.TO.decode(t.key)}catch(e){throw new cD("Invalid CID")}this.log("%p asking for providers for %s",e,r);let[n,i]=await Promise.all([(0,aO.A)((0,as.A)(await this.providers.getProviders(r),async e=>{let t=await this.peerStore.get(e);return{id:t.id,multiaddrs:t.addresses.map(({multiaddr:e})=>e)}})),this.peerRouting.getCloserPeersOffline(t.key,this.peerId)]),s={type:eD.GET_PROVIDERS,key:t.key,clusterLevel:t.clusterLevel,closer:i.map(this.peerInfoMapper).filter(({id:e,multiaddrs:t})=>t.length>0).map(e=>({id:e.id.toMultihash().bytes,multiaddrs:e.multiaddrs.map(e=>e.bytes)})),providers:n.map(this.peerInfoMapper).filter(({id:e,multiaddrs:t})=>t.length>0).map(e=>({id:e.id.toMultihash().bytes,multiaddrs:e.multiaddrs.map(e=>e.bytes)}))};return this.log("got %s providers %s closerPeers",s.providers.length,s.closer.length),s}async _getAddresses(e){return[]}}class R5{peerStore;datastore;peerRouting;log;datastorePrefix;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:get-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.peerStore=e.peerStore,this.datastore=e.datastore,this.peerRouting=t.peerRouting}async handle(e,t){let r=t.key;if(this.log("%p asked for key %b",e,r),null==r||0===r.length)throw new cD("Invalid key");let n={type:eD.GET_VALUE,key:r,clusterLevel:t.clusterLevel,closer:[],providers:[]};if(PQ(r)){let e;this.log("is public key");let t=PJ(r);try{let r=await this.peerStore.get(t);if(null==r.id.publicKey)throw new c_("No public key found in key book");e=p5(r.id.publicKey)}catch(e){if("NotFoundError"!==e.name)throw e}if(null!=e)return this.log("returning found public key"),n.record=new PI(r,e,new Date).serialize(),n}let[i,s]=await Promise.all([this._checkLocalDatastore(r),this.peerRouting.getCloserPeersOffline(r,e)]);return null!=i&&(this.log("had record for %b in local datastore",r),n.record=i.serialize()),s.length>0&&(this.log("had %s closer peers in routing table",s.length),n.closer=s.map(e=>({id:e.id.toMultihash().bytes,multiaddrs:e.multiaddrs.map(e=>e.bytes)}))),n}async _checkLocalDatastore(e){let t;this.log("checkLocalDatastore looking for %b",e);let r=PK(this.datastorePrefix,e);try{t=await this.datastore.get(r)}catch(e){if("NotFoundError"===e.name)return;throw e}let n=PI.deserialize(t);return null==n.timeReceived||Date.now()-n.timeReceived.getTime()>Pc?void await this.datastore.delete(r):n}}class R6{log;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:ping`)}async handle(e,t){return this.log("ping from %p",e),t}}class R8{components;validators;log;datastorePrefix;constructor(e,t){let{validators:r}=t;this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:put-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=r}async handle(e,t){let r=t.key;if(this.log("%p asked us to store value for key %b",e,r),null==t.record){let t=`Empty record from: ${e.toString()}`;throw this.log.error(t),new cD(t)}try{let e=PI.deserialize(t.record);await PH(this.validators,e),e.timeReceived=new Date;let n=PK(this.datastorePrefix,e.key);await this.components.datastore.put(n,e.serialize().subarray()),this.log("put record for %b into datastore under key %k",r,n)}catch(e){this.log("did not put record for key %b into datastore %o",r,e)}return t}}class R7{handlers;routingTable;log;metrics;constructor(e,t){this.metrics={operations:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_requests_total`),errors:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_errors_total`)},this.log=e.logger.forComponent(`${t.logPrefix}:rpc`),this.routingTable=t.routingTable,this.handlers={[eD.GET_VALUE.toString()]:new R5(e,t),[eD.PUT_VALUE.toString()]:new R8(e,t),[eD.FIND_NODE.toString()]:new R3(e,t),[eD.ADD_PROVIDER.toString()]:new R2(e,t),[eD.GET_PROVIDERS.toString()]:new R4(e,t),[eD.PING.toString()]:new R6(e,t)}}async handleMessage(e,t){let r=this.handlers[t.type];if(null==r)return void this.log.error(`no handler found for message type: ${t.type}`);try{return this.metrics.operations?.increment({[t.type]:!0}),await r.handle(e,t)}catch{this.metrics.errors?.increment({[t.type]:!0})}}onIncomingStream(e){let t="unknown";Promise.resolve().then(async()=>{let{stream:r,connection:n}=e,i=n.remotePeer,s=this;await (0,ac.F)(r,e=>R1(e),async function*(e){for await(let r of e){let e=eL.decode(r);t=e.type,s.log("incoming %s from %p",e.type,i);let n=await s.handleMessage(i,e);null!=n&&(yield eL.encode(n))}},e=>RX(e),r)}).catch(r=>{this.log.error("error handling %s RPC message from %p - %e",t,e.connection.remotePeer,r)})}}class R9 extends cf{log;components;protocol;running;registrarId;constructor(e,t){super();let{protocol:r,logPrefix:n}=t;this.components=e,this.log=e.logger.forComponent(`${n}:topology-listener`),this.running=!1,this.protocol=r}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.registrarId=await this.components.registrar.register(this.protocol,{onConnect:e=>{this.log("observed peer %p with protocol %s",e,this.protocol),this.dispatchEvent(new CustomEvent("peer",{detail:e}))}}))}async stop(){this.running=!1,null!=this.registrarId&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class De{dht;constructor(e){this.dht=e}async provide(e,t={}){await (0,cY.A)(this.dht.provide(e,t))}async cancelReprovide(e){await this.dht.cancelReprovide(e)}async *findProviders(e,t={}){for await(let r of this.dht.findProviders(e,t))"PROVIDER"===r.name&&(yield*r.providers)}async put(e,t,r){await (0,cY.A)(this.dht.put(e,t,r))}async get(e,t){for await(let r of this.dht.get(e,t))if("VALUE"===r.name)return r.value;throw new c_("Could not find value for key")}}class Dt{dht;constructor(e){this.dht=e}async findPeer(e,t={}){for await(let r of this.dht.findPeer(e,t))if("FINAL_PEER"===r.name)return r.peer;throw new c_("Peer not found")}async *getClosestPeers(e,t={}){for await(let r of this.dht.getClosestPeers(e,t))"FINAL_PEER"===r.name&&(yield r.peer)}}let Dr=32,Dn=64;class Di extends cf{protocol;routingTable;providers;network;peerRouting;components;log;running;kBucketSize;clientMode;validators;selectors;queryManager;contentFetching;contentRouting;routingTableRefresh;rpc;topologyListener;querySelf;maxInboundStreams;maxOutboundStreams;dhtContentRouting;dhtPeerRouting;peerInfoMapper;reprovider;constructor(e,t={}){super();let r=t.logPrefix??"libp2p:kad-dht",n=t.datastorePrefix??"/dht",i=t.metricsPrefix??"libp2p_kad_dht",s={queries:e.metrics?.registerMetricGroup(`${i}_operations_total`,{label:"operation"}),errors:e.metrics?.registerCounterGroup(`${i}_operation_errors_total`,{label:"operation"}),queryTime:e.metrics?.registerMetricGroup(`${i}_operation_time_seconds`,{label:"operation"}),errorTime:e.metrics?.registerMetricGroup(`${i}_operation_error_time_seconds`,{label:"operation"})};this.running=!1,this.components=e,this.log=e.logger.forComponent(r),this.protocol=t.protocol??Pu,this.kBucketSize=t.kBucketSize??20,this.clientMode=t.clientMode??!0,this.maxInboundStreams=t.maxInboundStreams??Dr,this.maxOutboundStreams=t.maxOutboundStreams??Dn,this.peerInfoMapper=t.peerInfoMapper??Pz;let o=wC();this.providers=new Rc(e,{...t.providers,logPrefix:r,datastorePrefix:n,lock:o}),this.validators={...P$,...t.validators},this.selectors={...Pj,...t.selectors},this.network=new Ri(e,{protocol:this.protocol,logPrefix:r,metricsPrefix:i}),this.routingTable=new Rj(e,{kBucketSize:t.kBucketSize,pingOldContactTimeout:t.pingOldContactTimeout,pingOldContactConcurrency:t.pingOldContactConcurrency,pingOldContactMaxQueueSize:t.pingOldContactMaxQueueSize,pingNewContactTimeout:t.pingNewContactTimeout,pingNewContactConcurrency:t.pingNewContactConcurrency,pingNewContactMaxQueueSize:t.pingNewContactMaxQueueSize,protocol:this.protocol,logPrefix:r,metricsPrefix:i,prefixLength:t.prefixLength,splitThreshold:t.kBucketSplitThreshold,network:this.network});let a=(0,ao.A)();!0===t.allowQueryWithZeroPeers&&a.resolve(),this.queryManager=new Rd(e,{disjointPaths:Math.ceil(this.kBucketSize/2),logPrefix:r,metricsPrefix:i,initialQuerySelfHasRun:a,routingTable:this.routingTable}),this.peerRouting=new Rl(e,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:r}),this.contentFetching=new Re(e,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:r,datastorePrefix:n}),this.contentRouting=new Rn(e,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:r}),this.routingTableRefresh=new Rq(e,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:r}),this.rpc=new R7(e,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:r,metricsPrefix:i,datastorePrefix:n,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new R9(e,{protocol:this.protocol,logPrefix:r}),this.querySelf=new Ry(e,{peerRouting:this.peerRouting,interval:t.querySelfInterval,initialInterval:t.initialQuerySelfInterval,logPrefix:r,initialQuerySelfHasRun:a,routingTable:this.routingTable,operationMetrics:s}),this.reprovider=new Rb(e,{...t.reprovide,logPrefix:r,metricsPrefix:i,datastorePrefix:n,contentRouting:this.contentRouting,lock:o,operationMetrics:s}),this.network.addEventListener("peer",e=>{let t=e.detail;this.onPeerConnect(t).catch(e=>{this.log.error("could not add %p to routing table",t.id,e)}),this.dispatchEvent(new CustomEvent("peer",{detail:t}))}),this.topologyListener.addEventListener("peer",e=>{let t=e.detail;Promise.resolve().then(async()=>{let e=await this.components.peerStore.get(t),r={id:t,multiaddrs:e.addresses.map(({multiaddr:e})=>e),protocols:e.protocols};await this.onPeerConnect(r)}).catch(e=>{this.log.error("could not add %p to routing table - %e",t,e)})}),this.dhtPeerRouting=new Dt(this),this.dhtContentRouting=new De(this),null==t.clientMode&&e.events.addEventListener("self:peer:update",e=>{this.log("received update of self-peer info"),Promise.resolve().then(async()=>{let t=e.detail.peer.addresses.some(({multiaddr:e})=>P4(e)),r=this.getMode();t&&"client"===r?await this.setMode("server"):"server"!==r||t||await this.setMode("client")}).catch(e=>{this.log.error("error setting dht server mode",e)})}),this.get=P7(this.get.bind(this),s,"GET_VALUE"),this.findProviders=P7(this.findProviders.bind(this),s,"FIND_PROVIDERS"),this.findPeer=P7(this.findPeer.bind(this),s,"FIND_PEER"),this.getClosestPeers=P7(this.getClosestPeers.bind(this),s,"GET_CLOSEST_PEERS"),this.provide=P7(this.provide.bind(this),s,"PROVIDE"),this.put=P7(this.put.bind(this),s,"PUT_VALUE")}[Symbol.toStringTag]="@libp2p/kad-dht";[vs]=["@libp2p/content-routing","@libp2p/peer-routing","@libp2p/peer-discovery"];[vo]=["@libp2p/identify"];get[bF](){return this.dhtContentRouting}get[bU](){return this.dhtPeerRouting}get[Ay](){return this}async onPeerConnect(e){if(this.log.trace("peer %p connected",e.id),0===(e=this.peerInfoMapper(e)).multiaddrs.length)return void this.log.trace("ignoring %p as there were no valid addresses in %s after filtering",e.id,e.multiaddrs.map(e=>e.toString()));try{await this.routingTable.add(e.id)}catch(t){this.log.error("could not add %p to routing table",e.id,t)}}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}async setMode(e,t=!1){return(e!==this.getMode()||t)&&(await this.components.registrar.unhandle(this.protocol),e!==this.getMode()||t)?void("client"===e?(this.log("enabling client mode while in %s mode",this.getMode()),this.clientMode=!0):(this.log("enabling server mode while in %s mode",this.getMode()),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))):void this.log("already in %s mode",e)}async start(){this.running||(this.running=!0,await this.setMode(this.clientMode?"client":"server",!0),await bH(this.routingTable,this.queryManager,this.network,this.topologyListener,this.routingTableRefresh,this.reprovider),await bH(this.querySelf))}async stop(){this.running=!1,await b$(this.querySelf,this.queryManager,this.network,this.routingTable,this.routingTableRefresh,this.topologyListener,this.reprovider)}async *put(e,t,r={}){yield*this.contentFetching.put(e,t,r)}async *get(e,t={}){yield*this.contentFetching.get(e,t)}async *provide(e,t={}){yield*this.contentRouting.provide(e,this.components.addressManager.getAddresses(),t)}async cancelReprovide(e){await this.providers.removeProvider(e,this.components.peerId)}async *findProviders(e,t={}){yield*this.contentRouting.findProviders(e,t)}async *findPeer(e,t={}){yield*this.peerRouting.findPeer(e,t)}async *getClosestPeers(e,t={}){yield*this.peerRouting.getClosestPeers(e,t)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}}function Ds(e={}){return t=>new Di(t,e)}!function(e){e[e.SEND_QUERY=0]="SEND_QUERY",e[e.PEER_RESPONSE=1]="PEER_RESPONSE",e[e.FINAL_PEER=2]="FINAL_PEER",e[e.QUERY_ERROR=3]="QUERY_ERROR",e[e.PROVIDER=4]="PROVIDER",e[e.VALUE=5]="VALUE",e[e.ADD_PEER=6]="ADD_PEER",e[e.DIAL_PEER=7]="DIAL_PEER"}(eU||(eU={}));let Do=16,Da=32,Dl=1e4;async function Dc(e,t){let r=vu(),n=await r.encrypt(e,t);return oN.base64.encode(n)}async function Du(e,t,r){if("RSA"===e.type)return Df(e,t,r);if("Ed25519"===e.type)return Dd(e,t,r);if("secp256k1"===e.type)return Dh(e,t,r);throw new cH}async function Dd(e,t,r="libp2p-key"){if("libp2p-key"===r)return Dc(p7(e),t);throw new cy(`export format '${r}' is not supported`)}async function Dh(e,t,r="libp2p-key"){if("libp2p-key"===r)return Dc(p7(e),t);throw new cy("Export format is not supported")}async function Df(e,t,r="pkcs-8"){if("pkcs-8"===r)return Dp(e,t);if("libp2p-key"===r)return Dc(p7(e),t);throw new cy("Export format is not supported")}async function Dp(e,t){let r=fq.get(),n=new Eg({value:[new Ea({value:0}),new Eg({value:[new Ed({value:"1.2.840.113549.1.1.1"}),new v6]}),new Ee({valueHex:e.raw})]}).toBER(),i=new Uint8Array(n,0,n.byteLength),s=vi(Do),o=await w2(vt,t,s,{c:Dl,dkLen:Da}),a=vi(16),l=await r.subtle.importKey("raw",o,"AES-CBC",!1,["encrypt"]),c=await r.subtle.encrypt({name:"AES-CBC",iv:a},l,i),u=new Eg({value:[new Ee({valueHex:s}),new Ea({value:Dl}),new Ea({value:Da}),new Eg({value:[new Ed({value:"1.2.840.113549.2.11"}),new v6]})]}),d=new Eg({value:[new Ed({value:"1.2.840.113549.1.5.13"}),new Eg({value:[new Eg({value:[new Ed({value:"1.2.840.113549.1.5.12"}),u]}),new Eg({value:[new Ed({value:"2.16.840.1.101.3.4.1.42"}),new Ee({valueHex:a})]})]})]}),h=new Eg({value:[d,new Ee({valueHex:c})]}).toBER(),f=new Uint8Array(h,0,h.byteLength);return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...(0,uC.d)(f,"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join("\n")}async function Dg(e,t){try{let r=await Dm(e,t);return p6(r)}catch{}if(!e.includes("BEGIN"))throw new cy("Encrypted key was not a libp2p-key or a PEM file");return Dy(e,t)}async function Dm(e,t){let r=oN.base64.decode(e);return vu().decrypt(r,t)}async function Dy(e,t){let r,n=fq.get();if(e.includes("-----BEGIN ENCRYPTED PRIVATE KEY-----")){let{result:i}=v0((0,rx.s)(e.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad")),{iv:s,salt:o,iterations:a,keySize:l,cipherText:c}=Db(i),u=await w2(vt,t,o,{c:a,dkLen:l}),d=await n.subtle.importKey("raw",u,"AES-CBC",!1,["decrypt"]),{result:h}=v0(Dv(await n.subtle.decrypt({name:"AES-CBC",iv:s},d,c)));r=Dw(h)}else if(e.includes("-----BEGIN PRIVATE KEY-----")){let{result:t}=v0((0,rx.s)(e.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"));r=Dw(t)}else throw new cy("Could not parse private key from PEM data");let i=p8(r);if("RSA"!==i.type)throw new cy("Could not parse RSA private key from PEM data");return i}function Db(e){let t=e.valueBlock.value[0];if("OBJECT IDENTIFIER : 1.2.840.113549.1.5.13"!==t.valueBlock.value[0].toString())throw new cy("Only pkcs5PBES2 encrypted private keys are supported");let r=t.valueBlock.value[1].valueBlock.value[0];if("OBJECT IDENTIFIER : 1.2.840.113549.1.5.12"!==r.valueBlock.value[0].toString())throw new cy("Only pkcs5PBKDF2 key derivation functions are supported");let n=r.valueBlock.value[1],i=Dv(n.valueBlock.value[0].getValue()),s=Dl,o=Da;if(3===n.valueBlock.value.length)s=Number(n.valueBlock.value[1].toBigInt()),o=Number(n.valueBlock.value[2].toBigInt());else if(2===n.valueBlock.value.length)throw new cy("Could not derive key size and iterations from PEM file - please use @libp2p/rsa to re-import your key");let a=t.valueBlock.value[1].valueBlock.value[1],l=a.valueBlock.value[0].toString();if("OBJECT IDENTIFIER : 1.2.840.113549.3.7"===l);else if("OBJECT IDENTIFIER : 1.3.14.3.2.7"===l);else if("OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.2"===l);else if("OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.22"===l);else if("OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.42"===l);else throw new cy("Only AES-CBC encryption schemes are supported");let c=Dv(a.valueBlock.value[1].getValue());return{cipherText:Dv(e.valueBlock.value[1].getValue()),salt:i,iterations:s,keySize:o,iv:c}}function Dw(e){return Dv(e.valueBlock.value[2].getValue())}function Dv(e){return new Uint8Array(e,0,e.byteLength)}let DE="/pkcs8/",DA="/info/",Dx=new WeakMap,DS={minKeyLength:14,minSaltLength:16,minIterationCount:1e3},Dk={dek:{keyLength:64,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function D_(e){return null!=e&&"string"==typeof e&&e===vl(e.trim())&&e.length>0}async function DI(){let e=800*Math.random()+200;await new Promise(t=>setTimeout(t,e))}function DT(e){return new va.U(DE+e)}function DC(e){return new va.U(DA+e)}async function DP(e){let t=p7(e),r=await rX.sha256.digest(t);return uW.base58btc.encode(r.bytes).substring(1)}class DR{components;init;log;self;constructor(e,t){if(this.components=e,this.log=e.logger.forComponent("libp2p:keychain"),this.init=aM(Dk,t),this.self=t.selfKey??"self",null!=this.init.pass&&this.init.pass?.length<20)throw Error("pass must be least 20 characters");if(this.init.dek?.keyLength!=null&&this.init.dek.keyLength<DS.minKeyLength)throw Error(`dek.keyLength must be least ${DS.minKeyLength} bytes`);if(this.init.dek?.salt?.length!=null&&this.init.dek.salt.length<DS.minSaltLength)throw Error(`dek.saltLength must be least ${DS.minSaltLength} bytes`);if(this.init.dek?.iterationCount!=null&&this.init.dek.iterationCount<DS.minIterationCount)throw Error(`dek.iterationCount must be least ${DS.minIterationCount}`);let r=null!=this.init.pass&&this.init.dek?.salt!=null?vn(this.init.pass,this.init.dek?.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";Dx.set(this,{dek:r})}[Symbol.toStringTag]="@libp2p/keychain";[vs]=["@libp2p/keychain"];static generateOptions(){let e=Object.assign({},Dk),t=3*Math.ceil(DS.minSaltLength/3);return e.dek.salt=(0,uC.d)(vi(t),"base64"),e}static get options(){return Dk}async findKeyByName(e){if(!D_(e))throw await DI(),new cy(`Invalid key name '${e}'`);let t=DC(e);try{let e=await this.components.datastore.get(t);return JSON.parse((0,uC.d)(e))}catch(t){throw await DI(),this.log.error(t),new c_(`Key '${e}' does not exist.`)}}async findKeyById(e){try{let t={prefix:DA};for await(let r of this.components.datastore.query(t)){let t=JSON.parse((0,uC.d)(r.value));if(t.id===e)return t}throw new cy(`Key with id '${e}' does not exist.`)}catch(e){throw await DI(),e}}async importKey(e,t){let r,n;if(!D_(e))throw await DI(),new cy(`Invalid key name '${e}'`);if(null==t)throw await DI(),new cy("Key is required");let i=DT(e);if(await this.components.datastore.has(i))throw await DI(),new cy(`Key '${e}' already exists`);try{r=await DP(t);let e=Dx.get(this);if(null==e)throw new cy("dek missing");let i=e.dek;n=await Du(t,i,"RSA"===t.type?"pkcs-8":"libp2p-key")}catch(e){throw await DI(),e}let s={name:e,id:r},o=this.components.datastore.batch();return o.put(i,(0,rx.s)(n)),o.put(DC(e),(0,rx.s)(JSON.stringify(s))),await o.commit(),s}async exportKey(e){if(!D_(e))throw await DI(),new cy(`Invalid key name '${e}'`);let t=DT(e);try{let e=await this.components.datastore.get(t),r=(0,uC.d)(e),n=Dx.get(this);if(null==n)throw new cy("dek missing");let i=n.dek;return await Dg(r,i)}catch(e){throw await DI(),e}}async removeKey(e){if(!D_(e)||e===this.self)throw await DI(),new cy(`Invalid key name '${e}'`);let t=DT(e),r=await this.findKeyByName(e),n=this.components.datastore.batch();return n.delete(t),n.delete(DC(e)),await n.commit(),r}async listKeys(){let e={prefix:DA},t=[];for await(let r of this.components.datastore.query(e))t.push(JSON.parse((0,uC.d)(r.value)));return t}async renameKey(e,t){if(!D_(e)||e===this.self)throw await DI(),new cy(`Invalid old key name '${e}'`);if(!D_(t)||t===this.self)throw await DI(),new cy(`Invalid new key name '${t}'`);let r=DT(e),n=DT(t),i=DC(e),s=DC(t);if(await this.components.datastore.has(n))throw await DI(),new cy(`Key '${t}' already exists`);try{let e=await this.components.datastore.get(r),o=await this.components.datastore.get(i),a=JSON.parse((0,uC.d)(o));a.name=t;let l=this.components.datastore.batch();return l.put(n,e),l.put(s,(0,rx.s)(JSON.stringify(a))),l.delete(r),l.delete(i),await l.commit(),a}catch(e){throw await DI(),e}}async rotateKeychainPass(e,t){if("string"!=typeof e)throw await DI(),new cy(`Invalid old pass type '${typeof e}'`);if("string"!=typeof t)throw await DI(),new cy(`Invalid new pass type '${typeof t}'`);if(t.length<20)throw await DI(),new cy(`Invalid pass length ${t.length}`);this.log("recreating keychain");let r=Dx.get(this);if(null==r)throw new cy("dek missing");let n=r.dek;this.init.pass=t;let i=null!=t&&this.init.dek?.salt!=null?vn(t,this.init.dek.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";for(let e of(Dx.set(this,{dek:i}),await this.listKeys())){let t=await this.components.datastore.get(DT(e.name)),r=(0,uC.d)(t),s=await Dg(r,n),o=i.toString(),a=await Du(s,o,"RSA"===s.type?"pkcs-8":"libp2p-key"),l=this.components.datastore.batch(),c={name:e.name,id:e.id};l.put(DT(e.name),(0,rx.s)(a)),l.put(DC(e.name),(0,rx.s)(JSON.stringify(c))),await l.commit()}this.log("keychain reconstructed")}}function DD(e={}){return t=>new DR(t,e)}!function(e){e[e.NEW_STREAM=0]="NEW_STREAM",e[e.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",e[e.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",e[e.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",e[e.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",e[e.RESET_RECEIVER=5]="RESET_RECEIVER",e[e.RESET_INITIATOR=6]="RESET_INITIATOR"}(ej||(ej={}));let DN=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),DM=Object.freeze({NEW_STREAM:ej.NEW_STREAM,MESSAGE:ej.MESSAGE_INITIATOR,CLOSE:ej.CLOSE_INITIATOR,RESET:ej.RESET_INITIATOR}),DB=Object.freeze({MESSAGE:ej.MESSAGE_RECEIVER,CLOSE:ej.CLOSE_RECEIVER,RESET:ej.RESET_RECEIVER}),DO=1048576,DL=4194304;class DF{_buffer;_headerInfo;_maxMessageSize;_maxUnprocessedMessageQueueSize;constructor(e=DO,t=DL){this._buffer=new tf,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(null==e||0===e.length)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw new cD("Unprocessed message queue size too large!");let t=[];for(;0!==this._buffer.length;){if(null==this._headerInfo)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(e){if("InvalidMessageError"===e.name)throw e;break}let{id:e,type:r,length:n,offset:i}=this._headerInfo;if(this._buffer.length-i<n)break;let s={id:e,type:r};(r===ej.NEW_STREAM||r===ej.MESSAGE_INITIATOR||r===ej.MESSAGE_RECEIVER)&&(s.data=this._buffer.sublist(i,i+n)),t.push(s),this._buffer.consume(i+n),this._headerInfo=null}return t}_decodeHeader(e){let{value:t,offset:r}=DH(e),{value:n,offset:i}=DH(e,r),s=7&t;if(null==DN[s])throw Error(`Invalid type received: ${s}`);if(n>this._maxMessageSize)throw new cD("Message size too large");return{id:t>>3,type:s,offset:r+i,length:n}}}let DU=128,Dj=127;function DH(e,t=0){let r,n=0,i=0,s=t,o=e.length;do{if(s>=o||i>49)throw t=0,RangeError("Could not decode varint");r=e.get(s++),n+=i<28?(r&Dj)<<i:(r&Dj)*Math.pow(2,i),i+=7}while(r>=DU);return{value:n,offset:t=s-t}}let D$=10240;class Dq{_pool;_poolOffset;constructor(){this._pool=(0,to.K)(D$),this._poolOffset=0}write(e,t){let r=this._pool,n=this._poolOffset;re(e.id<<3|e.type,r,n),n+=t5(e.id<<3|e.type),(e.type===ej.NEW_STREAM||e.type===ej.MESSAGE_INITIATOR||e.type===ej.MESSAGE_RECEIVER)&&null!=e.data?(re(e.data.length,r,n),n+=t5(e.data.length)):(re(0,r,n),n+=t5(0));let i=r.subarray(this._poolOffset,n);D$-n<100?(this._pool=(0,to.K)(D$),this._poolOffset=0):this._poolOffset=n,t.append(i),(e.type===ej.NEW_STREAM||e.type===ej.MESSAGE_INITIATOR||e.type===ej.MESSAGE_RECEIVER)&&null!=e.data&&t.append(e.data)}}let Dz=new Dq;async function*DV(e){for await(let t of e){let e=new tf;Dz.write(t,e),yield e}}class DG extends Error{constructor(e="Stream input buffer error"){super(e),this.name="StreamInputBufferError"}}class DK extends IH{name;streamId;send;types;maxDataSize;constructor(e){super(e),this.types="outbound"===e.direction?DM:DB,this.send=e.send,this.name=e.name,this.streamId=e.streamId,this.maxDataSize=e.maxDataSize}async sendNewStream(){await this.send({id:this.streamId,type:DM.NEW_STREAM,data:new tf((0,rx.s)(this.name))})}async sendData(e){for(e=e.sublist();e.byteLength>0;){let t=Math.min(e.byteLength,this.maxDataSize);await this.send({id:this.streamId,type:this.types.MESSAGE,data:e.sublist(0,t)}),e.consume(t)}}async sendReset(){await this.send({id:this.streamId,type:this.types.RESET})}async sendCloseWrite(){await this.send({id:this.streamId,type:this.types.CLOSE})}async sendCloseRead(){}}function DW(e){let{id:t,name:r,send:n,onEnd:i,type:s="initiator",maxMsgSize:o=DO}=e;return new DK({id:"initiator"===s?`i${t}`:`r${t}`,streamId:t,name:`${r??t}`,direction:"initiator"===s?"outbound":"inbound",maxDataSize:o,onEnd:i,send:n,log:e.logger.forComponent(`libp2p:mplex:stream:${s}:${t}`)})}let DQ=1024,DJ=1024,DZ=4194304,DY=5,DX=500;function D0(e){let t={...e,type:`${DN[e.type]} (${e.type})`};return e.type===ej.NEW_STREAM&&(t.data=(0,uC.d)(e.data instanceof Uint8Array?e.data:e.data.subarray())),(e.type===ej.MESSAGE_INITIATOR||e.type===ej.MESSAGE_RECEIVER)&&(t.data=(0,uC.d)(e.data instanceof Uint8Array?e.data:e.data.subarray(),"base16")),t}class D1{protocol="/mplex/6.7.0";sink;source;log;_streamId;_streams;_init;_source;closeController;rateLimiter;closeTimeout;logger;constructor(e,t){t=t??{},this.log=e.logger.forComponent("libp2p:mplex"),this.logger=e.logger,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=t,this.closeTimeout=t.closeTimeout??DX,this.sink=this._createSink(),this._source=(0,ad.Ny)({objectMode:!0,onEnd:()=>{for(let e of this._streams.initiators.values())e.destroy();for(let e of this._streams.receivers.values())e.destroy()}}),this.source=(0,ac.F)(this._source,e=>DV(e)),this.closeController=new AbortController,this.rateLimiter=new x0({points:t.disconnectThreshold??DY,duration:1})}get streams(){let e=[];for(let t of this._streams.initiators.values())e.push(t);for(let t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new cx("Muxer already closed");let t=this._streamId++;e=null==e?t.toString():e.toString();let r=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:r})}async close(e){if(this.closeController.signal.aborted)return;let t=e?.signal??AbortSignal.timeout(this.closeTimeout);try{await Promise.all(this.streams.map(async e=>e.close({signal:t}))),this._source.end(),await this._source.onEmpty({signal:t}),this.closeController.abort()}catch(e){this.abort(e)}}abort(e){this.closeController.signal.aborted||(this.streams.forEach(t=>{t.abort(e)}),this.closeController.abort(e))}_newReceiverStream(e){let{id:t,name:r}=e,n=this._streams.receivers;return this._newStream({id:t,name:r,type:"receiver",registry:n})}_newStream(e){let{id:t,name:r,type:n,registry:i}=e;if(this.log("new %s stream %s",n,t),"initiator"===n&&this._streams.initiators.size===(this._init.maxOutboundStreams??DJ))throw new cj("Too many outbound streams open");if(i.has(t))throw Error(`${n} stream ${t} already exists!`);let s=async e=>{this.log.enabled&&this.log.trace("%s stream %s send",n,t,D0(e)),this._source.push(e)},o=()=>{this.log("%s stream with id %s and protocol %s ended",n,t,a.protocol),i.delete(t),null!=this._init.onStreamEnd&&this._init.onStreamEnd(a)},a=DW({id:t,name:r,send:s,type:n,onEnd:o,maxMsgSize:this._init.maxMsgSize,logger:this.logger});return i.set(t,a),a}_createSink(){return async e=>{let t=()=>{IF(e,this.log)};this.closeController.signal.addEventListener("abort",t);try{let t=new DF(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(let r of e)for(let e of t.write(r))await this._handleIncoming(e);this._source.end()}catch(e){this.log("error in sink",e),this._source.end(e)}finally{this.closeController.signal.removeEventListener("abort",t)}}}async _handleIncoming(e){let{id:t,type:r}=e;if(this.log.enabled&&this.log.trace("incoming message",D0(e)),e.type===ej.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??DQ)){this.log("too many inbound streams open"),this._source.push({id:t,type:ej.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{this.log("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this.abort(Error("Too many open streams"))}return}let r=this._newReceiverStream({id:t,name:(0,uC.d)(e.data instanceof Uint8Array?e.data:e.data.subarray())});null!=this._init.onIncomingStream&&this._init.onIncomingStream(r);return}let n=((1&r)==1?this._streams.initiators:this._streams.receivers).get(t);if(null==n){this.log("missing stream %s for message type %s",t,DN[r]);try{await this.rateLimiter.consume("missing-stream",1)}catch{this.log("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),this.abort(Error("Too many messages for missing streams"))}return}let i=this._init.maxStreamBufferSize??DZ;try{switch(r){case ej.MESSAGE_INITIATOR:case ej.MESSAGE_RECEIVER:if(n.sourceReadableLength()>i)throw this._source.push({id:e.id,type:r===ej.MESSAGE_INITIATOR?ej.RESET_RECEIVER:ej.RESET_INITIATOR}),new DG("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers");n.sourcePush(e.data);break;case ej.CLOSE_INITIATOR:case ej.CLOSE_RECEIVER:n.remoteCloseWrite();break;case ej.RESET_INITIATOR:case ej.RESET_RECEIVER:n.reset();break;default:this.log("unknown message type %s",r)}}catch(e){this.log.error("error while processing message",e),n.abort(e)}}}class D2{protocol="/mplex/6.7.0";_init;components;constructor(e,t={}){this.components=e,this._init=t}[Symbol.toStringTag]="@libp2p/mplex";[vs]=["@libp2p/stream-multiplexing"];createStreamMuxer(e={}){return new D1(this.components,{...e,...this._init})}}function D3(e={}){return t=>new D2(t,e)}let D4=32,D5="1.0.0",D6="ping",D8="ipfs",D7=1e4,D9=2,Ne=1;class Nt{protocol;components;started;timeout;maxInboundStreams;maxOutboundStreams;runOnLimitedConnection;log;constructor(e,t={}){this.components=e,this.log=e.logger.forComponent("libp2p:ping"),this.started=!1,this.protocol=`/${t.protocolPrefix??D8}/${D6}/${D5}`,this.timeout=t.timeout??D7,this.maxInboundStreams=t.maxInboundStreams??D9,this.maxOutboundStreams=t.maxOutboundStreams??Ne,this.runOnLimitedConnection=t.runOnLimitedConnection??!0,this.handleMessage=this.handleMessage.bind(this)}[Symbol.toStringTag]="@libp2p/ping";async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){this.log("incoming ping from %p",e.connection.remotePeer);let{stream:t}=e,r=Date.now(),n=SG(t),i=!1;Promise.resolve().then(async()=>{for(;;){let e=AbortSignal.timeout(this.timeout);e.addEventListener("abort",()=>{t?.abort(new cM("ping timeout"))});let r=await n.read(D4,{signal:e});await n.write(r,{signal:e}),i=!0}}).catch(r=>{i&&"UnexpectedEOFError"===r.name&&"ready"!==t.readStatus||(this.log.error("incoming ping from %p failed with error - %e",e.connection.remotePeer,r),t?.abort(r))}).finally(()=>{let n=Date.now()-r;this.log("incoming ping from %p complete in %dms",e.connection.remotePeer,n);let i=AbortSignal.timeout(this.timeout);t.close({signal:i}).catch(r=>{this.log.error("error closing ping stream from %p - %e",e.connection.remotePeer,r),t?.abort(r)})})}async ping(e,t={}){let r;this.log("pinging %p",e);let n=Date.now(),i=vi(D4),s=await this.components.connectionManager.openConnection(e,t);if(null==t.signal){let e=AbortSignal.timeout(this.timeout);t={...t,signal:e}}try{r=await s.newStream(this.protocol,{...t,runOnLimitedConnection:this.runOnLimitedConnection});let e=SG(r),[,o]=await Promise.all([e.write(i,t),e.read(D4,t)]),a=Date.now()-n;if(!tc(i,o.subarray()))throw new cN(`Received wrong ping ack after ${a}ms`);return this.log("ping %p complete in %dms",s.remotePeer,a),a}catch(e){throw this.log.error("error while pinging %p",s.remotePeer,e),r?.abort(e),e}finally{null!=r&&await r.close(t)}}}function Nr(e={}){return t=>new Nt(t,e)}!function(e){let t,r,n;!function(e){e.FIN="FIN",e.STOP_SENDING="STOP_SENDING",e.RESET="RESET",e.FIN_ACK="FIN_ACK"}(t=e.Flag||(e.Flag={})),function(e){e[e.FIN=0]="FIN",e[e.STOP_SENDING=1]="STOP_SENDING",e[e.RESET=2]="RESET",e[e.FIN_ACK=3]="FIN_ACK"}(r||(r={})),function(e){e.codec=()=>r$(r)}(t=e.Flag||(e.Flag={})),e.codec=()=>(null==n&&(n=rq((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.flag&&(r.uint32(8),e.Flag.codec().encode(t.flag,r)),null!=t.message&&(r.uint32(18),r.bytes(t.message)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.flag=e.Flag.codec().decode(t);break;case 2:i.message=t.bytes();break;default:t.skipType(7&r)}}return i})),n),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(eH||(eH={}));let Nn=["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"],Ni=Array.from("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"),Ns="libp2p+webrtc+v1/",No=466,Na=2097152,Nl=3e4,Nc=16384,Nu=function(e=Nc){let t=t5(e-t5(e)),r=1+t5(Object.keys(eH.Flag).length-1),n=1,i=t5(e-t-r-1);return t+r+n+i}(),Nd=5e3,Nh=5e3,Nf=3e4,Np="/webrtc",Ng="/webrtc-signaling/0.0.1";var Nm=r(49509),Ny=function(e,t,r){if(r||2==arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},Nb=function(){return function(e,t,r){this.name=e,this.version=t,this.os=r,this.type="browser"}}(),Nw=function(){return function(e){this.version=e,this.type="node",this.name="node",this.os=Nm.platform}}(),Nv=function(){return function(e,t,r,n){this.name=e,this.version=t,this.os=r,this.bot=n,this.type="bot-device"}}(),NE=function(){return function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}}(),NA=function(){return function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}}(),Nx=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,NS=3,Nk=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],N_=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function NI(e){return""!==e&&Nk.reduce(function(t,r){var n=r[0],i=r[1];if(t)return t;var s=i.exec(e);return!!s&&[n,s]},!1)}function NT(e){var t=NI(e);if(!t)return null;var r=t[0],n=t[1];if("searchbot"===r)return new NE;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<NS&&(i=Ny(Ny([],i,!0),NR(NS-i.length),!0)):i=[];var s=i.join("."),o=NC(e),a=Nx.exec(e);return a&&a[1]?new Nv(r,s,o,a[1]):new Nb(r,s,o)}function NC(e){for(var t=0,r=N_.length;t<r;t++){var n=N_[t],i=n[0];if(n[1].exec(e))return i}return null}function NP(){return void 0!==Nm&&Nm.version?new Nw(Nm.version.slice(1)):null}function NR(e){for(var t=[],r=0;r<e;r++)t.push("0");return t}let ND=function e(e){return e?NT(e):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new NA:"undefined"!=typeof navigator?NT(navigator.userAgent):NP()}(),NN=null!=ND&&"firefox"===ND.name,NM=async function*(){},NB=async e=>{};function NO(e,t,r=Nf,n){"open"===e.readyState&&Promise.resolve().then(async()=>{if(e.bufferedAmount>0){n.log("%s drain channel with %d buffered bytes",t,e.bufferedAmount);let i=(0,ao.A)(),s=!1;e.bufferedAmountLowThreshold=0;let o=()=>{s||(n.log("%s drain channel closed before drain",t),i.resolve())};e.addEventListener("close",o,{once:!0}),e.addEventListener("bufferedamountlow",()=>{s=!0,e.removeEventListener("close",o),i.resolve()}),await ay(i.promise,{milliseconds:r})}}).then(async()=>{"open"===e.readyState&&e.close()}).catch(e=>{n.log.error("error closing outbound stream",e)})}async function NL(e){return"function"==typeof(e=e??{})&&(e=await e()),e.iceServers=e.iceServers??Nn.map(e=>({urls:[e]})),e}let NF=(e=32)=>Ns+[...Array(e)].map(()=>Ni.at(Math.floor(Math.random()*Ni.length))).join("");class NU{log;peerConnection;remoteAddr;timeline;metrics;source=NM();sink=NB;constructor(e,t){this.log=e.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=t.remoteAddr,this.timeline=t.timeline,this.peerConnection=t.peerConnection;let r=this.peerConnection,n=r.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",r.connectionState,"initial state",n),("disconnected"===r.connectionState||"failed"===r.connectionState||"closed"===r.connectionState)&&(this.timeline.close=Date.now())}}async close(e){this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({close:!0})}abort(e){this.log.error("closing connection due to error",e),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({abort:!0})}}let Nj=8,NH=4194304;class N$ extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class Nq extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class Nz extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}class NV extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}function NG(e){return null!=e[Symbol.asyncIterator]}function NK(e,t){if(e.byteLength>t)throw new Nq("Message length too long")}let NW=e=>{let t=t5(e),r=(0,to.K)(t);return re(e,r),NW.bytes=t,r};function NQ(e,t){let r=(t=t??{}).lengthEncoder??NW,n=t?.maxDataLength??NH;function*i(e){NK(e,n);let t=r(e.byteLength);t instanceof Uint8Array?yield t:yield*t,e instanceof Uint8Array?yield e:yield*e}return NG(e)?async function*(){for await(let t of e)yield*i(t)}():function*(){for(let t of e)yield*i(t)}()}NW.bytes=0,NQ.single=(e,t)=>{let r=(t=t??{}).lengthEncoder??NW;return NK(e,t?.maxDataLength??NH),new tf(r(e.byteLength),e)},function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(e$||(e$={}));let NJ=e=>{let t=rt(e);return NJ.bytes=t5(t),t};function NZ(e,t){let r=new tf,n=e$.LENGTH,i=-1,s=t?.lengthDecoder??NJ,o=t?.maxLengthLength??Nj,a=t?.maxDataLength??NH;function*l(){for(;r.byteLength>0;){if(n===e$.LENGTH)try{if((i=s(r))<0)throw new N$("Invalid message length");if(i>a)throw new Nq("Message length too long");let e=s.bytes;r.consume(e),t?.onLength!=null&&t.onLength(i),n=e$.DATA}catch(e){if(e instanceof RangeError){if(r.byteLength>o)throw new Nz("Message length length too long");break}throw e}if(n===e$.DATA){if(r.byteLength<i)break;let e=r.sublist(0,i);r.consume(i),t?.onData!=null&&t.onData(e),yield e,n=e$.LENGTH}}}return NG(e)?async function*(){for await(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new NV("Unexpected end of input")}():function*(){for(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new NV("Unexpected end of input")}()}NJ.bytes=0,NZ.fromReader=(e,t)=>{let r=1,n=async function*(){for(;;)try{let{done:t,value:n}=await e.next(r);if(!0===t)return;null!=n&&(yield n)}catch(e){if("ERR_UNDER_READ"===e.code)return{done:!0,value:null};throw e}finally{r=1}}(),i=e=>{r=e};return NZ(n,{...t??{},onLength:i})};class NY extends IH{channel;incomingData;maxBufferedAmount;bufferedAmountLowEventTimeout;maxMessageSize;receiveFinAck;finAckTimeout;openTimeout;closeController;constructor(e){let t=e.onEnd;switch(e.onEnd=e=>{this.log.trace("readable and writeable ends closed",this.status),Promise.resolve(async()=>{if(null==this.timeline.abort&&null===this.timeline.reset)try{await ay(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(e){this.log.error("error receiving FIN_ACK",e)}}).then(()=>{this.incomingData.end(),this.channel.close(),t?.(e)}).catch(e=>{this.log.error("error ending stream",e)})},super(e),this.channel=e.channel,this.channel.binaryType="arraybuffer",this.incomingData=(0,ad.Ny)(),this.bufferedAmountLowEventTimeout=e.bufferedAmountLowEventTimeout??Nl,this.maxBufferedAmount=e.maxBufferedAmount??Na,this.maxMessageSize=(e.maxMessageSize??Nc)-Nu,this.receiveFinAck=(0,ao.A)(),this.finAckTimeout=e.closeTimeout??Nd,this.openTimeout=e.openTimeout??Nh,this.closeController=new AbortController,this.channel.readyState){case"open":this.timeline.open=new Date().getTime();break;case"closed":case"closing":(void 0===this.timeline.close||0===this.timeline.close)&&(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new ck("Unknown datachannel state")}this.channel.onopen=e=>{this.timeline.open=new Date().getTime()},this.channel.onclose=e=>{this.log.trace("received onclose event"),this.closeController.abort(),this.receiveFinAck.resolve(),this.close().catch(e=>{this.log.error("error closing stream after channel closed",e)})},this.channel.onerror=e=>{this.log.trace("received onerror event"),this.closeController.abort();let t=e.error;this.abort(t)},this.channel.onmessage=async e=>{let{data:t}=e;null!==t&&0!==t.byteLength&&this.incomingData.push(new Uint8Array(t,0,t.byteLength))};let r=this;Promise.resolve().then(async()=>{for await(let e of NZ(this.incomingData)){let t=r.processIncomingProtobuf(e);null!=t&&r.sourcePush(new tf(t))}}).catch(e=>{this.log.error("error processing incoming data channel messages",e)})}sendNewStream(){}async _sendMessage(e,t=!0){if("closed"===this.channel.readyState||"closing"===this.channel.readyState)throw new ck(`Invalid datachannel state - ${this.channel.readyState}`);if("open"!==this.channel.readyState){let e=AbortSignal.timeout(this.openTimeout),t=ch([this.closeController.signal,e]);try{this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),await cq(this.channel,"open",t)}finally{t.clear()}this.log('channel state is now "%s", sending data',this.channel.readyState)}if(t&&this.channel.bufferedAmount>this.maxBufferedAmount){let e=AbortSignal.timeout(this.bufferedAmountLowEventTimeout),t=ch([this.closeController.signal,e]);try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),await cq(this.channel,"bufferedamountlow",t)}catch(t){if(e.aborted)throw new cM(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`);throw t}finally{t.clear()}}try{this.channel.send(e.subarray())}catch(e){this.log.error("error while sending message",e)}}async sendData(e){for(this.log.trace("-> will send %d bytes",e.byteLength),e=e.sublist();e.byteLength>0;){let t=Math.min(e.byteLength,this.maxMessageSize),r=e.subarray(0,t),n=eH.encode({message:r}),i=NQ.single(n);this.log.trace("-> sending message %s",this.channel.readyState),await this._sendMessage(i),this.log.trace("-> sent message %s",this.channel.readyState),e.consume(t)}this.log.trace("-> sent data %s",this.channel.readyState)}async sendReset(){try{await this._sendFlag(eH.Flag.RESET)}catch(e){this.log.error("failed to send reset - %e",e)}}async sendCloseWrite(e){if("open"!==this.channel.readyState)return void this.receiveFinAck.resolve();if(await this._sendFlag(eH.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{await (0,cG.W)(this.receiveFinAck.promise,e?.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorName:"FinAckNotReceivedError"})}catch(e){this.log.error("failed to await FIN_ACK",e)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()}async sendCloseRead(){"open"===this.channel.readyState&&await this._sendFlag(eH.Flag.STOP_SENDING)}processIncomingProtobuf(e){let t=eH.decode(e);if(void 0!==t.flag&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',t.flag,this.writeStatus,this.readStatus),t.flag===eH.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(eH.Flag.FIN_ACK).catch(e=>{this.log.error("error sending FIN_ACK immediately",e)})),t.flag===eH.Flag.RESET&&this.reset(),t.flag===eH.Flag.STOP_SENDING&&this.remoteCloseRead(),t.flag===eH.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),"ready"===this.readStatus)return t.message}async _sendFlag(e){if("open"!==this.channel.readyState)return this.log.trace('not sending flag %s because channel is "%s" and not "open"',this.channel.readyState,e.toString()),!1;this.log.trace("sending flag %s",e.toString());let t=eH.encode({flag:e}),r=NQ.single(t);try{return await this._sendMessage(r,!1),!0}catch(t){this.log.error("could not send flag %s - %e",e.toString(),t)}return!1}}function NX(e){let{channel:t,direction:r}=e;return new NY({id:"inbound"===r?`i${t.id}`:`r${t.id}`,log:e.logger.forComponent(`libp2p:webrtc:stream:${r}:${t.id}`),...e})}class N0{protocol;peerConnection;bufferedStreams=[];metrics;dataChannelOptions;components;log;constructor(e,t){this.components=e,this.peerConnection=t.peerConnection,this.metrics=t.metrics,this.protocol=t.protocol??Np,this.dataChannelOptions=t.dataChannelOptions??{},this.log=e.logger.forComponent("libp2p:webrtc:muxerfactory"),this.peerConnection.ondatachannel=({channel:t})=>{if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',t.id),"init"===t.label){this.log.trace("closing early init channel"),t.close();return}let r={},n=NX({channel:t,direction:"inbound",onEnd:e=>{r.onEnd(e)},logger:e.logger,...this.dataChannelOptions});r.stream=n,r.channel=t,r.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter(e=>e.stream.id!==n.id)},this.bufferedStreams.push(r)}}createStreamMuxer(e){return new N1(this.components,{...e,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol})}}class N1{init;streams;protocol;log;peerConnection;dataChannelOptions;metrics;logger;constructor(e,t){this.init=t,this.log=e.logger.forComponent("libp2p:webrtc:muxer"),this.logger=e.logger,this.streams=t.streams.map(e=>e.stream),this.peerConnection=t.peerConnection,this.protocol=t.protocol??Np,this.metrics=t.metrics,this.dataChannelOptions=t.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:e})=>{if(this.log.trace("incoming datachannel with channel id %d",e.id),"init"===e.label){this.log.trace("closing init channel"),e.close();return}let r=e.id,n=NX({channel:e,direction:"inbound",onEnd:()=>{this.#X(n,e),this.log("incoming channel %s ended",r)},logger:this.logger,...this.dataChannelOptions});this.streams.push(n),this.metrics?.increment({incoming_stream:!0}),t?.onIncomingStream?.(n)},this.init.streams.length>0&&queueMicrotask(()=>{this.init.streams.forEach(e=>{e.onEnd=()=>{this.log("incoming early channel %s ended with state %s",e.channel.id,e.channel.readyState),this.#X(e.stream,e.channel)},this.metrics?.increment({incoming_stream:!0}),this.init?.onIncomingStream?.(e.stream)})})}#X(e,t){this.log.trace("stream %s %s %s onEnd",e.direction,e.id,e.protocol),NO(t,`${e.direction} ${e.id} ${e.protocol}`,this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter(t=>t.id!==e.id),this.metrics?.increment({stream_end:!0}),this.init?.onStreamEnd?.(e)}async close(e){try{await Promise.all(this.streams.map(async t=>t.close(e)))}catch(e){this.abort(e)}}abort(e){for(let t of this.streams)t.abort(e)}source=NM();sink=NB;newStream(){let e=this.peerConnection.createDataChannel(""),t=e.id;this.log.trace("opened outgoing datachannel with channel id %s",t);let r=NX({channel:e,direction:"outbound",onEnd:()=>{this.#X(r,e),this.log("outgoing channel %s ended",t)},logger:this.logger,...this.dataChannelOptions});return this.streams.push(r),this.metrics?.increment({outgoing_stream:!0}),r}}let N2=globalThis.RTCPeerConnection,N3=globalThis.RTCSessionDescription,N4=globalThis.RTCIceCandidate;class N5 extends Error{constructor(e){super(`WebRTC transport error: ${e}`),this.name="WebRTCTransportError"}}class N6 extends N5{constructor(e="SDP handshake failed"){super(e),this.name="SDPHandshakeFailedError"}}class N8 extends N5{constructor(e,t){super(`Invalid fingerprint "${e}" within ${t}`),this.name="WebRTC/InvalidFingerprintError"}}class N7 extends N5{constructor(e){super(`A method (${e}) was called though it has been intentionally left unimplemented.`),this.name="WebRTC/UnimplementedError"}}class N9 extends N5{constructor(e){super(`unsupported hash algorithm code: ${e} please see the codes at https://github.com/multiformats/multicodec/blob/master/table.csv `),this.name="WebRTC/UnsupportedHashAlgorithmError"}}!function(e){let t,r,n;!function(e){e.SDP_OFFER="SDP_OFFER",e.SDP_ANSWER="SDP_ANSWER",e.ICE_CANDIDATE="ICE_CANDIDATE"}(t=e.Type||(e.Type={})),function(e){e[e.SDP_OFFER=0]="SDP_OFFER",e[e.SDP_ANSWER=1]="SDP_ANSWER",e[e.ICE_CANDIDATE=2]="ICE_CANDIDATE"}(r||(r={})),function(e){e.codec=()=>r$(r)}(t=e.Type||(e.Type={})),e.codec=()=>(null==n&&(n=rq((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.Type.codec().encode(t.type,r)),null!=t.data&&(r.uint32(18),r.string(t.data)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.type=e.Type.codec().decode(t);break;case 2:i.data=t.string();break;default:t.skipType(7&r)}}return i})),n),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(eq||(eq={}));let Me=async(e,t,r)=>{try{let n=(0,ao.A)();for(Mr(e,n);;){let i=await Promise.race([n.promise,t.read({signal:r.signal}).catch(()=>{})]);if(null==i){r.signal?.throwIfAborted();break}if(i.type!==eq.Type.ICE_CANDIDATE)throw new cD("ICE candidate message expected");let s=JSON.parse(i.data??"null");if(""===s||null===s){r.onProgress?.(new rY("webrtc:end-of-ice-candidates")),r.log.trace("end-of-candidates received");continue}let o=new N4(s);r.log.trace("%s received new ICE candidate %o",r.direction,s);try{r.onProgress?.(new rY("webrtc:add-ice-candidate",o.candidate)),await e.addIceCandidate(o)}catch(e){r.log.error("%s bad candidate received",r.direction,s,e)}}}catch(t){if(r.log.error("%s error parsing ICE candidate",r.direction,t),r.signal?.aborted===!0&&"connected"!==Mt(e))throw t}};function Mt(e){return NN?e.iceConnectionState:e.connectionState}function Mr(e,t){e[NN?"oniceconnectionstatechange":"onconnectionstatechange"]=r=>{switch(Mt(e)){case"connected":t.resolve();break;case"failed":case"disconnected":case"closed":t.reject(new cA("RTCPeerConnection was closed"))}}}async function Mn({rtcConfiguration:e,dataChannel:t,signal:r,metrics:n,multiaddr:i,connectionManager:s,transportManager:o,log:a,logger:l,onProgress:c}){let u,{baseAddr:d}=Ml(i);n?.dialerEvents.increment({open:!0}),a.trace("dialing base address: %a",d);let h=d.getPeerId();if(null==h)throw new cy("Relay peer was missing");let f=s.getConnections(gf(h)),p=!1;0===f.length?(c?.(new rY("webrtc:dial-relay")),u=await o.dial(d,{signal:r,onProgress:c}),p=!0):(c?.(new rY("webrtc:reuse-relay-connection")),u=f[0]);try{c?.(new rY("webrtc:open-signaling-stream"));let n=await u.newStream(Ng,{signal:r,runOnLimitedConnection:!0}),s=TC(n).pb(eq),o=new N2(e),d=new N0({logger:l},{peerConnection:o,dataChannelOptions:t});try{let e=o.createDataChannel("init");o.onicecandidate=({candidate:e})=>{let t=JSON.stringify(e?.toJSON()??null);a.trace("initiator sending ICE candidate %o",e),s.write({type:eq.Type.ICE_CANDIDATE,data:t},{signal:r}).catch(e=>{a.error("error sending ICE candidate",e)})},o.onicecandidateerror=e=>{a.error("initiator ICE candidate error",e)};let t=await o.createOffer().catch(e=>{throw a.error("could not execute createOffer",e),new N6("Failed to set createOffer")});a.trace("initiator send SDP offer %s",t.sdp),c?.(new rY("webrtc:send-sdp-offer")),await s.write({type:eq.Type.SDP_OFFER,data:t.sdp},{signal:r}),await o.setLocalDescription(t).catch(e=>{throw a.error("could not execute setLocalDescription",e),new N6("Failed to set localDescription")}),c?.(new rY("webrtc:read-sdp-answer")),a.trace("initiator read SDP answer");let l=await s.read({signal:r});if(l.type!==eq.Type.SDP_ANSWER)throw new N6("Remote should send an SDP answer");a.trace("initiator received SDP answer %s",l.data);let u=new N3({type:"answer",sdp:l.data});return await o.setRemoteDescription(u).catch(e=>{throw a.error("could not execute setRemoteDescription",e),new N6("Failed to set remoteDescription")}),a.trace("initiator read candidates until connected"),c?.(new rY("webrtc:read-ice-candidates")),await Me(o,s,{direction:"initiator",signal:r,log:a,onProgress:c}),a.trace("initiator connected, closing init channel"),e.close(),c?.(new rY("webrtc:close-signaling-stream")),a.trace("closing signaling channel"),await n.close({signal:r}),a.trace("initiator connected to remote address %s",i),{remoteAddress:i,peerConnection:o,muxerFactory:d}}catch(e){throw a.error("outgoing signaling error",e),o.close(),n.abort(e),e}finally{o.onicecandidate=null,o.onicecandidateerror=null}}finally{if(p)try{await u.close({signal:r})}catch(e){u.abort(e)}}}let Mi=mf(mz.matchers[0],ms("p2p-circuit"));class Ms extends cf{transportManager;shutdownController;events;constructor(e,t){super(),this.transportManager=e.transportManager,this.events=e.events,this.shutdownController=t.shutdownController,this.onTransportListening=this.onTransportListening.bind(this)}async listen(){this.events.addEventListener("transport:listening",this.onTransportListening)}onTransportListening(e){e.detail.getAddrs().filter(e=>Mi.exactMatch(e)).map(e=>e.encapsulate("/webrtc")).length>0&&this.safeDispatchEvent("listening")}getAddrs(){return this.transportManager.getListeners().filter(e=>!(e instanceof Ms)).map(e=>e.getAddrs().filter(e=>Mi.exactMatch(e)).map(e=>e.encapsulate("/webrtc"))).flat()}updateAnnounceAddrs(){}async close(){this.events.removeEventListener("transport:listening",this.onTransportListening),this.shutdownController.abort(),queueMicrotask(()=>{this.safeDispatchEvent("close")})}}async function Mo({peerConnection:e,stream:t,signal:r,connection:n,log:i}){i.trace("new inbound signaling stream");let s=TC(t).pb(eq);try{e.onicecandidate=({candidate:e})=>{let t=JSON.stringify(e?.toJSON()??null);i.trace("recipient sending ICE candidate %s",t),s.write({type:eq.Type.ICE_CANDIDATE,data:t},{signal:r}).catch(e=>{i.error("error sending ICE candidate",e)})},i.trace("recipient read SDP offer");let t=await s.read({signal:r});if(t.type!==eq.Type.SDP_OFFER)throw new N6(`expected message type SDP_OFFER, received: ${t.type??"undefined"} `);i.trace("recipient received SDP offer %s",t.data);let n=new N3({type:"offer",sdp:t.data});await e.setRemoteDescription(n).catch(e=>{throw i.error("could not execute setRemoteDescription",e),new N6("Failed to set remoteDescription")});let o=await e.createAnswer().catch(e=>{throw i.error("could not execute createAnswer",e),new N6("Failed to create answer")});i.trace("recipient send SDP answer %s",o.sdp),await s.write({type:eq.Type.SDP_ANSWER,data:o.sdp},{signal:r}),await e.setLocalDescription(o).catch(e=>{throw i.error("could not execute setLocalDescription",e),new N6("Failed to set localDescription")}),i.trace("recipient read candidates until connected"),await Me(e,s,{direction:"recipient",signal:r,log:i})}catch(t){if("connected"!==Mt(e))throw i.error("error while handling signaling stream from peer %a",n.remoteAddr,t),e.close(),t;i("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",n.remoteAddr,t)}let o=yz(`/webrtc/p2p/${n.remoteAddr.getPeerId()}`);return i.trace("recipient connected to remote address %s",o),{remoteAddress:o}}class Ma{components;init;log;_started=!1;metrics;shutdownController;constructor(e,t={}){this.components=e,this.init=t,this.log=e.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,this.shutdownController.signal,null!=e.metrics&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}[Au]=!0;[Symbol.toStringTag]="@libp2p/webrtc";[vs]=["@libp2p/transport"];[vo]=["@libp2p/identify","@libp2p/circuit-relay-v2-transport"];isStarted(){return this._started}async start(){await this.components.registrar.handle(Ng,e=>{let t=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);this._onProtocol(e,t).catch(t=>{this.log.error("failed to handle incoming connect from %p",e.connection.remotePeer,t)}).finally(()=>{t.clear()})},{runOnLimitedConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(Ng),this._started=!1}createListener(e){return new Ms(this.components,{shutdownController:this.shutdownController})}listenFilter(e){return e.filter(mG.exactMatch)}dialFilter(e){return this.listenFilter(e)}async dial(e,t){this.log.trace("dialing address: %a",e);let{remoteAddress:r,peerConnection:n,muxerFactory:i}=await Mn({rtcConfiguration:await NL(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:e,dataChannelOptions:this.init.dataChannel,signal:t.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:t.onProgress}),s=new NU(this.components,{peerConnection:n,timeline:{open:Date.now()},remoteAddr:r,metrics:this.metrics?.dialerEvents}),o=await t.upgrader.upgradeOutbound(s,{skipProtection:!0,skipEncryption:!0,muxerFactory:i,onProgress:t.onProgress,signal:t.signal});return this._closeOnShutdown(n,s),o}async _onProtocol({connection:e,stream:t},r){let n=new N2(await NL(this.init.rtcConfiguration)),i=new N0(this.components,{peerConnection:n,dataChannelOptions:this.init.dataChannel});try{let{remoteAddress:s}=await Mo({peerConnection:n,connection:e,stream:t,signal:r,log:this.log});await t.close({signal:r});let o=new NU(this.components,{peerConnection:n,timeline:{open:new Date().getTime()},remoteAddr:s,metrics:this.metrics?.listenerEvents});await this.components.upgrader.upgradeInbound(o,{skipEncryption:!0,skipProtection:!0,muxerFactory:i,signal:r}),this._closeOnShutdown(n,o)}catch(e){throw this.log.error("incoming signaling error",e),n.close(),t.abort(e),e}}_closeOnShutdown(e,t){let r=()=>{t.close().catch(e=>{this.log.error("could not close WebRTCMultiaddrConnection",e)})};this.shutdownController.signal.addEventListener("abort",r),e.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",r)})}}function Ml(e){let t=e.toString().split("/webrtc/");if(2!==t.length)throw new cy("webrtc protocol was not present in multiaddr");if(!t[0].includes("/p2p-circuit"))throw new cy("p2p-circuit protocol was not present in multiaddr");let r=yz(t[0]),n=yz("/"+t[1]).getPeerId();if(null==n)throw new cy("destination peer id was missing");let i=r.protos().pop();if(void 0===i)throw new cy("invalid multiaddr");return"p2p"!==i.name&&(r=r.encapsulate(`/p2p/${n}`)),{baseAddr:r,peerId:gf(n)}}class Mc extends cf{async listen(){throw new N7("WebRTCTransport.createListener")}getAddrs(){return[]}updateAnnounceAddrs(){}async close(){}}let Mu=Object.values(ye.Fo).map(e=>e.decoder).reduce((e,t)=>e.or(t)),Md=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function Mh(e){if(null==e)return;let t=e.match(Md);return t?.groups?.fingerprint}function Mf(e){let t=e.stringTuples().filter(e=>e[0]===No).map(e=>e[1])[0];if(void 0===t||""===t)throw new cy(`Couldn't find a certhash component of multiaddr: ${e.toString()}`);return t}function Mp(e){return ye.br.decode(Mu.decode(e))}function Mg(e){let t=Mp(Mf(e)),r=My(t.code),n=t.digest.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),""),i=n.match(/.{1,2}/g);if(null==i)throw new N8(n,e.toString());return`${r} ${i.join(":").toUpperCase()}`}function Mm(e){let t=e.split(":").map(e=>parseInt(e,16)),r=Uint8Array.from(t),n=o0.create(rX.sha256.code,r);return yz(`/certhash/${oN.base64url.encode(n.bytes)}`)}function My(e){switch(e){case 17:return"sha-1";case 18:return"sha-256";case 19:return"sha-512";default:throw new N9(e)}}function Mb(e,t){let{host:r,port:n,family:i}=e.toOptions(),s=Mg(e);return{type:"answer",sdp:`v=0
o=- 0 0 IN IP${i} ${r}
s=-
t=0 0
a=ice-lite
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
c=IN IP${i} ${r}
a=mid:0
a=ice-options:ice2
a=ice-ufrag:${t}
a=ice-pwd:${t}
a=fingerprint:${s}
a=setup:passive
a=sctp-port:5000
a=max-message-size:${Nc}
a=candidate:1467250027 1 UDP 1467250027 ${r} ${n} typ host
a=end-of-candidates
`}}function Mw(e,t){let{host:r,port:n,family:i}=e.toOptions();return{type:"offer",sdp:`v=0
o=- 0 0 IN IP${i} ${r}
s=-
c=IN IP${i} ${r}
t=0 0
a=ice-options:ice2,trickle
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:active
a=ice-ufrag:${t}
a=ice-pwd:${t}
a=fingerprint:sha-256 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
a=sctp-port:5000
a=max-message-size:${Nc}
a=candidate:1467250027 1 UDP 1467250027 ${r} ${n} typ host
a=end-of-candidates
`}}function Mv(e,t){if(void 0===e.sdp)throw new cy("Can't munge a missing SDP");let r=e.sdp.includes("\r\n")?"\r\n":"\n";return e.sdp=e.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,"\na=ice-ufrag:"+t+r).replace(/\na=ice-pwd:[^\n]*\n/,"\na=ice-pwd:"+t+r),e}let ME=(0,rx.s)("libp2p-webrtc-noise:");function MA(e,t,r){let n=e.trim().toLowerCase().replaceAll(":",""),i=(0,rx.s)(n,"hex"),s=o0.create(rX.sha256.code,i),o=Mu.decode(Mf(t)),a=ME.byteLength+s.bytes.byteLength+o.byteLength;return"server"===r?tl([ME,o,s.bytes],a):tl([ME,s.bytes,o],a)}let Mx=NN?"iceconnectionstatechange":"connectionstatechange";async function MS(e,t,r){let n=e.createDataChannel("",{negotiated:!0,id:0});if("client"===r.role){r.log.trace("client creating local offer");let n=await e.createOffer();r.log.trace("client created local offer %s",n.sdp);let i=Mv(n,t);r.log.trace("client setting local offer %s",i.sdp),await e.setLocalDescription(i);let s=Mb(r.remoteAddr,t);r.log.trace("client setting server description %s",s.sdp),await e.setRemoteDescription(s)}else{let n=Mw(r.remoteAddr,t);r.log.trace("server setting client %s %s",n.type,n.sdp),await e.setRemoteDescription(n),r.log.trace("server creating local answer");let i=await e.createAnswer();r.log.trace("server created local answer");let s=Mv(i,t);r.log.trace("server setting local description %s",i.sdp),await e.setLocalDescription(s)}if(r.log.trace("%s wait for handshake channel to open",r.role),await cq(n,"open",r.signal),r.log.trace("%s handshake channel opened",r.role),"server"===r.role){let t=e.remoteFingerprint()?.value??"";r.remoteAddr=r.remoteAddr.encapsulate(Mm(t))}let i=Mh(e.localDescription?.sdp);if(null==i)throw new N5("Could not get fingerprint from local description sdp");r.log.trace("%s performing noise handshake",r.role);let s=Im({prologueBytes:MA(i,r.remoteAddr,r.role)})(r),o=NX({channel:n,direction:"inbound",logger:r.logger,...r.dataChannel??{}}),a={...o,sink:o.sink.bind(o),source:async function*(){for await(let e of o.source)for(let t of e)yield t}()},l=new NU(r,{peerConnection:e,remoteAddr:r.remoteAddr,timeline:{open:Date.now()},metrics:r.events});e.addEventListener(Mx,()=>{switch(e.connectionState){case"failed":case"disconnected":case"closed":l.close().catch(e=>{r.log.error("error closing connection",e),l.abort(e)})}}),r.events?.increment({peer_connection:!0});let c=new N0(r,{peerConnection:e,metrics:r.events,dataChannelOptions:r.dataChannel});if("client"===r.role)return r.log.trace("%s secure inbound",r.role),await s.secureInbound(a,{remotePeer:r.remotePeerId,signal:r.signal}),r.log.trace("%s upgrade outbound",r.role),r.upgrader.upgradeOutbound(l,{skipProtection:!0,skipEncryption:!0,muxerFactory:c,signal:r.signal});r.log.trace("%s secure outbound",r.role);let u=await s.secureOutbound(a,{remotePeer:r.remotePeerId,signal:r.signal});l.remoteAddr=l.remoteAddr.encapsulate(`/p2p/${u.remotePeer}`),r.log.trace("%s upgrade inbound",r.role),await r.upgrader.upgradeInbound(l,{skipProtection:!0,skipEncryption:!0,muxerFactory:c,signal:r.signal})}async function Mk(e,t,r,n){return null==n&&(n=await RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256"})),new RTCPeerConnection({...("function"==typeof r?await r():r)??{},certificates:[n]})}class M_{log;metrics;components;init;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:webrtc-direct"),this.components=e,this.init=t,null!=e.metrics&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}[Au]=!0;[Symbol.toStringTag]="@libp2p/webrtc-direct";[vs]=["@libp2p/transport"];async dial(e,t){let r=await this._connect(e,t);return this.log("dialing address: %a",e),r}createListener(e){return new Mc(this.components,{...this.init,...e})}listenFilter(e){return e.filter(mj.exactMatch)}dialFilter(e){return this.listenFilter(e)}async _connect(e,t){let r;t.signal.throwIfAborted();let n=e.getPeerId();null!=n&&(r=gf(n));let i=NF(),s=await Mk("client",i,"function"==typeof this.init.rtcConfiguration?await this.init.rtcConfiguration():this.init.rtcConfiguration??{});try{return await (0,cG.W)(MS(s,i,{role:"client",log:this.log,logger:this.components.logger,metrics:this.components.metrics,events:this.metrics?.dialerEvents,signal:t.signal,remoteAddr:e,dataChannel:this.init.dataChannel,upgrader:t.upgrader,peerId:this.components.peerId,remotePeerId:r,privateKey:this.components.privateKey}),t.signal)}catch(e){throw s.close(),e}}}function MI(e){return t=>new M_(t,e)}function MT(e){return t=>new Ma(t,e)}let MC=async e=>{if(e.readyState>=2)throw Error("socket closed");1!==e.readyState&&await new Promise((t,r)=>{function n(){e.removeEventListener("open",i),e.removeEventListener("error",s)}function i(){n(),t()}function s(t){n(),r(t.error??Error(`connect ECONNREFUSED ${e.url}`))}e.addEventListener("open",i),e.addEventListener("error",s)})},MP=(e,t)=>((t=t??{}).closeOnEnd=!1!==t.closeOnEnd,async r=>{for await(let t of r){try{await MC(e)}catch(e){if("socket closed"===e.message)break;throw e}if(e.readyState===e.CLOSING||e.readyState===e.CLOSED)break;e.send(t)}null!=t.closeOnEnd&&e.readyState<=1&&await new Promise((t,r)=>{e.addEventListener("close",e=>{e.wasClean||1006===e.code?t():r(Object.assign(Error("ws error"),{event:e}))}),setTimeout(()=>{e.close()})})});var MR=r(77481);function MD(e){return e instanceof ArrayBuffer||e?.constructor?.name==="ArrayBuffer"&&"number"==typeof e?.byteLength}let MN=e=>{let t;e.binaryType="arraybuffer";let r=async()=>{await new Promise((r,n)=>{if(i)return void r();if(null!=t)return void n(t);let s=t=>{e.removeEventListener("open",o),e.removeEventListener("error",a),t()},o=()=>{s(r)},a=t=>{s(()=>{n(t.error??Error(`connect ECONNREFUSED ${e.url}`))})};e.addEventListener("open",o),e.addEventListener("error",a)})},n=async function*(){let t=new MR.PP(({push:t,stop:r,fail:n})=>{let i=e=>{let r=null;"string"==typeof e.data&&(r=(0,rx.s)(e.data)),MD(e.data)&&(r=new Uint8Array(e.data)),e.data instanceof Uint8Array&&(r=e.data),null!=r&&t(r)},s=e=>{n(e.error??Error("Socket error"))};return e.addEventListener("message",i),e.addEventListener("error",s),e.addEventListener("close",r),()=>{e.removeEventListener("message",i),e.removeEventListener("error",s),e.removeEventListener("close",r)}},{highWaterMark:1/0});for await(let e of(await r(),t))yield MD(e)?new Uint8Array(e):e}(),i=1===e.readyState;return e.addEventListener("open",()=>{i=!0,t=null}),e.addEventListener("close",()=>{i=!1,t=null}),e.addEventListener("error",r=>{i||(t=r.error??Error(`connect ECONNREFUSED ${e.url}`))}),Object.assign(n,{connected:r})},MM=(e,t)=>{t=t??{};let r=MN(e),n=t.remoteAddress,i=t.remotePort;if(null!=e.url)try{let t=new URL(e.url);n=t.hostname,i=parseInt(t.port,10)}catch{}if(null==n||null==i)throw Error("Remote connection did not have address and/or port");return{sink:MP(e,t),source:r,connected:async()=>{await r.connected()},close:async()=>{(e.readyState===e.CONNECTING||e.readyState===e.OPEN)&&await new Promise(t=>{e.addEventListener("close",()=>{t()}),e.close()})},destroy:()=>{null!=e.terminate?e.terminate():e.close()},remoteAddress:n,remotePort:i,socket:e}},MB=WebSocket,MO={"http:":"ws:","https:":"wss:"},ML="ws:",MF=(e,t)=>{if(e.startsWith("//")&&(e=`${t?.protocol??ML}${e}`),e.startsWith("/")&&null!=t){let r=t.protocol??ML,n=t.host,i=null!=t.port&&n?.endsWith(`:${t.port}`)!==!0?`:${t.port}`:"";e=`${r}//${n}${i}${e}`}let r=new URL(e);for(let[e,t]of Object.entries(MO))r.protocol===e&&(r.protocol=t);return r};function MU(e,t){return t=t??{},MM(new MB(MF(e,"undefined"==typeof window?void 0:window.location).toString(),t.websocket),t)}function Mj(e){return e.filter(e=>mF.exactMatch(e)||mO.exactMatch(e))}function MH(){throw Error("WebSocket Servers can not be created in the browser!")}let M$=500;function Mq(e,t,r){let n=r.logger.forComponent("libp2p:websockets:maconn"),i=r.metrics,s=r.metricPrefix??"",o={log:n,async sink(t){try{await e.sink(async function*(){for await(let e of t)e instanceof Uint8Array?yield e:yield e.subarray()}())}catch(e){"aborted"!==e.type&&n.error(e)}},source:e.source,remoteAddr:t,timeline:{open:Date.now()},async close(t={}){let r=Date.now();if(null==t.signal){let e=AbortSignal.timeout(M$);t={...t,signal:e}}let i=()=>{let{host:e,port:t}=o.remoteAddr.toOptions();n("timeout closing stream to %s:%s after %dms, destroying it manually",e,t,Date.now()-r),this.abort(new cp("Socket close timeout"))};t.signal?.addEventListener("abort",i);try{await e.close()}catch(e){n.error("error closing WebSocket gracefully",e),this.abort(e)}finally{t.signal?.removeEventListener("abort",i),o.timeline.close=Date.now()}},abort(t){let{host:r,port:a}=o.remoteAddr.toOptions();n("timeout closing stream to %s:%s due to error",r,a,t),e.destroy(),o.timeline.close=Date.now(),i?.increment({[`${s}error`]:!0})}};return e.socket.addEventListener("close",()=>{i?.increment({[`${s}close`]:!0}),null==o.timeline.close&&(o.timeline.close=Date.now())},{once:!0}),o}class Mz{log;init;logger;metrics;components;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:websockets"),this.logger=e.logger,this.components=e,this.init=t,null!=e.metrics&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_websockets_dialer_events_total",{label:"event",help:"Total count of WebSockets dialer events by type"})})}[Au]=!0;[Symbol.toStringTag]="@libp2p/websockets";[vs]=["@libp2p/transport"];async dial(e,t){this.log("dialing %s",e),t=t??{};let r=Mq(await this._connect(e,t),e,{logger:this.logger,metrics:this.metrics?.dialerEvents});this.log("new outbound connection %s",r.remoteAddr);let n=await t.upgrader.upgradeOutbound(r,t);return this.log("outbound connection %s upgraded",r.remoteAddr),n}async _connect(e,t){t?.signal?.throwIfAborted();let r=e.toOptions();this.log("dialing %s:%s",r.host,r.port);let n=(0,ao.A)(),i=MU(yY(e),this.init);i.socket.addEventListener("error",()=>{let t=new cA(`Could not connect to ${e.toString()}`);this.log.error("connection error:",t),this.metrics?.dialerEvents.increment({error:!0}),n.reject(t)});try{t.onProgress?.(new rY("websockets:open-connection")),await (0,cG.W)(Promise.race([i.connected(),n.promise]),t.signal)}catch(e){throw t.signal?.aborted&&this.metrics?.dialerEvents.increment({abort:!0}),i.close().catch(e=>{this.log.error("error closing raw socket",e)}),e}return this.log("connected %s",e),this.metrics?.dialerEvents.increment({connect:!0}),i}createListener(e){return MH({logger:this.logger,events:this.components.events,metrics:this.components.metrics},{...this.init,...e})}listenFilter(e){return(e=Array.isArray(e)?e:[e],this.init?.filter!=null)?this.init?.filter(e):Mj(e)}dialFilter(e){return this.listenFilter(e)}}function MV(e={}){return t=>new Mz(t,e)}function MG(e,t){let r=t.map((e,t)=>({record:Te(e),index:t}));return r.sort((e,t)=>{let r=e.record.sequence,n=t.record.sequence;if(r>n)return -1;if(r<n)return 1;if(e.record.validityType===ey.ValidityType.EOL&&t.record.validityType===ey.ValidityType.EOL){let r=Tl.fromString(e.record.validity).toDate(),n=Tl.fromString(t.record.validity).toDate();if(r.getTime()>n.getTime())return -1;if(r.getTime()<n.getTime())return 1}return 0}),r[0].index}let MK="5.3.0",MW="helia",MQ={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dnsaddr/va1.bootstrap.libp2p.io/p2p/12D3KooWKnDdG3iXw9eTFijk3EWSunZcFi54Zka4wmtqtt6rPxc8","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};function MJ(e={}){let t=`${MW}/${MK} ${kL()}`;return{privateKey:e.privateKey,dns:e.dns,nodeInfo:{userAgent:t},addresses:{listen:["/p2p-circuit","/webrtc"]},transports:[CW(),MT(),MI(),MV()],connectionEncrypters:[Im()],streamMuxers:[IW(),D3()],peerDiscovery:[Cp(MQ)],services:{autoNAT:TH(),dcutr:C1(),delegatedRouting:()=>TS("https://delegated-ipfs.dev",Tk()),dht:Ds({clientMode:!0,validators:{ipns:Th},selectors:{ipns:MG}}),identify:Pa(),identifyPush:Pl(),keychain:DD(e.keychain),ping:Nr()}}}async function MZ(e){let t=e.libp2p??{};null==t.privateKey&&null!=e.datastore&&(t.privateKey=await Ac(e.datastore,e.keychain));let r=MJ(t);return r.datastore=r.datastore??e.datastore,await kU({...r,...t,start:!1})}async function MY(e={}){let t,r=e.datastore??new bL.bk,n=e.blockstore??new bO.ED;t=MX(e.libp2p)?e.libp2p:await MZ({...e,libp2p:{dns:e.dns,...e.libp2p,start:void 0},datastore:r});let i=new wY({...e,libp2p:t,datastore:r,blockstore:n,blockBrokers:e.blockBrokers??[y8(),gK()],routers:e.routers??[y9(t),bB()],metrics:t.metrics});return!1!==e.start&&await i.start(),i}function MX(e){return null!=e&&["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"].every(t=>"function"==typeof e[t])}var M0=r(40662),M1=r(59615);let M2=(...e)=>e.join("/").replace(/((?<=\/)\/+)|(^\.\/)|((?<=\/)\.\/)/g,"")||".",M3=M2,M4=3e4,M5=async({ipfs:e,log:t,events:r,onSynced:n,start:i,timeout:s})=>{if(!e)throw Error("An instance of ipfs is required.");if(!t)throw Error("An instance of log is required.");let o=e.libp2p,a=e.libp2p.services.pubsub,l=t.id,c=M3("/orbitdb/heads/",l),u=new av({concurrency:1}),d=new Set;r=r||new M0.EventEmitter,s=s||M4;let h=!1,f=async e=>{let n=await t.heads();r.emit("join",e,n)},p=e=>(async function*(){for await(let{bytes:e}of(await t.heads()))yield e})(),g=e=>async t=>{for await(let e of t){let t=e.subarray();t&&n&&await n(t)}h&&await f(e)},m=async({connection:e,stream:t})=>{let n=String(e.remotePeer);try{d.add(n),await (0,ac.F)(t,g(n),p,t)}catch(e){d.delete(n),r.emit("error",e)}},y=async e=>{let t=async()=>{let{peerId:t,subscriptions:n}=e.detail,i=String(t),a=n.find(e=>e.topic===l);if(a)if(a.subscribe){if(d.has(i))return;let e=new M1.TimeoutController(s),{signal:n}=e;try{d.add(i);let e=await o.dialProtocol(t,c,{signal:n});await (0,ac.F)(p,e,g(i))}catch(e){d.delete(i),"UnsupportedProtocolError"===e.name||r.emit("error",e)}finally{e&&e.clear()}}else d.delete(i),r.emit("leave",i)};u.add(t)},b=async e=>{let{topic:t,data:i}=e.detail,s=async()=>{try{i&&n&&await n(i)}catch(e){r.emit("error",e)}};t===l&&u.add(s)},w=async e=>{d.delete(e.detail.toString())},v=async e=>{h&&await a.publish(l,e.bytes)},E=async()=>{h&&(h=!1,await u.onIdle(),a.removeEventListener("subscription-change",y),a.removeEventListener("message",b),await o.unhandle(c),await a.unsubscribe(l),o.removeEventListener("peer:disconnect",w),d.clear())},A=async()=>{h||(await o.handle(c,m),a.addEventListener("subscription-change",y),a.addEventListener("message",b),await a.subscribe(l),o.addEventListener("peer:disconnect",w),h=!0)};return!1!==i&&await A(),{add:v,stop:E,start:A,events:r,peers:d}};var M6=r(52647);let M8=(e,t)=>{let r=e.time-t.time;return 0===r&&e.id!==t.id?e.id<t.id?-1:1:r},M7=e=>M9(e.id,++e.time),M9=(e,t)=>({id:e,time:t=t||0});new Uint8Array(0);let Be=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},Bt=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw Error("Unknown type, must be binary type")},Br=function(e,t){if(e.length>=255)throw TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw TypeError(s+" is ambiguous");r[o]=i}var a=e.length,l=e.charAt(0),c=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(e){if("string"!=typeof e)throw TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[0]){for(var n=0,i=0;e[t]===l;)n++,t++;for(var s=(e.length-t)*c+1>>>0,o=new Uint8Array(s);e[t];){var u=r[e.charCodeAt(t)];if(255===u)return;for(var d=0,h=s-1;(0!==u||d<i)&&-1!==h;h--,d++)u+=a*o[h]>>>0,o[h]=u%256>>>0,u=u/256>>>0;if(0!==u)throw Error("Non-zero carry");i=d,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),g=n;f!==s;)p[g++]=o[f++];return p}}}function h(e){var r=d(e);if(r)return r;throw Error(`Non-${t} character`)}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*u+1>>>0,c=new Uint8Array(o);i!==s;){for(var d=t[i],h=0,f=o-1;(0!==d||h<n)&&-1!==f;f--,h++)d+=256*c[f]>>>0,c[f]=d%a>>>0,d=d/a>>>0;if(0!==d)throw Error("Non-zero carry");n=h,i++}for(var p=o-n;p!==o&&0===c[p];)p++;for(var g=l.repeat(r);p<o;++p)g+=e.charAt(c[p]);return g},decodeUnsafe:d,decode:h}};class Bn{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Bi{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return Bo(this,e)}}class Bs{constructor(e){this.decoders=e}or(e){return Bo(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let Bo=(e,t)=>new Bs({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class Ba{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new Bn(e,t,r),this.decoder=new Bi(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}let Bl=({name:e,prefix:t,encode:r,decode:n})=>new Ba(e,t,r,n),Bc=({prefix:e,name:t,alphabet:r})=>{let{encode:n,decode:i}=Br(r,t);return Bl({prefix:e,name:t,encode:n,decode:e=>Bt(i(e))})},Bu=(e,t,r,n)=>{let i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;let o=new Uint8Array(s*r/8|0),a=0,l=0,c=0;for(let t=0;t<s;++t){let s=i[e[t]];if(void 0===s)throw SyntaxError(`Non-${n} character`);l=l<<r|s,(a+=r)>=8&&(a-=8,o[c++]=255&l>>a)}if(a>=r||255&l<<8-a)throw SyntaxError("Unexpected end of data");return o},Bd=(e,t,r)=>{let n="="===t[t.length-1],i=(1<<r)-1,s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},Bh=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>Bl({prefix:t,name:e,encode:e=>Bd(e,n,r),decode:t=>Bu(t,n,r,e)}),Bf=Bh({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Bh({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Bh({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Bh({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Bh({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Bh({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Bh({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Bh({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Bh({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});let Bp=Bc({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Bc({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Bg=128,Bm=-128,By=0x80000000;function Bb(e,t,r){t=t||[];for(var n=r=r||0;e>=By;)t[r++]=255&e|Bg,e/=128;for(;e&Bm;)t[r++]=255&e|Bg,e>>>=7;return t[r]=0|e,Bb.bytes=r-n+1,t}var Bw=128,Bv=127;function BE(e,t){var r,n=0,t=t||0,i=0,s=t,o=e.length;do{if(s>=o)throw BE.bytes=0,RangeError("Could not decode varint");r=e[s++],n+=i<28?(r&Bv)<<i:(r&Bv)*Math.pow(2,i),i+=7}while(r>=Bw);return BE.bytes=s-t,n}var BA=128,Bx=16384,BS=2097152,Bk=0x10000000,B_=0x800000000,BI=0x40000000000,BT=0x2000000000000,BC=0x100000000000000,BP=0x8000000000000000;let BR={encode:Bb,decode:BE,encodingLength:function(e){return e<BA?1:e<Bx?2:e<BS?3:e<Bk?4:e<B_?5:e<BI?6:e<BT?7:e<BC?8:e<BP?9:10}},BD=(e,t=0)=>[BR.decode(e,t),BR.decode.bytes],BN=(e,t,r=0)=>(BR.encode(e,t,r),t),BM=e=>BR.encodingLength(e),BB=(e,t)=>{let r=t.byteLength,n=BM(e),i=n+BM(r),s=new Uint8Array(i+r);return BN(e,s,0),BN(r,s,n),s.set(t,i),new BF(e,r,t,s)},BO=e=>{let t=Bt(e),[r,n]=BD(t),[i,s]=BD(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw Error("Incorrect length");return new BF(r,i,o,t)},BL=(e,t)=>{if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&Be(e.bytes,r.bytes)}};class BF{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}let BU=(e,t)=>{let{bytes:r,version:n}=e;return 0===n?Bz(r,BH(e),t||Bp.encoder):BV(r,BH(e),t||Bf.encoder)},Bj=new WeakMap,BH=e=>{let t=Bj.get(e);if(null==t){let t=new Map;return Bj.set(e,t),t}return t};class B${constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==BG)throw Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==BK)throw Error("Cannot convert non sha2-256 multihash CID to CIDv0");return B$.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,r=BB(e,t);return B$.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return B$.equals(this,e)}static equals(e,t){let r=t;return r&&e.code===r.code&&e.version===r.version&&BL(e.multihash,r.multihash)}toString(e){return BU(this,e)}toJSON(){return{"/":BU(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;let t=e;if(t instanceof B$)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){let{version:e,code:r,multihash:n,bytes:i}=t;return new B$(e,r,n,i||BW(e,r,n.bytes))}if(!0!==t[BQ])return null;{let{version:e,multihash:r,code:n}=t,i=BO(r);return B$.create(e,n,i)}}static create(e,t,r){if("number"!=typeof t)throw Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw Error("Invalid digest");switch(e){case 0:if(t===BG)return new B$(e,t,r,r.bytes);throw Error(`Version 0 CID must use dag-pb (code: ${BG}) block encoding`);case 1:{let n=BW(e,t,r.bytes);return new B$(e,t,r,n)}default:throw Error("Invalid version")}}static createV0(e){return B$.create(0,BG,e)}static createV1(e,t){return B$.create(1,e,t)}static decode(e){let[t,r]=B$.decodeFirst(e);if(r.length)throw Error("Incorrect length");return t}static decodeFirst(e){let t=B$.inspectBytes(e),r=t.size-t.multihashSize,n=Bt(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw Error("Incorrect length");let i=n.subarray(t.multihashSize-t.digestSize),s=new BF(t.multihashCode,t.digestSize,i,n);return[0===t.version?B$.createV0(s):B$.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0,r=()=>{let[r,n]=BD(e.subarray(t));return t+=n,r},n=r(),i=BG;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw RangeError(`Invalid CID version ${n}`);let s=t,o=r(),a=r(),l=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:l-s,size:l}}static parse(e,t){let[r,n]=Bq(e,t),i=B$.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return BH(i).set(r,e),i}}let Bq=(e,t)=>{switch(e[0]){case"Q":{let r=t||Bp;return[Bp.prefix,r.decode(`${Bp.prefix}${e}`)]}case Bp.prefix:{let r=t||Bp;return[Bp.prefix,r.decode(e)]}case Bf.prefix:{let r=t||Bf;return[Bf.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},Bz=(e,t,r)=>{let{prefix:n}=r;if(n!==Bp.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let i=t.get(n);if(null!=i)return i;{let i=r.encode(e).slice(1);return t.set(n,i),i}},BV=(e,t,r)=>{let{prefix:n}=r,i=t.get(n);if(null!=i)return i;{let i=r.encode(e);return t.set(n,i),i}},BG=112,BK=18,BW=(e,t,r)=>{let n=BM(e),i=n+BM(t),s=new Uint8Array(i+r.byteLength);return BN(e,s,0),BN(t,s,n),s.set(r,i),s},BQ=Symbol.for("@ipld/js-cid/CID"),BJ=({name:e,code:t,encode:r})=>new BZ(e,t,r);class BZ{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?BB(this.code,t):t.then(e=>BB(this.code,e))}throw Error("Unknown type, must be binary type")}}function BY({enumerable:e=!0,configurable:t=!1}={}){return{enumerable:e,configurable:t,writable:!1}}function*BX(e,t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))for(let[r,n]of t.entries()){let t=[...e,r],i=B$.asCID(n);i?yield[t.join("/"),i]:"object"==typeof n&&(yield*B0(n,t))}else{let r=B$.asCID(t);r?yield[e.join("/"),r]:yield*B0(t,e)}}function*B0(e,t){if(null==e||e instanceof Uint8Array)return;let r=B$.asCID(e);for(let[n,i]of(r&&(yield[t.join("/"),r]),Object.entries(e))){let e=[...t,n];yield*BX(e,i)}}function*B1(e,t){if(Array.isArray(t))for(let[r,n]of t.entries()){let t=[...e,r];yield t.join("/"),"object"!=typeof n||B$.asCID(n)||(yield*B2(n,t))}else yield*B2(t,e)}function*B2(e,t){if(null!=e&&"object"==typeof e)for(let[r,n]of Object.entries(e)){let e=[...t,r];yield e.join("/"),null==n||n instanceof Uint8Array||"object"!=typeof n||B$.asCID(n)||(yield*B1(e,n))}}function B3(e,t){let r=e;for(let[e,n]of t.entries()){if(null==(r=r[n]))throw Error(`Object has no property at ${t.slice(0,e+1).map(e=>`[${JSON.stringify(e)}]`).join("")}`);let i=B$.asCID(r);if(i)return{value:i,remaining:t.slice(e+1).join("/")}}return{value:r}}class B4{constructor({cid:e,bytes:t,value:r}){if(!e||!t||void 0===r)throw Error("Missing required argument");this.cid=e,this.bytes=t,this.value=r,this.asBlock=this,Object.defineProperties(this,{cid:BY(),bytes:BY(),value:BY(),asBlock:BY()})}links(){return B0(this.value,[])}tree(){return B2(this.value,[])}get(e="/"){return B3(this.value,e.split("/").filter(Boolean))}}async function B5({value:e,codec:t,hasher:r}){if(void 0===e)throw Error('Missing required argument "value"');if(!t||!r)throw Error("Missing required argument: codec or hasher");let n=t.encode(e),i=await r.digest(n);return new B4({value:e,bytes:n,cid:B$.create(1,t.code,i)})}async function B6({bytes:e,codec:t,hasher:r}){if(!e)throw Error('Missing required argument "bytes"');if(!t||!r)throw Error("Missing required argument: codec or hasher");let n=t.decode(e),i=await r.digest(e);return new B4({value:n,bytes:e,cid:B$.create(1,t.code,i)})}let B8=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),B7=BJ({name:"sha2-256",code:18,encode:B8("SHA-256")});BJ({name:"sha2-512",code:19,encode:B8("SHA-512")});let B9=e9,Oe=B7,Ot=Bp,Or=e=>e&&void 0!==e.id&&void 0!==e.next&&void 0!==e.payload&&void 0!==e.v&&void 0!==e.clock&&void 0!==e.refs,On=async e=>{let{cid:t,bytes:r}=await B5({value:e,codec:B9,hasher:Oe}),n=t.toString(Ot),i=M9(e.clock.id,e.clock.time);return{...e,clock:i,hash:n,bytes:r}},Oi={create:async(e,t,r,n=null,i=[],s=[])=>{if(null==e)throw Error("Identity is required, cannot create entry");if(null==t)throw Error("Entry requires an id");if(null==r)throw Error("Entry requires a payload");if(null==i||!Array.isArray(i))throw Error("'next' argument is not an array");let o={id:t,payload:r,next:i,refs:s,clock:n=n||M9(e.publicKey),v:2},{bytes:a}=await B5({value:o,codec:B9,hasher:Oe}),l=await e.sign(e,a);return o.key=e.publicKey,o.identity=e.hash,o.sig=l,On(o)},verify:async(e,t)=>{if(!e)throw Error("Identities is required, cannot verify entry");if(!Or(t))throw Error("Invalid Log entry");if(!t.key)throw Error("Entry doesn't have a key");if(!t.sig)throw Error("Entry doesn't have a signature");let r={id:t.id,payload:t.payload,next:t.next,refs:t.refs,clock:t.clock,v:t.v},{bytes:n}=await B5({value:r,codec:B9,hasher:Oe});return e.verify(t.sig,t.key,n)},decode:async e=>{let{cid:t,value:r}=await B6({bytes:e,codec:B9,hasher:Oe}),n=t.toString(Ot);return{...r,hash:n,bytes:e}},isEqual:(e,t)=>e&&t&&e.hash===t.hash},Os=async()=>{let e={},t=async(t,r)=>{e[t]=r},r=async e=>{if(e)for await(let[r,n]of e.iterator())t(r,n)};return{put:t,del:async t=>{delete e[t]},get:async t=>e[t],iterator:async function*(){for await(let[t,r]of Object.entries(e))yield[t,r]},merge:r,clear:async()=>{e={}},close:async()=>{}}},Oo=Os,Oa=e=>{e=new Set(e);let t={};for(let r of e)for(let e of r.next)t[e]=r.hash;let r=[];for(let n of e)t[n.hash]||r.push(n);return r},Ol=async({storage:e,heads:t})=>{e=e||await Oo();let r=async t=>{for(let r of t=Oa(t))await e.put(r.hash,r.bytes)},n=async t=>{await e.clear(),await r(t)},i=async e=>{let t=await a();if(t.find(t=>Oi.isEqual(t,e)))return;let r=Oa([...t,e]);return await n(r),r},s=async e=>{let t=(await a()).filter(t=>t.hash!==e);await n(t)},o=async function*(){for await(let[,t]of e.iterator()){let e=await Oi.decode(t);yield e}},a=async()=>{let e=[];for await(let t of o())e.push(t);return e},l=async()=>{await e.clear()},c=async()=>{await e.close()};return await r(t||[]),{put:r,set:n,add:i,remove:s,iterator:o,all:a,clear:l,close:c}};function Oc(e,t){let r=(e,t)=>e,n=(e,t)=>Od(e,t,r);return Ou(e,t,n)}function Ou(e,t,r){let n=M8(e.clock,t.clock);return 0===n?r(e,t):n}function Od(e,t,r){return e.clock.id===t.clock.id?r(e,t):e.clock.id<t.clock.id?-1:1}let{LastWriteWins:Oh,NoZeroes:Of}={SortByClocks:Ou,SortByClockId:Od,LastWriteWins:Oc,NoZeroes:function(e){let t=`Your log's tiebreaker function, ${e.name}, has returned zero and therefore cannot be`;return(r,n)=>{let i=e(r,n);if(0===i)throw Error(t);return i}}},Op=()=>new Date().getTime().toString(),Og=(e,t)=>Math.max(e,t.clock.time),Om=Os,Oy=async()=>({canAppend:async e=>!0}),Ob=async(e,{logId:t,logHeads:r,access:n,entryStorage:i,headsStorage:s,indexStorage:o,sortFn:a}={})=>{if(null==e)throw Error("Identity is required");if(null!=r&&!Array.isArray(r))throw Error("'logHeads' argument must be an array");let l=t||Op();n=n||await Oy();let c=i||await Om(),u=o||await Om();s=s||await Om();let d=await Ol({storage:s,heads:r});a=Of(a||Oh);let h=new av({concurrency:1}),f=new av({concurrency:1}),p=async()=>{let t=Math.max(0,(await g()).reduce(Og,0));return M9(e.publicKey,t)},g=async()=>(await d.all()).sort(a).reverse(),m=async()=>{let e=[];for await(let t of E())e.unshift(t);return e},y=async e=>{let t=await c.get(e);if(t)return await Oi.decode(t)},b=async e=>null!=await u.get(e),w=async(t,r={referencesCount:0})=>{let i=async()=>{let i=await g(),s=i.map(e=>e.hash),o=await S(i,r.referencesCount+i.length),a=await Oi.create(e,l,t,M7(await p()),s,o);if(!await n.canAppend(a))throw Error(`Could not append entry:
Key "${e.hash}" is not allowed to write to the log`);return await d.set([a]),await c.put(a.hash,a.bytes),await u.put(a.hash,!0),a};return h.add(i)},v=async t=>{let r=async()=>{if(await b(t.hash))return!1;let r=async t=>{if(t.id!==l)throw Error(`Entry's id (${t.id}) doesn't match the log's id (${l}).`);if(!await n.canAppend(t))throw Error(`Could not append entry:
Key "${t.identity}" is not allowed to write to the log`);if(!await Oi.verify(e,t))throw Error(`Could not validate signature for entry "${t.hash}"`)};await r(t);let i=(await g()).map(e=>e.hash),s=new Set([t.hash]),o=new Set([...t.next,...t.refs]),a=new Set,h=async()=>{let e=Array.from(o.values()).filter(b).map(y);for(let t of(await Promise.all(e)))for(let e of(o.delete(t.hash),await r(t),s.add(t.hash),[...t.next,...t.refs]))await b(e)||s.has(e)?i.includes(e)&&a.add(e):o.add(e);o.size>0&&await h()};for(let e of(await h(),s.values()))await u.put(e,!0);for(let e of a.values())await d.remove(e);return await c.put(t.hash,t.bytes),await d.add(t),!0};return f.add(r)},E=async function*(e,t){let r,n=()=>!1;t=t||n;let i=(e=e||await g()).sort(a),s={},o=[],l={},c=e=>!(s[e]||l[e]);for(;i.length>0;)if(r=(i=i.sort(a)).pop()){let{hash:e,next:n}=r;if(!s[e]){if(yield r,!0===await t(r))break;s[e]=!0,l[e]=!0,o=[...o,...n].filter(c);let a=e=>{if(!s[e]&&!l[e])return l[e]=!0,y(e)},u=await Promise.all(o.map(a));o=u.filter(e=>null!=e).reduce((e,t)=>Array.from(new Set([...e,...t.next])),[]).filter(c),i=[...u,...i]}}},A=async function*({amount:e=-1,gt:t,gte:r,lt:n,lte:i}={}){if(0===e)return;if("string"==typeof i&&(i=[await y(i)]),"string"==typeof n){let e=await y(n);n=await Promise.all(e.next.map(e=>y(e)))}if(null!=n&&!Array.isArray(n))throw Error("lt must be a string or an array of Entries");if(null!=i&&!Array.isArray(i))throw Error("lte must be a string or an array of Entries");let s=(n||i||await g()).filter(e=>null!=e),o=t||r?await y(t||r):null,a=o||-1===e?-1:e,l=0,c=async e=>(l++,!!e&&!!(l>=a&&-1!==a||o&&Oi.isEqual(e,o))),u=o&&-1!==e&&!n&&!i,d=u?new M6(e+2):null,h=0;for await(let e of E(s,c)){let r=n&&Oi.isEqual(e,s),i=t&&Oi.isEqual(e,o);r||i||(u?d.set(h++,e.hash):yield e)}if(u){let t=d.keys.length,r=t>e?t-e:0;for(let e of d.keys.slice(r,t)){let t=d.get(e),r=await y(t);yield r}}},x=e=>e&&void 0!==e.id&&void 0!==e.clock&&void 0!==e.heads&&void 0!==e.values&&void 0!==e.access&&void 0!==e.identity&&void 0!==e.storage,S=async(e,t=0)=>{let r=[];for await(let{hash:n}of E(e,async e=>r.length>=t&&-1!==t))r.push(n);return r=r.slice(e.length+1,t)};return{id:l,clock:p,heads:g,values:m,all:m,get:y,has:b,append:w,join:async e=>{if(!e)throw Error("Log instance not defined");if(!x(e))throw Error("Given argument is not an instance of Log");for(let t of(c.merge&&await c.merge(e.storage),await e.heads()))await v(t)},joinEntry:v,traverse:E,iterator:A,clear:async()=>{await u.clear(),await d.clear(),await c.clear()},close:async()=>{await u.close(),await d.close(),await c.close()},access:n,identity:e,storage:c}},Ow=async(e,t)=>({put:async(r,n)=>{await e.put(r,n),await t.put(r,n)},get:async r=>{let n=await e.get(r);return!n&&(n=await t.get(r))&&await e.put(r,n),n},del:async r=>{await e.del(r),await t.del(r)},iterator:async function*({amount:r,reverse:n}={}){let i=[],s={amount:r||-1,reverse:n||!1};for(let r of[e,t])for await(let[e,t]of r.iterator(s))i[e]||(i[e]=!0,yield[e,t])},merge:async r=>{await e.merge(r),await t.merge(r),await r.merge(e),await r.merge(t)},clear:async()=>{await e.clear(),await t.clear()},close:async()=>{await e.close(),await t.close()}}),Ov=3e4,OE=async({ipfs:e,pin:t,timeout:r}={})=>{if(!e)throw Error("An instance of ipfs is required.");return{put:async(n,i)=>{let s=B$.parse(n,Bp),{signal:o}=new M1.TimeoutController(r||Ov);await e.blockstore.put(s,i,{signal:o}),t&&!await e.pins.isPinned(s)&&await (0,cY.A)(e.pins.add(s))},del:async e=>{},get:async t=>{let n=B$.parse(t,Bp),{signal:i}=new M1.TimeoutController(r||Ov),s=await e.blockstore.get(n,{signal:i});if(s)return s},iterator:async function*(){},merge:async e=>{},clear:async()=>{},close:async()=>{}}};var OA=r(59372);let Ox="./level",OS="view",Ok=async({path:e,valueEncoding:t}={})=>{e=e||Ox,t=t||OS;let r=new OA.Level(e,{valueEncoding:t,passive:!0});return await r.open(),{put:async(e,t)=>{await r.put(e,t)},del:async e=>{await r.del(e)},get:async e=>{try{let t=await r.get(e);if(t)return t}catch(e){}},iterator:async function*({amount:e,reverse:t}={}){let n={limit:e||-1,reverse:t||!1};for await(let[e,t]of r.iterator(n))yield[e,t]},merge:async e=>{},clear:async()=>{await r.clear()},close:async()=>{await r.close()}}},O_=1e6,OI=async({size:e}={})=>{let t=new M6(e||O_);return{put:async(e,r)=>{t.set(e,r)},del:async e=>{t.remove(e)},get:async e=>t.get(e),iterator:async function*(){for await(let e of t.keys){let r=t.get(e);yield[e,r]}},merge:async e=>{if(e)for await(let[r,n]of e.iterator())t.set(r,n)},clear:async()=>{t=new M6(e||O_)},close:async()=>{}}},OT=16,OC=1e3,OP=async({ipfs:e,identity:t,address:r,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:l,indexStorage:c,referencesCount:u,syncAutomatically:d,onUpdate:h})=>{s=M3(s||"./orbitdb",`./${r}/`),o=o||{},u=Number(u)>-1?u:OT,l=l||await Ow(await OI({size:OC}),await OE({ipfs:e,pin:!0})),a=a||await Ow(await OI({size:OC}),await Ok({path:M3(s,"/log/_heads/")})),c=c||await Ow(await OI({size:OC}),await Ok({path:M3(s,"/log/_index/")}));let f=await Ob(t,{logId:r,access:i,entryStorage:l,headsStorage:a,indexStorage:c}),p=new M0.EventEmitter,g=new av({concurrency:1}),m=async e=>{let t=async()=>{let t=await f.append(e,{referencesCount:u});return await v.add(t),h&&await h(f,t),p.emit("update",t),t.hash},r=await g.add(t);return await g.onIdle(),r},y=async e=>{let t=async()=>{let t=await Oi.decode(e);t&&await f.joinEntry(t)&&(h&&await h(f,t),p.emit("update",t))};await g.add(t)},b=async()=>{await v.stop(),await g.onIdle(),await f.close(),i&&i.close&&await i.close(),p.emit("close")},w=async()=>{await g.onIdle(),await f.clear(),i&&i.drop&&await i.drop(),p.emit("drop")},v=await M5({ipfs:e,log:f,events:p,onSynced:y,start:d});return{address:r,name:n,identity:t,meta:o,close:b,drop:w,addOperation:m,log:f,sync:v,peers:v.peers,events:p,access:i}},OR="documents",OD={indexBy:"_id"},ON=({indexBy:e}=OD)=>async({ipfs:t,identity:r,address:n,name:i,access:s,directory:o,meta:a,headsStorage:l,entryStorage:c,indexStorage:u,referencesCount:d,syncAutomatically:h,onUpdate:f})=>{let p=await OP({ipfs:t,identity:r,address:n,name:i,access:s,directory:o,meta:a,headsStorage:l,entryStorage:c,indexStorage:u,referencesCount:d,syncAutomatically:h}),{addOperation:g,log:m}=p,y=async t=>{let r=t[e];if(!r)throw Error(`The provided document doesn't contain field '${e}'`);return g({op:"PUT",key:r,value:t})},b=async e=>{if(!await w(e))throw Error(`No document with key '${e}' in the database`);return g({op:"DEL",key:e,value:null})},w=async e=>{for await(let t of E())if(e===t.key)return t},v=async e=>{let t=[];for await(let r of E())e(r.value)&&t.push(r.value);return t},E=async function*({amount:e}={}){let t={},r=0;for await(let n of m.iterator()){let{op:i,key:s,value:o}=n.payload;if("PUT"!==i||t[s])"DEL"!==i||t[s]||(t[s]=!0);else{t[s]=!0,r++;let e=n.hash;yield{hash:e,key:s,value:o}}if(r>=e)break}},A=async()=>{let e=[];for await(let t of E())e.unshift(t);return e};return{...p,type:OR,put:y,del:b,get:w,iterator:E,query:v,indexBy:e,all:A}};ON.type=OR;let OM=ON,OB="events",OO=()=>async({ipfs:e,identity:t,address:r,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:l,indexStorage:c,referencesCount:u,syncAutomatically:d,onUpdate:h})=>{let f=await OP({ipfs:e,identity:t,address:r,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:l,indexStorage:c,referencesCount:u,syncAutomatically:d,onUpdate:h}),{addOperation:p,log:g}=f,m=async e=>p({op:"ADD",key:null,value:e}),y=async e=>(await g.get(e)).payload.value,b=async function*({gt:e,gte:t,lt:r,lte:n,amount:i}={}){for await(let s of g.iterator({gt:e,gte:t,lt:r,lte:n,amount:i})){let e=s.hash,t=s.payload.value;yield{hash:e,value:t}}},w=async()=>{let e=[];for await(let t of b())e.unshift(t);return e};return{...f,type:OB,add:m,get:y,iterator:b,all:w}};OO.type=OB;let OL=OO,OF="keyvalue",OU=()=>async({ipfs:e,identity:t,address:r,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:l,indexStorage:c,referencesCount:u,syncAutomatically:d,onUpdate:h})=>{let f=await OP({ipfs:e,identity:t,address:r,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:l,indexStorage:c,referencesCount:u,syncAutomatically:d,onUpdate:h}),{addOperation:p,log:g}=f,m=async(e,t)=>p({op:"PUT",key:e,value:t}),y=async e=>p({op:"DEL",key:e,value:null}),b=async e=>{for await(let t of g.traverse()){let{op:r,key:n,value:i}=t.payload;if("PUT"===r&&n===e)return i;if("DEL"===r&&n===e)return}},w=async function*({amount:e}={}){let t={},r=0;for await(let n of g.traverse()){let{op:i,key:s,value:o}=n.payload;if("PUT"!==i||t[s])"DEL"!==i||t[s]||(t[s]=!0);else{t[s]=!0,r++;let e=n.hash;yield{key:s,value:o,hash:e}}if(r>=e)break}},v=async()=>{let e=[];for await(let t of w())e.unshift(t);return e};return{...f,type:OF,put:m,set:m,del:y,get:b,iterator:w,all:v}};OU.type=OF;let Oj=OU,OH="json",O$=({directory:e}={})=>async()=>{let t=await Ok({path:e,valueEncoding:OH}),r=await Ok({path:M3(e,"/_indexedEntries/"),valueEncoding:OH}),n=async(e,n)=>{let i=new Set,s=new Set,o=n.hash,a=async e=>await r.get(e)===!0,l=async e=>!await a(e),c=async e=>{for await(let t of e.next)await l(t)&&s.add(t);return await a(o)&&0===s.size};for await(let n of e.traverse(null,c)){let{hash:e,payload:o}=n;if(await l(e)){let{op:a,key:l}=o;"PUT"!==a||i.has(l)?"DEL"!==a||i.has(l)||(i.add(l),await t.del(l),await r.put(e,!0)):(i.add(l),await t.put(l,n),await r.put(e,!0)),s.delete(e)}}},i=async()=>{await t.close(),await r.close()},s=async()=>{await t.clear(),await r.clear()};return{get:t.get,iterator:t.iterator,update:n,close:i,drop:s}},Oq={},Oz=e=>{if(!e.type)throw Error("Database type does not contain required field 'type'.");Oq[e.type]=e},OV=e=>{if(!e)throw Error("Type not specified");if(!Oq[e])throw Error(`Unsupported database type: '${e}'`);return Oq[e]};function OG(e,t){for(let r=0;r<e.byteLength;r++){if(e[r]<t[r])return -1;if(e[r]>t[r])return 1}return e.byteLength>t.byteLength?1:e.byteLength<t.byteLength?-1:0}Oz(OL),Oz(OM),Oz(Oj);let OK=async(e,t,r)=>{if(!e)throw Error("No signature given");if(!t)throw Error("Given publicKey was undefined");if(!r)throw Error("Given input data was undefined");r instanceof Uint8Array||(r="string"==typeof r?(0,rx.s)(r):new Uint8Array(r));let n=(e,t,r)=>e.verify(t,r),i=!1;try{let s=p3((0,rx.s)(t,"base16"));i=await n(s,r,(0,rx.s)(e,"base16"))}catch(e){}return Promise.resolve(i)},OW=async(e,t)=>{if(!e)throw Error("No signing key given");if(!t)throw Error("Given input data was undefined");return t instanceof Uint8Array||(t="string"==typeof t?(0,rx.s)(t):new Uint8Array(t)),(0,uC.d)(await e.sign(t),"base16")},OQ=OI({size:1e3}),OJ=async(e,t,r)=>{let n=await OQ,i=await n.get(e),s=!1;if(i){let e=(e,t)=>t instanceof Uint8Array?0===OG(e,t):e.toString()===t.toString();s=i.publicKey===t&&e(i.data,r)}else{let i=await OK(e,t,r);s=i,i&&await n.put(e,{publicKey:t,data:r})}return s},OZ="./keystore",OY=async({storage:e,path:t}={})=>{e=e||await Ow(await OI({size:1e3}),await Ok({path:t||OZ}));let r=await OI({size:1e3}),n=async(t,n)=>{let{privateKey:i}=n;await e.put("private_"+t,i);let s=p8(i);await r.put(t,s)},i=async e=>{if(!e)throw Error("id needed to create a key");let t=await p1("secp256k1"),r={publicKey:t.publicKey.raw,privateKey:t.raw};return await n(e,r),t};return{clear:async()=>{await e.clear(),await r.clear()},close:async()=>{await e.close(),await r.close()},hasKey:async t=>{if(!t)throw Error("id needed to check a key");let n=!1,i=await r.get(t);if(i)n=!0;else try{n=null!=(i=await e.get("private_"+t))}catch(e){console.error("Error: ENOENT: no such file or directory")}return n},addKey:n,createKey:i,getKey:async t=>{if(!t)throw Error("id needed to get a key");let n=await r.get(t);if(!n){let i;try{i=await e.get("private_"+t)}catch(e){}if(!i)return;n=p8(i),await r.put(t,n)}return n},getPublic:(e,t={})=>{let r=["hex","buffer"],n=t.format||"hex";if(-1===r.indexOf(n))throw Error("Supported formats are `hex` and `buffer`");let i=e.publicKey.raw;return"buffer"===n?i:(0,uC.d)(i,"base16")}}},OX=e9,O0=B7,O1=Bp,O2=async({id:e,publicKey:t,signatures:r,type:n,sign:i,verify:s}={})=>{if(!e)throw Error("Identity id is required");if(!t)throw Error("Invalid public key");if(!r)throw Error("Signatures object is required");if(!r.id)throw Error("Signature of id is required");if(!r.publicKey)throw Error("Signature of publicKey+id is required");if(!n)throw Error("Identity type is required");let o={id:e,publicKey:t,signatures:r=Object.assign({},r),type:n,sign:i,verify:s},{hash:a,bytes:l}=await O3(o);return o.hash=a,o.bytes=l,o},O3=async e=>{let{id:t,publicKey:r,signatures:n,type:i}=e,s={id:t,publicKey:r,signatures:n,type:i},{cid:o,bytes:a}=await B5({value:s,codec:OX,hasher:O0});return{hash:o.toString(O1),bytes:Uint8Array.from(a)}},O4=async e=>{let{value:t}=await B6({bytes:e,codec:OX,hasher:O0});return O2({...t})},O5=e=>!!(e.id&&e.hash&&e.bytes&&e.publicKey&&e.signatures&&e.signatures.id&&e.signatures.publicKey&&e.type),O6=(e,t)=>e.id===t.id&&e.hash===t.hash&&e.type===t.type&&e.publicKey===t.publicKey&&e.signatures.id===t.signatures.id&&e.signatures.publicKey===t.signatures.publicKey,O8="publickey",O7=({keystore:e})=>async()=>{if(!e)throw Error("PublicKeyIdentityProvider requires a keystore parameter");return{type:O8,getId:async({id:t}={})=>{if(!t)throw Error("id is required");let r=await e.getKey(t)||await e.createKey(t);return(0,uC.d)(r.publicKey.raw,"base16")},signIdentity:async(t,{id:r}={})=>{if(!r)throw Error("id is required");let n=await e.getKey(r);if(!n)throw Error(`Signing key for '${r}' not found`);return OW(n,t)}}};O7.verifyIdentity=async e=>{let{id:t,publicKey:r,signatures:n}=e;return OJ(n.publicKey,t,r+n.id)},O7.type=O8;let O9={},Le=e=>Object.keys(O9).includes(e),Lt=e=>{if(!Le(e))throw Error(`IdentityProvider type '${e}' is not supported`);return O9[e]};(e=>{if(!e.type||"string"!=typeof e.type)throw Error("Given IdentityProvider doesn't have a field 'type'.");if(!e.verifyIdentity)throw Error("Given IdentityProvider doesn't have a function 'verifyIdentity'.");O9[e.type]=e})(O7);let Lr=M3("./orbitdb","identities"),Ln=async({keystore:e,path:t,storage:r,ipfs:n}={})=>{e=e||await OY({path:t||Lr}),r||(r=n?await Ow(await OI({size:1e3}),await OE({ipfs:n,pin:!0})):await Os());let i=await OI({size:1e3}),s=async(t,r)=>{let n=await e.getKey(t.id);if(!n)throw Error("Private signing key not found from KeyStore");return await OW(n,r)},o=async(e,t,r)=>await OJ(e,t,r);return{createIdentity:async(t={})=>{t.keystore=e;let n=Lt("publickey"),i=t.provider||n({keystore:e}),a=await i();if(!Lt(a.type))throw Error("Identity provider is unknown. Use useIdentityProvider(provider) to register the identity provider");let l=await a.getId(t),c=await e.getKey(l)||await e.createKey(l),u=e.getPublic(c),d=await OW(c,l),h=await a.signIdentity(u+d,t),f={id:d,publicKey:h},p=await O2({id:l,publicKey:u,signatures:f,type:a.type,sign:s,verify:o});return await r.put(p.hash,p.bytes),p},verifyIdentity:async e=>{if(!O5(e))return!1;let{id:t,publicKey:r,signatures:n}=e;if(!await o(n.id,r,t))return!1;let s=await i.get(n.id);if(s)return O6(e,s);let a=Lt(e.type),l=await a.verifyIdentity(e);return l&&await i.put(n.id,e),l},getIdentity:async e=>{let t=await r.get(e);if(t)return O4(t)},sign:s,verify:o,keystore:e}},Li=e=>{let t;if(!(e=e.toString()).startsWith("/orbitdb")&&!e.startsWith("\\orbitdb"))return!1;e=(e=(e=(e=e.replaceAll("/orbitdb/","")).replaceAll("\\orbitdb\\","")).replaceAll("/","")).replaceAll("\\","");try{t=B$.parse(e,Bp)}catch(e){return!1}return void 0!==t},Ls=e=>{if(e&&"orbitdb"===e.protocol&&e.hash)return e;let t="orbitdb",r=e.replace("/orbitdb/","").replace("\\orbitdb\\",""),n=()=>M2("/",t,r);return{protocol:t,hash:r,address:e,toString:n}},Lo=e9,La=B7,Ll=Bp,Lc=async({ipfs:e,storage:t}={})=>(t=t||await Ow(await OI({size:1e5}),await OE({ipfs:e,pin:!0})),{get:async e=>{let r=await t.get(e),{value:n}=await B6({bytes:r,codec:Lo,hasher:La});return n&&await t.put(e,r),n},create:async({name:e,type:r,accessController:n,meta:i})=>{if(!e)throw Error("name is required");if(!r)throw Error("type is required");if(!n)throw Error("accessController is required");let s=Object.assign({name:e,type:r,accessController:n},void 0!==i?{meta:i}:{}),{cid:o,bytes:a}=await B5({value:s,codec:Lo,hasher:La}),l=o.toString(Ll);return await t.put(l,a),{hash:l,manifest:s}},close:async()=>{await t.close()}}),Lu=async(e=32)=>{let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="",n=0;for(;n<e;)r+=t.charAt(Math.floor(Math.random()*t.length)),n+=1;return r},Ld=e9,Lh=B7,Lf=Bp,Lp=async({storage:e,type:t,params:r})=>{let n={type:t,...r},{cid:i,bytes:s}=await B5({value:n,codec:Ld,hasher:Lh}),o=i.toString(Lf);return await e.put(o,s),o},Lg="ipfs",Lm=({write:e,storage:t}={})=>async({orbitdb:r,identities:n,address:i})=>{if(t=t||await Ow(await OI({size:1e3}),await OE({ipfs:r.ipfs,pin:!0})),e=e||[r.identity.id],i){let r=await t.get(i.replaceAll("/ipfs/","")),{value:n}=await B6({bytes:r,codec:Ld,hasher:Lh});e=n.write}else i=await Lp({storage:t,type:Lg,params:{write:e}}),i=M3("/",Lg,i);let s=async t=>{let r=await n.getIdentity(t.identity);if(!r)return!1;let{id:i}=r;return!!(e.includes(i)||e.includes("*"))&&await n.verifyIdentity(r)};return{type:Lg,address:i,write:e,canAppend:s}};Lm.type=Lg;let Ly=Lm,Lb="orbitdb",Lw=({write:e}={})=>async({orbitdb:t,identities:r,address:n,name:i})=>{n=n||i||await Lu(64),e=e||[t.identity.id];let s=await t.open(n,{type:"keyvalue",AccessController:Ly({write:e})});n=s.address;let o=async()=>{let e=[];for await(let t of s.iterator())e[t.key]=t.value;let t=t=>{let r=t[0];e[r]=new Set([...e[r]||[],...t[1]])};return Object.entries({...e,...{admin:new Set([...e.admin||[],...s.access.write])}}).forEach(t),e},a=async e=>(await o())[e]||new Set([]),l=async(e,t)=>{let r=new Set(await a(e));return r.has(t)||r.has("*")};return{type:Lb,address:n,write:e,canAppend:async e=>{let t=await r.getIdentity(e.identity);if(!t)return!1;let{id:n}=t;return!!(await l("write",n)||await l("admin",n))&&await r.verifyIdentity(t)},capabilities:o,get:a,grant:async(e,t)=>{let r=new Set([...await s.get(e)||[],t]);await s.put(e,Array.from(r.values()))},revoke:async(e,t)=>{let r=new Set(await s.get(e)||[]);r.delete(t),r.size>0?await s.put(e,Array.from(r.values())):await s.del(e)},close:async()=>{await s.close()},drop:async()=>{await s.drop()},events:s.events}};Lw.type=Lb;let Lv=Lw,LE={},LA=e=>{if(!LE[e])throw Error(`AccessController type '${e}' is not supported`);return LE[e]},Lx=e=>{if(!e.type)throw Error("AccessController does not contain required field 'type'.");LE[e.type]=e};Lx(Ly),Lx(Lv);let LS="events",Lk=Ly,L_=async({ipfs:e,id:t,identity:r,identities:n,directory:i}={})=>{let s;if(null==e)throw Error("IPFS instance is a required argument.");t=t||await Lu();let o=e.libp2p.peerId;i=i||"./orbitdb",n?s=n.keystore:(s=await OY({path:M3(i,"./keystore")}),n=await Ln({ipfs:e,keystore:s})),r?r.provider&&(r=await n.createIdentity({...r})):r=await n.createIdentity({id:t});let a=await Lc({ipfs:e}),l={},c=async(t,{type:s,meta:o,sync:d,Database:h,AccessController:f,headsStorage:p,entryStorage:g,indexStorage:m,referencesCount:y}={})=>{let b,w,v;if(l[t])return l[t];if(Li(t)){let i=Ls(t);f=LA((w=await a.get(i.hash)).accessController.split("/",2).pop())(),v=await f({orbitdb:{open:c,identity:r,ipfs:e},identities:n,address:w.accessController}),b=w.name,s=s||w.type,o=w.meta}else{s=s||LS,f=f||Lk(),v=await f({orbitdb:{open:c,identity:r,ipfs:e},identities:n,name:t});let i=await a.create({name:t,type:s,accessController:v.address,meta:o});if(w=i.manifest,t=Ls(i.hash),b=w.name,o=w.meta,l[t])return l[t]}if(!(h=h||OV(s)()))throw Error(`Unsupported database type: '${s}'`);t=t.toString();let E=await h({ipfs:e,identity:r,address:t,name:b,access:v,directory:i,meta:o,syncAutomatically:d,headsStorage:p,entryStorage:g,indexStorage:m,referencesCount:y});return E.events.on("close",u(t)),l[t]=E,E},u=e=>()=>{delete l[e]};return{id:t,open:c,stop:async()=>{for(let e of Object.values(l))await e.close();s&&await s.close(),a&&await a.close(),l={}},ipfs:e,directory:i,keystore:s,identities:n,identity:r,peerId:o}};class LI{constructor(){throw Error("TCP connections are not possible in browsers")}[Au]=!0;[Symbol.toStringTag]="@libp2p/tcp";[vs]=["@libp2p/transport"];async dial(){throw Error("TCP connections are not possible in browsers")}createListener(){throw Error("TCP connections are not possible in browsers")}listenFilter(){return[]}dialFilter(){return[]}}function LT(e={}){return t=>new LI(t,e)}class LC{portMappingClient;constructor(){throw Error("UPnPNAT is not supported in browsers")}[Symbol.toStringTag]="@libp2p/upnp-nat";[vs]=["@libp2p/nat-traversal"];get[vo](){return[]}}function LP(e={}){return t=>new LC(t,e)}!function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.publicKey&&e.publicKey.byteLength>0&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.addrs)for(let r of e.addrs)t.uint32(18),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={publicKey:(0,to.c)(0),addrs:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.publicKey=e.bytes();break;case 2:if(r.limits?.addrs!=null&&n.addrs.length===r.limits.addrs)throw new rz('Decode error - map field "addrs" had too many elements');n.addrs.push(e.bytes());break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(ez||(ez={}));let LR="_peer-discovery._p2p._pubsub";class LD extends cf{[Ay]=!0;[Symbol.toStringTag]="@libp2p/pubsub-peer-discovery";interval;listenOnly;topics;intervalId;components;log;constructor(e,t={}){super();let{interval:r,topics:n,listenOnly:i}=t;this.components=e,this.interval=r??1e4,this.listenOnly=i??!1,this.log=e.logger.forComponent("libp2p:discovery:pubsub"),Array.isArray(n)&&n.length>0?this.topics=n:this.topics=[LR],this._onMessage=this._onMessage.bind(this)}isStarted(){return null!=this.intervalId}start(){}afterStart(){if(null!=this.intervalId)return;let e=this.components.pubsub;if(null==e)throw Error("PubSub not configured");for(let t of this.topics)e.subscribe(t),e.addEventListener("message",this._onMessage);this.listenOnly||(this._broadcast(),this.intervalId=setInterval(()=>{this._broadcast()},this.interval))}beforeStop(){let e=this.components.pubsub;if(null==e)throw Error("PubSub not configured");for(let t of this.topics)e.unsubscribe(t),e.removeEventListener("message",this._onMessage)}stop(){null!=this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0)}_broadcast(){let e=this.components.peerId;if(null==e.publicKey)throw Error("PeerId was missing public key");let t={publicKey:p5(e.publicKey),addrs:this.components.addressManager.getAddresses().map(e=>e.bytes)},r=ez.encode(t),n=this.components.pubsub;if(null==n)throw Error("PubSub not configured");for(let e of this.topics){if(0===n.getSubscribers(e).length){this.log("skipping broadcasting our peer data on topic %s because there are no peers present",e);continue}this.log("broadcasting our peer data on topic %s",e),n.publish(e,r)}}_onMessage(e){if(!this.isStarted())return;let t=e.detail;if(this.topics.includes(t.topic))try{let e=ez.decode(t.data),r=p2(e.publicKey),n=gp(r);if(n.equals(this.components.peerId))return;this.log("discovered peer %p on %s",n,t.topic),this.safeDispatchEvent("peer",{detail:{id:n,multiaddrs:e.addrs.map(e=>yz(e))}})}catch(e){this.log.error("error handling incoming message",e)}}}function LN(e={}){return t=>new LD(t,e)}let LM="StrictSign",LB="StrictNoSign";function LO(e){return null!=e[Symbol.asyncIterator]}!function(e){e.Accept="accept",e.Ignore="ignore",e.Reject="reject"}(eV||(eV={})),Symbol.for("@libp2p/pubsub");let LL=e=>{let t=t5(e),r=(0,to.K)(t);return re(e,r),LL.bytes=t,r};function LF(e,t){let r=(t=t??{}).lengthEncoder??LL;function*n(e){let t=r(e.byteLength);t instanceof Uint8Array?yield t:yield*t,e instanceof Uint8Array?yield e:yield*e}return LO(e)?async function*(){for await(let t of e)yield*n(t)}():function*(){for(let t of e)yield*n(t)}()}LL.bytes=0,LF.single=(e,t)=>new tf(((t=t??{}).lengthEncoder??LL)(e.byteLength),e);class LU extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class Lj extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class LH extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}class L$ extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}let Lq=8,Lz=4194304;!function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(eG||(eG={}));let LV=e=>{let t=rt(e);return LV.bytes=t5(t),t};function LG(e,t){let r=new tf,n=eG.LENGTH,i=-1,s=t?.lengthDecoder??LV,o=t?.maxLengthLength??Lq,a=t?.maxDataLength??Lz;function*l(){for(;r.byteLength>0;){if(n===eG.LENGTH)try{if((i=s(r))<0)throw new LU("Invalid message length");if(i>a)throw new Lj("Message length too long");let e=s.bytes;r.consume(e),t?.onLength!=null&&t.onLength(i),n=eG.DATA}catch(e){if(e instanceof RangeError){if(r.byteLength>o)throw new LH("Message length length too long");break}throw e}if(n===eG.DATA){if(r.byteLength<i)break;let e=r.sublist(0,i);r.consume(i),t?.onData!=null&&t.onData(e),yield e,n=eG.LENGTH}}}return LO(e)?async function*(){for await(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new L$("Unexpected end of input")}():function*(){for(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new L$("Unexpected end of input")}()}LV.bytes=0,LG.fromReader=(e,t)=>{let r=1,n=async function*(){for(;;)try{let{done:t,value:n}=await e.next(r);if(!0===t)return;null!=n&&(yield n)}catch(e){if("ERR_UNDER_READ"===e.code)return{done:!0,value:null};throw e}finally{r=1}}(),i=e=>{r=e};return LG(n,{...t??{},onLength:i})};let LK="/floodsub/1.0.0",LW="/meshsub/1.0.0",LQ="/meshsub/1.1.0",LJ="/meshsub/1.2.0",LZ=6,LY=4,LX=12,L0=4,L1=2,L2=5,L3=3,L4=6,L5=.25,L6=3,L8=100,L7=1e3,L9=6e4,Fe=16,Ft=6e4,Fr=1e4,Fn=15,Fi=300,Fs=1e3,Fo=60,Fa=2,Fl=1e4,Fc=5e3,Fu=10,Fd=3e3,Fh=12e4,Ff=12e4,Fp="ERR_TOPIC_VALIDATOR_REJECT",Fg="ERR_TOPIC_VALIDATOR_IGNORE",Fm=0,Fy=128,Fb=1e3,Fw=1e3,Fv=1,FE=512,FA=512,Fx={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxIdontwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};!function(e){let t,r,n,i,s,o,a,l,c,u;!function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.subscribe&&(t.uint32(8),t.bool(e.subscribe)),null!=e.topic&&(t.uint32(18),t.string(e.topic)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.subscribe=e.bool();break;case 2:n.topic=e.string();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(t=e.SubOpts||(e.SubOpts={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.from&&(t.uint32(10),t.bytes(e.from)),null!=e.data&&(t.uint32(18),t.bytes(e.data)),null!=e.seqno&&(t.uint32(26),t.bytes(e.seqno)),null!=e.topic&&""!==e.topic&&(t.uint32(34),t.string(e.topic)),null!=e.signature&&(t.uint32(42),t.bytes(e.signature)),null!=e.key&&(t.uint32(50),t.bytes(e.key)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={topic:""},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.from=e.bytes();break;case 2:n.data=e.bytes();break;case 3:n.seqno=e.bytes();break;case 4:n.topic=e.string();break;case 5:n.signature=e.bytes();break;case 6:n.key=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(r=e.Message||(e.Message={})),function(t){let r;t.codec=()=>(null==r&&(r=rq((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.ihave)for(let n of t.ihave)r.uint32(10),e.ControlIHave.codec().encode(n,r);if(null!=t.iwant)for(let n of t.iwant)r.uint32(18),e.ControlIWant.codec().encode(n,r);if(null!=t.graft)for(let n of t.graft)r.uint32(26),e.ControlGraft.codec().encode(n,r);if(null!=t.prune)for(let n of t.prune)r.uint32(34),e.ControlPrune.codec().encode(n,r);if(null!=t.idontwant)for(let n of t.idontwant)r.uint32(42),e.ControlIDontWant.codec().encode(n,r);!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={ihave:[],iwant:[],graft:[],prune:[],idontwant:[]},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:if(n.limits?.ihave!=null&&i.ihave.length===n.limits.ihave)throw new rz('Decode error - map field "ihave" had too many elements');i.ihave.push(e.ControlIHave.codec().decode(t,t.uint32(),{limits:n.limits?.ihave$}));break;case 2:if(n.limits?.iwant!=null&&i.iwant.length===n.limits.iwant)throw new rz('Decode error - map field "iwant" had too many elements');i.iwant.push(e.ControlIWant.codec().decode(t,t.uint32(),{limits:n.limits?.iwant$}));break;case 3:if(n.limits?.graft!=null&&i.graft.length===n.limits.graft)throw new rz('Decode error - map field "graft" had too many elements');i.graft.push(e.ControlGraft.codec().decode(t,t.uint32(),{limits:n.limits?.graft$}));break;case 4:if(n.limits?.prune!=null&&i.prune.length===n.limits.prune)throw new rz('Decode error - map field "prune" had too many elements');i.prune.push(e.ControlPrune.codec().decode(t,t.uint32(),{limits:n.limits?.prune$}));break;case 5:if(n.limits?.idontwant!=null&&i.idontwant.length===n.limits.idontwant)throw new rz('Decode error - map field "idontwant" had too many elements');i.idontwant.push(e.ControlIDontWant.codec().decode(t,t.uint32(),{limits:n.limits?.idontwant$}));break;default:t.skipType(7&r)}}return i})),r),t.encode=e=>rj(e,t.codec()),t.decode=(e,r)=>rA(e,t.codec(),r)}(n=e.ControlMessage||(e.ControlMessage={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.topicID&&(t.uint32(10),t.string(e.topicID)),null!=e.messageIDs)for(let r of e.messageIDs)t.uint32(18),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={messageIDs:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.topicID=e.string();break;case 2:if(r.limits?.messageIDs!=null&&n.messageIDs.length===r.limits.messageIDs)throw new rz('Decode error - map field "messageIDs" had too many elements');n.messageIDs.push(e.bytes());break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(i=e.ControlIHave||(e.ControlIHave={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.messageIDs)for(let r of e.messageIDs)t.uint32(10),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={messageIDs:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();if(t>>>3==1){if(r.limits?.messageIDs!=null&&n.messageIDs.length===r.limits.messageIDs)throw new rz('Decode error - map field "messageIDs" had too many elements');n.messageIDs.push(e.bytes())}else e.skipType(7&t)}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(s=e.ControlIWant||(e.ControlIWant={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.topicID&&(t.uint32(10),t.string(e.topicID)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();t>>>3==1?n.topicID=e.string():e.skipType(7&t)}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(o=e.ControlGraft||(e.ControlGraft={})),function(t){let r;t.codec=()=>(null==r&&(r=rq((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.topicID&&(r.uint32(10),r.string(t.topicID)),null!=t.peers)for(let n of t.peers)r.uint32(18),e.PeerInfo.codec().encode(n,r);null!=t.backoff&&(r.uint32(24),r.uint64Number(t.backoff)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={peers:[]},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.topicID=t.string();break;case 2:if(n.limits?.peers!=null&&i.peers.length===n.limits.peers)throw new rz('Decode error - map field "peers" had too many elements');i.peers.push(e.PeerInfo.codec().decode(t,t.uint32(),{limits:n.limits?.peers$}));break;case 3:i.backoff=t.uint64Number();break;default:t.skipType(7&r)}}return i})),r),t.encode=e=>rj(e,t.codec()),t.decode=(e,r)=>rA(e,t.codec(),r)}(a=e.ControlPrune||(e.ControlPrune={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.peerID&&(t.uint32(10),t.bytes(e.peerID)),null!=e.signedPeerRecord&&(t.uint32(18),t.bytes(e.signedPeerRecord)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.peerID=e.bytes();break;case 2:n.signedPeerRecord=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(l=e.PeerInfo||(e.PeerInfo={})),function(e){let t;e.codec=()=>(null==t&&(t=rq((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.messageIDs)for(let r of e.messageIDs)t.uint32(10),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={messageIDs:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();if(t>>>3==1){if(r.limits?.messageIDs!=null&&n.messageIDs.length===r.limits.messageIDs)throw new rz('Decode error - map field "messageIDs" had too many elements');n.messageIDs.push(e.bytes())}else e.skipType(7&t)}return n})),t),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(c=e.ControlIDontWant||(e.ControlIDontWant={})),e.codec=()=>(null==u&&(u=rq((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.subscriptions)for(let n of t.subscriptions)r.uint32(10),e.SubOpts.codec().encode(n,r);if(null!=t.messages)for(let n of t.messages)r.uint32(18),e.Message.codec().encode(n,r);null!=t.control&&(r.uint32(26),e.ControlMessage.codec().encode(t.control,r)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={subscriptions:[],messages:[]},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:if(n.limits?.subscriptions!=null&&i.subscriptions.length===n.limits.subscriptions)throw new rz('Decode error - map field "subscriptions" had too many elements');i.subscriptions.push(e.SubOpts.codec().decode(t,t.uint32(),{limits:n.limits?.subscriptions$}));break;case 2:if(n.limits?.messages!=null&&i.messages.length===n.limits.messages)throw new rz('Decode error - map field "messages" had too many elements');i.messages.push(e.Message.codec().decode(t,t.uint32(),{limits:n.limits?.messages$}));break;case 3:i.control=e.ControlMessage.codec().decode(t,t.uint32(),{limits:n.limits?.control});break;default:t.skipType(7&r)}}return i})),u),e.encode=t=>rj(t,e.codec()),e.decode=(t,r)=>rA(t,e.codec(),r)}(eK||(eK={}));class FS{gossip;msgs=new Map;msgIdToStrFn;history=[];notValidatedCount=0;constructor(e,t,r){this.gossip=e,this.msgIdToStrFn=r;for(let e=0;e<t;e++)this.history[e]=[]}get size(){return this.msgs.size}put(e,t,r=!1){let{msgIdStr:n}=e;return!this.msgs.has(n)&&(this.msgs.set(n,{message:t,validated:r,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),!r&&this.notValidatedCount++,!0)}observeDuplicate(e,t){let r=this.msgs.get(e);null==r||r.validated||r.originatingPeers.add(t)}get(e){return this.msgs.get(this.msgIdToStrFn(e))?.message}getWithIWantCount(e,t){let r=this.msgs.get(e);if(null==r)return null;let n=(r.iwantCounts.get(t)??0)+1;return r.iwantCounts.set(t,n),{msg:r.message,count:n}}getGossipIDs(e){let t=new Map;for(let r=0;r<this.gossip;r++)this.history[r].forEach(r=>{let n=this.msgs.get(r.msgIdStr);if(n?.validated&&e.has(r.topic)){let e=t.get(r.topic);null==e&&(e=[],t.set(r.topic,e)),e.push(r.msgId)}});return t}validate(e){let t=this.msgs.get(e);if(null==t)return null;!t.validated&&this.notValidatedCount--;let{message:r,originatingPeers:n}=t;return t.validated=!0,t.originatingPeers=new Set,{message:r,originatingPeers:n}}shift(){this.history[this.history.length-1].forEach(e=>{let t=this.msgs.get(e.msgIdStr);null!=t&&(this.msgs.delete(e.msgIdStr),!t.validated&&this.notValidatedCount--)}),this.history.pop(),this.history.unshift([])}remove(e){let t=this.msgs.get(e);return null==t?null:(this.msgs.delete(e),t)}}function Fk(e){switch(e){case eV.Ignore:return eJ.Ignore;case eV.Reject:return eJ.Reject;default:throw Error("Unreachable")}}function F_(e,t,r){return{protocolsEnabled:e.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:e.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:e.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:e.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEventsFanout:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_fanout_total",help:"Number of times we include peers in a topic mesh for fanout reasons",labelNames:["topic"]}),meshPeerInclusionEventsRandom:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_random_total",help:"Number of times we include peers in a topic mesh for random reasons",labelNames:["topic"]}),meshPeerInclusionEventsSubscribed:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_subscribed_total",help:"Number of times we include peers in a topic mesh for subscribed reasons",labelNames:["topic"]}),meshPeerInclusionEventsOutbound:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_outbound_total",help:"Number of times we include peers in a topic mesh for outbound reasons",labelNames:["topic"]}),meshPeerInclusionEventsNotEnough:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_not_enough_total",help:"Number of times we include peers in a topic mesh for not_enough reasons",labelNames:["topic"]}),meshPeerInclusionEventsOpportunistic:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_opportunistic_total",help:"Number of times we include peers in a topic mesh for opportunistic reasons",labelNames:["topic"]}),meshPeerInclusionEventsUnknown:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_unknown_total",help:"Number of times we include peers in a topic mesh for unknown reasons",labelNames:["topic"]}),meshPeerChurnEventsDisconnected:e.gauge({name:"gossipsub_peer_churn_events_disconnected_total",help:"Number of times we remove peers in a topic mesh for disconnected reasons",labelNames:["topic"]}),meshPeerChurnEventsBadScore:e.gauge({name:"gossipsub_peer_churn_events_bad_score_total",help:"Number of times we remove peers in a topic mesh for bad_score reasons",labelNames:["topic"]}),meshPeerChurnEventsPrune:e.gauge({name:"gossipsub_peer_churn_events_prune_total",help:"Number of times we remove peers in a topic mesh for prune reasons",labelNames:["topic"]}),meshPeerChurnEventsExcess:e.gauge({name:"gossipsub_peer_churn_events_excess_total",help:"Number of times we remove peers in a topic mesh for excess reasons",labelNames:["topic"]}),meshPeerChurnEventsUnknown:e.gauge({name:"gossipsub_peer_churn_events_unknown_total",help:"Number of times we remove peers in a topic mesh for unknown reasons",labelNames:["topic"]}),peersPerProtocol:e.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:e.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:e.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),acceptedMessagesTotal:e.gauge({name:"gossipsub_accepted_messages_total",help:"Total accepted messages for each topic",labelNames:["topic"]}),ignoredMessagesTotal:e.gauge({name:"gossipsub_ignored_messages_total",help:"Total ignored messages for each topic",labelNames:["topic"]}),rejectedMessagesTotal:e.gauge({name:"gossipsub_rejected_messages_total",help:"Total rejected messages for each topic",labelNames:["topic"]}),unknownValidationResultsTotal:e.gauge({name:"gossipsub_unknown_validation_results_total",help:"Total unknown validation results for each topic",labelNames:["topic"]}),asyncValidationMcacheHit:e.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),asyncValidationDelayFromFirstSeenSec:e.histogram({name:"gossipsub_async_validation_delay_from_first_seen",help:"Async validation report delay from first seen in second",buckets:[.01,.03,.1,.3,1,3,10]}),asyncValidationUnknownFirstSeen:e.gauge({name:"gossipsub_async_validation_unknown_first_seen_count_total",help:"Async validation report unknown first seen value for message"}),peerReadStreamError:e.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:e.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:e.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:e.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:e.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:e.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:e.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:e.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:e.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:e.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:e.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:e.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:e.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:e.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:e.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:e.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:e.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:e.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:e.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:e.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:e.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:e.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),rpcSentIDontWant:e.gauge({name:"gossipsub_rpc_sent_idontwant_total",help:"RPC sent"}),msgPublishCount:e.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeersByTopic:e.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),directPeersPublishedTotal:e.gauge({name:"gossipsub_direct_peers_published_total",help:"Total direct peers that we publish a msg to",labelNames:["topic"]}),floodsubPeersPublishedTotal:e.gauge({name:"gossipsub_floodsub_peers_published_total",help:"Total floodsub peers that we publish a msg to",labelNames:["topic"]}),meshPeersPublishedTotal:e.gauge({name:"gossipsub_mesh_peers_published_total",help:"Total mesh peers that we publish a msg to",labelNames:["topic"]}),fanoutPeersPublishedTotal:e.gauge({name:"gossipsub_fanout_peers_published_total",help:"Total fanout peers that we publish a msg to",labelNames:["topic"]}),msgPublishBytes:e.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgPublishTime:e.histogram({name:"gossipsub_msg_publish_seconds",help:"Total time in seconds to publish a message",buckets:[.001,.002,.005,.01,.1,.5,1],labelNames:["topic"]}),msgForwardCount:e.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:e.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:e.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:e.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),prevalidationInvalidTotal:e.gauge({name:"gossipsub_pre_validation_invalid_total",help:"Total count of invalid messages received",labelNames:["topic"]}),prevalidationValidTotal:e.gauge({name:"gossipsub_pre_validation_valid_total",help:"Total count of valid messages received",labelNames:["topic"]}),prevalidationDuplicateTotal:e.gauge({name:"gossipsub_pre_validation_duplicate_total",help:"Total count of duplicate messages received",labelNames:["topic"]}),prevalidationUnknownTotal:e.gauge({name:"gossipsub_pre_validation_unknown_status_total",help:"Total count of unknown_status messages received",labelNames:["topic"]}),msgReceivedInvalid:e.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["error"]}),msgReceivedInvalidByTopic:e.gauge({name:"gossipsub_msg_received_invalid_by_topic_total",help:"Tracks specific invalid message by topic",labelNames:["topic"]}),duplicateMsgDeliveryDelay:e.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*r.maxMeshMessageDeliveriesWindowSec,.5*r.maxMeshMessageDeliveriesWindowSec,Number(r.maxMeshMessageDeliveriesWindowSec),2*r.maxMeshMessageDeliveriesWindowSec,4*r.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:e.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:e.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:e.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:e.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:e.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:e.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:e.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores"}),scoreWeights:e.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:e.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:e.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:e.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*r.behaviourPenaltyThreshold,.5*r.behaviourPenaltyThreshold,Number(r.behaviourPenaltyThreshold),2*r.behaviourPenaltyThreshold,4*r.behaviourPenaltyThreshold]}),ihaveRcvIgnored:e.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:e.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:e.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:e.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:e.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),idontwantRcvMsgids:e.gauge({name:"gossipsub_idontwant_rcv_msgids_total",help:"Total received IDONTWANT messages"}),idontwantRcvDonthaveMsgids:e.gauge({name:"gossipsub_idontwant_rcv_dont_have_msgids_total",help:"Total received IDONTWANT messageIDs that we do not have in mcache"}),iwantPromiseStarted:e.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:e.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:e.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:e.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:e.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:e.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:e.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*r.gossipPromiseExpireSec,Number(r.gossipPromiseExpireSec),2*r.gossipPromiseExpireSec,4*r.gossipPromiseExpireSec]}),iwantPromiseUntracked:e.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),connectedPeersBackoffSec:e.histogram({name:"gossipsub_connected_peers_backoff_seconds",help:"Backoff time in seconds",buckets:[1,2,4,10,20,60,120]}),cacheSize:e.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:e.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:e.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:e.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:e.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:t,toTopic(e){return this.topicStrToLabel.get(e)??e},onJoin(e){this.topicSubscriptionStatus.set({topicStr:e},1),this.meshPeerCounts.set({topicStr:e},0)},onLeave(e){this.topicSubscriptionStatus.set({topicStr:e},0),this.meshPeerCounts.set({topicStr:e},0)},onAddToMesh(e,t,r){let n=this.toTopic(e);switch(t){case e0.Fanout:this.meshPeerInclusionEventsFanout.inc({topic:n},r);break;case e0.Random:this.meshPeerInclusionEventsRandom.inc({topic:n},r);break;case e0.Subscribed:this.meshPeerInclusionEventsSubscribed.inc({topic:n},r);break;case e0.Outbound:this.meshPeerInclusionEventsOutbound.inc({topic:n},r);break;case e0.NotEnough:this.meshPeerInclusionEventsNotEnough.inc({topic:n},r);break;case e0.Opportunistic:this.meshPeerInclusionEventsOpportunistic.inc({topic:n},r);break;default:this.meshPeerInclusionEventsUnknown.inc({topic:n},r)}},onRemoveFromMesh(e,t,r){let n=this.toTopic(e);switch(t){case e1.Dc:this.meshPeerChurnEventsDisconnected.inc({topic:n},r);break;case e1.BadScore:this.meshPeerChurnEventsBadScore.inc({topic:n},r);break;case e1.Prune:this.meshPeerChurnEventsPrune.inc({topic:n},r);break;case e1.Excess:this.meshPeerChurnEventsExcess.inc({topic:n},r);break;default:this.meshPeerChurnEventsUnknown.inc({topic:n},r)}},onReportValidation(e,t,r){if(this.asyncValidationMcacheHit.inc({hit:null!=e?"hit":"miss"}),null!=e){let r=this.toTopic(e.message.topic);switch(t){case eV.Accept:this.acceptedMessagesTotal.inc({topic:r});break;case eV.Ignore:this.ignoredMessagesTotal.inc({topic:r});break;case eV.Reject:this.rejectedMessagesTotal.inc({topic:r});break;default:this.unknownValidationResultsTotal.inc({topic:r})}}null!=r?this.asyncValidationDelayFromFirstSeenSec.observe((Date.now()-r)/1e3):this.asyncValidationUnknownFirstSeen.inc()},onScorePenalty(e){this.scoringPenalties.inc({penalty:e},1)},onIhaveRcv(e,t,r){let n=this.toTopic(e);this.ihaveRcvMsgids.inc({topic:n},t),this.ihaveRcvNotSeenMsgids.inc({topic:n},r)},onIwantRcv(e,t){for(let[t,r]of e){let e=this.toTopic(t);this.iwantRcvMsgids.inc({topic:e},r)}this.iwantRcvDonthaveMsgids.inc(t)},onIdontwantRcv(e,t){this.idontwantRcvMsgids.inc(e),this.idontwantRcvDonthaveMsgids.inc(t)},onForwardMsg(e,t){let r=this.toTopic(e);this.msgForwardCount.inc({topic:r},1),this.msgForwardPeers.inc({topic:r},t)},onPublishMsg(e,t,r,n,i){let s=this.toTopic(e);this.msgPublishCount.inc({topic:s},1),this.msgPublishBytes.inc({topic:s},r*n),this.msgPublishPeersByTopic.inc({topic:s},r),this.directPeersPublishedTotal.inc({topic:s},t.direct),this.floodsubPeersPublishedTotal.inc({topic:s},t.floodsub),this.meshPeersPublishedTotal.inc({topic:s},t.mesh),this.fanoutPeersPublishedTotal.inc({topic:s},t.fanout),this.msgPublishTime.observe({topic:s},i/1e3)},onMsgRecvPreValidation(e){let t=this.toTopic(e);this.msgReceivedPreValidation.inc({topic:t},1)},onMsgRecvError(e){let t=this.toTopic(e);this.msgReceivedError.inc({topic:t},1)},onPrevalidationResult(e,t){let r=this.toTopic(e);switch(t){case eY.duplicate:this.prevalidationDuplicateTotal.inc({topic:r});break;case eY.invalid:this.prevalidationInvalidTotal.inc({topic:r});break;case eY.valid:this.prevalidationValidTotal.inc({topic:r});break;default:this.prevalidationUnknownTotal.inc({topic:r})}},onMsgRecvInvalid(e,t){let r=this.toTopic(e),n=t.reason===eJ.Error?t.error:t.reason;this.msgReceivedInvalid.inc({error:n},1),this.msgReceivedInvalidByTopic.inc({topic:r},1)},onDuplicateMsgDelivery(e,t,r){let n=this.toTopic(e);this.duplicateMsgDeliveryDelay.observe({topic:n},t/1e3),r&&this.duplicateMsgLateDelivery.inc({topic:n},1)},onPublishDuplicateMsg(e){let t=this.toTopic(e);this.duplicateMsgIgnored.inc({topic:t},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(e,t){this.rpcRecvBytes.inc(t),this.rpcRecvCount.inc(1),null!=e.subscriptions&&this.rpcRecvSubscription.inc(e.subscriptions.length),null!=e.messages&&this.rpcRecvMessage.inc(e.messages.length),null!=e.control&&(this.rpcRecvControl.inc(1),null!=e.control.ihave&&this.rpcRecvIHave.inc(e.control.ihave.length),null!=e.control.iwant&&this.rpcRecvIWant.inc(e.control.iwant.length),null!=e.control.graft&&this.rpcRecvGraft.inc(e.control.graft.length),null!=e.control.prune&&this.rpcRecvPrune.inc(e.control.prune.length))},onRpcSent(e,t){if(this.rpcSentBytes.inc(t),this.rpcSentCount.inc(1),null!=e.subscriptions&&this.rpcSentSubscription.inc(e.subscriptions.length),null!=e.messages&&this.rpcSentMessage.inc(e.messages.length),null!=e.control){let t=e.control.ihave?.length??0,r=e.control.iwant?.length??0,n=e.control.graft?.length??0,i=e.control.prune?.length??0,s=e.control.idontwant?.length??0;t>0&&this.rpcSentIHave.inc(t),r>0&&this.rpcSentIWant.inc(r),n>0&&this.rpcSentGraft.inc(n),i>0&&this.rpcSentPrune.inc(i),s>0&&this.rpcSentIDontWant.inc(s),(t>0||r>0||n>0||i>0||s>0)&&this.rpcSentControl.inc(1)}},registerScores(e,t){let r=0,n=0,i=0,s=0;for(let o of e)o>=t.graylistThreshold&&r++,o>=t.publishThreshold&&n++,o>=t.gossipThreshold&&i++,o>=0&&s++;this.peersByScoreThreshold.set({threshold:e4.graylist},r),this.peersByScoreThreshold.set({threshold:e4.publish},n),this.peersByScoreThreshold.set({threshold:e4.gossip},i),this.peersByScoreThreshold.set({threshold:e4.mesh},s),this.score.set(e)},registerScoreWeights(e){for(let[t,r]of e.byTopic)this.scoreWeights.set({topic:t,p:"p1"},r.p1w),this.scoreWeights.set({topic:t,p:"p2"},r.p2w),this.scoreWeights.set({topic:t,p:"p3"},r.p3w),this.scoreWeights.set({topic:t,p:"p3b"},r.p3bw),this.scoreWeights.set({topic:t,p:"p4"},r.p4w);this.scoreWeights.set({p:"p5"},e.p5w),this.scoreWeights.set({p:"p6"},e.p6w),this.scoreWeights.set({p:"p7"},e.p7w)},registerScorePerMesh(e,t){let r=new Map;for(let[n,i]of(e.forEach((e,t)=>{let n=this.topicStrToLabel.get(t)??"unknown",i=r.get(n);null==i&&(i=new Set,r.set(n,i)),e.forEach(e=>i?.add(e))}),r)){let e=[];i.forEach(r=>{e.push(t.get(r)??0)}),this.scorePerMesh.set({topic:n},e)}}}}!function(e){e.StrictSign="StrictSign",e.StrictNoSign="StrictNoSign"}(eW||(eW={})),function(e){e[e.Signing=0]="Signing",e[e.Anonymous=1]="Anonymous"}(eQ||(eQ={})),function(e){e.Error="error",e.Ignore="ignore",e.Reject="reject",e.Blacklisted="blacklisted"}(eJ||(eJ={})),function(e){e.InvalidSignature="invalid_signature",e.InvalidSeqno="invalid_seqno",e.InvalidPeerId="invalid_peerid",e.SignaturePresent="signature_present",e.SeqnoPresent="seqno_present",e.FromPresent="from_present",e.TransformFailed="transform_failed"}(eZ||(eZ={})),function(e){e.duplicate="duplicate",e.invalid="invalid",e.valid="valid"}(eY||(eY={})),function(e){e.forward="forward",e.publish="publish"}(eX||(eX={})),function(e){e.Fanout="fanout",e.Random="random",e.Subscribed="subscribed",e.Outbound="outbound",e.NotEnough="not_enough",e.Opportunistic="opportunistic"}(e0||(e0={})),function(e){e.Dc="disconnected",e.BadScore="bad_score",e.Prune="prune",e.Excess="excess"}(e1||(e1={})),function(e){e.GraftBackoff="graft_backoff",e.BrokenPromise="broken_promise",e.MessageDeficit="message_deficit",e.IPColocation="IP_colocation"}(e2||(e2={})),function(e){e.LowScore="low_score",e.MaxIhave="max_ihave",e.MaxIasked="max_iasked"}(e3||(e3={})),function(e){e.graylist="graylist",e.publish="publish",e.gossip="gossip",e.mesh="mesh"}(e4||(e4={}));class FI extends Error{static name="InvalidPeerScoreParamsError";constructor(e="Invalid peer score params"){super(e),this.name="InvalidPeerScoreParamsError"}}let FT={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:36e5},FC={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function FP(e={}){return{...FT,...e,topics:null!=e.topics?Object.entries(e.topics).reduce((e,[t,r])=>(e[t]=FR(r),e),{}):{}}}function FR(e={}){return{...FC,...e}}function FD(e){for(let[t,r]of Object.entries(e.topics))try{FN(r)}catch(e){throw new FI(`invalid score parameters for topic ${t}: ${e.message}`)}if(e.topicScoreCap<0)throw new FI("invalid topic score cap; must be positive (or 0 for no cap)");if(null===e.appSpecificScore||void 0===e.appSpecificScore)throw new FI("missing application specific score function");if(e.IPColocationFactorWeight>0)throw new FI("invalid IPColocationFactorWeight; must be negative (or 0 to disable)");if(0!==e.IPColocationFactorWeight&&e.IPColocationFactorThreshold<1)throw new FI("invalid IPColocationFactorThreshold; must be at least 1");if(e.behaviourPenaltyWeight>0)throw new FI("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)");if(0!==e.behaviourPenaltyWeight&&(e.behaviourPenaltyDecay<=0||e.behaviourPenaltyDecay>=1))throw new FI("invalid BehaviourPenaltyDecay; must be between 0 and 1");if(e.decayInterval<1e3)throw new FI("invalid DecayInterval; must be at least 1s");if(e.decayToZero<=0||e.decayToZero>=1)throw new FI("invalid DecayToZero; must be between 0 and 1")}function FN(e){if(e.topicWeight<0)throw new FI("invalid topic weight; must be >= 0");if(0===e.timeInMeshQuantum)throw new FI("invalid TimeInMeshQuantum; must be non zero");if(e.timeInMeshWeight<0)throw new FI("invalid TimeInMeshWeight; must be positive (or 0 to disable)");if(0!==e.timeInMeshWeight&&e.timeInMeshQuantum<=0)throw new FI("invalid TimeInMeshQuantum; must be positive");if(0!==e.timeInMeshWeight&&e.timeInMeshCap<=0)throw new FI("invalid TimeInMeshCap; must be positive");if(e.firstMessageDeliveriesWeight<0)throw new FI("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)");if(0!==e.firstMessageDeliveriesWeight&&(e.firstMessageDeliveriesDecay<=0||e.firstMessageDeliveriesDecay>=1))throw new FI("invalid FirstMessageDeliveriesDecay; must be between 0 and 1");if(0!==e.firstMessageDeliveriesWeight&&e.firstMessageDeliveriesCap<=0)throw new FI("invalid FirstMessageDeliveriesCap; must be positive");if(e.meshMessageDeliveriesWeight>0)throw new FI("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)");if(0!==e.meshMessageDeliveriesWeight&&(e.meshMessageDeliveriesDecay<=0||e.meshMessageDeliveriesDecay>=1))throw new FI("invalid MeshMessageDeliveriesDecay; must be between 0 and 1");if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesCap<=0)throw new FI("invalid MeshMessageDeliveriesCap; must be positive");if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesThreshold<=0)throw new FI("invalid MeshMessageDeliveriesThreshold; must be positive");if(e.meshMessageDeliveriesWindow<0)throw new FI("invalid MeshMessageDeliveriesWindow; must be non-negative");if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesActivation<1e3)throw new FI("invalid MeshMessageDeliveriesActivation; must be at least 1s");if(e.meshFailurePenaltyWeight>0)throw new FI("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)");if(0!==e.meshFailurePenaltyWeight&&(e.meshFailurePenaltyDecay<=0||e.meshFailurePenaltyDecay>=1))throw new FI("invalid MeshFailurePenaltyDecay; must be between 0 and 1");if(e.invalidMessageDeliveriesWeight>0)throw new FI("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)");if(e.invalidMessageDeliveriesDecay<=0||e.invalidMessageDeliveriesDecay>=1)throw new FI("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1")}let FM={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function FB(e={}){return{...FM,...e}}function FO(e,t,r=()=>!0){let n=new Set;if(t<=0)return n;for(let i of e){if(n.size>=t)break;r(i)&&(n.add(i),e.delete(i))}return n}function FL(e,t){return FO(e,t,()=>!0)}class FF extends Map{getDefault;constructor(e){super(),this.getDefault=e}getOrDefault(e){let t=super.get(e);return void 0===t&&(t=this.getDefault(),this.set(e,t)),t}}function FU(e,t,r,n){let i=0;Object.entries(t.topics).forEach(([e,t])=>{let n=r.topics[e];if(void 0===n)return;let s=0;if(t.inMesh){let e=t.meshTime/n.timeInMeshQuantum;e>n.timeInMeshCap&&(e=n.timeInMeshCap),s+=e*n.timeInMeshWeight}let o=t.firstMessageDeliveries;if(o>n.firstMessageDeliveriesCap&&(o=n.firstMessageDeliveriesCap),s+=o*n.firstMessageDeliveriesWeight,t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<n.meshMessageDeliveriesThreshold){let e=n.meshMessageDeliveriesThreshold-t.meshMessageDeliveries;s+=e*e*n.meshMessageDeliveriesWeight}s+=t.meshFailurePenalty*n.meshFailurePenaltyWeight+t.invalidMessageDeliveries*t.invalidMessageDeliveries*n.invalidMessageDeliveriesWeight,i+=s*n.topicWeight}),r.topicScoreCap>0&&i>r.topicScoreCap&&(i=r.topicScoreCap);let s=r.appSpecificScore(e);if(i+=s*r.appSpecificWeight,t.knownIPs.forEach(e=>{if(r.IPColocationFactorWhitelist.has(e))return;let t=n.get(e),s=null!=t?t.size:0;if(s>r.IPColocationFactorThreshold){let e=s-r.IPColocationFactorThreshold;i+=e*e*r.IPColocationFactorWeight}}),t.behaviourPenalty>r.behaviourPenaltyThreshold){let e=t.behaviourPenalty-r.behaviourPenaltyThreshold;i+=e*e*r.behaviourPenaltyWeight}return i}var Fj=r(48856);!function(e){e[e.unknown=0]="unknown",e[e.valid=1]="valid",e[e.invalid=2]="invalid",e[e.ignored=3]="ignored"}(e5||(e5={}));class FH{records;queue;constructor(){this.records=new Map,this.queue=new Fj}getRecord(e){return this.records.get(e)}ensureRecord(e){let t=this.records.get(e);if(null!=t)return t;t={status:e5.unknown,firstSeenTsMs:Date.now(),validated:0,peers:new Set},this.records.set(e,t);let r={msgId:e,expire:Date.now()+Ff};return this.queue.push(r),t}gc(){let e=Date.now(),t=this.queue.peekFront();for(;null!=t&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}class F${params;metrics;peerStats=new Map;peerIPs=new FF(()=>new Set);scoreCache=new Map;deliveryRecords=new FH;_backgroundInterval;scoreCacheValidityMs;computeScore;log;constructor(e,t,r,n){this.params=e,this.metrics=t,FD(e),this.scoreCacheValidityMs=n.scoreCacheValidityMs,this.computeScore=n.computeScore??FU,this.log=r.forComponent("libp2p:gossipsub:score")}get size(){return this.peerStats.size}start(){if(null!=this._backgroundInterval)return void this.log("Peer score already running");this._backgroundInterval=setInterval(()=>{this.background()},this.params.decayInterval),this.log("started")}stop(){if(null==this._backgroundInterval)return void this.log("Peer score already stopped");clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),this.log("stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([e,t])=>[e,t]))}messageFirstSeenTimestampMs(e){let t=this.deliveryRecords.getRecord(e);return null!=t?t.firstSeenTsMs:null}refreshScores(){let e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach((r,n)=>{if(!r.connected){e>r.expire&&(this.removeIPsForPeer(n,r.knownIPs),this.peerStats.delete(n),this.scoreCache.delete(n));return}Object.entries(r.topics).forEach(([r,n])=>{let i=this.params.topics[r];void 0!==i&&(n.firstMessageDeliveries*=i.firstMessageDeliveriesDecay,n.firstMessageDeliveries<t&&(n.firstMessageDeliveries=0),n.meshMessageDeliveries*=i.meshMessageDeliveriesDecay,n.meshMessageDeliveries<t&&(n.meshMessageDeliveries=0),n.meshFailurePenalty*=i.meshFailurePenaltyDecay,n.meshFailurePenalty<t&&(n.meshFailurePenalty=0),n.invalidMessageDeliveries*=i.invalidMessageDeliveriesDecay,n.invalidMessageDeliveries<t&&(n.invalidMessageDeliveries=0),n.inMesh&&(n.meshTime=e-n.graftTime,n.meshTime>i.meshMessageDeliveriesActivation&&(n.meshMessageDeliveriesActive=!0)))}),r.behaviourPenalty*=this.params.behaviourPenaltyDecay,r.behaviourPenalty<t&&(r.behaviourPenalty=0)})}score(e){this.metrics?.scoreFnCalls.inc();let t=this.peerStats.get(e);if(null==t)return 0;let r=Date.now(),n=this.scoreCache.get(e);if(null!=n&&n.cacheUntil>r)return n.score;this.metrics?.scoreFnRuns.inc();let i=this.computeScore(e,t,this.params,this.peerIPs),s=r+this.scoreCacheValidityMs;return null!=n?(this.metrics?.scoreCachedDelta.observe(Math.abs(i-n.score)),n.score=i,n.cacheUntil=s):this.scoreCache.set(e,{score:i,cacheUntil:s}),i}addPenalty(e,t,r){let n=this.peerStats.get(e);null!=n&&(n.behaviourPenalty+=t,this.metrics?.onScorePenalty(r))}addPeer(e){let t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){let r=this.peerStats.get(e);null!=r&&r.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){let r=this.peerStats.get(e);null!=r&&r.knownIPs.delete(t);let n=this.peerIPs.get(t);null!=n&&(n.delete(e),0===n.size&&this.peerIPs.delete(t))}removePeer(e){let t=this.peerStats.get(e);if(null!=t){if(this.score(e)>0){this.removeIPsForPeer(e,t.knownIPs),this.peerStats.delete(e);return}Object.entries(t.topics).forEach(([e,t])=>{t.firstMessageDeliveries=0;let r=this.params.topics[e].meshMessageDeliveriesThreshold;if(t.inMesh&&t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<r){let e=r-t.meshMessageDeliveries;t.meshFailurePenalty+=e*e}t.inMesh=!1,t.meshMessageDeliveriesActive=!1}),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){let r=this.peerStats.get(e);if(null!=r){let e=this.getPtopicStats(r,t);null!=e&&(e.inMesh=!0,e.graftTime=Date.now(),e.meshTime=0,e.meshMessageDeliveriesActive=!1)}}prune(e,t){let r=this.peerStats.get(e);if(null!=r){let e=this.getPtopicStats(r,t);if(null!=e){let r=this.params.topics[t].meshMessageDeliveriesThreshold;if(e.meshMessageDeliveriesActive&&e.meshMessageDeliveries<r){let t=r-e.meshMessageDeliveries;e.meshFailurePenalty+=t*t}e.meshMessageDeliveriesActive=!1,e.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,r){this.markFirstMessageDelivery(e,r);let n=this.deliveryRecords.ensureRecord(t),i=Date.now();if(n.status!==e5.unknown)return void this.log("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,i-n.firstSeenTsMs,e5[n.status]);n.status=e5.valid,n.validated=i,n.peers.forEach(t=>{t!==e.toString()&&this.markDuplicateMessageDelivery(t,r)})}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,r,n){switch(n){case eJ.Error:this.markInvalidMessageDelivery(e,r);return;case eJ.Blacklisted:return}let i=this.deliveryRecords.ensureRecord(t);if(i.status!==e5.unknown)return void this.log("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-i.firstSeenTsMs,e5[i.status]);if(n===eJ.Ignore){i.status=e5.ignored,i.peers.clear();return}i.status=e5.invalid,this.markInvalidMessageDelivery(e,r),i.peers.forEach(e=>{this.markInvalidMessageDelivery(e,r)}),i.peers.clear()}duplicateMessage(e,t,r){let n=this.deliveryRecords.ensureRecord(t);if(!n.peers.has(e))switch(n.status){case e5.unknown:n.peers.add(e);break;case e5.valid:n.peers.add(e),this.markDuplicateMessageDelivery(e,r,n.validated);break;case e5.invalid:this.markInvalidMessageDelivery(e,r);case e5.ignored:}}markInvalidMessageDelivery(e,t){let r=this.peerStats.get(e);if(null!=r){let e=this.getPtopicStats(r,t);null!=e&&(e.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){let r=this.peerStats.get(e);if(null!=r){let e=this.getPtopicStats(r,t);if(null!=e){let r=this.params.topics[t].firstMessageDeliveriesCap;e.firstMessageDeliveries=Math.min(r,e.firstMessageDeliveries+1),e.inMesh&&(e.meshMessageDeliveries=Math.min(r=this.params.topics[t].meshMessageDeliveriesCap,e.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,r){let n=this.peerStats.get(e);if(null!=n){let e=void 0!==r?Date.now():0,i=this.getPtopicStats(n,t);if(null!=i&&i.inMesh){let n=this.params.topics[t];if(void 0!==r){let i=e-r,s=i>n.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(t,i,s),s)return}i.meshMessageDeliveries=Math.min(n.meshMessageDeliveriesCap,i.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(let r of t){let t=this.peerIPs.get(r);null!=t&&(t.delete(e),0===t.size&&this.peerIPs.delete(r))}}getPtopicStats(e,t){let r=e.topics[t];return void 0!==r?r:void 0!==this.params.topics[t]?(r={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=r,r):null}}function Fq(e,t,r,n,i){let s,o=0,a=new Map;if(Object.entries(t.topics).forEach(([e,t])=>{let n=i.get(e)??"unknown",s=r.topics[e];if(void 0===s)return;let l=a.get(n);null==l&&(l={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},a.set(n,l));let c=0,u=0,d=0,h=0,f=0;t.inMesh&&(c+=Math.max(t.meshTime/s.timeInMeshQuantum,s.timeInMeshCap)*s.timeInMeshWeight);let p=t.firstMessageDeliveries;if(p>s.firstMessageDeliveriesCap&&(p=s.firstMessageDeliveriesCap),u+=p*s.firstMessageDeliveriesWeight,t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<s.meshMessageDeliveriesThreshold){let e=s.meshMessageDeliveriesThreshold-t.meshMessageDeliveries;d+=e*e*s.meshMessageDeliveriesWeight}h+=t.meshFailurePenalty*s.meshFailurePenaltyWeight,f+=t.invalidMessageDeliveries*t.invalidMessageDeliveries*s.invalidMessageDeliveriesWeight,o+=(c+u+d+h+f)*s.topicWeight,l.p1w+=c,l.p2w+=u,l.p3w+=d,l.p3bw+=h,l.p4w+=f}),r.topicScoreCap>0&&o>r.topicScoreCap){o=r.topicScoreCap;let e=r.topicScoreCap/o;for(let t of a.values())t.p1w*=e,t.p2w*=e,t.p3w*=e,t.p3bw*=e,t.p4w*=e}let l=0,c=0;return s=0+r.appSpecificScore(e)*r.appSpecificWeight,t.knownIPs.forEach(e=>{if(r.IPColocationFactorWhitelist.has(e))return;let t=n.get(e),i=null!=t?t.size:0;if(i>r.IPColocationFactorThreshold){let e=i-r.IPColocationFactorThreshold;l+=e*e*r.IPColocationFactorWeight}}),c+=t.behaviourPenalty*t.behaviourPenalty*r.behaviourPenaltyWeight,o+=s+l+c,{byTopic:a,p5w:s,p6w:l,p7w:c,score:o}}function Fz(e,t,r,n,i){let s={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(let o of e){let e=t.get(o);if(null!=e){let t=Fq(o,e,r,n,i);for(let[e,r]of t.byTopic){let t=s.byTopic.get(e);null==t&&(t={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},s.byTopic.set(e,t)),t.p1w.push(r.p1w),t.p2w.push(r.p2w),t.p3w.push(r.p3w),t.p3bw.push(r.p3bw),t.p4w.push(r.p4w)}s.p5w.push(t.p5w),s.p6w.push(t.p6w),s.p7w.push(t.p7w),s.score.push(t.score)}else s.p5w.push(0),s.p6w.push(0),s.p7w.push(0),s.score.push(0)}return s}class FV{rawStream;pushable;closeController;maxBufferSize;constructor(e,t,r){this.rawStream=e,this.pushable=(0,ad.Ny)(),this.closeController=new AbortController,this.maxBufferSize=r.maxBufferSize??1/0,this.closeController.signal.addEventListener("abort",()=>{e.close().catch(t=>{e.abort(t)})}),(0,ac.F)(this.pushable,this.rawStream).catch(t)}get protocol(){return this.rawStream.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(LF.single(e))}pushPrefixed(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}async close(){this.closeController.abort(),await this.pushable.return()}}class FG{source;rawStream;closeController;constructor(e,t={}){this.rawStream=e,this.closeController=new AbortController,this.closeController.signal.addEventListener("abort",()=>{e.close().catch(t=>{e.abort(t)})}),this.source=(0,ac.F)(this.rawStream,e=>LG(e,t))}async close(){this.closeController.abort()}}class FK{gossipsubIWantFollowupMs;msgIdToStrFn;metrics;promises=new Map;requestMsByMsg=new Map;requestMsByMsgExpire;constructor(e,t,r){this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=r,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){let r=Math.floor(Math.random()*t.length),n=t[r],i=this.msgIdToStrFn(n),s=this.promises.get(i);null==s&&(s=new Map,this.promises.set(i,s));let o=Date.now();!s.has(e)&&(s.set(e,o+this.gossipsubIWantFollowupMs),null!=this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(i)||this.requestMsByMsg.set(i,o)))}getBrokenPromises(){let e=Date.now(),t=new Map,r=0;return this.promises.forEach((n,i)=>{n.forEach((i,s)=>{i<e&&(t.set(s,(t.get(s)??0)+1),n.delete(s),r++)}),0===n.size&&this.promises.delete(i)}),this.metrics?.iwantPromiseBroken.inc(r),t}deliverMessage(e,t=!1){this.trackMessage(e);let r=this.promises.get(e);null!=r&&(this.promises.delete(e),null!=this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(r.size)))}rejectMessage(e,t){this.trackMessage(e),t!==eJ.Error&&this.promises.delete(e)}clear(){this.promises.clear()}prune(){let e=Date.now()-this.requestMsByMsgExpire,t=0;for(let[r,n]of this.requestMsByMsg.entries())if(n<e)this.requestMsByMsg.delete(r),t++;else break;this.metrics?.iwantMessagePruned.inc(t)}trackMessage(e){if(null!=this.metrics){let t=this.requestMsByMsg.get(e);void 0!==t&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}}let FW=(0,rx.s)("libp2p-pubsub:");async function FQ(e,t,r,n){switch(e.type){case eQ.Signing:{let i={from:e.author.toMultihash().bytes,data:n,seqno:vi(8),topic:t,signature:void 0,key:void 0},s=tl([FW,eK.Message.encode(i)]);i.signature=await e.privateKey.sign(s),i.key=e.key;let o={type:"signed",from:e.author,data:r,sequenceNumber:BigInt(`0x${(0,uC.d)(i.seqno??new Uint8Array(0),"base16")}`),topic:t,signature:i.signature,key:p2(i.key)};return{raw:i,msg:o}}case eQ.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:t,signature:void 0,key:void 0},msg:{type:"unsigned",data:r,topic:t}};default:throw Error("Unreachable")}}async function FJ(e,t){switch(e){case LB:if(null!=t.signature)return{valid:!1,error:eZ.SignaturePresent};if(null!=t.seqno)return{valid:!1,error:eZ.SeqnoPresent};if(null!=t.key)return{valid:!1,error:eZ.FromPresent};return{valid:!0,message:{type:"unsigned",topic:t.topic,data:t.data??new Uint8Array(0)}};case LM:{let e,r;if(null==t.seqno||8!==t.seqno.length)return{valid:!1,error:eZ.InvalidSeqno};if(null==t.signature)return{valid:!1,error:eZ.InvalidSignature};if(null==t.from)return{valid:!1,error:eZ.InvalidPeerId};try{e=gm(o0.decode(t.from))}catch(e){return{valid:!1,error:eZ.InvalidPeerId}}if(null!=t.key){if(r=p2(t.key),void 0!==e.publicKey&&!r.equals(e.publicKey))return{valid:!1,error:eZ.InvalidPeerId}}else{if(null==e.publicKey)return{valid:!1,error:eZ.InvalidPeerId};r=e.publicKey}let n={from:t.from,data:t.data,seqno:t.seqno,topic:t.topic,signature:void 0,key:void 0},i=tl([FW,eK.Message.encode(n)]);if(!await r.verify(i,t.signature))return{valid:!1,error:eZ.InvalidSignature};return{valid:!0,message:{type:"signed",from:e,data:t.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${(0,uC.d)(t.seqno,"base16")}`),topic:t.topic,signature:t.signature,key:null!=t.key?p2(t.key):r}}}default:throw Error("Unreachable")}}function FZ(e=[],t){return{subscriptions:[],messages:e,control:void 0!==t?{graft:t.graft??[],prune:t.prune??[],ihave:t.ihave??[],iwant:t.iwant??[],idontwant:t.idontwant??[]}:void 0}}function FY(e){return void 0===e.control&&(e.control={graft:[],prune:[],ihave:[],iwant:[],idontwant:[]}),e}function FX(e){return(0,uC.d)(e,"base64")}function F0(e){if(e.length<=1)return e;let t=()=>Math.floor(Math.random()*Math.floor(e.length));for(let r=0;r<e.length;r++){let n=t(),i=e[r];e[r]=e[n],e[n]=i}return e}let F1=(e,t)=>{let r=(0,rx.s)(t.toString(16).padStart(16,"0"),"base16"),n=p5(e),i=new Uint8Array(n.byteLength+r.length);return i.set(n,0),i.set(r,n.byteLength),i};function F2(e){if("signed"!==e.type)throw Error("expected signed message type");if(null==e.sequenceNumber)throw Error("missing seqno field");return F1(e.from.publicKey??e.key,e.sequenceNumber)}async function F3(e){return rX.sha256.encode(e.data)}function F4(e){for(let t of e.tuples())switch(t[0]){case e6.ip4:case e6.ip6:return yh(t[0],t[1])}return null}function F5(e,t,r){switch(e){case LM:return{type:eQ.Signing,author:t,key:p5(r.publicKey),privateKey:r};case LB:return{type:eQ.Anonymous};default:throw Error(`Unknown signature policy "${e}"`)}}!function(e){e[e.ip4=4]="ip4",e[e.ip6=41]="ip6"}(e6||(e6={}));class F6{entries=new Map;validityMs;constructor(e){this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return!!this.entries.has(e)||(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){let e=Date.now();for(let[t,r]of this.entries.entries())if(r.validUntilMs<e)this.entries.delete(t);else break}has(e){return this.entries.has(e)}get(e){let t=this.entries.get(e);return null!=t&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}}!function(e){e[e.started=0]="started",e[e.stopped=1]="stopped"}(e8||(e8={}));class F8 extends cf{globalSignaturePolicy;multicodecs=[LJ,LQ,LW];publishConfig;dataTransform;peers=new Map;streamsInbound=new Map;streamsOutbound=new Map;outboundInflightQueue=(0,ad.Ny)({objectMode:!0});direct=new Set;floodsubPeers=new Set;seenCache;acceptFromWhitelist=new Map;topics=new Map;subscriptions=new Set;mesh=new Map;fanout=new Map;fanoutLastpub=new Map;gossip=new Map;control=new Map;peerhave=new Map;iasked=new Map;backoff=new Map;outbound=new Map;msgIdFn;fastMsgIdFn;msgIdToStrFn;fastMsgIdCache;publishedMessageIds;mcache;score;topicValidators=new Map;log;heartbeatTicks=0;gossipTracer;idontwantCounts=new Map;idontwants=new Map;components;directPeerInitial=null;static multicodec=LJ;opts;decodeRpcLimits;metrics;status={code:e8.stopped};maxInboundStreams;maxOutboundStreams;runOnLimitedConnection;allowedTopics;heartbeatTimer=null;constructor(e,t={}){super();let r={fallbackToFloodsub:!0,floodPublish:!0,batchPublish:!1,tagMeshPeers:!0,doPX:!1,directPeers:[],D:LZ,Dlo:LY,Dhi:LX,Dscore:L0,Dout:L1,Dlazy:L4,heartbeatInterval:L7,fanoutTTL:L9,mcacheLength:L2,mcacheGossip:L3,seenTTL:Fh,gossipsubIWantFollowupMs:Fd,prunePeers:Fe,pruneBackoff:Ft,unsubcribeBackoff:Fr,graftFloodThreshold:Fl,opportunisticGraftPeers:Fa,opportunisticGraftTicks:Fo,directConnectTicks:Fi,gossipFactor:L5,idontwantMinDataSize:FE,idontwantMaxMessages:FA,...t,scoreParams:FP(t.scoreParams),scoreThresholds:FB(t.scoreThresholds)};if(this.components=e,this.decodeRpcLimits=r.decodeRpcLimits??Fx,this.globalSignaturePolicy=r.globalSignaturePolicy??LM,r.fallbackToFloodsub&&this.multicodecs.push(LK),this.log=e.logger.forComponent(r.debugName??"libp2p:gossipsub"),this.opts=r,this.direct=new Set(r.directPeers.map(e=>e.id.toString())),this.seenCache=new F6({validityMs:r.seenTTL}),this.publishedMessageIds=new F6({validityMs:r.seenTTL}),null!=t.msgIdFn)this.msgIdFn=t.msgIdFn;else switch(this.globalSignaturePolicy){case LM:this.msgIdFn=F2;break;case LB:this.msgIdFn=F3;break;default:throw Error(`Invalid globalSignaturePolicy: ${this.globalSignaturePolicy}`)}if(null!=t.fastMsgIdFn&&(this.fastMsgIdFn=t.fastMsgIdFn,this.fastMsgIdCache=new F6({validityMs:r.seenTTL})),this.msgIdToStrFn=t.msgIdToStrFn??FX,this.mcache=t.messageCache??new FS(r.mcacheGossip,r.mcacheLength,this.msgIdToStrFn),null!=t.dataTransform&&(this.dataTransform=t.dataTransform),null!=t.metricsRegister){if(null==t.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");let e=Math.max(...Object.values(r.scoreParams.topics).map(e=>e.meshMessageDeliveriesWindow),Fw),n=F_(t.metricsRegister,t.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:r.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:e/1e3});for(let e of(n.mcacheSize.addCollect(()=>{this.onScrapeMetrics(n)}),this.multicodecs))n.protocolsEnabled.set({protocol:e},1);this.metrics=n}else this.metrics=null;this.gossipTracer=new FK(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new F$(this.opts.scoreParams,this.metrics,this.components.logger,{scoreCacheValidityMs:r.heartbeatInterval}),this.maxInboundStreams=t.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams,this.runOnLimitedConnection=t.runOnLimitedConnection,this.allowedTopics=null!=r.allowedTopics?new Set(r.allowedTopics):null}[Symbol.toStringTag]="@chainsafe/libp2p-gossipsub";[vs]=["@libp2p/pubsub"];[vo]=["@libp2p/identify"];getPeers(){return[...this.peers.values()]}isStarted(){return this.status.code===e8.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=F5(this.globalSignaturePolicy,this.components.peerId,this.components.privateKey),this.outboundInflightQueue=(0,ad.Ny)({objectMode:!0}),(0,ac.F)(this.outboundInflightQueue,async e=>{for await(let{peerId:t,connection:r}of e)await this.createOutboundStream(t,r)}).catch(e=>{this.log.error("outbound inflight queue error",e)}),await Promise.all(this.opts.directPeers.map(async e=>{await this.components.peerStore.merge(e.id,{multiaddrs:e.addrs})}));let e=this.components.registrar;await Promise.all(this.multicodecs.map(async t=>e.handle(t,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection})));let t={onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this),notifyOnLimitedConnection:this.runOnLimitedConnection},r=await Promise.all(this.multicodecs.map(async r=>e.register(r,t))),n=setTimeout(this.runHeartbeat,L8);this.status={code:e8.started,registrarTopologyIds:r,heartbeatTimeout:n,hearbeatStartMs:Date.now()+L8},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async e=>this.connect(e)))}).catch(e=>{this.log(e)})},Fs),this.opts.tagMeshPeers&&(this.addEventListener("gossipsub:graft",this.tagMeshPeer),this.addEventListener("gossipsub:prune",this.untagMeshPeer)),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==e8.started)return;let{registrarTopologyIds:e}=this.status;this.status={code:e8.stopped},this.opts.tagMeshPeers&&(this.removeEventListener("gossipsub:graft",this.tagMeshPeer),this.removeEventListener("gossipsub:prune",this.untagMeshPeer));let t=this.components.registrar;await Promise.all(this.multicodecs.map(async e=>t.unhandle(e))),e.forEach(e=>{t.unregister(e)}),this.outboundInflightQueue.end();let r=[];for(let e of this.streamsOutbound.values())r.push(e.close());for(let e of(this.streamsOutbound.clear(),this.streamsInbound.values()))r.push(e.close());this.streamsInbound.clear(),await Promise.all(r),this.peers.clear(),this.subscriptions.clear(),null!=this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),null!=this.fastMsgIdCache&&this.fastMsgIdCache.clear(),null!=this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.idontwantCounts.clear(),this.idontwants.clear(),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:e,connection:t}){if(!this.isStarted())return;let r=t.remotePeer;this.addPeer(r,t.direction,t.remoteAddr),this.createInboundStream(r,e),this.outboundInflightQueue.push({peerId:r,connection:t})}onPeerConnected(e,t){this.metrics?.newConnectionCount.inc({status:t.status}),this.isStarted()&&"open"===t.status&&(this.addPeer(e,t.direction,t.remoteAddr),this.outboundInflightQueue.push({peerId:e,connection:t}))}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}async createOutboundStream(e,t){if(!this.isStarted())return;let r=e.toString();if(this.peers.has(r)&&!this.streamsOutbound.has(r))try{let n=new FV(await t.newStream(this.multicodecs,{runOnLimitedConnection:this.runOnLimitedConnection}),e=>{this.log.error("outbound pipe error",e)},{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",e),this.streamsOutbound.set(r,n);let i=n.protocol;i===LK&&this.floodsubPeers.add(r),this.metrics?.peersPerProtocol.inc({protocol:i},1),this.subscriptions.size>0&&(this.log("send subscriptions to",r),this.sendSubscriptions(r,Array.from(this.subscriptions),!0))}catch(e){this.log.error("createOutboundStream error",e)}}createInboundStream(e,t){if(!this.isStarted())return;let r=e.toString();if(!this.peers.has(r))return;let n=this.streamsInbound.get(r);void 0!==n&&(this.log("replacing existing inbound steam %s",r),n.close().catch(e=>{this.log.error(e)})),this.log("create inbound stream %s",r);let i=new FG(t,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(r,i),this.pipePeerReadStream(e,i.source).catch(e=>{this.log(e)})}addPeer(e,t,r){let n=e.toString();if(!this.peers.has(n)){this.log("new peer %p",e),this.peers.set(n,e),this.score.addPeer(n);let i=F4(r);null!==i?this.score.addIP(n,i):this.log("Added peer has no IP in current address %s %s",n,r.toString()),this.outbound.has(n)||this.outbound.set(n,"outbound"===t)}}removePeer(e){let t=e.toString();if(!this.peers.has(t))return;this.log("delete peer %p",e),this.peers.delete(t);let r=this.streamsOutbound.get(t),n=this.streamsInbound.get(t);for(let e of(null!=r&&this.metrics?.peersPerProtocol.inc({protocol:r.protocol},-1),r?.close().catch(e=>{this.log.error(e)}),n?.close().catch(e=>{this.log.error(e)}),this.streamsOutbound.delete(t),this.streamsInbound.delete(t),this.topics.values()))e.delete(t);for(let[e,r]of this.mesh)r.delete(t)&&this.metrics?.onRemoveFromMesh(e,e1.Dc,1);for(let e of this.fanout.values())e.delete(t);this.floodsubPeers.delete(t),this.gossip.delete(t),this.control.delete(t),this.outbound.delete(t),this.idontwantCounts.delete(t),this.idontwants.delete(t),this.score.removePeer(t),this.acceptFromWhitelist.delete(t)}get started(){return this.status.code===e8.started}getMeshPeers(e){let t=this.mesh.get(e);return null!=t?Array.from(t):[]}getSubscribers(e){let t=this.topics.get(e);return(null!=t?Array.from(t):[]).map(e=>this.peers.get(e)??gf(e))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,t){try{await (0,ac.F)(t,async t=>{for await(let r of t)try{let t=r.subarray(),n=eK.decode(t,{limits:{subscriptions:this.decodeRpcLimits.maxSubscriptions,messages:this.decodeRpcLimits.maxMessages,control$:{ihave:this.decodeRpcLimits.maxIhaveMessageIDs,iwant:this.decodeRpcLimits.maxIwantMessageIDs,graft:this.decodeRpcLimits.maxControlMessages,prune:this.decodeRpcLimits.maxControlMessages,prune$:{peers:this.decodeRpcLimits.maxPeerInfos},idontwant:this.decodeRpcLimits.maxControlMessages,idontwant$:{messageIDs:this.decodeRpcLimits.maxIdontwantMessageIDs}}}});if(this.metrics?.onRpcRecv(n,t.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(e,n)}catch(e){this.metrics?.onRpcRecvError(),this.log(e)}else this.handleReceivedRpc(e,n).catch(e=>{this.metrics?.onRpcRecvError(),this.log(e)})}catch(e){this.metrics?.onRpcDataError(),this.log(e)}})}catch(t){this.metrics?.onPeerReadStreamError(),this.handlePeerReadStreamError(t,e)}}handlePeerReadStreamError(e,t){this.log.error(e),this.onPeerDisconnected(t)}async handleReceivedRpc(e,t){if(!this.acceptFrom(e.toString())){this.log("received message from unacceptable peer %p",e),this.metrics?.rpcRecvNotAccepted.inc();return}let r=null!=t.subscriptions?t.subscriptions.length:0,n=null!=t.messages?t.messages.length:0,i=0,s=0,o=0,a=0;if(null!=t.control&&(null!=t.control.ihave&&(i=t.control.ihave.length),null!=t.control.iwant&&(s=t.control.iwant.length),null!=t.control.graft&&(o=t.control.graft.length),null!=t.control.prune&&(a=t.control.prune.length)),this.log(`rpc.from ${e.toString()} subscriptions ${r} messages ${n} ihave ${i} iwant ${s} graft ${o} prune ${a}`),null!=t.subscriptions&&t.subscriptions.length>0){let r=[];t.subscriptions.forEach(t=>{let n=t.topic,i=!0===t.subscribe;if(null!=n){if(null!=this.allowedTopics&&!this.allowedTopics.has(n))return;this.handleReceivedSubscription(e,n,i),r.push({topic:n,subscribe:i})}}),this.safeDispatchEvent("subscription-change",{detail:{peerId:e,subscriptions:r}})}for(let r of t.messages){if(null!=this.allowedTopics&&!this.allowedTopics.has(r.topic))continue;let t=this.handleReceivedMessage(e,r).catch(e=>{this.metrics?.onMsgRecvError(r.topic),this.log(e)});this.opts.awaitRpcMessageHandler&&await t}null!=t.control&&await this.handleControlMessage(e.toString(),t.control)}handleReceivedSubscription(e,t,r){this.log("subscription update from %p topic %s",e,t);let n=this.topics.get(t);null==n&&(n=new Set,this.topics.set(t,n)),r?n.add(e.toString()):n.delete(e.toString())}async handleReceivedMessage(e,t){this.metrics?.onMsgRecvPreValidation(t.topic);let r=await this.validateReceivedMessage(e,t);this.metrics?.onPrevalidationResult(t.topic,r.code);let n=r.code;switch(n){case eY.duplicate:this.score.duplicateMessage(e.toString(),r.msgIdStr,t.topic),this.gossipTracer.deliverMessage(r.msgIdStr,!0),this.mcache.observeDuplicate(r.msgIdStr,e.toString());return;case eY.invalid:if(null!=r.msgIdStr){let n=r.msgIdStr;this.score.rejectMessage(e.toString(),n,t.topic,r.reason),this.gossipTracer.rejectMessage(n,r.reason)}else this.score.rejectInvalidMessage(e.toString(),t.topic);this.metrics?.onMsgRecvInvalid(t.topic,r);return;case eY.valid:this.score.validateMessage(r.messageId.msgIdStr),this.gossipTracer.deliverMessage(r.messageId.msgIdStr),this.mcache.put(r.messageId,t,!this.opts.asyncValidation),this.subscriptions.has(t.topic)&&(!this.components.peerId.equals(e)||this.opts.emitSelf)&&(super.dispatchEvent(new CustomEvent("gossipsub:message",{detail:{propagationSource:e,msgId:r.messageId.msgIdStr,msg:r.msg}})),super.dispatchEvent(new CustomEvent("message",{detail:r.msg}))),this.opts.asyncValidation||this.forwardMessage(r.messageId.msgIdStr,t,e.toString());break;default:throw Error(`Invalid validation result: ${n}`)}}async validateReceivedMessage(e,t){let r=this.fastMsgIdFn?.(t),n=void 0!==r?this.fastMsgIdCache?.get(r):void 0;if(null!=n)return{code:eY.duplicate,msgIdStr:n};let i=await FJ(this.globalSignaturePolicy,t);if(!i.valid)return{code:eY.invalid,reason:eJ.Error,error:i.error};let s=i.message;try{null!=this.dataTransform&&(s.data=this.dataTransform.inboundTransform(t.topic,s.data))}catch(e){return this.log("Invalid message, transform failed",e),{code:eY.invalid,reason:eJ.Error,error:eZ.TransformFailed}}let o=await this.msgIdFn(s),a=this.msgIdToStrFn(o),l={msgId:o,msgIdStr:a};if(void 0!==r&&null!=this.fastMsgIdCache&&this.fastMsgIdCache.put(r,a)&&this.metrics?.fastMsgIdCacheCollision.inc(),this.seenCache.has(a))return{code:eY.duplicate,msgIdStr:a};this.seenCache.put(a),(t.data?.length??0)>=this.opts.idontwantMinDataSize&&this.sendIDontWants(o,t.topic,e.toString());let c=this.topicValidators.get(t.topic);if(null!=c){let t;try{t=await c(e,s)}catch(r){let e=r.code;e===Fg&&(t=eV.Ignore),t=e===Fp?eV.Reject:eV.Ignore}if(t!==eV.Accept)return{code:eY.invalid,reason:Fk(t),msgIdStr:a}}return{code:eY.valid,messageId:l,msg:s}}getScore(e){return this.score.score(e)}sendSubscriptions(e,t,r){this.sendRpc(e,{subscriptions:t.map(e=>({topic:e,subscribe:r})),messages:[]})}async handleControlMessage(e,t){if(void 0===t)return;let r=t.ihave?.length>0?this.handleIHave(e,t.ihave):[],n=t.iwant?.length>0?this.handleIWant(e,t.iwant):[],i=t.graft?.length>0?await this.handleGraft(e,t.graft):[];if(t.prune?.length>0&&await this.handlePrune(e,t.prune),t.idontwant?.length>0&&this.handleIdontwant(e,t.idontwant),0===r.length&&0===n.length&&0===i.length)return;let s=this.sendRpc(e,FZ(n,{iwant:r,prune:i})),o=r[0]?.messageIDs;null!=o&&(s?this.gossipTracer.addPromise(e,o):this.metrics?.iwantPromiseUntracked.inc(1))}acceptFrom(e){if(this.direct.has(e))return!0;let t=Date.now(),r=this.acceptFromWhitelist.get(e);if(null!=r&&r.messagesAccepted<Fy&&r.acceptUntil>=t)return r.messagesAccepted+=1,!0;let n=this.score.score(e);return n>=Fm?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:t+Fb}):this.acceptFromWhitelist.delete(e),n>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,t){if(0===t.length)return[];let r=this.score.score(e);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,r),this.metrics?.ihaveRcvIgnored.inc({reason:e3.LowScore}),[];let n=(this.peerhave.get(e)??0)+1;if(this.peerhave.set(e,n),n>Fu)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,n),this.metrics?.ihaveRcvIgnored.inc({reason:e3.MaxIhave}),[];let i=this.iasked.get(e)??0;if(i>=Fc)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,i),this.metrics?.ihaveRcvIgnored.inc({reason:e3.MaxIasked}),[];let s=new Map;if(t.forEach(({topicID:e,messageIDs:t})=>{if(null==e||null==t||!this.mesh.has(e))return;let r=0;t.forEach(e=>{let t=this.msgIdToStrFn(e);!this.seenCache.has(t)&&(s.set(t,e),r++)}),this.metrics?.onIhaveRcv(e,t.length,r)}),0===s.size)return[];let o=s.size;o+i>Fc&&(o=Fc-i),this.log("IHAVE: Asking for %d out of %d messages from %s",o,s.size,e);let a=Array.from(s.values());return F0(a),a=a.slice(0,o),this.iasked.set(e,i+o),[{messageIDs:a}]}handleIWant(e,t){if(0===t.length)return[];let r=this.score.score(e);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,r),[];let n=new Map,i=new Map,s=0;return(t.forEach(({messageIDs:t})=>{t?.forEach(t=>{let r=this.msgIdToStrFn(t),o=this.mcache.getWithIWantCount(r,e);return null==o?void s++:(i.set(o.msg.topic,1+(i.get(o.msg.topic)??0)),o.count>L6)?void this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,t):void n.set(r,o.msg)})}),this.metrics?.onIwantRcv(i,s),0===n.size)?(this.log("IWANT: Could not provide any wanted messages to %s",e),[]):(this.log("IWANT: Sending %d messages to %s",n.size,e),Array.from(n.values()))}async handleGraft(e,t){let r=[],n=this.score.score(e),i=Date.now(),s=this.opts.doPX;if(t.forEach(({topicID:t})=>{if(null==t)return;let o=this.mesh.get(t);if(null==o){s=!1;return}if(o.has(e))return;let a=this.backoff.get(t)?.get(e);this.direct.has(e)?(this.log("GRAFT: ignoring request from direct peer %s",e),r.push(t),s=!1):"number"==typeof a&&i<a?(this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,e2.GraftBackoff),s=!1,i<a+this.opts.graftFloodThreshold-this.opts.pruneBackoff&&this.score.addPenalty(e,1,e2.GraftBackoff),this.addBackoff(e,t),r.push(t)):n<0?(this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,n,t),r.push(t),s=!1,this.addBackoff(e,t)):o.size>=this.opts.Dhi&&!this.outbound.get(e)?(r.push(t),this.addBackoff(e,t)):(this.log("GRAFT: Add mesh link from %s in %s",e,t),this.score.graft(e,t),o.add(e),this.metrics?.onAddToMesh(t,e0.Subscribed,1)),this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:e,topic:t,direction:"inbound"}})}),0===r.length)return[];let o=!1;return Promise.all(r.map(async t=>this.makePrune(e,t,s,o)))}async handlePrune(e,t){let r=this.score.score(e);for(let{topicID:n,backoff:i,peers:s}of t){if(null==n)continue;let t=this.mesh.get(n);if(null==t)return;this.log("PRUNE: Remove mesh link to %s in %s",e,n),this.score.prune(e,n),t.has(e)&&(t.delete(e),this.metrics?.onRemoveFromMesh(n,e1.Prune,1)),"number"==typeof i&&i>0?this.doAddBackoff(e,n,1e3*i):this.addBackoff(e,n),null!=s&&s.length>0&&(r<this.opts.scoreThresholds.acceptPXThreshold?this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,r,n):await this.pxConnect(s)),this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:e,topic:n,direction:"inbound"}})}}handleIdontwant(e,t){let r=this.idontwantCounts.get(e)??0;if(r>=this.opts.idontwantMaxMessages)return;let n=r,i=this.idontwants.get(e);null==i&&(i=new Map,this.idontwants.set(e,i));let s=0;e:for(let{messageIDs:e}of t)for(let t of e){if(r>=this.opts.idontwantMaxMessages)break e;r++;let e=this.msgIdToStrFn(t);i.set(e,this.heartbeatTicks),!this.mcache.msgs.has(e)&&s++}this.idontwantCounts.set(e,r);let o=r-n;this.metrics?.onIdontwantRcv(o,s)}addBackoff(e,t){this.doAddBackoff(e,t,this.opts.pruneBackoff)}doAddBackoff(e,t,r){let n=this.backoff.get(t);null==n&&(n=new Map,this.backoff.set(t,n));let i=Date.now()+r;(n.get(e)??0)<i&&n.set(e,i)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((e,t)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",t,e),this.score.addPenalty(t,e,e2.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%Fn!=0)return;let e=Date.now();this.backoff.forEach((t,r)=>{t.forEach((r,n)=>{r+Fv*this.opts.heartbeatInterval<e&&t.delete(n)}),0===t.size&&this.backoff.delete(r)})}async directConnect(){let e=[];this.direct.forEach(t=>{this.streamsOutbound.has(t)||e.push(t)}),await Promise.all(e.map(async e=>this.connect(e)))}async pxConnect(e){e.length>this.opts.prunePeers&&(F0(e),e=e.slice(0,this.opts.prunePeers));let t=[];await Promise.all(e.map(async e=>{if(null==e.peerID)return;let r=gm(o0.decode(e.peerID)),n=r.toString();if(!this.peers.has(n)){if(null==e.signedPeerRecord)return void t.push(n);try{if(!await this.components.peerStore.consumePeerRecord(e.signedPeerRecord,r))return void this.log("bogus peer record obtained through px: could not add peer record to address book");t.push(n)}catch(e){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),0!==t.length&&await Promise.all(t.map(async e=>this.connect(e)))}async connect(e){this.log("Initiating connection with %s",e);let t=gf(e),r=await this.components.connectionManager.openConnection(t);for(let e of this.multicodecs)for(let n of this.components.registrar.getTopologies(e))n.onConnect?.(t,r)}subscribe(e){if(this.status.code!==e8.started)throw Error("Pubsub has not started");if(!this.subscriptions.has(e))for(let t of(this.subscriptions.add(e),this.peers.keys()))this.sendSubscriptions(t,[e],!0);this.join(e)}unsubscribe(e){if(this.status.code!==e8.started)throw Error("Pubsub is not started");let t=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,t),t)for(let t of this.peers.keys())this.sendSubscriptions(t,[e],!1);this.leave(e)}join(e){if(this.status.code!==e8.started)throw Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),this.metrics?.onJoin(e);let t=new Set,r=this.backoff.get(e),n=this.fanout.get(e);if(null!=n&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),n.forEach(e=>{!this.direct.has(e)&&this.score.score(e)>=0&&r?.has(e)!==!0&&t.add(e)}),this.metrics?.onAddToMesh(e,e0.Fanout,t.size)),t.size<this.opts.D){let n=t.size;this.getRandomGossipPeers(e,this.opts.D,e=>!t.has(e)&&!this.direct.has(e)&&this.score.score(e)>=0&&r?.has(e)!==!0).forEach(e=>{t.add(e)}),this.metrics?.onAddToMesh(e,e0.Random,t.size-n)}this.mesh.set(e,t),t.forEach(t=>{this.log("JOIN: Add mesh link to %s in %s",t,e),this.sendGraft(t,e)})}leave(e){if(this.status.code!==e8.started)throw Error("Gossipsub has not started");this.log("LEAVE %s",e),this.metrics?.onLeave(e);let t=this.mesh.get(e);null!=t&&(Promise.all(Array.from(t).map(async t=>{this.log("LEAVE: Remove mesh link to %s in %s",t,e),await this.sendPrune(t,e)})).catch(e=>{this.log("Error sending prunes to mesh peers",e)}),this.mesh.delete(e))}selectPeersToForward(e,t,r){let n=new Set,i=this.topics.get(e);null!=i&&(this.direct.forEach(e=>{i.has(e)&&t!==e&&!r?.has(e)&&n.add(e)}),this.floodsubPeers.forEach(e=>{i.has(e)&&t!==e&&!r?.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&n.add(e)}));let s=this.mesh.get(e);return null!=s&&s.size>0&&s.forEach(e=>{t===e||r?.has(e)||n.add(e)}),n}selectPeersToPublish(e){let t=new Set,r={direct:0,floodsub:0,mesh:0,fanout:0},n=this.topics.get(e);if(null!=n)if(this.opts.floodPublish)n.forEach(e=>{this.direct.has(e)?(t.add(e),r.direct++):this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),r.floodsub++)});else{this.direct.forEach(e=>{n.has(e)&&(t.add(e),r.direct++)}),this.floodsubPeers.forEach(e=>{n.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),r.floodsub++)});let i=this.mesh.get(e);if(null!=i&&i.size>0)i.forEach(e=>{t.add(e),r.mesh++}),i.size<this.opts.D&&this.getRandomGossipPeers(e,this.opts.D-i.size,e=>!i.has(e)&&!this.direct.has(e)&&!this.floodsubPeers.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold).forEach(e=>{t.add(e),r.mesh++});else{let n=this.fanout.get(e);if(null!=n&&n.size>0)n.forEach(e=>{t.add(e),r.fanout++});else{let n=this.getRandomGossipPeers(e,this.opts.D,e=>this.score.score(e)>=this.opts.scoreThresholds.publishThreshold);n.size>0&&(this.fanout.set(e,n),n.forEach(e=>{t.add(e),r.fanout++}))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:t,tosendCount:r}}forwardMessage(e,t,r,n){null!=r&&this.score.deliverMessage(r,e,t.topic);let i=this.selectPeersToForward(t.topic,r,n);i.forEach(e=>{this.sendRpc(e,FZ([t]))}),this.metrics?.onForwardMsg(t.topic,i.size)}async publish(e,t,r){let n=Date.now(),i=null!=this.dataTransform?this.dataTransform.outboundTransform(e,t):t;if(null==this.publishConfig)throw Error("PublishError.Uninitialized");let{raw:s,msg:o}=await FQ(this.publishConfig,e,t,i),a=await this.msgIdFn(o),l=this.msgIdToStrFn(a),c=r?.ignoreDuplicatePublishError??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(l)){if(c)return this.metrics?.onPublishDuplicateMsg(e),{recipients:[]};throw Error("PublishError.Duplicate")}let{tosend:u,tosendCount:d}=this.selectPeersToPublish(e),h=this.opts.emitSelf&&this.subscriptions.has(e),f=r?.allowPublishToZeroTopicPeers??this.opts.allowPublishToZeroTopicPeers;if(0===u.size&&!f&&!h)throw Error("PublishError.NoPeersSubscribedToTopic");this.seenCache.put(l),this.mcache.put({msgId:a,msgIdStr:l},s,!0),this.publishedMessageIds.put(l);let p=r?.batchPublish??this.opts.batchPublish,g=FZ([s]);if(p)this.sendRpcInBatch(u,g);else for(let e of u)this.sendRpc(e,g)||u.delete(e);let m=Date.now()-n;return this.metrics?.onPublishMsg(e,d,u.size,null!=s.data?s.data.length:0,m),h&&(u.add(this.components.peerId.toString()),super.dispatchEvent(new CustomEvent("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:l,msg:o}})),super.dispatchEvent(new CustomEvent("message",{detail:o}))),{recipients:Array.from(u.values()).map(e=>this.peers.get(e)??gf(e))}}sendRpcInBatch(e,t){let r=eK.encode(t),n=LF.single(r);for(let i of e){let s=this.streamsOutbound.get(i);if(null==s){this.log(`Cannot send RPC to ${i} as there is no open stream to it available`),e.delete(i);continue}try{s.pushPrefixed(n)}catch(t){e.delete(i),this.log.error(`Cannot send rpc to ${i}`,t)}this.metrics?.onRpcSent(t,r.length)}}reportMessageValidationResult(e,t,r){let n;if(r===eV.Accept){if(null!=(n=this.mcache.validate(e))){let{message:r,originatingPeers:i}=n;this.score.deliverMessage(t,e,r.topic),this.forwardMessage(e,n.message,t,i)}}else if(null!=(n=this.mcache.remove(e))){let i=Fk(r),{message:s,originatingPeers:o}=n;for(let r of(this.score.rejectMessage(t,e,s.topic,i),o))this.score.rejectMessage(r,e,s.topic,i)}let i=this.score.messageFirstSeenTimestampMs(e);this.metrics?.onReportValidation(n,r,i)}sendGraft(e,t){let r=FZ([],{graft:[{topicID:t}]});this.sendRpc(e,r)}async sendPrune(e,t){let r=!0,n=FZ([],{prune:[await this.makePrune(e,t,this.opts.doPX,r)]});this.sendRpc(e,n)}sendIDontWants(e,t,r){let n=this.mesh.get(t);if(null==n)return;let i=new Set(n);for(let e of(i.delete(r),i))this.streamsOutbound.get(e)?.protocol!==LJ&&i.delete(e);let s=FZ([],{idontwant:[{messageIDs:[e]}]});this.sendRpcInBatch(i,s)}sendRpc(e,t){let r=this.streamsOutbound.get(e);if(null==r)return this.log(`Cannot send RPC to ${e} as there is no open stream to it available`),!1;let n=this.control.get(e);null!=n&&(this.piggybackControl(e,t,n),this.control.delete(e));let i=this.gossip.get(e);null!=i&&(this.piggybackGossip(e,t,i),this.gossip.delete(e));let s=eK.encode(t);try{r.push(s)}catch(t){return this.log.error(`Cannot send rpc to ${e}`,t),null!=n&&this.control.set(e,n),null!=i&&this.gossip.set(e,i),!1}if(this.metrics?.onRpcSent(t,s.length),t.control?.graft!=null)for(let r of t.control?.graft)null!=r.topicID&&this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:e,topic:r.topicID,direction:"outbound"}});if(t.control?.prune!=null)for(let r of t.control?.prune)null!=r.topicID&&this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:e,topic:r.topicID,direction:"outbound"}});return!0}piggybackControl(e,t,r){let n=FY(t);for(let t of r.graft)null!=t.topicID&&this.mesh.get(t.topicID)?.has(e)&&n.control.graft.push(t);for(let t of r.prune)null==t.topicID||this.mesh.get(t.topicID)?.has(e)||n.control.prune.push(t)}piggybackGossip(e,t,r){FY(t).control.ihave=r}async sendGraftPrune(e,t,r){let n=this.opts.doPX,i=!1;for(let[s,o]of e){let e=o.map(e=>({topicID:e})),a=[],l=t.get(s);null!=l&&(a=await Promise.all(l.map(async e=>this.makePrune(s,e,n&&!r.get(s),i))),t.delete(s)),this.sendRpc(s,FZ([],{graft:e,prune:a}))}for(let[e,s]of t){let t=await Promise.all(s.map(async t=>this.makePrune(e,t,n&&!r.get(e),i)));this.sendRpc(e,FZ([],{prune:t}))}}emitGossip(e){let t=this.mcache.getGossipIDs(new Set(e.keys()));for(let[r,n]of e)this.doEmitGossip(r,n,t.get(r)??[])}doEmitGossip(e,t,r){if(0===r.length||(F0(r),r.length>Fc&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",r.length),0===t.size))return;let n=this.opts.Dlazy,i=this.opts.gossipFactor*t.size,s=t;i>n&&(n=i),n>s.size?n=s.size:s=F0(Array.from(s)).slice(0,n),s.forEach(t=>{let n=r;r.length>Fc&&(n=F0(n.slice()).slice(0,Fc)),this.pushGossip(t,{topicID:e,messageIDs:n})})}flush(){for(let[e,t]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,FZ([],{ihave:t}));for(let[e,t]of this.control.entries()){this.control.delete(e);let r=FZ([],{graft:t.graft,prune:t.prune});this.sendRpc(e,r)}}pushGossip(e,t){this.log("Add gossip to %s",e);let r=this.gossip.get(e)??[];this.gossip.set(e,r.concat(t))}async makePrune(e,t,r,n){if(this.score.prune(e,t),this.streamsOutbound.get(e)?.protocol===LW)return{topicID:t,peers:[]};let i=n?this.opts.unsubcribeBackoff:this.opts.pruneBackoff,s=i/1e3;if(this.doAddBackoff(e,t,i),!r)return{topicID:t,peers:[],backoff:s};let o=this.getRandomGossipPeers(t,this.opts.prunePeers,t=>t!==e&&this.score.score(t)>=0);return{topicID:t,peers:await Promise.all(Array.from(o).map(async e=>{let t,r=this.peers.get(e)??gf(e);try{t=await this.components.peerStore.get(r)}catch(e){if("NotFoundError"!==e.name)throw e}return{peerID:r.toMultihash().bytes,signedPeerRecord:t?.peerRecordEnvelope}})),backoff:s}}runHeartbeat=()=>{let e=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch(e=>{this.log("Error running heartbeat",e)}).finally(()=>{if(null!=e&&e(),this.status.code===e8.started){clearTimeout(this.status.heartbeatTimeout);let e=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;e<.25*this.opts.heartbeatInterval&&(e+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,e)}})};async heartbeat(){let{D:e,Dlo:t,Dhi:r,Dscore:n,Dout:i,fanoutTTL:s}=this.opts;this.heartbeatTicks++;let o=new Map,a=e=>{let t=o.get(e);return void 0===t&&(t=this.score.score(e),o.set(e,t)),t},l=new Map,c=new Map,u=new Map;for(let e of(this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.idontwantCounts.clear(),this.idontwants.values()))for(let[t,r]of e)this.heartbeatTicks-r>=this.opts.mcacheLength&&e.delete(t);this.heartbeatTicks%this.opts.directConnectTicks==0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();let d=new Map;this.mesh.forEach((s,o)=>{let h=this.topics.get(o),f=new Set,p=new Set;if(d.set(o,p),null!=h){let e=F0(Array.from(h)),t=this.backoff.get(o);for(let r of e){let e=this.streamsOutbound.get(r);if(null!=e&&this.multicodecs.includes(e.protocol)&&!s.has(r)&&!this.direct.has(r)){let e=a(r);t?.has(r)!==!0&&e>=0&&f.add(r),e>=this.opts.scoreThresholds.gossipThreshold&&p.add(r)}}}let g=(e,t)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",e,o),this.addBackoff(e,o),s.delete(e),a(e)>=this.opts.scoreThresholds.gossipThreshold&&p.add(e),this.metrics?.onRemoveFromMesh(o,t,1);let r=c.get(e);null==r?c.set(e,[o]):r.push(o)},m=(e,t)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",e,o),this.score.graft(e,o),s.add(e),p.delete(e),this.metrics?.onAddToMesh(o,t,1);let r=l.get(e);null==r?l.set(e,[o]):r.push(o)};if(s.forEach(e=>{let t=a(e);t<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",e,t,o),g(e,e1.BadScore),u.set(e,!0))}),s.size<t&&FL(f,e-s.size).forEach(e=>{m(e,e0.NotEnough)}),s.size>r){let t=Array.from(s);t.sort((e,t)=>a(t)-a(e));let r=0;if((t=t.slice(0,n).concat(F0(t.slice(n)))).slice(0,e).forEach(e=>{this.outbound.get(e)&&r++}),r<i){let n=e=>{let r=t[e];for(let r=e;r>0;r--)t[r]=t[r-1];t[0]=r};if(r>0){let i=r;for(let r=1;r<e&&i>0;r++)this.outbound.get(t[r])&&(n(r),i--)}let i=e-r;for(let r=e;r<t.length&&i>0;r++)this.outbound.get(t[r])&&(n(r),i--)}t.slice(e).forEach(e=>{g(e,e1.Excess)})}if(s.size>=t){let e=0;s.forEach(t=>{this.outbound.get(t)&&e++}),e<i&&FO(f,i-e,e=>!0===this.outbound.get(e)).forEach(e=>{m(e,e0.Outbound)})}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks==0&&s.size>1){let e=Array.from(s).sort((e,t)=>a(e)-a(t)),t=a(e[Math.floor(s.size/2)]);if(t<this.opts.scoreThresholds.opportunisticGraftThreshold)for(let e of FO(f,this.opts.opportunisticGraftPeers,e=>a(e)>t))this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",e,o),m(e,e0.Opportunistic)}});let h=Date.now();this.fanoutLastpub.forEach((e,t)=>{e+s<h&&(this.fanout.delete(t),this.fanoutLastpub.delete(t))}),this.fanout.forEach((t,r)=>{let n=this.topics.get(r);t.forEach(e=>{(!n?.has(e)||a(e)<this.opts.scoreThresholds.publishThreshold)&&t.delete(e)});let i=this.topics.get(r),s=[],o=new Set;if(d.set(r,o),null!=i)for(let e of F0(Array.from(i))){let r=this.streamsOutbound.get(e);if(null!=r&&this.multicodecs.includes(r.protocol)&&!t.has(e)&&!this.direct.has(e)){let t=a(e);t>=this.opts.scoreThresholds.publishThreshold&&s.push(e),t>=this.opts.scoreThresholds.gossipThreshold&&o.add(e)}}if(t.size<e){let r=e-t.size;s.slice(0,r).forEach(e=>{t.add(e),o?.delete(e)})}}),this.emitGossip(d),await this.sendGraftPrune(l,c,u),this.flush(),this.mcache.shift(),this.dispatchEvent(new CustomEvent("gossipsub:heartbeat"))}getRandomGossipPeers(e,t,r=()=>!0){let n=this.topics.get(e);if(null==n)return new Set;let i=[];return n.forEach(e=>{let t=this.streamsOutbound.get(e);null!=t&&this.multicodecs.includes(t.protocol)&&r(e)&&i.push(e)}),i=F0(i),t>0&&i.length>t&&(i=i.slice(0,t)),new Set(i)}onScrapeMetrics(e){e.mcacheSize.set(this.mcache.size),e.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),e.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let t=0,r=Date.now();for(let n of(e.connectedPeersBackoffSec.reset(),this.backoff.values()))for(let[i,s]of(t+=n.size,n.entries()))this.peers.has(i)&&e.connectedPeersBackoffSec.observe(Math.max(0,s-r)/1e3);e.cacheSize.set({cache:"backoff"},t);let n=0;for(let e of this.idontwants.values())n+=e.size;for(let[t,r]of(e.cacheSize.set({cache:"idontwants"},n),this.topics))e.topicPeersCount.set({topicStr:t},r.size);for(let[t,r]of this.mesh)e.meshPeerCounts.set({topicStr:t},r.size);let i=[],s=new Map;for(let t of(e.behaviourPenalty.reset(),this.peers.keys())){let r=this.score.score(t);i.push(r),s.set(t,r),e.behaviourPenalty.observe(this.score.peerStats.get(t)?.behaviourPenalty??0)}e.registerScores(i,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,s);let o=Fz(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(o)}tagMeshPeer=e=>{let{peerId:t,topic:r}=e.detail;this.components.peerStore.merge(this.peers.get(t)??gf(t),{tags:{[r]:{value:100}}}).catch(e=>{this.log.error("Error tagging peer %s with topic %s",t,r,e)})};untagMeshPeer=e=>{let{peerId:t,topic:r}=e.detail;this.components.peerStore.merge(this.peers.get(t)??gf(t),{tags:{[r]:void 0}}).catch(e=>{this.log.error("Error untagging peer %s with topic %s",t,r,e)})}}function F7(e={}){return t=>new F8(t,e)}class F9{certificate;constructor(){throw Error("Auto-TLS does not work in browsers")}}function Ue(e={}){return t=>new F9(t,e)}function Ut(e,t,r,n,i){let s=[];return"0.0.0.0"!=t&&(s=[`/ip4/${t}/tcp/${r}`,`/ip4/${t}/tcp/${n}/ws`,`/ip4/${t}/tcp/${i}/tls/ws`]),{addresses:{listen:[`/ip4/0.0.0.0/tcp/${r}`,`/ip4/0.0.0.0/tcp/${n}/ws`,`/ip4/0.0.0.0/tcp/${i}/ws`],appendAnnounce:s},transports:[LT(),MI(),MV()],connectionEncrypters:[Im()],streamMuxers:[IW()],connectionGater:{denyDialMultiaddr:()=>!1},peerDiscovery:[LN({interval:1e3,topics:[`${e}.astradb._peer-discovery._p2p._pubsub`],listenOnly:!1}),Cp({list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dnsaddr/va1.bootstrap.libp2p.io/p2p/12D3KooWKnDdG3iXw9eTFijk3EWSunZcFi54Zka4wmtqtt6rPxc8","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]})],services:{pubsub:F7({allowPublishToZeroTopicPeers:!0}),autoNAT:TH(),dcutr:C1(),delegatedRouting:()=>TS("https://delegated-ipfs.dev",Tk()),dht:Ds({protocol:"/ipfs/kad/1.0.0",peerInfoMapper:Pz,clientMode:!0,validators:{ipns:Th},selectors:{ipns:MG}}),identify:Pa(),identifyPush:Pl(),ping:Nr(),upnp:LP(),keychain:DD(),autoTLS:Ue()}}}function Ur(e){return{transports:[MV()],connectionEncrypters:[Im()],streamMuxers:[IW()],connectionGater:{denyDialMultiaddr:()=>!1},peerDiscovery:[LN({interval:1e3,topics:[`${e}.astradb._peer-discovery._p2p._pubsub`],listenOnly:!1}),Cp({list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dnsaddr/va1.bootstrap.libp2p.io/p2p/12D3KooWKnDdG3iXw9eTFijk3EWSunZcFi54Zka4wmtqtt6rPxc8","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]})],services:{pubsub:F7({allowPublishToZeroTopicPeers:!0}),autoNAT:TH(),dcutr:C1(),delegatedRouting:()=>TS("https://delegated-ipfs.dev",Tk()),dht:Ds({protocol:"/ipfs/kad/1.0.0",peerInfoMapper:Pz,clientMode:!0,validators:{ipns:Th},selectors:{ipns:MG}}),identify:Pa(),identifyPush:Pl(),ping:Nr()}}}let Un="user-id",Ui=async(e,t,r,n,i,s,o,a,l)=>{let c,u="undefined"!=typeof window;u?console.log("Browser enviroment detected"):console.log("Node enviroment detected");let d=await Ac(r);c=u?Ur(e):Ut(e,i,s,o,a);let h=await kU({datastore:r,privateKey:d,...c});h.addEventListener("certificate:provision",()=>{console.info("A TLS certificate was provisioned")});let f=await MY({datastore:r,blockstore:n,libp2p:h});console.log(`Node started with id: ${f.libp2p.peerId.toString()}`);let p=await Ua(t,f,l),g=await L_({ipfs:f,directory:l,identities:p,id:Un});for(let e of(console.log("Peer multiaddrs:"),g.ipfs.libp2p.getMultiaddrs()))console.log(`${e}`);let m=[];return g.ipfs.libp2p.addEventListener("self:peer:update",e=>{let t=g.ipfs.libp2p.getMultiaddrs();if(JSON.stringify(m)!==JSON.stringify(t)){for(let e of(console.log("Peer multiaddrs changed:"),t))console.log(`${e}`);m=t}}),g};async function Us(e){let t=e.keystore,r=(await t.getKey(Un)).raw;return(0,uC.d)(r,"base32")}function Uo(e){return e.identity.publicKey}async function Ua(e,t,r){let n=await OY({path:`${r}/keystore`});if(e){console.log("Login key provided, using existing identity");let t=p8((0,rx.s)(e,"base32"));await n.addKey(Un,{privateKey:t.raw})}else console.log("No login key provided, creating new identity"),await n.createKey(Un);return await Ln({ipfs:t,keystore:n})}class Ul extends Error{constructor(e){super(e),this.name="SyncTimeoutError"}}class Uc{dbName;orbitdb;openDb;entriesSeen;events;onUpdate;constructor(e,t,r,n){this.dbName=e,this.orbitdb=t,this.entriesSeen=new Set,this.events=r,this.onUpdate=n}async initNew(){await this.createDatabase(),await this.setupDbEvents(),await this.updateDatabase()}async initExisting(){await this.createDatabase();let e=await this.syncDb();return await this.setupDbEvents(),await this.updateDatabase(),e}async add(e){let t=await this.openDb.add(e);await this.newEntryAdded(t,e)}async getAll(){return(await this.openDb.all()).map(e=>e.value)}async createDatabase(){let e=await Ow(await OI({size:1e3}),await OE({ipfs:this.orbitdb.ipfs,pin:!0})),t=await this.orbitdb.open(this.dbName,{AccessController:Ly({write:["*"],storage:e})});this.openDb=t}async syncDb(){let e=!1,t=async(t,r)=>{console.log(`Database ${this.openDb.address} synced with peer ${t}`),e=!0};this.openDb.events.on("join",t);try{await this.waitFor(async()=>e,async()=>!0)}catch(e){if(e instanceof Ul)return console.log("Warning: Timeout received. Database was not synced with any provider. Asuming it is a new database with no providers."),!1;throw e}return!0}async waitFor(e,t,r=100,n=2e4){return new Promise((i,s)=>{let o=0,a=setInterval(async()=>{await e()===await t()&&(clearInterval(a),i()),(o+=r)>=n&&(clearInterval(a),s(new Ul("Timeout waiting for condition")))},r)})}async setupDbEvents(){this.openDb.events.on("update",async e=>{await this.updateDatabase()}),this.openDb.events.on("join",async(e,t)=>{console.log(`${e} joined the database ${this.dbName}`)})}async updateDatabase(){for await(let e of this.openDb.iterator()){let t=e.hash;this.entriesSeen.has(t)||await this.newEntryAdded(t,e.value)}}async newEntryAdded(e,t){this.entriesSeen.add(e),this.onUpdate&&this.onUpdate(t),this.events.emit(`${this.dbName}`,t),console.log(`New entry added to the database ${this.dbName}`)}}let Uu=Error("timeout while waiting for mutex to become available"),Ud=(Error("mutex already locked"),Error("request for lock canceled"));var Uh=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Uf{constructor(e,t=Ud){this._value=e,this._cancelError=t,this._queue=[],this._weightedWaiters=[]}acquire(e=1,t=0){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);return new Promise((r,n)=>{let i={resolve:r,reject:n,weight:e,priority:t},s=Ug(this._queue,e=>t<=e.priority);-1===s&&e<=this._value?this._dispatchItem(i):this._queue.splice(s+1,0,i)})}runExclusive(e){return Uh(this,arguments,void 0,function*(e,t=1,r=0){let[n,i]=yield this.acquire(t,r);try{return yield e(n)}finally{i()}})}waitForUnlock(e=1,t=0){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,t)?Promise.resolve():new Promise(r=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),Up(this._weightedWaiters[e-1],{resolve:r,priority:t})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){let t=this._value;this._value-=e.weight,e.resolve([t,this._newReleaser(e.weight)])}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){if(0===this._queue.length)for(let e=this._value;e>0;e--){let t=this._weightedWaiters[e-1];t&&(t.forEach(e=>e.resolve()),this._weightedWaiters[e-1]=[])}else{let e=this._queue[0].priority;for(let t=this._value;t>0;t--){let r=this._weightedWaiters[t-1];if(!r)continue;let n=r.findIndex(t=>t.priority<=e);(-1===n?r:r.splice(0,n)).forEach(e=>e.resolve())}}}_couldLockImmediately(e,t){return(0===this._queue.length||this._queue[0].priority<t)&&e<=this._value}}function Up(e,t){let r=Ug(e,e=>t.priority<=e.priority);e.splice(r+1,0,t)}function Ug(e,t){for(let r=e.length-1;r>=0;r--)if(t(e[r]))return r;return -1}var Um=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Uy{constructor(e){this._semaphore=new Uf(1,e)}acquire(){return Um(this,arguments,void 0,function*(e=0){let[,t]=yield this._semaphore.acquire(1,e);return t})}runExclusive(e,t=0){return this._semaphore.runExclusive(()=>e(),1,t)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(e=0){return this._semaphore.waitForUnlock(1,e)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}var Ub=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function Uw(e){return void 0!==e.getValue}class Uv{dbName;orbitdb;isCollaborator;keyDb;keys;keyDbs;events;mutex;constructor(e,t,r,n){this.dbName=e,this.orbitdb=t,this.isCollaborator=r,this.keys=new Set,this.keyDbs=new Map,this.events=n,this.mutex=new Uy}async init(e){if(this.keyDb=new Uc(this.dbName,this.orbitdb,this.events,this.newKeyAdded.bind(this)),this.isCollaborator||e)await this.keyDb.initNew();else if(!await this.keyDb.initExisting())throw Error("No providers found for the key repository database")}async add(e,t){await this.mutex.runExclusive(async()=>{this.keys.has(e)||(this.keys.add(e),await this.keyDb.add(e),console.log(`Key ${e} added to the key repository`));let r=await this.getValueDb(e,!1);await r.openDb.add(t),console.log(`New value appended to the key ${e}`)})}async get(e){return await this.mutex.runExclusive(async()=>{if(!this.keys.has(e))throw Error(`Key ${e} does not exist`);let t=await this.getValueDb(e,!0);return await t.getAll()})}async getAllKeys(){return await this.mutex.runExclusive(async()=>Array.from(this.keys))}async newKeyAdded(e){await this.mutex.runExclusive(async()=>{if(this.keys.add(e),this.isCollaborator){let t=new Uc(`${this.dbName}::${e}`,this.orbitdb,this.events);await t.initNew(),this.keyDbs.set(e,t),console.log(`Key ${e} replicated`)}})}async getValueDb(e,t){let r;return this.keyDbs.has(e)?r=this.keyDbs.get(e):(r=new Uc(`${this.dbName}::${e}`,this.orbitdb,this.events),t?await r.initExisting():await r.initNew(),this.keyDbs.set(e,r)),r}}class UE{dbName;orbitdb;connectionManager;keyRepository;events;constructor(e){this.dbName=e,this.events=new M0}async init(e){let t=`${e.dataDir}/astradb`;this.orbitdb=await Ui(this.dbName,e.loginKey,e.datastore,e.blockstore,e.publicIp,e.TcpPort,e.WSPort,e.WSSPort,t),e.offlineMode?console.log("Offline mode enabled"):(this.connectionManager=new cd(this.dbName,this.orbitdb.ipfs),await this.connectionManager.init(e.isCollaborator)),this.keyRepository=new Uv(this.dbName,this.orbitdb,e.isCollaborator,this.events),await this.keyRepository.init(e.offlineMode)}async add(e,t){await this.keyRepository.add(e,t)}async get(e){return await this.keyRepository.get(e)}async getAllKeys(){return await this.keyRepository.getAllKeys()}getLoginPublicKey(){return Uo(this.orbitdb)}async getLoginPrivateKey(){return await Us(this.orbitdb)}}async function UA(e={}){if(!e.dbName)throw Error("dbName is required");if(e.isCollaborator&&(!e.datastore||!e.blockstore))throw Error("A collaborator node must use a persistent datastore and blockstore.");e.isCollaborator=e.isCollaborator??!1,e.loginKey=e.loginKey??"",e.datastore=e.datastore??new bL.bk,e.blockstore=e.blockstore??new bO.ED,e.publicIp=e.publicIp??"0.0.0.0",e.TcpPort=e.TcpPort??40001,e.WSPort=e.WSPort??40002,e.WSSPort=e.WSSPort??40003,e.dataDir=e.dataDir??"./data",e.offlineMode=e.offlineMode??!1;let t=new UE(e.dbName);return await t.init(e),t}},68250:(e,t,r)=>{"use strict";r.d(t,{fD:()=>h.f,bk:()=>f.b});var n=r(86620);let i="/repo/flatfs/shard/",s="SHARDING";class o{param;name;_padding;constructor(e){this.param=e,this.name="base",this._padding=""}fun(e){return"implement me"}toString(){return`${i}v1/${this.name}/${this.param}`}}class a extends o{constructor(e){super(e),this._padding="".padStart(e,"_"),this.name="prefix"}fun(e){return(e+this._padding).slice(0,this.param)}}class l extends o{constructor(e){super(e),this._padding="".padStart(e,"_"),this.name="suffix"}fun(e){let t=this._padding+e;return t.slice(t.length-this.param)}}class c extends o{constructor(e){super(e),this._padding="".padStart(e+1,"_"),this.name="next-to-last"}fun(e){let t=this._padding+e,r=t.length-this.param-1;return t.slice(r,r+this.param)}}function u(e){if(0===(e=e.trim()).length)throw Error("empty shard string");if(!e.startsWith(i))throw Error(`invalid or no path prefix: ${e}`);let t=e.slice(i.length).split("/"),r=t[0];if("v1"!==r)throw Error(`expect 'v1' version, got '${r}'`);let n=t[1];if(null==t[2]||""===t[2])throw Error("missing param");let s=parseInt(t[2],10);switch(n){case"prefix":return new a(s);case"suffix":return new l(s);case"next-to-last":return new c(s);default:throw Error(`unkown sharding function: ${n}`)}}let d=async(e,t)=>{let r=new n.U(e).child(new n.U(s)),i="function"==typeof t.getRaw?t.getRaw.bind(t):t.get.bind(t),o=await i(r);return u(new TextDecoder().decode(o??"").trim())};var h=r(54954),f=r(3972),p=r(7786),g=r(45346);class m extends h.f{child;transform;constructor(e,t){super(),this.child=e,this.transform=t}async put(e,t,r){return await this.child.put(this.transform.convert(e),t,r),e}async get(e,t){return this.child.get(this.transform.convert(e),t)}async has(e,t){return this.child.has(this.transform.convert(e),t)}async delete(e,t){await this.child.delete(this.transform.convert(e),t)}async *putMany(e,t={}){let r=this.transform,n=this.child;yield*(0,g.F)(e,async function*(e){yield*(0,p.A)(e,({key:e,value:t})=>({key:r.convert(e),value:t}))},async function*(e){yield*n.putMany(e,t)},async function*(e){yield*(0,p.A)(e,e=>r.invert(e))})}async *getMany(e,t={}){let r=this.transform,n=this.child;yield*(0,g.F)(e,async function*(e){yield*(0,p.A)(e,e=>r.convert(e))},async function*(e){yield*n.getMany(e,t)},async function*(e){yield*(0,p.A)(e,({key:e,value:t})=>({key:r.invert(e),value:t}))})}async *deleteMany(e,t={}){let r=this.transform,n=this.child;yield*(0,g.F)(e,async function*(e){yield*(0,p.A)(e,e=>r.convert(e))},async function*(e){yield*n.deleteMany(e,t)},async function*(e){yield*(0,p.A)(e,e=>r.invert(e))})}batch(){let e=this.child.batch();return{put:(t,r)=>{e.put(this.transform.convert(t),r)},delete:t=>{e.delete(this.transform.convert(t))},commit:async t=>{await e.commit(t)}}}query(e,t){let r={...e};r.filters=(r.filters??[]).map(e=>({key:t,value:r})=>e({key:this.transform.convert(t),value:r}));let{prefix:n}=e;return null!=n&&"/"!==n&&(delete r.prefix,r.filters.push(({key:e})=>this.transform.invert(e).toString().startsWith(n))),null!=r.orders&&(r.orders=r.orders.map(e=>(t,r)=>e({key:this.transform.invert(t.key),value:t.value},{key:this.transform.invert(r.key),value:r.value}))),(0,p.A)(this.child.query(r,t),({key:e,value:t})=>({key:this.transform.invert(e),value:t}))}queryKeys(e,t){let r={...e};r.filters=(r.filters??[]).map(e=>t=>e(this.transform.convert(t)));let{prefix:n}=e;return null!=n&&"/"!==n&&(delete r.prefix,r.filters.push(e=>this.transform.invert(e).toString().startsWith(n))),null!=r.orders&&(r.orders=r.orders.map(e=>(t,r)=>e(this.transform.invert(t),this.transform.invert(r)))),(0,p.A)(this.child.queryKeys(r,t),e=>this.transform.invert(e))}}var y=r(31987),b=r(98897);let w=new y.U(s);class v extends h.f{child;shard;constructor(e,t){super(),this.child=new m(e,{convert:this._convertKey.bind(this),invert:this._invertKey.bind(this)}),this.shard=t}async open(){this.shard=await v.create(this.child,this.shard)}_convertKey(e){let t=e.toString();return t===w.toString()?e:new y.U(this.shard.fun(t)).child(e)}_invertKey(e){return e.toString()===w.toString()?e:y.U.withNamespaces(e.list().slice(1))}static async create(e,t){if(!await e.has(w)){if(null==t)throw new b.c0("Shard is required when datastore doesn't have a shard key already");await e.put(w,new TextEncoder().encode(t.toString()+"\n"))}null==t&&(t=await d("/",e));let r=await d("/",e),n=r.toString(),i=t.toString();if(n!==i)throw Error(`specified fun ${i} does not match repo shard fun ${n}`);return r}async put(e,t,r){return await this.child.put(e,t,r),e}async get(e,t){return this.child.get(e,t)}async has(e,t){return this.child.has(e,t)}async delete(e,t){await this.child.delete(e,t)}async *putMany(e,t={}){yield*this.child.putMany(e,t)}async *getMany(e,t={}){yield*this.child.getMany(e,t)}async *deleteMany(e,t={}){yield*this.child.deleteMany(e,t)}batch(){return this.child.batch()}query(e,t){let r=({key:e})=>e.toString()!==w.toString(),n={...e,filters:[r].concat(e.filters??[])};return this.child.query(n,t)}queryKeys(e,t){let r=e=>e.toString()!==w.toString(),n={...e,filters:[r].concat(e.filters??[])};return this.child.queryKeys(n,t)}}r(76520),r(62897),r(76154),r(91295),h.f;var E=r(3204);r(24802),r(62954),(0,E.vF)("datastore:core:tiered"),h.f},68852:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t||"[object Symbol]"!==Object.prototype.toString.call(t)||"[object Symbol]"!==Object.prototype.toString.call(r))return!1;var n=42;for(var i in e[t]=n,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var s=Object.getOwnPropertySymbols(e);if(1!==s.length||s[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(o.value!==n||!0!==o.enumerable)return!1}return!0}},69503:(e,t,r)=>{"use strict";let n=r(7800),i=new Set(["buffer","view","utf8"]);class s{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,"function"!=typeof this.encode)throw TypeError("The 'encode' property must be a function");if("function"!=typeof this.decode)throw TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),"string"!=typeof this.name||""===this.name)throw TypeError("The 'name' property must be a string");if("string"!=typeof this.format||!i.has(this.format))throw TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new n(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new n(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new n(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}}t.Encoding=s},69600:(e,t,r)=>{"use strict";r.d(t,{Fo:()=>P,br:()=>C.br});var n={};r.r(n),r.d(n,{base10:()=>u});var i={};r.r(i),r.d(i,{base16:()=>d,base16upper:()=>h});var s={};r.r(s),r.d(s,{base2:()=>f});var o={};r.r(o),r.d(o,{base256emoji:()=>w});var a={};r.r(a),r.d(a,{base8:()=>S});var l={};r.r(l),r.d(l,{identity:()=>_});var c=r(52215);let u=(0,c._Q)({prefix:"9",name:"base10",alphabet:"0123456789"}),d=(0,c.yE)({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),h=(0,c.yE)({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),f=(0,c.yE)({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),p=Array.from("\uD83D\uDE80\uD83E\uDE90\uD83D\uDEF0\uD83C\uDF0C\uD83C\uDF11\uD83C\uDF12\uD83C\uDF13\uD83C\uDF14\uD83C\uDF15\uD83C\uDF16\uD83C\uDF17\uD83C\uDF18\uD83C\uDF0D\uD83C\uDF0F\uD83C\uDF0E\uD83D\uDC09\uD83D\uDCBB\uD83D\uDDA5\uD83D\uDCBE\uD83D\uDCBF\uD83D\uDE02\uD83D\uDE0D\uD83E\uDD23\uD83D\uDE0A\uD83D\uDE4F\uD83D\uDC95\uD83D\uDE2D\uD83D\uDE18\uD83D\uDC4D\uD83D\uDE05\uD83D\uDC4F\uD83D\uDE01\uD83D\uDD25\uD83E\uDD70\uD83D\uDC94\uD83D\uDC96\uD83D\uDC99\uD83D\uDE22\uD83E\uDD14\uD83D\uDE06\uD83D\uDE44\uD83D\uDCAA\uD83D\uDE09\uD83D\uDC4C\uD83E\uDD17\uD83D\uDC9C\uD83D\uDE14\uD83D\uDE0E\uD83D\uDE07\uD83C\uDF39\uD83E\uDD26\uD83C\uDF89\uD83D\uDC9E\uD83E\uDD37\uD83D\uDE31\uD83D\uDE0C\uD83C\uDF38\uD83D\uDE4C\uD83D\uDE0B\uD83D\uDC97\uD83D\uDC9A\uD83D\uDE0F\uD83D\uDC9B\uD83D\uDE42\uD83D\uDC93\uD83E\uDD29\uD83D\uDE04\uD83D\uDE00\uD83D\uDDA4\uD83D\uDE03\uD83D\uDCAF\uD83D\uDE48\uD83D\uDC47\uD83C\uDFB6\uD83D\uDE12\uD83E\uDD2D\uD83D\uDE1C\uD83D\uDC8B\uD83D\uDC40\uD83D\uDE2A\uD83D\uDE11\uD83D\uDCA5\uD83D\uDE4B\uD83D\uDE1E\uD83D\uDE29\uD83D\uDE21\uD83E\uDD2A\uD83D\uDC4A\uD83E\uDD73\uD83D\uDE25\uD83E\uDD24\uD83D\uDC49\uD83D\uDC83\uD83D\uDE33\uD83D\uDE1A\uD83D\uDE1D\uD83D\uDE34\uD83C\uDF1F\uD83D\uDE2C\uD83D\uDE43\uD83C\uDF40\uD83C\uDF37\uD83D\uDE3B\uD83D\uDE13\uD83E\uDD7A\uD83C\uDF08\uD83D\uDE08\uD83E\uDD18\uD83D\uDCA6\uD83D\uDE23\uD83C\uDFC3\uD83D\uDC90\uD83C\uDF8A\uD83D\uDC98\uD83D\uDE20\uD83D\uDE15\uD83C\uDF3A\uD83C\uDF82\uD83C\uDF3B\uD83D\uDE10\uD83D\uDD95\uD83D\uDC9D\uD83D\uDE4A\uD83D\uDE39\uD83D\uDDE3\uD83D\uDCAB\uD83D\uDC80\uD83D\uDC51\uD83C\uDFB5\uD83E\uDD1E\uD83D\uDE1B\uD83D\uDD34\uD83D\uDE24\uD83C\uDF3C\uD83D\uDE2B\uD83E\uDD19\uD83C\uDFC6\uD83E\uDD2B\uD83D\uDC48\uD83D\uDE2E\uD83D\uDE46\uD83C\uDF7B\uD83C\uDF43\uD83D\uDC36\uD83D\uDC81\uD83D\uDE32\uD83C\uDF3F\uD83E\uDDE1\uD83C\uDF81\uD83C\uDF1E\uD83C\uDF88\uD83D\uDC4B\uD83D\uDE30\uD83E\uDD28\uD83D\uDE36\uD83E\uDD1D\uD83D\uDEB6\uD83D\uDCB0\uD83C\uDF53\uD83D\uDCA2\uD83E\uDD1F\uD83D\uDE41\uD83D\uDEA8\uD83D\uDCA8\uD83E\uDD2C\uD83C\uDF80\uD83C\uDF7A\uD83E\uDD13\uD83D\uDE19\uD83D\uDC9F\uD83C\uDF31\uD83D\uDE16\uD83D\uDC76\uD83E\uDD74\uD83D\uDC8E\uD83D\uDCB8\uD83D\uDE28\uD83C\uDF1A\uD83E\uDD8B\uD83D\uDE37\uD83D\uDD7A\uD83D\uDE45\uD83D\uDE1F\uD83D\uDE35\uD83D\uDC4E\uD83E\uDD32\uD83E\uDD20\uD83E\uDD27\uD83D\uDCCC\uD83D\uDD35\uD83D\uDC85\uD83E\uDDD0\uD83D\uDC3E\uD83C\uDF52\uD83D\uDE17\uD83E\uDD11\uD83C\uDF0A\uD83E\uDD2F\uD83D\uDC37\uD83D\uDCA7\uD83D\uDE2F\uD83D\uDC86\uD83D\uDC46\uD83C\uDFA4\uD83D\uDE47\uD83C\uDF51\uD83C\uDF34\uD83D\uDCA3\uD83D\uDC38\uD83D\uDC8C\uD83D\uDCCD\uD83E\uDD40\uD83E\uDD22\uD83D\uDC45\uD83D\uDCA1\uD83D\uDCA9\uD83D\uDC50\uD83D\uDCF8\uD83D\uDC7B\uD83E\uDD10\uD83E\uDD2E\uD83C\uDFBC\uD83E\uDD75\uD83D\uDEA9\uD83C\uDF4E\uD83C\uDF4A\uD83D\uDC7C\uD83D\uDC8D\uD83D\uDCE3\uD83E\uDD42"),g=p.reduce((e,t,r)=>(e[r]=t,e),[]),m=p.reduce((e,t,r)=>{let n=t.codePointAt(0);if(null==n)throw Error(`Invalid character: ${t}`);return e[n]=r,e},[]);function y(e){return e.reduce((e,t)=>e+=g[t],"")}function b(e){let t=[];for(let r of e){let e=r.codePointAt(0);if(null==e)throw Error(`Invalid character: ${r}`);let n=m[e];if(null==n)throw Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}let w=(0,c.HT)({prefix:"\uD83D\uDE80",name:"base256emoji",encode:y,decode:b});var v=r(43716),E=r(41472),A=r(7796),x=r(53647);let S=(0,c.yE)({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var k=r(70834);let _=(0,c.HT)({prefix:"\0",name:"identity",encode:e=>(0,k.toString)(e),decode:e=>(0,k.fromString)(e)});r(47951),r(34269);var I=r(30946),T=r(97141),C=r(16121);let P={...l,...s,...a,...n,...i,...v,...E,...A,...x,...o};({...T,...I})},69685:(e,t,r)=>{"use strict";r.d(t,{TO:()=>h});var n=r(43716),i=r(41472),s=r(7796),o=r(70834),a=r(87704),l=r(41394);function c(e,t){let{bytes:r,version:i}=e;return 0===i?p(r,d(e),t??s.base58btc.encoder):g(r,d(e),t??n.base32.encoder)}let u=new WeakMap;function d(e){let t=u.get(e);if(null==t){let t=new Map;return u.set(e,t),t}return t}class h{code;version;multihash;bytes;"/";constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==m)throw Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==y)throw Error("Cannot convert non sha2-256 multihash CID to CIDv0");return h.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,r=a.create(e,t);return h.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return h.equals(this,e)}static equals(e,t){let r=t;return null!=r&&e.code===r.code&&e.version===r.version&&a.equals(e.multihash,r.multihash)}toString(e){return c(this,e)}toJSON(){return{"/":c(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;let t=e;if(t instanceof h)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){let{version:e,code:r,multihash:n,bytes:i}=t;return new h(e,r,n,i??b(e,r,n.bytes))}if(!0!==t[w])return null;{let{version:e,multihash:r,code:n}=t,i=a.decode(r);return h.create(e,n,i)}}static create(e,t,r){if("number"!=typeof t)throw Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw Error("Invalid digest");switch(e){case 0:if(t===m)return new h(e,t,r,r.bytes);throw Error(`Version 0 CID must use dag-pb (code: ${m}) block encoding`);case 1:{let n=b(e,t,r.bytes);return new h(e,t,r,n)}default:throw Error("Invalid version")}}static createV0(e){return h.create(0,m,e)}static createV1(e,t){return h.create(1,e,t)}static decode(e){let[t,r]=h.decodeFirst(e);if(0!==r.length)throw Error("Incorrect length");return t}static decodeFirst(e){let t=h.inspectBytes(e),r=t.size-t.multihashSize,n=(0,o.coerce)(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw Error("Incorrect length");let i=n.subarray(t.multihashSize-t.digestSize),s=new a.Digest(t.multihashCode,t.digestSize,i,n);return[0===t.version?h.createV0(s):h.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0,r=()=>{let[r,n]=l.D4(e.subarray(t));return t+=n,r},n=r(),i=m;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw RangeError(`Invalid CID version ${n}`);let s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){let[r,n]=f(e,t),i=h.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return d(i).set(r,e),i}}function f(e,t){switch(e[0]){case"Q":{let r=t??s.base58btc;return[s.base58btc.prefix,r.decode(`${s.base58btc.prefix}${e}`)]}case s.base58btc.prefix:{let r=t??s.base58btc;return[s.base58btc.prefix,r.decode(e)]}case n.base32.prefix:{let r=t??n.base32;return[n.base32.prefix,r.decode(e)]}case i.base36.prefix:{let r=t??i.base36;return[i.base36.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}function p(e,t,r){let{prefix:n}=r;if(n!==s.base58btc.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let i=t.get(n);if(null!=i)return i;{let i=r.encode(e).slice(1);return t.set(n,i),i}}function g(e,t,r){let{prefix:n}=r,i=t.get(n);if(null!=i)return i;{let i=r.encode(e);return t.set(n,i),i}}let m=112,y=18;function b(e,t,r){let n=l.OY(e),i=n+l.OY(t),s=new Uint8Array(i+r.byteLength);return l.s_(e,s,0),l.s_(t,s,n),s.set(r,i),s}let w=Symbol.for("@ipld/js-cid/CID")},69811:(e,t,r)=>{"use strict";let n=r(7800),i=Object.prototype.hasOwnProperty,s=new Set(["lt","lte","gt","gte"]);e.exports=function(e,t){let r={};for(let o in e)if(i.call(e,o)&&"keyEncoding"!==o&&"valueEncoding"!==o){if("start"===o||"end"===o)throw new n(`The legacy range option '${o}' has been removed`,{code:"LEVEL_LEGACY"});if("encoding"===o)throw new n("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});s.has(o)?r[o]=t.encode(e[o]):r[o]=e[o]}return r.reverse=!!r.reverse,r.limit=Number.isInteger(r.limit)&&r.limit>=0?r.limit:-1,r}},70508:(e,t,r)=>{"use strict";var n,i=r(2821),s=r(2902),o=r(12764),a=r(31467),l=r(24747),c=r(61925),u=r(63674),d=r(97968),h=r(82083),f=r(5729),p=r(51517),g=r(54251),m=r(34817),y=r(83623),b=r(87700),w=Function,v=function(e){try{return w('"use strict"; return ('+e+").constructor;")()}catch(e){}},E=r(81954),A=r(62030),x=function(){throw new u},S=E?function(){try{return arguments.callee,x}catch(e){try{return E(arguments,"callee").get}catch(e){return x}}}():x,k=r(56406)(),_=r(21589),I=r(71033),T=r(45329),C=r(61043),P=r(60261),R={},D="undefined"!=typeof Uint8Array&&_?_(Uint8Array):n,N={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":k&&_?_([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":R,"%AsyncGenerator%":R,"%AsyncGeneratorFunction%":R,"%AsyncIteratorPrototype%":R,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":s,"%eval%":eval,"%EvalError%":o,"%Float16Array%":"undefined"==typeof Float16Array?n:Float16Array,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":w,"%GeneratorFunction%":R,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":k&&_?_(_([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&k&&_?_(new Map()[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":i,"%Object.getOwnPropertyDescriptor%":E,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":a,"%ReferenceError%":l,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&k&&_?_(new Set()[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":k&&_?_(""[Symbol.iterator]()):n,"%Symbol%":k?Symbol:n,"%SyntaxError%":c,"%ThrowTypeError%":S,"%TypedArray%":D,"%TypeError%":u,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":d,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet,"%Function.prototype.call%":P,"%Function.prototype.apply%":C,"%Object.defineProperty%":A,"%Object.getPrototypeOf%":I,"%Math.abs%":h,"%Math.floor%":f,"%Math.max%":p,"%Math.min%":g,"%Math.pow%":m,"%Math.round%":y,"%Math.sign%":b,"%Reflect.getPrototypeOf%":T};if(_)try{null.error}catch(e){var M=_(_(e));N["%Error.prototype%"]=M}var B=function e(t){var r;if("%AsyncFunction%"===t)r=v("async function () {}");else if("%GeneratorFunction%"===t)r=v("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=v("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&_&&(r=_(i.prototype))}return N[t]=r,r},O={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},L=r(52430),F=r(41444),U=L.call(P,Array.prototype.concat),j=L.call(C,Array.prototype.splice),H=L.call(P,String.prototype.replace),$=L.call(P,String.prototype.slice),q=L.call(P,RegExp.prototype.exec),z=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,V=/\\(\\)?/g,G=function(e){var t=$(e,0,1),r=$(e,-1);if("%"===t&&"%"!==r)throw new c("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new c("invalid intrinsic syntax, expected opening `%`");var n=[];return H(e,z,function(e,t,r,i){n[n.length]=r?H(i,V,"$1"):t||e}),n},K=function(e,t){var r,n=e;if(F(O,n)&&(n="%"+(r=O[n])[0]+"%"),F(N,n)){var i=N[n];if(i===R&&(i=B(n)),void 0===i&&!t)throw new u("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:i}}throw new c("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new u("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new u('"allowMissing" argument must be a boolean');if(null===q(/^%?[^%]*%?$/,e))throw new c("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=G(e),n=r.length>0?r[0]:"",i=K("%"+n+"%",t),s=i.name,o=i.value,a=!1,l=i.alias;l&&(n=l[0],j(r,U([0,1],l)));for(var d=1,h=!0;d<r.length;d+=1){var f=r[d],p=$(f,0,1),g=$(f,-1);if(('"'===p||"'"===p||"`"===p||'"'===g||"'"===g||"`"===g)&&p!==g)throw new c("property names with quotes must have matching quotes");if("constructor"!==f&&h||(a=!0),n+="."+f,F(N,s="%"+n+"%"))o=N[s];else if(null!=o){if(!(f in o)){if(!t)throw new u("base intrinsic for "+e+" exists, but the property is not available.");return}if(E&&d+1>=r.length){var m=E(o,f);o=(h=!!m)&&"get"in m&&!("originalValue"in m.get)?m.get:o[f]}else h=F(o,f),o=o[f];h&&!a&&(N[s]=o)}}return o}},70834:(e,t,r)=>{"use strict";r.r(t),r.d(t,{coerce:()=>a,empty:()=>n,equals:()=>o,fromHex:()=>s,fromString:()=>c,isBinary:()=>l,toHex:()=>i,toString:()=>u});let n=new Uint8Array(0);function i(e){return e.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),"")}function s(e){let t=e.match(/../g);return null!=t?new Uint8Array(t.map(e=>parseInt(e,16))):n}function o(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function a(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw Error("Unknown type, must be binary type")}function l(e){return e instanceof ArrayBuffer||ArrayBuffer.isView(e)}function c(e){return new TextEncoder().encode(e)}function u(e){return new TextDecoder().decode(e)}},71033:(e,t,r)=>{"use strict";e.exports=r(2821).getPrototypeOf||null},71094:(e,t,r)=>{"use strict";let{supports:n}=r(38541),{Transcoder:i}=r(12338),{EventEmitter:s}=r(40662),{fromCallback:o}=r(82813),a=r(7800),{AbstractIterator:l}=r(39070),{DefaultKeyIterator:c,DefaultValueIterator:u}=r(63547),{DeferredIterator:d,DeferredKeyIterator:h,DeferredValueIterator:f}=r(92425),{DefaultChainedBatch:p}=r(95948),{getCallback:g,getOptions:m}=r(33534),y=r(69811),b=Symbol("promise"),w=Symbol("landed"),v=Symbol("resources"),E=Symbol("closeResources"),A=Symbol("operations"),x=Symbol("undefer"),S=Symbol("deferOpen"),k=Symbol("options"),_=Symbol("status"),I=Symbol("defaultOptions"),T=Symbol("transcoder"),C=Symbol("keyEncoding"),P=Symbol("valueEncoding"),R=()=>{};class D extends s{constructor(e,t){if(super(),"object"!=typeof e||null===e)throw TypeError("The first argument 'manifest' must be an object");let{keyEncoding:r,valueEncoding:s,passive:o,...a}=t=m(t);for(let t of(this[v]=new Set,this[A]=[],this[S]=!0,this[k]=a,this[_]="opening",this.supports=n(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:!1!==e.snapshots,permanence:!1!==e.permanence,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[T]=new i(B(this)),this[C]=this[T].encoding(r||"utf8"),this[P]=this[T].encoding(s||"utf8"),this[T].encodings()))this.supports.encodings[t.commonName]||(this.supports.encodings[t.commonName]=!0);this[I]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[C].commonName,valueEncoding:this[P].commonName}),key:Object.freeze({keyEncoding:this[C].commonName})},this.nextTick(()=>{this[S]&&this.open({passive:!1},R)})}get status(){return this[_]}keyEncoding(e){return this[T].encoding(null!=e?e:this[C])}valueEncoding(e){return this[T].encoding(null!=e?e:this[P])}open(e,t){t=o(t=g(e,t),b),(e={...this[k],...m(e)}).createIfMissing=!1!==e.createIfMissing,e.errorIfExists=!!e.errorIfExists;let r=e=>{"closing"===this[_]||"opening"===this[_]?this.once(w,e?()=>r(e):r):"open"!==this[_]?t(new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:e})):t()};return e.passive?"opening"===this[_]?this.once(w,r):this.nextTick(r):"closed"===this[_]||this[S]?(this[S]=!1,this[_]="opening",this.emit("opening"),this._open(e,e=>{if(e){this[_]="closed",this[E](()=>{this.emit(w),r(e)}),this[x]();return}this[_]="open",this[x](),this.emit(w),"open"===this[_]&&this.emit("open"),"open"===this[_]&&this.emit("ready"),r()})):"open"===this[_]?this.nextTick(r):this.once(w,()=>this.open(e,t)),t[b]}_open(e,t){this.nextTick(t)}close(e){e=o(e,b);let t=r=>{"opening"===this[_]||"closing"===this[_]?this.once(w,r?t(r):t):"closed"!==this[_]?e(new a("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:r})):e()};if("open"===this[_]){this[_]="closing",this.emit("closing");let e=e=>{this[_]="open",this[x](),this.emit(w),t(e)};this[E](()=>{this._close(r=>{if(r)return e(r);this[_]="closed",this[x](),this.emit(w),"closed"===this[_]&&this.emit("closed"),t()})})}else"closed"===this[_]?this.nextTick(t):this.once(w,()=>this.close(e));return e[b]}[E](e){if(0===this[v].size)return this.nextTick(e);let t=this[v].size,r=!0,n=()=>{0==--t&&(r?this.nextTick(e):e())};for(let e of this[v])e.close(n);r=!1,this[v].clear()}_close(e){this.nextTick(e)}get(e,t,r){if(r=o(r=g(t,r),b),t=m(t,this[I].entry),"opening"===this[_])return this.defer(()=>this.get(e,t,r)),r[b];if(M(this,r))return r[b];let n=this._checkKey(e);if(n)return this.nextTick(r,n),r[b];let i=this.keyEncoding(t.keyEncoding),s=this.valueEncoding(t.valueEncoding),l=i.format,c=s.format;return(t.keyEncoding!==l||t.valueEncoding!==c)&&(t=Object.assign({},t,{keyEncoding:l,valueEncoding:c})),this._get(this.prefixKey(i.encode(e),l),t,(e,t)=>{if(e)return("LEVEL_NOT_FOUND"===e.code||e.notFound||/NotFound/i.test(e))&&(e.code||(e.code="LEVEL_NOT_FOUND"),e.notFound||(e.notFound=!0),e.status||(e.status=404)),r(e);try{t=s.decode(t)}catch(e){return r(new a("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:e}))}r(null,t)}),r[b]}_get(e,t,r){this.nextTick(r,Error("NotFound"))}getMany(e,t,r){if(r=o(r=g(t,r),b),t=m(t,this[I].entry),"opening"===this[_])return this.defer(()=>this.getMany(e,t,r)),r[b];if(M(this,r))return r[b];if(!Array.isArray(e))return this.nextTick(r,TypeError("The first argument 'keys' must be an array")),r[b];if(0===e.length)return this.nextTick(r,null,[]),r[b];let n=this.keyEncoding(t.keyEncoding),i=this.valueEncoding(t.valueEncoding),s=n.format,l=i.format;(t.keyEncoding!==s||t.valueEncoding!==l)&&(t=Object.assign({},t,{keyEncoding:s,valueEncoding:l}));let c=Array(e.length);for(let t=0;t<e.length;t++){let i=e[t],o=this._checkKey(i);if(o)return this.nextTick(r,o),r[b];c[t]=this.prefixKey(n.encode(i),s)}return this._getMany(c,t,(e,t)=>{if(e)return r(e);try{for(let e=0;e<t.length;e++)void 0!==t[e]&&(t[e]=i.decode(t[e]))}catch(e){return r(new a(`Could not decode one or more of ${t.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:e}))}r(null,t)}),r[b]}_getMany(e,t,r){this.nextTick(r,null,Array(e.length).fill(void 0))}put(e,t,r,n){if(n=o(n=g(r,n),b),r=m(r,this[I].entry),"opening"===this[_])return this.defer(()=>this.put(e,t,r,n)),n[b];if(M(this,n))return n[b];let i=this._checkKey(e)||this._checkValue(t);if(i)return this.nextTick(n,i),n[b];let s=this.keyEncoding(r.keyEncoding),a=this.valueEncoding(r.valueEncoding),l=s.format,c=a.format;(r.keyEncoding!==l||r.valueEncoding!==c)&&(r=Object.assign({},r,{keyEncoding:l,valueEncoding:c}));let u=this.prefixKey(s.encode(e),l),d=a.encode(t);return this._put(u,d,r,r=>{if(r)return n(r);this.emit("put",e,t),n()}),n[b]}_put(e,t,r,n){this.nextTick(n)}del(e,t,r){if(r=o(r=g(t,r),b),t=m(t,this[I].key),"opening"===this[_])return this.defer(()=>this.del(e,t,r)),r[b];if(M(this,r))return r[b];let n=this._checkKey(e);if(n)return this.nextTick(r,n),r[b];let i=this.keyEncoding(t.keyEncoding),s=i.format;return t.keyEncoding!==s&&(t=Object.assign({},t,{keyEncoding:s})),this._del(this.prefixKey(i.encode(e),s),t,t=>{if(t)return r(t);this.emit("del",e),r()}),r[b]}_del(e,t,r){this.nextTick(r)}batch(e,t,r){if(!arguments.length){if("opening"===this[_])return new p(this);if("open"!==this[_])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(r=o(r="function"==typeof e?e:g(t,r),b),t=m(t,this[I].empty),"opening"===this[_])return this.defer(()=>this.batch(e,t,r)),r[b];if(M(this,r))return r[b];if(!Array.isArray(e))return this.nextTick(r,TypeError("The first argument 'operations' must be an array")),r[b];if(0===e.length)return this.nextTick(r),r[b];let n=Array(e.length),{keyEncoding:i,valueEncoding:s,...l}=t;for(let t=0;t<e.length;t++){if("object"!=typeof e[t]||null===e[t])return this.nextTick(r,TypeError("A batch operation must be an object")),r[b];let o=Object.assign({},e[t]);if("put"!==o.type&&"del"!==o.type)return this.nextTick(r,TypeError("A batch operation must have a type property that is 'put' or 'del'")),r[b];let a=this._checkKey(o.key);if(a)return this.nextTick(r,a),r[b];let l=null!=o.sublevel?o.sublevel:this,c=l.keyEncoding(o.keyEncoding||i),u=c.format;if(o.key=l.prefixKey(c.encode(o.key),u),o.keyEncoding=u,"put"===o.type){let e=this._checkValue(o.value);if(e)return this.nextTick(r,e),r[b];let t=l.valueEncoding(o.valueEncoding||s);o.value=t.encode(o.value),o.valueEncoding=t.format}l!==this&&(o.sublevel=null),n[t]=o}return this._batch(n,l,t=>{if(t)return r(t);this.emit("batch",e),r()}),r[b]}_batch(e,t,r){this.nextTick(r)}sublevel(e,t){return this._sublevel(e,N.defaults(t))}_sublevel(e,t){return new N(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=o(t=g(e,t),b),e=m(e,this[I].empty),"opening"===this[_])return this.defer(()=>this.clear(e,t)),t[b];if(M(this,t))return t[b];let r=e,n=this.keyEncoding(e.keyEncoding);return(e=y(e,n)).keyEncoding=n.format,0===e.limit?this.nextTick(t):this._clear(e,e=>{if(e)return t(e);this.emit("clear",r),t()}),t[b]}_clear(e,t){this.nextTick(t)}iterator(e){let t=this.keyEncoding(e&&e.keyEncoding),r=this.valueEncoding(e&&e.valueEncoding);if((e=y(e,t)).keys=!1!==e.keys,e.values=!1!==e.values,e[l.keyEncoding]=t,e[l.valueEncoding]=r,e.keyEncoding=t.format,e.valueEncoding=r.format,"opening"===this[_])return new d(this,e);if("open"!==this[_])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new l(this,e)}keys(e){let t=this.keyEncoding(e&&e.keyEncoding),r=this.valueEncoding(e&&e.valueEncoding);if((e=y(e,t))[l.keyEncoding]=t,e[l.valueEncoding]=r,e.keyEncoding=t.format,e.valueEncoding=r.format,"opening"===this[_])return new h(this,e);if("open"!==this[_])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new c(this,e)}values(e){let t=this.keyEncoding(e&&e.keyEncoding),r=this.valueEncoding(e&&e.valueEncoding);if((e=y(e,t))[l.keyEncoding]=t,e[l.valueEncoding]=r,e.keyEncoding=t.format,e.valueEncoding=r.format,"opening"===this[_])return new f(this,e);if("open"!==this[_])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new u(this,e)}defer(e){if("function"!=typeof e)throw TypeError("The first argument must be a function");this[A].push(e)}[x](){if(0===this[A].length)return;let e=this[A];for(let t of(this[A]=[],e))t()}attachResource(e){if("object"!=typeof e||null===e||"function"!=typeof e.close)throw TypeError("The first argument must be a resource object");this[v].add(e)}detachResource(e){this[v].delete(e)}_chainedBatch(){return new p(this)}_checkKey(e){if(null==e)return new a("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(null==e)return new a("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}}D.prototype.nextTick=r(45077);let{AbstractSublevel:N}=r(64196)({AbstractLevel:D});t.AbstractLevel=D,t.AbstractSublevel=N;let M=function(e,t){return"open"!==e[_]&&(e.nextTick(t,new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0)},B=function(e){return Object.keys(e.supports.encodings).filter(t=>!!e.supports.encodings[t])}},71807:e=>{var t="/";!function(){"use strict";var r={114:function(e){function t(e){if("string"!=typeof e)throw TypeError("Path must be a string. Received "+JSON.stringify(e))}function r(e,t){for(var r,n="",i=0,s=-1,o=0,a=0;a<=e.length;++a){if(a<e.length)r=e.charCodeAt(a);else if(47===r)break;else r=47;if(47===r){if(s===a-1||1===o);else if(s!==a-1&&2===o){if(n.length<2||2!==i||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2)){if(n.length>2){var l=n.lastIndexOf("/");if(l!==n.length-1){-1===l?(n="",i=0):i=(n=n.slice(0,l)).length-1-n.lastIndexOf("/"),s=a,o=0;continue}}else if(2===n.length||1===n.length){n="",i=0,s=a,o=0;continue}}t&&(n.length>0?n+="/..":n="..",i=2)}else n.length>0?n+="/"+e.slice(s+1,a):n=e.slice(s+1,a),i=a-s-1;s=a,o=0}else 46===r&&-1!==o?++o:o=-1}return n}function n(e,t){var r=t.dir||t.root,n=t.base||(t.name||"")+(t.ext||"");return r?r===t.root?r+n:r+e+n:n}var i={resolve:function(){for(var e,n,i="",s=!1,o=arguments.length-1;o>=-1&&!s;o--)o>=0?n=arguments[o]:(void 0===e&&(e=""),n=e),t(n),0!==n.length&&(i=n+"/"+i,s=47===n.charCodeAt(0));if(i=r(i,!s),s)if(i.length>0)return"/"+i;else return"/";return i.length>0?i:"."},normalize:function(e){if(t(e),0===e.length)return".";var n=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return(0!==(e=r(e,!n)).length||n||(e="."),e.length>0&&i&&(e+="/"),n)?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0==arguments.length)return".";for(var e,r=0;r<arguments.length;++r){var n=arguments[r];t(n),n.length>0&&(void 0===e?e=n:e+="/"+n)}return void 0===e?".":i.normalize(e)},relative:function(e,r){if(t(e),t(r),e===r||(e=i.resolve(e))===(r=i.resolve(r)))return"";for(var n=1;n<e.length&&47===e.charCodeAt(n);++n);for(var s=e.length,o=s-n,a=1;a<r.length&&47===r.charCodeAt(a);++a);for(var l=r.length-a,c=o<l?o:l,u=-1,d=0;d<=c;++d){if(d===c){if(l>c){if(47===r.charCodeAt(a+d))return r.slice(a+d+1);else if(0===d)return r.slice(a+d)}else o>c&&(47===e.charCodeAt(n+d)?u=d:0===d&&(u=0));break}var h=e.charCodeAt(n+d);if(h!==r.charCodeAt(a+d))break;47===h&&(u=d)}var f="";for(d=n+u+1;d<=s;++d)(d===s||47===e.charCodeAt(d))&&(0===f.length?f+="..":f+="/..");return f.length>0?f+r.slice(a+u):(a+=u,47===r.charCodeAt(a)&&++a,r.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var r=e.charCodeAt(0),n=47===r,i=-1,s=!0,o=e.length-1;o>=1;--o)if(47===(r=e.charCodeAt(o))){if(!s){i=o;break}}else s=!1;return -1===i?n?"/":".":n&&1===i?"//":e.slice(0,i)},basename:function(e,r){if(void 0!==r&&"string"!=typeof r)throw TypeError('"ext" argument must be a string');t(e);var n,i=0,s=-1,o=!0;if(void 0!==r&&r.length>0&&r.length<=e.length){if(r.length===e.length&&r===e)return"";var a=r.length-1,l=-1;for(n=e.length-1;n>=0;--n){var c=e.charCodeAt(n);if(47===c){if(!o){i=n+1;break}}else -1===l&&(o=!1,l=n+1),a>=0&&(c===r.charCodeAt(a)?-1==--a&&(s=n):(a=-1,s=l))}return i===s?s=l:-1===s&&(s=e.length),e.slice(i,s)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!o){i=n+1;break}}else -1===s&&(o=!1,s=n+1);return -1===s?"":e.slice(i,s)},extname:function(e){t(e);for(var r=-1,n=0,i=-1,s=!0,o=0,a=e.length-1;a>=0;--a){var l=e.charCodeAt(a);if(47===l){if(!s){n=a+1;break}continue}-1===i&&(s=!1,i=a+1),46===l?-1===r?r=a:1!==o&&(o=1):-1!==r&&(o=-1)}return -1===r||-1===i||0===o||1===o&&r===i-1&&r===n+1?"":e.slice(r,i)},format:function(e){if(null===e||"object"!=typeof e)throw TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return n("/",e)},parse:function(e){t(e);var r,n={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return n;var i=e.charCodeAt(0),s=47===i;s?(n.root="/",r=1):r=0;for(var o=-1,a=0,l=-1,c=!0,u=e.length-1,d=0;u>=r;--u){if(47===(i=e.charCodeAt(u))){if(!c){a=u+1;break}continue}-1===l&&(c=!1,l=u+1),46===i?-1===o?o=u:1!==d&&(d=1):-1!==o&&(d=-1)}return -1===o||-1===l||0===d||1===d&&o===l-1&&o===a+1?-1!==l&&(0===a&&s?n.base=n.name=e.slice(1,l):n.base=n.name=e.slice(a,l)):(0===a&&s?(n.name=e.slice(1,o),n.base=e.slice(1,l)):(n.name=e.slice(a,o),n.base=e.slice(a,l)),n.ext=e.slice(o,l)),a>0?n.dir=e.slice(0,a-1):s&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};i.posix=i,e.exports=i}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}},o=!0;try{r[e](s,s.exports,i),o=!1}finally{o&&delete n[e]}return s.exports}i.ab=t+"/",e.exports=i(114)}()},73002:function(e,t){(function(){var e,r,n,i,s,o,a,l;l=function(e){return[(-0x1000000&e)>>>24,(0xff0000&e)>>>16,(65280&e)>>>8,255&e].join(".")},a=function(e){var t,n,i,s,o,a;for(t=[],i=s=0;s<=3&&0!==e.length;i=++s){if(i>0){if("."!==e[0])throw Error("Invalid IP");e=e.substring(1)}o=(a=r(e))[0],n=a[1],e=e.substring(n),t.push(o)}if(0!==e.length)throw Error("Invalid IP");switch(t.length){case 1:if(t[0]>0xffffffff)throw Error("Invalid IP");return t[0]>>>0;case 2:if(t[0]>255||t[1]>0xffffff)throw Error("Invalid IP");return(t[0]<<24|t[1])>>>0;case 3:if(t[0]>255||t[1]>255||t[2]>65535)throw Error("Invalid IP");return(t[0]<<24|t[1]<<16|t[2])>>>0;case 4:if(t[0]>255||t[1]>255||t[2]>255||t[3]>255)throw Error("Invalid IP");return(t[0]<<24|t[1]<<16|t[2]<<8|t[3])>>>0;default:throw Error("Invalid IP")}},i=(n=function(e){return e.charCodeAt(0)})("0"),o=n("a"),s=n("A"),r=function(e){var t,r,a,l,c;for(l=0,t=10,r="9",a=0,e.length>1&&"0"===e[a]&&("x"===e[a+1]||"X"===e[a+1]?(a+=2,t=16):"0"<=e[a+1]&&e[a+1]<="9"&&(a++,t=8,r="7")),c=a;a<e.length;){if("0"<=e[a]&&e[a]<=r)l=l*t+(n(e[a])-i)>>>0;else if(16===t)if("a"<=e[a]&&e[a]<="f")l=l*t+(10+n(e[a])-o)>>>0;else if("A"<=e[a]&&e[a]<="F")l=l*t+(10+n(e[a])-s)>>>0;else break;else break;if(l>0xffffffff)throw Error("too large");a++}if(a===c)throw Error("empty octet");return[l,a]},e=function(){function e(e,t){var r,n,i;if("string"!=typeof e)throw Error("Missing `net' parameter");if(t||(e=(i=e.split("/",2))[0],t=i[1]),t||(t=32),"string"==typeof t&&t.indexOf(".")>-1){try{this.maskLong=a(t)}catch(e){throw Error("Invalid mask: "+t)}for(r=n=32;n>=0;r=--n)if(this.maskLong===0xffffffff<<32-r>>>0){this.bitmask=r;break}}else if(t||0===t)this.bitmask=parseInt(t,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=0xffffffff<<32-this.bitmask>>>0);else throw Error("Invalid mask: empty");try{this.netLong=(a(e)&this.maskLong)>>>0}catch(t){throw Error("Invalid net address: "+e)}if(!(this.bitmask<=32))throw Error("Invalid mask for ip4: "+t);this.size=Math.pow(2,32-this.bitmask),this.base=l(this.netLong),this.mask=l(this.maskLong),this.hostmask=l(~this.maskLong),this.first=this.bitmask<=30?l(this.netLong+1):this.base,this.last=this.bitmask<=30?l(this.netLong+this.size-2):l(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?l(this.netLong+this.size-1):void 0}return e.prototype.contains=function(t){return("string"==typeof t&&(t.indexOf("/")>0||4!==t.split(".").length)&&(t=new e(t)),t instanceof e)?this.contains(t.base)&&this.contains(t.broadcast||t.last):(a(t)&this.maskLong)>>>0==(this.netLong&this.maskLong)>>>0},e.prototype.next=function(t){return null==t&&(t=1),new e(l(this.netLong+this.size*t),this.mask)},e.prototype.forEach=function(e){var t,r,n;for(n=a(this.first),r=a(this.last),t=0;n<=r;)e(l(n),n,t),t++,n++},e.prototype.toString=function(){return this.base+"/"+this.bitmask},e}(),t.ip2long=a,t.long2ip=l,t.Netmask=e}).call(this)},73737:function(e,t,r){"use strict";let n=r(6913),{hasOwnProperty:i}=Object.prototype,{propertyIsEnumerable:s}=Object,o=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0}),a=this,l={concatArrays:!1,ignoreUndefined:!1},c=e=>{let t=[];for(let r in e)i.call(e,r)&&t.push(r);if(Object.getOwnPropertySymbols)for(let r of Object.getOwnPropertySymbols(e))s.call(e,r)&&t.push(r);return t};function u(e){return Array.isArray(e)?d(e):n(e)?h(e):e}function d(e){let t=e.slice(0,0);return c(e).forEach(r=>{o(t,r,u(e[r]))}),t}function h(e){let t=null===Object.getPrototypeOf(e)?Object.create(null):{};return c(e).forEach(r=>{o(t,r,u(e[r]))}),t}let f=(e,t,r,n)=>(r.forEach(r=>{void 0===t[r]&&n.ignoreUndefined||(r in e&&e[r]!==Object.getPrototypeOf(e)?o(e,r,g(e[r],t[r],n)):o(e,r,u(t[r])))}),e),p=(e,t,r)=>{let n=e.slice(0,0),s=0;return[e,t].forEach(t=>{let a=[];for(let r=0;r<t.length;r++)i.call(t,r)&&(a.push(String(r)),t===e?o(n,s++,t[r]):o(n,s++,u(t[r])));n=f(n,t,c(t).filter(e=>!a.includes(e)),r)}),n};function g(e,t,r){return r.concatArrays&&Array.isArray(e)&&Array.isArray(t)?p(e,t,r):n(t)&&n(e)?f(e,t,c(t),r):u(t)}e.exports=function(...e){let t=g(u(l),this!==a&&this||{},l),r={_:{}};for(let i of e)if(void 0!==i){if(!n(i))throw TypeError("`"+i+"` is not an Option Object");r=g(r,{_:i},t)}return r._}},74181:(e,t,r)=>{"use strict";let{AbstractIterator:n,AbstractKeyIterator:i,AbstractValueIterator:s}=r(39070),o=Symbol("unfix"),a=Symbol("iterator"),l=Symbol("handleOne"),c=Symbol("handleMany"),u=Symbol("callback");class d extends n{constructor(e,t,r,n){super(e,t),this[a]=r,this[o]=n,this[l]=this[l].bind(this),this[c]=this[c].bind(this),this[u]=null}[l](e,t,r){let n=this[u];if(e)return n(e);void 0!==t&&(t=this[o](t)),n(e,t,r)}[c](e,t){let r=this[u];if(e)return r(e);for(let e of t){let t=e[0];void 0!==t&&(e[0]=this[o](t))}r(e,t)}}class h extends i{constructor(e,t,r,n){super(e,t),this[a]=r,this[o]=n,this[l]=this[l].bind(this),this[c]=this[c].bind(this),this[u]=null}[l](e,t){let r=this[u];if(e)return r(e);void 0!==t&&(t=this[o](t)),r(e,t)}[c](e,t){let r=this[u];if(e)return r(e);for(let e=0;e<t.length;e++){let r=t[e];void 0!==r&&(t[e]=this[o](r))}r(e,t)}}class f extends s{constructor(e,t,r){super(e,t),this[a]=r}}for(let e of[d,h])e.prototype._next=function(e){this[u]=e,this[a].next(this[l])},e.prototype._nextv=function(e,t,r){this[u]=r,this[a].nextv(e,t,this[c])},e.prototype._all=function(e,t){this[u]=t,this[a].all(e,this[c])};for(let e of[f])e.prototype._next=function(e){this[a].next(e)},e.prototype._nextv=function(e,t,r){this[a].nextv(e,t,r)},e.prototype._all=function(e,t){this[a].all(e,t)};for(let e of[d,h,f])e.prototype._seek=function(e,t){this[a].seek(e,t)},e.prototype._close=function(e){this[a].close(e)};t.AbstractSublevelIterator=d,t.AbstractSublevelKeyIterator=h,t.AbstractSublevelValueIterator=f},75799:e=>{"use strict";e.exports=function(e){let t=void 0!==e.gte?e.gte:void 0!==e.gt?e.gt:void 0,r=void 0!==e.lte?e.lte:void 0!==e.lt?e.lt:void 0,n=void 0===e.gte,i=void 0===e.lte;return void 0!==t&&void 0!==r?IDBKeyRange.bound(t,r,n,i):void 0!==t?IDBKeyRange.lowerBound(t,n):void 0!==r?IDBKeyRange.upperBound(r,i):null}},76154:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(4157);function i(e){return null!=e[Symbol.asyncIterator]}let s=function(e,t){return i(e)?async function*(){let r=await (0,n.A)(e);yield*r.sort(t)}():function*(){let r=(0,n.A)(e);yield*r.sort(t)}()}},76520:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(1707);function i(e){return null!=e[Symbol.asyncIterator]}let s=function(e,t){let r=0;if(i(e))return async function*(){for await(let n of e)await t(n,r++)&&(yield n)}();let s=(0,n.A)(e),{value:o,done:a}=s.next();if(!0===a)return function*(){}();let l=t(o,r++);if("function"==typeof l.then)return async function*(){for await(let e of(await l&&(yield o),s))await t(e,r++)&&(yield e)}();let c=t;return function*(){for(let e of(!0===l&&(yield o),s))c(e,r++)&&(yield e)}()}},77338:e=>{!function(){e.exports=m;var t=86400,r=3200,n=1168776,i=0x178302cc00,s=1009822464e5,o=864e13,a=0x100000000,l=1e6,c="000000000",u=Math.trunc||function(e){var t=e-e%1;return 0==t&&(e<0||0===e&&1/e!=1/0)?-0:t},d=m.prototype,h=(m.fromDate=function(e){return new m(+e)},m.fromInt64BE=E(0,1,2,3,0,4),m.fromInt64LE=E(3,2,1,0,4,0),m.fromString=function(e){var t,r=new m,e=(e+="").replace(/^\s*[+\-]?\d+/,function(e){var e=+e,t=1970+(e-1970)%400;return r.year=e-t,t}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(e,r,n){return r<0&&(n*=-1),t=6e4*(60*r+ +n),""}).replace(/\.\d+$/,function(e){return r.nano=+(e+c).substr(1,9),""}).split(/\D+/);if(1<e.length?e[1]--:e[1]=0,r.time=t=Date.UTC.apply(Date,e)-(t||0),isNaN(t))throw TypeError("Invalid Date");return y(r)},m.fromTimeT=function(e){return w(e,0)},d.year=0,d.time=0,d.nano=0,d.addNano=function(e){return this.nano+=+e||0,this},d.getNano=function(){var e=y(this);return(e.time%1e3*l+ +e.nano+1e9)%1e9},d.getTimeT=function(){var e=y(this),i=Math.floor(e.time/1e3),e=e.year;return e&&(i+=e*n*t/r),i},d.getYear=function(){return this.toDate().getUTCFullYear()+this.year},d.toDate=function(){return b(y(this).time)},d.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},d.toString=function(e){var t=this,r=t.toDate(),n={H:function(){return x(r.getUTCHours())},L:function(){return S(r.getUTCMilliseconds(),3)},M:function(){return x(r.getUTCMinutes())},N:function(){return S(t.getNano(),9)},S:function(){return x(r.getUTCSeconds())},Y:function(){var e=t.getYear();return 999999<e?"+"+e:9999<e?"+"+S(e,6):0<=e?S(e,4):-999999<=e?"-"+S(-e,6):e},a:function(){return p[r.getUTCDay()]},b:function(){return f[r.getUTCMonth()]},d:function(){return x(r.getUTCDate())},e:function(){var e;return(9<(e=r.getUTCDate())?"":" ")+(0|e)},m:function(){return x(r.getUTCMonth()+1)}};return function e(t){return t.replace(/%./g,function(t){var r=t[1],i=g[r],r=n[r];return i?e(i):r?r():t})}(e||h)},d.writeInt64BE=v(0,1,2,3,0,4),d.writeInt64LE=v(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],p=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g={"%":"%",F:"%Y-%m-%d",n:"\n",R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};function m(e,t,r){var n=this;if(!(n instanceof m))return new m(e,t,r);n.time=+e||0,n.nano=+t||0,n.year=+r||0,y(n)}function y(e){var t,n,i,a=e.year,c=e.time,d=e.nano,h=((d<0||l<=d)&&(d-=(n=Math.floor(d/l))*l,c+=n,n=1),a%r);return(c<-o||o<c||h)&&((t=u(c/s))&&(a+=t*r,c-=t*s),(i=b(c)).setUTCFullYear(h+i.getUTCFullYear()),i=(c=+i)+(t=u((a-=h)/r))*s,t&&-o<=i&&i<=o&&(a-=t*r,c=i),n=1),n&&(e.year=a,e.time=c,e.nano=d),e}function b(e){var t=new Date(0);return t.setTime(e),t}function w(e,t){e=+e||0;var n=u((t=(0|t)*a)/i)+u(e/i),t=t%i+e%i,e=u(t/i);return e&&(n+=e,t-=e*i),new m(1e3*t,0,n*r)}function v(e,i,s,o,l,c){return function(e,i){var s=y(this);A(e=e||Array(8),i|=0);var o=Math.floor(s.time/1e3),s=s.year*(n*t/r),h=u(s/a)+u(o/a),s=s%a+o%a,o=Math.floor(s/a);return o&&(h+=o,s-=o*a),d(e,i+l,h),d(e,i+c,s),e};function d(t,r,n){t[r+e]=n>>24&255,t[r+i]=n>>16&255,t[r+s]=n>>8&255,t[r+o]=255&n}}function E(e,t,r,n,i,s){return function(e,t){A(e,t|=0);var r=o(e,t+i);return w(o(e,t+s),r)};function o(i,s){return 0x1000000*i[s+e]+(i[s+t]<<16|i[s+r]<<8|i[s+n])}}function A(e,t){if(null==(e=e&&e.length))throw TypeError("Invalid Buffer");if(e<t+8)throw RangeError("Out of range")}function x(e){return(9<e?"":"0")+(0|e)}function S(e,t){return(c+(0|e)).substr(-t)}}()},77477:(e,t,r)=>{"use strict";r.d(t,{d:()=>i});var n=r(2629);function i(e,t="utf8"){let r=n.A[t];if(null==r)throw Error(`Unsupported encoding "${t}"`);return r.encoder.encode(e).substring(1)}},77481:(e,t,r)=>{"use strict";var n;n={value:!0};let i=r(94858);t.PP=i.EventIterator,n=function(e,t,r){return new i.EventIterator(({push:r})=>(this.addEventListener(e,r,t),()=>this.removeEventListener(e,r,t)),r)},n=i.EventIterator},77697:e=>{"use strict";let t=null;e.exports=function(){return null===t&&(t={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),t}},78229:module=>{var __dirname="/";!function(){var __webpack_modules__={950:function(__unused_webpack_module,exports){var indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0;r<e.length;r++)if(e[r]===t)return r;return -1},Object_keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var r in e)t.push(r);return t},forEach=function(e,t){if(e.forEach)return e.forEach(t);for(var r=0;r<e.length;r++)t(e[r],r,e)},defineProp=function(){try{return Object.defineProperty({},"_",{}),function(e,t,r){Object.defineProperty(e,t,{writable:!0,enumerable:!1,configurable:!0,value:r})}}catch(e){return function(e,t,r){e[t]=r}}}(),globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports.Script=function(e){if(!(this instanceof Script))return new Script(e);this.code=e};Script.prototype.runInContext=function(e){if(!(e instanceof Context))throw TypeError("needs a 'context' argument.");var t=document.createElement("iframe");t.style||(t.style={}),t.style.display="none",document.body.appendChild(t);var r=t.contentWindow,n=r.eval,i=r.execScript;!n&&i&&(i.call(r,"null"),n=r.eval),forEach(Object_keys(e),function(t){r[t]=e[t]}),forEach(globals,function(t){e[t]&&(r[t]=e[t])});var s=Object_keys(r),o=n.call(r,this.code);return forEach(Object_keys(r),function(t){(t in e||-1===indexOf(s,t))&&(e[t]=r[t])}),forEach(globals,function(t){t in e||defineProp(e,t,r[t])}),document.body.removeChild(t),o},Script.prototype.runInThisContext=function(){return eval(this.code)},Script.prototype.runInNewContext=function(e){var t=Script.createContext(e),r=this.runInContext(t);return e&&forEach(Object_keys(t),function(r){e[r]=t[r]}),r},forEach(Object_keys(Script.prototype),function(e){exports[e]=Script[e]=function(t){var r=Script(t);return r[e].apply(r,[].slice.call(arguments,1))}}),exports.isContext=function(e){return e instanceof Context},exports.createScript=function(e){return exports.Script(e)},exports.createContext=Script.createContext=function(e){var t=new Context;return"object"==typeof e&&forEach(Object_keys(e),function(r){t[r]=e[r]}),t}}};"undefined"!=typeof __nccwpck_require__&&(__nccwpck_require__.ab=__dirname+"/");var __nested_webpack_exports__={};__webpack_modules__[950](0,__nested_webpack_exports__),module.exports=__nested_webpack_exports__}()},79589:e=>{"use strict";e.exports=function(e,t,r,n,i){if(0===n.limit)return e.nextTick(i);let s=e.db.transaction([t],"readwrite"),o=s.objectStore(t),a=0;s.oncomplete=function(){i()},s.onabort=function(){i(s.error||Error("aborted by user"))};let l=o.openKeyCursor?"openKeyCursor":"openCursor",c=n.reverse?"prev":"next";o[l](r,c).onsuccess=function(e){let t=e.target.result;t&&(o.delete(t.key).onsuccess=function(){(n.limit<=0||++a<n.limit)&&t.continue()})}}},80228:(e,t,r)=>{var n=r(44134),i=n.Buffer;function s(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(s(n,t),t.Buffer=o),o.prototype=Object.create(i.prototype),s(i,o),o.from=function(e,t,r){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return n.SlowBuffer(e)}},80501:(e,t,r)=>{"use strict";let{AbstractLevel:n}=r(97233),i=r(7800),s=r(29485),{fromCallback:o}=r(82813),{Iterator:a}=r(18993),l=r(13623),c=r(79589),u=r(75799),d="level-js-",h=Symbol("idb"),f=Symbol("namePrefix"),p=Symbol("location"),g=Symbol("version"),m=Symbol("store"),y=Symbol("onComplete"),b=Symbol("promise");class w extends n{constructor(e,t,r){if("function"==typeof t||"function"==typeof r)throw new i("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});let{prefix:n,version:s,...o}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},o),"string"!=typeof e)throw Error("constructor requires a location string argument");this[p]=e,this[f]=null==n?d:n,this[g]=parseInt(s||1,10),this[h]=null}get location(){return this[p]}get namePrefix(){return this[f]}get version(){return this[g]}get db(){return this[h]}get type(){return"browser-level"}_open(e,t){let r=indexedDB.open(this[f]+this[p],this[g]);r.onerror=function(){t(r.error||Error("unknown error"))},r.onsuccess=()=>{this[h]=r.result,t()},r.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(this[p])||t.createObjectStore(this[p])}}[m](e){return this[h].transaction([this[p]],e).objectStore(this[p])}[y](e,t){let r=e.transaction;r.onabort=function(){t(r.error||Error("aborted by user"))},r.oncomplete=function(){t(null,e.result)}}_get(e,t,r){let n,s=this[m]("readonly");try{n=s.get(e)}catch(e){return this.nextTick(r,e)}this[y](n,function(e,t){return e?r(e):void 0===t?r(new i("Entry not found",{code:"LEVEL_NOT_FOUND"})):void r(null,l(t))})}_getMany(e,t,r){let n=this[m]("readonly");s(e.map(e=>t=>{let r;try{r=n.get(e)}catch(e){return t(e)}r.onsuccess=()=>{let e=r.result;t(null,void 0===e?e:l(e))},r.onerror=e=>{e.stopPropagation(),t(r.error)}}),16,r)}_del(e,t,r){let n,i=this[m]("readwrite");try{n=i.delete(e)}catch(e){return this.nextTick(r,e)}this[y](n,r)}_put(e,t,r,n){let i,s=this[m]("readwrite");try{i=s.put(t,e)}catch(e){return this.nextTick(n,e)}this[y](i,n)}_iterator(e){return new a(this,this[p],e)}_batch(e,t,r){let n,i=this[m]("readwrite"),s=i.transaction,o=0;function a(){let t,r=e[o++],l=r.key;try{t="del"===r.type?i.delete(l):i.put(r.value,l)}catch(e){n=e,s.abort();return}o<e.length?t.onsuccess=a:"function"==typeof s.commit&&s.commit()}s.onabort=function(){r(n||s.error||Error("aborted by user"))},s.oncomplete=function(){r()},a()}_clear(e,t){let r,n;try{r=u(e)}catch(e){return this.nextTick(t)}if(e.limit>=0)return c(this,this[p],r,e,t);try{let e=this[m]("readwrite");n=r?e.delete(r):e.clear()}catch(e){return this.nextTick(t,e)}this[y](n,t)}_close(e){this[h].close(),this.nextTick(e)}}w.destroy=function(e,t,r){"function"==typeof t&&(r=t,t=d),r=o(r,b);let n=indexedDB.deleteDatabase(t+e);return n.onsuccess=function(){r()},n.onerror=function(e){r(e)},r[b]},t.BrowserLevel=w},81954:(e,t,r)=>{"use strict";var n=r(13372);if(n)try{n([],"length")}catch(e){n=null}e.exports=n},82083:e=>{"use strict";e.exports=Math.abs},82661:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,n,s,o){if("function"!=typeof n)throw TypeError("The listener must be a function");var a=new i(n,s||e,o),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1)),a.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=Array(s);i<s;i++)o[i]=n[i].fn;return o},a.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,i,s,o){var a=r?r+e:e;if(!this._events[a])return!1;var l,c,u=this._events[a],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,i),!0;case 5:return u.fn.call(u.context,t,n,i,s),!0;case 6:return u.fn.call(u.context,t,n,i,s,o),!0}for(c=1,l=Array(d-1);c<d;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var h,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,n);break;case 4:u[c].fn.call(u[c].context,t,n,i);break;default:if(!l)for(h=1,l=Array(d-1);h<d;h++)l[h-1]=arguments[h];u[c].fn.apply(u[c].context,l)}}return!0},a.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,n,i){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||i&&!a.once||n&&a.context!==n||o(this,s);else{for(var l=0,c=[],u=a.length;l<u;l++)(a[l].fn!==t||i&&!a[l].once||n&&a[l].context!==n)&&c.push(a[l]);c.length?this._events[s]=1===c.length?c[0]:c:o(this,s)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a},82813:(e,t,r)=>{"use strict";var n=r(96341);t.fromCallback=function(e,t){if(void 0===e){var r=new Promise(function(t,r){e=function(e,n){e?r(e):t(n)}});e[void 0!==t?t:"promise"]=r}else if("function"!=typeof e)throw TypeError("Callback must be a function");return e},t.fromPromise=function(e,t){if(void 0===t)return e;e.then(function(e){n(()=>t(null,e))}).catch(function(e){n(()=>t(e))})}},83623:e=>{"use strict";e.exports=Math.round},84115:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},84116:e=>{"use strict";let t=7;function r(e,t){return e+n(t)}function n(e){let t=e;return t-=t>>1&0x55555555,((t=(0x33333333&t)+(t>>2&0x33333333))+(t>>4)&0xf0f0f0f)*0x1010101>>24}function i(e,t){return e[0]-t[0]}function s(e){return e[1]}e.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,t){let r=this._internalPositionFor(e,!1);if(void 0===t)-1!==r&&(this._unsetInternalPos(r),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let n=!1;-1===r?(r=this._data.length,this._setBit(e),this._changedData=!0):n=!0,this._setInternalPos(r,e,t,n),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();let t=this._internalPositionFor(e,!0);if(-1!==t)return this._data[t][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){let e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let t=0;for(;t<this.length;)e(this.get(t),t,this),t++}map(e){let t=0,r=Array(this.length);for(;t<this.length;)r[t]=e(this.get(t),t,this),t++;return r}reduce(e,t){let r=0,n=t;for(;r<this.length;)n=e(n,this.get(r),r),r++;return n}find(e){let t=0,r,n;for(;t<this.length&&!r;)r=e(n=this.get(t)),t++;return r?n:void 0}_internalPositionFor(e,i){let s=this._bytePosFor(e,i);if(s>=this._bitArrays.length)return -1;let o=this._bitArrays[s],a=e-s*t;return(o&1<<a)>0?this._bitArrays.slice(0,s).reduce(r,0)+n(o&~(0xffffffff<<a+1))-1:-1}_bytePosFor(e,r){let n=Math.floor(e/t),i=n+1;for(;!r&&this._bitArrays.length<i;)this._bitArrays.push(0);return n}_setBit(e){let r=this._bytePosFor(e,!1);this._bitArrays[r]|=1<<e-r*t}_unsetBit(e){let r=this._bytePosFor(e,!1);this._bitArrays[r]&=~(1<<e-r*t)}_setInternalPos(e,t,r,n){let i=this._data,s=[t,r];if(n)this._sortData(),i[e]=s;else{if(i.length)if(i[i.length-1][0]>=t)i.push(s);else if(i[0][0]<=t)i.unshift(s);else{let e=Math.round(i.length/2);this._data=i.slice(0,e).concat(s).concat(i.slice(e))}else this._data.push(s);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(i),this._changedData=!1}bitField(){let e,t=[],r=8,n=0,i=0,s=this._bitArrays.slice();for(;s.length||n;){0===n&&(e=s.shift(),n=7);let o=Math.min(n,r);i|=(e&~(255<<o))<<8-r,e>>>=o,n-=o,(r-=o)&&(n||s.length)||(t.push(i),i=0,r=8)}for(var o=t.length-1;o>0;o--)if(0===t[o])t.pop();else break;return t}compactArray(){return this._sortData(),this._data.map(s)}}},84896:(e,t,r)=>{e.exports=r(90342)},85407:(e,t,r)=>{"use strict";var n=r(52430),i=r(63674),s=r(60261),o=r(3289);e.exports=function(e){if(e.length<1||"function"!=typeof e[0])throw new i("a function is required");return o(n,s,e)}},86589:e=>{"use strict";e.exports=JSON.parse('{"name":"dotenv","version":"16.5.0","description":"Loads environment variables from .env file","main":"lib/main.js","types":"lib/main.d.ts","exports":{".":{"types":"./lib/main.d.ts","require":"./lib/main.js","default":"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},"scripts":{"dts-check":"tsc --project tests/types/tsconfig.json","lint":"standard","pretest":"npm run lint && npm run dts-check","test":"tap run --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run --show-full-coverage --timeout=60000 --coverage-report=lcov","prerelease":"npm test","release":"standard-version"},"repository":{"type":"git","url":"git://github.com/motdotla/dotenv.git"},"homepage":"https://github.com/motdotla/dotenv#readme","funding":"https://dotenvx.com","keywords":["dotenv","env",".env","environment","variables","config","settings"],"readmeFilename":"README.md","license":"BSD-2-Clause","devDependencies":{"@types/node":"^18.11.3","decache":"^4.6.2","sinon":"^14.0.1","standard":"^17.0.0","standard-version":"^9.5.0","tap":"^19.2.0","typescript":"^4.8.4"},"engines":{"node":">=12"},"browser":{"fs":false}}')},86620:(e,t,r)=>{"use strict";r.d(t,{U:()=>l});var n=r(22938),i=r(77477);let s="/",o=new TextEncoder().encode(s),a=o[0];class l{_buf;constructor(e,t){if("string"==typeof e)this._buf=(0,n.s)(e);else if(e instanceof Uint8Array)this._buf=e;else throw Error("Invalid key, should be String of Uint8Array");if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==a)throw Error("Invalid key")}toString(e="utf8"){return(0,i.d)(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new l(e.join(s))}static random(){return new l(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new l(e):"function"==typeof e.uint8Array?new l(e.uint8Array()):null}clean(){if((null==this._buf||0===this._buf.byteLength)&&(this._buf=o),this._buf[0]!==a){let e=new Uint8Array(this._buf.byteLength+1);e.fill(a,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===a;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;let n=t[e],i=r[e];if(n<i)return!0;if(n>i)return!1}return t.length<r.length}reverse(){return l.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(s).slice(1)}type(){return c(this.baseNamespace())}name(){return u(this.baseNamespace())}instance(e){return new l(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(s)||(e+=s),new l(e+=this.type())}parent(){let e=this.list();return new l(1===e.length?s:e.slice(0,-1).join(s))}child(e){return this.toString()===s?e:e.toString()===s?this:new l(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return l.withNamespaces([...this.namespaces(),...d(e.map(e=>e.namespaces()))])}}function c(e){let t=e.split(":");return t.length<2?"":t.slice(0,-1).join(":")}function u(e){let t=e.split(":");return t[t.length-1]}function d(e){return[].concat(...e)}},86892:(e,t,r)=>{"use strict";let{Buffer:n}=r(44134)||{Buffer:{isBuffer:()=>!1}},{textEncoder:i,textDecoder:s}=r(77697)(),{BufferFormat:o,ViewFormat:a,UTF8Format:l}=r(22846),c=e=>e;t.utf8=new l({encode:function(e){return n.isBuffer(e)?e.toString("utf8"):ArrayBuffer.isView(e)?s.decode(e):String(e)},decode:c,name:"utf8",createViewTranscoder(){return new a({encode:function(e){return ArrayBuffer.isView(e)?e:i.encode(e)},decode:function(e){return s.decode(e)},name:`${this.name}+view`})},createBufferTranscoder(){return new o({encode:function(e){return n.isBuffer(e)?e:ArrayBuffer.isView(e)?n.from(e.buffer,e.byteOffset,e.byteLength):n.from(String(e),"utf8")},decode:function(e){return e.toString("utf8")},name:`${this.name}+buffer`})}}),t.json=new l({encode:JSON.stringify,decode:JSON.parse,name:"json"}),t.buffer=new o({encode:function(e){return n.isBuffer(e)?e:ArrayBuffer.isView(e)?n.from(e.buffer,e.byteOffset,e.byteLength):n.from(String(e),"utf8")},decode:c,name:"buffer",createViewTranscoder(){return new a({encode:function(e){return ArrayBuffer.isView(e)?e:n.from(String(e),"utf8")},decode:function(e){return n.from(e.buffer,e.byteOffset,e.byteLength)},name:`${this.name}+view`})}}),t.view=new a({encode:function(e){return ArrayBuffer.isView(e)?e:i.encode(e)},decode:c,name:"view",createBufferTranscoder(){return new o({encode:function(e){return n.isBuffer(e)?e:ArrayBuffer.isView(e)?n.from(e.buffer,e.byteOffset,e.byteLength):n.from(String(e),"utf8")},decode:c,name:`${this.name}+buffer`})}}),t.hex=new o({encode:function(e){return n.isBuffer(e)?e:n.from(String(e),"hex")},decode:function(e){return e.toString("hex")},name:"hex"}),t.base64=new o({encode:function(e){return n.isBuffer(e)?e:n.from(String(e),"base64")},decode:function(e){return e.toString("base64")},name:"base64"})},87700:(e,t,r)=>{"use strict";var n=r(42066);e.exports=function(e){return n(e)||0===e?e:e<0?-1:1}},87704:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Digest:()=>l,create:()=>s,decode:()=>o,equals:()=>a,hasCode:()=>c});var n=r(70834),i=r(41394);function s(e,t){let r=t.byteLength,n=i.OY(e),s=n+i.OY(r),o=new Uint8Array(s+r);return i.s_(e,o,0),i.s_(r,o,n),o.set(t,s),new l(e,r,t,o)}function o(e){let t=(0,n.coerce)(e),[r,s]=i.D4(t),[o,a]=i.D4(t.subarray(s)),c=t.subarray(s+a);if(c.byteLength!==o)throw Error("Incorrect length");return new l(r,o,c,t)}function a(e,t){if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&(0,n.equals)(e.bytes,r.bytes)}}class l{code;size;digest;bytes;constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}function c(e,t){return e.code===t}},89159:(e,t,r)=>{"use strict";r.d(t,{m:()=>u});var n=r(57116);class i{articleName;astraDb;versionManager;constructor(e,t,r){this.articleName=e,this.astraDb=r,this.versionManager=new n.m9(this.constructVersions(t))}getContent(e){let t=[];return t=e?this.versionManager.getBranch(e):this.versionManager.getMainBranch(),(0,n.a6)(t)}getVersions(){let e=new Set(this.versionManager.getMainBranch().map(e=>e.id));return this.versionManager.getAllVersions().map(t=>({id:t.id,date:t.date,parent:t.parent,mainBranch:e.has(t.id)}))}getCurrentVersionID(){let e=this.versionManager.getMainBranch();if(0===e.length)throw Error("No versions found");return e[e.length-1].id}async newContent(e,t){let r;if(t){let i=this.versionManager.getBranch(t),s=(0,n.a6)(i);r=(0,n.JL)(s,e,t)}else r=(0,n.JL)("",e,t??null);this.versionManager.addVersion(r),await this.astraDb.add(this.articleName,JSON.stringify(r))}constructVersions(e){let t=[];for(let r of e){let e=JSON.parse(r);t.push(e)}return t}}class s{wikiName;astraDb;lastVersionFetchedByArticle;constructor(e,t){this.wikiName=e,this.astraDb=t,this.lastVersionFetchedByArticle=new Map}async getArticle(e,t){let r=await this.astraDb.get(e),n=new i(e,r,this.astraDb);return this.lastVersionFetchedByArticle.set(e,n.getCurrentVersionID()),{name:e,content:n.getContent(t),versionsInfo:n.getVersions()}}async newArticle(e,t){let r=new i(e,[],this.astraDb);await r.newContent(t)}async editArticle(e,t){let r=await this.astraDb.get(e),n=new i(e,r,this.astraDb),s=this.lastVersionFetchedByArticle.get(e);if(!s)throw Error(`Article ${e} was not previously fetched. Fetched articles: ${this.lastVersionFetchedByArticle.keys()}`);await n.newContent(t,s)}async getArticleList(){return this.astraDb.getAllKeys()}}var o=r(67358);class a{wikiName;astraDb;articleRepository;constructor(e){this.wikiName=e}async init(e){this.astraDb=await (0,o.W)({dbName:this.wikiName,isCollaborator:e.isCollaborator,datastore:e.datastore,blockstore:e.blockstore,publicIp:e.publicIp,TcpPort:e.TcpPort,WSPort:e.WSPort,WSSPort:e.WSSPort,dataDir:e.dataDir,offlineMode:e.offlineMode}),this.articleRepository=new s(this.wikiName,this.astraDb)}async getArticle(e,t){console.log(`Fetching article ${e}`);let r=await this.articleRepository.getArticle(e,t);return console.log(`Article ${e} fetched`),r}async newArticle(e,t){console.log(`Creating article ${e}`),await this.articleRepository.newArticle(e,t),console.log(`Article ${e} created`)}async editArticle(e,t){console.log(`Editing article ${e}`),await this.articleRepository.editArticle(e,t),console.log(`Article ${e} edited`)}async getArticleList(){return await this.articleRepository.getArticleList()}}var l=r(46923),c=r(68250);async function u(e={}){e.wikiName=e.wikiName??"bitxenia-wiki",e.isCollaborator=e.isCollaborator??!1,e.datastore=e.datastore??new c.bk,e.blockstore=e.blockstore??new l.ED,e.publicIp=e.publicIp??"0.0.0.0",e.TcpPort=e.TcpPort??40001,e.WSPort=e.WSPort??40002,e.WSSPort=e.WSSPort??40003,e.dataDir=e.dataDir??"./data/astrawiki",e.offlineMode=e.offlineMode??!1;let t=new a(e.wikiName);return await t.init(e),t}},90161:(e,t,r)=>{"use strict";r.d(t,{i:()=>n});class n{has(e,t){return Promise.reject(Error(".has is not implemented"))}put(e,t,r){return Promise.reject(Error(".put is not implemented"))}async *putMany(e,t){for await(let{cid:r,block:n}of e)await this.put(r,n,t),yield r}get(e,t){return Promise.reject(Error(".get is not implemented"))}async *getMany(e,t){for await(let r of e)yield{cid:r,block:await this.get(r,t)}}delete(e,t){return Promise.reject(Error(".delete is not implemented"))}async *deleteMany(e,t){for await(let r of e)await this.delete(r,t),yield r}async *getAll(e){throw Error(".getAll is not implemented")}}},90342:(e,t,r)=>{var n=r(29200);t.operation=function(e){return new n(t.timeouts(e),{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var n=[],i=0;i<t.retries;i++)n.push(this.createTimeout(i,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(i,t)),n.sort(function(e,t){return e-t}),n},t.createTimeout=function(e,t){var r=Math.round((t.randomize?Math.random()+1:1)*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(r,t.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var i in n=[],e)"function"==typeof e[i]&&n.push(i);for(var s=0;s<n.length;s++){var o=n[s],a=e[o];e[o]=(function(n){var i=t.operation(r),s=Array.prototype.slice.call(arguments,1),o=s.pop();s.push(function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),o.apply(this,arguments))}),i.attempt(function(){n.apply(e,s)})}).bind(e,a),e[o].options=r}}},91011:e=>{e.exports=function(e){if(!e)throw Error("hashlru must have a max value, of type number, greater than 0");var t=0,r=Object.create(null),n=Object.create(null);function i(i,s){r[i]=s,++t>=e&&(t=0,n=r,r=Object.create(null))}return{has:function(e){return void 0!==r[e]||void 0!==n[e]},remove:function(e){void 0!==r[e]&&(r[e]=void 0),void 0!==n[e]&&(n[e]=void 0)},get:function(e){var t=r[e];return void 0!==t?t:void 0!==(t=n[e])?(i(e,t),t):void 0},set:function(e,t){void 0!==r[e]?r[e]=t:i(e,t)},clear:function(){r=Object.create(null),n=Object.create(null)}}}},91295:(e,t,r)=>{"use strict";function n(e){return null!=e[Symbol.asyncIterator]}r.d(t,{A:()=>i});let i=function(e,t){return n(e)?async function*(){let r=0;if(!(t<1)){for await(let n of e)if(yield n,++r===t)return}}():function*(){let r=0;if(!(t<1)){for(let n of e)if(yield n,++r===t)return}}()}},91453:(e,t,r)=>{"use strict";var n=r(70508),i=r(85407),s=i([n("%String.prototype.indexOf%")]);e.exports=function(e,t){var r=n(e,!!t);return"function"==typeof r&&s(e,".prototype.")>-1?i([r]):r}},92293:(e,t,r)=>{"use strict";r.d(t,{Oh:()=>s});var n=r(12115),i=0;function s(){n.useEffect(()=>{var e,t;let r=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",null!=(e=r[0])?e:o()),document.body.insertAdjacentElement("beforeend",null!=(t=r[1])?t:o()),i++,()=>{1===i&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),i--}},[])}function o(){let e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}},92425:(e,t,r)=>{"use strict";let{AbstractIterator:n,AbstractKeyIterator:i,AbstractValueIterator:s}=r(39070),o=r(7800),a=Symbol("nut"),l=Symbol("undefer"),c=Symbol("factory");class u extends n{constructor(e,t){super(e,t),this[a]=null,this[c]=()=>e.iterator(t),this.db.defer(()=>this[l]())}}class d extends i{constructor(e,t){super(e,t),this[a]=null,this[c]=()=>e.keys(t),this.db.defer(()=>this[l]())}}class h extends s{constructor(e,t){super(e,t),this[a]=null,this[c]=()=>e.values(t),this.db.defer(()=>this[l]())}}for(let e of[u,d,h])e.prototype[l]=function(){"open"===this.db.status&&(this[a]=this[c]())},e.prototype._next=function(e){null!==this[a]?this[a].next(e):"opening"===this.db.status?this.db.defer(()=>this._next(e)):this.nextTick(e,new o("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._nextv=function(e,t,r){null!==this[a]?this[a].nextv(e,t,r):"opening"===this.db.status?this.db.defer(()=>this._nextv(e,t,r)):this.nextTick(r,new o("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._all=function(e,t){null!==this[a]?this[a].all(t):"opening"===this.db.status?this.db.defer(()=>this._all(e,t)):this.nextTick(t,new o("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._seek=function(e,t){null!==this[a]?this[a]._seek(e,t):"opening"===this.db.status&&this.db.defer(()=>this._seek(e,t))},e.prototype._close=function(e){null!==this[a]?this[a].close(e):"opening"===this.db.status?this.db.defer(()=>this._close(e)):this.nextTick(e)};t.DeferredIterator=u,t.DeferredKeyIterator=d,t.DeferredValueIterator=h},92678:e=>{"use strict";e.exports="undefined"!=typeof Reflect&&Reflect&&Reflect.apply},93795:(e,t,r)=>{"use strict";r.d(t,{A:()=>ed});var n,i=function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function s(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}Object.create;function o(e,t,r){if(r||2==arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}Object.create;var a=("function"==typeof SuppressedError&&SuppressedError,r(12115)),l="right-scroll-bar-position",c="width-before-scroll-bar",u="with-scroll-bars-hidden",d="--removed-body-scroll-bar-size";function h(e,t){return"function"==typeof e?e(t):e&&(e.current=t),e}function f(e,t){var r=(0,a.useState)(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(value){var n=r.value;n!==value&&(r.value=value,r.callback(value,n))}}}})[0];return r.callback=t,r.facade}var p="undefined"!=typeof window?a.useLayoutEffect:a.useEffect,g=new WeakMap;function m(e,t){var r=f(t||null,function(t){return e.forEach(function(e){return h(e,t)})});return p(function(){var t=g.get(r);if(t){var n=new Set(t),i=new Set(e),s=r.current;n.forEach(function(e){i.has(e)||h(e,null)}),i.forEach(function(e){n.has(e)||h(e,s)})}g.set(r,e)},[e]),r}function y(e){return e}function b(e,t){void 0===t&&(t=y);var r=[],n=!1;return{read:function(){if(n)throw Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(e){var i=t(e,n);return r.push(i),function(){r=r.filter(function(e){return e!==i})}},assignSyncMedium:function(e){for(n=!0;r.length;){var t=r;r=[],t.forEach(e)}r={push:function(t){return e(t)},filter:function(){return r}}},assignMedium:function(e){n=!0;var t=[];if(r.length){var i=r;r=[],i.forEach(e),t=r}var s=function(){var r=t;t=[],r.forEach(e)},o=function(){return Promise.resolve().then(s)};o(),r={push:function(e){t.push(e),o()},filter:function(e){return t=t.filter(e),r}}}}}var w=function(e){void 0===e&&(e={});var t=b(null);return t.options=i({async:!0,ssr:!1},e),t}(),v=function(){},E=a.forwardRef(function(e,t){var r=a.useRef(null),n=a.useState({onScrollCapture:v,onWheelCapture:v,onTouchMoveCapture:v}),o=n[0],l=n[1],c=e.forwardProps,u=e.children,d=e.className,h=e.removeScrollBar,f=e.enabled,p=e.shards,g=e.sideCar,y=e.noIsolation,b=e.inert,E=e.allowPinchZoom,A=e.as,x=void 0===A?"div":A,S=e.gapMode,k=s(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),_=g,I=m([r,t]),T=i(i({},k),o);return a.createElement(a.Fragment,null,f&&a.createElement(_,{sideCar:w,removeScrollBar:h,shards:p,noIsolation:y,inert:b,setCallbacks:l,allowPinchZoom:!!E,lockRef:r,gapMode:S}),c?a.cloneElement(a.Children.only(u),i(i({},T),{ref:I})):a.createElement(x,i({},T,{className:d,ref:I}),u))});E.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},E.classNames={fullWidth:c,zeroRight:l};var A=function(e){var t=e.sideCar,r=s(e,["sideCar"]);if(!t)throw Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw Error("Sidecar medium not found");return a.createElement(n,i({},r))};function x(e,t){return e.useMedium(t),A}A.isSideCarExport=!0;var S=function(){return n||r.nc};function k(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=S();return t&&e.setAttribute("nonce",t),e}function _(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function I(e){(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}var T=function(){var e=0,t=null;return{add:function(r){0==e&&(t=k())&&(_(t,r),I(t)),e++},remove:function(){--e||!t||(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},C=function(){var e=T();return function(t,r){a.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},P=function(){var e=C();return function(t){return e(t.styles,t.dynamic),null}},R={left:0,top:0,right:0,gap:0},D=function(e){return parseInt(e||"",10)||0},N=function(e){var t=window.getComputedStyle(document.body),r=t["padding"===e?"paddingLeft":"marginLeft"],n=t["padding"===e?"paddingTop":"marginTop"],i=t["padding"===e?"paddingRight":"marginRight"];return[D(r),D(n),D(i)]},M=function(e){if(void 0===e&&(e="margin"),"undefined"==typeof window)return R;var t=N(e),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-r+t[2]-t[0])}},B=P(),O="data-scroll-locked",L=function(e,t,r,n){var i=e.left,s=e.top,o=e.right,a=e.gap;return void 0===r&&(r="margin"),"\n  .".concat(u," {\n   overflow: hidden ").concat(n,";\n   padding-right: ").concat(a,"px ").concat(n,";\n  }\n  body[").concat(O,"] {\n    overflow: hidden ").concat(n,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(n,";"),"margin"===r&&"\n    padding-left: ".concat(i,"px;\n    padding-top: ").concat(s,"px;\n    padding-right: ").concat(o,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(a,"px ").concat(n,";\n    "),"padding"===r&&"padding-right: ".concat(a,"px ").concat(n,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(l," {\n    right: ").concat(a,"px ").concat(n,";\n  }\n  \n  .").concat(c," {\n    margin-right: ").concat(a,"px ").concat(n,";\n  }\n  \n  .").concat(l," .").concat(l," {\n    right: 0 ").concat(n,";\n  }\n  \n  .").concat(c," .").concat(c," {\n    margin-right: 0 ").concat(n,";\n  }\n  \n  body[").concat(O,"] {\n    ").concat(d,": ").concat(a,"px;\n  }\n")},F=function(){var e=parseInt(document.body.getAttribute(O)||"0",10);return isFinite(e)?e:0},U=function(){a.useEffect(function(){return document.body.setAttribute(O,(F()+1).toString()),function(){var e=F()-1;e<=0?document.body.removeAttribute(O):document.body.setAttribute(O,e.toString())}},[])},j=function(e){var t=e.noRelative,r=e.noImportant,n=e.gapMode,i=void 0===n?"margin":n;U();var s=a.useMemo(function(){return M(i)},[i]);return a.createElement(B,{styles:L(s,!t,i,r?"":"!important")})},H=!1;if("undefined"!=typeof window)try{var $=Object.defineProperty({},"passive",{get:function(){return H=!0,!0}});window.addEventListener("test",$,$),window.removeEventListener("test",$,$)}catch(e){H=!1}var q=!!H&&{passive:!1},z=function(e){return"TEXTAREA"===e.tagName},V=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return"hidden"!==r[t]&&!(r.overflowY===r.overflowX&&!z(e)&&"visible"===r[t])},G=function(e){return V(e,"overflowY")},K=function(e){return V(e,"overflowX")},W=function(e,t){var r=t.ownerDocument,n=t;do{if("undefined"!=typeof ShadowRoot&&n instanceof ShadowRoot&&(n=n.host),Z(e,n)){var i=Y(e,n);if(i[1]>i[2])return!0}n=n.parentNode}while(n&&n!==r.body);return!1},Q=function(e){return[e.scrollTop,e.scrollHeight,e.clientHeight]},J=function(e){return[e.scrollLeft,e.scrollWidth,e.clientWidth]},Z=function(e,t){return"v"===e?G(t):K(t)},Y=function(e,t){return"v"===e?Q(t):J(t)},X=function(e,t){return"h"===e&&"rtl"===t?-1:1},ee=function(e,t,r,n,i){var s=X(e,window.getComputedStyle(t).direction),o=s*n,a=r.target,l=t.contains(a),c=!1,u=o>0,d=0,h=0;do{var f=Y(e,a),p=f[0],g=f[1]-f[2]-s*p;(p||g)&&Z(e,a)&&(d+=g,h+=p),a=a instanceof ShadowRoot?a.host:a.parentNode}while(!l&&a!==document.body||l&&(t.contains(a)||t===a));return u&&(i&&1>Math.abs(d)||!i&&o>d)?c=!0:!u&&(i&&1>Math.abs(h)||!i&&-o>h)&&(c=!0),c},et=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},er=function(e){return[e.deltaX,e.deltaY]},en=function(e){return e&&"current"in e?e.current:e},ei=function(e,t){return e[0]===t[0]&&e[1]===t[1]},es=function(e){return"\n  .block-interactivity-".concat(e," {pointer-events: none;}\n  .allow-interactivity-").concat(e," {pointer-events: all;}\n")},eo=0,ea=[];function el(e){for(var t=null;null!==e;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}let ec=x(w,function(e){var t=a.useRef([]),r=a.useRef([0,0]),n=a.useRef(),i=a.useState(eo++)[0],s=a.useState(P)[0],l=a.useRef(e);a.useEffect(function(){l.current=e},[e]),a.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(i));var t=o([e.lockRef.current],(e.shards||[]).map(en),!0).filter(Boolean);return t.forEach(function(e){return e.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),t.forEach(function(e){return e.classList.remove("allow-interactivity-".concat(i))})}}},[e.inert,e.lockRef.current,e.shards]);var c=a.useCallback(function(e,t){if("touches"in e&&2===e.touches.length||"wheel"===e.type&&e.ctrlKey)return!l.current.allowPinchZoom;var i,s=et(e),o=r.current,a="deltaX"in e?e.deltaX:o[0]-s[0],c="deltaY"in e?e.deltaY:o[1]-s[1],u=e.target,d=Math.abs(a)>Math.abs(c)?"h":"v";if("touches"in e&&"h"===d&&"range"===u.type)return!1;var h=W(d,u);if(!h)return!0;if(h?i=d:(i="v"===d?"h":"v",h=W(d,u)),!h)return!1;if(!n.current&&"changedTouches"in e&&(a||c)&&(n.current=i),!i)return!0;var f=n.current||i;return ee(f,t,e,"h"===f?a:c,!0)},[]),u=a.useCallback(function(e){var r=e;if(ea.length&&ea[ea.length-1]===s){var n="deltaY"in r?er(r):et(r),i=t.current.filter(function(e){return e.name===r.type&&(e.target===r.target||r.target===e.shadowParent)&&ei(e.delta,n)})[0];if(i&&i.should){r.cancelable&&r.preventDefault();return}if(!i){var o=(l.current.shards||[]).map(en).filter(Boolean).filter(function(e){return e.contains(r.target)});(o.length>0?c(r,o[0]):!l.current.noIsolation)&&r.cancelable&&r.preventDefault()}}},[]),d=a.useCallback(function(e,r,n,i){var s={name:e,delta:r,target:n,should:i,shadowParent:el(n)};t.current.push(s),setTimeout(function(){t.current=t.current.filter(function(e){return e!==s})},1)},[]),h=a.useCallback(function(e){r.current=et(e),n.current=void 0},[]),f=a.useCallback(function(t){d(t.type,er(t),t.target,c(t,e.lockRef.current))},[]),p=a.useCallback(function(t){d(t.type,et(t),t.target,c(t,e.lockRef.current))},[]);a.useEffect(function(){return ea.push(s),e.setCallbacks({onScrollCapture:f,onWheelCapture:f,onTouchMoveCapture:p}),document.addEventListener("wheel",u,q),document.addEventListener("touchmove",u,q),document.addEventListener("touchstart",h,q),function(){ea=ea.filter(function(e){return e!==s}),document.removeEventListener("wheel",u,q),document.removeEventListener("touchmove",u,q),document.removeEventListener("touchstart",h,q)}},[]);var g=e.removeScrollBar,m=e.inert;return a.createElement(a.Fragment,null,m?a.createElement(s,{styles:es(i)}):null,g?a.createElement(j,{gapMode:e.gapMode}):null)});var eu=a.forwardRef(function(e,t){return a.createElement(E,i({},e,{ref:t,sideCar:ec}))});eu.classNames=E.classNames;let ed=eu},94061:(e,t,r)=>{"use strict";var n=r(39781)(),i=r(91453)("Object.prototype.toString"),s=function(e){return(!n||!e||"object"!=typeof e||!(Symbol.toStringTag in e))&&"[object Arguments]"===i(e)},o=function(e){return!!s(e)||null!==e&&"object"==typeof e&&"length"in e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==i(e)&&"callee"in e&&"[object Function]"===i(e.callee)},a=function(){return s(arguments)}();s.isLegacyArguments=o,e.exports=a?s:o},94858:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;let t={value:e,done:!1};if(this.pullQueue.length){let e=this.pullQueue.shift();e&&e.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),void 0!==this.highWaterMark&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){for(let e of(this.isStopped=!0,this.remove(),this.pullQueue))e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(let t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{let t=Promise.reject(e);t.catch(()=>{}),this.pushQueue.push(t)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{let t=this.pushQueue.shift();return t?(void 0!==this.lowWaterMark&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((e,t)=>{this.pullQueue.push({resolve:e,reject:t})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class n{constructor(e,{highWaterMark:t=100,lowWaterMark:n=1}={}){let i=new r;i.highWaterMark=t,i.lowWaterMark=n,i.removeCallback=e({push:e=>i.push(e),stop:()=>i.stop(),fail:e=>i.fail(e),on:(e,t)=>{i.eventHandlers[e]=t}})||(()=>{}),this[Symbol.asyncIterator]=()=>i[Symbol.asyncIterator](),Object.freeze(this)}}t.EventIterator=n,t.default=n},95120:(e,t,r)=>{var n="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==r.g&&r.g,i=function(){function e(){this.fetch=!1,this.DOMException=n.DOMException}return e.prototype=n,new e}();!function(e){!function(t){var n=void 0!==e&&e||"undefined"!=typeof self&&self||void 0!==r.g&&r.g||{},i={searchParams:"URLSearchParams"in n,iterable:"Symbol"in n&&"iterator"in Symbol,blob:"FileReader"in n&&"Blob"in n&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in n,arrayBuffer:"ArrayBuffer"in n};function s(e){return e&&DataView.prototype.isPrototypeOf(e)}if(i.arrayBuffer)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=ArrayBuffer.isView||function(e){return e&&o.indexOf(Object.prototype.toString.call(e))>-1};function l(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function u(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return i.iterable&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){if(2!=e.length)throw TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function h(e){if(!e._noBody){if(e.bodyUsed)return Promise.reject(TypeError("Already read"));e.bodyUsed=!0}}function f(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function p(e){var t=new FileReader,r=f(t);return t.readAsArrayBuffer(e),r}function g(e){var t=new FileReader,r=f(t),n=/charset=([A-Za-z0-9_-]+)/.exec(e.type),i=n?n[1]:"utf-8";return t.readAsText(e,i),r}function m(e){for(var t=new Uint8Array(e),r=Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(e){this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:i.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:i.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():i.arrayBuffer&&i.blob&&s(e)?(this._bodyArrayBuffer=y(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):i.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||a(e))?this._bodyArrayBuffer=y(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),!this.headers.get("content-type")&&("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):i.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},i.blob&&(this.blob=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(!this._bodyFormData)return Promise.resolve(new Blob([this._bodyText]));throw Error("could not read FormData body as blob")}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=h(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}if(i.blob)return this.blob().then(p);throw Error("could not read as ArrayBuffer")},this.text=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return g(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(m(this._bodyArrayBuffer));if(!this._bodyFormData)return Promise.resolve(this._bodyText);throw Error("could not read FormData body as text")},i.formData&&(this.formData=function(){return this.text().then(A)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(e,t){e=l(e),t=c(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},d.prototype.delete=function(e){delete this.map[l(e)]},d.prototype.get=function(e){return e=l(e),this.has(e)?this.map[e]:null},d.prototype.has=function(e){return this.map.hasOwnProperty(l(e))},d.prototype.set=function(e,t){this.map[l(e)]=c(t)},d.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},d.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),u(e)},d.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),u(e)},d.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),u(e)},i.iterable&&(d.prototype[Symbol.iterator]=d.prototype.entries);var w=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function v(e){var t=e.toUpperCase();return w.indexOf(t)>-1?t:e}function E(e,t){if(!(this instanceof E))throw TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r=(t=t||{}).body;if(e instanceof E){if(e.bodyUsed)throw TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new d(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",(t.headers||!this.headers)&&(this.headers=new d(t.headers)),this.method=v(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal||function(){if("AbortController"in n)return new AbortController().signal}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(r),("GET"===this.method||"HEAD"===this.method)&&("no-store"===t.cache||"no-cache"===t.cache)){var i=/([?&])_=[^&]*/;if(i.test(this.url))this.url=this.url.replace(i,"$1_="+new Date().getTime());else{var s=/\?/;this.url+=(s.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}function A(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}}),t}function x(e){var t=new d;return e.replace(/\r?\n[\t ]+/g," ").split("\r").map(function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e}).forEach(function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();try{t.append(n,i)}catch(e){console.warn("Response "+e.message)}}}),t}function S(e,t){if(!(this instanceof S))throw TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.status<200||this.status>599)throw RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new d(t.headers),this.url=t.url||"",this._initBody(e)}E.prototype.clone=function(){return new E(this,{body:this._bodyInit})},b.call(E.prototype),b.call(S.prototype),S.prototype.clone=function(){return new S(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},S.error=function(){var e=new S(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var k=[301,302,303,307,308];S.redirect=function(e,t){if(-1===k.indexOf(t))throw RangeError("Invalid status code");return new S(null,{status:t,headers:{location:e}})},t.DOMException=n.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function _(e,r){return new Promise(function(s,o){var a=new E(e,r);if(a.signal&&a.signal.aborted)return o(new t.DOMException("Aborted","AbortError"));var u=new XMLHttpRequest;function h(){u.abort()}function f(e){try{return""===e&&n.location.href?n.location.href:e}catch(t){return e}}if(u.onload=function(){var e={statusText:u.statusText,headers:x(u.getAllResponseHeaders()||"")};0===a.url.indexOf("file://")&&(u.status<200||u.status>599)?e.status=200:e.status=u.status,e.url="responseURL"in u?u.responseURL:e.headers.get("X-Request-URL");var t="response"in u?u.response:u.responseText;setTimeout(function(){s(new S(t,e))},0)},u.onerror=function(){setTimeout(function(){o(TypeError("Network request failed"))},0)},u.ontimeout=function(){setTimeout(function(){o(TypeError("Network request timed out"))},0)},u.onabort=function(){setTimeout(function(){o(new t.DOMException("Aborted","AbortError"))},0)},u.open(a.method,f(a.url),!0),"include"===a.credentials?u.withCredentials=!0:"omit"===a.credentials&&(u.withCredentials=!1),"responseType"in u&&(i.blob?u.responseType="blob":i.arrayBuffer&&(u.responseType="arraybuffer")),r&&"object"==typeof r.headers&&!(r.headers instanceof d||n.Headers&&r.headers instanceof n.Headers)){var p=[];Object.getOwnPropertyNames(r.headers).forEach(function(e){p.push(l(e)),u.setRequestHeader(e,c(r.headers[e]))}),a.headers.forEach(function(e,t){-1===p.indexOf(t)&&u.setRequestHeader(t,e)})}else a.headers.forEach(function(e,t){u.setRequestHeader(t,e)});a.signal&&(a.signal.addEventListener("abort",h),u.onreadystatechange=function(){4===u.readyState&&a.signal.removeEventListener("abort",h)}),u.send(void 0===a._bodyInit?null:a._bodyInit)})}_.polyfill=!0,n.fetch||(n.fetch=_,n.Headers=d,n.Request=E,n.Response=S),t.Headers=d,t.Request=E,t.Response=S,t.fetch=_}({})}(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var s=n.fetch?n:i;(t=s.fetch).default=s.fetch,t.fetch=s.fetch,t.Headers=s.Headers,t.Request=s.Request,t.Response=s.Response,e.exports=t},95224:(e,t,r)=>{"use strict";var n=r(91453),i=r(36362),s=n("RegExp.prototype.exec"),o=r(63674);e.exports=function(e){if(!i(e))throw new o("`regex` must be a RegExp");return function(t){return null!==s(e,t)}}},95948:(e,t,r)=>{"use strict";let{AbstractChainedBatch:n}=r(57621),i=r(7800),s=Symbol("encoded");class o extends n{constructor(e){super(e),this[s]=[]}_put(e,t,r){this[s].push({...r,type:"put",key:e,value:t})}_del(e,t){this[s].push({...t,type:"del",key:e})}_clear(){this[s]=[]}_write(e,t){"opening"===this.db.status?this.db.defer(()=>this._write(e,t)):"open"===this.db.status?0===this[s].length?this.nextTick(t):this.db._batch(this[s],e,t):this.nextTick(t,new i("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}}t.DefaultChainedBatch=o},96341:e=>{e.exports="function"==typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e)},97141:(e,t,r)=>{"use strict";r.r(t),r.d(t,{sha256:()=>s,sha512:()=>o});var n=r(65639);function i(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}let s=(0,n.H)({name:"sha2-256",code:18,encode:i("SHA-256")}),o=(0,n.H)({name:"sha2-512",code:19,encode:i("SHA-512")})},97233:(e,t,r)=>{"use strict";t.AbstractLevel=r(71094).AbstractLevel,t.AbstractSublevel=r(71094).AbstractSublevel,t.AbstractIterator=r(39070).AbstractIterator,t.AbstractKeyIterator=r(39070).AbstractKeyIterator,t.AbstractValueIterator=r(39070).AbstractValueIterator,t.AbstractChainedBatch=r(57621).AbstractChainedBatch},97967:(e,t,r)=>{var n=r(49509),i=r(44134).Buffer;let s=r(72016),o=r(71807),a=r(668),l=r(8777),c=r(86589).version,u=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function d(e){console.log(`[dotenv@${c}][WARN] ${e}`)}function h(e){console.log(`[dotenv@${c}][DEBUG] ${e}`)}function f(e){return e&&e.DOTENV_KEY&&e.DOTENV_KEY.length>0?e.DOTENV_KEY:n.env.DOTENV_KEY&&n.env.DOTENV_KEY.length>0?n.env.DOTENV_KEY:""}function p(e,t){let r;try{r=new URL(t)}catch(e){if("ERR_INVALID_URL"===e.code){let e=Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw e.code="INVALID_DOTENV_KEY",e}throw e}let n=r.password;if(!n){let e=Error("INVALID_DOTENV_KEY: Missing key part");throw e.code="INVALID_DOTENV_KEY",e}let i=r.searchParams.get("environment");if(!i){let e=Error("INVALID_DOTENV_KEY: Missing environment part");throw e.code="INVALID_DOTENV_KEY",e}let s=`DOTENV_VAULT_${i.toUpperCase()}`,o=e.parsed[s];if(!o){let e=Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${s} in your .env.vault file.`);throw e.code="NOT_FOUND_DOTENV_ENVIRONMENT",e}return{ciphertext:o,key:n}}function g(e){let t=null;if(e&&e.path&&e.path.length>0)if(Array.isArray(e.path))for(let r of e.path)s.existsSync(r)&&(t=r.endsWith(".vault")?r:`${r}.vault`);else t=e.path.endsWith(".vault")?e.path:`${e.path}.vault`;else t=o.resolve(n.cwd(),".env.vault");return s.existsSync(t)?t:null}function m(e){return"~"===e[0]?o.join(a.homedir(),e.slice(1)):e}let y={configDotenv:function(e){let t,r=o.resolve(n.cwd(),".env"),i="utf8",a=!!(e&&e.debug);e&&e.encoding?i=e.encoding:a&&h("No encoding is specified. UTF-8 is used by default");let l=[r];if(e&&e.path)if(Array.isArray(e.path))for(let t of(l=[],e.path))l.push(m(t));else l=[m(e.path)];let c={};for(let r of l)try{let t=y.parse(s.readFileSync(r,{encoding:i}));y.populate(c,t,e)}catch(e){a&&h(`Failed to load ${r} ${e.message}`),t=e}let u=n.env;return(e&&null!=e.processEnv&&(u=e.processEnv),y.populate(u,c,e),t)?{parsed:c,error:t}:{parsed:c}},_configVault:function(e){e&&e.debug&&h("Loading env from encrypted .env.vault");let t=y._parseVault(e),r=n.env;return e&&null!=e.processEnv&&(r=e.processEnv),y.populate(r,t,e),{parsed:t}},_parseVault:function(e){let t,r=g(e),n=y.configDotenv({path:r});if(!n.parsed){let e=Error(`MISSING_DATA: Cannot parse ${r} for an unknown reason`);throw e.code="MISSING_DATA",e}let i=f(e).split(","),s=i.length;for(let e=0;e<s;e++)try{let r=i[e].trim(),s=p(n,r);t=y.decrypt(s.ciphertext,s.key);break}catch(t){if(e+1>=s)throw t}return y.parse(t)},config:function(e){if(0===f(e).length)return y.configDotenv(e);let t=g(e);return t?y._configVault(e):(d(`You set DOTENV_KEY but you are missing a .env.vault file at ${t}. Did you forget to build it?`),y.configDotenv(e))},decrypt:function(e,t){let r=i.from(t.slice(-64),"hex"),n=i.from(e,"base64"),s=n.subarray(0,12),o=n.subarray(-16);n=n.subarray(12,-16);try{let e=l.createDecipheriv("aes-256-gcm",r,s);return e.setAuthTag(o),`${e.update(n)}${e.final()}`}catch(n){let e=n instanceof RangeError,t="Invalid key length"===n.message,r="Unsupported state or unable to authenticate data"===n.message;if(e||t){let e=Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw e.code="INVALID_DOTENV_KEY",e}if(r){let e=Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw e.code="DECRYPTION_FAILED",e}throw n}},parse:function(e){let t,r={},n=e.toString();for(n=n.replace(/\r\n?/mg,"\n");null!=(t=u.exec(n));){let e=t[1],n=t[2]||"",i=(n=n.trim())[0];n=n.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),'"'===i&&(n=(n=n.replace(/\\n/g,"\n")).replace(/\\r/g,"\r")),r[e]=n}return r},populate:function(e,t,r={}){let n=!!(r&&r.debug),i=!!(r&&r.override);if("object"!=typeof t){let e=Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw e.code="OBJECT_REQUIRED",e}for(let r of Object.keys(t))Object.prototype.hasOwnProperty.call(e,r)?(!0===i&&(e[r]=t[r]),n&&(!0===i?h(`"${r}" is already defined and WAS overwritten`):h(`"${r}" is already defined and was NOT overwritten`))):e[r]=t[r]}};e.exports.configDotenv=y.configDotenv,e.exports._configVault=y._configVault,e.exports._parseVault=y._parseVault,e.exports.config=y.config,e.exports.decrypt=y.decrypt,e.exports.parse=y.parse,e.exports.populate=y.populate,e.exports=y},97968:e=>{"use strict";e.exports=URIError},98897:(e,t,r)=>{"use strict";r.d(t,{DI:()=>a,kR:()=>o,m_:()=>c,c0:()=>n,F9:()=>s});class n extends Error{static name="OpenFailedError";static code="ERR_OPEN_FAILED";name=n.name;code=n.code;constructor(e="Open failed"){super(e)}}class i extends Error{static name="CloseFailedError";static code="ERR_CLOSE_FAILED";name=i.name;code=i.code;constructor(e="Close failed"){super(e)}}class s extends Error{static name="PutFailedError";static code="ERR_PUT_FAILED";name=s.name;code=s.code;constructor(e="Put failed"){super(e)}}class o extends Error{static name="GetFailedError";static code="ERR_GET_FAILED";name=o.name;code=o.code;constructor(e="Get failed"){super(e)}}class a extends Error{static name="DeleteFailedError";static code="ERR_DELETE_FAILED";name=a.name;code=a.code;constructor(e="Delete failed"){super(e)}}class l extends Error{static name="HasFailedError";static code="ERR_HAS_FAILED";name=l.name;code=l.code;constructor(e="Has failed"){super(e)}}class c extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=c.name;code=c.code;constructor(e="Not Found"){super(e)}}class u extends Error{static name="AbortError";static code="ERR_ABORTED";name=u.name;code=u.code;constructor(e="Aborted"){super(e)}}}}]);