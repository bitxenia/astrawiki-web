(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[355],{369:(e,t,r)=>{"use strict";var n=r(62030),i=function(){return!!n};i.hasArrayLengthDefineBug=function(){if(!n)return null;try{return 1!==n([],"length",{value:1}).length}catch(e){return!0}},e.exports=i},668:e=>{var t="/";!function(){"undefined"!=typeof __nccwpck_require__&&(__nccwpck_require__.ab=t+"/");var r={};!function(){var e=r;e.endianness=function(){return"LE"},e.hostname=function(){return"undefined"!=typeof location?location.hostname:""},e.loadavg=function(){return[]},e.uptime=function(){return 0},e.freemem=function(){return Number.MAX_VALUE},e.totalmem=function(){return Number.MAX_VALUE},e.cpus=function(){return[]},e.type=function(){return"Browser"},e.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},e.networkInterfaces=e.getNetworkInterfaces=function(){return{}},e.arch=function(){return"javascript"},e.platform=function(){return"browser"},e.tmpdir=e.tmpDir=function(){return"/tmp"},e.EOL="\n",e.homedir=function(){return"/"}}(),e.exports=r}()},1504:(e,t,r)=>{var n=r(49509),i=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++)r[t[n]]=Object.getOwnPropertyDescriptor(e,t[n]);return r},s=/%[sdj%]/g;t.format=function(e){if(!x(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(c(arguments[r]));return t.join(" ")}for(var r=1,n=arguments,i=n.length,o=String(e).replace(s,function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),a=n[r];r<i;a=n[++r])E(a)||!_(a)?o+=" "+a:o+=" "+c(a);return o},t.deprecate=function(e,r){if(void 0!==n&&!0===n.noDeprecation)return e;if(void 0===n)return function(){return t.deprecate(e,r).apply(this,arguments)};var i=!1;return function(){if(!i){if(n.throwDeprecation)throw Error(r);n.traceDeprecation?console.trace(r):console.error(r),i=!0}return e.apply(this,arguments)}};var o={},a=/^$/;if(n.env.NODE_DEBUG){var l=n.env.NODE_DEBUG;a=RegExp("^"+(l=l.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase())+"$","i")}function c(e,r){var n={seen:[],stylize:h};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),v(r)?n.showHidden=r:r&&t._extend(n,r),S(n.showHidden)&&(n.showHidden=!1),S(n.depth)&&(n.depth=2),S(n.colors)&&(n.colors=!1),S(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=u),f(n,e,n.depth)}function u(e,t){var r=c.styles[t];return r?"\x1b["+c.colors[r][0]+"m"+e+"\x1b["+c.colors[r][1]+"m":e}function h(e,t){return e}function d(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function f(e,r,n){if(e.customInspect&&r&&T(r.inspect)&&r.inspect!==t.inspect&&!(r.constructor&&r.constructor.prototype===r)){var i,s=r.inspect(n,e);return x(s)||(s=f(e,s,n)),s}var o=p(e,r);if(o)return o;var a=Object.keys(r),l=d(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(r)),C(r)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return g(r);if(0===a.length){if(T(r)){var c=r.name?": "+r.name:"";return e.stylize("[Function"+c+"]","special")}if(k(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(I(r))return e.stylize(Date.prototype.toString.call(r),"date");if(C(r))return g(r)}var u="",h=!1,v=["{","}"];if(w(r)&&(h=!0,v=["[","]"]),T(r)&&(u=" [Function"+(r.name?": "+r.name:"")+"]"),k(r)&&(u=" "+RegExp.prototype.toString.call(r)),I(r)&&(u=" "+Date.prototype.toUTCString.call(r)),C(r)&&(u=" "+g(r)),0===a.length&&(!h||0==r.length))return v[0]+u+v[1];if(n<0)if(k(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");else return e.stylize("[Object]","special");return e.seen.push(r),i=h?m(e,r,n,l,a):a.map(function(t){return y(e,r,n,l,t,h)}),e.seen.pop(),b(i,u,v)}function p(e,t){if(S(t))return e.stylize("undefined","undefined");if(x(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return A(t)?e.stylize(""+t,"number"):v(t)?e.stylize(""+t,"boolean"):E(t)?e.stylize("null","null"):void 0}function g(e){return"["+Error.prototype.toString.call(e)+"]"}function m(e,t,r,n,i){for(var s=[],o=0,a=t.length;o<a;++o)D(t,String(o))?s.push(y(e,t,r,n,String(o),!0)):s.push("");return i.forEach(function(i){i.match(/^\d+$/)||s.push(y(e,t,r,n,i,!0))}),s}function y(e,t,r,n,i,s){var o,a,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(a=e.stylize("[Setter]","special")),D(n,i)||(o="["+i+"]"),!a&&(0>e.seen.indexOf(l.value)?(a=E(r)?f(e,l.value,null):f(e,l.value,r-1)).indexOf("\n")>-1&&(a=s?a.split("\n").map(function(e){return"  "+e}).join("\n").slice(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),S(o)){if(s&&i.match(/^\d+$/))return a;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.slice(1,-1),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+a}function b(e,t,r){var n=0;return e.reduce(function(e,t){return n++,t.indexOf("\n")>=0&&n++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function w(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function E(e){return null===e}function A(e){return"number"==typeof e}function x(e){return"string"==typeof e}function S(e){return void 0===e}function k(e){return _(e)&&"[object RegExp]"===P(e)}function _(e){return"object"==typeof e&&null!==e}function I(e){return _(e)&&"[object Date]"===P(e)}function C(e){return _(e)&&("[object Error]"===P(e)||e instanceof Error)}function T(e){return"function"==typeof e}function P(e){return Object.prototype.toString.call(e)}function R(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(!o[e=e.toUpperCase()])if(a.test(e)){var r=n.pid;o[e]=function(){var n=t.format.apply(t,arguments);console.error("%s %d: %s",e,r,n)}}else o[e]=function(){};return o[e]},t.inspect=c,c.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},c.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.types=r(60289),t.isArray=w,t.isBoolean=v,t.isNull=E,t.isNullOrUndefined=function(e){return null==e},t.isNumber=A,t.isString=x,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=S,t.isRegExp=k,t.types.isRegExp=k,t.isObject=_,t.isDate=I,t.types.isDate=I,t.isError=C,t.types.isNativeError=C,t.isFunction=T,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r(9742);var O=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function N(){var e=new Date,t=[R(e.getHours()),R(e.getMinutes()),R(e.getSeconds())].join(":");return[e.getDate(),O[e.getMonth()],t].join(" ")}function D(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",N(),t.format.apply(t,arguments))},t.inherits=r(84115),t._extend=function(e,t){if(!t||!_(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e};var B="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function M(e,t){if(!e){var r=Error("Promise was rejected with a falsy value");r.reason=e,e=r}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw TypeError('The "original" argument must be of type Function');if(B&&e[B]){var t=e[B];if("function"!=typeof t)throw TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,B,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,r,n=new Promise(function(e,n){t=e,r=n}),i=[],s=0;s<arguments.length;s++)i.push(arguments[s]);i.push(function(e,n){e?r(e):t(n)});try{e.apply(this,i)}catch(e){r(e)}return n}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),B&&Object.defineProperty(t,B,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,i(e))},t.promisify.custom=B,t.callbackify=function(e){if("function"!=typeof e)throw TypeError('The "original" argument must be of type Function');function t(){for(var t=[],r=0;r<arguments.length;r++)t.push(arguments[r]);var i=t.pop();if("function"!=typeof i)throw TypeError("The last argument must be of type Function");var s=this,o=function(){return i.apply(s,arguments)};e.apply(this,t).then(function(e){n.nextTick(o.bind(null,null,e))},function(e){n.nextTick(M.bind(null,e,o))})}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.defineProperties(t,i(e)),t}},1707:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});let n=function(e){let[t,r]=null!=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>t.next(),push:e=>{n.push(e)},next:()=>n.length>0?{done:!1,value:n.shift()}:t.next(),[r](){return this}}}},2629:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var n=r(69600),i=r(18593);function s(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}let o=s("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),a=s("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);let t=(0,i.K)(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),l={utf8:o,"utf-8":o,hex:n.Fo.base16,latin1:a,ascii:a,binary:a,...n.Fo}},2821:e=>{"use strict";e.exports=Object},2902:e=>{"use strict";e.exports=Error},3204:(e,t,r)=>{"use strict";r.d(t,{Um:()=>x,vF:()=>S});var n=r(43716),i=r(7796),s=r(53647);let o=1e3,a=6e4,l=36e5,c=864e5,u=6048e5,h=315576e5;function d(e){if((e=String(e)).length>100)throw Error("Value exceeds the maximum length of 100 characters.");let t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return NaN;let r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*h;case"weeks":case"week":case"w":return r*u;case"days":case"day":case"d":return r*c;case"hours":case"hour":case"hrs":case"hr":case"h":return r*l;case"minutes":case"minute":case"mins":case"min":case"m":return r*a;case"seconds":case"second":case"secs":case"sec":case"s":return r*o;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:throw Error(`The unit ${n} was matched, but no matching case exists.`)}}let f=function(e,t){try{if("string"==typeof e&&e.length>0)return d(e);if("number"==typeof e&&isFinite(e))return t?.long?g(e):p(e);throw Error("Value is not a string or number.")}catch(t){throw Error(y(t)?`${t.message}. value=${JSON.stringify(e)}`:"An unknown error has occured.")}};function p(e){let t=Math.abs(e);return t>=c?`${Math.round(e/c)}d`:t>=l?`${Math.round(e/l)}h`:t>=a?`${Math.round(e/a)}m`:t>=o?`${Math.round(e/o)}s`:`${e}ms`}function g(e){let t=Math.abs(e);return t>=c?m(e,t,c,"day"):t>=l?m(e,t,l,"hour"):t>=a?m(e,t,a,"minute"):t>=o?m(e,t,o,"second"):`${e} ms`}function m(e,t,r,n){let i=t>=1.5*r;return`${Math.round(e/r)} ${n}${i?"s":""}`}function y(e){return"object"==typeof e&&null!==e&&"message"in e}function b(e){function t(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){let t,i,s,o=null;function a(...e){if(!a.enabled)return;let n=a,i=Number(new Date);n.diff=i-(t||i),n.prev=t,n.curr=i,t=i,e[0]=r.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(t,i)=>{if("%%"===t)return"%";s++;let o=r.formatters[i];if("function"==typeof o){let r=e[s];t=o.call(n,r),e.splice(s,1),s--}return t}),r.formatArgs.call(n,e),(n.log||r.log).apply(n,e)}return a.namespace=e,a.useColors=r.useColors(),a.color=r.selectColor(e),a.extend=n,a.destroy=r.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==r.namespaces&&(i=r.namespaces,s=r.enabled(e)),s),set:e=>{o=e}}),"function"==typeof r.init&&r.init(a),a}function n(e,t){let n=r(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function i(e){let t;r.save(e),r.namespaces=e,r.names=[],r.skips=[];let n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(RegExp("^"+e.substr(1)+"$")):r.names.push(RegExp("^"+e+"$")))}function s(){let e=[...r.names.map(a),...r.skips.map(a).map(e=>"-"+e)].join(",");return r.enable(""),e}function o(e){let t,n;if("*"===e[e.length-1])return!0;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1}function a(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}function l(e){return e instanceof Error?e.stack??e.message:e}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.debug=r,r.default=r,r.coerce=l,r.disable=s,r.enable=i,r.enabled=o,r.humanize=f,r.destroy=c,Object.keys(e).forEach(t=>{r[t]=e[t]}),r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.setupFormatters(r.formatters),r.enable(r.load()),r}let w=v();function v(){try{return localStorage}catch(e){}}let E=b({formatArgs:function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+f(this.diff),!this.useColors)return;let t="color: "+this.color;e.splice(1,0,t,"color: inherit");let r=0,n=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(n=r))}),e.splice(n,0,t)},save:function(e){try{e?w?.setItem("debug",e):w?.removeItem("debug")}catch(e){}},load:function(){let e;try{e=w?.getItem("debug")}catch(e){}return!e&&void 0!==globalThis.process&&"env"in globalThis.process&&(e=globalThis.process.env.DEBUG),e},useColors:function(){return"undefined"!=typeof window&&!!window.process&&("renderer"===window.process.type||!!window.process.__nwjs)||("undefined"==typeof navigator||navigator.userAgent?.toLowerCase().match(/(edge|trident)\/(\d+)/)==null)&&("undefined"!=typeof document&&document.documentElement?.style?.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent?.toLowerCase().match(/firefox\/(\d+)/)!=null&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent?.toLowerCase().match(/applewebkit\/(\d+)/))},setupFormatters:function(e){e.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},colors:["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],storage:w,log:console.debug??console.log??(()=>{})});function A(e){let t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}E.formatters.b=e=>null==e?"undefined":i.base58btc.baseEncode(e),E.formatters.t=e=>null==e?"undefined":n.base32.baseEncode(e),E.formatters.m=e=>null==e?"undefined":s.base64.baseEncode(e),E.formatters.p=e=>null==e?"undefined":e.toString(),E.formatters.c=e=>null==e?"undefined":e.toString(),E.formatters.k=e=>null==e?"undefined":e.toString(),E.formatters.a=e=>null==e?"undefined":e.toString(),E.formatters.e=e=>null==e?"undefined":k(e.stack)??k(e.message)??e.toString();function x(){return{forComponent:e=>S(e)}}function S(e){let t=A(`${e}:trace`);return E.enabled(`${e}:trace`)&&null!=E.names.map(e=>e.toString()).find(e=>e.includes(":trace"))&&(t=E(`${e}:trace`)),Object.assign(E(e),{error:E(`${e}:error`),trace:t})}function k(e){if(null!=e&&0!==(e=e.trim()).length)return e}},3289:(e,t,r)=>{"use strict";var n=r(52430),i=r(61043),s=r(60261);e.exports=r(92678)||n.call(s,i)},3305:(e,t,r)=>{"use strict";var n=r(41878),i=/[\/\?<>\\:\*\|"]/g,s=/[\x00-\x1f\x80-\x9f]/g,o=/^\.+$/,a=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,l=/[\. ]+$/;function c(e,t){if("string"!=typeof e)throw Error("Input must be string");return n(e.replace(i,t).replace(s,t).replace(o,t).replace(a,t).replace(l,t),255)}e.exports=function(e,t){var r=t&&t.replacement||"",n=c(e,r);return""===r?n:c(n,"")}},3972:(e,t,r)=>{"use strict";r.d(t,{b:()=>o});var n=r(86620),i=r(98897),s=r(54954);class o extends s.f{data;constructor(){super(),this.data=new Map}put(e,t){return this.data.set(e.toString(),t),e}get(e){let t=this.data.get(e.toString());if(null==t)throw new i.m_;return t}has(e){return this.data.has(e.toString())}delete(e){this.data.delete(e.toString())}*_all(){for(let[e,t]of this.data.entries())yield{key:new n.U(e),value:t}}*_allKeys(){for(let e of this.data.keys())yield new n.U(e)}}},4157:(e,t,r)=>{"use strict";function n(e){return null!=e[Symbol.asyncIterator]}r.d(t,{A:()=>i});let i=function(e){if(n(e))return(async()=>{let t=[];for await(let r of e)t.push(r);return t})();let t=[];for(let r of e)t.push(r);return t}},4160:e=>{"use strict";e.exports=function(){return Date.now()}},5729:e=>{"use strict";e.exports=Math.floor},5845:(e,t,r)=>{"use strict";r.d(t,{i:()=>a});var n,i=r(12115),s=r(52712),o=(n||(n=r.t(i,2)))[" useInsertionEffect ".trim().toString()]||s.N;function a({prop:e,defaultProp:t,onChange:r=()=>{},caller:n}){let[s,o,a]=l({defaultProp:t,onChange:r}),u=void 0!==e,h=u?e:s;{let t=i.useRef(void 0!==e);i.useEffect(()=>{let e=t.current;if(e!==u){let t=e?"controlled":"uncontrolled",r=u?"controlled":"uncontrolled";console.warn(`${n} is changing from ${t} to ${r}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`)}t.current=u},[u,n])}return[h,i.useCallback(t=>{if(u){let r=c(t)?t(e):t;r!==e&&a.current?.(r)}else o(t)},[u,e,o,a])]}function l({defaultProp:e,onChange:t}){let[r,n]=i.useState(e),s=i.useRef(r),a=i.useRef(t);return o(()=>{a.current=t},[t]),i.useEffect(()=>{s.current!==r&&(a.current?.(r),s.current=r)},[r,s]),[r,n,a]}function c(e){return"function"==typeof e}Symbol("RADIX:SYNC_STATE")},5955:(e,t,r)=>{"use strict";var n=r(29241),i=Object.prototype.toString,s=Object.prototype.hasOwnProperty,o=function(e,t,r){for(var n=0,i=e.length;n<i;n++)s.call(e,n)&&(null==r?t(e[n],n,e):t.call(r,e[n],n,e))},a=function(e,t,r){for(var n=0,i=e.length;n<i;n++)null==r?t(e.charAt(n),n,e):t.call(r,e.charAt(n),n,e)},l=function(e,t,r){for(var n in e)s.call(e,n)&&(null==r?t(e[n],n,e):t.call(r,e[n],n,e))};function c(e){return"[object Array]"===i.call(e)}e.exports=function(e,t,r){var i;if(!n(t))throw TypeError("iterator must be a function");arguments.length>=3&&(i=r),c(e)?o(e,t,i):"string"==typeof e?a(e,t,i):l(e,t,i)}},6913:e=>{"use strict";e.exports=e=>{if("[object Object]"!==Object.prototype.toString.call(e))return!1;let t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}},7610:(e,t)=>{t.read=function(e,t,r,n,i){var s,o,a=8*i-n-1,l=(1<<a)-1,c=l>>1,u=-7,h=r?i-1:0,d=r?-1:1,f=e[t+h];for(h+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=256*s+e[t+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=n;u>0;o=256*o+e[t+h],h+=d,u-=8);if(0===s)s=1-c;else{if(s===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),s-=c}return(f?-1:1)*o*Math.pow(2,s-n)},t.write=function(e,t,r,n,i,s){var o,a,l,c=8*s-i-1,u=(1<<c)-1,h=u>>1,d=5960464477539062e-23*(23===i),f=n?0:s-1,p=n?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(a=+!!isNaN(t),o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+h>=1?t+=d/l:t+=d*Math.pow(2,1-h),t*l>=2&&(o++,l/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(t*l-1)*Math.pow(2,i),o+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[r+f]=255&a,f+=p,a/=256,i-=8);for(o=o<<i|a,c+=i;c>0;e[r+f]=255&o,f+=p,o/=256,c-=8);e[r+f-p]|=128*g}},7786:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(1707);function i(e){return null!=e[Symbol.asyncIterator]}let s=function(e,t){let r=0;if(i(e))return async function*(){for await(let n of e)yield t(n,r++)}();let s=(0,n.A)(e),{value:o,done:a}=s.next();if(!0===a)return function*(){}();let l=t(o,r++);if("function"==typeof l.then)return async function*(){for await(let e of(yield await l,s))yield t(e,r++)}();let c=t;return function*(){for(let e of(yield l,s))yield c(e,r++)}()}},7796:(e,t,r)=>{"use strict";r.r(t),r.d(t,{base58btc:()=>i,base58flickr:()=>s});var n=r(52215);let i=(0,n._Q)({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),s=(0,n._Q)({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})},7800:e=>{"use strict";e.exports=class extends Error{constructor(e,t){super(e||""),"object"==typeof t&&null!==t&&(t.code&&(this.code=String(t.code)),t.expected&&(this.expected=!0),t.transient&&(this.transient=!0),t.cause&&(this.cause=t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}},8024:(e,t,r)=>{"use strict";var n=r(70508),i=r(59888),s=r(369)(),o=r(81954),a=r(63674),l=n("%Math.floor%");e.exports=function(e,t){if("function"!=typeof e)throw new a("`fn` is not a function");if("number"!=typeof t||t<0||t>0xffffffff||l(t)!==t)throw new a("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],n=!0,c=!0;if("length"in e&&o){var u=o(e,"length");u&&!u.configurable&&(n=!1),u&&!u.writable&&(c=!1)}return(n||c||!r)&&(s?i(e,"length",t,!0,!0):i(e,"length",t)),e}},8419:(e,t,r)=>{"use strict";var n=r(33771),i="undefined"==typeof globalThis?r.g:globalThis;e.exports=function(){for(var e=[],t=0;t<n.length;t++)"function"==typeof i[n[t]]&&(e[e.length]=n[t]);return e}},9166:(e,t,r)=>{"use strict";var n=r(8024),i=r(62030),s=r(85407),o=r(13588);e.exports=function(e){var t=s(arguments),r=e.length-(arguments.length-1);return n(t,1+(r>0?r:0),!0)},i?i(e.exports,"apply",{value:o}):e.exports.apply=o},9742:e=>{e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},10258:(e,t,r)=>{"use strict";r.d(t,{W:()=>i});class n extends Error{type;code;constructor(e,t,r){super(e??"The operation was aborted"),this.type="aborted",this.name=r??"AbortError",this.code=t??"ABORT_ERR"}}async function i(e,t,r){let i;if(null==t)return e;if(t.aborted)return e.catch(()=>{}),Promise.reject(new n(r?.errorMessage,r?.errorCode,r?.errorName));let s=new n(r?.errorMessage,r?.errorCode,r?.errorName);try{return await Promise.race([e,new Promise((e,r)=>{i=()=>{r(s)},t.addEventListener("abort",i)})])}finally{null!=i&&t.removeEventListener("abort",i)}}},10681:(e,t,r)=>{"use strict";var n,i=r(85407),s=r(81954);try{n=[].__proto__===Array.prototype}catch(e){if(!e||"object"!=typeof e||!("code"in e)||"ERR_PROTO_ACCESS"!==e.code)throw e}var o=!!n&&s&&s(Object.prototype,"__proto__"),a=Object,l=a.getPrototypeOf;e.exports=o&&"function"==typeof o.get?i([o.get]):"function"==typeof l&&function(e){return l(null==e?e:a(e))}},12338:(e,t,r)=>{"use strict";let n=r(7800),i=r(86892),{Encoding:s}=r(69503),{BufferFormat:o,ViewFormat:a,UTF8Format:l}=r(22846),c=Symbol("formats"),u=Symbol("encodings"),h=new Set(["buffer","view","utf8"]);class d{constructor(e){if(Array.isArray(e)){if(!e.every(e=>h.has(e)))throw TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw TypeError("The first argument 'formats' must be an array");for(let t in this[u]=new Map,this[c]=new Set(e),i)try{this.encoding(t)}catch(e){if("LEVEL_ENCODING_NOT_SUPPORTED"!==e.code)throw e}}encodings(){return Array.from(new Set(this[u].values()))}encoding(e){let t=this[u].get(e);if(void 0===t){if("string"==typeof e&&""!==e){if(!(t=m[e]))throw new n(`Encoding '${e}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else if("object"!=typeof e||null===e)throw TypeError("First argument 'encoding' must be a string or object");else t=f(e);let{name:r,format:i}=t;if(!this[c].has(i))if(this[c].has("view"))t=t.createViewTranscoder();else if(this[c].has("buffer"))t=t.createBufferTranscoder();else if(this[c].has("utf8"))t=t.createUTF8Transcoder();else throw new n(`Encoding '${r}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(let n of[e,r,t.name,t.commonName])this[u].set(n,t)}return t}}function f(e){if(e instanceof s)return e;let t="type"in e&&"string"==typeof e.type?e.type:void 0,r=e.name||t||`anonymous-${y++}`;switch(p(e)){case"view":return new a({...e,name:r});case"utf8":return new l({...e,name:r});case"buffer":return new o({...e,name:r});default:throw TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function p(e){return"format"in e&&void 0!==e.format?e.format:"buffer"in e&&"boolean"==typeof e.buffer?e.buffer?"buffer":"utf8":"code"in e&&Number.isInteger(e.code)?"view":"buffer"}t.Transcoder=d;let g={binary:i.buffer,"utf-8":i.utf8},m={...i,...g},y=0},12588:e=>{"use strict";function t(e){return e>=55296&&e<=56319}function r(e){return e>=56320&&e<=57343}e.exports=function(e,n,i){if("string"!=typeof n)throw Error("Input must be string");for(var s,o,a=n.length,l=0,c=0;c<a;c+=1){if(s=n.charCodeAt(c),o=n[c],t(s)&&r(n.charCodeAt(c+1))&&(c+=1,o+=n[c]),(l+=e(o))===i)return n.slice(0,c+1);if(l>i)return n.slice(0,c-o.length+1)}return n}},12764:e=>{"use strict";e.exports=EvalError},13080:(e,t,r)=>{"use strict";let n;r.d(t,{y:()=>m});var i=r(17849),s=r(49509);let o="test"==s.env.ETH_ENV?"http://localhost:8545":`https://sepolia.infura.io/v3/${s.env.SEPOLIA_API_KEY}`;if("undefined"!=typeof window&&void 0!==window.ethereum)window.ethereum.request({method:"eth_requestAccounts"}),n=new i.Ay$(window.ethereum);else{let e=new i.Ay$.providers.HttpProvider(o);n=new i.Ay$(e)}let a=n,l=JSON.parse('[{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"articulos","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"titulo","type":"string"},{"internalType":"string[]","name":"contenido","type":"string[]"}],"name":"crearArticulo","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getArticulos","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getTitulos","outputs":[{"internalType":"string[]","name":"","type":"string[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"","type":"string"}],"name":"tituloToAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"titulos","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"}]'),c=JSON.parse('[{"inputs":[{"internalType":"string","name":"_titulo","type":"string"},{"internalType":"string[]","name":"_contenido","type":"string[]"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[{"internalType":"string","name":"_version","type":"string"}],"name":"addContenido","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"contenido","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getContenido","outputs":[{"internalType":"string[]","name":"","type":"string[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string[]","name":"_contenido","type":"string[]"}],"name":"setContenido","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_titulo","type":"string"}],"name":"setTitulo","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"titulo","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"}]'),u="0xc2F3e8C55dF2958483ce4707DF8C469FDBD272B9";var h=r(57116);class d{articleName;versionManager;constructor(e,t){this.articleName=e,this.versionManager=new h.m9(t)}getContent(e){let t=[];return t=e?this.versionManager.getBranch(e):this.versionManager.getMainBranch(),(0,h.a6)(t)}getVersions(){let e=new Set(this.versionManager.getMainBranch().map(e=>e.id));return this.versionManager.getAllVersions().map(t=>({id:t.id,date:t.date,parent:t.parent,mainBranch:e.has(t.id)}))}getCurrentVersionID(){let e=this.versionManager.getMainBranch();if(0===e.length)throw Error("No versions found");return e[e.length-1].id}newContent(e,t){let r;if(t){let n=this.versionManager.getBranch(t),i=(0,h.a6)(n);r=(0,h.JL)(i,e,t)}else r=(0,h.JL)("",e,t??null);return this.versionManager.addVersion(r),r}}class f{factoryInstance;constructor(){this.factoryInstance=new a.eth.Contract(l,u)}async getArticle(e){let t=await this.factoryInstance.methods.tituloToAddress(e).call();if(!t)return Promise.reject("Article not found");let r=new a.eth.Contract(c,t);return new d(e,(await r.methods.getContenido().call()).map(e=>JSON.parse(e)))}async newArticle(e,t){let r=(0,h.JL)("",t),n=await a.eth.getAccounts(),i=[JSON.stringify(r)];await this.factoryInstance.methods.crearArticulo(e,i).send({from:n[0]})}async addVersion(e,t,r){let n=await this.factoryInstance.methods.tituloToAddress(e).call();if(!n)return Promise.reject("Article not found");let i=new a.eth.Contract(c,n),s=(await this.getArticle(e)).newContent(t,r),o=await a.eth.getAccounts();await i.methods.addContenido(JSON.stringify(s)).send({from:o[0]})}async getArticleList(){return this.factoryInstance.methods.getTitulos().call()}}class p{articleRepository;lastVersionFetchedByArticle;versionManager;async start(){this.articleRepository=new f,this.lastVersionFetchedByArticle=new Map}async getArticle(e,t){let r=await this.articleRepository.getArticle(e);return this.lastVersionFetchedByArticle.set(e,r.getCurrentVersionID()),{name:e,content:r.getContent(t),versionsInfo:r.getVersions()}}async newArticle(e,t){await this.articleRepository.newArticle(e,t)}async editArticle(e,t){let r=this.lastVersionFetchedByArticle.get(e);if(!r)throw Error(`Article ${e} was not previously fetched. Fetched articles: ${this.lastVersionFetchedByArticle.keys()}`);await this.articleRepository.addVersion(e,t,r)}async getArticleList(){return this.articleRepository.getArticleList()}async stop(){}async searchArticles(e,t,r){throw Error("Method not implemented.")}}let g=p;async function m(){let e=new g;return await e.start(),e}},13372:e=>{"use strict";e.exports=Object.getOwnPropertyDescriptor},13588:(e,t,r)=>{"use strict";var n=r(52430),i=r(61043),s=r(3289);e.exports=function(){return s(n,i,arguments)}},13623:e=>{"use strict";let t=new TextEncoder;e.exports=function(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):t.encode(e)}},15452:(e,t,r)=>{"use strict";r.d(t,{UC:()=>en,VY:()=>es,ZL:()=>et,bL:()=>X,bm:()=>eo,hE:()=>ei,hJ:()=>er,l9:()=>ee});var n=r(12115),i=r(85185),s=r(6101),o=r(46081),a=r(61285),l=r(5845),c=r(19178),u=r(25519),h=r(34378),d=r(28905),f=r(63655),p=r(92293),g=r(31114),m=r(38168),y=r(99708),b=r(95155),w="Dialog",[v,E]=(0,o.A)(w),[A,x]=v(w),S=e=>{let{__scopeDialog:t,children:r,open:i,defaultOpen:s,onOpenChange:o,modal:c=!0}=e,u=n.useRef(null),h=n.useRef(null),[d,f]=(0,l.i)({prop:i,defaultProp:null!=s&&s,onChange:o,caller:w});return(0,b.jsx)(A,{scope:t,triggerRef:u,contentRef:h,contentId:(0,a.B)(),titleId:(0,a.B)(),descriptionId:(0,a.B)(),open:d,onOpenChange:f,onOpenToggle:n.useCallback(()=>f(e=>!e),[f]),modal:c,children:r})};S.displayName=w;var k="DialogTrigger",_=n.forwardRef((e,t)=>{let{__scopeDialog:r,...n}=e,o=x(k,r),a=(0,s.s)(t,o.triggerRef);return(0,b.jsx)(f.sG.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":K(o.open),...n,ref:a,onClick:(0,i.m)(e.onClick,o.onOpenToggle)})});_.displayName=k;var I="DialogPortal",[C,T]=v(I,{forceMount:void 0}),P=e=>{let{__scopeDialog:t,forceMount:r,children:i,container:s}=e,o=x(I,t);return(0,b.jsx)(C,{scope:t,forceMount:r,children:n.Children.map(i,e=>(0,b.jsx)(d.C,{present:r||o.open,children:(0,b.jsx)(h.Z,{asChild:!0,container:s,children:e})}))})};P.displayName=I;var R="DialogOverlay",O=n.forwardRef((e,t)=>{let r=T(R,e.__scopeDialog),{forceMount:n=r.forceMount,...i}=e,s=x(R,e.__scopeDialog);return s.modal?(0,b.jsx)(d.C,{present:n||s.open,children:(0,b.jsx)(D,{...i,ref:t})}):null});O.displayName=R;var N=(0,y.TL)("DialogOverlay.RemoveScroll"),D=n.forwardRef((e,t)=>{let{__scopeDialog:r,...n}=e,i=x(R,r);return(0,b.jsx)(g.A,{as:N,allowPinchZoom:!0,shards:[i.contentRef],children:(0,b.jsx)(f.sG.div,{"data-state":K(i.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),B="DialogContent",M=n.forwardRef((e,t)=>{let r=T(B,e.__scopeDialog),{forceMount:n=r.forceMount,...i}=e,s=x(B,e.__scopeDialog);return(0,b.jsx)(d.C,{present:n||s.open,children:s.modal?(0,b.jsx)(L,{...i,ref:t}):(0,b.jsx)(F,{...i,ref:t})})});M.displayName=B;var L=n.forwardRef((e,t)=>{let r=x(B,e.__scopeDialog),o=n.useRef(null),a=(0,s.s)(t,r.contentRef,o);return n.useEffect(()=>{let e=o.current;if(e)return(0,m.Eq)(e)},[]),(0,b.jsx)(U,{...e,ref:a,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,i.m)(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),null==(t=r.triggerRef.current)||t.focus()}),onPointerDownOutside:(0,i.m)(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,r=0===t.button&&!0===t.ctrlKey;(2===t.button||r)&&e.preventDefault()}),onFocusOutside:(0,i.m)(e.onFocusOutside,e=>e.preventDefault())})}),F=n.forwardRef((e,t)=>{let r=x(B,e.__scopeDialog),i=n.useRef(!1),s=n.useRef(!1);return(0,b.jsx)(U,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var n,o;null==(n=e.onCloseAutoFocus)||n.call(e,t),t.defaultPrevented||(i.current||null==(o=r.triggerRef.current)||o.focus(),t.preventDefault()),i.current=!1,s.current=!1},onInteractOutside:t=>{var n,o;null==(n=e.onInteractOutside)||n.call(e,t),t.defaultPrevented||(i.current=!0,"pointerdown"===t.detail.originalEvent.type&&(s.current=!0));let a=t.target;(null==(o=r.triggerRef.current)?void 0:o.contains(a))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&s.current&&t.preventDefault()}})}),U=n.forwardRef((e,t)=>{let{__scopeDialog:r,trapFocus:i,onOpenAutoFocus:o,onCloseAutoFocus:a,...l}=e,h=x(B,r),d=n.useRef(null),f=(0,s.s)(t,d);return(0,p.Oh)(),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(u.n,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:o,onUnmountAutoFocus:a,children:(0,b.jsx)(c.qW,{role:"dialog",id:h.contentId,"aria-describedby":h.descriptionId,"aria-labelledby":h.titleId,"data-state":K(h.open),...l,ref:f,onDismiss:()=>h.onOpenChange(!1)})}),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(J,{titleId:h.titleId}),(0,b.jsx)(Y,{contentRef:d,descriptionId:h.descriptionId})]})]})}),j="DialogTitle",$=n.forwardRef((e,t)=>{let{__scopeDialog:r,...n}=e,i=x(j,r);return(0,b.jsx)(f.sG.h2,{id:i.titleId,...n,ref:t})});$.displayName=j;var H="DialogDescription",q=n.forwardRef((e,t)=>{let{__scopeDialog:r,...n}=e,i=x(H,r);return(0,b.jsx)(f.sG.p,{id:i.descriptionId,...n,ref:t})});q.displayName=H;var z="DialogClose",V=n.forwardRef((e,t)=>{let{__scopeDialog:r,...n}=e,s=x(z,r);return(0,b.jsx)(f.sG.button,{type:"button",...n,ref:t,onClick:(0,i.m)(e.onClick,()=>s.onOpenChange(!1))})});function K(e){return e?"open":"closed"}V.displayName=z;var G="DialogTitleWarning",[W,Q]=(0,o.q)(G,{contentName:B,titleName:j,docsSlug:"dialog"}),J=e=>{let{titleId:t}=e,r=Q(G),i="`".concat(r.contentName,"` requires a `").concat(r.titleName,"` for the component to be accessible for screen reader users.\n\nIf you want to hide the `").concat(r.titleName,"`, you can wrap it with our VisuallyHidden component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/").concat(r.docsSlug);return n.useEffect(()=>{t&&(document.getElementById(t)||console.error(i))},[i,t]),null},Z="DialogDescriptionWarning",Y=e=>{let{contentRef:t,descriptionId:r}=e,i=Q(Z),s="Warning: Missing `Description` or `aria-describedby={undefined}` for {".concat(i.contentName,"}.");return n.useEffect(()=>{var e;let n=null==(e=t.current)?void 0:e.getAttribute("aria-describedby");r&&n&&(document.getElementById(r)||console.warn(s))},[s,t,r]),null},X=S,ee=_,et=P,er=O,en=M,ei=$,es=q,eo=V},15484:(e,t,r)=>{"use strict";r.d(t,{A:()=>i,b:()=>n});var n=r(82661);let i=n},16121:(e,t,r)=>{"use strict";r.d(t,{TO:()=>i.TO,br:()=>s,ee:()=>n});var n=r(70834),i=r(69685),s=r(87704);r(65639),r(41394)},17001:(e,t,r)=>{"use strict";var n,i=r(91453),s=r(95224)(/^\s*(?:function)?\*/),o=r(39781)(),a=r(21589),l=i("Object.prototype.toString"),c=i("Function.prototype.toString"),u=function(){if(!o)return!1;try{return Function("return function*() {}")()}catch(e){}};e.exports=function(e){if("function"!=typeof e)return!1;if(s(c(e)))return!0;if(!o)return"[object GeneratorFunction]"===l(e);if(!a)return!1;if(void 0===n){var t=u();n=!!t&&a(t)}return a(e)===n}},17849:(e,t,r)=>{"use strict";let n,i,s,o,a,l,c,u,h,d,f,p,g,m,y,b,w,v;r.d(t,{Ay$:()=>wO});var E,A,x,S,k,_,I,C,T,P,R,O,N,D,B,M,L,F,U,j,$,H,q,z,V,K={};r.r(K),r.d(K,{abiSchemaToJsonSchema:()=>oq,codePointToInt:()=>oG,ensureIfUint8Array:()=>o1,ethAbiToJsonSchema:()=>oz,fetchArrayElement:()=>oV,hexToNumber:()=>oW,hexToUint8Array:()=>o0,numberToHex:()=>oQ,padLeft:()=>oJ,parseBaseType:()=>o$,transformJsonDataToAbiFormat:()=>oK,uint8ArrayToHexString:()=>oZ});var G={};r.r(G),r.d(G,{isBatchRequest:()=>lX,isBatchResponse:()=>lQ,isResponseRpcError:()=>lH,isResponseWithError:()=>lz,isResponseWithNotification:()=>lV,isResponseWithResult:()=>lq,isSubscriptionResult:()=>lK,isValidResponse:()=>lW,setRequestIdStart:()=>lJ,toBatchPayload:()=>lY,toPayload:()=>lZ,validateResponse:()=>lG});var W={};r.r(W),r.d(W,{ChunkResponseParser:()=>l2,Eip1193Provider:()=>l4,EventEmitter:()=>aY,SocketProvider:()=>l7,Web3DeferredPromise:()=>l1,asciiToHex:()=>aj,bytesToHex:()=>a_,bytesToUint8Array:()=>aS,checkAddressCheckSum:()=>a1,compareBlockNumbers:()=>a9,convert:()=>lg,convertScalarValue:()=>lf,encodePacked:()=>lI,ethUnitMap:()=>aA,format:()=>lm,fromAscii:()=>a$,fromDecimal:()=>aR,fromTwosComplement:()=>lc,fromUtf8:()=>aD,fromWei:()=>aG,getStorageSlotNumForLongString:()=>lP,hexToAscii:()=>aH,hexToBytes:()=>aI,hexToNumber:()=>aC,hexToNumberString:()=>aO,hexToString:()=>aU,hexToUtf8:()=>aM,isAddress:()=>a2,isBatchRequest:()=>lX,isBatchResponse:()=>lQ,isBloom:()=>a3,isContractAddressInBloom:()=>a6,isContractInitOptions:()=>le,isDataFormat:()=>lh,isHex:()=>a0,isHexStrict:()=>aX,isInBloom:()=>a4,isNullish:()=>lt,isPromise:()=>lB,isResponseRpcError:()=>lH,isResponseWithError:()=>lz,isResponseWithNotification:()=>lV,isResponseWithResult:()=>lq,isSubscriptionResult:()=>lK,isTopic:()=>a8,isTopicInBloom:()=>a7,isUint8Array:()=>aw,isUserEthereumAddressInBloom:()=>a5,isValidResponse:()=>lW,jsonRpc:()=>G,keccak256:()=>lb,keccak256Wrapper:()=>lb,leftPad:()=>la,mergeDeep:()=>ln,numberToHex:()=>aP,padLeft:()=>li,padRight:()=>ls,pollTillDefined:()=>lF,pollTillDefinedAndReturnIntervalId:()=>lL,processSolidityEncodePackedArgs:()=>l_,randomBytes:()=>lO,randomHex:()=>lN,rejectIfConditionAtInterval:()=>lj,rejectIfTimeout:()=>lU,rightPad:()=>lo,setRequestIdStart:()=>lJ,sha3:()=>lw,sha3Raw:()=>lv,soliditySha3:()=>lC,soliditySha3Raw:()=>lT,stringToHex:()=>aB,toAscii:()=>aq,toBatchPayload:()=>lY,toBigInt:()=>aK,toBool:()=>aJ,toChecksumAddress:()=>aQ,toDecimal:()=>aT,toHex:()=>az,toNumber:()=>aV,toPayload:()=>lZ,toTwosComplement:()=>ll,toUtf8:()=>aL,toWei:()=>aW,uint8ArrayConcat:()=>av,uint8ArrayEquals:()=>aE,utf8ToBytes:()=>aF,utf8ToHex:()=>aN,uuidV4:()=>l$,validateResponse:()=>lG,waitWithTimeout:()=>lM});var Q={};r.r(Q),r.d(Q,{DO:()=>c5,OG:()=>ul,My:()=>c8,Ph:()=>ur,lX:()=>un,Id:()=>ua,fg:()=>uh,qj:()=>uo,aT:()=>ut,aY:()=>c4,lq:()=>ui,z:()=>us,Q5:()=>uf});var J={};r.r(J),r.d(J,{secp256k1:()=>u8}),function(e){e.NUMBER="NUMBER_NUMBER",e.HEX="NUMBER_HEX",e.STR="NUMBER_STR",e.BIGINT="NUMBER_BIGINT"}(E||(E={})),function(e){e.HEX="BYTES_HEX",e.UINT8ARRAY="BYTES_UINT8ARRAY"}(A||(A={}));let Z={number:E.BIGINT,bytes:A.HEX},Y={number:E.HEX,bytes:A.HEX};!function(e){e.EARLIEST="earliest",e.LATEST="latest",e.PENDING="pending",e.SAFE="safe",e.FINALIZED="finalized",e.COMMITTED="committed"}(x||(x={})),function(e){e.chainstart="chainstart",e.frontier="frontier",e.homestead="homestead",e.dao="dao",e.tangerineWhistle="tangerineWhistle",e.spuriousDragon="spuriousDragon",e.byzantium="byzantium",e.constantinople="constantinople",e.petersburg="petersburg",e.istanbul="istanbul",e.muirGlacier="muirGlacier",e.berlin="berlin",e.london="london",e.altair="altair",e.arrowGlacier="arrowGlacier",e.grayGlacier="grayGlacier",e.bellatrix="bellatrix",e.merge="merge",e.capella="capella",e.shanghai="shanghai"}(S||(S={}));let X=Object.getPrototypeOf(Uint8Array);var ee=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let et=Symbol.for("web3/base-provider");class er{static isWeb3Provider(e){return e instanceof er||!!(e&&e[et])}get[et](){return!0}send(e,t){this.request(e).then(e=>{t(null,e)}).catch(e=>{t(e)})}sendAsync(e){return ee(this,void 0,void 0,function*(){return this.request(e)})}asEIP1193Provider(){let e=Object.create(this),t=e.request;return e.request=function(e){return ee(this,void 0,void 0,function*(){return(yield t(e)).result})},e.asEIP1193Provider=void 0,e}}class en extends Array{constructor(e){super(),this._accountProvider=e}}let ei=100,es=101,eo=201,ea=202,el=203,ec=204,eu=205,eh=206,ed=207,ef=208,ep=300,eg=301,em=310,ey=311,eb=400,ew=402,ev=405,eE=407,eA=408,ex=410,eS=411,ek=412,e_=413,eI=414,eC=415,eT=416,eP=417,eR=418,eO=419,eN=420,eD=421,eB=422,eM=423,eL=424,eF=425,eU=426,ej=427,e$=428,eH=429,eq=430,ez=431,eV=432,eK=433,eG=434,eW=435,eQ=436,eJ=437,eZ=438,eY=439,eX=440,e0=441,e1=500,e2=503,e3=505,e4=506,e5=507,e6=600,e8=602,e7=603,e9=604,te=701,tt=702,tr=703,tn=704,ti=705,ts=706,to=707,ta=709,tl=801,tc=802,tu=4001,th=4100,td=4200,tf=4900,tp=4901,tg=902,tm=903,ty=1001,tb=1002,tw=1003,tv=1004,tE=1005,tA=1006,tx=1008,tS=1009,tk=1010,t_=1011,tI=1012,tC=1014,tT=1015,tP=1100,tR=1101,tO=1200,tN=-32700,tD=-32600,tB=-32601,tM=-32602,tL=-32603,tF=-32e3,tU=-32001,tj=-32002,t$=-32003,tH=-32004,tq=-32005,tz=-32006;class tV extends Error{get innerError(){return this.cause instanceof tK?this.cause.errors:this.cause}set innerError(e){Array.isArray(e)?this.cause=new tK(e):this.cause=e}constructor(e,t){super(e),Array.isArray(t)?this.cause=new tK(t):this.cause=t,this.name=this.constructor.name,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(new.target.constructor):this.stack=Error().stack}static convertToString(e,t=!1){if(null==e)return"undefined";let r=JSON.stringify(e,(e,t)=>"bigint"==typeof t?t.toString():t);return t&&["bigint","string"].includes(typeof e)?r.replace(/['\\"]+/g,""):r}toJSON(){return{name:this.name,code:this.code,message:this.message,cause:this.cause,innerError:this.cause}}}class tK extends tV{constructor(e){super(`Multiple errors occurred: [${e.map(e=>e.message).join("], [")}]`),this.code=ef,this.errors=e}}class tG extends tV{constructor(e,t){super(`Invalid value given "${tV.convertToString(e,!0)}". Error: ${t}.`),this.name=this.constructor.name}}class tW extends tV{constructor(){super("Private key must be 32 bytes."),this.code=te}}class tQ extends tV{constructor(){super("Invalid Private Key, Not a valid string or uint8Array"),this.code=tt}}class tJ extends tV{constructor(e){super(`"${e}"`),this.code=tc}}class tZ extends tV{constructor(){super("Invalid key derivation function"),this.code=tr}}class tY extends tV{constructor(){super("Key derivation failed - possibly wrong password"),this.code=tn}}class tX extends tV{constructor(){super("Unsupported key store version"),this.code=ti}}class t0 extends tV{constructor(){super("Password cannot be empty"),this.code=ts}}class t1 extends tV{constructor(){super("Initialization vector must be 16 bytes"),this.code=to}}class t2 extends tV{constructor(){super("c > 1000, pbkdf2 is less secure with less iterations"),this.code=ta}}class t3 extends tV{constructor(e,t){super(e),this.code=e1,t&&(this.errorCode=t.code,this.errorReason=t.reason)}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{errorCode:this.errorCode,errorReason:this.errorReason})}}class t4 extends t3{constructor(e){super("Connection not open",e),this.code=e2}}class t5 extends t3{constructor(e){super(`Maximum number of reconnect attempts reached! (${e})`),this.code=e3}}class t6 extends t3{constructor(){super("CONNECTION ERROR: Provider started to reconnect before the response got received!"),this.code=e4}}class t8 extends t3{constructor(e){super(`Request already sent with following id: ${e}`),this.code=e5}}class t7 extends tV{constructor(e,t){super(e),this.code=ep,this.receipt=t}}class t9 extends tV{constructor(e,t){super(`The resolver at ${e} does not implement requested method: "${t}".`),this.address=e,this.name=t,this.code=eg}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{address:this.address,name:this.name})}}class re extends t7{constructor(e){if(super(e.message||"Error"),this.name="name"in e&&e.name||this.constructor.name,this.stack="stack"in e&&e.stack||void 0,this.code=e.code,"object"==typeof e.data){let t;t=e.data&&"originalError"in e.data?e.data.originalError:e.data,this.data=t.data,this.cause=new re(t)}else this.data=e.data}setDecodedProperties(e,t,r){this.errorName=e,this.errorSignature=t,this.errorArgs=r}toJSON(){let e=Object.assign(Object.assign({},super.toJSON()),{data:this.data});return this.errorName&&(e=Object.assign(Object.assign({},e),{errorName:this.errorName,errorSignature:this.errorSignature,errorArgs:this.errorArgs})),e}}class rt extends t7{constructor(e){super("Error happened while trying to execute a function inside a smart contract"),this.code=em,this.cause=new re(e)}}class rr extends tG{constructor(e){var t,r;super(`data: ${null!=(t=e.data)?t:"undefined"}, input: ${null!=(r=e.input)?r:"undefined"}`,'You can\'t have "data" and "input" as properties of a contract at the same time, please use either "data" or "input" instead.'),this.code=ey}}class rn extends tV{constructor(e){super(`ENS is not supported on network ${e}`),this.code=tg}}class ri extends tV{constructor(){super("Network not synced"),this.code=tm}}class rs extends tV{constructor(e){super(`Invalid parameters passed. "${void 0!==e?e:""}"`),this.hint=e,this.code=ed}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{hint:this.hint})}}class ro extends tV{constructor(){super(...arguments),this.code=eo}}class ra extends tV{constructor(){super("The method you're trying to call is not implemented."),this.code=ea}}class rl extends tV{constructor(){super(...arguments),this.code=el}}class rc extends tV{constructor(){super(...arguments),this.code=ec}}class ru extends tV{constructor(e,t){super(e),this.code=eu,this.props=null!=t?t:{}}}class rh extends tV{constructor(e){super(`A plugin with the namespace: ${e} has already been registered.`),this.code=eh}}class rd extends tV{constructor(){super(...arguments),this.code=e6}}class rf extends tV{constructor(e){super(`Client URL "${e}" is invalid.`),this.code=e8}}class rp extends tV{constructor(){super(...arguments),this.code=e7}}class rg extends tV{constructor(){super(...arguments),this.code=e9}}class rm extends tG{constructor(){super(...arguments),this.code=tl}}class ry extends tV{constructor(e,t){super(e),this.receipt=t,this.code=eb}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{receipt:this.receipt})}}class rb extends tV{constructor(e,t,r,n){super(`Transaction has been reverted by the EVM${void 0===r?"":`:
 ${tV.convertToString(r)}`}`),this.reason=e,this.signature=t,this.receipt=r,this.data=n,this.code=ew}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{reason:this.reason,signature:this.signature,receipt:this.receipt,data:this.data})}}class rw extends rb{constructor(e,t,r,n,i,s,o){super(e),this.reason=e,this.customErrorName=t,this.customErrorDecodedSignature=r,this.customErrorArguments=n,this.signature=i,this.receipt=s,this.data=o,this.code=eZ}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{reason:this.reason,customErrorName:this.customErrorName,customErrorDecodedSignature:this.customErrorDecodedSignature,customErrorArguments:this.customErrorArguments,signature:this.signature,receipt:this.receipt,data:this.data})}}class rv extends ry{constructor(e){super(`Transaction has been reverted by the EVM${void 0===e?"":`:
 ${tV.convertToString(e)}`}`,e),this.code=ev}}class rE extends ry{constructor(){super("Raw transaction undefined"),this.code=eE}}class rA extends ry{constructor(){super("Transaction not found"),this.code=eq}}class rx extends tG{constructor(e){super(e,"invalid transaction with invalid sender"),this.code=eA}}class rS extends tG{constructor(e){super(e,"invalid transaction with invalid receiver"),this.code=eJ}}class rk extends tG{constructor(){super("MissingCustomChainError","If tx.common is provided it must have tx.common.customChain"),this.code=ex}}class r_ extends tG{constructor(){super("MissingCustomChainIdError","If tx.common is provided it must have tx.common.customChain and tx.common.customChain.chainId"),this.code=eS}}class rI extends tG{constructor(e){super(JSON.stringify(e),"Chain Id doesnt match in tx.chainId tx.common.customChain.chainId"),this.code=ek}}class rC extends tG{constructor(e){super(JSON.stringify(e),"Chain doesnt match in tx.chain tx.common.basechain"),this.code=eW}}class rT extends tG{constructor(e){super(JSON.stringify(e),"hardfork doesnt match in tx.hardfork tx.common.hardfork"),this.code=eQ}}class rP extends tG{constructor(){super("CommonOrChainAndHardforkError","Please provide the common object or the chain and hardfork property but not all together."),this.code=e_}}class rR extends tG{constructor(e){var t,r;super("MissingChainOrHardforkError",`When specifying chain and hardfork, both values must be defined. Received "chain": ${null!=(t=e.chain)?t:"undefined"}, "hardfork": ${null!=(r=e.hardfork)?r:"undefined"}`),this.code=eI}}class rO extends tV{constructor(){super('Missing properties in transaction, either define "gas" and "gasPrice" for type 0 transactions or "gas", "maxPriorityFeePerGas" and "maxFeePerGas" for type 2 transactions'),this.code=eX}}class rN extends tG{constructor(e){var t,r,n,i;super(`gas: ${null!=(t=e.gas)?t:"undefined"}, gasPrice: ${null!=(r=e.gasPrice)?r:"undefined"}, maxPriorityFeePerGas: ${null!=(n=e.maxPriorityFeePerGas)?n:"undefined"}, maxFeePerGas: ${null!=(i=e.maxFeePerGas)?i:"undefined"}`,'"gas" is missing'),this.code=eC,this.cause=new rO}}class rD extends tV{constructor(){super('Missing properties in transaction, either define "gas" and "gasPrice" for type 0 transactions or "gas", "maxPriorityFeePerGas" and "maxFeePerGas" for type 2 transactions, not both'),this.code=e0}}class rB extends tG{constructor(e){var t,r,n,i;super(`gas: ${null!=(t=e.gas)?t:"undefined"}, gasPrice: ${null!=(r=e.gasPrice)?r:"undefined"}, maxPriorityFeePerGas: ${null!=(n=e.maxPriorityFeePerGas)?n:"undefined"}, maxFeePerGas: ${null!=(i=e.maxFeePerGas)?i:"undefined"}`,"transaction must specify legacy or fee market gas properties, not both"),this.code=eG,this.cause=new rD}}class rM extends tG{constructor(e){var t,r;super(`gas: ${null!=(t=e.gas)?t:"undefined"}, gasPrice: ${null!=(r=e.gasPrice)?r:"undefined"}`,"Gas or gasPrice is lower than 0"),this.code=eT}}class rL extends tG{constructor(e){var t,r;super(`maxPriorityFeePerGas: ${null!=(t=e.maxPriorityFeePerGas)?t:"undefined"}, maxFeePerGas: ${null!=(r=e.maxFeePerGas)?r:"undefined"}`,"maxPriorityFeePerGas or maxFeePerGas is lower than 0"),this.code=eP}}class rF extends tG{constructor(e){super(e,"eip-1559 transactions don't support gasPrice"),this.code=eR}}class rU extends tG{constructor(e){var t,r;super(`maxPriorityFeePerGas: ${null!=(t=e.maxPriorityFeePerGas)?t:"undefined"}, maxFeePerGas: ${null!=(r=e.maxFeePerGas)?r:"undefined"}`,"pre-eip-1559 transaction don't support maxFeePerGas/maxPriorityFeePerGas"),this.code=eO}}class rj extends tG{constructor(e){super(e,"invalid transaction object"),this.code=eN}}class r$ extends tG{constructor(e){var t,r;super(`nonce: ${null!=(t=e.nonce)?t:"undefined"}, chainId: ${null!=(r=e.chainId)?r:"undefined"}`,"Nonce or chainId is lower than 0"),this.code=eD}}class rH extends tG{constructor(){super("UnableToPopulateNonceError","unable to populate nonce, no from address available"),this.code=eB}}class rq extends tG{constructor(){super("Eip1559NotSupportedError","Network doesn't support eip-1559"),this.code=eM}}class rz extends tG{constructor(e){super(e,"unsupported transaction type"),this.code=eL}}class rV extends tG{constructor(e){var t,r;super(`data: ${null!=(t=e.data)?t:"undefined"}, input: ${null!=(r=e.input)?r:"undefined"}`,'You can\'t have "data" and "input" as properties of transactions at the same time, please use either "data" or "input" instead.'),this.code=eF}}class rK extends tV{constructor(e){super(`The connected Ethereum Node did not respond within ${e.numberOfSeconds} seconds, please make sure your transaction was properly sent and you are connected to a healthy Node. Be aware that transaction might still be pending or mined!
	Transaction Hash: ${e.transactionHash?e.transactionHash.toString():"not available"}`),this.code=ez}}function rG(e){return`Please make sure your transaction was properly sent and there are no previous pending transaction for the same account. However, be aware that it might still be mined!
	Transaction Hash: ${e?e.toString():"not available"}`}class rW extends tV{constructor(e){super(`Transaction was not mined within ${e.numberOfSeconds} seconds. ${rG(e.transactionHash)}`),this.code=eU}}class rQ extends tV{constructor(e){super(`Transaction started at ${e.starterBlockNumber} but was not mined within ${e.numberOfBlocks} blocks. ${rG(e.transactionHash)}`),this.code=eV}}class rJ extends tG{constructor(e){var t,r;super(`receipt: ${JSON.stringify(e.receipt)}, blockHash: ${null==(t=e.blockHash)?void 0:t.toString()}, transactionHash: ${null==(r=e.transactionHash)?void 0:r.toString()}`,"Receipt missing or blockHash null"),this.code=ej}}class rZ extends tG{constructor(e){super(`receipt: ${JSON.stringify(e.receipt)}`,"Receipt missing block number"),this.code=e$}}class rY extends tV{constructor(e){super(`Invalid signature. "${e}"`),this.code=eK}}class rX extends tG{constructor(){super("LocalWalletNotAvailableError","Attempted to index account in local wallet, but no wallet is available"),this.code=eH}}class r0 extends tV{constructor(e,t){let r=[];e.forEach(e=>r.push(e.keyword)),super(`The following properties are invalid for the transaction type ${t}: ${r.join(", ")}`),this.code=eY}}class r1 extends tG{constructor(e){super(e,"can not parse as byte data"),this.code=tb}}class r2 extends tG{constructor(e){super(e,"can not parse as number data"),this.code=tw}}class r3 extends tG{constructor(e){super(e,"invalid ethereum address"),this.code=tE}}class r4 extends tG{constructor(e){super(e,"not a valid string"),this.code=ty}}class r5 extends tG{constructor(e){super(e,"invalid unit"),this.code=tv}}class r6 extends tG{constructor(e){super(e,"not a valid unit. Must be a positive integer"),this.code=tT}}class r8 extends tG{constructor(e){super(e,"can not be converted to hex"),this.code=tA}}class r7 extends tG{constructor(e){super(e,"value greater than the nibble width"),this.code=tC}}class r9 extends tG{constructor(e){super(e,"not a valid boolean."),this.code=tx}}class ne extends tG{constructor(e){super(e,"not a valid unsigned integer."),this.code=tS}}class nt extends tG{constructor(e){super(e,"invalid size given."),this.code=tk}}class nr extends tG{constructor(e){super(e,"value is larger than size."),this.code=t_}}class nn extends tG{constructor(e){super(e,"invalid string given"),this.code=tI}}let ni=e=>!Array.isArray(e)&&"2.0"===e.jsonrpc&&!!e&&(void 0===e.result||null===e.result)&&"error"in e&&("number"==typeof e.id||"string"==typeof e.id),ns=e=>ni(e)?e.error.message:"";class no extends tV{constructor(e,t,r,n){var i;let s;super(null!=t?t:`Returned error: ${Array.isArray(e)?e.map(e=>ns(e)).join(","):ns(e)}`),this.code=ei,t||(this.data=Array.isArray(e)?e.map(e=>{var t;return null==(t=e.error)?void 0:t.data}):null==(i=null==e?void 0:e.error)?void 0:i.data),this.statusCode=n,this.request=r,"error"in e?s=e.error:e instanceof Array&&(s=e.filter(e=>e.error).map(e=>e.error)),Array.isArray(s)&&s.length>0?this.cause=new tK(s):this.cause=s}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{data:this.data,request:this.request,statusCode:this.statusCode})}}class na extends no{constructor(e,t){let r;super(e,void 0,t),this.code=es,"error"in e?r=e.error:e instanceof Array&&(r=e.map(e=>e.error)),Array.isArray(r)?this.cause=new tK(r):this.cause=r}}class nl extends tV{constructor(e,t){super(`Web3Config hardfork doesnt match in defaultHardfork ${e} and common.hardfork ${t}`),this.code=tR}}class nc extends tV{constructor(e,t){super(`Web3Config chain doesnt match in defaultHardfork ${e} and common.hardfork ${t}`),this.code=tR}}let nu="An Rpc error has occured with a code of *code*",nh={[tN]:{message:"Parse error",description:"Invalid JSON"},[tD]:{message:"Invalid request",description:"JSON is not a valid request object	"},[tB]:{message:"Method not found",description:"Method does not exist	"},[tM]:{message:"Invalid params",description:"Invalid method parameters"},[tL]:{message:"Internal error",description:"Internal JSON-RPC error"},[tF]:{message:"Invalid input",description:"Missing or invalid parameters"},[tU]:{message:"Resource not found",description:"Requested resource not found"},[tj]:{message:"Resource unavailable",description:"Requested resource not available"},[t$]:{message:"Transaction rejected",description:"Transaction creation failed"},[tH]:{message:"Method not supported",description:"Method is not implemented"},[tq]:{message:"Limit exceeded",description:"Request exceeds defined limit"},[tz]:{message:"JSON-RPC version not supported",description:"Version of JSON-RPC protocol is not supported"},[tu]:{name:"User Rejected Request",message:"The user rejected the request."},[th]:{name:"Unauthorized",message:"The requested method and/or account has not been authorized by the user."},[td]:{name:"Unsupported Method",message:"The Provider does not support the requested method."},[tf]:{name:"Disconnected",message:"The Provider is disconnected from all chains."},[tp]:{name:"Chain Disconnected",message:"The Provider is not connected to the requested chain."},"0-999":{name:"",message:"Not used."},1e3:{name:"Normal Closure",message:"The connection successfully completed the purpose for which it was created."},1001:{name:"Going Away",message:"The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection."},1002:{name:"Protocol error",message:"The endpoint is terminating the connection due to a protocol error."},1003:{name:"Unsupported Data",message:"The connection is being terminated because the endpoint received data of a type it cannot accept. (For example, a text-only endpoint received binary data.)"},1004:{name:"Reserved",message:"Reserved. A meaning might be defined in the future."},1005:{name:"No Status Rcvd",message:"Reserved. Indicates that no status code was provided even though one was expected."},1006:{name:"Abnormal Closure",message:"Reserved. Indicates that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected."},1007:{name:"Invalid frame payload data",message:"The endpoint is terminating the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message)."},1008:{name:"Policy Violation",message:"The endpoint is terminating the connection because it received a message that violates its policy. This is a generic status code, used when codes 1003 and 1009 are not suitable."},1009:{name:"Message Too Big",message:"The endpoint is terminating the connection because a data frame was received that is too large."},1010:{name:"Mandatory Ext.",message:"The client is terminating the connection because it expected the server to negotiate one or more extension, but the server didn't."},1011:{name:"Internal Error",message:"The server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request."},1012:{name:"Service Restart",message:"The server is terminating the connection because it is restarting."},1013:{name:"Try Again Later",message:"The server is terminating the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients."},1014:{name:"Bad Gateway",message:"The server was acting as a gateway or proxy and received an invalid response from the upstream server. This is similar to 502 HTTP Status Code."},1015:{name:"TLS handshake",message:"Reserved. Indicates that the connection was closed due to a failure to perform a TLS handshake (e.g., the server certificate can't be verified)."},"1016-2999":{name:"",message:"For definition by future revisions of the WebSocket Protocol specification, and for definition by extension specifications."},"3000-3999":{name:"",message:"For use by libraries, frameworks, and applications. These status codes are registered directly with IANA. The interpretation of these codes is undefined by the WebSocket protocol."},"4000-4999":{name:"",message:"For private use, and thus can't be registered. Such codes can be used by prior agreements between WebSocket applications. The interpretation of these codes is undefined by the WebSocket protocol."}};class nd extends tV{constructor(e,t){super(null!=t?t:nu.replace("*code*",e.error.code.toString())),this.code=e.error.code,this.id=e.id,this.jsonrpc=e.jsonrpc,this.jsonRpcError=e.error}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{error:this.jsonRpcError,id:this.id,jsonRpc:this.jsonrpc})}}class nf extends tV{constructor(e,t){var r,n,i,s;if(e)if(null==(r=nh[e])?void 0:r.message)super(nh[e].message);else{let t=Object.keys(nh).find(t=>"string"==typeof t&&e>=parseInt(t.split("-")[0],10)&&e<=parseInt(t.split("-")[1],10));super(null!=(i=null==(n=nh[null!=t?t:""])?void 0:n.message)?i:nu.replace("*code*",null!=(s=null==e?void 0:e.toString())?s:'""'))}else super();this.code=e,this.data=t}}class np extends nd{constructor(e){super(e,nh[tN].message),this.code=tN}}class ng extends nd{constructor(e){super(e,nh[tD].message),this.code=tD}}class nm extends nd{constructor(e){super(e,nh[tB].message),this.code=tB}}class ny extends nd{constructor(e){super(e,nh[tM].message),this.code=tM}}class nb extends nd{constructor(e){super(e,nh[tL].message),this.code=tL}}class nw extends nd{constructor(e){super(e,nh[tF].message),this.code=tF}}class nv extends nd{constructor(e){super(e,nh[tH].message),this.code=tH}}class nE extends nd{constructor(e){super(e,nh[tj].message),this.code=tj}}class nA extends nd{constructor(e){super(e,nh[tU].message),this.code=tU}}class nx extends nd{constructor(e){super(e,nh[tz].message),this.code=tz}}class nS extends nd{constructor(e){super(e,nh[t$].message),this.code=t$}}class nk extends nd{constructor(e){super(e,nh[tq].message),this.code=tq}}let n_=new Map;n_.set(tN,{error:np}),n_.set(tD,{error:ng}),n_.set(tB,{error:nm}),n_.set(tM,{error:ny}),n_.set(tL,{error:nb}),n_.set(tF,{error:nw}),n_.set(tH,{error:nv}),n_.set(tj,{error:nE}),n_.set(t$,{error:nS}),n_.set(tU,{error:nA}),n_.set(tz,{error:nx}),n_.set(tq,{error:nk});class nI extends tV{constructor(e){super(`Format for the type ${e} is unsupported`),this.type=e,this.code=tO}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{type:this.type})}}function nC(e){if(!Number.isSafeInteger(e)||e<0)throw Error(`positive integer expected, not ${e}`)}function nT(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function nP(e,...t){if(!nT(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function nR(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.wrapConstructor");nC(e.outputLen),nC(e.blockLen)}function nO(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function nN(e,t){nP(e);let r=t.outputLen;if(e.length<r)throw Error(`digestInto() expects output buffer of length at least ${r}`)}let nD={bool:function(e){if("boolean"!=typeof e)throw Error(`boolean expected, not ${e}`)},bytes:nP},nB=BigInt(0x100000000-1),nM=BigInt(32);function nL(e,t=!1){return t?{h:Number(e&nB),l:Number(e>>nM&nB)}:{h:0|Number(e>>nM&nB),l:0|Number(e&nB)}}function nF(e,t=!1){let r=new Uint32Array(e.length),n=new Uint32Array(e.length);for(let i=0;i<e.length;i++){let{h:s,l:o}=nL(e[i],t);[r[i],n[i]]=[s,o]}return[r,n]}let nU=(e,t,r)=>e<<r|t>>>32-r,nj=(e,t,r)=>t<<r|e>>>32-r,n$=(e,t,r)=>t<<r-32|e>>>64-r,nH=(e,t,r)=>e<<r-32|t>>>64-r,nq={split:nF,shrSH:(e,t,r)=>e>>>r,shrSL:(e,t,r)=>e<<32-r|t>>>r,rotrSH:(e,t,r)=>e>>>r|t<<32-r,rotrSL:(e,t,r)=>e<<32-r|t>>>r,rotrBH:(e,t,r)=>e<<64-r|t>>>r-32,rotrBL:(e,t,r)=>e>>>r-32|t<<64-r,add:function(e,t,r,n){let i=(t>>>0)+(n>>>0);return{h:e+r+(i/0x100000000|0)|0,l:0|i}},add3L:(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),add3H:(e,t,r,n)=>t+r+n+(e/0x100000000|0)|0,add4L:(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),add4H:(e,t,r,n,i)=>t+r+n+i+(e/0x100000000|0)|0,add5H:(e,t,r,n,i,s)=>t+r+n+i+s+(e/0x100000000|0)|0,add5L:(e,t,r,n,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(i>>>0)},nz="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,nV=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),nK=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),nG=(e,t)=>e<<32-t|e>>>t,nW=(e,t)=>e<<t|e>>>32-t>>>0,nQ=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0],nJ=e=>e<<24&0xff000000|e<<8&0xff0000|e>>>8&65280|e>>>24&255;function nZ(e){for(let t=0;t<e.length;t++)e[t]=nJ(e[t])}(e,t)=>t.toString(16).padStart(2,"0");let nY={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function nX(e){if("string"!=typeof e)throw Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function n0(e){return"string"==typeof e&&(e=nX(e)),nP(e),e}function n1(...e){let t=0;for(let r=0;r<e.length;r++){let n=e[r];nP(n),t+=n.length}let r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){let i=e[t];r.set(i,n),n+=i.length}return r}class n2{clone(){return this._cloneInto()}}let n3={}.toString;function n4(e,t){if(void 0!==t&&"[object Object]"!==n3.call(t))throw Error("Options should be object or undefined");return Object.assign(e,t)}function n5(e){let t=t=>e().update(n0(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function n6(e=32){if(nz&&"function"==typeof nz.getRandomValues)return nz.getRandomValues(new Uint8Array(e));throw Error("crypto.getRandomValues must be defined")}let n8=[],n7=[],n9=[],ie=BigInt(0),it=BigInt(1),ir=BigInt(2),ii=BigInt(7),is=BigInt(256),io=BigInt(113);for(let e=0,t=it,r=1,n=0;e<24;e++){[r,n]=[n,(2*r+3*n)%5],n8.push(2*(5*n+r)),n7.push((e+1)*(e+2)/2%64);let i=ie;for(let e=0;e<7;e++)(t=(t<<it^(t>>ii)*io)%is)&ir&&(i^=it<<(it<<BigInt(e))-it);n9.push(i)}let[ia,il]=nF(n9,!0),ic=(e,t,r)=>r>32?n$(e,t,r):nU(e,t,r),iu=(e,t,r)=>r>32?nH(e,t,r):nj(e,t,r);function ih(e,t=24){let r=new Uint32Array(10);for(let n=24-t;n<24;n++){for(let t=0;t<10;t++)r[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){let n=(t+8)%10,i=(t+2)%10,s=r[i],o=r[i+1],a=ic(s,o,1)^r[n],l=iu(s,o,1)^r[n+1];for(let r=0;r<50;r+=10)e[t+r]^=a,e[t+r+1]^=l}let t=e[2],i=e[3];for(let r=0;r<24;r++){let n=n7[r],s=ic(t,i,n),o=iu(t,i,n),a=n8[r];t=e[a],i=e[a+1],e[a]=s,e[a+1]=o}for(let t=0;t<50;t+=10){for(let n=0;n<10;n++)r[n]=e[t+n];for(let n=0;n<10;n++)e[t+n]^=~r[(n+2)%10]&r[(n+4)%10]}e[0]^=ia[n],e[1]^=il[n]}r.fill(0)}class id extends n2{constructor(e,t,r,n=!1,i=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=n,this.rounds=i,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,nC(r),0>=this.blockLen||this.blockLen>=200)throw Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=nV(this.state)}keccak(){nQ||nZ(this.state32),ih(this.state32,this.rounds),nQ||nZ(this.state32),this.posOut=0,this.pos=0}update(e){nO(this);let{blockLen:t,state:r}=this,n=(e=n0(e)).length;for(let i=0;i<n;){let s=Math.min(t-this.pos,n-i);for(let t=0;t<s;t++)r[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:r,blockLen:n}=this;e[r]^=t,(128&t)!=0&&r===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){nO(this,!1),nP(e),this.finish();let t=this.state,{blockLen:r}=this;for(let n=0,i=e.length;n<i;){this.posOut>=r&&this.keccak();let s=Math.min(r-this.posOut,i-n);e.set(t.subarray(this.posOut,this.posOut+s),n),this.posOut+=s,n+=s}return e}xofInto(e){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return nC(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(nN(e,this),this.finished)throw Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){let{blockLen:t,suffix:r,outputLen:n,rounds:i,enableXOF:s}=this;return e||(e=new id(t,r,n,s,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=r,e.outputLen=n,e.enableXOF=s,e.destroyed=this.destroyed,e}}let ip=(e,t,r)=>n5(()=>new id(t,e,r)),ig=ip(1,144,28),im=ip(1,136,32),iy=ip(1,104,48),ib=ip(1,72,64);nD.bool;let iw=nD.bytes;function iv(e){if(!(e instanceof Uint8Array))throw TypeError(`bytesToUtf8 expected Uint8Array, got ${typeof e}`);return new TextDecoder().decode(e)}function iE(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function iA(e){return t=>(nD.bytes(t),e(t))}(()=>{let e="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,t="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);return t&&!e&&t("crypto")})(),iA(ig);let ix=(()=>{let e=iA(im);return e.create=im.create,e})();iA(iy),iA(ib),function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),n={};for(let e of r)n[e]=t[e];return e.objectValues(n)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(k||(k={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(_||(_={}));let iS=k.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ik=e=>{switch(typeof e){case"undefined":return iS.undefined;case"string":return iS.string;case"number":return isNaN(e)?iS.nan:iS.number;case"boolean":return iS.boolean;case"function":return iS.function;case"bigint":return iS.bigint;case"symbol":return iS.symbol;case"object":if(Array.isArray(e))return iS.array;if(null===e)return iS.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return iS.promise;if("undefined"!=typeof Map&&e instanceof Map)return iS.map;if("undefined"!=typeof Set&&e instanceof Set)return iS.set;if("undefined"!=typeof Date&&e instanceof Date)return iS.date;return iS.object;default:return iS.unknown}},i_=k.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),iI=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class iC extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},n=e=>{for(let i of e.issues)if("invalid_union"===i.code)i.unionErrors.map(n);else if("invalid_return_type"===i.code)n(i.returnTypeError);else if("invalid_arguments"===i.code)n(i.argumentsError);else if(0===i.path.length)r._errors.push(t(i));else{let e=r,n=0;for(;n<i.path.length;){let r=i.path[n];n===i.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(i))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return n(this),r}static assert(e){if(!(e instanceof iC))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,k.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}iC.create=e=>new iC(e);let iT=(e,t)=>{let r;switch(e.code){case i_.invalid_type:r=e.received===iS.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case i_.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,k.jsonStringifyReplacer)}`;break;case i_.unrecognized_keys:r=`Unrecognized key(s) in object: ${k.joinValues(e.keys,", ")}`;break;case i_.invalid_union:r="Invalid input";break;case i_.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${k.joinValues(e.options)}`;break;case i_.invalid_enum_value:r=`Invalid enum value. Expected ${k.joinValues(e.options)}, received '${e.received}'`;break;case i_.invalid_arguments:r="Invalid function arguments";break;case i_.invalid_return_type:r="Invalid function return type";break;case i_.invalid_date:r="Invalid date";break;case i_.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:k.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case i_.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case i_.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case i_.custom:r="Invalid input";break;case i_.invalid_intersection_types:r="Intersection results could not be merged";break;case i_.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case i_.not_finite:r="Number must be finite";break;default:r=t.defaultError,k.assertNever(e)}return{message:r}},iP=iT;function iR(e){iP=e}function iO(){return iP}let iN=e=>{let{data:t,path:r,errorMaps:n,issueData:i}=e,s=[...r,...i.path||[]],o={...i,path:s};if(void 0!==i.message)return{...i,path:s,message:i.message};let a="";for(let e of n.filter(e=>!!e).slice().reverse())a=e(o,{data:t,defaultError:a}).message;return{...i,path:s,message:a}},iD=[];function iB(e,t){let r=iO(),n=iN({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===iT?void 0:iT].filter(e=>!!e)});e.common.issues.push(n)}class iM{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let n of t){if("aborted"===n.status)return iL;"dirty"===n.status&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,n=await e.value;r.push({key:t,value:n})}return iM.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let n of t){let{key:t,value:i}=n;if("aborted"===t.status||"aborted"===i.status)return iL;"dirty"===t.status&&e.dirty(),"dirty"===i.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==i.value||n.alwaysSet)&&(r[t.value]=i.value)}return{status:e.value,value:r}}}let iL=Object.freeze({status:"aborted"}),iF=e=>({status:"dirty",value:e}),iU=e=>({status:"valid",value:e}),ij=e=>"aborted"===e.status,i$=e=>"dirty"===e.status,iH=e=>"valid"===e.status,iq=e=>"undefined"!=typeof Promise&&e instanceof Promise;function iz(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}function iV(e,t,r,n,i){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r}"function"==typeof SuppressedError&&SuppressedError,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(I||(I={}));class iK{constructor(e,t,r,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let iG=(e,t)=>{if(iH(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new iC(e.common.issues);return this._error=t,this._error}}};function iW(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:n,description:i}=e;if(t&&(r||n))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:i}:{errorMap:(t,i)=>{var s,o;let{message:a}=e;return"invalid_enum_value"===t.code?{message:null!=a?a:i.defaultError}:void 0===i.data?{message:null!=(s=null!=a?a:n)?s:i.defaultError}:"invalid_type"!==t.code?{message:i.defaultError}:{message:null!=(o=null!=a?a:r)?o:i.defaultError}},description:i}}class iQ{get description(){return this._def.description}_getType(e){return ik(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:ik(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new iM,ctx:{common:e.parent.common,data:e.data,parsedType:ik(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(iq(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;let n={common:{issues:[],async:null!=(r=null==t?void 0:t.async)&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ik(e)},i=this._parseSync({data:e,path:n.path,parent:n});return iG(n,i)}"~validate"(e){var t,r;let n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ik(e)};if(!this["~standard"].async)try{let t=this._parseSync({data:e,path:[],parent:n});return iH(t)?{value:t.value}:{issues:n.common.issues}}catch(e){(null==(r=null==(t=null==e?void 0:e.message)?void 0:t.toLowerCase())?void 0:r.includes("encountered"))&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(e=>iH(e)?{value:e.value}:{issues:n.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ik(e)},n=this._parse({data:e,path:r.path,parent:r});return iG(r,await (iq(n)?n:Promise.resolve(n)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,n)=>{let i=e(t),s=()=>n.addIssue({code:i_.custom,...r(t)});return"undefined"!=typeof Promise&&i instanceof Promise?i.then(e=>!!e||(s(),!1)):!!i||(s(),!1)})}refinement(e,t){return this._refinement((r,n)=>!!e(r)||(n.addIssue("function"==typeof t?t(r,n):t),!1))}_refinement(e){return new s$({schema:this,typeName:P.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return sH.create(this,this._def)}nullable(){return sq.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return sA.create(this)}promise(){return sj.create(this,this._def)}or(e){return sk.create([this,e],this._def)}and(e){return sT.create(this,e,this._def)}transform(e){return new s$({...iW(this._def),schema:this,typeName:P.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t="function"==typeof e?e:()=>e;return new sz({...iW(this._def),innerType:this,defaultValue:t,typeName:P.ZodDefault})}brand(){return new sW({typeName:P.ZodBranded,type:this,...iW(this._def)})}catch(e){let t="function"==typeof e?e:()=>e;return new sV({...iW(this._def),innerType:this,catchValue:t,typeName:P.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return sQ.create(this,e)}readonly(){return sJ.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let iJ=/^c[^\s-]{8,}$/i,iZ=/^[0-9a-z]+$/,iY=/^[0-9A-HJKMNP-TV-Z]{26}$/i,iX=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,i0=/^[a-z0-9_-]{21}$/i,i1=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,i2=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,i3=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,i4="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",i5=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,i6=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,i8=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,i7=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,i9=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,se=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,st="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",sr=RegExp(`^${st}$`);function sn(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function si(e){return RegExp(`^${sn(e)}$`)}function ss(e){let t=`${st}T${sn(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}function so(e,t){return!!(("v4"===t||!t)&&i5.test(e)||("v6"===t||!t)&&i8.test(e))}function sa(e,t){if(!i1.test(e))return!1;try{let[r]=e.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));if("object"!=typeof i||null===i||!i.typ||!i.alg||t&&i.alg!==t)return!1;return!0}catch(e){return!1}}function sl(e,t){return!!(("v4"===t||!t)&&i6.test(e)||("v6"===t||!t)&&i7.test(e))}class sc extends iQ{_parse(e){let t;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==iS.string){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.string,received:t.parsedType}),iL}let r=new iM;for(let i of this._def.checks)if("min"===i.kind)e.data.length<i.value&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if("max"===i.kind)e.data.length>i.value&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if("length"===i.kind){let n=e.data.length>i.value,s=e.data.length<i.value;(n||s)&&(t=this._getOrReturnCtx(e,t),n?iB(t,{code:i_.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):s&&iB(t,{code:i_.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if("email"===i.kind)i3.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"email",code:i_.invalid_string,message:i.message}),r.dirty());else if("emoji"===i.kind)n||(n=RegExp(i4,"u")),n.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"emoji",code:i_.invalid_string,message:i.message}),r.dirty());else if("uuid"===i.kind)iX.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"uuid",code:i_.invalid_string,message:i.message}),r.dirty());else if("nanoid"===i.kind)i0.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"nanoid",code:i_.invalid_string,message:i.message}),r.dirty());else if("cuid"===i.kind)iJ.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"cuid",code:i_.invalid_string,message:i.message}),r.dirty());else if("cuid2"===i.kind)iZ.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"cuid2",code:i_.invalid_string,message:i.message}),r.dirty());else if("ulid"===i.kind)iY.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"ulid",code:i_.invalid_string,message:i.message}),r.dirty());else if("url"===i.kind)try{new URL(e.data)}catch(n){iB(t=this._getOrReturnCtx(e,t),{validation:"url",code:i_.invalid_string,message:i.message}),r.dirty()}else"regex"===i.kind?(i.regex.lastIndex=0,i.regex.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"regex",code:i_.invalid_string,message:i.message}),r.dirty())):"trim"===i.kind?e.data=e.data.trim():"includes"===i.kind?e.data.includes(i.value,i.position)||(iB(t=this._getOrReturnCtx(e,t),{code:i_.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):"toLowerCase"===i.kind?e.data=e.data.toLowerCase():"toUpperCase"===i.kind?e.data=e.data.toUpperCase():"startsWith"===i.kind?e.data.startsWith(i.value)||(iB(t=this._getOrReturnCtx(e,t),{code:i_.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):"endsWith"===i.kind?e.data.endsWith(i.value)||(iB(t=this._getOrReturnCtx(e,t),{code:i_.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):"datetime"===i.kind?ss(i).test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{code:i_.invalid_string,validation:"datetime",message:i.message}),r.dirty()):"date"===i.kind?sr.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{code:i_.invalid_string,validation:"date",message:i.message}),r.dirty()):"time"===i.kind?si(i).test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{code:i_.invalid_string,validation:"time",message:i.message}),r.dirty()):"duration"===i.kind?i2.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"duration",code:i_.invalid_string,message:i.message}),r.dirty()):"ip"===i.kind?so(e.data,i.version)||(iB(t=this._getOrReturnCtx(e,t),{validation:"ip",code:i_.invalid_string,message:i.message}),r.dirty()):"jwt"===i.kind?sa(e.data,i.alg)||(iB(t=this._getOrReturnCtx(e,t),{validation:"jwt",code:i_.invalid_string,message:i.message}),r.dirty()):"cidr"===i.kind?sl(e.data,i.version)||(iB(t=this._getOrReturnCtx(e,t),{validation:"cidr",code:i_.invalid_string,message:i.message}),r.dirty()):"base64"===i.kind?i9.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"base64",code:i_.invalid_string,message:i.message}),r.dirty()):"base64url"===i.kind?se.test(e.data)||(iB(t=this._getOrReturnCtx(e,t),{validation:"base64url",code:i_.invalid_string,message:i.message}),r.dirty()):k.assertNever(i);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:i_.invalid_string,...I.errToObj(r)})}_addCheck(e){return new sc({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...I.errToObj(e)})}url(e){return this._addCheck({kind:"url",...I.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...I.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...I.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...I.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...I.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...I.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...I.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...I.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...I.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...I.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...I.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...I.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!=(t=null==e?void 0:e.offset)&&t,local:null!=(r=null==e?void 0:e.local)&&r,...I.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...I.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...I.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...I.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...I.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...I.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...I.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...I.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...I.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...I.errToObj(t)})}nonempty(e){return this.min(1,I.errToObj(e))}trim(){return new sc({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new sc({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new sc({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function su(e,t){let r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,i=r>n?r:n;return parseInt(e.toFixed(i).replace(".",""))%parseInt(t.toFixed(i).replace(".",""))/Math.pow(10,i)}sc.create=e=>{var t;return new sc({checks:[],typeName:P.ZodString,coerce:null!=(t=null==e?void 0:e.coerce)&&t,...iW(e)})};class sh extends iQ{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==iS.number){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.number,received:t.parsedType}),iL}let r=new iM;for(let n of this._def.checks)"int"===n.kind?k.isInteger(e.data)||(iB(t=this._getOrReturnCtx(e,t),{code:i_.invalid_type,expected:"integer",received:"float",message:n.message}),r.dirty()):"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"multipleOf"===n.kind?0!==su(e.data,n.value)&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(iB(t=this._getOrReturnCtx(e,t),{code:i_.not_finite,message:n.message}),r.dirty()):k.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,I.toString(t))}gt(e,t){return this.setLimit("min",e,!1,I.toString(t))}lte(e,t){return this.setLimit("max",e,!0,I.toString(t))}lt(e,t){return this.setLimit("max",e,!1,I.toString(t))}setLimit(e,t,r,n){return new sh({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:I.toString(n)}]})}_addCheck(e){return new sh({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:I.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:I.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:I.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:I.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:I.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:I.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:I.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:I.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:I.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&k.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks)if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;else"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value);return Number.isFinite(t)&&Number.isFinite(e)}}sh.create=e=>new sh({checks:[],typeName:P.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...iW(e)});class sd extends iQ{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch(t){return this._getInvalidInput(e)}if(this._getType(e)!==iS.bigint)return this._getInvalidInput(e);let r=new iM;for(let n of this._def.checks)"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):k.assertNever(n);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.bigint,received:t.parsedType}),iL}gte(e,t){return this.setLimit("min",e,!0,I.toString(t))}gt(e,t){return this.setLimit("min",e,!1,I.toString(t))}lte(e,t){return this.setLimit("max",e,!0,I.toString(t))}lt(e,t){return this.setLimit("max",e,!1,I.toString(t))}setLimit(e,t,r,n){return new sd({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:I.toString(n)}]})}_addCheck(e){return new sd({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:I.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:I.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:I.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:I.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:I.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}sd.create=e=>{var t;return new sd({checks:[],typeName:P.ZodBigInt,coerce:null!=(t=null==e?void 0:e.coerce)&&t,...iW(e)})};class sf extends iQ{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==iS.boolean){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.boolean,received:t.parsedType}),iL}return iU(e.data)}}sf.create=e=>new sf({typeName:P.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...iW(e)});class sp extends iQ{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==iS.date){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.date,received:t.parsedType}),iL}if(isNaN(e.data.getTime()))return iB(this._getOrReturnCtx(e),{code:i_.invalid_date}),iL;let r=new iM;for(let n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),r.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(iB(t=this._getOrReturnCtx(e,t),{code:i_.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),r.dirty()):k.assertNever(n);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new sp({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:I.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:I.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}sp.create=e=>new sp({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:P.ZodDate,...iW(e)});class sg extends iQ{_parse(e){if(this._getType(e)!==iS.symbol){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.symbol,received:t.parsedType}),iL}return iU(e.data)}}sg.create=e=>new sg({typeName:P.ZodSymbol,...iW(e)});class sm extends iQ{_parse(e){if(this._getType(e)!==iS.undefined){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.undefined,received:t.parsedType}),iL}return iU(e.data)}}sm.create=e=>new sm({typeName:P.ZodUndefined,...iW(e)});class sy extends iQ{_parse(e){if(this._getType(e)!==iS.null){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.null,received:t.parsedType}),iL}return iU(e.data)}}sy.create=e=>new sy({typeName:P.ZodNull,...iW(e)});class sb extends iQ{constructor(){super(...arguments),this._any=!0}_parse(e){return iU(e.data)}}sb.create=e=>new sb({typeName:P.ZodAny,...iW(e)});class sw extends iQ{constructor(){super(...arguments),this._unknown=!0}_parse(e){return iU(e.data)}}sw.create=e=>new sw({typeName:P.ZodUnknown,...iW(e)});class sv extends iQ{_parse(e){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.never,received:t.parsedType}),iL}}sv.create=e=>new sv({typeName:P.ZodNever,...iW(e)});class sE extends iQ{_parse(e){if(this._getType(e)!==iS.undefined){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.void,received:t.parsedType}),iL}return iU(e.data)}}sE.create=e=>new sE({typeName:P.ZodVoid,...iW(e)});class sA extends iQ{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),n=this._def;if(t.parsedType!==iS.array)return iB(t,{code:i_.invalid_type,expected:iS.array,received:t.parsedType}),iL;if(null!==n.exactLength){let e=t.data.length>n.exactLength.value,i=t.data.length<n.exactLength.value;(e||i)&&(iB(t,{code:e?i_.too_big:i_.too_small,minimum:i?n.exactLength.value:void 0,maximum:e?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(null!==n.minLength&&t.data.length<n.minLength.value&&(iB(t,{code:i_.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dirty()),null!==n.maxLength&&t.data.length>n.maxLength.value&&(iB(t,{code:i_.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>n.type._parseAsync(new iK(t,e,t.path,r)))).then(e=>iM.mergeArray(r,e));let i=[...t.data].map((e,r)=>n.type._parseSync(new iK(t,e,t.path,r)));return iM.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new sA({...this._def,minLength:{value:e,message:I.toString(t)}})}max(e,t){return new sA({...this._def,maxLength:{value:e,message:I.toString(t)}})}length(e,t){return new sA({...this._def,exactLength:{value:e,message:I.toString(t)}})}nonempty(e){return this.min(1,e)}}function sx(e){if(e instanceof sS){let t={};for(let r in e.shape){let n=e.shape[r];t[r]=sH.create(sx(n))}return new sS({...e._def,shape:()=>t})}if(e instanceof sA)return new sA({...e._def,type:sx(e.element)});if(e instanceof sH)return sH.create(sx(e.unwrap()));if(e instanceof sq)return sq.create(sx(e.unwrap()));if(e instanceof sP)return sP.create(e.items.map(e=>sx(e)));else return e}sA.create=(e,t)=>new sA({type:e,minLength:null,maxLength:null,exactLength:null,typeName:P.ZodArray,...iW(t)});class sS extends iQ{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=k.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==iS.object){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.object,received:t.parsedType}),iL}let{status:t,ctx:r}=this._processInputParams(e),{shape:n,keys:i}=this._getCached(),s=[];if(!(this._def.catchall instanceof sv&&"strip"===this._def.unknownKeys))for(let e in r.data)i.includes(e)||s.push(e);let o=[];for(let e of i){let t=n[e],i=r.data[e];o.push({key:{status:"valid",value:e},value:t._parse(new iK(r,i,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof sv){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of s)o.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)s.length>0&&(iB(r,{code:i_.unrecognized_keys,keys:s}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of s){let n=r.data[t];o.push({key:{status:"valid",value:t},value:e._parse(new iK(r,n,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of o){let r=await t.key,n=await t.value;e.push({key:r,value:n,alwaysSet:t.alwaysSet})}return e}).then(e=>iM.mergeObjectSync(t,e)):iM.mergeObjectSync(t,o)}get shape(){return this._def.shape()}strict(e){return I.errToObj,new sS({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var n,i,s,o;let a=null!=(s=null==(i=(n=this._def).errorMap)?void 0:i.call(n,t,r).message)?s:r.defaultError;return"unrecognized_keys"===t.code?{message:null!=(o=I.errToObj(e).message)?o:a}:{message:a}}}:{}})}strip(){return new sS({...this._def,unknownKeys:"strip"})}passthrough(){return new sS({...this._def,unknownKeys:"passthrough"})}extend(e){return new sS({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new sS({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:P.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new sS({...this._def,catchall:e})}pick(e){let t={};return k.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new sS({...this._def,shape:()=>t})}omit(e){let t={};return k.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new sS({...this._def,shape:()=>t})}deepPartial(){return sx(this)}partial(e){let t={};return k.objectKeys(this.shape).forEach(r=>{let n=this.shape[r];e&&!e[r]?t[r]=n:t[r]=n.optional()}),new sS({...this._def,shape:()=>t})}required(e){let t={};return k.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof sH;)e=e._def.innerType;t[r]=e}}),new sS({...this._def,shape:()=>t})}keyof(){return sL(k.objectKeys(this.shape))}}sS.create=(e,t)=>new sS({shape:()=>e,unknownKeys:"strip",catchall:sv.create(),typeName:P.ZodObject,...iW(t)}),sS.strictCreate=(e,t)=>new sS({shape:()=>e,unknownKeys:"strict",catchall:sv.create(),typeName:P.ZodObject,...iW(t)}),sS.lazycreate=(e,t)=>new sS({shape:e,unknownKeys:"strip",catchall:sv.create(),typeName:P.ZodObject,...iW(t)});class sk extends iQ{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;function n(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new iC(e.ctx.common.issues));return iB(t,{code:i_.invalid_union,unionErrors:r}),iL}if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(n);{let e,n=[];for(let i of r){let r={...t,common:{...t.common,issues:[]},parent:null},s=i._parseSync({data:t.data,path:t.path,parent:r});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:r}),r.common.issues.length&&n.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let i=n.map(e=>new iC(e));return iB(t,{code:i_.invalid_union,unionErrors:i}),iL}}get options(){return this._def.options}}sk.create=(e,t)=>new sk({options:e,typeName:P.ZodUnion,...iW(t)});let s_=e=>{if(e instanceof sB)return s_(e.schema);if(e instanceof s$)return s_(e.innerType());if(e instanceof sM)return[e.value];if(e instanceof sF)return e.options;if(e instanceof sU)return k.objectValues(e.enum);else if(e instanceof sz)return s_(e._def.innerType);else if(e instanceof sm)return[void 0];else if(e instanceof sy)return[null];else if(e instanceof sH)return[void 0,...s_(e.unwrap())];else if(e instanceof sq)return[null,...s_(e.unwrap())];else if(e instanceof sW)return s_(e.unwrap());else if(e instanceof sJ)return s_(e.unwrap());else if(e instanceof sV)return s_(e._def.innerType);else return[]};class sI extends iQ{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==iS.object)return iB(t,{code:i_.invalid_type,expected:iS.object,received:t.parsedType}),iL;let r=this.discriminator,n=t.data[r],i=this.optionsMap.get(n);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(iB(t,{code:i_.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),iL)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let n=new Map;for(let r of t){let t=s_(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let i of t){if(n.has(i))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(i)}`);n.set(i,r)}}return new sI({typeName:P.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...iW(r)})}}function sC(e,t){let r=ik(e),n=ik(t);if(e===t)return{valid:!0,data:e};if(r===iS.object&&n===iS.object){let r=k.objectKeys(t),n=k.objectKeys(e).filter(e=>-1!==r.indexOf(e)),i={...e,...t};for(let r of n){let n=sC(e[r],t[r]);if(!n.valid)return{valid:!1};i[r]=n.data}return{valid:!0,data:i}}if(r===iS.array&&n===iS.array){if(e.length!==t.length)return{valid:!1};let r=[];for(let n=0;n<e.length;n++){let i=sC(e[n],t[n]);if(!i.valid)return{valid:!1};r.push(i.data)}return{valid:!0,data:r}}if(r===iS.date&&n===iS.date&&+e==+t)return{valid:!0,data:e};return{valid:!1}}class sT extends iQ{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),n=(e,n)=>{if(ij(e)||ij(n))return iL;let i=sC(e.value,n.value);return i.valid?((i$(e)||i$(n))&&t.dirty(),{status:t.value,value:i.data}):(iB(r,{code:i_.invalid_intersection_types}),iL)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>n(e,t)):n(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}sT.create=(e,t,r)=>new sT({left:e,right:t,typeName:P.ZodIntersection,...iW(r)});class sP extends iQ{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==iS.array)return iB(r,{code:i_.invalid_type,expected:iS.array,received:r.parsedType}),iL;if(r.data.length<this._def.items.length)return iB(r,{code:i_.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),iL;!this._def.rest&&r.data.length>this._def.items.length&&(iB(r,{code:i_.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let n=[...r.data].map((e,t)=>{let n=this._def.items[t]||this._def.rest;return n?n._parse(new iK(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(n).then(e=>iM.mergeArray(t,e)):iM.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new sP({...this._def,rest:e})}}sP.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new sP({items:e,typeName:P.ZodTuple,rest:null,...iW(t)})};class sR extends iQ{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==iS.object)return iB(r,{code:i_.invalid_type,expected:iS.object,received:r.parsedType}),iL;let n=[],i=this._def.keyType,s=this._def.valueType;for(let e in r.data)n.push({key:i._parse(new iK(r,e,r.path,e)),value:s._parse(new iK(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?iM.mergeObjectAsync(t,n):iM.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,r){return new sR(t instanceof iQ?{keyType:e,valueType:t,typeName:P.ZodRecord,...iW(r)}:{keyType:sc.create(),valueType:e,typeName:P.ZodRecord,...iW(t)})}}class sO extends iQ{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==iS.map)return iB(r,{code:i_.invalid_type,expected:iS.map,received:r.parsedType}),iL;let n=this._def.keyType,i=this._def.valueType,s=[...r.data.entries()].map(([e,t],s)=>({key:n._parse(new iK(r,e,r.path,[s,"key"])),value:i._parse(new iK(r,t,r.path,[s,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of s){let n=await r.key,i=await r.value;if("aborted"===n.status||"aborted"===i.status)return iL;("dirty"===n.status||"dirty"===i.status)&&t.dirty(),e.set(n.value,i.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of s){let n=r.key,i=r.value;if("aborted"===n.status||"aborted"===i.status)return iL;("dirty"===n.status||"dirty"===i.status)&&t.dirty(),e.set(n.value,i.value)}return{status:t.value,value:e}}}}sO.create=(e,t,r)=>new sO({valueType:t,keyType:e,typeName:P.ZodMap,...iW(r)});class sN extends iQ{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==iS.set)return iB(r,{code:i_.invalid_type,expected:iS.set,received:r.parsedType}),iL;let n=this._def;null!==n.minSize&&r.data.size<n.minSize.value&&(iB(r,{code:i_.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),null!==n.maxSize&&r.data.size>n.maxSize.value&&(iB(r,{code:i_.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());let i=this._def.valueType;function s(e){let r=new Set;for(let n of e){if("aborted"===n.status)return iL;"dirty"===n.status&&t.dirty(),r.add(n.value)}return{status:t.value,value:r}}let o=[...r.data.values()].map((e,t)=>i._parse(new iK(r,e,r.path,t)));return r.common.async?Promise.all(o).then(e=>s(e)):s(o)}min(e,t){return new sN({...this._def,minSize:{value:e,message:I.toString(t)}})}max(e,t){return new sN({...this._def,maxSize:{value:e,message:I.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}sN.create=(e,t)=>new sN({valueType:e,minSize:null,maxSize:null,typeName:P.ZodSet,...iW(t)});class sD extends iQ{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==iS.function)return iB(t,{code:i_.invalid_type,expected:iS.function,received:t.parsedType}),iL;function r(e,r){return iN({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,iO(),iT].filter(e=>!!e),issueData:{code:i_.invalid_arguments,argumentsError:r}})}function n(e,r){return iN({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,iO(),iT].filter(e=>!!e),issueData:{code:i_.invalid_return_type,returnTypeError:r}})}let i={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof sj){let e=this;return iU(async function(...t){let o=new iC([]),a=await e._def.args.parseAsync(t,i).catch(e=>{throw o.addIssue(r(t,e)),o}),l=await Reflect.apply(s,this,a);return await e._def.returns._def.type.parseAsync(l,i).catch(e=>{throw o.addIssue(n(l,e)),o})})}{let e=this;return iU(function(...t){let o=e._def.args.safeParse(t,i);if(!o.success)throw new iC([r(t,o.error)]);let a=Reflect.apply(s,this,o.data),l=e._def.returns.safeParse(a,i);if(!l.success)throw new iC([n(a,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new sD({...this._def,args:sP.create(e).rest(sw.create())})}returns(e){return new sD({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new sD({args:e||sP.create([]).rest(sw.create()),returns:t||sw.create(),typeName:P.ZodFunction,...iW(r)})}}class sB extends iQ{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}sB.create=(e,t)=>new sB({getter:e,typeName:P.ZodLazy,...iW(t)});class sM extends iQ{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return iB(t,{received:t.data,code:i_.invalid_literal,expected:this._def.value}),iL}return{status:"valid",value:e.data}}get value(){return this._def.value}}function sL(e,t){return new sF({values:e,typeName:P.ZodEnum,...iW(t)})}sM.create=(e,t)=>new sM({value:e,typeName:P.ZodLiteral,...iW(t)});class sF extends iQ{constructor(){super(...arguments),C.set(this,void 0)}_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return iB(t,{expected:k.joinValues(r),received:t.parsedType,code:i_.invalid_type}),iL}if(iz(this,C,"f")||iV(this,C,new Set(this._def.values),"f"),!iz(this,C,"f").has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return iB(t,{received:t.data,code:i_.invalid_enum_value,options:r}),iL}return iU(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return sF.create(e,{...this._def,...t})}exclude(e,t=this._def){return sF.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}C=new WeakMap,sF.create=sL;class sU extends iQ{constructor(){super(...arguments),T.set(this,void 0)}_parse(e){let t=k.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==iS.string&&r.parsedType!==iS.number){let e=k.objectValues(t);return iB(r,{expected:k.joinValues(e),received:r.parsedType,code:i_.invalid_type}),iL}if(iz(this,T,"f")||iV(this,T,new Set(k.getValidEnumValues(this._def.values)),"f"),!iz(this,T,"f").has(e.data)){let e=k.objectValues(t);return iB(r,{received:r.data,code:i_.invalid_enum_value,options:e}),iL}return iU(e.data)}get enum(){return this._def.values}}T=new WeakMap,sU.create=(e,t)=>new sU({values:e,typeName:P.ZodNativeEnum,...iW(t)});class sj extends iQ{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==iS.promise&&!1===t.common.async?(iB(t,{code:i_.invalid_type,expected:iS.promise,received:t.parsedType}),iL):iU((t.parsedType===iS.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}sj.create=(e,t)=>new sj({type:e,typeName:P.ZodPromise,...iW(t)});class s$ extends iQ{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===P.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),n=this._def.effect||null,i={addIssue:e=>{iB(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===n.type){let e=n.transform(r.data,i);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return iL;let n=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===n.status?iL:"dirty"===n.status||"dirty"===t.value?iF(n.value):n});{if("aborted"===t.value)return iL;let n=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===n.status?iL:"dirty"===n.status||"dirty"===t.value?iF(n.value):n}}if("refinement"===n.type){let e=e=>{let t=n.refinement(e,i);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?iL:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let n=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===n.status?iL:("dirty"===n.status&&t.dirty(),e(n.value),{status:t.value,value:n.value})}}if("transform"===n.type)if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>iH(e)?Promise.resolve(n.transform(e.value,i)).then(e=>({status:t.value,value:e})):e);else{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!iH(e))return e;let s=n.transform(e.value,i);if(s instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}k.assertNever(n)}}s$.create=(e,t,r)=>new s$({schema:e,typeName:P.ZodEffects,effect:t,...iW(r)}),s$.createWithPreprocess=(e,t,r)=>new s$({schema:t,effect:{type:"preprocess",transform:e},typeName:P.ZodEffects,...iW(r)});class sH extends iQ{_parse(e){return this._getType(e)===iS.undefined?iU(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}sH.create=(e,t)=>new sH({innerType:e,typeName:P.ZodOptional,...iW(t)});class sq extends iQ{_parse(e){return this._getType(e)===iS.null?iU(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}sq.create=(e,t)=>new sq({innerType:e,typeName:P.ZodNullable,...iW(t)});class sz extends iQ{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===iS.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}sz.create=(e,t)=>new sz({innerType:e,typeName:P.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...iW(t)});class sV extends iQ{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return iq(n)?n.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new iC(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===n.status?n.value:this._def.catchValue({get error(){return new iC(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}sV.create=(e,t)=>new sV({innerType:e,typeName:P.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...iW(t)});class sK extends iQ{_parse(e){if(this._getType(e)!==iS.nan){let t=this._getOrReturnCtx(e);return iB(t,{code:i_.invalid_type,expected:iS.nan,received:t.parsedType}),iL}return{status:"valid",value:e.data}}}sK.create=e=>new sK({typeName:P.ZodNaN,...iW(e)});let sG=Symbol("zod_brand");class sW extends iQ{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class sQ extends iQ{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?iL:"dirty"===e.status?(t.dirty(),iF(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?iL:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new sQ({in:e,out:t,typeName:P.ZodPipeline})}}class sJ extends iQ{_parse(e){let t=this._def.innerType._parse(e),r=e=>(iH(e)&&(e.value=Object.freeze(e.value)),e);return iq(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function sZ(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function sY(e,t={},r){return e?sb.create().superRefine((n,i)=>{var s,o;let a=e(n);if(a instanceof Promise)return a.then(e=>{var s,o;if(!e){let e=sZ(t,n),a=null==(o=null!=(s=e.fatal)?s:r)||o;i.addIssue({code:"custom",...e,fatal:a})}});if(!a){let e=sZ(t,n),a=null==(o=null!=(s=e.fatal)?s:r)||o;i.addIssue({code:"custom",...e,fatal:a})}}):sb.create()}sJ.create=(e,t)=>new sJ({innerType:e,typeName:P.ZodReadonly,...iW(t)});let sX={object:sS.lazycreate};!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(P||(P={}));let s0=(e,t={message:`Input not instance of ${e.name}`})=>sY(t=>t instanceof e,t),s1=sc.create,s2=sh.create,s3=sK.create,s4=sd.create,s5=sf.create,s6=sp.create,s8=sg.create,s7=sm.create,s9=sy.create,oe=sb.create,ot=sw.create,or=sv.create,on=sE.create,oi=sA.create,os=sS.create,oo=sS.strictCreate,oa=sk.create,ol=sI.create,oc=sT.create,ou=sP.create,oh=sR.create,od=sO.create,of=sN.create,op=sD.create,og=sB.create,om=sM.create,oy=sF.create,ob=sU.create,ow=sj.create,ov=s$.create,oE=sH.create,oA=sq.create,ox=s$.createWithPreprocess,oS=sQ.create,ok=()=>s2().optional(),o_=()=>s5().optional(),oI={string:e=>sc.create({...e,coerce:!0}),number:e=>sh.create({...e,coerce:!0}),boolean:e=>sf.create({...e,coerce:!0}),bigint:e=>sd.create({...e,coerce:!0}),date:e=>sp.create({...e,coerce:!0})},oC=iL;var oT=Object.freeze({__proto__:null,defaultErrorMap:iT,setErrorMap:iR,getErrorMap:iO,makeIssue:iN,EMPTY_PATH:iD,addIssueToContext:iB,ParseStatus:iM,INVALID:iL,DIRTY:iF,OK:iU,isAborted:ij,isDirty:i$,isValid:iH,isAsync:iq,get util(){return k},get objectUtil(){return _},ZodParsedType:iS,getParsedType:ik,ZodType:iQ,datetimeRegex:ss,ZodString:sc,ZodNumber:sh,ZodBigInt:sd,ZodBoolean:sf,ZodDate:sp,ZodSymbol:sg,ZodUndefined:sm,ZodNull:sy,ZodAny:sb,ZodUnknown:sw,ZodNever:sv,ZodVoid:sE,ZodArray:sA,ZodObject:sS,ZodUnion:sk,ZodDiscriminatedUnion:sI,ZodIntersection:sT,ZodTuple:sP,ZodRecord:sR,ZodMap:sO,ZodSet:sN,ZodFunction:sD,ZodLazy:sB,ZodLiteral:sM,ZodEnum:sF,ZodNativeEnum:sU,ZodPromise:sj,ZodEffects:s$,ZodTransformer:s$,ZodOptional:sH,ZodNullable:sq,ZodDefault:sz,ZodCatch:sV,ZodNaN:sK,BRAND:sG,ZodBranded:sW,ZodPipeline:sQ,ZodReadonly:sJ,custom:sY,Schema:iQ,ZodSchema:iQ,late:sX,get ZodFirstPartyTypeKind(){return P},coerce:oI,any:oe,array:oi,bigint:s4,boolean:s5,date:s6,discriminatedUnion:ol,effect:ov,enum:oy,function:op,instanceof:s0,intersection:oc,lazy:og,literal:om,map:od,nan:s3,nativeEnum:ob,never:or,null:s9,nullable:oA,number:s2,object:os,oboolean:o_,onumber:ok,optional:oE,ostring:()=>s1().optional(),pipeline:oS,preprocess:ox,promise:ow,record:oh,set:of,strictObject:oo,string:s1,symbol:s8,transformer:ov,tuple:ou,undefined:s7,union:oa,unknown:ot,void:on,NEVER:oC,ZodIssueCode:i_,quotelessJson:iI,ZodError:iC});let oP=e=>e.message?e.message:"unspecified error";class oR extends tV{constructor(e){super(),this.code=tP,this.errors=e,super.message=`Web3 validator found ${e.length} error[s]:
${this._compileErrors().join("\n")}`}_compileErrors(){return this.errors.map(oP)}}let oO=["bool","int","uint","bytes","string","address","tuple"],oN=e=>"object"==typeof e&&"type"in e&&"name"in e,oD=e=>"string"==typeof e,oB=e=>"string"==typeof e&&/^((-)?0x[0-9a-f]+|(0x))$/i.test(e);function oM(e,t){return"string"==typeof e&&!!e.match(/^0x[0-9A-Fa-f]*$/)&&(void 0===t||!(t>0)||e.length===2+2*t)}let oL=e=>"number"==typeof e||"bigint"==typeof e||"string"==typeof e&&/^((-0x|0x|-)?[0-9a-f]+|(0x))$/i.test(e);function oF(e){if("string"!=typeof e)throw Error(`[isHexPrefixed] input must be type 'string', received type ${typeof e}`);return e.startsWith("0x")}let oU=function(e){for(let[t,r]of Object.entries(e))if(void 0!==r&&r.length>0&&0===r[0])throw Error(`${t} cannot have leading zeroes, received: ${r.toString()}`)},oj=["hex","number","blockNumber","blockNumberOrTag","filter","bloom"],o$=e=>{let t,r=e.replace(/ /,""),n=!1,i=[];if(e.includes("[")&&(r=r.slice(0,r.indexOf("[")),n=(i=[...e.matchAll(/(?:\[(\d*)\])/g)].map(e=>parseInt(e[1],10)).map(e=>Number.isNaN(e)?-1:e)).length>0),oO.includes(r))return{baseType:r,isArray:n,baseTypeSize:t,arraySizes:i};if(r.startsWith("int"))t=parseInt(r.substring(3),10),r="int";else if(r.startsWith("uint"))t=parseInt(e.substring(4),10),r="uint";else{if(!r.startsWith("bytes"))return{baseType:void 0,isArray:!1,baseTypeSize:void 0,arraySizes:i};t=parseInt(r.substring(5),10),r="bytes"}return{baseType:r,isArray:n,baseTypeSize:t,arraySizes:i}},oH=(e,t={})=>{if(Object.keys(t).includes("type"))throw new oR([{keyword:"eth",message:'Either "eth" or "type" can be presented in schema',params:{eth:e},instancePath:"",schemaPath:""}]);let{baseType:r,baseTypeSize:n}=o$(e);if(!r&&!oj.includes(e))throw new oR([{keyword:"eth",message:`Eth data type "${e}" is not valid`,params:{eth:e},instancePath:"",schemaPath:""}]);if(r){if("tuple"===r)throw Error('"tuple" type is not implemented directly.');return{format:`${r}${null!=n?n:""}`,required:!0}}return e?{format:e,required:!0}:{}},oq=(e,t="/0")=>{let r={type:"array",items:[],maxItems:e.length,minItems:e.length};for(let[n,i]of e.entries()){let e,s,o,a=[];oN(i)?(e=i.type,s=i.name||`${t}/${n}`,a=i.components):"string"==typeof i?(e=i,s=`${t}/${n}`):Array.isArray(i)&&(i[0]&&"string"==typeof i[0]&&i[0].startsWith("tuple")&&!Array.isArray(i[0])&&i[1]&&Array.isArray(i[1])?(e=i[0],s=`${t}/${n}`,a=i[1]):(e="tuple",s=`${t}/${n}`,a=i));let{baseType:l,isArray:c,arraySizes:u}=o$(e),h=r;for(let e=u.length-1;e>0;e-=1)o={type:"array",$id:s,items:[],maxItems:u[e],minItems:u[e]},u[e]<0&&(delete o.maxItems,delete o.minItems),Array.isArray(h.items)?0===h.items.length?h.items=[o]:h.items.push(o):h.items=[h.items,o],h=o;if("tuple"!==l||c)if("tuple"===l&&c){let e=u[0],t=Object.assign({type:"array",$id:s,items:oq(a,s)},e>=0&&{minItems:e,maxItems:e});h.items.push(t)}else if(c){let t=u[0],r=Object.assign({type:"array",$id:s,items:oH(e)},t>=0&&{minItems:t,maxItems:t});h.items.push(r)}else Array.isArray(h.items),h.items.push(Object.assign({$id:s},oH(e)));else{let e=oq(a,s);e.$id=s,h.items.push(e)}h=r}return r},oz=e=>oq(e),oV=(e,t)=>1===t?e:oV(e[0],t-1),oK=(e,t,r)=>{let n=[];for(let[i,s]of e.entries()){let e,o,a=[];oN(s)?(e=s.type,o=s.name,a=s.components):"string"==typeof s?e=s:Array.isArray(s)&&(s[1]&&Array.isArray(s[1])?(e=s[0],a=s[1]):(e="tuple",a=s));let{baseType:l,isArray:c,arraySizes:u}=o$(e),h=Array.isArray(t)?t[i]:t[o];if("tuple"!==l||c)if("tuple"===l&&c){let e=[];for(let t of h)if(u.length>1){let n=oV(t,u.length-1),i=[];for(let e of n)i.push(oK(a,e,r));e.push(i)}else e.push(oK(a,t,r));n.push(e)}else n.push(h);else n.push(oK(a,h,r))}return(r=null!=r?r:[]).push(...n),r},oG=e=>{if(e>=48&&e<=57)return e-48;if(e>=65&&e<=70)return e-55;if(e>=97&&e<=102)return e-87;throw Error(`Invalid code point: ${e}`)},oW=e=>{if(!oB(e))throw Error("Invalid hex string");let[t,r]=e.startsWith("-")?[!0,e.slice(1)]:[!1,e],n=BigInt(r);return n>Number.MAX_SAFE_INTEGER?t?-n:n:n<Number.MIN_SAFE_INTEGER?n:t?-1*Number(n):Number(n)},oQ=e=>{if(("number"==typeof e||"bigint"==typeof e)&&e<0)return`-0x${e.toString(16).slice(1)}`;if(("number"==typeof e||"bigint"==typeof e)&&e>=0)return`0x${e.toString(16)}`;if("string"==typeof e&&oB(e)){let[t,r]=e.startsWith("-")?[!0,e.slice(1)]:[!1,e],n=r.split(/^(-)?0(x|X)/).slice(-1)[0];return`${t?"-":""}0x${n.replace(/^0+/,"").toLowerCase()}`}if("string"==typeof e&&!oB(e))return oQ(BigInt(e));throw new r2(e)},oJ=(e,t,r="0")=>{if("string"==typeof e&&!oB(e))return e.padStart(t,r);let n="string"==typeof e&&oB(e)?e:oQ(e),[i,s]=n.startsWith("-")?["-0x",n.slice(3)]:["0x",n.slice(2)];return`${i}${s.padStart(t,r)}`};function oZ(e){let t="0x";for(let r of e){let e=r.toString(16);t+=1===e.length?`0${e}`:e}return t}let oY={zero:48,nine:57,A:65,F:70,a:97,f:102};function oX(e){return e>=oY.zero&&e<=oY.nine?e-oY.zero:e>=oY.A&&e<=oY.F?e-(oY.A-10):e>=oY.a&&e<=oY.f?e-(oY.a-10):void 0}function o0(e){let t=0;if(e.startsWith("0")&&("x"===e[1]||"X"===e[1])&&(t=2),e.length%2!=0)throw new r1(`hex string has odd length: ${e}`);let r=(e.length-t)/2,n=new Uint8Array(r);for(let i=0,s=t;i<r;i+=1){let t=oX(e.charCodeAt(s++)),r=oX(e.charCodeAt(s++));if(void 0===t||void 0===r)throw new r1(`Invalid byte sequence ("${e[s-2]}${e[s-1]}" in "${e}").`);n[i]=16*t+r}return n}function o1(e){var t;return e instanceof Uint8Array||(null==(t=null==e?void 0:e.constructor)?void 0:t.name)!=="Uint8Array"?e:Uint8Array.from(e)}let o2=e=>{var t,r;return e instanceof Uint8Array||(null==(t=null==e?void 0:e.constructor)?void 0:t.name)==="Uint8Array"||(null==(r=null==e?void 0:e.constructor)?void 0:r.name)==="Buffer"},o3=(e,t={abiType:"bytes"})=>{let r;if("string"!=typeof e&&!Array.isArray(e)&&!o2(e)||"string"==typeof e&&oB(e)&&e.startsWith("-")||"string"==typeof e&&!oB(e))return!1;if("string"==typeof e){if(e.length%2!=0)return!1;r=o0(e)}else if(Array.isArray(e)){if(e.some(e=>e<0||e>255||!Number.isInteger(e)))return!1;r=new Uint8Array(e)}else r=e;if(null==t?void 0:t.abiType){let{baseTypeSize:e}=o$(t.abiType);return!e||r.length===e}return null==t||!t.size||r.length===(null==t?void 0:t.size)},o4=e=>{if(!/^(0x)?[0-9a-f]{40}$/i.test(e))return!1;let t=e.slice(2),r=oZ(ix(o1(nX(t.toLowerCase())))).slice(2);for(let e=0;e<40;e+=1)if(parseInt(r[e],16)>7&&t[e].toUpperCase()!==t[e]||7>=parseInt(r[e],16)&&t[e].toLowerCase()!==t[e])return!1;return!0},o5=(e,t=!0)=>{let r;return("string"==typeof e||!!o2(e))&&(r=o2(e)?oZ(e):"string"!=typeof e||oB(e)||e.toLowerCase().startsWith("0x")?e:`0x${e}`,!!/^(0x)?[0-9a-f]{40}$/i.test(r)&&(!!(/^(0x|0X)?[0-9a-f]{40}$/.test(r)||/^(0x|0X)?[0-9A-F]{40}$/.test(r))||!t||o4(r)))},o6=(e,t)=>{if(t===BigInt(0))return BigInt(1);let r=e;for(let n=1;n<t;n+=1)r*=e;return r},o8=(e,t={abiType:"uint"})=>{let r;if(!["number","string","bigint"].includes(typeof e)||"string"==typeof e&&0===e.length)return!1;if(null==t?void 0:t.abiType){let{baseTypeSize:e}=o$(t.abiType);e&&(r=e)}else t.bitSize&&(r=t.bitSize);let n=o6(BigInt(2),BigInt(null!=r?r:256))-BigInt(1);try{let t="string"==typeof e&&oB(e)?BigInt(oW(e)):BigInt(e);return t>=0&&t<=n}catch(e){return!1}},o7=(e,t={abiType:"int"})=>{let r;if(!["number","string","bigint"].includes(typeof e)||"number"==typeof e&&e>Number.MAX_SAFE_INTEGER)return!1;if(null==t?void 0:t.abiType){let{baseTypeSize:e,baseType:n}=o$(t.abiType);if("int"!==n)return!1;e&&(r=e)}else t.bitSize&&(r=t.bitSize);let n=o6(BigInt(2),BigInt((null!=r?r:256)-1)),i=BigInt(-1)*o6(BigInt(2),BigInt((null!=r?r:256)-1));try{let t="string"==typeof e&&oB(e)?BigInt(oW(e)):BigInt(e);return t>=i&&t<=n}catch(e){return!1}},o9=e=>!!(o7(e)||"string"==typeof e&&/[0-9.]/.test(e)&&e.indexOf(".")===e.lastIndexOf("."))||"number"==typeof e,ae=e=>o8(e),at=e=>Object.values(x).includes(e),ar=e=>at(e)||ae(e),an=e=>"string"==typeof e&&!!/^(0x)?[0-9a-f]{512}$/i.test(e)&&!!(/^(0x)?[0-9a-f]{512}$/.test(e)||/^(0x)?[0-9A-F]{512}$/.test(e)),ai=(e,t)=>{if("string"==typeof t&&!oB(t)||!an(e))return!1;let r=oZ(ix("string"==typeof t?o0(t):t)).slice(2);for(let t=0;t<12;t+=4){let n=(parseInt(r.slice(t,t+2),16)<<8)+parseInt(r.slice(t+2,t+4),16)&2047,i=oG(e.charCodeAt(e.length-1-Math.floor(n/4))),s=1<<n%4;if((i&s)!==s)return!1}return!0},as=(e,t)=>!!an(e)&&!!o5(t)&&ai(e,oJ(t,64)),ao=(e,t)=>!!an(e)&&!!o5(t)&&ai(e,t),aa=e=>!!["number","string","boolean"].includes(typeof e)&&("boolean"==typeof e||("string"!=typeof e||oB(e)?"string"==typeof e&&oB(e)?"0x1"===e||"0x0"===e:1===e||0===e:"1"===e||"0"===e)),al=e=>null==e,ac=e=>"object"==typeof e&&!al(e)&&!Array.isArray(e)&&!(e instanceof X),au=e=>"string"==typeof e&&!!/^(0x)?[0-9a-f]{64}$/i.test(e)&&!!(/^(0x)?[0-9a-f]{64}$/.test(e)||/^(0x)?[0-9A-F]{64}$/.test(e)),ah=(e,t)=>!!an(e)&&!!au(t)&&ai(e,t),ad=e=>{let t=["fromBlock","toBlock","address","topics","blockHash"];if(al(e)||"object"!=typeof e||!Object.keys(e).every(e=>t.includes(e))||!al(e.fromBlock)&&!ar(e.fromBlock)||!al(e.toBlock)&&!ar(e.toBlock))return!1;if(!al(e.address)){if(Array.isArray(e.address)){if(!e.address.every(e=>o5(e)))return!1}else if(!o5(e.address))return!1}return!!al(e.topics)||!!e.topics.every(e=>!!al(e)||(Array.isArray(e)?e.every(e=>au(e)):!!au(e)))},af={address:e=>o5(e),bloom:e=>an(e),blockNumber:e=>ae(e),blockTag:e=>at(e),blockNumberOrTag:e=>ar(e),bool:e=>aa(e),bytes:e=>o3(e),filter:e=>ad(e),hex:e=>oB(e),uint:e=>o8(e),int:e=>o7(e),number:e=>o9(e),string:e=>oD(e)};for(let e=8;e<=256;e+=8)af[`int${e}`]=t=>o7(t,{bitSize:e}),af[`uint${e}`]=t=>o8(t,{bitSize:e});for(let e=1;e<=32;e+=1)af[`bytes${e}`]=t=>o3(t,{size:e});af.bytes256=af.bytes;let ap=af,ag=e=>{if((!(null==e?void 0:e.type)||(null==e?void 0:e.type)==="object")&&(null==e?void 0:e.properties)){let t={};for(let r of Object.keys(e.properties)){let n=ag(e.properties[r]);n&&(t[r]=n)}return Array.isArray(e.required)?oT.object(t).partial().required(e.required.reduce((e,t)=>Object.assign(Object.assign({},e),{[t]:!0}),{})):oT.object(t).partial()}if((null==e?void 0:e.type)==="array"&&(null==e?void 0:e.items)){if(Array.isArray(e.items)&&e.items.length>1&&void 0!==e.maxItems&&new Set(e.items.map(e=>e.$id)).size===e.items.length){let t=[];for(let r of e.items){let e=ag(r);e&&t.push(e)}return oT.tuple(t)}let t=Array.isArray(e.items)?e.items[0]:e.items,r=oT.array(ag(t));return r=void 0!==e.minItems?r.min(e.minItems):r,r=void 0!==e.maxItems?r.max(e.maxItems):r}if(e.oneOf&&Array.isArray(e.oneOf))return oT.union(e.oneOf.map(e=>ag(e)));if(null==e?void 0:e.format){if(!ap[e.format])throw new nI(e.format);return oT.any().refine(ap[e.format],t=>({params:{value:t,format:e.format}}))}return(null==e?void 0:e.type)&&(null==e?void 0:e.type)!=="object"&&"function"==typeof oT[String(e.type)]?oT[String(e.type)]():oT.object({data:oT.any()}).partial()};class am{static factory(){return am.validatorInstance||(am.validatorInstance=new am),am.validatorInstance}validate(e,t,r){var n,i;let s=ag(e).safeParse(t);if(!s.success){let e=this.convertErrors(null!=(i=null==(n=s.error)?void 0:n.issues)?i:[]);if(e){if(null==r?void 0:r.silent)return e;throw new oR(e)}}}convertErrors(e){if(e&&Array.isArray(e)&&e.length>0)return e.map(e=>{var t;let r,n,i,s;s=e.path.join("/");let o=String(e.path[e.path.length-1]),a=e.path.join("/");if(e.code===i_.too_big)n="maxItems",s=`${a}/maxItems`,i={limit:e.maximum},r=`must NOT have more than ${e.maximum} items`;else if(e.code===i_.too_small)n="minItems",s=`${a}/minItems`,i={limit:e.minimum},r=`must NOT have fewer than ${e.minimum} items`;else if(e.code===i_.custom){let{value:n,format:o}=null!=(t=e.params)?t:{};r=void 0===n?`value at "/${s}" is required`:`value "${"object"==typeof n?JSON.stringify(n):n}" at "/${s}" must pass "${o}" validation`,i={value:n}}return{keyword:null!=n?n:o,instancePath:a?`/${a}`:"",schemaPath:s?`#${s}`:"#",params:null!=i?i:{value:e.message},message:null!=r?r:e.message}})}}class ay{constructor(){this._validator=am.factory()}validateJSONSchema(e,t,r){return this._validator.validate(e,t,r)}validate(e,t,r={silent:!1}){var n,i;let s=oz(e);if(!Array.isArray(s.items)||(null==(n=s.items)?void 0:n.length)!==0||0!==t.length){if(Array.isArray(s.items)&&(null==(i=s.items)?void 0:i.length)===0&&0!==t.length)throw new oR([{instancePath:"/0",schemaPath:"/",keyword:"required",message:"empty schema against data can not be validated",params:t}]);return this._validator.validate(s,t,r)}}}let ab=new ay;function aw(e){var t,r;return e instanceof Uint8Array||(null==(t=null==e?void 0:e.constructor)?void 0:t.name)==="Uint8Array"||(null==(r=null==e?void 0:e.constructor)?void 0:r.name)==="Buffer"}function av(...e){let t=new Uint8Array(e.reduce((e,t)=>e+t.length,0)),r=0;for(let n of e)t.set(n,r),r+=n.length;return t}function aE(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r+=1)if(e[r]!==t[r])return!1;return!0}let aA={noether:BigInt(0),wei:BigInt(1),kwei:BigInt(1e3),Kwei:BigInt(1e3),babbage:BigInt(1e3),femtoether:BigInt(1e3),mwei:BigInt(1e6),Mwei:BigInt(1e6),lovelace:BigInt(1e6),picoether:BigInt(1e6),gwei:BigInt(1e9),Gwei:BigInt(1e9),shannon:BigInt(1e9),nanoether:BigInt(1e9),nano:BigInt(1e9),szabo:BigInt(1e12),microether:BigInt(1e12),micro:BigInt(1e12),finney:BigInt(1e15),milliether:BigInt(1e15),milli:BigInt(1e15),ether:BigInt("1000000000000000000"),kether:BigInt("1000000000000000000000"),grand:BigInt("1000000000000000000000"),mether:BigInt("1000000000000000000000000"),gether:BigInt("1000000000000000000000000000"),tether:BigInt("1000000000000000000000000000000")},ax="Warning: Using type `number` with values that are large or contain many decimals may cause loss of precision, it is recommended to use type `string` or `BigInt` when using conversion methods",aS=e=>{if(ab.validate(["bytes"],[e]),aw(e))return e;if(Array.isArray(e))return new Uint8Array(e);if("string"==typeof e)return o0(e);throw new r1(e)},{uint8ArrayToHexString:ak}=K,a_=e=>ak(aS(e)),aI=e=>"string"==typeof e&&"0x"!==e.slice(0,2).toLowerCase()?aS(`0x${e}`):aS(e),aC=e=>(ab.validate(["hex"],[e]),oW(e)),aT=aC,aP=(e,t)=>{"bigint"!=typeof e&&ab.validate(["int"],[e]);let r=oQ(e);return t&&(r.startsWith("-")||r.length%2!=1?r.length%2==0&&r.startsWith("-")&&(r="-0x0".concat(r.slice(3))):r="0x0".concat(r.slice(2))),r},aR=aP,aO=e=>aC(e).toString(),aN=e=>{ab.validate(["string"],[e]);let t=e.replace(/^(?:\u0000)/,"");return t=t.replace(/(?:\u0000)$/,""),a_(new TextEncoder().encode(t))},aD=aN,aB=aN,aM=e=>iv(aI(e)),aL=e=>"string"==typeof e?aM(e):(ab.validate(["bytes"],[e]),iv(e)),aF=nX,aU=aM,aj=e=>{ab.validate(["string"],[e]);let t="";for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r).toString(16);t+=n.length%2!=0?`0${n}`:n}return`0x${t}`},a$=aj,aH=e=>new TextDecoder("ascii").decode(aI(e)),aq=aH,az=(e,t)=>{if("string"==typeof e&&o5(e))return t?"address":`0x${e.toLowerCase().replace(/^0x/i,"")}`;if("boolean"==typeof e)return t?"bool":e?"0x01":"0x00";if("number"==typeof e)return t?e<0?"int256":"uint256":aP(e);if("bigint"==typeof e)return t?"bigint":aP(e);if(aw(e))return t?"bytes":a_(e);if("object"==typeof e&&e)return t?"string":aN(JSON.stringify(e));if("string"==typeof e){if(e.startsWith("-0x")||e.startsWith("-0X"))return t?"int256":aP(e);if(oB(e))return t?"bytes":e;if(oL(e)&&!o7(e)&&!o8(e))return t?"bytes":`0x${e}`;if(oL(e)&&!o7(e)&&o8(e))return t?"uint":aP(e);if(!Number.isFinite(e))return t?"string":aN(e)}throw new r8(e)},aV=e=>{if("number"==typeof e)return e>1e20?(console.warn(ax),BigInt(e)):e;if("bigint"==typeof e)return e>=Number.MIN_SAFE_INTEGER&&e<=Number.MAX_SAFE_INTEGER?Number(e):e;if("string"==typeof e&&oB(e))return aC(e);try{return aV(BigInt(e))}catch(t){throw new r2(e)}},aK=e=>{if("number"==typeof e)return BigInt(e);if("bigint"==typeof e)return e;if("string"==typeof e&&oL(e))return e.startsWith("-")?-BigInt(e.substring(1)):BigInt(e);throw new r2(e)},aG=(e,t)=>{let r;if("string"==typeof t){if(!(r=aA[t]))throw new r5(t)}else{if(t<0||!Number.isInteger(t))throw new r6(t);r=o6(BigInt(10),BigInt(t))}let n=String(aV(e)),i=r.toString().length-1;if(i<=0)return n.toString();let s=n.padStart(i,"0"),o=s.slice(0,-i),a=s.slice(-i).replace(/\.?0+$/,"");return""===o?a?`0.${a}`:"0":""===a?o:`${o}.${a}`.slice(0,o.length+i+1)},aW=(e,t)=>{let r;if(ab.validate(["number"],[e]),"string"==typeof t){if(!(r=aA[t]))throw new r5(t)}else{if(t<0||!Number.isInteger(t))throw new r6(t);r=o6(BigInt(10),BigInt(t))}let n=e;"number"==typeof n&&(n<1e-15&&console.warn(ax),n>1e20?(console.warn(ax),n=BigInt(n)):n=n.toLocaleString("fullwide",{useGrouping:!1,maximumFractionDigits:20}));let[i,s]=String("string"==typeof n&&!oB(n)?n:aV(n)).split(".").concat(""),o=BigInt(`${i}${s}`)*r,a=s.length;return 0===a?o.toString():o.toString().slice(0,-a)},aQ=e=>{if(!o5(e,!1))throw new r3(e);let t=e.toLowerCase().replace(/^0x/i,""),r=oZ(ix(o1(aF(t))));if(al(r)||"0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"===r)return"";let n="0x",i=r.replace(/^0x/i,"");for(let e=0;e<t.length;e+=1)parseInt(i[e],16)>7?n+=t[e].toUpperCase():n+=t[e];return n},aJ=e=>{if("boolean"==typeof e)return e;if("number"==typeof e&&(0===e||1===e)||"bigint"==typeof e&&(e===BigInt(0)||e===BigInt(1)))return!!e;if("string"==typeof e&&!oB(e)&&("1"===e||"0"===e||"false"===e||"true"===e))return"true"===e||"false"!==e&&!!Number(e);if("string"==typeof e&&oB(e)&&("0x1"===e||"0x0"===e))return!!aV(e);throw new r9(e)};var aZ=r(15484);class aY extends aZ.A{constructor(){super(...arguments),this.maxListeners=Number.MAX_SAFE_INTEGER}setMaxListeners(e){return this.maxListeners=e,this}getMaxListeners(){return this.maxListeners}}let aX=oB,a0=oL,a1=o4,a2=o5,a3=an,a4=ai,a5=as,a6=ao,a8=au,a7=ah,a9=(e,t)=>{let r="string"==typeof e&&at(e),n="string"==typeof t&&at(t);if(e===t||("earliest"===e||0===e)&&("earliest"===t||0===t))return 0;if("earliest"===e)return -1;if("earliest"===t)return 1;if(r&&n){let r={[x.EARLIEST]:1,[x.FINALIZED]:2,[x.SAFE]:3,[x.LATEST]:4,[x.PENDING]:5};return r[e]<r[t]?-1:1}if(r&&!n||!r&&n)throw new nn("Cannot compare blocktag with provided non-blocktag input.");let i=BigInt(e),s=BigInt(t);return i<s?-1:+(i!==s)},le=e=>"object"==typeof e&&!al(e)&&0!==Object.keys(e).length&&["input","data","from","gas","gasPrice","gasLimit","address","jsonInterface","syncWithContext","dataInputFill"].some(t=>t in e),lt=al,lr=e=>"object"==typeof e&&!al(e)&&!Array.isArray(e)&&!(e instanceof X),ln=(e,...t)=>{if(!lr(e))return e;let r=Object.assign({},e);for(let e of t)for(let t in e)lr(e[t])?(r[t]||(r[t]={}),r[t]=ln(r[t],e[t])):!al(e[t])&&Object.hasOwnProperty.call(e,t)&&(Array.isArray(e[t])||e[t]instanceof X?r[t]=e[t].slice(0):r[t]=e[t]);return r},li=(e,t,r="0")=>"string"==typeof e?oB(e)?oJ(e,t,r):e.padStart(t,r):(ab.validate(["int"],[e]),oJ(e,t,r)),ls=(e,t,r="0")=>{if("string"==typeof e&&!oB(e))return e.padEnd(t,r);let n="string"==typeof e&&oB(e)?e:aP(e),i=n.startsWith("-")?3:2;return ab.validate([n.startsWith("-")?"int":"uint"],[e]),n.padEnd(t+i,r)},lo=ls,la=li,ll=(e,t=64)=>{ab.validate(["int"],[e]);let r=aV(e);if(r>=0)return li(az(r),t);let n=o6(BigInt(2),BigInt(4*t));if(-r>=n)throw new r7(`value: ${e}, nibbleWidth: ${t}`);return li(aP(BigInt(r)+n),t)},lc=(e,t=64)=>{ab.validate(["int"],[e]);let r=aV(e);if(r<0)return r;let n=Math.ceil(Math.log(Number(r))/Math.log(2));if(n>4*t)throw new r7(`value: "${e}", nibbleWidth: "${t}"`);if(4*t!==n)return r;let i=o6(BigInt(2),BigInt(t)*BigInt(4));return aV(BigInt(r)-i)},{parseBaseType:lu}=K,lh=e=>"object"==typeof e&&!al(e)&&"number"in e&&"bytes"in e,ld=(e,t,r=[])=>{let n,i=Object.assign({},e);for(let e of t){if(i.oneOf&&n){let e=n,t=r.find(([t])=>t===e);t&&t[0]===n&&(i=i.oneOf[t[1]])}if(!i.properties&&!i.items)return;i.properties?i=i.properties[e]:i.items&&i.items.properties?i=i.items.properties[e]:i.items&&ac(i.items)?i=i.items:i.items&&Array.isArray(i.items)&&(i=i.items[parseInt(e,10)]),i&&e&&(n=e)}return i},lf=(e,t,r)=>{try{let{baseType:n,baseTypeSize:i}=lu(t);if("int"===n||"uint"===n)switch(r.number){case E.NUMBER:return Number(aK(e));case E.HEX:return aP(aK(e));case E.STR:return aK(e).toString();case E.BIGINT:return aK(e);default:throw new ro(`Invalid format: ${String(r.number)}`)}if("bytes"===n){let t;switch(i?"string"==typeof e?t=li(e,2*i):aw(e)&&(t=av(new Uint8Array(i-e.length),e)):t=e,r.bytes){case A.HEX:return a_(aS(t));case A.UINT8ARRAY:return aS(t);default:throw new ro(`Invalid format: ${String(r.bytes)}`)}}if("string"===n)return String(e)}catch(e){}return e},lp=({value:e,schemaProp:t,schema:r,object:n,key:i,dataPath:s,format:o,oneOfPath:a=[]})=>{var l,c;if(Array.isArray(e)){let u=t;if((null==t?void 0:t.oneOf)!==void 0&&t.oneOf.forEach((r,n)=>{var s,o;Array.isArray(null==t?void 0:t.items)||("object"!=typeof e[0]||(null==(s=null==r?void 0:r.items)?void 0:s.type)!=="object")&&("string"!=typeof e[0]||(null==(o=null==r?void 0:r.items)?void 0:o.type)==="object")||(u=r,a.push([i,n]))}),al(null==u?void 0:u.items))return delete n[i],s.pop(),!0;if(ac(u.items)&&!al(u.items.format)){for(let t=0;t<e.length;t+=1)n[i][t]=lf(e[t],null==(l=null==u?void 0:u.items)?void 0:l.format,o);return s.pop(),!0}if(!Array.isArray(null==u?void 0:u.items)&&(null==(c=null==u?void 0:u.items)?void 0:c.type)==="object"){for(let t of e)lg(t,r,s,o,a);return s.pop(),!0}if(Array.isArray(null==u?void 0:u.items)){for(let t=0;t<e.length;t+=1)n[i][t]=lf(e[t],u.items[t].format,o);return s.pop(),!0}}return!1},lg=(e,t,r,n,i=[])=>{var s;if(!ac(e)&&!Array.isArray(e))return lf(e,null==t?void 0:t.format,n);let o=e;if(Array.isArray(o)&&(null==t?void 0:t.type)==="array"&&(null==(s=null==t?void 0:t.items)?void 0:s.type)==="object")lp({value:o,schemaProp:t,schema:t,object:o,key:"",dataPath:r,format:n,oneOfPath:i});else for(let[e,s]of Object.entries(o)){r.push(e);let a=ld(t,r,i);if(al(a)){delete o[e],r.pop();continue}if(ac(s)){lg(s,t,r,n,i),r.pop();continue}if(!lp({value:s,schemaProp:a,schema:t,object:o,key:e,dataPath:r,format:n,oneOfPath:i})){if((null==a?void 0:a.format)===void 0&&(null==a?void 0:a.oneOf)!==void 0){for(let[e,t]of a.oneOf.entries())if((null==t?void 0:t.format)!==void 0){a=t;break}}o[e]=lf(s,a.format,n),r.pop()}}return o},lm=(e,t,r=Z)=>{let n;n=ac(t)?ln({},t):Array.isArray(t)?[...t]:t;let i=ac(e)?e:oz(e);if(!i.properties&&!i.items&&!i.format)throw new ro("Invalid json schema for formatting");return lg(n,i,[],r)},ly="0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",lb=e=>{let t;return a_(ix(o1(t="bigint"==typeof e||"number"==typeof e?nX(e.toString()):Array.isArray(e)?new Uint8Array(e):"string"!=typeof e||oB(e)?aS(e):nX(e))))},lw=e=>{let t,r=lb(t="string"==typeof e?e.startsWith("0x")&&oB(e)?aI(e):nX(e):e);return r===ly?void 0:r},lv=e=>{let t=lw(e);return al(t)?ly:t},lE=e=>{let t,r;if(Array.isArray(e))throw Error("Autodetection of array types is not supported.");if("object"==typeof e&&("t"in e||"type"in e)&&("v"in e||"value"in e))t="t"in e?e.t:e.type,r="v"in e?e.v:e.value,t="bigint"===t.toLowerCase()?"int":t;else{if("bigint"==typeof e)return["int",e];t=az(e,!0),r=az(e),t.startsWith("int")||t.startsWith("uint")||(t="bytes")}return(t.startsWith("int")||t.startsWith("uint"))&&"string"==typeof r&&!/^(-)?0x/i.test(r)&&(r=aK(r)),[t,r]},lA=e=>e.startsWith("int[")?`int256${e.slice(3)}`:"int"===e?"int256":e.startsWith("uint[")?`uint256'${e.slice(4)}`:"uint"===e?"uint256":e,lx=(e,t)=>{let r=/^(\d+).*$/.exec(e.slice(t));return r?parseInt(r[1],10):0},lS=e=>e.toString(2).length,lk=(e,t)=>{let r=t.toString();if("string"===e){if("string"==typeof t)return aN(t);throw new r4(t)}if("bool"===e||"boolean"===e){if("boolean"==typeof t)return t?"01":"00";throw new r9(t)}if("address"===e){if(!o5(r))throw new r3(r);return r}let n=lA(e);if(e.startsWith("uint")){let e=lx(n,4);if(e%8||e<8||e>256)throw new nt(r);let t=aV(r);if(lS(t)>e)throw new nr(r);if(t<BigInt(0))throw new ne(r);return e?la(t.toString(16),e/8*2):t.toString(16)}if(e.startsWith("int")){let t=lx(n,3);if(t%8||t<8||t>256)throw new nt(e);let i=aV(r);if(lS(i)>t)throw new nr(r);return i<BigInt(0)?ll(i.toString(),t/8*2):t?la(i.toString(16),t/4):i.toString(16)}if("bytes"===n){if(r.replace(/^0x/i,"").length%2!=0)throw new r1(r);return r}if(e.startsWith("bytes")){if(r.replace(/^0x/i,"").length%2!=0)throw new r1(r);let t=lx(e,5);if(!t||t<1||t>64||t<r.replace(/^0x/i,"").length/2)throw new r1(r);return lo(r,2*t)}return""},l_=e=>{let[t,r]=lE(e);return Array.isArray(r)?r.map(e=>lk(t,e).replace("0x","")).join(""):lk(t,r).replace("0x","")},lI=(...e)=>{let t=e.map(l_);return`0x${t.join("").toLowerCase()}`},lC=(...e)=>lw(lI(...e)),lT=(...e)=>lv(lI(...e)),lP=e=>lw(`0x${("number"==typeof e?e.toString():e).padStart(64,"0")}`);function lR(e){return n6(e)}let lO=e=>lR(e),lN=e=>a_(lO(e));var lD=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function lB(e){return("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}function lM(e,t,r){return lD(this,void 0,void 0,function*(){let n,i=yield Promise.race([e instanceof Promise?e:e(),new Promise((e,i)=>{n=setTimeout(()=>r?i(r):e(void 0),t)})]);if(n&&clearTimeout(n),i instanceof Error)throw i;return i})}function lL(e,t){let r;return[new Promise((n,i)=>{r=setInterval(function s(){return lD(this,void 0,void 0,function*(){try{let i=yield lM(e,t);al(i)||(clearInterval(r),n(i))}catch(e){clearInterval(r),i(e)}}),s}(),t)}),r]}function lF(e,t){return lD(this,void 0,void 0,function*(){return lL(e,t)[0]})}function lU(e,t){let r,n=new Promise((n,i)=>{r=setTimeout(()=>{i(t)},e)});return[r,n]}function lj(e,t){let r,n=new Promise((n,i)=>{r=setInterval(()=>{lD(this,void 0,void 0,function*(){let t=yield e();t&&(clearInterval(r),i(t))})},t)});return[r,n]}let l$=()=>{let e=lO(16);e[6]=15&e[6]|64,e[8]=63&e[8]|128;let t=a_(e);return[t.substring(2,10),t.substring(10,14),t.substring(14,18),t.substring(18,22),t.substring(22,34)].join("-")},lH=e=>{let t=e.error.code;return n_.has(t)||t>=-32099&&t<=-32e3},lq=e=>!Array.isArray(e)&&!!e&&"2.0"===e.jsonrpc&&"result"in e&&al(e.error)&&("number"==typeof e.id||"string"==typeof e.id),lz=e=>!Array.isArray(e)&&"2.0"===e.jsonrpc&&!!e&&al(e.result)&&"error"in e&&("number"==typeof e.id||"string"==typeof e.id),lV=e=>!Array.isArray(e)&&!!e&&"2.0"===e.jsonrpc&&!al(e.params)&&!al(e.method),lK=e=>!Array.isArray(e)&&!!e&&"2.0"===e.jsonrpc&&"id"in e&&"result"in e,lG=e=>lq(e)||lz(e),lW=e=>Array.isArray(e)?e.every(lG):lG(e),lQ=e=>Array.isArray(e)&&e.length>0&&lW(e),lJ=e=>{i=e},lZ=e=>{var t,r,n,s;return void 0!==i&&(i+=1),{jsonrpc:null!=(t=e.jsonrpc)?t:"2.0",id:null!=(n=null!=(r=e.id)?r:i)?n:l$(),method:e.method,params:null!=(s=e.params)?s:void 0}},lY=e=>e.map(e=>lZ(e)),lX=e=>Array.isArray(e)&&e.length>0;var l0=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class l1{constructor({timeout:e,eagerStart:t,timeoutMessage:r}={timeout:0,eagerStart:!1,timeoutMessage:"DeferredPromise timed out"}){this[R]="Promise",this._state="pending",this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t}),this._timeoutMessage=r,this._timeoutInterval=e,t&&this.startTimer()}get state(){return this._state}then(e,t){return l0(this,void 0,void 0,function*(){return this._promise.then(e,t)})}catch(e){return l0(this,void 0,void 0,function*(){return this._promise.catch(e)})}finally(e){return l0(this,void 0,void 0,function*(){return this._promise.finally(e)})}resolve(e){this._resolve(e),this._state="fulfilled",this._clearTimeout()}reject(e){this._reject(e),this._state="rejected",this._clearTimeout()}startTimer(){this._timeoutInterval&&this._timeoutInterval>0&&(this._timeoutId=setTimeout(this._checkTimeout.bind(this),this._timeoutInterval))}_checkTimeout(){"pending"===this._state&&this._timeoutId&&this.reject(new rl(this._timeoutMessage))}_clearTimeout(){this._timeoutId&&clearTimeout(this._timeoutId)}}R=Symbol.toStringTag;class l2{constructor(e,t){this.eventEmitter=e,this.autoReconnect=t,this.chunkTimeout=15e3}clearQueues(){"function"==typeof this._clearQueues&&this._clearQueues()}onError(e){this._clearQueues=e}parseResponse(e){let t=[];return e.replace(/\}[\n\r]?\{/g,"}|--|{").replace(/\}\][\n\r]?\[\{/g,"}]|--|[{").replace(/\}[\n\r]?\[\{/g,"}|--|[{").replace(/\}\][\n\r]?\{/g,"}]|--|{").split("|--|").forEach(e=>{let r,n=e;this.lastChunk&&(n=this.lastChunk+n);try{r=JSON.parse(n)}catch(e){this.lastChunk=n,this.lastChunkTimeout&&clearTimeout(this.lastChunkTimeout),this.lastChunkTimeout=setTimeout(()=>{this.autoReconnect||(this.clearQueues(),this.eventEmitter.emit("error",new na({id:1,jsonrpc:"2.0",error:{code:2,message:"Chunk timeout"}})))},this.chunkTimeout);return}clearTimeout(this.lastChunkTimeout),this.lastChunk=void 0,r&&t.push(r)}),t}}var l3=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class l4 extends er{constructor(){super(...arguments),this._eventEmitter=new aZ.b,this._chainId="",this._accounts=[]}_getChainId(){return l3(this,void 0,void 0,function*(){var e;let t=yield this.request(lZ({method:"eth_chainId",params:[]}));return null!=(e=null==t?void 0:t.result)?e:""})}_getAccounts(){return l3(this,void 0,void 0,function*(){var e;let t=yield this.request(lZ({method:"eth_accounts",params:[]}));return null!=(e=null==t?void 0:t.result)?e:[]})}_onConnect(){Promise.all([this._getChainId().then(e=>{e!==this._chainId&&(this._chainId=e,this._eventEmitter.emit("chainChanged",this._chainId))}).catch(e=>{console.error(e)}),this._getAccounts().then(e=>{this._accounts.length===e.length&&e.every(t=>e.includes(t))||(this._accounts=e,this._onAccountsChanged())}).catch(e=>{console.error(e)})]).then(()=>this._eventEmitter.emit("connect",{chainId:this._chainId})).catch(e=>{console.error(e)})}_onDisconnect(e,t){this._eventEmitter.emit("disconnect",new nf(e,t))}_onAccountsChanged(){this._eventEmitter.emit("accountsChanged",this._accounts)}}var l5=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let l6={autoReconnect:!0,delay:5e3,maxAttempts:5},l8=1e3;class l7 extends l4{get SocketConnection(){return this._socketConnection}constructor(e,t,r){if(super(),this._connectionStatus="connecting",this._onMessageHandler=this._onMessage.bind(this),this._onOpenHandler=this._onConnect.bind(this),this._onCloseHandler=this._onCloseEvent.bind(this),this._onErrorHandler=this._onError.bind(this),!this._validateProviderPath(e))throw new rf(e);this._socketPath=e,this._socketOptions=t,this._reconnectOptions=Object.assign(Object.assign({},l6),null!=r?r:{}),this._pendingRequestsQueue=new Map,this._sentRequestsQueue=new Map,this._init(),this.connect(),this.chunkResponseParser=new l2(this._eventEmitter,this._reconnectOptions.autoReconnect),this.chunkResponseParser.onError(()=>{this._clearQueues()}),this.isReconnecting=!1}_init(){this._reconnectAttempts=0}connect(){try{this._openSocketConnection(),this._connectionStatus="connecting",this._addSocketListeners()}catch(e){if(this.isReconnecting)setImmediate(()=>{this._reconnect()});else{if(this._connectionStatus="disconnected",e&&e.message)throw new t3(`Error while connecting to ${this._socketPath}. Reason: ${e.message}`);throw new rf(this._socketPath)}}}_validateProviderPath(e){return!!e}getPendingRequestQueueSize(){return this._pendingRequestsQueue.size}getSentRequestsQueueSize(){return this._sentRequestsQueue.size}supportsSubscriptions(){return!0}on(e,t){this._eventEmitter.on(e,t)}once(e,t){this._eventEmitter.once(e,t)}removeListener(e,t){this._eventEmitter.removeListener(e,t)}_onDisconnect(e,t){this._connectionStatus="disconnected",super._onDisconnect(e,t)}disconnect(e,t){let r=null!=e?e:l8;this._removeSocketListeners(),"disconnected"!==this.getStatus()&&this._closeSocketConnection(r,t),this._onDisconnect(r,t)}safeDisconnect(e,t){return l5(this,arguments,void 0,function*(e,t,r=!1,n=1e3){let i=0,s=()=>l5(this,void 0,void 0,function*(){return new Promise(e=>{let t=setInterval(()=>{r&&i>=5&&this.clearQueues(),0===this.getPendingRequestQueueSize()&&0===this.getSentRequestsQueueSize()&&(clearInterval(t),e(!0)),i+=1},n)})});yield s(),this.disconnect(e,t)})}removeAllListeners(e){this._eventEmitter.removeAllListeners(e)}_onError(e){this.isReconnecting?this._reconnect():this._eventEmitter.emit("error",e)}reset(){this._sentRequestsQueue.clear(),this._pendingRequestsQueue.clear(),this._init(),this._removeSocketListeners(),this._addSocketListeners()}_reconnect(){this.isReconnecting||(this.isReconnecting=!0,this._sentRequestsQueue.size>0&&this._sentRequestsQueue.forEach((e,t)=>{e.deferredPromise.reject(new t6),this._sentRequestsQueue.delete(t)}),this._reconnectAttempts<this._reconnectOptions.maxAttempts?(this._reconnectAttempts+=1,setTimeout(()=>{this._removeSocketListeners(),this.connect(),this.isReconnecting=!1},this._reconnectOptions.delay)):(this.isReconnecting=!1,this._clearQueues(),this._removeSocketListeners(),this._eventEmitter.emit("error",new t5(this._reconnectOptions.maxAttempts))))}request(e){return l5(this,void 0,void 0,function*(){if(lt(this._socketConnection))throw Error("Connection is undefined");"disconnected"===this.getStatus()&&this.connect();let t=lX(e)?e[0].id:e.id;if(!t)throw new rg("Request Id not defined");if(this._sentRequestsQueue.has(t))throw new t8(t);let r=new l1;r.catch(e=>{this._eventEmitter.emit("error",e)});let n={payload:e,deferredPromise:r};if("connecting"===this.getStatus())return this._pendingRequestsQueue.set(t,n),n.deferredPromise;this._sentRequestsQueue.set(t,n);try{this._sendToSocket(n.payload)}catch(e){this._sentRequestsQueue.delete(t),this._eventEmitter.emit("error",e)}return r})}_onConnect(){this._connectionStatus="connected",this._reconnectAttempts=0,super._onConnect(),this._sendPendingRequests()}_sendPendingRequests(){for(let[e,t]of this._pendingRequestsQueue.entries())try{this._sendToSocket(t.payload),this._pendingRequestsQueue.delete(e),this._sentRequestsQueue.set(e,t)}catch(t){this._pendingRequestsQueue.delete(e),this._eventEmitter.emit("error",t)}}_onMessage(e){let t=this._parseResponses(e);if(!lt(t)&&0!==t.length)for(let e of t){if(lV(e)&&e.method.endsWith("_subscription"))return void this._eventEmitter.emit("message",e);let t=lQ(e)?e[0].id:e.id,r=this._sentRequestsQueue.get(t);if(!r)return;(lQ(e)||lq(e)||lz(e))&&(this._eventEmitter.emit("message",e),r.deferredPromise.resolve(e)),this._sentRequestsQueue.delete(t)}}clearQueues(e){this._clearQueues(e)}_clearQueues(e){this._pendingRequestsQueue.size>0&&this._pendingRequestsQueue.forEach((t,r)=>{t.deferredPromise.reject(new t4(e)),this._pendingRequestsQueue.delete(r)}),this._sentRequestsQueue.size>0&&this._sentRequestsQueue.forEach((t,r)=>{t.deferredPromise.reject(new t4(e)),this._sentRequestsQueue.delete(r)}),this._removeSocketListeners()}}class l9{constructor(){this._emitter=new aY}on(e,t){this._emitter.on(e,t)}once(e,t){this._emitter.once(e,t)}off(e,t){this._emitter.off(e,t)}emit(e,t){this._emitter.emit(e,t)}listenerCount(e){return this._emitter.listenerCount(e)}listeners(e){return this._emitter.listeners(e)}eventNames(){return this._emitter.eventNames()}removeAllListeners(){return this._emitter.removeAllListeners()}setMaxListenerWarningThreshold(e){this._emitter.setMaxListeners(e)}getMaxListeners(){return this._emitter.getMaxListeners()}}!function(e){e.CONFIG_CHANGE="CONFIG_CHANGE"}(O||(O={}));class ce extends l9{constructor(e){super(),this.config={handleRevert:!1,defaultAccount:void 0,defaultBlock:"latest",transactionBlockTimeout:50,transactionConfirmationBlocks:24,transactionPollingInterval:1e3,transactionPollingTimeout:75e4,transactionReceiptPollingInterval:void 0,transactionSendTimeout:75e4,transactionConfirmationPollingInterval:void 0,blockHeaderTimeout:10,maxListenersWarningThreshold:100,contractDataInputFill:"data",defaultNetworkId:void 0,defaultChain:"mainnet",defaultHardfork:"london",defaultCommon:void 0,defaultTransactionType:"0x2",defaultMaxPriorityFeePerGas:az(25e8),enableExperimentalFeatures:{useSubscriptionWhenCheckingBlockTimeout:!1,useRpcCallSpecification:!1},transactionBuilder:void 0,transactionTypeParser:void 0,customTransactionSchema:void 0,defaultReturnFormat:Z,ignoreGasPricing:!1},this.setConfig(null!=e?e:{})}setConfig(e){for(let t of Object.keys(e))this._triggerConfigChange(t,e[t]),lt(e[t])||"number"!=typeof e[t]||"maxListenersWarningThreshold"!==t||this.setMaxListenerWarningThreshold(Number(e[t]));Object.assign(this.config,e)}get handleRevert(){return this.config.handleRevert}set handleRevert(e){this._triggerConfigChange("handleRevert",e),this.config.handleRevert=e}get contractDataInputFill(){return this.config.contractDataInputFill}set contractDataInputFill(e){this._triggerConfigChange("contractDataInputFill",e),this.config.contractDataInputFill=e}get defaultAccount(){return this.config.defaultAccount}set defaultAccount(e){this._triggerConfigChange("defaultAccount",e),this.config.defaultAccount=e}get defaultBlock(){return this.config.defaultBlock}set defaultBlock(e){this._triggerConfigChange("defaultBlock",e),this.config.defaultBlock=e}get transactionSendTimeout(){return this.config.transactionSendTimeout}set transactionSendTimeout(e){this._triggerConfigChange("transactionSendTimeout",e),this.config.transactionSendTimeout=e}get transactionBlockTimeout(){return this.config.transactionBlockTimeout}set transactionBlockTimeout(e){this._triggerConfigChange("transactionBlockTimeout",e),this.config.transactionBlockTimeout=e}get transactionConfirmationBlocks(){return this.config.transactionConfirmationBlocks}set transactionConfirmationBlocks(e){this._triggerConfigChange("transactionConfirmationBlocks",e),this.config.transactionConfirmationBlocks=e}get transactionPollingInterval(){return this.config.transactionPollingInterval}set transactionPollingInterval(e){this._triggerConfigChange("transactionPollingInterval",e),this.config.transactionPollingInterval=e,this.transactionReceiptPollingInterval=e,this.transactionConfirmationPollingInterval=e}get transactionPollingTimeout(){return this.config.transactionPollingTimeout}set transactionPollingTimeout(e){this._triggerConfigChange("transactionPollingTimeout",e),this.config.transactionPollingTimeout=e}get transactionReceiptPollingInterval(){return this.config.transactionReceiptPollingInterval}set transactionReceiptPollingInterval(e){this._triggerConfigChange("transactionReceiptPollingInterval",e),this.config.transactionReceiptPollingInterval=e}get transactionConfirmationPollingInterval(){return this.config.transactionConfirmationPollingInterval}set transactionConfirmationPollingInterval(e){this._triggerConfigChange("transactionConfirmationPollingInterval",e),this.config.transactionConfirmationPollingInterval=e}get blockHeaderTimeout(){return this.config.blockHeaderTimeout}set blockHeaderTimeout(e){this._triggerConfigChange("blockHeaderTimeout",e),this.config.blockHeaderTimeout=e}get enableExperimentalFeatures(){return this.config.enableExperimentalFeatures}set enableExperimentalFeatures(e){this._triggerConfigChange("enableExperimentalFeatures",e),this.config.enableExperimentalFeatures=e}get maxListenersWarningThreshold(){return this.config.maxListenersWarningThreshold}set maxListenersWarningThreshold(e){this._triggerConfigChange("maxListenersWarningThreshold",e),this.setMaxListenerWarningThreshold(e),this.config.maxListenersWarningThreshold=e}get defaultReturnFormat(){return this.config.defaultReturnFormat}set defaultReturnFormat(e){this._triggerConfigChange("defaultReturnFormat",e),this.config.defaultReturnFormat=e}get defaultNetworkId(){return this.config.defaultNetworkId}set defaultNetworkId(e){this._triggerConfigChange("defaultNetworkId",e),this.config.defaultNetworkId=e}get defaultChain(){return this.config.defaultChain}set defaultChain(e){if(!lt(this.config.defaultCommon)&&!lt(this.config.defaultCommon.baseChain)&&e!==this.config.defaultCommon.baseChain)throw new nc(this.config.defaultChain,e);this._triggerConfigChange("defaultChain",e),this.config.defaultChain=e}get defaultHardfork(){return this.config.defaultHardfork}set defaultHardfork(e){if(!lt(this.config.defaultCommon)&&!lt(this.config.defaultCommon.hardfork)&&e!==this.config.defaultCommon.hardfork)throw new nl(this.config.defaultCommon.hardfork,e);this._triggerConfigChange("defaultHardfork",e),this.config.defaultHardfork=e}get defaultCommon(){return this.config.defaultCommon}set defaultCommon(e){if(!lt(this.config.defaultHardfork)&&!lt(e)&&!lt(e.hardfork)&&this.config.defaultHardfork!==e.hardfork)throw new nl(this.config.defaultHardfork,e.hardfork);if(!lt(this.config.defaultChain)&&!lt(e)&&!lt(e.baseChain)&&this.config.defaultChain!==e.baseChain)throw new nc(this.config.defaultChain,e.baseChain);this._triggerConfigChange("defaultCommon",e),this.config.defaultCommon=e}get ignoreGasPricing(){return this.config.ignoreGasPricing}set ignoreGasPricing(e){this._triggerConfigChange("ignoreGasPricing",e),this.config.ignoreGasPricing=e}get defaultTransactionType(){return this.config.defaultTransactionType}set defaultTransactionType(e){this._triggerConfigChange("defaultTransactionType",e),this.config.defaultTransactionType=e}get defaultMaxPriorityFeePerGas(){return this.config.defaultMaxPriorityFeePerGas}set defaultMaxPriorityFeePerGas(e){this._triggerConfigChange("defaultMaxPriorityFeePerGas",e),this.config.defaultMaxPriorityFeePerGas=e}get transactionBuilder(){return this.config.transactionBuilder}set transactionBuilder(e){this._triggerConfigChange("transactionBuilder",e),this.config.transactionBuilder=e}get transactionTypeParser(){return this.config.transactionTypeParser}set transactionTypeParser(e){this._triggerConfigChange("transactionTypeParser",e),this.config.transactionTypeParser=e}get customTransactionSchema(){return this.config.customTransactionSchema}set customTransactionSchema(e){this._triggerConfigChange("customTransactionSchema",e),this.config.customTransactionSchema=e}_triggerConfigChange(e,t){this.emit(O.CONFIG_CHANGE,{name:e,oldValue:this.config[e],newValue:t})}}var ct=r(95120),cr=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class cn extends er{constructor(e,t){if(super(),!cn.validateClientUrl(e))throw new rf(e);this.clientUrl=e,this.httpProviderOptions=t}static validateClientUrl(e){return"string"==typeof e&&/^http(s)?:\/\//i.test(e)}getStatus(){throw new ra}supportsSubscriptions(){return!1}request(e,t){var r;return cr(this,void 0,void 0,function*(){let n=Object.assign(Object.assign({},null==(r=this.httpProviderOptions)?void 0:r.providerOptions),t),i=yield ct(this.clientUrl,Object.assign(Object.assign({},n),{method:"POST",headers:Object.assign(Object.assign({},n.headers),{"Content-Type":"application/json"}),body:JSON.stringify(e)}));if(!i.ok)throw new no((yield i.json()),void 0,void 0,i.status);return yield i.json()})}on(){throw new ra}removeListener(){throw new ra}once(){throw new ra}removeAllListeners(){throw new ra}connect(){throw new ra}disconnect(){throw new ra}reset(){throw new ra}reconnect(){throw new ra}}var ci=null;"undefined"!=typeof WebSocket?ci=WebSocket:"undefined"!=typeof MozWebSocket?ci=MozWebSocket:void 0!==r.g?ci=r.g.WebSocket||r.g.MozWebSocket:"undefined"!=typeof window?ci=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(ci=self.WebSocket||self.MozWebSocket);let cs=ci;class co extends l7{constructor(e,t,r){super(e,t,r)}_validateProviderPath(e){return"string"==typeof e&&/^ws(s)?:\/\//i.test(e)}getStatus(){if(this._socketConnection&&!lt(this._socketConnection))switch(this._socketConnection.readyState){case this._socketConnection.CONNECTING:return"connecting";case this._socketConnection.OPEN:return"connected"}return"disconnected"}_openSocketConnection(){this._socketConnection=new cs(this._socketPath,void 0,this._socketOptions&&0===Object.keys(this._socketOptions).length?void 0:this._socketOptions)}_closeSocketConnection(e,t){var r;null==(r=this._socketConnection)||r.close(e,t)}_sendToSocket(e){var t;if("disconnected"===this.getStatus())throw new t4;null==(t=this._socketConnection)||t.send(JSON.stringify(e))}_parseResponses(e){return this.chunkResponseParser.parseResponse(e.data)}_addSocketListeners(){var e,t,r,n;null==(e=this._socketConnection)||e.addEventListener("open",this._onOpenHandler),null==(t=this._socketConnection)||t.addEventListener("message",this._onMessageHandler),null==(r=this._socketConnection)||r.addEventListener("close",e=>this._onCloseHandler(e)),null==(n=this._socketConnection)||n.addEventListener("error",this._onErrorHandler)}_removeSocketListeners(){var e,t,r;null==(e=this._socketConnection)||e.removeEventListener("message",this._onMessageHandler),null==(t=this._socketConnection)||t.removeEventListener("open",this._onOpenHandler),null==(r=this._socketConnection)||r.removeEventListener("close",this._onCloseHandler)}_onCloseEvent(e){var t;if(this._reconnectOptions.autoReconnect&&(![1e3,1001].includes(e.code)||!e.wasClean))return void this._reconnect();this._clearQueues(e),this._removeSocketListeners(),this._onDisconnect(e.code,e.reason),null==(t=this._socketConnection)||t.removeEventListener("error",this._onErrorHandler)}}let ca=e=>er.isWeb3Provider(e),cl=e=>"string"!=typeof e&&"request"in e&&"Function"===e.request.constructor.name,cc=e=>"string"!=typeof e&&"request"in e&&"AsyncFunction"===e.request.constructor.name,cu=e=>"string"!=typeof e&&"send"in e,ch=e=>"string"!=typeof e&&"sendAsync"in e,cd=e=>e&&(ca(e)||cc(e)||cl(e)||ch(e)||cu(e)),cf=e=>e&&"supportsSubscriptions"in e?e.supportsSubscriptions():!!e&&"string"!=typeof e&&"on"in e;var cp=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};!function(e){e.PROVIDER_CHANGED="PROVIDER_CHANGED",e.BEFORE_PROVIDER_CHANGE="BEFORE_PROVIDER_CHANGE"}(N||(N={}));let cg={HttpProvider:cn,WebsocketProvider:co};class cm extends l9{constructor(e,t,r){super(),lt(e)||this.setProvider(e),this.useRpcCallSpecification=t,lt(r)||(this.middleware=r)}static get providers(){return cg}get provider(){return this._provider}get providers(){return cg}setProvider(e){let t;if(e&&"string"==typeof e&&this.providers)if(/^http(s)?:\/\//i.test(e))t=new this.providers.HttpProvider(e);else if(/^ws(s)?:\/\//i.test(e))t=new this.providers.WebsocketProvider(e);else throw new rd(`Can't autodetect provider for "${e}"`);else t=lt(e)?void 0:e;return this.emit(N.BEFORE_PROVIDER_CHANGE,this._provider),this._provider=t,this.emit(N.PROVIDER_CHANGED,this._provider),!0}setMiddleware(e){this.middleware=e}send(e){return cp(this,void 0,void 0,function*(){let t=Object.assign({},e),r=yield this._sendRequest(t);if(lt(this.middleware)||(r=yield this.middleware.processResponse(r)),lq(r))return r.result;throw new no(r)})}sendBatch(e){return cp(this,void 0,void 0,function*(){return yield this._sendRequest(e)})}_sendRequest(e){return cp(this,void 0,void 0,function*(){let{provider:t}=this;if(lt(t))throw new rd("Provider not available. Use `.setProvider` or `.provider=` to initialize the provider.");let r=lX(e)?lY(e):lZ(e);if(lt(this.middleware)||(r=yield this.middleware.processRequest(r)),ca(t)){let e;try{e=yield t.request(r)}catch(t){e=t}return this._processJsonRpcResponse(r,e,{legacy:!1,error:!1})}if(cc(t))return t.request(r).then(e=>this._processJsonRpcResponse(r,e,{legacy:!0,error:!1})).catch(e=>this._processJsonRpcResponse(r,e,{legacy:!0,error:!0}));if(cl(t))return new Promise((e,n)=>{let i=e=>{n(this._processJsonRpcResponse(r,e,{legacy:!0,error:!0}))},s=t=>e(this._processJsonRpcResponse(r,t,{legacy:!0,error:!1})),o=t.request(r,(e,t)=>e?i(e):s(t));lB(o)&&o.then(s).catch(e=>{try{let t=this._processJsonRpcResponse(r,e,{legacy:!0,error:!0});n(t)}catch(e){n(e)}})});if(cu(t))return new Promise((e,n)=>{t.send(r,(t,i)=>{if(t)return n(this._processJsonRpcResponse(r,t,{legacy:!0,error:!0}));if(lt(i))throw new no({},'Got a "nullish" response from provider.');return e(this._processJsonRpcResponse(r,i,{legacy:!0,error:!1}))})});if(ch(t))return t.sendAsync(r).then(e=>this._processJsonRpcResponse(r,e,{legacy:!0,error:!1})).catch(e=>this._processJsonRpcResponse(r,e,{legacy:!0,error:!0}));throw new rd("Provider does not have a request or send method to use.")})}_processJsonRpcResponse(e,t,{legacy:r,error:n}){if(lt(t))return this._buildResponse(e,null,n);if(lz(t)){if(this.useRpcCallSpecification&&lH(t)){let e=t;if(n_.get(e.error.code))throw new(n_.get(e.error.code)).error(e);throw new nd(e)}else if(!cm._isReverted(t))throw new na(t,e)}if(lq(t))return t;if(t instanceof Error)throw cm._isReverted(t),t;if(!r&&lX(e)&&lQ(t)||r&&!n&&lX(e))return t;if(r&&n&&lX(e))throw t;if(r&&!lz(t)&&!lq(t))return this._buildResponse(e,t,n);if(lX(e)&&!Array.isArray(t))throw new no(t,"Got normal response for a batch request.");if(!lX(e)&&Array.isArray(t))throw new no(t,"Got batch response for a normal request.");throw new no(t,"Invalid response")}static _isReverted(e){let t;if(lz(e)?t=e.error:e instanceof Error&&(t=e),null==t?void 0:t.message.includes("revert"))throw new rt(t);return!1}_buildResponse(e,t,r){let n={jsonrpc:"2.0",id:lX(e)?e[0].id:"id"in e?e.id:null};return r?Object.assign(Object.assign({},n),{error:t}):Object.assign(Object.assign({},n),{result:t})}}var cy=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class cb{constructor(e,t,r=!1){this.requestManager=e,this.registeredSubscriptions=t,this.tolerateUnlinkedSubscription=r,this._subscriptions=new Map,this.requestManager.on(N.BEFORE_PROVIDER_CHANGE,()=>cy(this,void 0,void 0,function*(){yield this.unsubscribe()})),this.requestManager.on(N.PROVIDER_CHANGED,()=>{this.clear(),this.listenToProviderEvents()}),this.listenToProviderEvents()}listenToProviderEvents(){let e=this.requestManager.provider;this.requestManager.provider&&("function"!=typeof(null==e?void 0:e.supportsSubscriptions)||(null==e?void 0:e.supportsSubscriptions()))&&"function"==typeof this.requestManager.provider.on&&("function"==typeof this.requestManager.provider.request?this.requestManager.provider.on("message",e=>this.messageListener(e)):e.on("data",e=>this.messageListener(e)))}messageListener(e){var t,r,n;if(!e)throw new rp("Should not call messageListener with no data. Type was");let i=(null==(t=e.params)?void 0:t.subscription)||(null==(r=e.data)?void 0:r.subscription)||(null==(n=e.id)?void 0:n.toString(16));if(i){let t=this._subscriptions.get(i);null==t||t.processSubscriptionData(e)}}subscribe(e,t){return cy(this,arguments,void 0,function*(e,t,r=Z){let n=this.registeredSubscriptions[e];if(!n)throw new rp("Invalid subscription type");let i=new n(null!=t?t:void 0,{subscriptionManager:this,returnFormat:r});return yield this.addSubscription(i),i})}get subscriptions(){return this._subscriptions}addSubscription(e){return cy(this,void 0,void 0,function*(){if(!this.requestManager.provider)throw new rd("Provider not available");if(!this.supportsSubscriptions())throw new rp("The current provider does not support subscriptions");if(e.id&&this._subscriptions.has(e.id))throw new rp(`Subscription with id "${e.id}" already exists`);if(yield e.sendSubscriptionRequest(),lt(e.id))throw new rp("Subscription is not subscribed yet.");return this._subscriptions.set(e.id,e),e.id})}removeSubscription(e){return cy(this,void 0,void 0,function*(){let{id:t}=e;if(lt(t))throw new rp("Subscription is not subscribed yet. Or, had already been unsubscribed but not through the Subscription Manager.");if(!this._subscriptions.has(t)&&!this.tolerateUnlinkedSubscription)throw new rp(`Subscription with id "${t.toString()}" does not exists`);return yield e.sendUnsubscribeRequest(),this._subscriptions.delete(t),t})}unsubscribe(e){return cy(this,void 0,void 0,function*(){let t=[];for(let[r,n]of this.subscriptions.entries())(!e||"function"==typeof e&&e({id:r,sub:n}))&&t.push(this.removeSubscription(n));return Promise.all(t)})}clear(){this._subscriptions.clear()}supportsSubscriptions(){return!lt(this.requestManager.provider)&&cf(this.requestManager.provider)}}var cw=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class cv extends l9{constructor(e,t){var r;super(),this.args=e;let{requestManager:n}=t,{subscriptionManager:i}=t;n?this._subscriptionManager=new cb(n,{},!0):this._subscriptionManager=i,this._returnFormat=null!=(r=null==t?void 0:t.returnFormat)?r:Z}get id(){return this._id}get lastBlock(){return this._lastBlock}subscribe(){return cw(this,void 0,void 0,function*(){return this._subscriptionManager.addSubscription(this)})}processSubscriptionData(e){var t,r;(null==e?void 0:e.data)?this._processSubscriptionResult(null!=(r=null==(t=null==e?void 0:e.data)?void 0:t.result)?r:null==e?void 0:e.data):e&&lV(e)&&this._processSubscriptionResult(null==e?void 0:e.params.result)}sendSubscriptionRequest(){return cw(this,void 0,void 0,function*(){return this._id=yield this._subscriptionManager.requestManager.send({method:"eth_subscribe",params:this._buildSubscriptionParams()}),this.emit("connected",this._id),this._id})}get returnFormat(){return this._returnFormat}get subscriptionManager(){return this._subscriptionManager}resubscribe(){return cw(this,void 0,void 0,function*(){yield this.unsubscribe(),yield this.subscribe()})}unsubscribe(){return cw(this,void 0,void 0,function*(){this.id&&(yield this._subscriptionManager.removeSubscription(this))})}sendUnsubscribeRequest(){return cw(this,void 0,void 0,function*(){yield this._subscriptionManager.requestManager.send({method:"eth_unsubscribe",params:[this.id]}),this._id=void 0})}formatSubscriptionResult(e){return e}_processSubscriptionResult(e){this.emit("data",this.formatSubscriptionResult(e))}_processSubscriptionError(e){this.emit("error",e)}_buildSubscriptionParams(){throw Error("Implement in the child class")}}var cE=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class cA extends en{constructor(){super(...arguments),this._addressMap=new Map,this._defaultKeyName="web3js_wallet"}static getStorage(){let e;try{e=window.localStorage;let t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch(t){return t&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&!al(e)&&0!==e.length?e:void 0}}create(e){for(let t=0;t<e;t+=1)this.add(this._accountProvider.create());return this}add(e){var t;if("string"==typeof e)return this.add(this._accountProvider.privateKeyToAccount(e));let r=this.length;return this.get(e.address)&&(console.warn(`Account ${e.address.toLowerCase()} already exists.`),r=null!=(t=this._addressMap.get(e.address.toLowerCase()))?t:r),this._addressMap.set(e.address.toLowerCase(),r),this[r]=e,this}get(e){if("string"==typeof e){let t=this._addressMap.get(e.toLowerCase());return al(t)?void 0:this[t]}return this[e]}remove(e){if("string"==typeof e){let t=this._addressMap.get(e.toLowerCase());return!al(t)&&(this._addressMap.delete(e.toLowerCase()),this.splice(t,1),!0)}return!!this[e]&&(this.splice(e,1),!0)}clear(){return this._addressMap.clear(),this.length=0,this}encrypt(e,t){return cE(this,void 0,void 0,function*(){return Promise.all(this.map(r=>cE(this,void 0,void 0,function*(){return r.encrypt(e,t)})))})}decrypt(e,t,r){return cE(this,void 0,void 0,function*(){for(let n of yield Promise.all(e.map(e=>cE(this,void 0,void 0,function*(){return this._accountProvider.decrypt(e,t,r)}))))this.add(n);return this})}save(e,t){return cE(this,void 0,void 0,function*(){let r=cA.getStorage();if(!r)throw Error("Local storage not available.");return r.setItem(null!=t?t:this._defaultKeyName,JSON.stringify((yield this.encrypt(e)))),!0})}load(e,t){return cE(this,void 0,void 0,function*(){let r=cA.getStorage();if(!r)throw Error("Local storage not available.");let n=r.getItem(null!=t?t:this._defaultKeyName);return n&&(yield this.decrypt(JSON.parse(n)||[],e)),this})}}let cx={web:nz};function cS(e,t,r){if(!r.startsWith("aes-"))throw Error(`AES submodule doesn't support mode ${r}`);if(16!==t.length)throw Error("AES: wrong IV length");if(r.startsWith("aes-128")&&16!==e.length||r.startsWith("aes-256")&&32!==e.length)throw Error("AES: wrong key length")}async function ck(e,t,r){let n;if(!cx.web)throw Error("Browser crypto not available.");if(["aes-128-cbc","aes-256-cbc"].includes(e)&&(n="cbc"),["aes-128-ctr","aes-256-ctr"].includes(e)&&(n="ctr"),!n)throw Error("AES: unsupported mode");return[await cx.web.subtle.importKey("raw",t,{name:`AES-${n.toUpperCase()}`,length:8*t.length},!0,["encrypt","decrypt"]),{name:`aes-${n}`,iv:r,counter:r,length:128}]}async function c_(e,t,r,n="aes-128-ctr",i=!0){if(cS(t,r,n),cx.web){let[s,o]=await ck(n,t,r),a=new Uint8Array(await cx.web.subtle.encrypt(o,s,e));return i||"aes-cbc"!==o.name||e.length%16||(a=a.slice(0,-16)),a}if(cx.node){let s=cx.node.createCipheriv(n,t,r);return s.setAutoPadding(i),n1(s.update(e),s.final())}throw Error("The environment doesn't have AES module")}async function cI(e,t,r,n){let i=e.slice(-16);for(let e=0;e<16;e++)i[e]^=16^r[e];return(await c_(i,t,r,n)).slice(0,16)}async function cC(e,t,r,n="aes-128-ctr",i=!0){if(cS(t,r,n),cx.web){let[s,o]=await ck(n,t,r);if(!i&&"aes-cbc"===o.name){let i=await cI(e,t,r,n);e=n1(e,i)}let a=new Uint8Array(await cx.web.subtle.decrypt(o,s,e));if("aes-cbc"===o.name&&!iE(await c_(a,t,r,n),e))throw Error("AES: wrong padding");return a}if(cx.node){let s=cx.node.createDecipheriv(n,t,r);return s.setAutoPadding(i),n1(s.update(e),s.final())}throw Error("The environment doesn't have AES module")}class cT extends n2{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,nR(e);let r=n0(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let n=this.blockLen,i=new Uint8Array(n);i.set(r.length>n?e.create().update(r).digest():r);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return nO(this),this.iHash.update(e),this}digestInto(e){nO(this),nP(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:r,finished:n,destroyed:i,blockLen:s,outputLen:o}=this;return e.finished=n,e.destroyed=i,e.blockLen=s,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let cP=(e,t,r)=>new cT(e,t).update(r).digest();function cR(e,t,r,n){nR(e);let{c:i,dkLen:s,asyncTick:o}=n4({dkLen:32,asyncTick:10},n);if(nC(i),nC(s),nC(o),i<1)throw Error("PBKDF2: iterations (c) should be >= 1");let a=n0(t),l=n0(r),c=new Uint8Array(s),u=cP.create(e,a),h=u._cloneInto().update(l);return{c:i,dkLen:s,asyncTick:o,DK:c,PRF:u,PRFSalt:h}}function cO(e,t,r,n,i){return e.destroy(),t.destroy(),n&&n.destroy(),i.fill(0),r}function cN(e,t,r,n){let i,{c:s,dkLen:o,DK:a,PRF:l,PRFSalt:c}=cR(e,t,r,n),u=new Uint8Array(4),h=nK(u),d=new Uint8Array(l.outputLen);for(let e=1,t=0;t<o;e++,t+=l.outputLen){let r=a.subarray(t,t+l.outputLen);h.setInt32(0,e,!1),(i=c._cloneInto(i)).update(u).digestInto(d),r.set(d.subarray(0,r.length));for(let e=1;e<s;e++){l._cloneInto(i).update(d).digestInto(d);for(let e=0;e<r.length;e++)r[e]^=d[e]}}return cO(l,c,a,i,d)}function cD(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);let i=BigInt(32),s=BigInt(0xffffffff),o=Number(r>>i&s),a=Number(r&s),l=4*!!n,c=4*!n;e.setUint32(t+l,o,n),e.setUint32(t+c,a,n)}cP.create=(e,t)=>new cT(e,t);let cB=(e,t,r)=>e&t^~e&r,cM=(e,t,r)=>e&t^e&r^t&r;class cL extends n2{constructor(e,t,r,n){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=nK(this.buffer)}update(e){nO(this);let{view:t,buffer:r,blockLen:n}=this,i=(e=n0(e)).length;for(let s=0;s<i;){let o=Math.min(n-this.pos,i-s);if(o===n){let t=nK(e);for(;n<=i-s;s+=n)this.process(t,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){nO(this),nN(e,this),this.finished=!0;let{buffer:t,view:r,blockLen:n,isLE:i}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>n-s&&(this.process(r,0),s=0);for(let e=s;e<n;e++)t[e]=0;cD(r,n-8,BigInt(8*this.length),i),this.process(r,0);let o=nK(e),a=this.outputLen;if(a%4)throw Error("_sha2: outputLen should be aligned to 32bit");let l=a/4,c=this.get();if(l>c.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<l;e++)o.setUint32(4*e,c[e],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:n,finished:i,destroyed:s,pos:o}=this;return e.length=n,e.pos=o,e.finished=i,e.destroyed=s,n%t&&e.buffer.set(r),e}}let cF=new Uint32Array([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),cU=new Uint32Array([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),cj=new Uint32Array(64);class c$ extends cL{constructor(){super(64,32,8,!1),this.A=0|cU[0],this.B=0|cU[1],this.C=0|cU[2],this.D=0|cU[3],this.E=0|cU[4],this.F=0|cU[5],this.G=0|cU[6],this.H=0|cU[7]}get(){let{A:e,B:t,C:r,D:n,E:i,F:s,G:o,H:a}=this;return[e,t,r,n,i,s,o,a]}set(e,t,r,n,i,s,o,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)cj[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=cj[e-15],r=cj[e-2],n=nG(t,7)^nG(t,18)^t>>>3,i=nG(r,17)^nG(r,19)^r>>>10;cj[e]=i+cj[e-7]+n+cj[e-16]|0}let{A:r,B:n,C:i,D:s,E:o,F:a,G:l,H:c}=this;for(let e=0;e<64;e++){let t=c+(nG(o,6)^nG(o,11)^nG(o,25))+cB(o,a,l)+cF[e]+cj[e]|0,u=(nG(r,2)^nG(r,13)^nG(r,22))+cM(r,n,i)|0;c=l,l=a,a=o,o=s+t|0,s=i,i=n,n=r,r=t+u|0}r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(r,n,i,s,o,a,l,c)}roundClean(){cj.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}let cH=n5(()=>new c$),[cq,cz]=nq.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),cV=new Uint32Array(80),cK=new Uint32Array(80);class cG extends cL{constructor(){super(128,64,16,!1),this.Ah=0x6a09e667,this.Al=-0xc4336f8,this.Bh=-0x4498517b,this.Bl=-0x7b3558c5,this.Ch=0x3c6ef372,this.Cl=-0x16b07d5,this.Dh=-0x5ab00ac6,this.Dl=0x5f1d36f1,this.Eh=0x510e527f,this.El=-0x52197d2f,this.Fh=-0x64fa9774,this.Fl=0x2b3e6c1f,this.Gh=0x1f83d9ab,this.Gl=-0x4be4295,this.Hh=0x5be0cd19,this.Hl=0x137e2179}get(){let{Ah:e,Al:t,Bh:r,Bl:n,Ch:i,Cl:s,Dh:o,Dl:a,Eh:l,El:c,Fh:u,Fl:h,Gh:d,Gl:f,Hh:p,Hl:g}=this;return[e,t,r,n,i,s,o,a,l,c,u,h,d,f,p,g]}set(e,t,r,n,i,s,o,a,l,c,u,h,d,f,p,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|n,this.Ch=0|i,this.Cl=0|s,this.Dh=0|o,this.Dl=0|a,this.Eh=0|l,this.El=0|c,this.Fh=0|u,this.Fl=0|h,this.Gh=0|d,this.Gl=0|f,this.Hh=0|p,this.Hl=0|g}process(e,t){for(let r=0;r<16;r++,t+=4)cV[r]=e.getUint32(t),cK[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){let t=0|cV[e-15],r=0|cK[e-15],n=nq.rotrSH(t,r,1)^nq.rotrSH(t,r,8)^nq.shrSH(t,r,7),i=nq.rotrSL(t,r,1)^nq.rotrSL(t,r,8)^nq.shrSL(t,r,7),s=0|cV[e-2],o=0|cK[e-2],a=nq.rotrSH(s,o,19)^nq.rotrBH(s,o,61)^nq.shrSH(s,o,6),l=nq.rotrSL(s,o,19)^nq.rotrBL(s,o,61)^nq.shrSL(s,o,6),c=nq.add4L(i,l,cK[e-7],cK[e-16]),u=nq.add4H(c,n,a,cV[e-7],cV[e-16]);cV[e]=0|u,cK[e]=0|c}let{Ah:r,Al:n,Bh:i,Bl:s,Ch:o,Cl:a,Dh:l,Dl:c,Eh:u,El:h,Fh:d,Fl:f,Gh:p,Gl:g,Hh:m,Hl:y}=this;for(let e=0;e<80;e++){let t=nq.rotrSH(u,h,14)^nq.rotrSH(u,h,18)^nq.rotrBH(u,h,41),b=nq.rotrSL(u,h,14)^nq.rotrSL(u,h,18)^nq.rotrBL(u,h,41),w=u&d^~u&p,v=h&f^~h&g,E=nq.add5L(y,b,v,cz[e],cK[e]),A=nq.add5H(E,m,t,w,cq[e],cV[e]),x=0|E,S=nq.rotrSH(r,n,28)^nq.rotrBH(r,n,34)^nq.rotrBH(r,n,39),k=nq.rotrSL(r,n,28)^nq.rotrBL(r,n,34)^nq.rotrBL(r,n,39),_=r&i^r&o^i&o,I=n&s^n&a^s&a;m=0|p,y=0|g,p=0|d,g=0|f,d=0|u,f=0|h,({h:u,l:h}=nq.add(0|l,0|c,0|A,0|x)),l=0|o,c=0|a,o=0|i,a=0|s,i=0|r,s=0|n;let C=nq.add3L(x,k,I);r=nq.add3H(C,A,S,_),n=0|C}({h:r,l:n}=nq.add(0|this.Ah,0|this.Al,0|r,0|n)),({h:i,l:s}=nq.add(0|this.Bh,0|this.Bl,0|i,0|s)),({h:o,l:a}=nq.add(0|this.Ch,0|this.Cl,0|o,0|a)),({h:l,l:c}=nq.add(0|this.Dh,0|this.Dl,0|l,0|c)),({h:u,l:h}=nq.add(0|this.Eh,0|this.El,0|u,0|h)),({h:d,l:f}=nq.add(0|this.Fh,0|this.Fl,0|d,0|f)),({h:p,l:g}=nq.add(0|this.Gh,0|this.Gl,0|p,0|g)),({h:m,l:y}=nq.add(0|this.Hh,0|this.Hl,0|m,0|y)),this.set(r,n,i,s,o,a,l,c,u,h,d,f,p,g,m,y)}roundClean(){cV.fill(0),cK.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let cW=n5(()=>new cG);function cQ(e,t,r,n,i){if(!["sha256","sha512"].includes(i))throw Error("Only sha256 and sha512 are supported");return iw(e),iw(t),cN("sha256"===i?cH:cW,e,t,{c:r,dkLen:n})}function cJ(e,t,r,n,i,s){let o=e[t++]^r[n++],a=e[t++]^r[n++],l=e[t++]^r[n++],c=e[t++]^r[n++],u=e[t++]^r[n++],h=e[t++]^r[n++],d=e[t++]^r[n++],f=e[t++]^r[n++],p=e[t++]^r[n++],g=e[t++]^r[n++],m=e[t++]^r[n++],y=e[t++]^r[n++],b=e[t++]^r[n++],w=e[t++]^r[n++],v=e[t++]^r[n++],E=e[t++]^r[n++],A=o,x=a,S=l,k=c,_=u,I=h,C=d,T=f,P=p,R=g,O=m,N=y,D=b,B=w,M=v,L=E;for(let e=0;e<8;e+=2)_^=nW(A+D|0,7),P^=nW(_+A|0,9),D^=nW(P+_|0,13),A^=nW(D+P|0,18),R^=nW(I+x|0,7),B^=nW(R+I|0,9),x^=nW(B+R|0,13),I^=nW(x+B|0,18),M^=nW(O+C|0,7),S^=nW(M+O|0,9),C^=nW(S+M|0,13),O^=nW(C+S|0,18),k^=nW(L+N|0,7),T^=nW(k+L|0,9),N^=nW(T+k|0,13),L^=nW(N+T|0,18),x^=nW(A+k|0,7),S^=nW(x+A|0,9),k^=nW(S+x|0,13),A^=nW(k+S|0,18),C^=nW(I+_|0,7),T^=nW(C+I|0,9),_^=nW(T+C|0,13),I^=nW(_+T|0,18),N^=nW(O+R|0,7),P^=nW(N+O|0,9),R^=nW(P+N|0,13),O^=nW(R+P|0,18),D^=nW(L+M|0,7),B^=nW(D+L|0,9),M^=nW(B+D|0,13),L^=nW(M+B|0,18);i[s++]=o+A|0,i[s++]=a+x|0,i[s++]=l+S|0,i[s++]=c+k|0,i[s++]=u+_|0,i[s++]=h+I|0,i[s++]=d+C|0,i[s++]=f+T|0,i[s++]=p+P|0,i[s++]=g+R|0,i[s++]=m+O|0,i[s++]=y+N|0,i[s++]=b+D|0,i[s++]=w+B|0,i[s++]=v+M|0,i[s++]=E+L|0}function cZ(e,t,r,n,i){let s=n+0,o=n+16*i;for(let n=0;n<16;n++)r[o+n]=e[t+(2*i-1)*16+n];for(let n=0;n<i;n++,s+=16,t+=16)cJ(r,o,e,t,r,s),n>0&&(o+=16),cJ(r,s,e,t+=16,r,o)}function cY(e,t,r){let{N:n,r:i,p:s,dkLen:o,asyncTick:a,maxmem:l,onProgress:c}=n4({dkLen:32,asyncTick:10,maxmem:0x40000400},r);if(nC(n),nC(i),nC(s),nC(o),nC(a),nC(l),void 0!==c&&"function"!=typeof c)throw Error("progressCb should be function");let u=128*i,h=u/4;if(n<=1||(n&n-1)!=0||n>=2**(u/8)||n>0x100000000)throw Error("Scrypt: N must be larger than 1, a power of 2, less than 2^(128 * r / 8) and less than 2^32");if(s<0||s>(0x100000000-1)*32/u)throw Error("Scrypt: p must be a positive integer less than or equal to ((2^32 - 1) * 32) / (128 * r)");if(o<0||o>(0x100000000-1)*32)throw Error("Scrypt: dkLen should be positive integer less than or equal to (2^32 - 1) * 32");let d=u*(n+s);if(d>l)throw Error(`Scrypt: parameters too large, ${d} (128 * r * (N + p)) > ${l} (maxmem)`);let f=cN(cH,e,t,{c:1,dkLen:u*s}),p=nV(f),g=nV(new Uint8Array(u*n)),m=nV(new Uint8Array(u)),y=()=>{};if(c){let e=2*n*s,t=Math.max(Math.floor(e/1e4),1),r=0;y=()=>{r++,c&&(!(r%t)||r===e)&&c(r/e)}}return{N:n,r:i,p:s,dkLen:o,blockSize32:h,V:g,B32:p,B:f,tmp:m,blockMixCb:y,asyncTick:a}}function cX(e,t,r,n,i){let s=cN(cH,e,r,{c:1,dkLen:t});return r.fill(0),n.fill(0),i.fill(0),s}function c0(e,t,r){let{N:n,r:i,p:s,dkLen:o,blockSize32:a,V:l,B32:c,B:u,tmp:h,blockMixCb:d}=cY(e,t,r);nQ||nZ(c);for(let e=0;e<s;e++){let t=a*e;for(let e=0;e<a;e++)l[e]=c[t+e];for(let e=0,t=0;e<n-1;e++)cZ(l,t,l,t+=a,i),d();cZ(l,(n-1)*a,c,t,i),d();for(let e=0;e<n;e++){let e=c[t+a-16]%n;for(let r=0;r<a;r++)h[r]=c[t+r]^l[e*a+r];cZ(h,0,c,t,i),d()}}return nQ||nZ(c),cX(e,o,u,l,h)}function c1(e,t,r,n,i,s,o){return iw(e),iw(t),c0(e,t,{N:r,r:i,p:n,dkLen:s,onProgress:o})}let c2=BigInt(1),c3=BigInt(2);function c4(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function c5(e){if(!c4(e))throw Error("Uint8Array expected")}let c6=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function c8(e){c5(e);let t="";for(let r=0;r<e.length;r++)t+=c6[e[r]];return t}function c7(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}let c9={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function ue(e){return e>=c9._0&&e<=c9._9?e-c9._0:e>=c9._A&&e<=c9._F?e-(c9._A-10):e>=c9._a&&e<=c9._f?e-(c9._a-10):void 0}function ut(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);let t=e.length,r=t/2;if(t%2)throw Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let t=0,i=0;t<r;t++,i+=2){let r=ue(e.charCodeAt(i)),s=ue(e.charCodeAt(i+1));if(void 0===r||void 0===s)throw Error('hex string expected, got non-hex character "'+(e[i]+e[i+1])+'" at index '+i);n[t]=16*r+s}return n}function ur(e){return c7(c8(e))}function un(e){return c5(e),c7(c8(Uint8Array.from(e).reverse()))}function ui(e,t){return ut(e.toString(16).padStart(2*t,"0"))}function us(e,t){return ui(e,t).reverse()}function uo(e,t,r){let n;if("string"==typeof t)try{n=ut(t)}catch(r){throw Error(`${e} must be valid hex string, got "${t}". Cause: ${r}`)}else if(c4(t))n=Uint8Array.from(t);else throw Error(`${e} must be hex string or Uint8Array`);let i=n.length;if("number"==typeof r&&i!==r)throw Error(`${e} expected ${r} bytes, got ${i}`);return n}function ua(...e){let t=0;for(let r=0;r<e.length;r++){let n=e[r];c5(n),t+=n.length}let r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){let i=e[t];r.set(i,n),n+=i.length}return r}let ul=e=>(c3<<BigInt(e-1))-c2,uc=e=>new Uint8Array(e),uu=e=>Uint8Array.from(e);function uh(e,t,r){if("number"!=typeof e||e<2)throw Error("hashLen must be a number");if("number"!=typeof t||t<2)throw Error("qByteLen must be a number");if("function"!=typeof r)throw Error("hmacFn must be a function");let n=uc(e),i=uc(e),s=0,o=()=>{n.fill(1),i.fill(0),s=0},a=(...e)=>r(i,n,...e),l=(e=uc())=>{i=a(uu([0]),e),n=a(),0!==e.length&&(i=a(uu([1]),e),n=a())},c=()=>{if(s++>=1e3)throw Error("drbg: tried 1000 values");let e=0,r=[];for(;e<t;){let t=(n=a()).slice();r.push(t),e+=n.length}return ua(...r)};return(e,t)=>{let r;for(o(),l(e);!(r=t(c()));)l();return o(),r}}let ud={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||c4(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function uf(e,t,r={}){let n=(t,r,n)=>{let i=ud[r];if("function"!=typeof i)throw Error(`Invalid validator "${r}", expected function`);let s=e[t];if((!n||void 0!==s)&&!i(s,e))throw Error(`Invalid param ${String(t)}=${s} (${typeof s}), expected ${r}`)};for(let[e,r]of Object.entries(t))n(e,r,!1);for(let[e,t]of Object.entries(r))n(e,t,!0);return e}let up=BigInt(0),ug=BigInt(1),um=BigInt(2),uy=BigInt(3),ub=BigInt(4),uw=BigInt(5),uv=BigInt(8);function uE(e,t){let r=e%t;return r>=up?r:t+r}function uA(e,t,r){if(r<=up||t<up)throw Error("Expected power/modulo > 0");if(r===ug)return up;let n=ug;for(;t>up;)t&ug&&(n=n*e%r),e=e*e%r,t>>=ug;return n}function ux(e,t,r){let n=e;for(;t-- >up;)n*=n,n%=r;return n}function uS(e,t){if(e===up||t<=up)throw Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=uE(e,t),n=t,i=up,s=ug,o=ug,a=up;for(;r!==up;){let e=n/r,t=n%r,l=i-o*e,c=s-a*e;n=r,r=t,i=o,s=a,o=l,a=c}if(n!==ug)throw Error("invert: does not exist");return uE(i,t)}function uk(e){let t,r,n,i=(e-ug)/um;for(t=e-ug,r=0;t%um===up;t/=um,r++);for(n=um;n<e&&uA(n,i,e)!==e-ug;n++);if(1===r){let t=(e+ug)/ub;return function(e,r){let n=e.pow(r,t);if(!e.eql(e.sqr(n),r))throw Error("Cannot find square root");return n}}let s=(t+ug)/um;return function(e,o){if(e.pow(o,i)===e.neg(e.ONE))throw Error("Cannot find square root");let a=r,l=e.pow(e.mul(e.ONE,n),t),c=e.pow(o,s),u=e.pow(o,t);for(;!e.eql(u,e.ONE);){if(e.eql(u,e.ZERO))return e.ZERO;let t=1;for(let r=e.sqr(u);t<a&&!e.eql(r,e.ONE);t++)r=e.sqr(r);let r=e.pow(l,ug<<BigInt(a-t-1));l=e.sqr(r),c=e.mul(c,r),u=e.mul(u,l),a=t}return c}}function u_(e){if(e%ub===uy){let t=(e+ug)/ub;return function(e,r){let n=e.pow(r,t);if(!e.eql(e.sqr(n),r))throw Error("Cannot find square root");return n}}if(e%uv===uw){let t=(e-uw)/uv;return function(e,r){let n=e.mul(r,um),i=e.pow(n,t),s=e.mul(r,i),o=e.mul(e.mul(s,um),i),a=e.mul(s,e.sub(o,e.ONE));if(!e.eql(e.sqr(a),r))throw Error("Cannot find square root");return a}}return uk(e)}BigInt(9),BigInt(16);let uI=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function uC(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"};return uf(e,uI.reduce((e,t)=>(e[t]="function",e),t))}function uT(e,t,r){if(r<up)throw Error("Expected power > 0");if(r===up)return e.ONE;if(r===ug)return t;let n=e.ONE,i=t;for(;r>up;)r&ug&&(n=e.mul(n,i)),i=e.sqr(i),r>>=ug;return n}function uP(e,t){let r=Array(t.length),n=t.reduce((t,n,i)=>e.is0(n)?t:(r[i]=t,e.mul(t,n)),e.ONE),i=e.inv(n);return t.reduceRight((t,n,i)=>e.is0(n)?t:(r[i]=e.mul(t,r[i]),e.mul(t,n)),i),r}function uR(e,t){let r=void 0!==t?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function uO(e,t,r=!1,n={}){if(e<=up)throw Error(`Expected Field ORDER > 0, got ${e}`);let{nBitLength:i,nByteLength:s}=uR(e,t);if(s>2048)throw Error("Field lengths over 2048 bytes are not supported");let o=u_(e),a=Object.freeze({ORDER:e,BITS:i,BYTES:s,MASK:ul(i),ZERO:up,ONE:ug,create:t=>uE(t,e),isValid:t=>{if("bigint"!=typeof t)throw Error(`Invalid field element: expected bigint, got ${typeof t}`);return up<=t&&t<e},is0:e=>e===up,isOdd:e=>(e&ug)===ug,neg:t=>uE(-t,e),eql:(e,t)=>e===t,sqr:t=>uE(t*t,e),add:(t,r)=>uE(t+r,e),sub:(t,r)=>uE(t-r,e),mul:(t,r)=>uE(t*r,e),pow:(e,t)=>uT(a,e,t),div:(t,r)=>uE(t*uS(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>uS(t,e),sqrt:n.sqrt||(e=>o(a,e)),invertBatch:e=>uP(a,e),cmov:(e,t,r)=>r?t:e,toBytes:e=>r?us(e,s):ui(e,s),fromBytes:e=>{if(e.length!==s)throw Error(`Fp.fromBytes: expected ${s}, got ${e.length}`);return r?un(e):ur(e)}});return Object.freeze(a)}function uN(e){if("bigint"!=typeof e)throw Error("field order must be bigint");return Math.ceil(e.toString(2).length/8)}function uD(e){let t=uN(e);return t+Math.ceil(t/2)}function uB(e,t,r=!1){let n=e.length,i=uN(t),s=uD(t);if(n<16||n<s||n>1024)throw Error(`expected ${s}-1024 bytes of input, got ${n}`);let o=uE(r?ur(e):un(e),t-ug)+ug;return r?us(o,i):ui(o,i)}let uM=BigInt(0),uL=BigInt(1);function uF(e,t){let r=(e,t)=>{let r=t.negate();return e?r:t},n=e=>({windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:r,unsafeLadder(t,r){let n=e.ZERO,i=t;for(;r>uM;)r&uL&&(n=n.add(i)),i=i.double(),r>>=uL;return n},precomputeWindow(e,t){let{windows:r,windowSize:i}=n(t),s=[],o=e,a=o;for(let e=0;e<r;e++){a=o,s.push(a);for(let e=1;e<i;e++)a=a.add(o),s.push(a);o=a.double()}return s},wNAF(t,i,s){let{windows:o,windowSize:a}=n(t),l=e.ZERO,c=e.BASE,u=BigInt(2**t-1),h=2**t,d=BigInt(t);for(let e=0;e<o;e++){let t=e*a,n=Number(s&u);s>>=d,n>a&&(n-=h,s+=uL);let o=t,f=t+Math.abs(n)-1,p=e%2!=0,g=n<0;0===n?c=c.add(r(p,i[o])):l=l.add(r(g,i[f]))}return{p:l,f:c}},wNAFCached(e,t,r,n){let i=e._WINDOW_SIZE||1,s=t.get(e);return s||(s=this.precomputeWindow(e,i),1!==i&&t.set(e,n(s))),this.wNAF(i,s,r)}}}function uU(e){return uC(e.Fp),uf(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...uR(e.n,e.nBitLength),...e,...{p:e.Fp.ORDER}})}function uj(e){let t=uU(e);uf(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:r,Fp:n,a:i}=t;if(r){if(!n.eql(i,n.ZERO))throw Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof r||"bigint"!=typeof r.beta||"function"!=typeof r.splitScalar)throw Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}let{Ph:u$,aT:uH}=Q,uq={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){let{Err:t}=uq;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");let r=e[1],n=e.subarray(2,r+2);if(!r||n.length!==r)throw new t("Invalid signature integer: wrong length");if(128&n[0])throw new t("Invalid signature integer: negative");if(0===n[0]&&!(128&n[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:u$(n),l:e.subarray(r+2)}},toSig(e){let{Err:t}=uq,r="string"==typeof e?uH(e):e;c5(r);let n=r.length;if(n<2||48!=r[0])throw new t("Invalid signature tag");if(r[1]!==n-2)throw new t("Invalid signature: incorrect length");let{d:i,l:s}=uq._parseInt(r.subarray(2)),{d:o,l:a}=uq._parseInt(s);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(e){let t=e=>8&Number.parseInt(e[0],16)?"00"+e:e,r=e=>{let t=e.toString(16);return 1&t.length?`0${t}`:t},n=t(r(e.s)),i=t(r(e.r)),s=n.length/2,o=i.length/2,a=r(s),l=r(o);return`30${r(o+s+4)}02${l}${i}02${a}${n}`}},uz=BigInt(0),uV=BigInt(1),uK=BigInt(2),uG=BigInt(3),uW=BigInt(4);function uQ(e){let t=uj(e),{Fp:r}=t,n=t.toBytes||((e,t,n)=>{let i=t.toAffine();return ua(Uint8Array.from([4]),r.toBytes(i.x),r.toBytes(i.y))}),i=t.fromBytes||(e=>{let t=e.subarray(1);return{x:r.fromBytes(t.subarray(0,r.BYTES)),y:r.fromBytes(t.subarray(r.BYTES,2*r.BYTES))}});function s(e){let{a:n,b:i}=t,s=r.sqr(e),o=r.mul(s,e);return r.add(r.add(o,r.mul(e,n)),i)}if(!r.eql(r.sqr(t.Gy),s(t.Gx)))throw Error("bad generator point: equation left != right");function o(e){return"bigint"==typeof e&&uz<e&&e<t.n}function a(e){if(!o(e))throw Error("Expected valid bigint: 0 < bigint < curve.n")}function l(e){let r,{allowedPrivateKeyLengths:n,nByteLength:i,wrapPrivateKey:s,n:o}=t;if(n&&"bigint"!=typeof e){if(c4(e)&&(e=c8(e)),"string"!=typeof e||!n.includes(e.length))throw Error("Invalid key");e=e.padStart(2*i,"0")}try{r="bigint"==typeof e?e:ur(uo("private key",e,i))}catch(t){throw Error(`private key must be ${i} bytes, hex or bigint, not ${typeof e}`)}return s&&(r=uE(r,o)),a(r),r}let c=new Map;function u(e){if(!(e instanceof h))throw Error("ProjectivePoint expected")}class h{constructor(e,t,n){if(this.px=e,this.py=t,this.pz=n,null==e||!r.isValid(e))throw Error("x required");if(null==t||!r.isValid(t))throw Error("y required");if(null==n||!r.isValid(n))throw Error("z required")}static fromAffine(e){let{x:t,y:n}=e||{};if(!e||!r.isValid(t)||!r.isValid(n))throw Error("invalid affine point");if(e instanceof h)throw Error("projective point not allowed");let i=e=>r.eql(e,r.ZERO);return i(t)&&i(n)?h.ZERO:new h(t,n,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){let t=r.invertBatch(e.map(e=>e.pz));return e.map((e,r)=>e.toAffine(t[r])).map(h.fromAffine)}static fromHex(e){let t=h.fromAffine(i(uo("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return h.BASE.multiply(l(e))}_setWindowSize(e){this._WINDOW_SIZE=e,c.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!r.is0(this.py))return;throw Error("bad point: ZERO")}let{x:e,y:n}=this.toAffine();if(!r.isValid(e)||!r.isValid(n))throw Error("bad point: x or y not FE");let i=r.sqr(n),o=s(e);if(!r.eql(i,o))throw Error("bad point: equation left != right");if(!this.isTorsionFree())throw Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:e}=this.toAffine();if(r.isOdd)return!r.isOdd(e);throw Error("Field doesn't support isOdd")}equals(e){u(e);let{px:t,py:n,pz:i}=this,{px:s,py:o,pz:a}=e,l=r.eql(r.mul(t,a),r.mul(s,i)),c=r.eql(r.mul(n,a),r.mul(o,i));return l&&c}negate(){return new h(this.px,r.neg(this.py),this.pz)}double(){let{a:e,b:n}=t,i=r.mul(n,uG),{px:s,py:o,pz:a}=this,l=r.ZERO,c=r.ZERO,u=r.ZERO,d=r.mul(s,s),f=r.mul(o,o),p=r.mul(a,a),g=r.mul(s,o);return g=r.add(g,g),u=r.mul(s,a),u=r.add(u,u),l=r.mul(e,u),c=r.mul(i,p),c=r.add(l,c),l=r.sub(f,c),c=r.add(f,c),c=r.mul(l,c),l=r.mul(g,l),u=r.mul(i,u),p=r.mul(e,p),g=r.sub(d,p),g=r.mul(e,g),g=r.add(g,u),u=r.add(d,d),d=r.add(u,d),d=r.add(d,p),d=r.mul(d,g),c=r.add(c,d),p=r.mul(o,a),p=r.add(p,p),d=r.mul(p,g),l=r.sub(l,d),u=r.mul(p,f),u=r.add(u,u),new h(l,c,u=r.add(u,u))}add(e){u(e);let{px:n,py:i,pz:s}=this,{px:o,py:a,pz:l}=e,c=r.ZERO,d=r.ZERO,f=r.ZERO,p=t.a,g=r.mul(t.b,uG),m=r.mul(n,o),y=r.mul(i,a),b=r.mul(s,l),w=r.add(n,i),v=r.add(o,a);w=r.mul(w,v),v=r.add(m,y),w=r.sub(w,v),v=r.add(n,s);let E=r.add(o,l);return v=r.mul(v,E),E=r.add(m,b),v=r.sub(v,E),E=r.add(i,s),c=r.add(a,l),E=r.mul(E,c),c=r.add(y,b),E=r.sub(E,c),f=r.mul(p,v),c=r.mul(g,b),f=r.add(c,f),c=r.sub(y,f),f=r.add(y,f),d=r.mul(c,f),y=r.add(m,m),y=r.add(y,m),b=r.mul(p,b),v=r.mul(g,v),y=r.add(y,b),b=r.sub(m,b),b=r.mul(p,b),v=r.add(v,b),m=r.mul(y,v),d=r.add(d,m),m=r.mul(E,v),c=r.mul(w,c),c=r.sub(c,m),m=r.mul(w,y),f=r.mul(E,f),new h(c,d,f=r.add(f,m))}subtract(e){return this.add(e.negate())}is0(){return this.equals(h.ZERO)}wNAF(e){return f.wNAFCached(this,c,e,e=>{let t=r.invertBatch(e.map(e=>e.pz));return e.map((e,r)=>e.toAffine(t[r])).map(h.fromAffine)})}multiplyUnsafe(e){let n=h.ZERO;if(e===uz)return n;if(a(e),e===uV)return this;let{endo:i}=t;if(!i)return f.unsafeLadder(this,e);let{k1neg:s,k1:o,k2neg:l,k2:c}=i.splitScalar(e),u=n,d=n,p=this;for(;o>uz||c>uz;)o&uV&&(u=u.add(p)),c&uV&&(d=d.add(p)),p=p.double(),o>>=uV,c>>=uV;return s&&(u=u.negate()),l&&(d=d.negate()),d=new h(r.mul(d.px,i.beta),d.py,d.pz),u.add(d)}multiply(e){let n,i;a(e);let s=e,{endo:o}=t;if(o){let{k1neg:e,k1:t,k2neg:a,k2:l}=o.splitScalar(s),{p:c,f:u}=this.wNAF(t),{p:d,f:p}=this.wNAF(l);c=f.constTimeNegate(e,c),d=f.constTimeNegate(a,d),d=new h(r.mul(d.px,o.beta),d.py,d.pz),n=c.add(d),i=u.add(p)}else{let{p:e,f:t}=this.wNAF(s);n=e,i=t}return h.normalizeZ([n,i])[0]}multiplyAndAddUnsafe(e,t,r){let n=h.BASE,i=(e,t)=>t!==uz&&t!==uV&&e.equals(n)?e.multiply(t):e.multiplyUnsafe(t),s=i(this,t).add(i(e,r));return s.is0()?void 0:s}toAffine(e){let{px:t,py:n,pz:i}=this,s=this.is0();null==e&&(e=s?r.ONE:r.inv(i));let o=r.mul(t,e),a=r.mul(n,e),l=r.mul(i,e);if(s)return{x:r.ZERO,y:r.ZERO};if(!r.eql(l,r.ONE))throw Error("invZ was invalid");return{x:o,y:a}}isTorsionFree(){let{h:e,isTorsionFree:r}=t;if(e===uV)return!0;if(r)return r(h,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:e,clearCofactor:r}=t;return e===uV?this:r?r(h,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return this.assertValidity(),n(h,this,e)}toHex(e=!0){return c8(this.toRawBytes(e))}}h.BASE=new h(t.Gx,t.Gy,r.ONE),h.ZERO=new h(r.ZERO,r.ONE,r.ZERO);let d=t.nBitLength,f=uF(h,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:h,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function uJ(e){let t=uU(e);return uf(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function uZ(e){let t=uJ(e),{Fp:r,n:n}=t,i=r.BYTES+1,s=2*r.BYTES+1;function o(e){return uz<e&&e<r.ORDER}function a(e){return uE(e,n)}function l(e){return uS(e,n)}let{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:h,isWithinCurveOrder:d}=uQ({...t,toBytes(e,t,n){let i=t.toAffine(),s=r.toBytes(i.x),o=ua;return n?o(Uint8Array.from([t.hasEvenY()?2:3]),s):o(Uint8Array.from([4]),s,r.toBytes(i.y))},fromBytes(e){let t=e.length,n=e[0],a=e.subarray(1);if(t===i&&(2===n||3===n)){let e,t=ur(a);if(!o(t))throw Error("Point is not on curve");let i=h(t);try{e=r.sqrt(i)}catch(e){throw Error("Point is not on curve"+(e instanceof Error?": "+e.message:""))}return(1&n)==1!=((e&uV)===uV)&&(e=r.neg(e)),{x:t,y:e}}if(t===s&&4===n)return{x:r.fromBytes(a.subarray(0,r.BYTES)),y:r.fromBytes(a.subarray(r.BYTES,2*r.BYTES))};throw Error(`Point of length ${t} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}}),f=e=>c8(ui(e,t.nByteLength));function p(e){return e>n>>uV}function g(e){return p(e)?a(-e):e}let m=(e,t,r)=>ur(e.slice(t,r));class y{constructor(e,t,r){this.r=e,this.s=t,this.recovery=r,this.assertValidity()}static fromCompact(e){let r=t.nByteLength;return new y(m(e=uo("compactSignature",e,2*r),0,r),m(e,r,2*r))}static fromDER(e){let{r:t,s:r}=uq.toSig(uo("DER",e));return new y(t,r)}assertValidity(){if(!d(this.r))throw Error("r must be 0 < r < CURVE.n");if(!d(this.s))throw Error("s must be 0 < s < CURVE.n")}addRecoveryBit(e){return new y(this.r,this.s,e)}recoverPublicKey(e){let{r:n,s:i,recovery:s}=this,o=x(uo("msgHash",e));if(null==s||![0,1,2,3].includes(s))throw Error("recovery id invalid");let u=2===s||3===s?n+t.n:n;if(u>=r.ORDER)throw Error("recovery id 2 or 3 invalid");let h=(1&s)==0?"02":"03",d=c.fromHex(h+f(u)),p=l(u),g=a(-o*p),m=a(i*p),y=c.BASE.multiplyAndAddUnsafe(d,g,m);if(!y)throw Error("point at infinify");return y.assertValidity(),y}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return ut(this.toDERHex())}toDERHex(){return uq.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return ut(this.toCompactHex())}toCompactHex(){return f(this.r)+f(this.s)}}let b={isValidPrivateKey(e){try{return u(e),!0}catch(e){return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{let e=uD(t.n);return uB(t.randomBytes(e),t.n)},precompute:(e=8,t=c.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function w(e,t=!0){return c.fromPrivateKey(e).toRawBytes(t)}function v(e){let t=c4(e),r="string"==typeof e,n=(t||r)&&e.length;return t?n===i||n===s:r?n===2*i||n===2*s:e instanceof c}function E(e,t,r=!0){if(v(e))throw Error("first arg must be private key");if(!v(t))throw Error("second arg must be public key");return c.fromHex(t).multiply(u(e)).toRawBytes(r)}let A=t.bits2int||function(e){let r=ur(e),n=8*e.length-t.nBitLength;return n>0?r>>BigInt(n):r},x=t.bits2int_modN||function(e){return a(A(e))},S=ul(t.nBitLength);function k(e){if("bigint"!=typeof e)throw Error("bigint expected");if(!(uz<=e&&e<S))throw Error(`bigint expected < 2^${t.nBitLength}`);return ui(e,t.nByteLength)}function _(e,n,i=I){if(["recovered","canonical"].some(e=>e in i))throw Error("sign() legacy options not supported");let{hash:s,randomBytes:o}=t,{lowS:h,prehash:f,extraEntropy:m}=i;null==h&&(h=!0),e=uo("msgHash",e),f&&(e=uo("prehashed msgHash",s(e)));let b=x(e),w=u(n),v=[k(w),k(b)];if(null!=m&&!1!==m){let e=!0===m?o(r.BYTES):m;v.push(uo("extraEntropy",e))}let E=ua(...v),S=b;return{seed:E,k2sig:function(e){let t=A(e);if(!d(t))return;let r=l(t),n=c.BASE.multiply(t).toAffine(),i=a(n.x);if(i===uz)return;let s=a(r*a(S+i*w));if(s===uz)return;let o=2*(n.x!==i)|Number(n.y&uV),u=s;return h&&p(s)&&(u=g(s),o^=1),new y(i,u,o)}}}let I={lowS:t.lowS,prehash:!1},C={lowS:t.lowS,prehash:!1};function T(e,r,n=I){let{seed:i,k2sig:s}=_(e,r,n),o=t;return uh(o.hash.outputLen,o.nByteLength,o.hmac)(i,s)}function P(e,r,n,i=C){let s,o,u=e;if(r=uo("msgHash",r),n=uo("publicKey",n),"strict"in i)throw Error("options.strict was renamed to lowS");let{lowS:h,prehash:d}=i;try{if("string"==typeof u||c4(u))try{o=y.fromDER(u)}catch(e){if(!(e instanceof uq.Err))throw e;o=y.fromCompact(u)}else if("object"==typeof u&&"bigint"==typeof u.r&&"bigint"==typeof u.s){let{r:e,s:t}=u;o=new y(e,t)}else throw Error("PARSE");s=c.fromHex(n)}catch(e){if("PARSE"===e.message)throw Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(h&&o.hasHighS())return!1;d&&(r=t.hash(r));let{r:f,s:p}=o,g=x(r),m=l(p),b=a(g*m),w=a(f*m),v=c.BASE.multiplyAndAddUnsafe(s,b,w)?.toAffine();return!!v&&a(v.x)===f}return c.BASE._setWindowSize(8),{CURVE:t,getPublicKey:w,getSharedSecret:E,sign:T,verify:P,ProjectivePoint:c,Signature:y,utils:b}}function uY(e){return{hash:e,hmac:(t,...r)=>cP(e,t,n1(...r)),randomBytes:n6}}function uX(e,t){let r=t=>uZ({...e,...uY(t)});return Object.freeze({...r(t),create:r})}let u0=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),u1=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),u2=BigInt(1),u3=BigInt(2),u4=(e,t)=>(e+t/u3)/t;function u5(e){let t=u0,r=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=e*e*e%t,u=c*c*e%t,h=ux(u,r,t)*u%t,d=ux(h,r,t)*u%t,f=ux(d,u3,t)*c%t,p=ux(f,i,t)*f%t,g=ux(p,s,t)*p%t,m=ux(g,a,t)*g%t,y=ux(m,l,t)*m%t,b=ux(y,a,t)*g%t,w=ux(b,r,t)*u%t,v=ux(w,o,t)*p%t,E=ux(v,n,t)*c%t,A=ux(E,u3,t);if(!u6.eql(u6.sqr(A),e))throw Error("Cannot find square root");return A}let u6=uO(u0,void 0,void 0,{sqrt:u5}),u8=uX({a:BigInt(0),b:BigInt(7),Fp:u6,n:u1,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=u1,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-u2*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=u4(s*e,t),l=u4(-n*e,t),c=uE(e-a*r-l*i,t),u=uE(-a*n-l*s,t),h=c>o,d=u>o;if(h&&(c=t-c),d&&(u=t-u),c>o||u>o)throw Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:h,k1:c,k2neg:d,k2:u}}}},cH),u7=BigInt(0),u9=e=>"bigint"==typeof e&&u7<e&&e<u0,he=e=>"bigint"==typeof e&&u7<e&&e<u1,ht={};function hr(e,...t){let r=ht[e];if(void 0===r){let t=sha256(Uint8Array.from(e,e=>e.charCodeAt(0)));r=concatBytes(t,t),ht[e]=r}return sha256(concatBytes(r,...t))}let hn=e=>e.toRawBytes(!0).slice(1),hi=e=>numberToBytesBE(e,32),hs=e=>mod(e,u0),ho=e=>mod(e,u1),ha=u8.ProjectivePoint,hl=(e,t,r)=>ha.BASE.multiplyAndAddUnsafe(e,t,r);function hc(e){if(!u9(e))throw Error("bad x: need 0 < x < p");let t=hs(e*e),r=u5(hs(t*e+BigInt(7)));r%u3!==u7&&(r=hs(-r));let n=new ha(e,r,u2);return n.assertValidity(),n}function hu(...e){return ho(bytesToNumberBE(hr("BIP0340/challenge",...e)))}let hh=null!=(D=u8)?D:J,hd=BigInt("0xffffffffffffffff"),hf=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),hp=hh.CURVE.n/BigInt(2),hg={type:"object",required:["crypto","id","version","address"],properties:{crypto:{type:"object",required:["cipher","ciphertext","cipherparams","kdf","kdfparams","mac"],properties:{cipher:{type:"string"},ciphertext:{type:"string"},cipherparams:{type:"object"},kdf:{type:"string"},kdfparams:{type:"object"},salt:{type:"string"},mac:{type:"string"}}},id:{type:"string"},version:{type:"number"},address:{type:"string"}}};!function(e){e[e.Mainnet=1]="Mainnet",e[e.Goerli=5]="Goerli",e[e.Sepolia=0xaa36a7]="Sepolia"}(B||(B={})),function(e){e.Chainstart="chainstart",e.Homestead="homestead",e.Dao="dao",e.TangerineWhistle="tangerineWhistle",e.SpuriousDragon="spuriousDragon",e.Byzantium="byzantium",e.Constantinople="constantinople",e.Petersburg="petersburg",e.Istanbul="istanbul",e.MuirGlacier="muirGlacier",e.Berlin="berlin",e.London="london",e.ArrowGlacier="arrowGlacier",e.GrayGlacier="grayGlacier",e.MergeForkIdTransition="mergeForkIdTransition",e.Merge="merge",e.Shanghai="shanghai",e.ShardingForkDev="shardingFork"}(M||(M={})),function(e){e.ProofOfStake="pos",e.ProofOfWork="pow",e.ProofOfAuthority="poa"}(L||(L={})),function(e){e.Ethash="ethash",e.Clique="clique",e.Casper="casper"}(F||(F={})),function(e){e.PolygonMainnet="polygon-mainnet",e.PolygonMumbai="polygon-mumbai",e.ArbitrumRinkebyTestnet="arbitrum-rinkeby-testnet",e.ArbitrumOne="arbitrum-one",e.xDaiChain="x-dai-chain",e.OptimisticKovan="optimistic-kovan",e.OptimisticEthereum="optimistic-ethereum"}(U||(U={})),function(e){e[e.Number=0]="Number",e[e.BigInt=1]="BigInt",e[e.Uint8Array=2]="Uint8Array",e[e.PrefixedHexString=3]="PrefixedHexString"}(j||(j={}));let hm=e=>{if("string"!=typeof e)throw Error(`[stripHexPrefix] input must be type 'string', received ${typeof e}`);return oF(e)?e.slice(2):e};function hy(e){return e&&"0x0"!==e?oF(e)?`0x${hm(e).padStart(16,"0")}`:`0x${e.padStart(16,"0")}`:"0x0000000000000000"}let hb=function(e){if(!Number.isSafeInteger(e)||e<0)throw Error(`Received an invalid integer type: ${e}`);return`0x${e.toString(16)}`};function hw(e,t=!0){var r,n;let{name:i,config:s,difficulty:o,mixHash:a,gasLimit:l,coinbase:c,baseFeePerGas:u}=e,{extraData:h,timestamp:d,nonce:f}=e,p=Number(d),{chainId:g}=s;if(""===h&&(h="0x"),oF(d)||(d=hb(parseInt(d))),18!==f.length&&(f=hy(f)),s.eip155Block!==s.eip158Block)throw Error("EIP155 block number must equal EIP 158 block number since both are part of SpuriousDragon hardfork and the client only supports activating the full hardfork");let m={name:i,chainId:g,networkId:g,genesis:{timestamp:d,gasLimit:parseInt(l),difficulty:parseInt(o),nonce:f,extraData:h,mixHash:a,coinbase:c,baseFeePerGas:u},hardfork:void 0,hardforks:[],bootstrapNodes:[],consensus:void 0!==s.clique?{type:"poa",algorithm:"clique",clique:{period:null!=(r=s.clique.period)?r:s.clique.blockperiodseconds,epoch:null!=(n=s.clique.epoch)?n:s.clique.epochlength}}:{type:"pow",algorithm:"ethash",ethash:{}}},y={[M.Homestead]:{name:"homesteadBlock"},[M.Dao]:{name:"daoForkBlock"},[M.TangerineWhistle]:{name:"eip150Block"},[M.SpuriousDragon]:{name:"eip155Block"},[M.Byzantium]:{name:"byzantiumBlock"},[M.Constantinople]:{name:"constantinopleBlock"},[M.Petersburg]:{name:"petersburgBlock"},[M.Istanbul]:{name:"istanbulBlock"},[M.MuirGlacier]:{name:"muirGlacierBlock"},[M.Berlin]:{name:"berlinBlock"},[M.London]:{name:"londonBlock"},[M.MergeForkIdTransition]:{name:"mergeForkBlock",postMerge:t},[M.Shanghai]:{name:"shanghaiTime",postMerge:!0,isTimestamp:!0},[M.ShardingForkDev]:{name:"shardingForkTime",postMerge:!0,isTimestamp:!0}},b=Object.keys(y).reduce((e,t)=>(e[y[t].name]=t,e),{});if(m.hardforks=Object.keys(s).filter(e=>void 0!==b[e]&&void 0!==s[e]&&null!==s[e]).map(e=>({name:b[e],block:!0===y[b[e]].isTimestamp||"number"!=typeof s[e]?null:s[e],timestamp:!0===y[b[e]].isTimestamp&&"number"==typeof s[e]?s[e]:void 0})).filter(e=>null!==e.block||void 0!==e.timestamp),m.hardforks.sort((e,t)=>{var r,n;return(null!=(r=e.block)?r:1/0)-(null!=(n=t.block)?n:1/0)}),m.hardforks.sort((e,t)=>{var r,n;return(null!=(r=e.timestamp)?r:p)-(null!=(n=t.timestamp)?n:p)}),void 0!==s.terminalTotalDifficulty){let e={name:M.Merge,ttd:s.terminalTotalDifficulty,block:null},t=m.hardforks.findIndex(e=>{var t;return(null==(t=y[e.name])?void 0:t.postMerge)===!0});-1!==t?m.hardforks.splice(t,0,e):m.hardforks.push(e)}let w=m.hardforks.length>0?m.hardforks.slice(-1)[0]:void 0;return m.hardfork=null==w?void 0:w.name,m.hardforks.unshift({name:M.Chainstart,block:0}),m}function hv(e,t,r){try{if(["config","difficulty","gasLimit","alloc"].some(t=>!(t in e)))throw Error("Invalid format, expected geth genesis fields missing");return void 0!==t&&(e.name=t),hw(e,r)}catch(e){throw Error(`Error parsing parameters file: ${e.message}`)}}function hE(e){let t=e;if("string"!=typeof t)throw Error(`[padToEven] value must be type 'string', received ${typeof t}`);return t.length%2&&(t=`0${t}`),t}let hA=function(e){let t=hb(e);return aI(`0x${hE(t.slice(2))}`)},hx=function(e){var t;if(null==e)return new Uint8Array;if(e instanceof Uint8Array)return e;if((null==(t=null==e?void 0:e.constructor)?void 0:t.name)==="Uint8Array"||Array.isArray(e))return Uint8Array.from(e);if("string"==typeof e){if(!oM(e))throw Error(`Cannot convert string to Uint8Array. only supports 0x-prefixed hex strings and this string was given: ${e}`);return aI(hE(hm(e)))}if("number"==typeof e)return hx(aP(e));if("bigint"==typeof e){if(e<BigInt(0))throw Error(`Cannot convert negative bigint to Uint8Array. Given: ${e}`);let t=e.toString(16);return t.length%2&&(t=`0${t}`),hx(`0x${t}`)}if(e.toArray)return Uint8Array.from(e.toArray());throw Error("invalid type")};function hS(e){let t=a_(e);return"0x"===t?BigInt(0):BigInt(t)}function hk(e){return hx(`0x${e.toString(16)}`)}let h_=function(e){return new Uint8Array(e).fill(0)},hI=function(e,t,r){let n=h_(t);return r?e.length<t?(n.set(e),n):e.subarray(0,t):e.length<t?(n.set(e,t-e.length),n):e.subarray(-t)};function hC(e){if(!aw(e))throw Error(`This method only supports Uint8Array but input was: ${e}`)}let hT=function(e,t){return hC(e),hI(e,t,!1)};function hP(e){let t=e[0];for(;e.length>0&&"0"===t.toString();)t=(e=e.slice(1))[0];return e}let hR=function(e){return hC(e),hP(e)},hO=e=>`0x${e.toString(16)}`;function hN(e){return hR(hk(e))}function hD(e,t){return e===BigInt(0)||e===BigInt(1)?e:void 0===t?e-BigInt(27):e-(t*BigInt(2)+BigInt(35))}function hB(e){return e===BigInt(0)||e===BigInt(1)}let hM=function(e,t,r,n,i){let s=hD(t,i);if(!hB(s))throw Error("Invalid signature v value");return new hh.Signature(hS(r),hS(n)).addRecoveryBit(Number(s)).recoverPublicKey(e).toRawBytes(!1).slice(1)};function hL(e,t){if(null===e)return null;if(void 0===e)return;if("string"!=typeof e||oM(e)){if("number"==typeof e&&!Number.isSafeInteger(e))throw Error("The provided number is greater than MAX_SAFE_INTEGER (please use an alternative input type)")}else throw Error(`A string must be provided with a 0x-prefix, given: ${e}`);let r=hx(e);switch(t){case j.Uint8Array:return r;case j.BigInt:return hS(r);case j.Number:{let e=hS(r);if(e>BigInt(Number.MAX_SAFE_INTEGER))throw Error("The provided number is greater than MAX_SAFE_INTEGER (please use an alternative output type)");return Number(e)}case j.PrefixedHexString:return a_(r);default:throw Error("unknown outputType")}}var hF=r(40944),hU=r(40463);let hj={name:"goerli",chainId:5,networkId:5,defaultHardfork:"merge",consensus:{type:"poa",algorithm:"clique",clique:{period:15,epoch:3e4}},comment:"Cross-client PoA test network",url:"https://github.com/goerli/testnet",genesis:{timestamp:"0x5c51a607",gasLimit:0xa00000,difficulty:1,nonce:"0x0000000000000000",extraData:"0x22466c6578692069732061207468696e6722202d204166726900000000000000e0a2bd4258d2768837baa26a28fe71dc079f84c70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"},hardforks:[{name:"chainstart",block:0,forkHash:"0xa3f5ab08"},{name:"homestead",block:0,forkHash:"0xa3f5ab08"},{name:"tangerineWhistle",block:0,forkHash:"0xa3f5ab08"},{name:"spuriousDragon",block:0,forkHash:"0xa3f5ab08"},{name:"byzantium",block:0,forkHash:"0xa3f5ab08"},{name:"constantinople",block:0,forkHash:"0xa3f5ab08"},{name:"petersburg",block:0,forkHash:"0xa3f5ab08"},{name:"istanbul",block:1561651,forkHash:"0xc25efa5c"},{name:"berlin",block:4460644,forkHash:"0x757a1c47"},{name:"london",block:5062605,forkHash:"0xb8c6299d"},{"//_comment":"The forkHash will remain same as mergeForkIdTransition is post merge, terminal block: https://goerli.etherscan.io/block/7382818",name:"merge",ttd:"10790000",block:7382819,forkHash:"0xb8c6299d"},{name:"mergeForkIdTransition",block:null,forkHash:null},{name:"shanghai",block:null,forkHash:null}],bootstrapNodes:[],dnsNetworks:["enrtree://AKA3AM6LPBYEUDMVNU3BSVQJ5AD45Y7YPOHJLEF6W26QOE4VTUDPE@all.goerli.ethdisco.net"]},h$={name:"mainnet",chainId:1,networkId:1,defaultHardfork:"merge",consensus:{type:"pow",algorithm:"ethash",ethash:{}},comment:"The Ethereum main chain",url:"https://ethstats.net/",genesis:{gasLimit:5e3,difficulty:0x400000000,nonce:"0x0000000000000042",extraData:"0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa"},hardforks:[{name:"chainstart",block:0,forkHash:"0xfc64ec04"},{name:"homestead",block:115e4,forkHash:"0x97c2c34c"},{name:"dao",block:192e4,forkHash:"0x91d1f948"},{name:"tangerineWhistle",block:2463e3,forkHash:"0x7a64da13"},{name:"spuriousDragon",block:2675e3,forkHash:"0x3edd5b10"},{name:"byzantium",block:437e4,forkHash:"0xa00bc324"},{name:"constantinople",block:728e4,forkHash:"0x668db0af"},{name:"petersburg",block:728e4,forkHash:"0x668db0af"},{name:"istanbul",block:9069e3,forkHash:"0x879d6e30"},{name:"muirGlacier",block:92e5,forkHash:"0xe029e991"},{name:"berlin",block:12244e3,forkHash:"0x0eb440f6"},{name:"london",block:12965e3,forkHash:"0xb715077d"},{name:"arrowGlacier",block:13773e3,forkHash:"0x20c327fc"},{name:"grayGlacier",block:1505e4,forkHash:"0xf0afd0e3"},{"//_comment":"The forkHash will remain same as mergeForkIdTransition is post merge, terminal block: https://etherscan.io/block/15537393",name:"merge",ttd:"58750000000000000000000",block:0xed14f2,forkHash:"0xf0afd0e3"},{name:"mergeForkIdTransition",block:null,forkHash:null},{name:"shanghai",block:null,forkHash:null}],bootstrapNodes:[],dnsNetworks:["enrtree://AKA3AM6LPBYEUDMVNU3BSVQJ5AD45Y7YPOHJLEF6W26QOE4VTUDPE@all.mainnet.ethdisco.net"]},hH={name:"sepolia",chainId:0xaa36a7,networkId:0xaa36a7,defaultHardfork:"merge",consensus:{type:"pow",algorithm:"ethash",ethash:{}},comment:"PoW test network to replace Ropsten",url:"https://github.com/ethereum/go-ethereum/pull/23730",genesis:{timestamp:"0x6159af19",gasLimit:3e7,difficulty:131072,nonce:"0x0000000000000000",extraData:"0x5365706f6c69612c20417468656e732c204174746963612c2047726565636521"},hardforks:[{name:"chainstart",block:0,forkHash:"0xfe3366e7"},{name:"homestead",block:0,forkHash:"0xfe3366e7"},{name:"tangerineWhistle",block:0,forkHash:"0xfe3366e7"},{name:"spuriousDragon",block:0,forkHash:"0xfe3366e7"},{name:"byzantium",block:0,forkHash:"0xfe3366e7"},{name:"constantinople",block:0,forkHash:"0xfe3366e7"},{name:"petersburg",block:0,forkHash:"0xfe3366e7"},{name:"istanbul",block:0,forkHash:"0xfe3366e7"},{name:"muirGlacier",block:0,forkHash:"0xfe3366e7"},{name:"berlin",block:0,forkHash:"0xfe3366e7"},{name:"london",block:0,forkHash:"0xfe3366e7"},{"//_comment":"The forkHash will remain same as mergeForkIdTransition is post merge, terminal block: https://sepolia.etherscan.io/block/1450408",name:"merge",ttd:"17000000000000000",block:1450409,forkHash:"0xfe3366e7"},{name:"mergeForkIdTransition",block:1735371,forkHash:"0xb96cbd13"},{name:"shanghai",block:null,timestamp:"1677557088",forkHash:"0xf7f9bc08"}],bootstrapNodes:[],dnsNetworks:["enrtree://AKA3AM6LPBYEUDMVNU3BSVQJ5AD45Y7YPOHJLEF6W26QOE4VTUDPE@all.sepolia.ethdisco.net"]},hq={1153:{name:"EIP-1153",number:1153,comment:"Transient Storage",url:"https://eips.ethereum.org/EIPS/eip-1153",status:"Review",minimumHardfork:"chainstart",requiredEIPs:[],gasConfig:{},gasPrices:{tstore:{v:100,d:"Base fee of the TSTORE opcode"},tload:{v:100,d:"Base fee of the TLOAD opcode"}},vm:{},pow:{}},1559:{name:"EIP-1559",number:1559,comment:"Fee market change for ETH 1.0 chain",url:"https://eips.ethereum.org/EIPS/eip-1559",status:"Final",minimumHardfork:"berlin",requiredEIPs:[2930],gasConfig:{baseFeeMaxChangeDenominator:{v:8,d:"Maximum base fee change denominator"},elasticityMultiplier:{v:2,d:"Maximum block gas target elasticity"},initialBaseFee:{v:1e9,d:"Initial base fee on first EIP1559 block"}},gasPrices:{},vm:{},pow:{}},2315:{name:"EIP-2315",number:2315,comment:"Simple subroutines for the EVM",url:"https://eips.ethereum.org/EIPS/eip-2315",status:"Draft",minimumHardfork:"istanbul",gasConfig:{},gasPrices:{beginsub:{v:2,d:"Base fee of the BEGINSUB opcode"},returnsub:{v:5,d:"Base fee of the RETURNSUB opcode"},jumpsub:{v:10,d:"Base fee of the JUMPSUB opcode"}},vm:{},pow:{}},2537:{name:"EIP-2537",number:2537,comment:"BLS12-381 precompiles",url:"https://eips.ethereum.org/EIPS/eip-2537",status:"Draft",minimumHardfork:"chainstart",gasConfig:{},gasPrices:{Bls12381G1AddGas:{v:600,d:"Gas cost of a single BLS12-381 G1 addition precompile-call"},Bls12381G1MulGas:{v:12e3,d:"Gas cost of a single BLS12-381 G1 multiplication precompile-call"},Bls12381G2AddGas:{v:4500,d:"Gas cost of a single BLS12-381 G2 addition precompile-call"},Bls12381G2MulGas:{v:55e3,d:"Gas cost of a single BLS12-381 G2 multiplication precompile-call"},Bls12381PairingBaseGas:{v:115e3,d:"Base gas cost of BLS12-381 pairing check"},Bls12381PairingPerPairGas:{v:23e3,d:"Per-pair gas cost of BLS12-381 pairing check"},Bls12381MapG1Gas:{v:5500,d:"Gas cost of BLS12-381 map field element to G1"},Bls12381MapG2Gas:{v:11e4,d:"Gas cost of BLS12-381 map field element to G2"},Bls12381MultiExpGasDiscount:{v:[[1,1200],[2,888],[3,764],[4,641],[5,594],[6,547],[7,500],[8,453],[9,438],[10,423],[11,408],[12,394],[13,379],[14,364],[15,349],[16,334],[17,330],[18,326],[19,322],[20,318],[21,314],[22,310],[23,306],[24,302],[25,298],[26,294],[27,289],[28,285],[29,281],[30,277],[31,273],[32,269],[33,268],[34,266],[35,265],[36,263],[37,262],[38,260],[39,259],[40,257],[41,256],[42,254],[43,253],[44,251],[45,250],[46,248],[47,247],[48,245],[49,244],[50,242],[51,241],[52,239],[53,238],[54,236],[55,235],[56,233],[57,232],[58,231],[59,229],[60,228],[61,226],[62,225],[63,223],[64,222],[65,221],[66,220],[67,219],[68,219],[69,218],[70,217],[71,216],[72,216],[73,215],[74,214],[75,213],[76,213],[77,212],[78,211],[79,211],[80,210],[81,209],[82,208],[83,208],[84,207],[85,206],[86,205],[87,205],[88,204],[89,203],[90,202],[91,202],[92,201],[93,200],[94,199],[95,199],[96,198],[97,197],[98,196],[99,196],[100,195],[101,194],[102,193],[103,193],[104,192],[105,191],[106,191],[107,190],[108,189],[109,188],[110,188],[111,187],[112,186],[113,185],[114,185],[115,184],[116,183],[117,182],[118,182],[119,181],[120,180],[121,179],[122,179],[123,178],[124,177],[125,176],[126,176],[127,175],[128,174]],d:"Discount gas costs of calls to the MultiExp precompiles with `k` (point, scalar) pair"}},vm:{},pow:{}},2565:{name:"EIP-2565",number:2565,comment:"ModExp gas cost",url:"https://eips.ethereum.org/EIPS/eip-2565",status:"Final",minimumHardfork:"byzantium",gasConfig:{},gasPrices:{modexpGquaddivisor:{v:3,d:"Gquaddivisor from modexp precompile for gas calculation"}},vm:{},pow:{}},2718:{name:"EIP-2718",comment:"Typed Transaction Envelope",url:"https://eips.ethereum.org/EIPS/eip-2718",status:"Final",minimumHardfork:"chainstart",gasConfig:{},gasPrices:{},vm:{},pow:{}},2929:{name:"EIP-2929",comment:"Gas cost increases for state access opcodes",url:"https://eips.ethereum.org/EIPS/eip-2929",status:"Final",minimumHardfork:"chainstart",gasConfig:{},gasPrices:{coldsload:{v:2100,d:"Gas cost of the first read of storage from a given location (per transaction)"},coldaccountaccess:{v:2600,d:"Gas cost of the first read of a given address (per transaction)"},warmstorageread:{v:100,d:"Gas cost of reading storage locations which have already loaded 'cold'"},sstoreCleanGasEIP2200:{v:2900,d:"Once per SSTORE operation from clean non-zero to something else"},sstoreNoopGasEIP2200:{v:100,d:"Once per SSTORE operation if the value doesn't change"},sstoreDirtyGasEIP2200:{v:100,d:"Once per SSTORE operation if a dirty value is changed"},sstoreInitRefundEIP2200:{v:19900,d:"Once per SSTORE operation for resetting to the original zero value"},sstoreCleanRefundEIP2200:{v:4900,d:"Once per SSTORE operation for resetting to the original non-zero value"},call:{v:0,d:"Base fee of the CALL opcode"},callcode:{v:0,d:"Base fee of the CALLCODE opcode"},delegatecall:{v:0,d:"Base fee of the DELEGATECALL opcode"},staticcall:{v:0,d:"Base fee of the STATICCALL opcode"},balance:{v:0,d:"Base fee of the BALANCE opcode"},extcodesize:{v:0,d:"Base fee of the EXTCODESIZE opcode"},extcodecopy:{v:0,d:"Base fee of the EXTCODECOPY opcode"},extcodehash:{v:0,d:"Base fee of the EXTCODEHASH opcode"},sload:{v:0,d:"Base fee of the SLOAD opcode"},sstore:{v:0,d:"Base fee of the SSTORE opcode"}},vm:{},pow:{}},2930:{name:"EIP-2930",comment:"Optional access lists",url:"https://eips.ethereum.org/EIPS/eip-2930",status:"Final",minimumHardfork:"istanbul",requiredEIPs:[2718,2929],gasConfig:{},gasPrices:{accessListStorageKeyCost:{v:1900,d:"Gas cost per storage key in an Access List transaction"},accessListAddressCost:{v:2400,d:"Gas cost per storage key in an Access List transaction"}},vm:{},pow:{}},3198:{name:"EIP-3198",number:3198,comment:"BASEFEE opcode",url:"https://eips.ethereum.org/EIPS/eip-3198",status:"Final",minimumHardfork:"london",gasConfig:{},gasPrices:{basefee:{v:2,d:"Gas cost of the BASEFEE opcode"}},vm:{},pow:{}},3529:{name:"EIP-3529",comment:"Reduction in refunds",url:"https://eips.ethereum.org/EIPS/eip-3529",status:"Final",minimumHardfork:"berlin",requiredEIPs:[2929],gasConfig:{maxRefundQuotient:{v:5,d:"Maximum refund quotient; max tx refund is min(tx.gasUsed/maxRefundQuotient, tx.gasRefund)"}},gasPrices:{selfdestructRefund:{v:0,d:"Refunded following a selfdestruct operation"},sstoreClearRefundEIP2200:{v:4800,d:"Once per SSTORE operation for clearing an originally existing storage slot"}},vm:{},pow:{}},3540:{name:"EIP-3540",number:3540,comment:"EVM Object Format (EOF) v1",url:"https://eips.ethereum.org/EIPS/eip-3540",status:"Review",minimumHardfork:"london",requiredEIPs:[3541],gasConfig:{},gasPrices:{},vm:{},pow:{}},3541:{name:"EIP-3541",comment:"Reject new contracts starting with the 0xEF byte",url:"https://eips.ethereum.org/EIPS/eip-3541",status:"Final",minimumHardfork:"berlin",requiredEIPs:[],gasConfig:{},gasPrices:{},vm:{},pow:{}},3554:{name:"EIP-3554",comment:"Reduction in refunds",url:"Difficulty Bomb Delay to December 1st 2021",status:"Final",minimumHardfork:"muirGlacier",requiredEIPs:[],gasConfig:{},gasPrices:{},vm:{},pow:{difficultyBombDelay:{v:95e5,d:"the amount of blocks to delay the difficulty bomb with"}}},3607:{name:"EIP-3607",number:3607,comment:"Reject transactions from senders with deployed code",url:"https://eips.ethereum.org/EIPS/eip-3607",status:"Final",minimumHardfork:"chainstart",requiredEIPs:[],gasConfig:{},gasPrices:{},vm:{},pow:{}},3651:{name:"EIP-3651",number:3198,comment:"Warm COINBASE",url:"https://eips.ethereum.org/EIPS/eip-3651",status:"Review",minimumHardfork:"london",requiredEIPs:[2929],gasConfig:{},gasPrices:{},vm:{},pow:{}},3670:{name:"EIP-3670",number:3670,comment:"EOF - Code Validation",url:"https://eips.ethereum.org/EIPS/eip-3670",status:"Review",minimumHardfork:"london",requiredEIPs:[3540],gasConfig:{},gasPrices:{},vm:{},pow:{}},3675:{name:"EIP-3675",number:3675,comment:"Upgrade consensus to Proof-of-Stake",url:"https://eips.ethereum.org/EIPS/eip-3675",status:"Final",minimumHardfork:"london",requiredEIPs:[],gasConfig:{},gasPrices:{},vm:{},pow:{}},3855:{name:"EIP-3855",number:3855,comment:"PUSH0 instruction",url:"https://eips.ethereum.org/EIPS/eip-3855",status:"Review",minimumHardfork:"chainstart",requiredEIPs:[],gasConfig:{},gasPrices:{push0:{v:2,d:"Base fee of the PUSH0 opcode"}},vm:{},pow:{}},3860:{name:"EIP-3860",number:3860,comment:"Limit and meter initcode",url:"https://eips.ethereum.org/EIPS/eip-3860",status:"Review",minimumHardfork:"spuriousDragon",requiredEIPs:[],gasConfig:{},gasPrices:{initCodeWordCost:{v:2,d:"Gas to pay for each word (32 bytes) of initcode when creating a contract"}},vm:{maxInitCodeSize:{v:49152,d:"Maximum length of initialization code when creating a contract"}},pow:{}},4345:{name:"EIP-4345",number:4345,comment:"Difficulty Bomb Delay to June 2022",url:"https://eips.ethereum.org/EIPS/eip-4345",status:"Final",minimumHardfork:"london",gasConfig:{},gasPrices:{},vm:{},pow:{difficultyBombDelay:{v:107e5,d:"the amount of blocks to delay the difficulty bomb with"}}},4399:{name:"EIP-4399",number:4399,comment:"Supplant DIFFICULTY opcode with PREVRANDAO",url:"https://eips.ethereum.org/EIPS/eip-4399",status:"Review",minimumHardfork:"london",requiredEIPs:[],gasConfig:{},gasPrices:{},vm:{},pow:{}},5133:{name:"EIP-5133",number:5133,comment:"Delaying Difficulty Bomb to mid-September 2022",url:"https://eips.ethereum.org/EIPS/eip-5133",status:"Draft",minimumHardfork:"grayGlacier",gasConfig:{},gasPrices:{},vm:{},pow:{difficultyBombDelay:{v:114e5,d:"the amount of blocks to delay the difficulty bomb with"}}}},hz={chainstart:{name:"chainstart",comment:"Start of the Ethereum main chain",url:"",status:"",gasConfig:{minGasLimit:{v:5e3,d:"Minimum the gas limit may ever be"},gasLimitBoundDivisor:{v:1024,d:"The bound divisor of the gas limit, used in update calculations"},maxRefundQuotient:{v:2,d:"Maximum refund quotient; max tx refund is min(tx.gasUsed/maxRefundQuotient, tx.gasRefund)"}},gasPrices:{base:{v:2,d:"Gas base cost, used e.g. for ChainID opcode (Istanbul)"},tierStep:{v:[0,2,3,5,8,10,20],d:"Once per operation, for a selection of them"},exp:{v:10,d:"Base fee of the EXP opcode"},expByte:{v:10,d:"Times ceil(log256(exponent)) for the EXP instruction"},sha3:{v:30,d:"Base fee of the SHA3 opcode"},sha3Word:{v:6,d:"Once per word of the SHA3 operation's data"},sload:{v:50,d:"Base fee of the SLOAD opcode"},sstoreSet:{v:2e4,d:"Once per SSTORE operation if the zeroness changes from zero"},sstoreReset:{v:5e3,d:"Once per SSTORE operation if the zeroness does not change from zero"},sstoreRefund:{v:15e3,d:"Once per SSTORE operation if the zeroness changes to zero"},jumpdest:{v:1,d:"Base fee of the JUMPDEST opcode"},log:{v:375,d:"Base fee of the LOG opcode"},logData:{v:8,d:"Per byte in a LOG* operation's data"},logTopic:{v:375,d:"Multiplied by the * of the LOG*, per LOG transaction. e.g. LOG0 incurs 0 * c_txLogTopicGas, LOG4 incurs 4 * c_txLogTopicGas"},create:{v:32e3,d:"Base fee of the CREATE opcode"},call:{v:40,d:"Base fee of the CALL opcode"},callStipend:{v:2300,d:"Free gas given at beginning of call"},callValueTransfer:{v:9e3,d:"Paid for CALL when the value transfor is non-zero"},callNewAccount:{v:25e3,d:"Paid for CALL when the destination address didn't exist prior"},selfdestructRefund:{v:24e3,d:"Refunded following a selfdestruct operation"},memory:{v:3,d:"Times the address of the (highest referenced byte in memory + 1). NOTE: referencing happens on read, write and in instructions such as RETURN and CALL"},quadCoeffDiv:{v:512,d:"Divisor for the quadratic particle of the memory cost equation"},createData:{v:200,d:""},tx:{v:21e3,d:"Per transaction. NOTE: Not payable on data of calls between transactions"},txCreation:{v:32e3,d:"The cost of creating a contract via tx"},txDataZero:{v:4,d:"Per byte of data attached to a transaction that equals zero. NOTE: Not payable on data of calls between transactions"},txDataNonZero:{v:68,d:"Per byte of data attached to a transaction that is not equal to zero. NOTE: Not payable on data of calls between transactions"},copy:{v:3,d:"Multiplied by the number of 32-byte words that are copied (round up) for any *COPY operation and added"},ecRecover:{v:3e3,d:""},sha256:{v:60,d:""},sha256Word:{v:12,d:""},ripemd160:{v:600,d:""},ripemd160Word:{v:120,d:""},identity:{v:15,d:""},identityWord:{v:3,d:""},stop:{v:0,d:"Base fee of the STOP opcode"},add:{v:3,d:"Base fee of the ADD opcode"},mul:{v:5,d:"Base fee of the MUL opcode"},sub:{v:3,d:"Base fee of the SUB opcode"},div:{v:5,d:"Base fee of the DIV opcode"},sdiv:{v:5,d:"Base fee of the SDIV opcode"},mod:{v:5,d:"Base fee of the MOD opcode"},smod:{v:5,d:"Base fee of the SMOD opcode"},addmod:{v:8,d:"Base fee of the ADDMOD opcode"},mulmod:{v:8,d:"Base fee of the MULMOD opcode"},signextend:{v:5,d:"Base fee of the SIGNEXTEND opcode"},lt:{v:3,d:"Base fee of the LT opcode"},gt:{v:3,d:"Base fee of the GT opcode"},slt:{v:3,d:"Base fee of the SLT opcode"},sgt:{v:3,d:"Base fee of the SGT opcode"},eq:{v:3,d:"Base fee of the EQ opcode"},iszero:{v:3,d:"Base fee of the ISZERO opcode"},and:{v:3,d:"Base fee of the AND opcode"},or:{v:3,d:"Base fee of the OR opcode"},xor:{v:3,d:"Base fee of the XOR opcode"},not:{v:3,d:"Base fee of the NOT opcode"},byte:{v:3,d:"Base fee of the BYTE opcode"},address:{v:2,d:"Base fee of the ADDRESS opcode"},balance:{v:20,d:"Base fee of the BALANCE opcode"},origin:{v:2,d:"Base fee of the ORIGIN opcode"},caller:{v:2,d:"Base fee of the CALLER opcode"},callvalue:{v:2,d:"Base fee of the CALLVALUE opcode"},calldataload:{v:3,d:"Base fee of the CALLDATALOAD opcode"},calldatasize:{v:2,d:"Base fee of the CALLDATASIZE opcode"},calldatacopy:{v:3,d:"Base fee of the CALLDATACOPY opcode"},codesize:{v:2,d:"Base fee of the CODESIZE opcode"},codecopy:{v:3,d:"Base fee of the CODECOPY opcode"},gasprice:{v:2,d:"Base fee of the GASPRICE opcode"},extcodesize:{v:20,d:"Base fee of the EXTCODESIZE opcode"},extcodecopy:{v:20,d:"Base fee of the EXTCODECOPY opcode"},blockhash:{v:20,d:"Base fee of the BLOCKHASH opcode"},coinbase:{v:2,d:"Base fee of the COINBASE opcode"},timestamp:{v:2,d:"Base fee of the TIMESTAMP opcode"},number:{v:2,d:"Base fee of the NUMBER opcode"},difficulty:{v:2,d:"Base fee of the DIFFICULTY opcode"},gaslimit:{v:2,d:"Base fee of the GASLIMIT opcode"},pop:{v:2,d:"Base fee of the POP opcode"},mload:{v:3,d:"Base fee of the MLOAD opcode"},mstore:{v:3,d:"Base fee of the MSTORE opcode"},mstore8:{v:3,d:"Base fee of the MSTORE8 opcode"},sstore:{v:0,d:"Base fee of the SSTORE opcode"},jump:{v:8,d:"Base fee of the JUMP opcode"},jumpi:{v:10,d:"Base fee of the JUMPI opcode"},pc:{v:2,d:"Base fee of the PC opcode"},msize:{v:2,d:"Base fee of the MSIZE opcode"},gas:{v:2,d:"Base fee of the GAS opcode"},push:{v:3,d:"Base fee of the PUSH opcode"},dup:{v:3,d:"Base fee of the DUP opcode"},swap:{v:3,d:"Base fee of the SWAP opcode"},callcode:{v:40,d:"Base fee of the CALLCODE opcode"},return:{v:0,d:"Base fee of the RETURN opcode"},invalid:{v:0,d:"Base fee of the INVALID opcode"},selfdestruct:{v:0,d:"Base fee of the SELFDESTRUCT opcode"}},vm:{stackLimit:{v:1024,d:"Maximum size of VM stack allowed"},callCreateDepth:{v:1024,d:"Maximum depth of call/create stack"},maxExtraDataSize:{v:32,d:"Maximum size extra data may be after Genesis"}},pow:{minimumDifficulty:{v:131072,d:"The minimum that the difficulty may ever be"},difficultyBoundDivisor:{v:2048,d:"The bound divisor of the difficulty, used in the update calculations"},durationLimit:{v:13,d:"The decision boundary on the blocktime duration used to determine whether difficulty should go up or not"},epochDuration:{v:3e4,d:"Duration between proof-of-work epochs"},timebombPeriod:{v:1e5,d:"Exponential difficulty timebomb period"},minerReward:{v:"5000000000000000000",d:"the amount a miner get rewarded for mining a block"},difficultyBombDelay:{v:0,d:"the amount of blocks to delay the difficulty bomb with"}}},homestead:{name:"homestead",comment:"Homestead hardfork with protocol and network changes",url:"https://eips.ethereum.org/EIPS/eip-606",status:"Final",gasConfig:{},gasPrices:{delegatecall:{v:40,d:"Base fee of the DELEGATECALL opcode"}},vm:{},pow:{}},dao:{name:"dao",comment:"DAO rescue hardfork",url:"https://eips.ethereum.org/EIPS/eip-779",status:"Final",gasConfig:{},gasPrices:{},vm:{},pow:{}},tangerineWhistle:{name:"tangerineWhistle",comment:"Hardfork with gas cost changes for IO-heavy operations",url:"https://eips.ethereum.org/EIPS/eip-608",status:"Final",gasConfig:{},gasPrices:{sload:{v:200,d:"Once per SLOAD operation"},call:{v:700,d:"Once per CALL operation & message call transaction"},extcodesize:{v:700,d:"Base fee of the EXTCODESIZE opcode"},extcodecopy:{v:700,d:"Base fee of the EXTCODECOPY opcode"},balance:{v:400,d:"Base fee of the BALANCE opcode"},delegatecall:{v:700,d:"Base fee of the DELEGATECALL opcode"},callcode:{v:700,d:"Base fee of the CALLCODE opcode"},selfdestruct:{v:5e3,d:"Base fee of the SELFDESTRUCT opcode"}},vm:{},pow:{}},spuriousDragon:{name:"spuriousDragon",comment:"HF with EIPs for simple replay attack protection, EXP cost increase, state trie clearing, contract code size limit",url:"https://eips.ethereum.org/EIPS/eip-607",status:"Final",gasConfig:{},gasPrices:{expByte:{v:50,d:"Times ceil(log256(exponent)) for the EXP instruction"}},vm:{maxCodeSize:{v:24576,d:"Maximum length of contract code"}},pow:{}},byzantium:{name:"byzantium",comment:"Hardfork with new precompiles, instructions and other protocol changes",url:"https://eips.ethereum.org/EIPS/eip-609",status:"Final",gasConfig:{},gasPrices:{modexpGquaddivisor:{v:20,d:"Gquaddivisor from modexp precompile for gas calculation"},ecAdd:{v:500,d:"Gas costs for curve addition precompile"},ecMul:{v:4e4,d:"Gas costs for curve multiplication precompile"},ecPairing:{v:1e5,d:"Base gas costs for curve pairing precompile"},ecPairingWord:{v:8e4,d:"Gas costs regarding curve pairing precompile input length"},revert:{v:0,d:"Base fee of the REVERT opcode"},staticcall:{v:700,d:"Base fee of the STATICCALL opcode"},returndatasize:{v:2,d:"Base fee of the RETURNDATASIZE opcode"},returndatacopy:{v:3,d:"Base fee of the RETURNDATACOPY opcode"}},vm:{},pow:{minerReward:{v:"3000000000000000000",d:"the amount a miner get rewarded for mining a block"},difficultyBombDelay:{v:3e6,d:"the amount of blocks to delay the difficulty bomb with"}}},constantinople:{name:"constantinople",comment:"Postponed hardfork including EIP-1283 (SSTORE gas metering changes)",url:"https://eips.ethereum.org/EIPS/eip-1013",status:"Final",gasConfig:{},gasPrices:{netSstoreNoopGas:{v:200,d:"Once per SSTORE operation if the value doesn't change"},netSstoreInitGas:{v:2e4,d:"Once per SSTORE operation from clean zero"},netSstoreCleanGas:{v:5e3,d:"Once per SSTORE operation from clean non-zero"},netSstoreDirtyGas:{v:200,d:"Once per SSTORE operation from dirty"},netSstoreClearRefund:{v:15e3,d:"Once per SSTORE operation for clearing an originally existing storage slot"},netSstoreResetRefund:{v:4800,d:"Once per SSTORE operation for resetting to the original non-zero value"},netSstoreResetClearRefund:{v:19800,d:"Once per SSTORE operation for resetting to the original zero value"},shl:{v:3,d:"Base fee of the SHL opcode"},shr:{v:3,d:"Base fee of the SHR opcode"},sar:{v:3,d:"Base fee of the SAR opcode"},extcodehash:{v:400,d:"Base fee of the EXTCODEHASH opcode"},create2:{v:32e3,d:"Base fee of the CREATE2 opcode"}},vm:{},pow:{minerReward:{v:"2000000000000000000",d:"The amount a miner gets rewarded for mining a block"},difficultyBombDelay:{v:5e6,d:"the amount of blocks to delay the difficulty bomb with"}}},petersburg:{name:"petersburg",comment:"Aka constantinopleFix, removes EIP-1283, activate together with or after constantinople",url:"https://eips.ethereum.org/EIPS/eip-1716",status:"Final",gasConfig:{},gasPrices:{netSstoreNoopGas:{v:null,d:"Removed along EIP-1283"},netSstoreInitGas:{v:null,d:"Removed along EIP-1283"},netSstoreCleanGas:{v:null,d:"Removed along EIP-1283"},netSstoreDirtyGas:{v:null,d:"Removed along EIP-1283"},netSstoreClearRefund:{v:null,d:"Removed along EIP-1283"},netSstoreResetRefund:{v:null,d:"Removed along EIP-1283"},netSstoreResetClearRefund:{v:null,d:"Removed along EIP-1283"}},vm:{},pow:{}},istanbul:{name:"istanbul",comment:"HF targeted for December 2019 following the Constantinople/Petersburg HF",url:"https://eips.ethereum.org/EIPS/eip-1679",status:"Final",gasConfig:{},gasPrices:{blake2Round:{v:1,d:"Gas cost per round for the Blake2 F precompile"},ecAdd:{v:150,d:"Gas costs for curve addition precompile"},ecMul:{v:6e3,d:"Gas costs for curve multiplication precompile"},ecPairing:{v:45e3,d:"Base gas costs for curve pairing precompile"},ecPairingWord:{v:34e3,d:"Gas costs regarding curve pairing precompile input length"},txDataNonZero:{v:16,d:"Per byte of data attached to a transaction that is not equal to zero. NOTE: Not payable on data of calls between transactions"},sstoreSentryGasEIP2200:{v:2300,d:"Minimum gas required to be present for an SSTORE call, not consumed"},sstoreNoopGasEIP2200:{v:800,d:"Once per SSTORE operation if the value doesn't change"},sstoreDirtyGasEIP2200:{v:800,d:"Once per SSTORE operation if a dirty value is changed"},sstoreInitGasEIP2200:{v:2e4,d:"Once per SSTORE operation from clean zero to non-zero"},sstoreInitRefundEIP2200:{v:19200,d:"Once per SSTORE operation for resetting to the original zero value"},sstoreCleanGasEIP2200:{v:5e3,d:"Once per SSTORE operation from clean non-zero to something else"},sstoreCleanRefundEIP2200:{v:4200,d:"Once per SSTORE operation for resetting to the original non-zero value"},sstoreClearRefundEIP2200:{v:15e3,d:"Once per SSTORE operation for clearing an originally existing storage slot"},balance:{v:700,d:"Base fee of the BALANCE opcode"},extcodehash:{v:700,d:"Base fee of the EXTCODEHASH opcode"},chainid:{v:2,d:"Base fee of the CHAINID opcode"},selfbalance:{v:5,d:"Base fee of the SELFBALANCE opcode"},sload:{v:800,d:"Base fee of the SLOAD opcode"}},vm:{},pow:{}},muirGlacier:{name:"muirGlacier",comment:"HF to delay the difficulty bomb",url:"https://eips.ethereum.org/EIPS/eip-2384",status:"Final",gasConfig:{},gasPrices:{},vm:{},pow:{difficultyBombDelay:{v:9e6,d:"the amount of blocks to delay the difficulty bomb with"}}},berlin:{name:"berlin",comment:"HF targeted for July 2020 following the Muir Glacier HF",url:"https://eips.ethereum.org/EIPS/eip-2070",status:"Final",eips:[2565,2929,2718,2930]},london:{name:"london",comment:"HF targeted for July 2021 following the Berlin fork",url:"https://github.com/ethereum/eth1.0-specs/blob/master/network-upgrades/mainnet-upgrades/london.md",status:"Final",eips:[1559,3198,3529,3541]},shanghai:{name:"shanghai",comment:"Next feature hardfork after the merge hardfork having withdrawals, warm coinbase, push0, limit/meter initcode",url:"https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/shanghai.md",status:"Final",eips:[3651,3855,3860,4895]},arrowGlacier:{name:"arrowGlacier",comment:"HF to delay the difficulty bomb",url:"https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/arrow-glacier.md",status:"Final",eips:[4345],gasConfig:{},gasPrices:{},vm:{},pow:{}},grayGlacier:{name:"grayGlacier",comment:"Delaying the difficulty bomb to Mid September 2022",url:"https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/gray-glacier.md",status:"Draft",eips:[5133],gasConfig:{},gasPrices:{},vm:{},pow:{}},mergeForkIdTransition:{name:"mergeForkIdTransition",comment:"Pre-merge hardfork to fork off non-upgraded clients",url:"https://eips.ethereum.org/EIPS/eip-3675",status:"Draft",eips:[]},merge:{name:"merge",comment:"Hardfork to upgrade the consensus mechanism to Proof-of-Stake",url:"https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/merge.md",status:"Final",consensus:{type:"pos",algorithm:"casper",casper:{}},eips:[3675,4399]}},{buf:hV}=hU;class hK extends aY{static custom(e,t={}){var r;let n=null!=(r=t.baseChain)?r:"mainnet",i=Object.assign({},hK._getChainParams(n));if(i.name="custom-chain","string"!=typeof e)return new hK(Object.assign({chain:Object.assign(Object.assign({},i),e)},t));if(e===U.PolygonMainnet)return hK.custom({name:U.PolygonMainnet,chainId:137,networkId:137},t);if(e===U.PolygonMumbai)return hK.custom({name:U.PolygonMumbai,chainId:80001,networkId:80001},t);if(e===U.ArbitrumRinkebyTestnet)return hK.custom({name:U.ArbitrumRinkebyTestnet,chainId:421611,networkId:421611},t);if(e===U.ArbitrumOne)return hK.custom({name:U.ArbitrumOne,chainId:42161,networkId:42161},t);if(e===U.xDaiChain)return hK.custom({name:U.xDaiChain,chainId:100,networkId:100},t);if(e===U.OptimisticKovan)return hK.custom({name:U.OptimisticKovan,chainId:69,networkId:69},Object.assign({hardfork:M.Berlin},t));if(e===U.OptimisticEthereum)return hK.custom({name:U.OptimisticEthereum,chainId:10,networkId:10},Object.assign({hardfork:M.Berlin},t));throw Error(`Custom chain ${e} not supported`)}static fromGethGenesis(e,{chain:t,eips:r,genesisHash:n,hardfork:i,mergeForkIdPostMerge:s}){var o;let a=hv(e,t,s),l=new hK({chain:null!=(o=a.name)?o:"custom",customChains:[a],eips:r,hardfork:null!=i?i:a.hardfork});return void 0!==n&&l.setForkHashes(n),l}static isSupportedChainId(e){return!!this._getInitializedChains().names[e.toString()]}static _getChainParams(e,t){let r=e,n=this._getInitializedChains(t);if("number"==typeof r||"bigint"==typeof r){if(r=r.toString(),n.names[r]){let e=n.names[r];return n[e]}throw Error(`Chain with ID ${r} not supported`)}if(void 0!==n[r])return n[r];throw Error(`Chain with name ${r} not supported`)}constructor(e){var t,r;super(),this._eips=[],this._customChains=null!=(t=e.customChains)?t:[],this._chainParams=this.setChain(e.chain),this.DEFAULT_HARDFORK=null!=(r=this._chainParams.defaultHardfork)?r:M.Merge,this.HARDFORK_CHANGES=this.hardforks().map(e=>[e.name,hz[e.name]]),this._hardfork=this.DEFAULT_HARDFORK,void 0!==e.hardfork&&this.setHardfork(e.hardfork),e.eips&&this.setEIPs(e.eips)}setChain(e){if("number"==typeof e||"bigint"==typeof e||"string"==typeof e)this._chainParams=hK._getChainParams(e,this._customChains);else if("object"==typeof e){if(this._customChains.length>0)throw Error("Chain must be a string, number, or bigint when initialized with customChains passed in");for(let t of["networkId","genesis","hardforks","bootstrapNodes"])if(!(t in e))throw Error(`Missing required chain parameter: ${t}`);this._chainParams=e}else throw Error("Wrong input format");for(let e of this.hardforks())if(void 0===e.block)throw Error("Hardfork cannot have undefined block number");return this._chainParams}setHardfork(e){let t=!1;for(let r of this.HARDFORK_CHANGES)r[0]===e&&(this._hardfork!==e&&(this._hardfork=e,this.emit("hardforkChanged",e)),t=!0);if(!t)throw Error(`Hardfork with name ${e} not supported`)}getHardforkByBlockNumber(e,t,r){let n=hL(e,j.BigInt),i=hL(t,j.BigInt),s=hL(r,j.Number),o=this.hardforks().filter(e=>null!==e.block||null!==e.ttd&&void 0!==e.ttd||void 0!==e.timestamp),a=o.findIndex(e=>null!==e.ttd&&void 0!==e.ttd);if(o.slice(a+1).findIndex(e=>null!==e.ttd&&void 0!==e.ttd)>=0)throw Error("More than one merge hardforks found with ttd specified");let l=o.findIndex(e=>null!==e.block&&e.block>n||void 0!==s&&Number(e.timestamp)>s);if(-1===l)l=o.length;else if(0===l)throw Error("Must have at least one hardfork at block 0");if(void 0===s){let e=o.slice(0,l).reverse().findIndex(e=>null!==e.block||void 0!==e.ttd);l-=e}if(null===o[l-=1].block&&void 0===o[l].timestamp)(null==i||BigInt(o[l].ttd)>i)&&(l-=1);else if(a>=0&&null!=i){if(l>=a&&BigInt(o[a].ttd)>i)throw Error("Maximum HF determined by total difficulty is lower than the block number HF");else if(l<a&&BigInt(o[a].ttd)<=i)throw Error("HF determined by block number is lower than the minimum total difficulty HF")}let c=l;for(;l<o.length-1&&o[l].block===o[l+1].block&&o[l].timestamp===o[l+1].timestamp;l+=1);if(s){if(o.slice(0,c).reduce((e,t)=>{var r;return Math.max(Number(null!=(r=t.timestamp)?r:"0"),e)},0)>s)throw Error("Maximum HF determined by timestamp is lower than the block number/ttd HF");if(o.slice(l+1).reduce((e,t)=>{var r;return Math.min(Number(null!=(r=t.timestamp)?r:s),e)},s)<s)throw Error("Maximum HF determined by block number/ttd is lower than timestamp HF")}return o[l].name}setHardforkByBlockNumber(e,t,r){let n=this.getHardforkByBlockNumber(e,t,r);return this.setHardfork(n),n}_getHardfork(e){for(let t of this.hardforks())if(t.name===e)return t;return null}setEIPs(e=[]){for(let t of e){if(!(t in hq))throw Error(`${t} not supported`);let r=this.gteHardfork(hq[t].minimumHardfork);if(!r)throw Error(`${t} cannot be activated on hardfork ${this.hardfork()}, minimumHardfork: ${r}`);if(void 0!==hq[t].requiredEIPs){for(let r of hq[t].requiredEIPs)if(!(e.includes(r)||this.isActivatedEIP(r)))throw Error(`${t} requires EIP ${r}, but is not included in the EIP list`)}}this._eips=e}param(e,t){let r;for(let n of this._eips)if(void 0!==(r=this.paramByEIP(e,t,n)))return r;return this.paramByHardfork(e,t,this._hardfork)}paramByHardfork(e,t,r){let n=null;for(let i of this.HARDFORK_CHANGES){if("eips"in i[1])for(let r of i[1].eips){let i=this.paramByEIP(e,t,r);n="bigint"==typeof i?i:n}else{if(void 0===i[1][e])throw Error(`Topic ${e} not defined`);void 0!==i[1][e][t]&&(n=i[1][e][t].v)}if(i[0]===r)break}return BigInt(null!=n?n:0)}paramByEIP(e,t,r){if(!(r in hq))throw Error(`${r} not supported`);let n=hq[r];if(!(e in n))throw Error(`Topic ${e} not defined`);if(void 0!==n[e][t])return BigInt(n[e][t].v)}paramByBlock(e,t,r,n,i){let s=this.getHardforkByBlockNumber(r,n,i);return this.paramByHardfork(e,t,s)}isActivatedEIP(e){if(this.eips().includes(e))return!0;for(let t of this.HARDFORK_CHANGES){let r=t[1];if(this.gteHardfork(r.name)&&"eips"in r&&r.eips.includes(e))return!0}return!1}hardforkIsActiveOnBlock(e,t){let r=hL(t,j.BigInt),n=null!=e?e:this._hardfork,i=this.hardforkBlock(n);return"bigint"==typeof i&&i!==BigInt(0)&&!!(r>=i)}activeOnBlock(e){return this.hardforkIsActiveOnBlock(null,e)}hardforkGteHardfork(e,t){let r=null!=e?e:this._hardfork,n=this.hardforks(),i=-1,s=-1,o=0;for(let e of n)e.name===r&&(i=o),e.name===t&&(s=o),o+=1;return i>=s&&-1!==s}gteHardfork(e){return this.hardforkGteHardfork(null,e)}hardforkBlock(e){var t;let r=null!=e?e:this._hardfork,n=null==(t=this._getHardfork(r))?void 0:t.block;return null==n?null:BigInt(n)}hardforkTimestamp(e){var t;let r=null!=e?e:this._hardfork,n=null==(t=this._getHardfork(r))?void 0:t.timestamp;return null==n?null:BigInt(n)}eipBlock(e){for(let t of this.HARDFORK_CHANGES){let r=t[1];if("eips"in r&&r.eips.includes(e))return this.hardforkBlock("number"==typeof t[0]?String(t[0]):t[0])}return null}hardforkTTD(e){var t;let r=null!=e?e:this._hardfork,n=null==(t=this._getHardfork(r))?void 0:t.ttd;return null==n?null:BigInt(n)}isHardforkBlock(e,t){let r=hL(e,j.BigInt),n=null!=t?t:this._hardfork,i=this.hardforkBlock(n);return"bigint"==typeof i&&i!==BigInt(0)&&i===r}nextHardforkBlockOrTimestamp(e){var t,r,n;let i=null!=(t=e)?t:this._hardfork,s=this.hardforks(),o=s.findIndex(e=>e.name===i);if(i===M.Merge&&(o-=1),o<0)return null;let a=null!=(r=s[o].timestamp)?r:s[o].block;a=null!=a?Number(a):null;let l=s.slice(o+1).find(e=>{var t;let r=null!=(t=e.timestamp)?t:e.block;return r=null!=r?Number(r):null,e.name!==M.Merge&&null!=r&&r!==a});if(void 0===l)return null;let c=null!=(n=l.timestamp)?n:l.block;return null==c?null:BigInt(c)}nextHardforkBlock(e){var t;let r=null!=(t=e)?t:this._hardfork,n=this.hardforkBlock(r);if(null===n&&r===M.Merge){let e=this.hardforks(),t=e.findIndex(e=>null!==e.ttd&&void 0!==e.ttd);if(t<0)throw Error("Merge hardfork should have been found");n=this.hardforkBlock(e[t-1].name)}return null===n?null:this.hardforks().reduce((e,t)=>{let r=BigInt(null===t.block||void 0!==t.ttd&&null!==t.ttd?0:t.block);return r>n&&null===e?r:e},null)}isNextHardforkBlock(e,t){let r=hL(e,j.BigInt),n=null!=t?t:this._hardfork,i=this.nextHardforkBlock(n);return null!==i&&i===r}_calcForkHash(e,t){let r=new Uint8Array,n=0;for(let t of this.hardforks()){let{block:i,timestamp:s,name:o}=t,a=null!=s?s:i;if("number"==typeof(a=null!==a?Number(a):null)&&0!==a&&a!==n&&o!==M.Merge&&(r=av(r,aI(a.toString(16).padStart(16,"0"))),n=a),t.name===e)break}return a_(hA(hV(av(t,r))>>>0))}forkHash(e,t){let r=null!=e?e:this._hardfork,n=this._getHardfork(r);if(null===n||(null==n?void 0:n.block)===null&&(null==n?void 0:n.timestamp)===void 0&&(null==n?void 0:n.ttd)===void 0)throw Error("No fork hash calculation possible for future hardfork");if((null==n?void 0:n.forkHash)!==null&&(null==n?void 0:n.forkHash)!==void 0)return n.forkHash;if(!t)throw Error("genesisHash required for forkHash calculation");return this._calcForkHash(r,t)}hardforkForForkHash(e){let t=this.hardforks().filter(t=>t.forkHash===e);return t.length>=1?t[t.length-1]:null}setForkHashes(e){var t;for(let r of this.hardforks()){let n=null!=(t=r.timestamp)?t:r.block;(null===r.forkHash||void 0===r.forkHash)&&(null!=n||void 0!==r.ttd)&&(r.forkHash=this.forkHash(r.name,e))}}genesis(){return this._chainParams.genesis}hardforks(){return this._chainParams.hardforks}bootstrapNodes(){return this._chainParams.bootstrapNodes}dnsNetworks(){return this._chainParams.dnsNetworks}hardfork(){return this._hardfork}chainId(){return BigInt(this._chainParams.chainId)}chainName(){return this._chainParams.name}networkId(){return BigInt(this._chainParams.networkId)}eips(){return this._eips}consensusType(){let e,t=this.hardfork();for(let r of this.HARDFORK_CHANGES)if("consensus"in r[1]&&(e=r[1].consensus.type),r[0]===t)break;return null!=e?e:this._chainParams.consensus.type}consensusAlgorithm(){let e,t=this.hardfork();for(let r of this.HARDFORK_CHANGES)if("consensus"in r[1]&&(e=r[1].consensus.algorithm),r[0]===t)break;return null!=e?e:this._chainParams.consensus.algorithm}consensusConfig(){var e;let t,r=this.hardfork();for(let e of this.HARDFORK_CHANGES)if("consensus"in e[1]&&(t=e[1].consensus[e[1].consensus.algorithm]),e[0]===r)break;return null!=(e=null!=t?t:this._chainParams.consensus[this.consensusAlgorithm()])?e:{}}copy(){let e=Object.assign(Object.create(Object.getPrototypeOf(this)),this);return e.removeAllListeners(),e}static _getInitializedChains(e){let t={};for(let[e,r]of Object.entries(B))t[r]=e.toLowerCase();let r={mainnet:h$,goerli:hj,sepolia:hH};if(e)for(let n of e){let{name:e}=n;t[n.chainId.toString()]=e,r[e]=n}return r.names=t,r}}function hG(e){return!!(0===e.length||Array.isArray(e[0]))}function hW(e){return!hG(e)}!function(e){e[e.EIP155ReplayProtection=155]="EIP155ReplayProtection",e[e.EIP1559FeeMarket=1559]="EIP1559FeeMarket",e[e.EIP2718TypedTransaction=2718]="EIP2718TypedTransaction",e[e.EIP2930AccessLists=2930]="EIP2930AccessLists"}($||($={}));class hQ{constructor(e){if(20!==e.length)throw Error("Invalid address length");this.buf=e}static zero(){return new hQ(h_(20))}equals(e){return aE(this.buf,e.buf)}isZero(){return this.equals(hQ.zero())}toString(){return a_(this.buf)}toArray(){return this.buf}static publicToAddress(e,t=!1){let r=e;if(hC(r),t&&64!==r.length&&(r=hh.ProjectivePoint.fromHex(r).toRawBytes(!1).slice(1)),64!==r.length)throw Error("Expected pubKey to be of length 64");return ix(r).slice(-20)}}let hJ=(e,t)=>{let r=e.param("vm","maxInitCodeSize");if(r&&BigInt(t)>r)throw Error(`the initcode size of this transaction is too large: it is ${t} while the max is ${e.param("vm","maxInitCodeSize")}`)},hZ=e=>{let t,r;if(hW(e)){t=e;let n=[];for(let t=0;t<e.length;t+=1){let r=e[t],i=hx(r.address),s=[];for(let e=0;e<r.storageKeys.length;e+=1)s.push(hx(r.storageKeys[e]));n.push([i,s])}r=n}else{r=null!=e?e:[];let n=[];for(let e=0;e<r.length;e+=1){let t=r[e],i=a_(t[0]),s=[];for(let e=0;e<t[1].length;e+=1)s.push(a_(t[1][e]));let o={address:i,storageKeys:s};n.push(o)}t=n}return{AccessListJSON:t,accessList:r}},hY=e=>{for(let t=0;t<e.length;t+=1){let r=e[t],n=r[0],i=r[1];if(void 0!==r[2])throw Error("Access list item cannot have 3 elements. It can only have an address, and an array of storage slots.");if(20!==n.length)throw Error("Invalid EIP-2930 transaction: address length should be 20 bytes");for(let e=0;e<i.length;e+=1)if(32!==i[e].length)throw Error("Invalid EIP-2930 transaction: storage slot length should be 32 bytes")}},hX=e=>{let t=[];for(let r=0;r<e.length;r+=1){let n=e[r],i={address:a_(hT(n[0],20)),storageKeys:[]},s=n&&n[1];for(let e=0;e<s.length;e+=1){let t=s[e];i.storageKeys.push(a_(hT(t,32)))}t.push(i)}return t},h0=(e,t)=>{let r=t.param("gasPrices","accessListStorageKeyCost"),n=t.param("gasPrices","accessListAddressCost"),i=0;for(let t=0;t<e.length;t+=1)i+=e[t][1].length;return e.length*Number(n)+i*Number(r)};class h1{constructor(e,t){var r,n;this.cache={hash:void 0,dataFee:void 0},this.activeCapabilities=[],this.DEFAULT_CHAIN=B.Mainnet,this.DEFAULT_HARDFORK=M.Merge;let{nonce:i,gasLimit:s,to:o,value:a,data:l,v:c,r:u,s:h,type:d}=e;this._type=Number(hS(hx(d))),this.txOptions=t;let f=hx(""===o?"0x":o),p=hx(""===c?"0x":c),g=hx(""===u?"0x":u),m=hx(""===h?"0x":h);this.nonce=hS(hx(""===i?"0x":i)),this.gasLimit=hS(hx(""===s?"0x":s)),this.to=f.length>0?new hQ(f):void 0,this.value=hS(hx(""===a?"0x":a)),this.data=hx(""===l?"0x":l),this.v=p.length>0?hS(p):void 0,this.r=g.length>0?hS(g):void 0,this.s=m.length>0?hS(m):void 0,this._validateCannotExceedMaxInteger({value:this.value,r:this.r,s:this.s}),this._validateCannotExceedMaxInteger({gasLimit:this.gasLimit},64),this._validateCannotExceedMaxInteger({nonce:this.nonce},64,!0);let y=void 0===this.to||null===this.to,b=null!=(r=t.allowUnlimitedInitCodeSize)&&r,w=null!=(n=t.common)?n:this._getCommon();y&&w.isActivatedEIP(3860)&&!b&&hJ(w,this.data.length)}get type(){return this._type}supports(e){return this.activeCapabilities.includes(e)}validate(e=!1){let t=[];return this.getBaseFee()>this.gasLimit&&t.push(`gasLimit is too low. given ${this.gasLimit}, need at least ${this.getBaseFee()}`),this.isSigned()&&!this.verifySignature()&&t.push("Invalid Signature"),e?t:0===t.length}_validateYParity(){let{v:e}=this;if(void 0!==e&&e!==BigInt(0)&&e!==BigInt(1))throw Error(this._errorMsg("The y-parity of the transaction should either be 0 or 1"))}_validateHighS(){let{s:e}=this;if(this.common.gteHardfork("homestead")&&void 0!==e&&e>hp)throw Error(this._errorMsg("Invalid Signature: s-values greater than secp256k1n/2 are considered invalid"))}getBaseFee(){let e=this.common.param("gasPrices","tx"),t=this.getDataFee();if(e&&(t+=e),this.common.gteHardfork("homestead")&&this.toCreationAddress()){let e=this.common.param("gasPrices","txCreation");e&&(t+=e)}return t}getDataFee(){let e=this.common.param("gasPrices","txDataZero"),t=this.common.param("gasPrices","txDataNonZero"),r=BigInt(0);for(let n=0;n<this.data.length;n+=1)0===this.data[n]?r+=e:r+=t;if((void 0===this.to||null===this.to)&&this.common.isActivatedEIP(3860)){let e=BigInt(Math.ceil(this.data.length/32));r+=this.common.param("gasPrices","initCodeWordCost")*e}return r}toCreationAddress(){return void 0===this.to||0===this.to.buf.length}isSigned(){let{v:e,r:t,s:r}=this;return void 0!==e&&void 0!==t&&void 0!==r}verifySignature(){try{let e=this.getSenderPublicKey();return 0!==hR(e).length}catch(e){return!1}}getSenderAddress(){return new hQ(hQ.publicToAddress(this.getSenderPublicKey()))}sign(e){if(32!==e.length)throw Error(this._errorMsg("Private key must be 32 bytes in length."));let t=!1;0===this.type&&this.common.gteHardfork("spuriousDragon")&&!this.supports($.EIP155ReplayProtection)&&(this.activeCapabilities.push($.EIP155ReplayProtection),t=!0);let r=this.getMessageToSign(!0),{v:n,r:i,s}=this._ecsign(r,e),o=this._processSignature(n,i,s);if(t){let e=this.activeCapabilities.indexOf($.EIP155ReplayProtection);e>-1&&this.activeCapabilities.splice(e,1)}return o}_getCommon(e,t){var r,n,i,s;if(void 0!==t){let r=hS(hx(t));if(e){if(e.chainId()!==r)throw Error(this._errorMsg("The chain ID does not match the chain ID of Common"));return e.copy()}return hK.isSupportedChainId(r)?new hK({chain:r,hardfork:this.DEFAULT_HARDFORK}):hK.custom({name:"custom-chain",networkId:r,chainId:r},{baseChain:this.DEFAULT_CHAIN,hardfork:this.DEFAULT_HARDFORK})}if((null==e?void 0:e.copy)&&"function"==typeof(null==e?void 0:e.copy))return e.copy();if(e){let t="function"==typeof e.hardfork?e.hardfork():e.hardfork;return hK.custom({name:"custom-chain",networkId:e.networkId?e.networkId():null!=(n=BigInt(null==(r=e.customChain)?void 0:r.networkId))?n:void 0,chainId:e.chainId?e.chainId():null!=(s=BigInt(null==(i=e.customChain)?void 0:i.chainId))?s:void 0},{baseChain:this.DEFAULT_CHAIN,hardfork:t||this.DEFAULT_HARDFORK})}return new hK({chain:this.DEFAULT_CHAIN,hardfork:this.DEFAULT_HARDFORK})}_validateCannotExceedMaxInteger(e,t=256,r=!1){for(let[n,i]of Object.entries(e))switch(t){case 64:if(r){if(void 0!==i&&i>=hd)throw Error(this._errorMsg(`${n} cannot equal or exceed MAX_UINT64 (2^64-1), given ${i}`))}else if(void 0!==i&&i>hd)throw Error(this._errorMsg(`${n} cannot exceed MAX_UINT64 (2^64-1), given ${i}`));break;case 256:if(r){if(void 0!==i&&i>=hf)throw Error(this._errorMsg(`${n} cannot equal or exceed MAX_INTEGER (2^256-1), given ${i}`))}else if(void 0!==i&&i>hf)throw Error(this._errorMsg(`${n} cannot exceed MAX_INTEGER (2^256-1), given ${i}`));break;default:throw Error(this._errorMsg("unimplemented bits value"))}}static _validateNotArray(e){let t=["nonce","gasPrice","gasLimit","to","value","data","v","r","s","type","baseFee","maxFeePerGas","chainId"];for(let[r,n]of Object.entries(e))if(t.includes(r)&&Array.isArray(n))throw Error(`${r} cannot be an array`)}_getSharedErrorPostfix(){let e="";try{e=this.isSigned()?a_(this.hash()):"not available (unsigned)"}catch(t){e="error"}let t="";try{t=this.isSigned().toString()}catch(t){e="error"}let r="";try{r=this.common.hardfork()}catch(e){r="error"}let n=`tx type=${this.type} hash=${e} nonce=${this.nonce} value=${this.value} `;return n+`signed=${t} hf=${r}`}_ecsign(e,t,r){let n=hh.sign(e,t),i=n.toCompactRawBytes(),s=i.subarray(0,32);return{r:s,s:i.subarray(32,64),v:void 0===r?BigInt(n.recovery+27):BigInt(n.recovery+35)+BigInt(r)*BigInt(2)}}static fromSerializedTx(e,t={}){}static fromTxData(e,t={}){}}let h2=2,h3=aI("2".padStart(2,"0"));class h4 extends h1{static fromTxData(e,t={}){return new h4(e,t)}static fromSerializedTx(e,t={}){if(!aE(e.subarray(0,1),h3))throw Error(`Invalid serialized tx input: not an EIP-1559 transaction (wrong tx type, expected: ${h2}, received: ${a_(e.subarray(0,1))}`);let r=hF.Tj.decode(e.subarray(1));if(!Array.isArray(r))throw Error("Invalid serialized tx input: must be array");return h4.fromValuesArray(r,t)}static fromValuesArray(e,t={}){if(9!==e.length&&12!==e.length)throw Error("Invalid EIP-1559 transaction. Only expecting 9 values (for unsigned tx) or 12 values (for signed tx).");let[r,n,i,s,o,a,l,c,u,h,d,f]=e;return this._validateNotArray({chainId:r,v:h}),oU({nonce:n,maxPriorityFeePerGas:i,maxFeePerGas:s,gasLimit:o,value:l,v:h,r:d,s:f}),new h4({chainId:hS(r),nonce:n,maxPriorityFeePerGas:i,maxFeePerGas:s,gasLimit:o,to:a,value:l,data:c,accessList:null!=u?u:[],v:void 0!==h?hS(h):void 0,r:d,s:f},t)}constructor(e,t={}){var r;super(Object.assign(Object.assign({},e),{type:h2}),t),this.DEFAULT_HARDFORK="london";let{chainId:n,accessList:i,maxFeePerGas:s,maxPriorityFeePerGas:o}=e;if(this.common=this._getCommon(t.common,n),this.chainId=this.common.chainId(),!this.common.isActivatedEIP(1559))throw Error("EIP-1559 not enabled on Common");this.activeCapabilities=this.activeCapabilities.concat([1559,2718,2930]);let a=hZ(null!=i?i:[]);if(this.accessList=a.accessList,this.AccessListJSON=a.AccessListJSON,hY(this.accessList),this.maxFeePerGas=hS(hx(""===s?"0x":s)),this.maxPriorityFeePerGas=hS(hx(""===o?"0x":o)),this._validateCannotExceedMaxInteger({maxFeePerGas:this.maxFeePerGas,maxPriorityFeePerGas:this.maxPriorityFeePerGas}),h1._validateNotArray(e),this.gasLimit*this.maxFeePerGas>hf)throw Error(this._errorMsg("gasLimit * maxFeePerGas cannot exceed MAX_INTEGER (2^256-1)"));if(this.maxFeePerGas<this.maxPriorityFeePerGas)throw Error(this._errorMsg("maxFeePerGas cannot be less than maxPriorityFeePerGas (The total must be the larger of the two)"));this._validateYParity(),this._validateHighS(),(null==(r=null==t?void 0:t.freeze)||r)&&Object.freeze(this)}getDataFee(){if(this.cache.dataFee&&this.cache.dataFee.hardfork===this.common.hardfork())return this.cache.dataFee.value;let e=super.getDataFee();return e+=BigInt(h0(this.accessList,this.common)),Object.isFrozen(this)&&(this.cache.dataFee={value:e,hardfork:this.common.hardfork()}),e}getUpfrontCost(e=BigInt(0)){let t=this.maxPriorityFeePerGas,r=this.maxFeePerGas-e,n=(t<r?t:r)+e;return this.gasLimit*n+this.value}raw(){return[hN(this.chainId),hN(this.nonce),hN(this.maxPriorityFeePerGas),hN(this.maxFeePerGas),hN(this.gasLimit),void 0!==this.to?this.to.buf:Uint8Array.from([]),hN(this.value),this.data,this.accessList,void 0!==this.v?hN(this.v):Uint8Array.from([]),void 0!==this.r?hN(this.r):Uint8Array.from([]),void 0!==this.s?hN(this.s):Uint8Array.from([])]}serialize(){let e=this.raw();return av(h3,hF.Tj.encode(e))}getMessageToSign(e=!0){let t=this.raw().slice(0,9),r=av(h3,hF.Tj.encode(t));return e?ix(r):r}hash(){if(!this.isSigned())throw Error(this._errorMsg("Cannot call hash method if transaction is not signed"));return Object.isFrozen(this)?(this.cache.hash||(this.cache.hash=ix(this.serialize())),this.cache.hash):ix(this.serialize())}getMessageToVerifySignature(){return this.getMessageToSign()}getSenderPublicKey(){if(!this.isSigned())throw Error(this._errorMsg("Cannot call this method if transaction is not signed"));let e=this.getMessageToVerifySignature(),{v:t,r,s:n}=this;this._validateHighS();try{return hM(e,t+BigInt(27),hN(r),hN(n))}catch(e){throw Error(this._errorMsg("Invalid Signature"))}}_processSignature(e,t,r){let n=Object.assign(Object.assign({},this.txOptions),{common:this.common});return h4.fromTxData({chainId:this.chainId,nonce:this.nonce,maxPriorityFeePerGas:this.maxPriorityFeePerGas,maxFeePerGas:this.maxFeePerGas,gasLimit:this.gasLimit,to:this.to,value:this.value,data:this.data,accessList:this.accessList,v:e-BigInt(27),r:hS(t),s:hS(r)},n)}toJSON(){let e=hX(this.accessList);return{chainId:hO(this.chainId),nonce:hO(this.nonce),maxPriorityFeePerGas:hO(this.maxPriorityFeePerGas),maxFeePerGas:hO(this.maxFeePerGas),gasLimit:hO(this.gasLimit),to:void 0!==this.to?this.to.toString():void 0,value:hO(this.value),data:a_(this.data),accessList:e,v:void 0!==this.v?hO(this.v):void 0,r:void 0!==this.r?hO(this.r):void 0,s:void 0!==this.s?hO(this.s):void 0}}errorStr(){let e=this._getSharedErrorPostfix();return e+` maxFeePerGas=${this.maxFeePerGas} maxPriorityFeePerGas=${this.maxPriorityFeePerGas}`}_errorMsg(e){return`${e} (${this.errorStr()})`}}let h5=1,h6=aI("1".padStart(2,"0"));class h8 extends h1{static fromTxData(e,t={}){return new h8(e,t)}static fromSerializedTx(e,t={}){if(!aE(e.subarray(0,1),h6))throw Error(`Invalid serialized tx input: not an EIP-2930 transaction (wrong tx type, expected: ${h5}, received: ${a_(e.subarray(0,1))}`);let r=hF.Tj.decode(Uint8Array.from(e.subarray(1)));if(!Array.isArray(r))throw Error("Invalid serialized tx input: must be array");return h8.fromValuesArray(r,t)}static fromValuesArray(e,t={}){if(8!==e.length&&11!==e.length)throw Error("Invalid EIP-2930 transaction. Only expecting 8 values (for unsigned tx) or 11 values (for signed tx).");let[r,n,i,s,o,a,l,c,u,h,d]=e;this._validateNotArray({chainId:r,v:u}),oU({nonce:n,gasPrice:i,gasLimit:s,value:a,v:u,r:h,s:d});let f=[];return new h8({chainId:hS(r),nonce:n,gasPrice:i,gasLimit:s,to:o,value:a,data:l,accessList:null!=c?c:f,v:void 0!==u?hS(u):void 0,r:h,s:d},t)}constructor(e,t={}){var r;super(Object.assign(Object.assign({},e),{type:h5}),t),this.DEFAULT_HARDFORK="berlin";let{chainId:n,accessList:i,gasPrice:s}=e;if(this.common=this._getCommon(t.common,n),this.chainId=this.common.chainId(),!this.common.isActivatedEIP(2930))throw Error("EIP-2930 not enabled on Common");this.activeCapabilities=this.activeCapabilities.concat([2718,2930]);let o=hZ(null!=i?i:[]);if(this.accessList=o.accessList,this.AccessListJSON=o.AccessListJSON,hY(this.accessList),this.gasPrice=hS(hx(""===s?"0x":s)),this._validateCannotExceedMaxInteger({gasPrice:this.gasPrice}),h1._validateNotArray(e),this.gasPrice*this.gasLimit>hf)throw Error(this._errorMsg("gasLimit * gasPrice cannot exceed MAX_INTEGER"));this._validateYParity(),this._validateHighS(),(null==(r=null==t?void 0:t.freeze)||r)&&Object.freeze(this)}getDataFee(){if(this.cache.dataFee&&this.cache.dataFee.hardfork===this.common.hardfork())return this.cache.dataFee.value;let e=super.getDataFee();return e+=BigInt(h0(this.accessList,this.common)),Object.isFrozen(this)&&(this.cache.dataFee={value:e,hardfork:this.common.hardfork()}),e}getUpfrontCost(){return this.gasLimit*this.gasPrice+this.value}raw(){return[hN(this.chainId),hN(this.nonce),hN(this.gasPrice),hN(this.gasLimit),void 0!==this.to?this.to.buf:Uint8Array.from([]),hN(this.value),this.data,this.accessList,void 0!==this.v?hN(this.v):Uint8Array.from([]),void 0!==this.r?hN(this.r):Uint8Array.from([]),void 0!==this.s?hN(this.s):Uint8Array.from([])]}serialize(){let e=this.raw();return av(h6,hF.Tj.encode(e))}getMessageToSign(e=!0){let t=this.raw().slice(0,8),r=av(h6,hF.Tj.encode(t));return e?ix(r):r}hash(){if(!this.isSigned())throw Error(this._errorMsg("Cannot call hash method if transaction is not signed"));return Object.isFrozen(this)?(this.cache.hash||(this.cache.hash=ix(this.serialize())),this.cache.hash):ix(this.serialize())}getMessageToVerifySignature(){return this.getMessageToSign()}getSenderPublicKey(){if(!this.isSigned())throw Error(this._errorMsg("Cannot call this method if transaction is not signed"));let e=this.getMessageToVerifySignature(),{v:t,r,s:n}=this;this._validateHighS();try{return hM(e,t+BigInt(27),hN(r),hN(n))}catch(e){throw Error(this._errorMsg("Invalid Signature"))}}_processSignature(e,t,r){let n=Object.assign(Object.assign({},this.txOptions),{common:this.common});return h8.fromTxData({chainId:this.chainId,nonce:this.nonce,gasPrice:this.gasPrice,gasLimit:this.gasLimit,to:this.to,value:this.value,data:this.data,accessList:this.accessList,v:e-BigInt(27),r:hS(t),s:hS(r)},n)}toJSON(){let e=hX(this.accessList);return{chainId:hO(this.chainId),nonce:hO(this.nonce),gasPrice:hO(this.gasPrice),gasLimit:hO(this.gasLimit),to:void 0!==this.to?this.to.toString():void 0,value:hO(this.value),data:a_(this.data),accessList:e,v:void 0!==this.v?hO(this.v):void 0,r:void 0!==this.r?hO(this.r):void 0,s:void 0!==this.s?hO(this.s):void 0}}errorStr(){var e,t;let r=this._getSharedErrorPostfix();return r+` gasPrice=${this.gasPrice} accessListCount=${null!=(t=null==(e=this.accessList)?void 0:e.length)?t:0}`}_errorMsg(e){return`${e} (${this.errorStr()})`}}let h7=0;function h9(e,t){let r=Number(e),n=2*Number(t);return r===n+35||r===n+36}class de extends h1{static fromTxData(e,t={}){return new de(e,t)}static fromSerializedTx(e,t={}){let r=hF.Tj.decode(e);if(!Array.isArray(r))throw Error("Invalid serialized tx input. Must be array");return this.fromValuesArray(r,t)}static fromValuesArray(e,t={}){if(6!==e.length&&9!==e.length)throw Error("Invalid transaction. Only expecting 6 values (for unsigned tx) or 9 values (for signed tx).");let[r,n,i,s,o,a,l,c,u]=e;return oU({nonce:r,gasPrice:n,gasLimit:i,value:o,v:l,r:c,s:u}),new de({nonce:r,gasPrice:n,gasLimit:i,to:s,value:o,data:a,v:l,r:c,s:u},t)}constructor(e,t={}){var r;if(super(Object.assign(Object.assign({},e),{type:h7}),t),this.common=this._validateTxV(this.v,t.common),this.gasPrice=hS(hx(""===e.gasPrice?"0x":e.gasPrice)),this.gasPrice*this.gasLimit>hf)throw Error(this._errorMsg("gas limit * gasPrice cannot exceed MAX_INTEGER (2^256-1)"));this._validateCannotExceedMaxInteger({gasPrice:this.gasPrice}),h1._validateNotArray(e),this.common.gteHardfork("spuriousDragon")&&(this.isSigned()?h9(this.v,this.common.chainId())&&this.activeCapabilities.push($.EIP155ReplayProtection):this.activeCapabilities.push($.EIP155ReplayProtection)),(null==(r=null==t?void 0:t.freeze)||r)&&Object.freeze(this)}raw(){return[hN(this.nonce),hN(this.gasPrice),hN(this.gasLimit),void 0!==this.to?this.to.buf:Uint8Array.from([]),hN(this.value),this.data,void 0!==this.v?hN(this.v):Uint8Array.from([]),void 0!==this.r?hN(this.r):Uint8Array.from([]),void 0!==this.s?hN(this.s):Uint8Array.from([])]}serialize(){return hF.Tj.encode(this.raw())}_getMessageToSign(){let e=[hN(this.nonce),hN(this.gasPrice),hN(this.gasLimit),void 0!==this.to?this.to.buf:Uint8Array.from([]),hN(this.value),this.data];return this.supports($.EIP155ReplayProtection)&&(e.push(hx(this.common.chainId())),e.push(hR(hx(0))),e.push(hR(hx(0)))),e}getMessageToSign(e=!0){let t=this._getMessageToSign();return e?ix(hF.Tj.encode(t)):t}getDataFee(){return this.cache.dataFee&&this.cache.dataFee.hardfork===this.common.hardfork()?this.cache.dataFee.value:(Object.isFrozen(this)&&(this.cache.dataFee={value:super.getDataFee(),hardfork:this.common.hardfork()}),super.getDataFee())}getUpfrontCost(){return this.gasLimit*this.gasPrice+this.value}hash(){if(!this.isSigned())throw Error(this._errorMsg("Cannot call hash method if transaction is not signed"));return Object.isFrozen(this)?(this.cache.hash||(this.cache.hash=ix(hF.Tj.encode(this.raw()))),this.cache.hash):ix(hF.Tj.encode(this.raw()))}getMessageToVerifySignature(){if(!this.isSigned())throw Error(this._errorMsg("This transaction is not signed"));let e=this._getMessageToSign();return ix(hF.Tj.encode(e))}getSenderPublicKey(){let e=this.getMessageToVerifySignature(),{v:t,r,s:n}=this;this._validateHighS();try{return hM(e,t,hN(r),hN(n),this.supports($.EIP155ReplayProtection)?this.common.chainId():void 0)}catch(e){throw Error(this._errorMsg("Invalid Signature"))}}_processSignature(e,t,r){let n=e;this.supports($.EIP155ReplayProtection)&&(n+=this.common.chainId()*BigInt(2)+BigInt(8));let i=Object.assign(Object.assign({},this.txOptions),{common:this.common});return de.fromTxData({nonce:this.nonce,gasPrice:this.gasPrice,gasLimit:this.gasLimit,to:this.to,value:this.value,data:this.data,v:n,r:hS(t),s:hS(r)},i)}toJSON(){return{nonce:hO(this.nonce),gasPrice:hO(this.gasPrice),gasLimit:hO(this.gasLimit),to:void 0!==this.to?this.to.toString():void 0,value:hO(this.value),data:a_(this.data),v:void 0!==this.v?hO(this.v):void 0,r:void 0!==this.r?hO(this.r):void 0,s:void 0!==this.s?hO(this.s):void 0}}_validateTxV(e,t){let r,n=void 0!==e?Number(e):void 0;if(void 0!==n&&n<37&&27!==n&&28!==n)throw Error(`Legacy txs need either v = 27/28 or v >= 37 (EIP-155 replay protection), got v = ${n}`);if(void 0!==n&&0!==n&&(!t||t.gteHardfork("spuriousDragon"))&&27!==n&&28!==n)if(t){if(!h9(BigInt(n),t.chainId()))throw Error(`Incompatible EIP155-based V ${n} and chain id ${t.chainId()}. See the Common parameter of the Transaction constructor to set the chain id.`)}else{let e;e=(n-35)%2==0?35:36,r=BigInt(n-e)/BigInt(2)}return this._getCommon(t,r)}errorStr(){let e=this._getSharedErrorPostfix();return e+` gasPrice=${this.gasPrice}`}_errorMsg(e){return`${e} (${this.errorStr()})`}}let dt=new Map;class dr{constructor(){}static typeToInt(e){return Number(hS(hx(e)))}static registerTransactionType(e,t){let r=dr.typeToInt(e);dt.set(r,t)}static fromTxData(e,t={}){if(!("type"in e)||void 0===e.type)return de.fromTxData(e,t);let r=dr.typeToInt(e.type);if(0===r)return de.fromTxData(e,t);if(1===r)return h8.fromTxData(e,t);if(2===r)return h4.fromTxData(e,t);let n=dt.get(r);if(null==n?void 0:n.fromTxData)return n.fromTxData(e,t);throw Error(`Tx instantiation with type ${r} not supported`)}static fromSerializedData(e,t={}){if(!(e[0]<=127))return de.fromSerializedTx(e,t);switch(e[0]){case 1:return h8.fromSerializedTx(e,t);case 2:return h4.fromSerializedTx(e,t);default:{let r=dt.get(Number(e[0]));if(null==r?void 0:r.fromSerializedTx)return r.fromSerializedTx(e,t);throw Error(`TypedTransaction with ID ${e[0]} unknown`)}}}static fromBlockBodyData(e,t={}){if(aw(e))return this.fromSerializedData(e,t);if(Array.isArray(e))return de.fromValuesArray(e,t);throw Error("Cannot decode transaction: unknown type input")}}var dn=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let di=(e,t)=>{let r;if(!t&&"string"==typeof e&&oB(e)&&66!==e.length)throw new tW;try{r=aw(e)?e:aS(e)}catch(e){throw new tQ}if(!t&&32!==r.byteLength)throw new tW;return r},ds=(e,t=!1)=>{let r=aI(oB(e)?e:aN(e)),n=aI(aD(`\x19Ethereum Signed Message:
${r.byteLength}`));return lv(t?r:av(n,r))},da=(e,t)=>{let r=di(t),n=hh.sign(e.substring(2),r),i=n.toCompactRawBytes(),s=n.r.toString(16).padStart(64,"0"),o=n.s.toString(16).padStart(64,"0"),a=n.recovery+27;return{messageHash:e,v:aP(a),r:`0x${s}`,s:`0x${o}`,signature:`${a_(i)}${a.toString(16)}`}},dl=(e,t)=>{let{messageHash:r,v:n,r:i,s,signature:o}=da(ds(e),t);return{message:e,messageHash:r,v:n,r:i,s,signature:o}},dc=(e,t)=>dn(void 0,void 0,void 0,function*(){let r=e.sign(aI(t));if(al(r.v)||al(r.r)||al(r.s))throw new rY("Signer Error");let n=r.validate(!0);if(n.length>0){let e="Signer Error ";for(let t of n)e+=`${e} ${t}.`;throw new rY(e)}let i=a_(r.serialize()),s=lv(i);return{messageHash:a_(r.getMessageToSign(!0)),v:`0x${r.v.toString(16)}`,r:`0x${r.r.toString(16).padStart(64,"0")}`,s:`0x${r.s.toString(16).padStart(64,"0")}`,rawTransaction:i,transactionHash:a_(s)}}),du=e=>{if(al(e))throw new rE;return aQ(dr.fromSerializedData(aI(e)).getSenderAddress().toString())},dh=(e,t,r,n,i)=>{if("object"==typeof e){let t=`${e.r}${e.s.slice(2)}${e.v.slice(2)}`;return dh(e.messageHash,t,r)}if("string"==typeof t&&"string"==typeof r&&!al(n))return dh(e,`${r}${n.slice(2)}${t.slice(2)}`,i);if(al(t))throw new tJ("signature string undefined");let s=130,o=r?e:ds(e),a=parseInt(t.substring(s),16);a>26&&(a-=27);let l=lv(hh.Signature.fromCompact(t.slice(2,s)).addRecoveryBit(a).recoverPublicKey(o.replace("0x","")).toRawBytes(!1).subarray(1));return aQ(`0x${l.slice(-40)}`)},dd=e=>{let t=di(e),r=lv(hh.getPublicKey(t,!1).slice(1)).slice(-40);return aQ(`0x${r}`)},df=(e,t)=>{let r=di(e);return`0x${a_(hh.getPublicKey(r,t)).slice(4)}`},dp=(e,t,r)=>dn(void 0,void 0,void 0,function*(){var n,i,s,o,a,l,c;let u,h,d,f,p=di(e);if(u=(null==r?void 0:r.salt)?"string"==typeof r.salt?aI(r.salt):r.salt:lO(32),!(oD(t)||aw(t)))throw new t0;let g="string"==typeof t?aI(aN(t)):t;if(null==r?void 0:r.iv){if(16!==(h="string"==typeof r.iv?aI(r.iv):r.iv).length)throw new t1}else h=lO(16);let m=null!=(n=null==r?void 0:r.kdf)?n:"scrypt";if("pbkdf2"===m){if((f={dklen:null!=(i=null==r?void 0:r.dklen)?i:32,salt:a_(u).replace("0x",""),c:null!=(s=null==r?void 0:r.c)?s:262144,prf:"hmac-sha256"}).c<1e3)throw new t2;d=cQ(g,u,f.c,f.dklen,"sha256")}else if("scrypt"===m)f={n:null!=(o=null==r?void 0:r.n)?o:8192,r:null!=(a=null==r?void 0:r.r)?a:8,p:null!=(l=null==r?void 0:r.p)?l:1,dklen:null!=(c=null==r?void 0:r.dklen)?c:32,salt:a_(u).replace("0x","")},d=c1(g,u,f.n,f.p,f.r,f.dklen);else throw new tZ;let y=yield c_(p,d.slice(0,16),h,"aes-128-ctr"),b=a_(y).slice(2),w=lv(av(d.slice(16,32),y)).replace("0x","");return{version:3,id:l$(),address:dd(p).toLowerCase().replace("0x",""),crypto:{ciphertext:b,cipherparams:{iv:a_(h).replace("0x","")},cipher:"aes-128-ctr",kdf:m,kdfparams:f,mac:w}}}),dg=(e,t)=>{let r=di(e,t);return{address:dd(r),privateKey:a_(r),signTransaction:e=>{throw new rY("Do not have network access to sign the transaction")},sign:e=>dl("string"==typeof e?e:JSON.stringify(e),r),encrypt:(e,t)=>dn(void 0,void 0,void 0,function*(){return dp(r,e,t)})}},dm=()=>{let e=hh.utils.randomPrivateKey();return dg(`${a_(e)}`)},dy=(e,t,r)=>dn(void 0,void 0,void 0,function*(){let n,i="object"==typeof e?e:JSON.parse(r?e.toLowerCase():e);if(ab.validateJSONSchema(hg,i),3!==i.version)throw new tX;let s="string"==typeof t?aI(aN(t)):t;if(ab.validate(["bytes"],[s]),"scrypt"===i.crypto.kdf){let e=i.crypto.kdfparams;n=c1(s,"string"==typeof e.salt?aI(e.salt):e.salt,e.n,e.p,e.r,e.dklen)}else if("pbkdf2"===i.crypto.kdf){let e=i.crypto.kdfparams;n=cQ(s,"string"==typeof e.salt?aI(e.salt):e.salt,e.c,e.dklen,"sha256")}else throw new tZ;let o=aI(i.crypto.ciphertext);if(lv(av(n.slice(16,32),o)).replace("0x","")!==i.crypto.mac)throw new tY;return dg((yield cC(aI(i.crypto.ciphertext),n.slice(0,16),aI(i.crypto.cipherparams.iv))))});var db=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let dw=1e3;class dv{constructor(e){this._requestManager=e,this._requests=new Map}get requests(){return[...this._requests.values()].map(e=>e.payload)}add(e){let t=lZ(e),r=new l1;return this._requests.set(t.id,{payload:t,promise:r}),r}execute(e){return db(this,void 0,void 0,function*(){var t;if(0===this.requests.length)return Promise.resolve([]);let r=new l1({timeout:null!=(t=null==e?void 0:e.timeout)?t:dw,eagerStart:!0,timeoutMessage:"Batch request timeout"});return this._processBatchRequest(r).catch(e=>r.reject(e)),r.catch(e=>{e instanceof rl&&this._abortAllRequests("Batch request timeout"),r.reject(e)}),r})}_processBatchRequest(e){return db(this,void 0,void 0,function*(){var t,r;let n=yield this._requestManager.sendBatch([...this._requests.values()].map(e=>e.payload));if(n.length!==this._requests.size)throw this._abortAllRequests("Invalid batch response"),new no(n,`Batch request size mismatch the results size. Requests: ${this._requests.size}, Responses: ${n.length}`);let i=this.requests.map(e=>e.id).map(Number).sort((e,t)=>e-t),s=n.map(e=>e.id).map(Number).sort((e,t)=>e-t);if(JSON.stringify(i)!==JSON.stringify(s))throw this._abortAllRequests("Invalid batch response"),new no(n,`Batch request mismatch the results. Requests: [${i.join()}], Responses: [${s.join()}]`);for(let e of n)lq(e)?null==(t=this._requests.get(e.id))||t.promise.resolve(e.result):lz(e)&&(null==(r=this._requests.get(e.id))||r.promise.reject(e.error));e.resolve(n)})}_abortAllRequests(e){for(let{promise:t}of this._requests.values())t.reject(new rc(e))}}var dE=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class dA extends ce{constructor(e){var t;if(super(),this.providers=cm.providers,lt(e)||"string"==typeof e&&""!==e.trim()||cd(e)){this._requestManager=new cm(e),this._subscriptionManager=new cb(this._requestManager,{});return}let{config:r,provider:n,requestManager:i,subscriptionManager:s,registeredSubscriptions:o,accountProvider:a,wallet:l,requestManagerMiddleware:c}=e;this.setConfig(null!=r?r:{}),this._requestManager=null!=i?i:new cm(n,null==(t=null==r?void 0:r.enableExperimentalFeatures)?void 0:t.useSubscriptionWhenCheckingBlockTimeout,c),s?this._subscriptionManager=s:this._subscriptionManager=new cb(this.requestManager,null!=o?o:{}),a&&(this._accountProvider=a),l&&(this._wallet=l)}get requestManager(){return this._requestManager}get subscriptionManager(){return this._subscriptionManager}get wallet(){return this._wallet}get accountProvider(){return this._accountProvider}static fromContextObject(...e){return new this(...e.reverse())}getContextObject(){var e;return{config:this.config,provider:this.provider,requestManager:this.requestManager,subscriptionManager:this.subscriptionManager,registeredSubscriptions:null==(e=this.subscriptionManager)?void 0:e.registeredSubscriptions,providers:this.providers,wallet:this.wallet,accountProvider:this.accountProvider}}use(e,...t){let r=new e(...[...t,this.getContextObject()]);return this.on(O.CONFIG_CHANGE,e=>{r.setConfig({[e.name]:e.newValue})}),this[e.name]=r,r}link(e){this.setConfig(e.config),this._requestManager=e.requestManager,this.provider=e.provider,this._subscriptionManager=e.subscriptionManager,this._wallet=e.wallet,this._accountProvider=e._accountProvider,e.on(O.CONFIG_CHANGE,e=>{this.setConfig({[e.name]:e.newValue})})}registerPlugin(e){if(void 0!==this[e.pluginNamespace])throw new rh(e.pluginNamespace);let t={[e.pluginNamespace]:e};t[e.pluginNamespace].link(this),Object.assign(this,t)}get provider(){return this.currentProvider}set provider(e){this.requestManager.setProvider(e)}get currentProvider(){return this.requestManager.provider}set currentProvider(e){this.requestManager.setProvider(e)}get givenProvider(){return dA.givenProvider}setProvider(e){return this.provider=e,!0}setRequestManagerMiddleware(e){this.requestManager.setMiddleware(e)}get BatchRequest(){return dv.bind(void 0,this._requestManager)}extend(e){var t;return e.property&&!this[e.property]&&(this[e.property]={}),null==(t=e.methods)||t.forEach(t=>{let r=(...e)=>dE(this,void 0,void 0,function*(){return this.requestManager.send({method:t.call,params:e})});e.property?this[e.property][t.name]=r:this[t.name]=r}),this}}dA.providers=cm.providers;class dx{constructor(e){if(this.toAddress=()=>{if(this.isDirect()){let e=this._iban.slice(4);return aQ(la(dx._parseInt(e,36),40))}throw Error("Iban is indirect and cannot be converted. Must be length of 34 or 35")},dx.isIndirect(e)||dx.isDirect(e))this._iban=e;else throw Error("Invalid IBAN was provided")}static isDirect(e){return 34===e.length||35===e.length}isDirect(){return dx.isDirect(this._iban)}static isIndirect(e){return 20===e.length}isIndirect(){return dx.isIndirect(this._iban)}static isValid(e){return/^XE[0-9]{2}(ETH[0-9A-Z]{13}|[0-9A-Z]{30,31})$/.test(e)&&1===dx._mod9710(dx._iso13616Prepare(e))}isValid(){return dx.isValid(this._iban)}static fromBban(e){let t="XE",r=this._mod9710(this._iso13616Prepare(`${t}00${e}`)),n=`0${(98-r).toString()}`.slice(-2);return new dx(`${t}${n}${e}`)}static createIndirect(e){return dx.fromBban(`ETH${e.institution}${e.identifier}`)}static fromAddress(e){if(!o5(e))throw new r3(e);let t=la(BigInt(aC(e)).toString(36),15);return dx.fromBban(t.toUpperCase())}static toIban(e){return dx.fromAddress(e).toString()}client(){return this.isIndirect()?this._iban.slice(11):""}checksum(){return this._iban.slice(2,4)}institution(){return this.isIndirect()?this._iban.slice(7,11):""}toString(){return this._iban}}dx._iso13616Prepare=e=>{let t=65,r=90,n=e.toUpperCase();return`${n.slice(4)}${n.slice(0,4)}`.split("").map(e=>{let n=e.charCodeAt(0);return n>=t&&n<=r?n-t+10:e}).join("")},dx._parseInt=(e,t)=>[...e].reduce((e,r)=>BigInt(parseInt(r,t))+BigInt(t)*e,BigInt(0)),dx._mod9710=e=>{let t,r=e;for(;r.length>2;)t=r.slice(0,9),r=`${(parseInt(t,10)%97).toString()}${r.slice(t.length)}`;return parseInt(r,10)%97},dx.toAddress=e=>new dx(e).toAddress();var dS=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class dk extends l9{constructor(e){super(),this[H]="Promise",this._promise=new Promise(e)}then(e,t){return dS(this,void 0,void 0,function*(){return this._promise.then(e,t)})}catch(e){return dS(this,void 0,void 0,function*(){return this._promise.catch(e)})}finally(e){return dS(this,void 0,void 0,function*(){return this._promise.finally(e)})}on(e,t){return super.on(e,t),this}once(e,t){return super.once(e,t),this}}H=Symbol.toStringTag,r(50271);var d_=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function dI(e){return d_(this,void 0,void 0,function*(){return e.send({method:"eth_protocolVersion",params:[]})})}function dC(e){return d_(this,void 0,void 0,function*(){return e.send({method:"eth_syncing",params:[]})})}function dT(e){return d_(this,void 0,void 0,function*(){return e.send({method:"eth_coinbase",params:[]})})}function dP(e){return d_(this,void 0,void 0,function*(){return e.send({method:"eth_mining",params:[]})})}function dR(e){return d_(this,void 0,void 0,function*(){return e.send({method:"eth_hashrate",params:[]})})}function dO(e){return d_(this,void 0,void 0,function*(){return e.send({method:"eth_gasPrice",params:[]})})}function dN(e){return d_(this,void 0,void 0,function*(){return e.send({method:"eth_maxPriorityFeePerGas",params:[]})})}function dD(e){return d_(this,void 0,void 0,function*(){return e.send({method:"eth_accounts",params:[]})})}function dB(e){return d_(this,void 0,void 0,function*(){return e.send({method:"eth_blockNumber",params:[]})})}function dM(e,t,r){return d_(this,void 0,void 0,function*(){return ab.validate(["address","blockNumberOrTag"],[t,r]),e.send({method:"eth_getBalance",params:[t,r]})})}function dL(e,t,r,n){return d_(this,void 0,void 0,function*(){return ab.validate(["address","hex","blockNumberOrTag"],[t,r,n]),e.send({method:"eth_getStorageAt",params:[t,r,n]})})}function dF(e,t,r){return d_(this,void 0,void 0,function*(){return ab.validate(["address","blockNumberOrTag"],[t,r]),e.send({method:"eth_getTransactionCount",params:[t,r]})})}function dU(e,t){return d_(this,void 0,void 0,function*(){return ab.validate(["bytes32"],[t]),e.send({method:"eth_getBlockTransactionCountByHash",params:[t]})})}function dj(e,t){return d_(this,void 0,void 0,function*(){return ab.validate(["blockNumberOrTag"],[t]),e.send({method:"eth_getBlockTransactionCountByNumber",params:[t]})})}function d$(e,t){return d_(this,void 0,void 0,function*(){return ab.validate(["bytes32"],[t]),e.send({method:"eth_getUncleCountByBlockHash",params:[t]})})}function dH(e,t){return d_(this,void 0,void 0,function*(){return ab.validate(["blockNumberOrTag"],[t]),e.send({method:"eth_getUncleCountByBlockNumber",params:[t]})})}function dq(e,t,r){return d_(this,void 0,void 0,function*(){return ab.validate(["address","blockNumberOrTag"],[t,r]),e.send({method:"eth_getCode",params:[t,r]})})}function dz(e,t,r){return d_(this,void 0,void 0,function*(){return ab.validate(["address","hex"],[t,r]),e.send({method:"eth_sign",params:[t,r]})})}function dV(e,t){return d_(this,void 0,void 0,function*(){return e.send({method:"eth_signTransaction",params:[t]})})}function dK(e,t){return d_(this,void 0,void 0,function*(){return e.send({method:"eth_sendTransaction",params:[t]})})}function dG(e,t){return d_(this,void 0,void 0,function*(){return ab.validate(["hex"],[t]),e.send({method:"eth_sendRawTransaction",params:[t]})})}function dW(e,t,r){return d_(this,void 0,void 0,function*(){return ab.validate(["blockNumberOrTag"],[r]),e.send({method:"eth_call",params:[t,r]})})}function dQ(e,t,r){return d_(this,void 0,void 0,function*(){return ab.validate(["blockNumberOrTag"],[r]),e.send({method:"eth_estimateGas",params:[t,r]})})}function dJ(e,t,r){return d_(this,void 0,void 0,function*(){return ab.validate(["bytes32","bool"],[t,r]),e.send({method:"eth_getBlockByHash",params:[t,r]})})}function dZ(e,t,r){return d_(this,void 0,void 0,function*(){return ab.validate(["blockNumberOrTag","bool"],[t,r]),e.send({method:"eth_getBlockByNumber",params:[t,r]})})}function dY(e,t){return d_(this,void 0,void 0,function*(){return ab.validate(["bytes32"],[t]),e.send({method:"eth_getTransactionByHash",params:[t]})})}function dX(e,t,r){return d_(this,void 0,void 0,function*(){return ab.validate(["bytes32","hex"],[t,r]),e.send({method:"eth_getTransactionByBlockHashAndIndex",params:[t,r]})})}function d0(e,t,r){return d_(this,void 0,void 0,function*(){return ab.validate(["blockNumberOrTag","hex"],[t,r]),e.send({method:"eth_getTransactionByBlockNumberAndIndex",params:[t,r]})})}function d1(e,t){return d_(this,void 0,void 0,function*(){return ab.validate(["bytes32"],[t]),e.send({method:"eth_getTransactionReceipt",params:[t]})})}function d2(e,t,r){return d_(this,void 0,void 0,function*(){return ab.validate(["bytes32","hex"],[t,r]),e.send({method:"eth_getUncleByBlockHashAndIndex",params:[t,r]})})}function d3(e,t,r){return d_(this,void 0,void 0,function*(){return ab.validate(["blockNumberOrTag","hex"],[t,r]),e.send({method:"eth_getUncleByBlockNumberAndIndex",params:[t,r]})})}function d4(e,t){return d_(this,void 0,void 0,function*(){return ab.validate(["filter"],[t]),e.send({method:"eth_newFilter",params:[t]})})}function d5(e){return d_(this,void 0,void 0,function*(){return e.send({method:"eth_newBlockFilter",params:[]})})}function d6(e){return d_(this,void 0,void 0,function*(){return e.send({method:"eth_newPendingTransactionFilter",params:[]})})}function d8(e,t){return d_(this,void 0,void 0,function*(){return ab.validate(["hex"],[t]),e.send({method:"eth_uninstallFilter",params:[t]})})}function d7(e,t){return d_(this,void 0,void 0,function*(){return ab.validate(["hex"],[t]),e.send({method:"eth_getFilterChanges",params:[t]})})}function d9(e,t){return d_(this,void 0,void 0,function*(){return ab.validate(["hex"],[t]),e.send({method:"eth_getFilterLogs",params:[t]})})}function fe(e,t){return d_(this,void 0,void 0,function*(){return ab.validate(["filter"],[t]),e.send({method:"eth_getLogs",params:[t]})})}function ft(e){return d_(this,void 0,void 0,function*(){return e.send({method:"eth_getWork",params:[]})})}function fr(e,t,r,n){return d_(this,void 0,void 0,function*(){return ab.validate(["bytes8","bytes32","bytes32"],[t,r,n]),e.send({method:"eth_submitWork",params:[t,r,n]})})}function fn(e,t,r,n){return d_(this,void 0,void 0,function*(){for(let e of(ab.validate(["hex","blockNumberOrTag"],[t,r]),n))ab.validate(["number"],[e]);return e.send({method:"eth_feeHistory",params:[t,r,n]})})}function fi(e){return d_(this,void 0,void 0,function*(){return e.send({method:"eth_pendingTransactions",params:[]})})}function fs(e){return d_(this,void 0,void 0,function*(){return e.send({method:"eth_requestAccounts",params:[]})})}function fo(e){return d_(this,void 0,void 0,function*(){return e.send({method:"eth_chainId",params:[]})})}function fa(e,t,r,n){return d_(this,void 0,void 0,function*(){return ab.validate(["address","bytes32[]","blockNumberOrTag"],[t,r,n]),e.send({method:"eth_getProof",params:[t,r,n]})})}function fl(e){return d_(this,void 0,void 0,function*(){return e.send({method:"web3_clientVersion",params:[]})})}function fc(e,t,r){return d_(this,void 0,void 0,function*(){return ab.validate(["blockNumberOrTag"],[r]),e.send({method:"eth_createAccessList",params:[t,r]})})}function fu(e,t,r,n=!1){return d_(this,void 0,void 0,function*(){return ab.validate(["address"],[t]),e.send({method:`eth_signTypedData${n?"":"_v4"}`,params:[t,r]})})}var fh=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function fd(e){return fh(this,void 0,void 0,function*(){return e.send({method:"net_version",params:[]})})}function ff(e){return fh(this,void 0,void 0,function*(){return e.send({method:"net_peerCount",params:[]})})}function fp(e){return fh(this,void 0,void 0,function*(){return e.send({method:"net_listening",params:[]})})}var fg=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let fm=e=>fg(void 0,void 0,void 0,function*(){return e.send({method:"personal_listAccounts",params:[]})}),fy=(e,t)=>fg(void 0,void 0,void 0,function*(){return e.send({method:"personal_newAccount",params:[t]})}),fb=(e,t,r,n)=>fg(void 0,void 0,void 0,function*(){return e.send({method:"personal_unlockAccount",params:[t,r,n]})}),fw=(e,t)=>fg(void 0,void 0,void 0,function*(){return e.send({method:"personal_lockAccount",params:[t]})}),fv=(e,t,r)=>fg(void 0,void 0,void 0,function*(){return e.send({method:"personal_importRawKey",params:[t,r]})}),fE=(e,t,r)=>fg(void 0,void 0,void 0,function*(){return e.send({method:"personal_sendTransaction",params:[t,r]})}),fA=(e,t,r)=>fg(void 0,void 0,void 0,function*(){return e.send({method:"personal_signTransaction",params:[t,r]})}),fx=(e,t,r,n)=>fg(void 0,void 0,void 0,function*(){return e.send({method:"personal_sign",params:[t,r,n]})}),fS=(e,t,r)=>fg(void 0,void 0,void 0,function*(){return e.send({method:"personal_ecRecover",params:[t,r]})}),fk={type:"object",properties:{accessList:{type:"null"},maxFeePerGas:{type:"null"},maxPriorityFeePerGas:{type:"null"}}},f_={type:"object",properties:{maxFeePerGas:{type:"null"},maxPriorityFeePerGas:{type:"null"}}},fI={type:"object",properties:{gasPrice:{type:"null"}}},fC=(e,t,r)=>{try{ab.validateJSONSchema(e,t)}catch(e){if(e instanceof oR)throw new r0(e.errors,r);throw e}},fT=e=>{var t,r;let n=e;if(!al(n.type)){let e;switch(n.type){case"0x0":e=fk;break;case"0x1":e=f_;break;case"0x2":e=fI;break;default:return lm({format:"uint"},n.type,Y)}return fC(e,n,n.type),lm({format:"uint"},n.type,Y)}if(!al(n.maxFeePerGas)||!al(n.maxPriorityFeePerGas))return fC(fI,n,"0x2"),"0x2";if(!al(n.accessList))return fC(f_,n,"0x1"),"0x1";let i=null!=(t=n.hardfork)?t:null==(r=n.common)?void 0:r.hardfork;if(!al(i)){let e=Object.keys(S).indexOf(i);if(e>=Object.keys(S).indexOf("london"))return al(n.gasPrice)?"0x2":"0x0";if(e===Object.keys(S).indexOf("berlin"))return"0x0"}if(!al(n.gasPrice))return fC(fk,n,"0x0"),"0x0"},fP=(e,t)=>{var r;return(null!=(r=null==t?void 0:t.transactionTypeParser)?r:fT)(e)},fR=e=>e[0]>127?"0x0":az(e[0]),fO={type:"array",items:Object.assign({},{type:"object",properties:{address:{format:"address"},storageKeys:{type:"array",items:{format:"bytes32"}}}})},fN={type:"object",properties:{accessList:Object.assign({},fO),gasUsed:{type:"string"}}},fD={type:"string",enum:["goerli","kovan","mainnet","rinkeby","ropsten","sepolia"]},fB={type:"string",enum:["arrowGlacier","berlin","byzantium","chainstart","constantinople","dao","homestead","istanbul","london","merge","muirGlacier","petersburg","shanghai","spuriousDragon","tangerineWhistle"]},fM={type:"object",properties:{name:{format:"string"},networkId:{format:"uint"},chainId:{format:"uint"}}},fL={type:"object",properties:{from:{format:"address"},to:{oneOf:[{format:"address"},{type:"null"}]},value:{format:"uint"},gas:{format:"uint"},gasPrice:{format:"uint"},effectiveGasPrice:{format:"uint"},type:{format:"uint"},maxFeePerGas:{format:"uint"},maxPriorityFeePerGas:{format:"uint"},accessList:Object.assign({},fO),data:{format:"bytes"},input:{format:"bytes"},nonce:{format:"uint"},chain:Object.assign({},fD),hardfork:Object.assign({},fB),chainId:{format:"uint"},networkId:{format:"uint"},common:{type:"object",properties:{customChain:Object.assign({},fM),baseChain:Object.assign({},fD),hardfork:Object.assign({},fB)}},gasLimit:{format:"uint"},v:{format:"uint"},r:{format:"bytes32"},s:{format:"bytes32"}}},fF={type:"object",properties:Object.assign(Object.assign({},fL.properties),{blockHash:{format:"bytes32"},blockNumber:{format:"uint"},hash:{format:"bytes32"},transactionIndex:{format:"uint"},from:{format:"address"},to:{oneOf:[{format:"address"},{type:"null"}]},value:{format:"uint"},gas:{format:"uint"},gasPrice:{format:"uint"},effectiveGasPrice:{format:"uint"},type:{format:"uint"},maxFeePerGas:{format:"uint"},maxPriorityFeePerGas:{format:"uint"},accessList:Object.assign({},fO),data:{format:"bytes"},input:{format:"bytes"},nonce:{format:"uint"},gasLimit:{format:"uint"},v:{format:"uint"},r:{format:"bytes32"},s:{format:"bytes32"}})},fU={type:"object",properties:{index:{format:"uint"},validatorIndex:{format:"uint"},address:{format:"address"},amount:{format:"uint"}}},fj={type:"object",properties:{baseFeePerGas:{format:"uint"},blobGasUsed:{format:"uint"},difficulty:{format:"uint"},excessBlobGas:{format:"uint"},extraData:{format:"bytes"},gasLimit:{format:"uint"},gasUsed:{format:"uint"},hash:{format:"bytes32"},logsBloom:{format:"bytes256"},miner:{format:"bytes"},mixHash:{format:"bytes32"},nonce:{format:"uint"},number:{format:"uint"},parentBeaconBlockRoot:{format:"bytes32"},parentHash:{format:"bytes32"},receiptsRoot:{format:"bytes32"},sha3Uncles:{format:"bytes32"},size:{format:"uint"},stateRoot:{format:"bytes32"},timestamp:{format:"uint"},totalDifficulty:{format:"uint"},transactions:{oneOf:[{type:"array",items:Object.assign({},fF)},{type:"array",items:{format:"bytes32"}}]},transactionsRoot:{format:"bytes32"},uncles:{type:"array",items:{format:"bytes32"}},withdrawals:{type:"array",items:Object.assign({},fU)},withdrawalsRoot:{format:"bytes32"}}},f$={type:"object",properties:{author:{format:"bytes32"},excessDataGas:{format:"uint"},baseFeePerGas:{format:"uint"},blobGasUsed:{format:"uint"},difficulty:{format:"uint"},excessBlobGas:{format:"uint"},extraData:{format:"bytes"},gasLimit:{format:"uint"},gasUsed:{format:"uint"},hash:{format:"bytes32"},logsBloom:{format:"bytes256"},miner:{format:"bytes"},mixHash:{format:"bytes32"},nonce:{format:"uint"},number:{format:"uint"},parentBeaconBlockRoot:{format:"bytes32"},parentHash:{format:"bytes32"},receiptsRoot:{format:"bytes32"},sha3Uncles:{format:"bytes32"},size:{format:"uint"},stateRoot:{format:"bytes32"},timestamp:{format:"uint"},totalDifficulty:{format:"uint"},transactions:{type:"array",items:{format:"bytes32"}},transactionsRoot:{format:"bytes32"},uncles:{type:"array",items:{format:"bytes32"}},withdrawals:{type:"array",items:Object.assign({},fU)},withdrawalsRoot:{format:"bytes32"}}},fH={type:"object",properties:{removed:{format:"bool"},logIndex:{format:"uint"},transactionIndex:{format:"uint"},transactionHash:{format:"bytes32"},blockHash:{format:"bytes32"},blockNumber:{format:"uint"},address:{format:"address"},data:{format:"bytes"},topics:{type:"array",items:{format:"bytes32"}}}},fq={type:"object",properties:{startingBlock:{format:"string"},currentBlock:{format:"string"},highestBlock:{format:"string"},knownStates:{format:"string"},pulledStates:{format:"string"}}},fz={type:"object",properties:{transactionHash:{format:"bytes32"},transactionIndex:{format:"uint"},blockHash:{format:"bytes32"},blockNumber:{format:"uint"},from:{format:"address"},to:{format:"address"},cumulativeGasUsed:{format:"uint"},gasUsed:{format:"uint"},effectiveGasPrice:{format:"uint"},contractAddress:{format:"address"},logs:{type:"array",items:Object.assign({},fH)},logsBloom:{format:"bytes"},root:{format:"bytes"},status:{format:"uint"},type:{format:"uint"}}},fV={type:"object",properties:{messageHash:{format:"bytes"},r:{format:"bytes32"},s:{format:"bytes32"},v:{format:"bytes"},message:{format:"bytes"},signature:{format:"bytes"}}},fK={type:"object",properties:{oldestBlock:{format:"uint"},baseFeePerGas:{type:"array",items:{format:"uint"}},reward:{type:"array",items:{type:"array",items:{format:"uint"}}},gasUsedRatio:{type:"array",items:{type:"number"}}}},fG={type:"object",properties:{balance:{format:"uint"},codeHash:{format:"bytes32"},nonce:{format:"uint"},storageHash:{format:"bytes32"},accountProof:{type:"array",items:{format:"bytes32"}},storageProof:{type:"array",items:Object.assign({},{type:"object",properties:{key:{format:"bytes32"},value:{format:"uint"},proof:{type:"array",items:{format:"bytes32"}}}})}}};function fW(e,t=Z,r={transactionSchema:fF,fillInputAndData:!1}){var n,i;let s=ln({},e);if(!al(null==e?void 0:e.common)&&(s.common=Object.assign({},e.common),al(null==(n=e.common)?void 0:n.customChain)||(s.common.customChain=Object.assign({},e.common.customChain))),!al((s=lm(null!=(i=r.transactionSchema)?i:fF,s,t)).data)&&!al(s.input)&&az(s.data)!==az(s.input))throw new rV({data:a_(s.data),input:a_(s.input)});return r.fillInputAndData&&(al(s.data)?al(s.input)||(s.data=s.input):s.input=s.data),al(s.gasLimit)||(s.gas=s.gasLimit,delete s.gasLimit),s}function fQ(e,t,r={fillInputAndData:!1}){return{raw:lm({format:"bytes"},e,t),tx:fW(Object.assign(Object.assign({},dr.fromSerializedData(aI(e)).toJSON()),{hash:a_(lb(aI(e))),type:fR(aI(e))}),t,{fillInputAndData:r.fillInputAndData,transactionSchema:r.transactionSchema})}}var fJ=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function fZ(e,t){return fJ(this,void 0,void 0,function*(){return lm({format:"uint"},(yield fd(e.requestManager)),t)})}function fY(e,t){return fJ(this,void 0,void 0,function*(){return lm({format:"uint"},(yield ff(e.requestManager)),t)})}let fX=e=>fJ(void 0,void 0,void 0,function*(){return fp(e.requestManager)});var f0=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class f1 extends dA{getId(e=this.defaultReturnFormat){return f0(this,void 0,void 0,function*(){return fZ(this,e)})}getPeerCount(e=this.defaultReturnFormat){return f0(this,void 0,void 0,function*(){return fY(this,e)})}isListening(){return f0(this,void 0,void 0,function*(){return fX(this)})}}let f2="ALLEVENTS",f3={name:f2,signature:"",type:"event",inputs:[]},f4={bytes:A.HEX,number:E.NUMBER};var f5=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function f6(e,t,r){return f5(this,void 0,void 0,function*(){var n,i,s,o;let a,l=yield mA(t,t.defaultBlock,!1,Y);if(al(l.baseFeePerGas))throw new rq;if(al(e.gasPrice)&&BigInt(l.baseFeePerGas)===BigInt(0)&&(a=yield mm(t,r)),!al(e.gasPrice)||!al(a)){let t=lm({format:"uint"},null!=(n=e.gasPrice)?n:a,r);return{maxPriorityFeePerGas:t,maxFeePerGas:t}}return{maxPriorityFeePerGas:lm({format:"uint"},null!=(i=e.maxPriorityFeePerGas)?i:t.defaultMaxPriorityFeePerGas,r),maxFeePerGas:lm({format:"uint"},null!=(s=e.maxFeePerGas)?s:BigInt(l.baseFeePerGas)*BigInt(2)+BigInt(null!=(o=e.maxPriorityFeePerGas)?o:t.defaultMaxPriorityFeePerGas),r)}})}function f8(e,t,r){return f5(this,void 0,void 0,function*(){let n=pt(e,t);if(!al(n)){if(n.startsWith("-")||0>Number(n)||Number(n)>127)throw new rz(n);if(al(e.gasPrice)&&("0x0"===n||"0x1"===n))return{gasPrice:yield mm(t,r),maxPriorityFeePerGas:void 0,maxFeePerGas:void 0};if("0x2"===n)return Object.assign({gasPrice:void 0},(yield f6(e,t,r)))}})}var f7=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let f9=(e,t,r,n)=>{if(void 0!==r&&e in r&&void 0!==r[e]){if("string"==typeof r[e]&&o5(r[e]))return r[e];if(!oB(r[e])&&o9(r[e])){if(t.wallet){let n=t.wallet.get(lm({format:"uint"},r[e],f4));if(!al(n))return n.address}throw new rX}throw"from"===e?new rx(r.from):new rS(r.to)}if("from"===e){if(!al(n))return dd(n);if(!al(t.defaultAccount))return t.defaultAccount}},pe=(e,t,...r)=>f7(void 0,[e,t,...r],void 0,function*(e,t,r=e.defaultReturnFormat){if(al(t))throw new rH;return mP(e,t,e.defaultBlock,r)}),pt=(e,t)=>{let r=fP(e,t);return al(r)?al(t.defaultTransactionType)?void 0:lm({format:"uint"},t.defaultTransactionType,Y):r};function pr(e){return f7(this,void 0,void 0,function*(){var t,r;let n=lm(fL,e.transaction,e.web3Context.defaultReturnFormat);if(al(n.from)&&(n.from=f9("from",e.web3Context,void 0,e.privateKey)),al(n.nonce)&&(n.nonce=yield pe(e.web3Context,n.from,Y)),al(n.value)&&(n.value="0x0"),al(n.data))al(n.input)?n.input="0x":n.input.startsWith("0x")||(n.input=`0x${n.input}`);else{if(!al(n.input)&&n.data!==n.input)throw new rV({data:a_(n.data),input:a_(n.input)});n.data.startsWith("0x")||(n.data=`0x${n.data}`)}if(al(n.common)){if(e.web3Context.defaultCommon){let t=e.web3Context.defaultCommon,r=t.customChain.chainId,i=t.customChain.networkId,s=t.customChain.name;n.common=Object.assign(Object.assign({},t),{customChain:{chainId:r,networkId:i,name:s}})}al(n.chain)&&(n.chain=e.web3Context.defaultChain),al(n.hardfork)&&(n.hardfork=e.web3Context.defaultHardfork)}if(al(n.chainId)&&al(null==(t=n.common)?void 0:t.customChain.chainId)&&(n.chainId=yield mF(e.web3Context,Y)),al(n.networkId)&&(n.networkId=null!=(r=e.web3Context.defaultNetworkId)?r:yield fZ(e.web3Context,Y)),al(n.gasLimit)&&!al(n.gas)&&(n.gasLimit=n.gas),n.type=pt(n,e.web3Context),al(n.accessList)&&("0x1"===n.type||"0x2"===n.type)&&(n.accessList=[]),e.fillGasPrice&&(n=Object.assign(Object.assign({},n),(yield f8(n,e.web3Context,Y)))),al(n.gas)&&al(n.gasLimit)&&e.fillGasLimit){let t=yield mM(e.web3Context,n,"latest",Y);n=Object.assign(Object.assign({},n),{gas:lm({format:"uint"},t,Y)})}return n})}let pn=e=>f7(void 0,void 0,void 0,function*(){var t;return(null!=(t=e.web3Context.transactionBuilder)?t:pr)(Object.assign(Object.assign({},e),{transaction:e.transaction}))});var pi=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function ps(e,t,r){let[n,i]=lj(()=>pi(this,void 0,void 0,function*(){let n;try{n=yield mb(e,f4)}catch(e){console.warn("An error happen while trying to get the block number",e);return}let i=n-t;if(i>=e.transactionBlockTimeout)return new rQ({starterBlockNumber:t,numberOfBlocks:i,transactionHash:r})}),e.transactionPollingInterval);return[i,{clean:()=>{clearInterval(n)}}]}function po(e,t,r){return pi(this,void 0,void 0,function*(){var n;let i,s,o=!0;function a(n,i){i&&console.warn("error happened at subscription. So revert to polling...",i),s.clean(),o=!1;let[a,l]=ps(e,t,r);s.clean=l.clean,a.catch(e=>n(e))}try{i=yield null==(n=e.subscriptionManager)?void 0:n.subscribe("newHeads"),s={clean:()=>{var t;i.id&&(null==(t=e.subscriptionManager)||t.removeSubscription(i).then(()=>{}).catch(()=>{}))}}}catch(n){return ps(e,t,r)}return[new Promise((n,s)=>{try{i.on("data",n=>{if(o=!1,!(null==n?void 0:n.number))return;let i=Number(BigInt(n.number)-BigInt(t));i>=e.transactionBlockTimeout&&s(new rQ({starterBlockNumber:t,numberOfBlocks:i,transactionHash:r}))}),i.on("error",e=>{a(s,e)})}catch(e){a(s,e)}setTimeout(()=>{o&&a(s)},1e3*e.blockHeaderTimeout)}),s]})}function pa(e,t){return pi(this,void 0,void 0,function*(){var r,n;let i,{provider:s}=e.requestManager,o=yield mb(e,f4);return(null==(n=(r=s).supportsSubscriptions)?void 0:n.call(r))&&e.enableExperimentalFeatures.useSubscriptionWhenCheckingBlockTimeout?yield po(e,o,t):ps(e,o,t)})}var pl=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function pc(e,t,r){return pl(this,void 0,void 0,function*(){let[n,i]=lU(e.transactionSendTimeout,new rK({numberOfSeconds:e.transactionSendTimeout/1e3,transactionHash:r})),[s,o]=yield pa(e,r);try{return yield Promise.race([t(),i,s])}finally{clearTimeout(n),o.clean()}})}var pu=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function ph(e,t,r,n){return pu(this,void 0,void 0,function*(){var i;let[s,o]=lL(()=>pu(this,void 0,void 0,function*(){try{return(null!=n?n:mT)(e,t,r)}catch(e){console.warn("An error happen while trying to get the transaction receipt",e);return}}),null!=(i=e.transactionReceiptPollingInterval)?i:e.transactionPollingInterval),[a,l]=lU(e.transactionPollingTimeout,new rW({numberOfSeconds:e.transactionPollingTimeout/1e3,transactionHash:t})),[c,u]=yield pa(e,t);try{return yield Promise.race([s,l,c])}finally{a&&clearTimeout(a),o&&clearInterval(o),u.clean()}})}var pd=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let pf=({web3Context:e,transactionReceipt:t,transactionPromiEvent:r,customTransactionReceiptSchema:n,returnFormat:i})=>{var s;let o=1,a=setInterval(()=>{pd(void 0,void 0,void 0,function*(){if(o>=e.transactionConfirmationBlocks)return void clearInterval(a);let s=yield dZ(e.requestManager,aP(BigInt(t.blockNumber)+BigInt(o)),!1);(null==s?void 0:s.hash)&&(o+=1,r.emit("confirmation",{confirmations:lm({format:"uint"},o,i),receipt:lm(null!=n?n:fz,t,i),latestBlockHash:lm({format:"bytes32"},s.hash,i)}))})},null!=(s=e.transactionReceiptPollingInterval)?s:e.transactionPollingInterval)};var pp=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let pg=({web3Context:e,transactionReceipt:t,transactionPromiEvent:r,customTransactionReceiptSchema:n,returnFormat:i})=>{let s,o=!0;setImmediate(()=>{var a;null==(a=e.subscriptionManager)||a.subscribe("newHeads").then(a=>{a.on("data",l=>pp(void 0,void 0,void 0,function*(){var c;if(o=!1,!(null==l?void 0:l.number)||s===(null==l?void 0:l.parentHash))return;s=null==l?void 0:l.parentHash;let u=BigInt(l.number)-BigInt(t.blockNumber)+BigInt(1);r.emit("confirmation",{confirmations:lm({format:"uint"},u,i),receipt:lm(null!=n?n:fz,t,i),latestBlockHash:lm({format:"bytes32"},l.parentHash,i)}),u>=e.transactionConfirmationBlocks&&(yield null==(c=e.subscriptionManager)?void 0:c.removeSubscription(a))})),a.on("error",()=>pp(void 0,void 0,void 0,function*(){var s;yield null==(s=e.subscriptionManager)?void 0:s.removeSubscription(a),o=!1,pf({web3Context:e,transactionReceipt:t,transactionPromiEvent:r,customTransactionReceiptSchema:n,returnFormat:i})}))}).catch(()=>{o=!1,pf({web3Context:e,transactionReceipt:t,customTransactionReceiptSchema:n,transactionPromiEvent:r,returnFormat:i})})}),setTimeout(()=>{o&&pf({web3Context:e,transactionReceipt:t,transactionPromiEvent:r,returnFormat:i})},1e3*e.blockHeaderTimeout)};function pm(e,t,r,n,i,s){if(al(r)||al(r.blockHash))throw new rJ({receipt:r,blockHash:lm({format:"bytes32"},null==r?void 0:r.blockHash,i),transactionHash:lm({format:"bytes32"},n,i)});if(!r.blockNumber)throw new rZ({receipt:r});t.emit("confirmation",{confirmations:lm({format:"uint"},1,i),receipt:lm(null!=s?s:fz,r,i),latestBlockHash:lm({format:"bytes32"},r.blockHash,i)});let o=e.requestManager.provider;o&&"supportsSubscriptions"in o&&o.supportsSubscriptions()?pg({web3Context:e,transactionReceipt:r,transactionPromiEvent:t,customTransactionReceiptSchema:s,returnFormat:i}):pf({web3Context:e,transactionReceipt:r,transactionPromiEvent:t,customTransactionReceiptSchema:s,returnFormat:i})}let py=e=>!lt(e)&&"object"==typeof e&&!lt(e.type)&&"error"===e.type,pb=e=>!lt(e)&&"object"==typeof e&&!lt(e.type)&&"event"===e.type,pw=e=>!lt(e)&&"object"==typeof e&&!lt(e.type)&&"function"===e.type,pv=e=>!lt(e)&&"object"==typeof e&&!lt(e.type)&&"constructor"===e.type,pE=e=>"object"==typeof e&&void 0===e.components&&void 0===e.name,pA=e=>e.includes("[]")?{type:"tuple[]",name:e.slice(0,-2)}:{type:"tuple",name:e},px=e=>{let t=[];for(let r of Object.keys(e)){let n=e[r];"object"==typeof n?t.push(Object.assign(Object.assign({},pA(r)),{components:px(n)})):t.push({name:r,type:e[r]})}return t},pS=e=>"string"==typeof e&&/^(-)?0x[0-9a-f]*$/i.test(e)&&e.length%2==1,pk=(e,t)=>{let r=[];return t.forEach(t=>{if("object"==typeof t.components){if(!t.type.startsWith("tuple"))throw new ru(`Invalid value given "${t.type}". Error: components found but type is not tuple.`);let n=t.type.indexOf("["),i=n>=0?t.type.substring(n):"",s=pk(e,t.components);Array.isArray(s)&&e?r.push(`tuple(${s.join(",")})${i}`):e?r.push(`(${s.join()})`):r.push(`(${s.join(",")})${i}`)}else r.push(t.type)}),r},p_=e=>{var t,r,n,i;return py(e)||pb(e)||pw(e)?(null==(t=e.name)?void 0:t.includes("("))?e.name:`${null!=(r=e.name)?r:""}(${pk(!1,null!=(n=e.inputs)?n:[]).join(",")})`:`(${pk(!1,null!=(i=e.inputs)?i:[]).join(",")})`},pI=e=>{let t;if("string"!=typeof e&&!py(e))throw new ru("Invalid parameter value in encodeErrorSignature");return lv(t=e&&("function"==typeof e||"object"==typeof e)?p_(e):e)},pC=e=>{let t;if("string"!=typeof e&&!pb(e))throw new ru("Invalid parameter value in encodeEventSignature");return lv(t=e&&("function"==typeof e||"object"==typeof e)?p_(e):e)};function pT(e,t){let r=e.exec(t);return r?.groups}var pP=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,pR=/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/,pO=/^\(.+?\).*?$/,pN=Object.defineProperty,pD=(e,t,r)=>t in e?pN(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,pB=(e,t,r)=>(pD(e,"symbol"!=typeof t?t+"":t,r),r),pM="abitype",pL="0.7.1",pF=class extends Error{constructor(e,t={}){let r=t.cause instanceof pF?t.cause.details:t.cause?.message?t.cause.message:t.details,n=t.cause instanceof pF&&t.cause.docsPath||t.docsPath;super([e||"An error occurred.","",...t.metaMessages?[...t.metaMessages,""]:[],...n?[`Docs: https://abitype.dev${n}`]:[],...r?[`Details: ${r}`]:[],`Version: ${pM}@${pL}`].join("\n")),pB(this,"details"),pB(this,"docsPath"),pB(this,"metaMessages"),pB(this,"shortMessage"),pB(this,"name","AbiTypeError"),t.cause&&(this.cause=t.cause),this.details=r,this.docsPath=n,this.metaMessages=t.metaMessages,this.shortMessage=e}},pU=/^error (?<name>[a-zA-Z0-9_]+)\((?<parameters>.*?)\)$/;function pj(e){return pU.test(e)}function p$(e){return execTyped(pU,e)}var pH=/^event (?<name>[a-zA-Z0-9_]+)\((?<parameters>.*?)\)$/;function pq(e){return pH.test(e)}function pz(e){return execTyped(pH,e)}var pV=/^function (?<name>[a-zA-Z0-9_]+)\((?<parameters>.*?)\)(?: (?<scope>external|public{1}))?(?: (?<stateMutability>pure|view|nonpayable|payable{1}))?(?: returns \((?<returns>.*?)\))?$/;function pK(e){return pV.test(e)}function pG(e){return execTyped(pV,e)}var pW=/^struct (?<name>[a-zA-Z0-9_]+) \{(?<properties>.*?)\}$/;function pQ(e){return pW.test(e)}function pJ(e){return pT(pW,e)}var pZ=/^constructor\((?<parameters>.*?)\)(?:\s(?<stateMutability>payable{1}))?$/;function pY(e){return pZ.test(e)}function pX(e){return execTyped(pZ,e)}var p0=/^fallback\(\)$/;function p1(e){return p0.test(e)}var p2=/^receive\(\) external payable$/;function p3(e){return p2.test(e)}var p4=new Set(["memory","indexed","storage","calldata"]),p5=new Set(["indexed"]),p6=new Set(["calldata","memory","storage"]);function p8(e,t){return t?`${t}:${e}`:e}var p7=new Map([["address",{type:"address"}],["bool",{type:"bool"}],["bytes",{type:"bytes"}],["bytes32",{type:"bytes32"}],["int",{type:"int256"}],["int256",{type:"int256"}],["string",{type:"string"}],["uint",{type:"uint256"}],["uint8",{type:"uint8"}],["uint16",{type:"uint16"}],["uint24",{type:"uint24"}],["uint32",{type:"uint32"}],["uint64",{type:"uint64"}],["uint96",{type:"uint96"}],["uint112",{type:"uint112"}],["uint160",{type:"uint160"}],["uint192",{type:"uint192"}],["uint256",{type:"uint256"}],["address owner",{type:"address",name:"owner"}],["address to",{type:"address",name:"to"}],["bool approved",{type:"bool",name:"approved"}],["bytes _data",{type:"bytes",name:"_data"}],["bytes data",{type:"bytes",name:"data"}],["bytes signature",{type:"bytes",name:"signature"}],["bytes32 hash",{type:"bytes32",name:"hash"}],["bytes32 r",{type:"bytes32",name:"r"}],["bytes32 root",{type:"bytes32",name:"root"}],["bytes32 s",{type:"bytes32",name:"s"}],["string name",{type:"string",name:"name"}],["string symbol",{type:"string",name:"symbol"}],["string tokenURI",{type:"string",name:"tokenURI"}],["uint tokenId",{type:"uint256",name:"tokenId"}],["uint8 v",{type:"uint8",name:"v"}],["uint256 balance",{type:"uint256",name:"balance"}],["uint256 tokenId",{type:"uint256",name:"tokenId"}],["uint256 value",{type:"uint256",name:"value"}],["event:address indexed from",{type:"address",name:"from",indexed:!0}],["event:address indexed to",{type:"address",name:"to",indexed:!0}],["event:uint indexed tokenId",{type:"uint256",name:"tokenId",indexed:!0}],["event:uint256 indexed tokenId",{type:"uint256",name:"tokenId",indexed:!0}]]),p9=/^(?<type>[a-zA-Z0-9_]+?)(?<array>(?:\[\d*?\])+?)?(?:\s(?<modifier>calldata|indexed|memory|storage{1}))?(?:\s(?<name>[a-zA-Z0-9_]+))?$/,ge=/^\((?<type>.+?)\)(?<array>(?:\[\d*?\])+?)?(?:\s(?<modifier>calldata|indexed|memory|storage{1}))?(?:\s(?<name>[a-zA-Z0-9_]+))?$/,gt=/^u?int$/;function gr(e,t){let r,n=p8(e,t?.type);if(p7.has(n))return p7.get(n);let i=pO.test(e),s=pT(i?ge:p9,e);if(!s)throw new pF("Invalid ABI parameter.",{details:e});if(s.name&&go(s.name))throw new pF("Invalid ABI parameter.",{details:e,metaMessages:[`"${s.name}" is a protected Solidity keyword. More info: https://docs.soliditylang.org/en/latest/cheatsheet.html`]});let o=s.name?{name:s.name}:{},a="indexed"===s.modifier?{indexed:!0}:{},l=t?.structs??{},c={};if(i){r="tuple";let e=gn(s.type),t=[],n=e.length;for(let r=0;r<n;r++)t.push(gr(e[r],{structs:l}));c={components:t}}else if(s.type in l)r="tuple",c={components:l[s.type]};else if(gt.test(s.type))r=`${s.type}256`;else if(r=s.type,t?.type!=="struct"&&!gi(r))throw new pF("Unknown type.",{metaMessages:[`Type "${r}" is not a valid ABI type.`]});if(s.modifier){if(!t?.modifiers?.has?.(s.modifier))throw new pF("Invalid ABI parameter.",{details:e,metaMessages:[`Modifier "${s.modifier}" not allowed${t?.type?` in "${t.type}" type`:""}.`]});if(p6.has(s.modifier)&&!ga(r,!!s.array))throw new pF("Invalid ABI parameter.",{details:e,metaMessages:[`Modifier "${s.modifier}" not allowed${t?.type?` in "${t.type}" type`:""}.`,`Data location can only be specified for array, struct, or mapping types, but "${s.modifier}" was given.`]})}let u={type:`${r}${s.array??""}`,...o,...a,...c};return p7.set(n,u),u}function gn(e,t=[],r="",n=0){if(""===e){if(""===r)return t;if(0!==n)throw new pF("Unbalanced parentheses.",{metaMessages:[`"${r.trim()}" has too many ${n>0?"opening":"closing"} parentheses.`],details:`Depth "${n}"`});return[...t,r.trim()]}let i=e.length;for(let s=0;s<i;s++){let i=e[s],o=e.slice(s+1);switch(i){case",":return 0===n?gn(o,[...t,r.trim()]):gn(o,t,`${r}${i}`,n);case"(":return gn(o,t,`${r}${i}`,n+1);case")":return gn(o,t,`${r}${i}`,n-1);default:return gn(o,t,`${r}${i}`,n)}}return[]}function gi(e){return"address"===e||"bool"===e||"function"===e||"string"===e||pP.test(e)||pR.test(e)}var gs=/^(?:after|alias|anonymous|apply|auto|byte|calldata|case|catch|constant|copyof|default|defined|error|event|external|false|final|function|immutable|implements|in|indexed|inline|internal|let|mapping|match|memory|mutable|null|of|override|partial|private|promise|public|pure|reference|relocatable|return|returns|sizeof|static|storage|struct|super|supports|switch|this|true|try|typedef|typeof|var|view|virtual)$/;function go(e){return"address"===e||"bool"===e||"function"===e||"string"===e||"tuple"===e||pP.test(e)||pR.test(e)||gs.test(e)}function ga(e,t){return t||"bytes"===e||"string"===e||"tuple"===e}function gl(e){let t={},r=e.length;for(let n=0;n<r;n++){let r=e[n];if(!pQ(r))continue;let i=pJ(r);if(!i)throw new pF("Invalid struct signature.",{details:r});let s=i.properties.split(";"),o=[],a=s.length;for(let e=0;e<a;e++){let t=s[e].trim();if(!t)continue;let r=gr(t,{type:"struct"});o.push(r)}if(!o.length)throw new pF("Invalid struct signature.",{details:r,metaMessages:["No properties exist."]});t[i.name]=o}let n={},i=Object.entries(t),s=i.length;for(let e=0;e<s;e++){let[r,s]=i[e];n[r]=gu(s,t)}return n}var gc=/^(?<type>[a-zA-Z0-9_]+?)(?<array>(?:\[\d*?\])+?)?$/;function gu(e,t,r=new Set){let n=[],i=e.length;for(let s=0;s<i;s++){let i=e[s];if(pO.test(i.type))n.push(i);else{let e=pT(gc,i.type);if(!e?.type)throw new pF("Invalid ABI parameter.",{details:JSON.stringify(i,null,2),metaMessages:["ABI parameter type is invalid."]});let{array:s,type:o}=e;if(o in t){if(r.has(o))throw new pF("Circular reference detected.",{metaMessages:[`Struct "${o}" is a circular reference.`]});n.push({...i,type:`tuple${s??""}`,components:gu(t[o]??[],t,new Set([...r,o]))})}else if(gi(o))n.push(i);else throw new pF("Unknown type.",{metaMessages:[`Type "${o}" is not a valid ABI type. Perhaps you forgot to include a struct signature?`]})}}return n}function gh(e){let t;if("string"==typeof e)t=gr(e,{modifiers:p4});else{let r=gl(e),n=e.length;for(let i=0;i<n;i++){let n=e[i];if(!pQ(n)){t=gr(n,{modifiers:p4,structs:r});break}}}if(!t)throw new pF("Failed to parse ABI parameter.",{details:`parseAbiParameter(${JSON.stringify(e,null,2)})`,docsPath:"/api/human.html#parseabiparameter-1"});return t}let gd=32;function gf(e=0){var t;if((null==(t=globalThis.Buffer)?void 0:t.alloc)!==void 0){let t=globalThis.Buffer.alloc(e);return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}return new Uint8Array(e)}function gp(e){var t,r;return Object.assign(Object.assign({},e),{name:null!=(t=e.name)?t:"",components:null==(r=e.components)?void 0:r.map(e=>gp(e))})}function gg(e){return!lt(e)&&"object"==typeof e&&!lt(e.type)&&"string"==typeof e.type}function gm(e){return e.map(e=>{var t;if(gg(e))return e;if("string"==typeof e)return gp(gh(e.replace(/tuple/,"")));if(pE(e)){let r=Object.keys(e)[0],n=pA(r);return n.name=null!=(t=n.name)?t:"",Object.assign(Object.assign({},n),{components:px(e[r])})}throw new ru("Invalid abi")})}function gy(e){let t=e.type.lastIndexOf("["),r=e.type.substring(0,t),n=e.type.substring(t),i=-1;if("[]"!==n&&isNaN(i=Number(n.slice(1,-1))))throw new ru("Invalid fixed array size",{size:n});return{param:{type:r,name:"",components:e.components},size:i}}function gb(e){var t,r;return!!("string"===e.type||"bytes"===e.type||e.type.endsWith("[]"))||("tuple"===e.type?null!=(r=null==(t=e.components)?void 0:t.some(gb))&&r:!!e.type.endsWith("]")&&gb(gy(e).param))}let gw=20,gv=12;function gE(e,t){if("string"!=typeof t)throw new ru("address type expects string as input type",{value:t,name:e.name,type:e.type});let r=t.toLowerCase();if(r.startsWith("0x")||(r=`0x${r}`),!o5(r))throw new ru("provided input is not valid address",{value:t,name:e.name,type:e.type});let n=o0(r),i=gf(gd);return i.set(n,gv),{dynamic:!1,encoded:i}}function gA(e,t){let r=t.subarray(gv,gd);if(r.length!==gw)throw new ru("Invalid decoding input, not enough bytes to decode address",{bytes:t});return{result:aQ(oZ(r)),encoded:t.subarray(gd),consumed:gd}}let gx=new Map,gS=BigInt(256);for(let e=8;e<=256;e+=8)gx.set(`uint${e}`,{min:BigInt(0),max:gS-BigInt(1)}),gx.set(`int${e}`,{min:-gS/BigInt(2),max:gS/BigInt(2)-BigInt(1)}),gS*=BigInt(256);gx.set("int",gx.get("int256")),gx.set("uint",gx.get("uint256"));let gk=BigInt(1)<<BigInt(256);function g_(e,t=gd){let r;return o0(r=li(r=e<0?(gk+e).toString(16):e.toString(16),2*t))}function gI(e,t){let r=BigInt(oZ(e));return r<=t?r:r-gk}function gC(e,t){let r;try{r=aK(t)}catch(r){throw new ru("provided input is not number value",{type:e.type,value:t,name:e.name})}let n=gx.get(e.type);if(!n)throw new ru("provided abi contains invalid number datatype",{type:e.type});if(r<n.min)throw new ru("provided input is less then minimum for given type",{type:e.type,value:t,name:e.name,minimum:n.min.toString()});if(r>n.max)throw new ru("provided input is greater then maximum for given type",{type:e.type,value:t,name:e.name,maximum:n.max.toString()});return{dynamic:!1,encoded:g_(r)}}function gT(e,t){if(t.length<gd)throw new ru("Not enough bytes left to decode",{param:e,bytesLeft:t.length});let r=t.subarray(0,gd),n=gx.get(e.type);if(!n)throw new ru("provided abi contains invalid number datatype",{type:e.type});let i=gI(r,n.max);if(i<n.min)throw new ru("decoded value is less then minimum for given type",{type:e.type,value:i,name:e.name,minimum:n.min.toString()});if(i>n.max)throw new ru("decoded value is greater then maximum for given type",{type:e.type,value:i,name:e.name,maximum:n.max.toString()});return{result:i,encoded:t.subarray(gd),consumed:gd}}function gP(e,t){let r;try{r=aJ(t)}catch(r){if(r instanceof r9)throw new ru("provided input is not valid boolean value",{type:e.type,value:t,name:e.name})}return gC({type:"uint8",name:""},Number(r))}function gR(e,t){let r=gT({type:"uint8",name:""},t);if(r.result>1||r.result<0)throw new ru("Invalid boolean value encoded",{boolBytes:t.subarray(0,gd),numberResult:r});return{result:r.result===BigInt(1),encoded:r.encoded,consumed:gd}}let gO=32;function gN(e,t){if("string"==typeof t&&t.length%2!=0&&(t+="0"),!o3(t))throw new ru("provided input is not valid bytes value",{type:e.type,value:t,name:e.name});let r=aS(t),[,n]=e.type.split("bytes");if(n){if(Number(n)>gO||1>Number(n))throw new ru("invalid bytes type. Static byte type can have between 1 and 32 bytes",{type:e.type});if(Number(n)<r.length)throw new ru("provided input size is different than type size",{type:e.type,value:t,name:e.name});let i=gf(gd);return i.set(r),{dynamic:!1,encoded:i}}let i=Math.ceil(r.length/gd),s=gf(gd+i*gd);return s.set(gC({type:"uint32",name:""},r.length).encoded),s.set(r,gd),{dynamic:!0,encoded:s}}function gD(e,t){let[,r]=e.type.split("bytes"),n=Number(r),i=t,s=1,o=0;if(!n){let e=gT({type:"uint32",name:""},i);n=Number(e.result),o+=e.consumed,i=e.encoded,s=Math.ceil(n/gd)}if(n>t.length)throw new ru("there is not enough data to decode",{type:e.type,encoded:t,size:n});return{result:a_(i.subarray(0,n)),encoded:i.subarray(s*gd),consumed:o+s*gd}}function gB(e,t){if("string"!=typeof t)throw new ru("invalid input, should be string",{input:t});return gN({type:"bytes",name:""},aF(t))}function gM(e,t){let r=gD({type:"bytes",name:""},t);return{result:aM(r.result),encoded:r.encoded,consumed:r.consumed}}function gL(e){let t=0,r=0,n=[],i=[];for(let r of e)r.dynamic?t+=gd:t+=r.encoded.length;for(let s of e)s.dynamic?(n.push(gC({type:"uint256",name:""},t+r)),i.push(s),r+=s.encoded.length):n.push(s);return av(...n.map(e=>e.encoded),...i.map(e=>e.encoded))}function gF(e,t){if(!Array.isArray(t))throw new ru("Expected value to be array",{abi:e,values:t});let{size:r,param:n}=gy(e),i=t.map(e=>gj(n,e)),s=-1===r,o=i.length>0&&i[0].dynamic;if(!s&&t.length!==r)throw new ru("Given arguments count doesn't match array length",{arrayLength:r,argumentsLength:t.length});if(s||o){let e=gL(i);if(s){let t=gC({type:"uint256",name:""},i.length).encoded;return{dynamic:!0,encoded:i.length>0?av(t,e):t}}return{dynamic:!0,encoded:e}}return{dynamic:!1,encoded:av(...i.map(e=>e.encoded))}}function gU(e,t){let{size:r,param:n}=gy(e),i=0,s=[],o=t;if(-1===r){let e=gT({type:"uint32",name:""},t);r=Number(e.result),i=e.consumed,o=e.encoded}if(gb(n)){for(let e=0;e<r;e+=1){let t=gT({type:"uint32",name:""},o.subarray(e*gd));i+=t.consumed;let r=g$(n,o.subarray(Number(t.result)));i+=r.consumed,s.push(r.result)}return{result:s,encoded:o.subarray(i),consumed:i}}for(let e=0;e<r;e+=1){let e=g$(n,t.subarray(i));i+=e.consumed,s.push(e.result)}return{result:s,encoded:t.subarray(i),consumed:i}}function gj(e,t){if("string"===e.type)return gB(e,t);if("bool"===e.type)return gP(e,t);if("address"===e.type)return gE(e,t);if("tuple"===e.type)return gH(e,t);if(e.type.endsWith("]"))return gF(e,t);if(e.type.startsWith("bytes"))return gN(e,t);if(e.type.startsWith("uint")||e.type.startsWith("int"))return gC(e,t);throw new ru("Unsupported",{param:e,value:t})}function g$(e,t){if("string"===e.type)return gM(e,t);if("bool"===e.type)return gR(e,t);if("address"===e.type)return gA(e,t);if("tuple"===e.type)return gq(e,t);if(e.type.endsWith("]"))return gU(e,t);if(e.type.startsWith("bytes"))return gD(e,t);if(e.type.startsWith("uint")||e.type.startsWith("int"))return gT(e,t);throw new ru("Unsupported",{param:e,bytes:t})}function gH(e,t){var r,n,i;let s=!1;if(!Array.isArray(t)&&"object"!=typeof t)throw new ru("param must be either Array or Object",{param:e,input:t});let o=t,a=[];for(let l=0;l<(null!=(n=null==(r=e.components)?void 0:r.length)?n:0);l+=1){let r,n=e.components[l];if(Array.isArray(o)){if(l>=o.length)throw new ru("input param length missmatch",{param:e,input:t});r=gj(n,o[l])}else{let s=o[null!=(i=n.name)?i:""];if(null==s)throw new ru("missing input defined in abi",{param:e,input:t,paramName:n.name});r=gj(n,s)}r.dynamic&&(s=!0),a.push(r)}return s?{dynamic:!0,encoded:gL(a)}:{dynamic:!1,encoded:av(...a.map(e=>e.encoded))}}function gq(e,t){let r={__length__:0},n=0;if(!e.components)return{result:r,encoded:t,consumed:n};let i=0;for(let[s,o]of e.components.entries()){let e;if(gb(o)){let r=gT({type:"uint32",name:""},t.subarray(n));e=g$(o,t.subarray(Number(r.result))),n+=r.consumed,i+=e.consumed}else e=g$(o,t.subarray(n)),n+=e.consumed;r.__length__+=1,r[s]=e.result,o.name&&""!==o.name&&(r[o.name]=e.result)}return{encoded:t.subarray(n+i),result:r,consumed:n+i}}function gz(e,t,r){return gq({type:"tuple",name:"",components:gm(e)},o0(t)).result}function gV(e){let t=[];return e.forEach(e=>{if(Array.isArray(e)){let r=gV(e);t.push({type:"tuple",components:r,name:""})}else t.push({type:az(e,!0)})}),t}function gK(e,t){if((null==e?void 0:e.length)!==t.length)throw new ru("Invalid number of values received for given ABI",{expected:null==e?void 0:e.length,received:t.length});return oZ(gH({type:"tuple",name:"",components:gm(e)},t).encoded)}function gG(e){try{let t=gV(e);return oZ(gH({type:"tuple",name:"",components:t},e).encoded)}catch(t){throw new ru("Could not infer types from given params",{params:e})}}let gW=(e,t)=>gK([e],[t]),gQ=(e,t,r)=>{try{if(e.length>0&&(!t||"0x"===t||"0X"===t))throw new ru("Returned values aren't valid, did it run Out of Gas? You might also see this error if you are not using the correct ABI for the contract you are retrieving data from, requesting data from a block number that does not exist, or querying a node which is not fully synced.");return gz(e,`0x${t.replace(/0x/i,"")}`,r)}catch(e){throw new ru(`Parameter decoding error: ${e.message}`,{internalErr:e})}},gJ=(e,t)=>gQ(e,t,!1),gZ=(e,t)=>gJ([e],t)["0"],gY=e=>{let t;if("string"!=typeof e&&!pw(e))throw new ru("Invalid parameter value in encodeFunctionSignature");return lv(t=e&&("function"==typeof e||"object"==typeof e)?p_(e):e).slice(0,10)},gX=(e,t)=>{var r;if(!pw(e))throw new ru("Invalid parameter value in encodeFunctionCall");return`${gY(e)}${gK(null!=(r=e.inputs)?r:[],null!=t?t:[]).replace("0x","")}`},g0=(e,t,r=!0)=>{let n=r&&t&&t.length>=10&&t.startsWith("0x")?t.slice(10):t;if(!e.inputs)throw new t7("No inputs found in the ABI");return Object.assign(Object.assign({},gJ([...e.inputs],n)),{__method__:p_(e)})},g1=(e,t)=>{if("constructor"===e.type)return t;if(!t)return null;let r=t.length>=2?t.slice(2):t;if(!e.outputs)return null;let n=gJ([...e.outputs],r);return 1===n.__length__?n[0]:n},g2=["bool","string","int","uint","address","fixed","ufixed"],g3=(e,t)=>"string"===e?t:gZ(e,t),g4=(e,t,r)=>{let n=Array.isArray(r)?r:[r],i={},s={};for(let[t,r]of e.entries())r.indexed?i[t]=r:s[t]=r;let o=t?gQ(Object.values(s),t,!0):{__length__:0},a=n.length-Object.keys(i).length,l=Object.values(i).map((e,t)=>g2.some(t=>e.type.startsWith(t))?g3(e.type,n[t+a]):n[t+a]),c={__length__:0},u=0,h=0;for(let[t,r]of e.entries())c[t]="string"===r.type?"":void 0,i[t]&&(c[t]=l[u],u+=1),s[t]&&(c[t]=o[String(h)],h+=1),r.name&&(c[r.name]=c[t]),c.__length__+=1;return c},g5=(e,t)=>{if(null==t?void 0:t.data){let r,n,i;try{let s=t.data.slice(0,10),o=e.find(e=>pI(e).startsWith(s));(null==o?void 0:o.inputs)?(r=o.name,n=p_(o),i=gJ([...o.inputs],t.data.substring(10))):t.data.startsWith("0x08c379a0")?(r="Error",n="Error(string)",i=gJ([{name:"message",type:"string"}],t.data.substring(10))):t.data.startsWith("0x4e487b71")?(r="Panic",n="Panic(uint256)",i=gJ([{name:"code",type:"uint256"}],t.data.substring(10))):console.error("No matching error abi found for error data",t.data)}catch(e){console.error(e)}r&&t.setDecodedProperties(r,n,i)}},g6=/^\w+/,g8=/^(.*)\[([0-9]*?)]$/,g7=(e,t,r=[])=>{let n=t.match(g6)[0];return r.includes(n)||!e.types[n]?r:[n,...e.types[n].reduce((t,r)=>[...t,...g7(e,r.type,t).filter(e=>!t.includes(e))],[])]},g9=(e,t)=>{let[r,...n]=g7(e,t);return[r,...n.sort()].map(t=>`${t}(${e.types[t].map(e=>`${e.type} ${e.name}`)})`).join("")},me=(e,t)=>keccak256(g9(e,t)),mt=(e,t,r)=>keccak256(mn(e,t,r)),mr=(e,t,r)=>{let n=t.match(g8);if(n){let t=n[1],i=Number(n[2])||void 0;if(!Array.isArray(r))throw new AbiError("Cannot encode data: value is not of array type",{data:r});if(i&&r.length!==i)throw new AbiError(`Cannot encode data: expected length of ${i}, but got ${r.length}`,{data:r});let s=r.map(r=>mr(e,t,r));return["bytes32",keccak256(encodeParameters(s.map(e=>e[0]),s.map(e=>e[1])))]}return e.types[t]?["bytes32",mt(e,t,r)]:"string"===t||"bytes"===t?["bytes32",keccak256(r)]:[t,r]},mn=(e,t,r)=>{let[n,i]=e.types[t].reduce(([t,n],i)=>{if(isNullish(r[i.name])||isNullish(i.type))throw new AbiError(`Cannot encode data: missing data for '${i.name}'`,{data:r,field:i});let s=r[i.name],[o,a]=mr(e,i.type,s);return[[...t,o],[...n,a]]},[["bytes32"],[me(e,t)]]);return encodeParameters(n,i)};var mi=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let ms=(e,t)=>{var r,n,i,s,o;if(e instanceof rt&&e.cause instanceof re)return void 0!==t?(g5(t.filter(e=>py(e)),e.cause),{reason:e.cause.message,signature:null==(r=e.cause.data)?void 0:r.slice(0,10),data:null==(n=e.cause.data)?void 0:n.substring(10),customErrorName:e.cause.errorName,customErrorDecodedSignature:e.cause.errorSignature,customErrorArguments:e.cause.errorArgs}):{reason:e.cause.message,signature:null==(i=e.cause.data)?void 0:i.slice(0,10),data:null==(s=e.cause.data)?void 0:s.substring(10)};if(e instanceof na&&!Array.isArray(null==(o=e.cause)?void 0:o.errors)&&void 0!==e.cause)return e.cause.message;throw e};function mo(e,t,r){return mi(this,arguments,void 0,function*(e,t,r,n=e.defaultReturnFormat){try{yield mB(e,t,e.defaultBlock,n);return}catch(e){return ms(e,r)}})}var ma=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function ml(e,t,r,n,i,s){return ma(this,void 0,void 0,function*(){let o,a=s;if(void 0===a&&(void 0!==n?a=ms(n):e.handleRevert&&void 0!==t&&(a=yield mo(e,t,i))),void 0===a)o=new rv(r);else if("string"==typeof a)o=new rb(a,void 0,r);else if(void 0!==a.customErrorName&&void 0!==a.customErrorDecodedSignature&&void 0!==a.customErrorArguments){let e=a;o=new rw(e.reason,e.customErrorName,e.customErrorDecodedSignature,e.customErrorArguments,e.signature,r,e.data)}else o=new rb(a.reason,a.signature,r,a.data);return o})}let mc=(e,t,r,n=Z)=>{var i,s,o,a,l,c;let u=Object.assign({},e),h=lm(fH,t,n);if([f2,"allEvents"].includes(u.name)){let e=r.find(e=>e.signature===t.topics[0]);u=e||{anonymous:!0}}if(u.inputs=null!=(s=null!=(i=u.inputs)?i:e.inputs)?s:[],!u.anonymous){let e=0;(null!=(o=u.inputs)?o:[]).forEach(t=>{t.indexed&&(e+=1)}),e>0&&(null==t?void 0:t.topics)&&(null==t?void 0:t.topics.length)!==e+1&&(u=Object.assign(Object.assign({},u),{anonymous:!0,inputs:[]}))}let d=u.anonymous?t.topics:(null!=(a=t.topics)?a:[]).slice(1);return Object.assign(Object.assign({},h),{returnValues:g4([...null!=(l=u.inputs)?l:[]],t.data,d),event:u.name,signature:!u.anonymous&&(null==(c=t.topics)?void 0:c.length)>0&&t.topics[0]?t.topics[0]:void 0,raw:{data:t.data,topics:t.topics}})};var mu=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class mh{constructor({options:e,web3Context:t,promiEvent:r,returnFormat:n}){this.options={checkRevertBeforeSending:!0},this.options=e,this.web3Context=t,this.promiEvent=r,this.returnFormat=n}getReceiptWithEvents(e){var t,r;let n=Object.assign({},null!=e?e:{});if((null==(t=this.options)?void 0:t.contractAbi)&&n.logs&&n.logs.length>0)for(let e of(n.events={},n.logs)){let t=mc(f3,e,null==(r=this.options)?void 0:r.contractAbi,this.returnFormat);t.event&&(n.events[t.event]=t)}return n}checkRevertBeforeSending(e){return mu(this,void 0,void 0,function*(){if(!1!==this.options.checkRevertBeforeSending){let t=e;al(e.data)&&al(e.input)&&al(e.gas)&&(t=Object.assign(Object.assign({},e),{gas:21e3}));let r=yield mo(this.web3Context,t,this.options.contractAbi);if(void 0!==r)throw yield ml(this.web3Context,e,void 0,void 0,this.options.contractAbi,r)}})}emitSending(e){this.promiEvent.listenerCount("sending")>0&&this.promiEvent.emit("sending",e)}populateGasPrice(e){return mu(this,arguments,void 0,function*({transactionFormatted:e,transaction:t}){var r;let n=e;return!this.web3Context.config.ignoreGasPricing&&!(null==(r=this.options)?void 0:r.ignoreGasPricing)&&al(e.gasPrice)&&(al(t.maxPriorityFeePerGas)||al(t.maxFeePerGas))&&(n=Object.assign(Object.assign({},e),(yield f8(e,this.web3Context,Y)))),n})}signAndSend(e){return mu(this,arguments,void 0,function*({wallet:e,tx:t}){if(e){let r=yield e.signTransaction(t);return pc(this.web3Context,()=>mu(this,void 0,void 0,function*(){return dG(this.web3Context.requestManager,r.rawTransaction)}),r.transactionHash)}return pc(this.web3Context,()=>mu(this,void 0,void 0,function*(){return dK(this.web3Context.requestManager,t)}))})}emitSent(e){this.promiEvent.listenerCount("sent")>0&&this.promiEvent.emit("sent",e)}emitTransactionHash(e){this.promiEvent.listenerCount("transactionHash")>0&&this.promiEvent.emit("transactionHash",e)}emitReceipt(e){this.promiEvent.listenerCount("receipt")>0&&this.promiEvent.emit("receipt",e)}handleError(e){return mu(this,arguments,void 0,function*({error:e,tx:t}){var r;let n=e;return n instanceof rt&&this.web3Context.handleRevert&&(n=yield ml(this.web3Context,t,void 0,void 0,null==(r=this.options)?void 0:r.contractAbi)),(n instanceof na||n instanceof rt||n instanceof rw||n instanceof rv||n instanceof rb||n instanceof rW)&&this.promiEvent.listenerCount("error")>0&&this.promiEvent.emit("error",n),n})}emitConfirmation({receipt:e,transactionHash:t,customTransactionReceiptSchema:r}){this.promiEvent.listenerCount("confirmation")>0&&pm(this.web3Context,this.promiEvent,e,t,this.returnFormat,r)}handleResolve(e){return mu(this,arguments,void 0,function*({receipt:e,tx:t}){var r,n,i;if(null==(r=this.options)?void 0:r.transactionResolver)return null==(n=this.options)?void 0:n.transactionResolver(e);if(e.status!==BigInt(0))return e;{let r=yield ml(this.web3Context,t,e,void 0,null==(i=this.options)?void 0:i.contractAbi);throw this.promiEvent.listenerCount("error")>0&&this.promiEvent.emit("error",r),r}})}}var md=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})},mf=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r};let mp=e=>md(void 0,void 0,void 0,function*(){return dC(e.requestManager)});function mg(e,t){return md(this,void 0,void 0,function*(){return lm({format:"uint"},(yield dR(e.requestManager)),null!=t?t:e.defaultReturnFormat)})}function mm(e,t){return md(this,void 0,void 0,function*(){return lm({format:"uint"},(yield dO(e.requestManager)),null!=t?t:e.defaultReturnFormat)})}function my(e,t){return md(this,void 0,void 0,function*(){return lm({format:"uint"},(yield dN(e.requestManager)),null!=t?t:e.defaultReturnFormat)})}function mb(e,t){return md(this,void 0,void 0,function*(){return lm({format:"uint"},(yield dB(e.requestManager)),null!=t?t:e.defaultReturnFormat)})}function mw(e,t){return md(this,arguments,void 0,function*(e,t,r=e.defaultBlock,n){let i=at(r)?r:lm({format:"uint"},r,Y);return lm({format:"uint"},(yield dM(e.requestManager,t,i)),null!=n?n:e.defaultReturnFormat)})}function mv(e,t,r){return md(this,arguments,void 0,function*(e,t,r,n=e.defaultBlock,i){let s=lm({format:"uint"},r,Y),o=at(n)?n:lm({format:"uint"},n,Y);return lm({format:"bytes"},(yield dL(e.requestManager,t,s,o)),null!=i?i:e.defaultReturnFormat)})}function mE(e,t){return md(this,arguments,void 0,function*(e,t,r=e.defaultBlock,n){let i=at(r)?r:lm({format:"uint"},r,Y);return lm({format:"bytes"},(yield dq(e.requestManager,t,i)),null!=n?n:e.defaultReturnFormat)})}function mA(e){return md(this,arguments,void 0,function*(e,t=e.defaultBlock,r=!1,n){var i;let s;if(o3(t)){let n=lm({format:"bytes32"},t,Y);s=yield dJ(e.requestManager,n,r)}else{let n=at(t)?t:lm({format:"uint"},t,Y);s=yield dZ(e.requestManager,n,r)}let o=lm(fj,s,null!=n?n:e.defaultReturnFormat);return al(o)?o:Object.assign(Object.assign({},o),{transactions:null!=(i=o.transactions)?i:[]})})}function mx(e){return md(this,arguments,void 0,function*(e,t=e.defaultBlock,r){let n;if(o3(t)){let r=lm({format:"bytes32"},t,Y);n=yield dU(e.requestManager,r)}else{let r=at(t)?t:lm({format:"uint"},t,Y);n=yield dj(e.requestManager,r)}return lm({format:"uint"},n,null!=r?r:e.defaultReturnFormat)})}function mS(e){return md(this,arguments,void 0,function*(e,t=e.defaultBlock,r){let n;if(o3(t)){let r=lm({format:"bytes32"},t,Y);n=yield d$(e.requestManager,r)}else{let r=at(t)?t:lm({format:"uint"},t,Y);n=yield dH(e.requestManager,r)}return lm({format:"uint"},n,null!=r?r:e.defaultReturnFormat)})}function mk(e){return md(this,arguments,void 0,function*(e,t=e.defaultBlock,r,n){let i,s=lm({format:"uint"},r,Y);if(o3(t)){let r=lm({format:"bytes32"},t,Y);i=yield d2(e.requestManager,r,s)}else{let r=at(t)?t:lm({format:"uint"},t,Y);i=yield d3(e.requestManager,r,s)}return lm(fj,i,null!=n?n:e.defaultReturnFormat)})}function m_(e,t){return md(this,arguments,void 0,function*(e,t,r=e.defaultReturnFormat){let n=lm({format:"bytes32"},t,Z),i=yield dY(e.requestManager,n);return al(i)?i:fW(i,r,{transactionSchema:e.config.customTransactionSchema,fillInputAndData:!0})})}function mI(e,t){return md(this,void 0,void 0,function*(){return(yield fi(e.requestManager)).map(r=>fW(r,null!=t?t:e.defaultReturnFormat,{transactionSchema:e.config.customTransactionSchema,fillInputAndData:!0}))})}function mC(e){return md(this,arguments,void 0,function*(e,t=e.defaultBlock,r,n){let i,s=lm({format:"uint"},r,Y);if(o3(t)){let r=lm({format:"bytes32"},t,Y);i=yield dX(e.requestManager,r,s)}else{let r=at(t)?t:lm({format:"uint"},t,Y);i=yield d0(e.requestManager,r,s)}return al(i)?i:fW(i,null!=n?n:e.defaultReturnFormat,{transactionSchema:e.config.customTransactionSchema,fillInputAndData:!0})})}function mT(e,t,r){return md(this,void 0,void 0,function*(){let n,i=lm({format:"bytes32"},t,Z);try{n=yield d1(e.requestManager,i)}catch(e){if("object"==typeof e&&!al(e)&&"message"in e&&"transaction indexing is in progress"===e.message)console.warn("Transaction indexing is in progress.");else throw e}return al(n)?n:lm(fz,n,null!=r?r:e.defaultReturnFormat)})}function mP(e,t){return md(this,arguments,void 0,function*(e,t,r=e.defaultBlock,n){let i=at(r)?r:lm({format:"uint"},r,Y);return lm({format:"uint"},(yield dF(e.requestManager,t,i)),null!=n?n:e.defaultReturnFormat)})}function mR(e,t,r,n={checkRevertBeforeSending:!0},i){let s=new dk((o,a)=>{setImmediate(()=>{md(this,void 0,void 0,function*(){let l=new mh({web3Context:e,promiEvent:s,options:n,returnFormat:r}),c=Object.assign({},t);al(i)||(c=yield i.processTransaction(c));let u=fW(Object.assign(Object.assign({},c),{from:f9("from",e,c),to:f9("to",e,c)}),Y,{transactionSchema:e.config.customTransactionSchema});try{let t;u=yield l.populateGasPrice({transaction:c,transactionFormatted:u}),yield l.checkRevertBeforeSending(u),l.emitSending(u),e.wallet&&!al(u.from)&&(t=e.wallet.get(u.from));let n=yield l.signAndSend({wallet:t,tx:u}),i=lm({format:"bytes32"},n,null!=r?r:e.defaultReturnFormat);l.emitSent(u),l.emitTransactionHash(i);let s=yield ph(e,n,null!=r?r:e.defaultReturnFormat),a=l.getReceiptWithEvents(lm(fz,s,null!=r?r:e.defaultReturnFormat));l.emitReceipt(a),o((yield l.handleResolve({receipt:a,tx:u}))),l.emitConfirmation({receipt:a,transactionHash:n})}catch(e){a((yield l.handleError({error:e,tx:u})))}})})});return s}function mO(e,t,r,n={checkRevertBeforeSending:!0}){let i=new dk((s,o)=>{setImmediate(()=>{md(this,void 0,void 0,function*(){let a=new mh({web3Context:e,promiEvent:i,options:n,returnFormat:r}),l=lm({format:"bytes"},t,Y),c=dr.fromSerializedData(aS(aI(l))),u=Object.assign(Object.assign({},c.toJSON()),{from:c.getSenderAddress().toString()});try{let{v:t,r:n,s:i}=u,o=mf(u,["v","r","s"]);yield a.checkRevertBeforeSending(o),a.emitSending(l);let c=yield pc(e,()=>md(this,void 0,void 0,function*(){return dG(e.requestManager,l)}));a.emitSent(l);let h=lm({format:"bytes32"},c,null!=r?r:e.defaultReturnFormat);a.emitTransactionHash(h);let d=yield ph(e,c,null!=r?r:e.defaultReturnFormat),f=a.getReceiptWithEvents(lm(fz,d,null!=r?r:e.defaultReturnFormat));a.emitReceipt(f),s((yield a.handleResolve({receipt:f,tx:u}))),a.emitConfirmation({receipt:f,transactionHash:c})}catch(e){o((yield a.handleError({error:e,tx:u})))}})})});return i}function mN(e,t,r){return md(this,arguments,void 0,function*(e,t,r,n=e.defaultReturnFormat){var i;let s=lm({format:"bytes"},t,Z);if(null==(i=e.wallet)?void 0:i.get(r))return lm(fV,e.wallet.get(r).sign(s),n);if("number"==typeof r)throw new rm(t,'RPC method "eth_sign" does not support index signatures');return lm({format:"bytes"},(yield dz(e.requestManager,r,s)),n)})}function mD(e,t){return md(this,arguments,void 0,function*(e,t,r=e.defaultReturnFormat){let n=yield dV(e.requestManager,fW(t,Y,{transactionSchema:e.config.customTransactionSchema}));return oD(n)?fQ(n,r,{fillInputAndData:!0}):{raw:lm({format:"bytes"},n.raw,r),tx:fW(n.tx,r,{transactionSchema:e.config.customTransactionSchema,fillInputAndData:!0})}})}function mB(e,t){return md(this,arguments,void 0,function*(e,t,r=e.defaultBlock,n=e.defaultReturnFormat){let i=at(r)?r:lm({format:"uint"},r,Y);return lm({format:"bytes"},(yield dW(e.requestManager,fW(t,Y,{transactionSchema:e.config.customTransactionSchema}),i)),n)})}function mM(e,t){return md(this,arguments,void 0,function*(e,t,r=e.defaultBlock,n){let i=fW(t,Y,{transactionSchema:e.config.customTransactionSchema}),s=at(r)?r:lm({format:"uint"},r,Y);return lm({format:"uint"},(yield dQ(e.requestManager,i,s)),null!=n?n:e.defaultReturnFormat)})}function mL(e,t,r){return md(this,void 0,void 0,function*(){let{toBlock:n,fromBlock:i}=t;al(n)||"number"!=typeof n&&"bigint"!=typeof n||(n=aP(n)),al(i)||"number"!=typeof i&&"bigint"!=typeof i||(i=aP(i));let s=Object.assign(Object.assign({},t),{fromBlock:i,toBlock:n});return(yield fe(e.requestManager,s)).map(t=>"string"==typeof t?t:lm(fH,t,null!=r?r:e.defaultReturnFormat))})}function mF(e,t){return md(this,void 0,void 0,function*(){return lm({format:"uint"},(yield fo(e.requestManager)),null!=t?t:e.defaultReturnFormat)})}function mU(e,t,r){return md(this,arguments,void 0,function*(e,t,r,n=e.defaultBlock,i){let s=r.map(e=>lm({format:"bytes"},e,Y)),o=at(n)?n:lm({format:"uint"},n,Y);return lm(fG,(yield fa(e.requestManager,t,s,o)),null!=i?i:e.defaultReturnFormat)})}function mj(e,t){return md(this,arguments,void 0,function*(e,t,r=e.defaultBlock,n,i){let s=lm({format:"uint"},t,Y),o=at(r)?r:lm({format:"uint"},r,Y),a=lm({type:"array",items:{format:"uint"}},n,f4);return lm(fK,(yield fn(e.requestManager,s,o,a)),null!=i?i:e.defaultReturnFormat)})}function m$(e,t){return md(this,arguments,void 0,function*(e,t,r=e.defaultBlock,n){let i=at(r)?r:lm({format:"uint"},r,Y);return lm(fN,(yield fc(e.requestManager,fW(t,Y,{transactionSchema:e.config.customTransactionSchema}),i)),null!=n?n:e.defaultReturnFormat)})}function mH(e,t,r,n,i){return md(this,void 0,void 0,function*(){return lm({format:"bytes"},(yield fu(e.requestManager,t,r,n)),null!=i?i:e.defaultReturnFormat)})}var mq=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function mz(e,t){return mq(this,void 0,void 0,function*(){return lm({format:"uint"},(yield d6(e.requestManager)),null!=t?t:e.defaultReturnFormat)})}function mV(e,t,r){return mq(this,void 0,void 0,function*(){let{toBlock:n,fromBlock:i}=t;al(n)||"number"!=typeof n&&"bigint"!=typeof n||(n=aP(n)),al(i)||"number"!=typeof i&&"bigint"!=typeof i||(i=aP(i));let s=Object.assign(Object.assign({},t),{fromBlock:i,toBlock:n});return lm({format:"uint"},(yield d4(e.requestManager,s)),null!=r?r:e.defaultReturnFormat)})}function mK(e,t){return mq(this,void 0,void 0,function*(){return lm({format:"uint"},(yield d5(e.requestManager)),null!=t?t:e.defaultReturnFormat)})}function mG(e,t){return mq(this,void 0,void 0,function*(){return yield d8(e.requestManager,aP(t))})}function mW(e,t,r){return mq(this,void 0,void 0,function*(){return(yield d7(e.requestManager,aP(t))).map(t=>"string"==typeof t?t:lm(fH,t,null!=r?r:e.defaultReturnFormat))})}function mQ(e,t,r){return mq(this,void 0,void 0,function*(){return(yield d9(e.requestManager,aP(t))).map(t=>"string"==typeof t?t:lm(fH,t,null!=r?r:e.defaultReturnFormat))})}class mJ extends cv{_buildSubscriptionParams(){return["logs",this.args]}formatSubscriptionResult(e){return lm(fH,e,super.returnFormat)}}class mZ extends cv{_buildSubscriptionParams(){return["newPendingTransactions"]}formatSubscriptionResult(e){return lm({format:"string"},e,super.returnFormat)}}class mY extends cv{_buildSubscriptionParams(){return["newHeads"]}formatSubscriptionResult(e){return lm(f$,e,super.returnFormat)}}class mX extends cv{_buildSubscriptionParams(){return["syncing"]}_processSubscriptionResult(e){if("boolean"==typeof e)this.emit("changed",e);else{let t=Object.fromEntries(Object.entries((null==e?void 0:e.status)||e).map(([e,t])=>[e.charAt(0).toLowerCase()+e.substring(1),t]));this.emit("changed",e.syncing),this.emit("data",lm(fq,t,super.returnFormat))}}}var m0=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let m1={logs:mJ,newPendingTransactions:mZ,newHeads:mY,syncing:mX,pendingTransactions:mZ,newBlockHeaders:mY};class m2 extends dA{constructor(e){if("string"==typeof e||cd(e))return void super({provider:e,registeredSubscriptions:m1});if(e.registeredSubscriptions)return void super(e);super(Object.assign(Object.assign({},e),{registeredSubscriptions:m1})),this.getFeeData=this.calculateFeeData}setTransactionMiddleware(e){this.transactionMiddleware=e}getTransactionMiddleware(){return this.transactionMiddleware}getProtocolVersion(){return m0(this,void 0,void 0,function*(){return dI(this.requestManager)})}isSyncing(){return m0(this,void 0,void 0,function*(){return dC(this.requestManager)})}getCoinbase(){return m0(this,void 0,void 0,function*(){return dT(this.requestManager)})}isMining(){return m0(this,void 0,void 0,function*(){return dP(this.requestManager)})}getHashrate(e){return m0(this,void 0,void 0,function*(){var t;return void 0===e&&(e=null!=(t=this.defaultReturnFormat)?t:Z),this.getHashRate(e)})}getHashRate(){return m0(this,arguments,void 0,function*(e=this.defaultReturnFormat){return mg(this,e)})}getGasPrice(){return m0(this,arguments,void 0,function*(e=this.defaultReturnFormat){return mm(this,e)})}getMaxPriorityFeePerGas(){return m0(this,arguments,void 0,function*(e=this.defaultReturnFormat){return my(this,e)})}calculateFeeData(){return m0(this,arguments,void 0,function*(e=BigInt(2),t=aA.Gwei){var r;let n,i,s,o=yield this.getBlock(void 0,!1),a=null!=(r=null==o?void 0:o.baseFeePerGas)?r:void 0;try{n=yield this.getGasPrice()}catch(e){}try{i=yield this.getMaxPriorityFeePerGas()}catch(e){}if(a){let r;i=null!=i?i:t,s=a*(r="number"==typeof e?BigInt(Math.floor(1e3*e))/BigInt(1e3):e)+i}return{gasPrice:n,maxFeePerGas:s,maxPriorityFeePerGas:i,baseFeePerGas:a}})}getAccounts(){return m0(this,void 0,void 0,function*(){var e;return(null!=(e=yield dD(this.requestManager))?e:[]).map(e=>aQ(e))})}getBlockNumber(){return m0(this,arguments,void 0,function*(e=this.defaultReturnFormat){return mb(this,e)})}getBalance(e){return m0(this,arguments,void 0,function*(e,t=this.defaultBlock,r=this.defaultReturnFormat){return mw(this,e,t,r)})}getStorageAt(e,t){return m0(this,arguments,void 0,function*(e,t,r=this.defaultBlock,n=this.defaultReturnFormat){return mv(this,e,t,r,n)})}getCode(e){return m0(this,arguments,void 0,function*(e,t=this.defaultBlock,r=this.defaultReturnFormat){return mE(this,e,t,r)})}getBlock(){return m0(this,arguments,void 0,function*(e=this.defaultBlock,t=!1,r=this.defaultReturnFormat){return mA(this,e,t,r)})}getBlockTransactionCount(){return m0(this,arguments,void 0,function*(e=this.defaultBlock,t=this.defaultReturnFormat){return mx(this,e,t)})}getBlockUncleCount(){return m0(this,arguments,void 0,function*(e=this.defaultBlock,t=this.defaultReturnFormat){return mS(this,e,t)})}getUncle(){return m0(this,arguments,void 0,function*(e=this.defaultBlock,t,r=this.defaultReturnFormat){return mk(this,e,t,r)})}getTransaction(e){return m0(this,arguments,void 0,function*(e,t=this.defaultReturnFormat){let r=yield m_(this,e,t);if(!r)throw new rA;return r})}getPendingTransactions(){return m0(this,arguments,void 0,function*(e=this.defaultReturnFormat){return mI(this,e)})}getTransactionFromBlock(){return m0(this,arguments,void 0,function*(e=this.defaultBlock,t,r=this.defaultReturnFormat){return mC(this,e,t,r)})}getTransactionReceipt(e){return m0(this,arguments,void 0,function*(e,t=this.defaultReturnFormat){let r=yield mT(this,e,t);if(!r)throw new rA;return r})}getTransactionCount(e){return m0(this,arguments,void 0,function*(e,t=this.defaultBlock,r=this.defaultReturnFormat){return mP(this,e,t,r)})}sendTransaction(e,t=this.defaultReturnFormat,r){return mR(this,e,t,r,this.transactionMiddleware)}sendSignedTransaction(e,t=this.defaultReturnFormat,r){return mO(this,e,t,r)}sign(e,t){return m0(this,arguments,void 0,function*(e,t,r=this.defaultReturnFormat){return mN(this,e,t,r)})}signTransaction(e){return m0(this,arguments,void 0,function*(e,t=this.defaultReturnFormat){return mD(this,e,t)})}call(e){return m0(this,arguments,void 0,function*(e,t=this.defaultBlock,r=this.defaultReturnFormat){return mB(this,e,t,r)})}estimateGas(e){return m0(this,arguments,void 0,function*(e,t=this.defaultBlock,r=this.defaultReturnFormat){return mM(this,e,t,r)})}getPastLogs(e){return m0(this,arguments,void 0,function*(e,t=this.defaultReturnFormat){return mL(this,e,t)})}getWork(){return m0(this,void 0,void 0,function*(){return ft(this.requestManager)})}submitWork(e,t,r){return m0(this,void 0,void 0,function*(){return fr(this.requestManager,e,t,r)})}requestAccounts(){return m0(this,void 0,void 0,function*(){return fs(this.requestManager)})}getChainId(){return m0(this,arguments,void 0,function*(e=this.defaultReturnFormat){return mF(this,e)})}getNodeInfo(){return m0(this,void 0,void 0,function*(){return fl(this.requestManager)})}getProof(e,t){return m0(this,arguments,void 0,function*(e,t,r=this.defaultBlock,n=this.defaultReturnFormat){return mU(this,e,t,r,n)})}getFeeHistory(e){return m0(this,arguments,void 0,function*(e,t=this.defaultBlock,r,n=this.defaultReturnFormat){return mj(this,e,t,r,n)})}createAccessList(e){return m0(this,arguments,void 0,function*(e,t=this.defaultBlock,r=this.defaultReturnFormat){return m$(this,e,t,r)})}signTypedData(e,t,r,n){return m0(this,void 0,void 0,function*(){var i;return void 0===r&&(r=!1),void 0===n&&(n=null!=(i=this.defaultReturnFormat)?i:Z),mH(this,e,t,r,n)})}subscribe(e,t,r){return m0(this,void 0,void 0,function*(){var n,i;void 0===r&&(r=null!=(n=this.defaultReturnFormat)?n:Z);let s=yield null==(i=this.subscriptionManager)?void 0:i.subscribe(e,t,r);return s instanceof mJ&&"logs"===e&&"object"==typeof t&&!lt(t.fromBlock)&&Number.isFinite(Number(t.fromBlock))&&setImmediate(()=>{this.getPastLogs(t).then(e=>{for(let t of e)s._processSubscriptionResult(t)}).catch(e=>{s._processSubscriptionError(e)})}),s})}static shouldClearSubscription({sub:e}){return!(e instanceof mX)}clearSubscriptions(e=!1){var t;return null==(t=this.subscriptionManager)?void 0:t.unsubscribe(e?m2.shouldClearSubscription:void 0)}createNewPendingTransactionFilter(){return m0(this,arguments,void 0,function*(e=this.defaultReturnFormat){return mz(this,e)})}createNewFilter(e){return m0(this,arguments,void 0,function*(e,t=this.defaultReturnFormat){return mV(this,e,t)})}createNewBlockFilter(){return m0(this,arguments,void 0,function*(e=this.defaultReturnFormat){return mK(this,e)})}uninstallFilter(e){return m0(this,void 0,void 0,function*(){return mG(this,e)})}getFilterChanges(e){return m0(this,arguments,void 0,function*(e,t=this.defaultReturnFormat){return mW(this,e,t)})}getFilterLogs(e){return m0(this,arguments,void 0,function*(e,t=this.defaultReturnFormat){return mQ(this,e,t)})}}function m3(e){return(!!isNullish(e.to)||!!isAddress(e.to))&&(!!isHexStrict(e.type)||!!isNullish(e.type)||2===e.type.length)&&!!isHexStrict(e.nonce)&&!!isHexStrict(e.gas)&&!!isHexStrict(e.value)&&!!isHexStrict(e.input)&&(!e.chainId||!!isHexStrict(e.chainId))&&!0}function m4(e){return(!!isNullish(e.address)||!!isAddress(e.address))&&(!!isNullish(e.storageKeys)||!!e.storageKeys.every(e=>isHexString32Bytes(e)))}function m5(e){return!!Array.isArray(e)&&!!e.every(e=>m4(e))}function m6(e){return!!m3(e)&&!!isHexStrict(e.maxFeePerGas)&&!!isHexStrict(e.maxPriorityFeePerGas)&&!!m5(e.accessList)}function m8(e){return!!m3(e)&&!!isHexStrict(e.gasPrice)&&!!m5(e.accessList)}function m7(e){return!!m3(e)&&!!isHexStrict(e.gasPrice)}let m9=e=>{if(!al(e.common)){if(al(e.common.customChain))throw new rk;if(al(e.common.customChain.chainId))throw new r_;if(!al(e.chainId)&&e.chainId!==e.common.customChain.chainId)throw new rI({txChainId:e.chainId,customChainId:e.common.customChain.chainId})}},ye=e=>{if(!al(e.common)&&!al(e.chain)&&!al(e.hardfork))throw new rP;if(!al(e.chain)&&al(e.hardfork)||!al(e.hardfork)&&al(e.chain))throw new rR({chain:e.chain,hardfork:e.hardfork})},yt=e=>{if(!al(e.common)&&!al(e.common.baseChain)&&!al(e.chain)&&e.chain!==e.common.baseChain)throw new rC({txChain:e.chain,baseChain:e.common.baseChain})},yr=e=>{if(!al(e.common)&&!al(e.common.hardfork)&&!al(e.hardfork)&&e.hardfork!==e.common.hardfork)throw new rT({txHardfork:e.hardfork,commonHardfork:e.common.hardfork})},yn=e=>{if(al(e.gas)||!o8(e.gas)||al(e.gasPrice)||!o8(e.gasPrice))throw new rM({gas:e.gas,gasPrice:e.gasPrice});if(!al(e.maxFeePerGas)||!al(e.maxPriorityFeePerGas))throw new rU({maxFeePerGas:e.maxFeePerGas,maxPriorityFeePerGas:e.maxPriorityFeePerGas})},yi=e=>{if(!al(e.gasPrice)&&"0x2"===e.type)throw new rF(e.gasPrice);if("0x0"===e.type||"0x1"===e.type)throw new rU({maxFeePerGas:e.maxFeePerGas,maxPriorityFeePerGas:e.maxPriorityFeePerGas});if(al(e.maxFeePerGas)||!o8(e.maxFeePerGas)||al(e.maxPriorityFeePerGas)||!o8(e.maxPriorityFeePerGas))throw new rL({maxPriorityFeePerGas:e.maxPriorityFeePerGas,maxFeePerGas:e.maxFeePerGas})},ys=e=>{let t=!al(e.gas)||!al(e.gasLimit),r=t&&!al(e.gasPrice),n=t&&!al(e.maxPriorityFeePerGas)&&!al(e.maxFeePerGas);if(!r&&!n)throw new rN({gas:e.gas,gasPrice:e.gasPrice,maxPriorityFeePerGas:e.maxPriorityFeePerGas,maxFeePerGas:e.maxFeePerGas});if(r&&n)throw new rB({gas:e.gas,gasPrice:e.gasPrice,maxPriorityFeePerGas:e.maxPriorityFeePerGas,maxFeePerGas:e.maxFeePerGas});(r?yn:yi)(e),(!al(e.type)&&e.type>"0x1"?yi:yn)(e)},yo=(e,t,r={transactionSchema:void 0})=>{if(!al(t))return void t(e);if("object"!=typeof e||al(e))throw new rj(e);m9(e),ye(e),yt(e),yr(e);let n=fW(e,Y,{transactionSchema:r.transactionSchema});if(ys(n),al(n.nonce)||al(n.chainId)||n.nonce.startsWith("-")||n.chainId.startsWith("-"))throw new r$({nonce:e.nonce,chainId:e.chainId})};var ya=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let yl=e=>{var t,r;return Object.assign(Object.assign({},e),{nonce:e.nonce,gasPrice:e.gasPrice,gasLimit:null!=(t=e.gasLimit)?t:e.gas,to:e.to,value:e.value,data:null!=(r=e.data)?r:e.input,type:e.type,chainId:e.chainId,accessList:e.accessList,maxPriorityFeePerGas:e.maxPriorityFeePerGas,maxFeePerGas:e.maxFeePerGas})},yc=(e,t)=>{var r,n,i,s,o,a,l,c,u,h,d,f,p,g,m,y,b,w;let v;if((al(e.chain)||al(e.hardfork))&&al(e.common))t.defaultCommon?(al((v=Object.assign({},t.defaultCommon)).hardfork)&&(v.hardfork=null!=(r=e.hardfork)?r:t.defaultHardfork),al(v.baseChain)&&(v.baseChain=t.defaultChain)):v=hK.custom({name:"custom-network",chainId:aV(e.chainId),networkId:al(e.networkId)?void 0:aV(e.networkId),defaultHardfork:null!=(n=e.hardfork)?n:t.defaultHardfork},{baseChain:t.defaultChain});else{let r=null!=(a=null!=(o=null==(s=null==(i=null==e?void 0:e.common)?void 0:i.customChain)?void 0:s.name)?o:e.chain)?a:"custom-network",n=aV(null!=(u=null==(c=null==(l=null==e?void 0:e.common)?void 0:l.customChain)?void 0:c.chainId)?u:null==e?void 0:e.chainId),E=aV(null!=(f=null==(d=null==(h=null==e?void 0:e.common)?void 0:h.customChain)?void 0:d.networkId)?f:null==e?void 0:e.networkId),A=null!=(m=null!=(g=null==(p=null==e?void 0:e.common)?void 0:p.hardfork)?g:null==e?void 0:e.hardfork)?m:t.defaultHardfork,x=null!=(w=null!=(b=null==(y=e.common)?void 0:y.baseChain)?b:e.chain)?w:t.defaultChain;n&&E&&r&&(v=hK.custom({name:r,chainId:n,networkId:E,defaultHardfork:A},{baseChain:x}))}return{common:v}},yu=(e,t,r,...n)=>ya(void 0,[e,t,r,...n],void 0,function*(e,t,r,n=!1,i=!0){let s=fW((yield pn({transaction:e,web3Context:t,privateKey:r,fillGasPrice:n,fillGasLimit:i})),Y,{transactionSchema:t.config.customTransactionSchema});return yo(s,void 0,{transactionSchema:t.config.customTransactionSchema}),dr.fromTxData(yl(s),yc(s,t))}),yh=({address:e},t,r)=>{var n,i;let s=null==r?void 0:r.topics,o=null!=(n=null==r?void 0:r.filter)?n:{},a={};if(lt(null==r?void 0:r.fromBlock)||(a.fromBlock=lm(fj.properties.number,null==r?void 0:r.fromBlock,{number:E.HEX,bytes:A.HEX})),lt(null==r?void 0:r.toBlock)||(a.toBlock=lm(fj.properties.number,null==r?void 0:r.toBlock,{number:E.HEX,bytes:A.HEX})),s&&Array.isArray(s))a.topics=[...s];else if(a.topics=[],!t||t.anonymous||[f2,"allEvents"].includes(t.name)||a.topics.push(null!=(i=t.signature)?i:pC(p_(t))),![f2,"allEvents"].includes(t.name)&&t.inputs)for(let e of t.inputs){if(!e.indexed)continue;let t=o[e.name];if(!t){a.topics.push(null);continue}Array.isArray(t)?a.topics.push(t.map(t=>gW(e.type,t))):"string"===e.type?a.topics.push(lb(t)):a.topics.push(gW(e.type,t))}return a.topics.length||delete a.topics,e&&(a.address=e.toLowerCase()),a},yd=(e,t,r)=>{let n,i=Array.isArray(e.inputs)?e.inputs.length:0;if(e.inputs&&i!==t.length)throw new t7(`The number of arguments is not matching the methods required number. You need to pass ${i} arguments.`);if(n=e.inputs?gK(Array.isArray(e.inputs)?e.inputs:[],t).replace("0x",""):gG(t).replace("0x",""),pv(e)){if(!r)throw new t7("The contract has no contract data option set. This is necessary to append the constructor parameters.");return r.startsWith("0x")?`${r}${n}`:`0x${r}${n}`}return`${gY(e)}${n}`};class yf extends cv{constructor(e,t){super(e,t),this.address=e.address,this.topics=e.topics,this.abi=e.abi,this.jsonInterface=e.jsonInterface}_buildSubscriptionParams(){return["logs",{address:this.address,topics:this.topics}]}formatSubscriptionResult(e){return mc(this.abi,e,this.jsonInterface,super.returnFormat)}}function yp(e,t,r){if(r>e.length)throw Error("invalid RLP (safeSlice): end slice of Uint8Array out-of-bounds");return e.slice(t,r)}function yg(e){if(0===e[0])throw Error("invalid RLP: extra zeros");return yb(yy(e))}let ym=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function yy(e){let t="";for(let r=0;r<e.length;r++)t+=ym[e[r]];return t}function yb(e){let t=Number.parseInt(e,16);if(Number.isNaN(t))throw Error("Invalid byte sequence");return t}function yw(e){if("string"!=typeof e)throw TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw Error("hexToBytes: received invalid unpadded hex");let t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){let n=2*r;t[r]=yb(e.slice(n,n+2))}return t}function yv(e){return new TextEncoder().encode(e)}function yE(e){if(e<0)throw Error("Invalid integer as argument, must be unsigned!");let t=e.toString(16);return t.length%2?`0${t}`:t}function yA(e){return e.length%2?`0${e}`:e}function yx(e){return e.length>=2&&"0"===e[0]&&"x"===e[1]}function yS(e){return"string"!=typeof e?e:yx(e)?e.slice(2):e}let yk=(e,t,r,n)=>{var i,s;let o={};return lt(e.data)&&"both"!==n||(o.data=yd(t,r,null!=(i=e.data)?i:e.input)),lt(e.input)&&"both"!==n||(o.input=yd(t,r,null!=(s=e.input)?s:e.data)),lt(o.input)&&lt(o.data)&&(o[n]=yd(t,r)),{data:o.data,input:o.input}},y_=({abi:e,params:t,options:r,contractOptions:n})=>{var i,s,o;if(!(null!=(o=null!=(s=null!=(i=null==r?void 0:r.input)?i:null==r?void 0:r.data)?s:n.input)?o:n.data)&&!(null==r?void 0:r.to)&&!n.address)throw new t7("Contract address not specified");if(!(null==r?void 0:r.from)&&!n.from)throw new t7('Contract "from" address not specified');let a=ln({to:n.address,gas:n.gas,gasPrice:n.gasPrice,from:n.from,input:n.input,maxPriorityFeePerGas:n.maxPriorityFeePerGas,maxFeePerGas:n.maxFeePerGas,data:n.data},r),l=yk(a,e,t,null==r?void 0:r.dataInputFill);return Object.assign(Object.assign({},a),{data:l.data,input:l.input})},yI=({abi:e,params:t,options:r,contractOptions:n})=>{if(!(null==r?void 0:r.to)&&!n.address)throw new t7("Contract address not specified");let i=ln({to:n.address,gas:n.gas,gasPrice:n.gasPrice,from:n.from,input:n.input,maxPriorityFeePerGas:n.maxPriorityFeePerGas,maxFeePerGas:n.maxFeePerGas,data:n.data},r),s=yk(i,e,t,null==r?void 0:r.dataInputFill);return Object.assign(Object.assign({},i),{data:s.data,input:s.input})},yC=({abi:e,params:t,options:r,contractOptions:n})=>{let i=ln({to:n.address,gas:n.gas,gasPrice:n.gasPrice,from:n.from,input:n.input,data:n.data},r),s=yk(i,e,t,null==r?void 0:r.dataInputFill);return Object.assign(Object.assign({},i),{data:s.data,input:s.input})},yT=e=>"object"==typeof e&&!lt(e)&&0!==Object.keys(e).length&&!le(e),yP=({abi:e,params:t,options:r,contractOptions:n})=>{if(!(null==r?void 0:r.to)&&!n.address)throw new t7("Contract address not specified");if(!(null==r?void 0:r.from)&&!n.from)throw new t7('Contract "from" address not specified');let i=ln({to:n.address,gas:n.gas,gasPrice:n.gasPrice,from:n.from,input:n.input,maxPriorityFeePerGas:n.maxPriorityFeePerGas,maxFeePerGas:n.maxFeePerGas,data:n.data},r),s=yk(i,e,t,null==r?void 0:r.dataInputFill);return Object.assign(Object.assign({},i),{data:s.data,input:s.input})};var yR=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class yO{_contractMethodDeploySend(e){let t={transactionResolver:e=>{if(e.status===BigInt(0))throw new t7("code couldn't be stored",e);let t=this.parent.clone();return t.options.address=e.contractAddress,t},contractAbi:this.parent.options.jsonInterface,checkRevertBeforeSending:!1};return al(this.parent.getTransactionMiddleware())?mR(this.parent,e,this.parent.defaultReturnFormat,t):mR(this.parent,e,this.parent.defaultReturnFormat,t,this.parent.getTransactionMiddleware())}constructor(e,t){this.parent=e,this.deployOptions=t;let{args:r,abi:n,contractOptions:i,deployData:s}=this.calculateDeployParams();this.args=r,this.constructorAbi=n,this.contractOptions=i,this.deployData=s}send(e){let t=Object.assign({},e),r=this.populateTransaction(t);return this._contractMethodDeploySend(r)}populateTransaction(e){var t,r;let n=Object.assign(Object.assign({},this.contractOptions),{from:null!=(r=null!=(t=this.contractOptions.from)?t:this.parent.defaultAccount)?r:void 0}),i=y_({abi:this.constructorAbi,params:this.args,options:Object.assign(Object.assign({},e),{dataInputFill:this.parent.contractDataInputFill}),contractOptions:n});return i.dataInputFill&&delete i.dataInputFill,i}calculateDeployParams(){var e,t,r,n,i,s;let o=this.parent.options.jsonInterface.find(e=>"constructor"===e.type);o||(o={type:"constructor",stateMutability:""});let a=lm({format:"bytes"},null!=(t=null==(e=this.deployOptions)?void 0:e.input)?t:this.parent.options.input,Z),l=lm({format:"bytes"},null!=(n=null==(r=this.deployOptions)?void 0:r.data)?n:this.parent.options.data,Z);if((!a||"0x"===a.trim())&&(!l||"0x"===l.trim()))throw new t7("contract creation without any data provided.");let c=null!=(s=null==(i=this.deployOptions)?void 0:i.arguments)?s:[];return{args:c,abi:o,contractOptions:Object.assign(Object.assign({},this.parent.options),{input:a,data:l}),deployData:null!=a?a:l}}estimateGas(e){return yR(this,arguments,void 0,function*(e,t=this.parent.defaultReturnFormat){let r=Object.assign({},e);return this.parent.contractMethodEstimateGas({abi:this.constructorAbi,params:this.args,returnFormat:t,options:r,contractOptions:this.contractOptions})})}encodeABI(){return yd(this.constructorAbi,this.args,lm({format:"bytes"},this.deployData,this.parent.defaultReturnFormat))}decodeData(e){return Object.assign(Object.assign({},g0(this.constructorAbi,e.replace(this.deployData,""),!1)),{__method__:this.constructorAbi.type})}}var yN=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class yD extends cb{constructor(e,t){super(e.requestManager,e.registeredSubscriptions),this.parentContract=t}subscribe(e,t){let r=Object.create(null,{subscribe:{get:()=>super.subscribe}});return yN(this,arguments,void 0,function*(e,t,n=Z){return r.subscribe.call(this,e,null!=t?t:this.parentContract.options,n)})}}var yB=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let yM={logs:yf,newHeads:mY,newBlockHeaders:mY};class yL extends dA{get subscriptionManager(){return this._subscriptionManager}constructor(e,t,r,n,i){var s,o,a;let l,c,u=le(t)?t:le(r)?r:void 0;if(super(Object.assign(Object.assign({},l=yT(t)?t:yT(r)?r:n),{provider:c="object"==typeof t&&"provider"in t?t.provider:"object"==typeof r&&"provider"in r?r.provider:"object"==typeof n&&"provider"in n?n.provider:yL.givenProvider,registeredSubscriptions:yM})),this.syncWithContext=!1,this._functions={},this._subscriptionManager=new yD(super.subscriptionManager,this),(null==l?void 0:l.wallet)&&(this._wallet=l.wallet),(null==l?void 0:l.accountProvider)&&(this._accountProvider=l.accountProvider),!al(u)&&!al(u.data)&&!al(u.input)&&"both"!==this.config.contractDataInputFill)throw new rr({data:u.data,input:u.input});this._overloadedMethodAbis=new Map;let h=lh(n)?n:lh(r)?r:null!=i?i:this.defaultReturnFormat,d="string"==typeof t?t:void 0;this.config.contractDataInputFill=null!=(s=null==u?void 0:u.dataInputFill)?s:this.config.contractDataInputFill,this._parseAndSetJsonInterface(e,h),this.defaultReturnFormat!==h&&(this.defaultReturnFormat=h),al(d)||this._parseAndSetAddress(d,h),this.options={address:d,jsonInterface:this._jsonInterface,gas:null!=(o=null==u?void 0:u.gas)?o:null==u?void 0:u.gasLimit,gasPrice:null==u?void 0:u.gasPrice,from:null==u?void 0:u.from,input:null==u?void 0:u.input,data:null==u?void 0:u.data},this.syncWithContext=null!=(a=null==u?void 0:u.syncWithContext)&&a,l instanceof dA&&this.subscribeToContextEvents(l),Object.defineProperty(this.options,"address",{set:e=>this._parseAndSetAddress(e,h),get:()=>this._address}),Object.defineProperty(this.options,"jsonInterface",{set:e=>this._parseAndSetJsonInterface(e,h),get:()=>this._jsonInterface}),l instanceof dA&&l.on(O.CONFIG_CHANGE,e=>{this.setConfig({[e.name]:e.newValue})})}setTransactionMiddleware(e){this.transactionMiddleware=e}getTransactionMiddleware(){return this.transactionMiddleware}get events(){return this._events}get methods(){return this._methods}clone(){let e;return e=this.options.address?new yL([...this._jsonInterface,...this._errorsInterface],this.options.address,{gas:this.options.gas,gasPrice:this.options.gasPrice,from:this.options.from,input:this.options.input,data:this.options.data,provider:this.currentProvider,syncWithContext:this.syncWithContext,dataInputFill:this.config.contractDataInputFill},this.getContextObject()):new yL([...this._jsonInterface,...this._errorsInterface],{gas:this.options.gas,gasPrice:this.options.gasPrice,from:this.options.from,input:this.options.input,data:this.options.data,provider:this.currentProvider,syncWithContext:this.syncWithContext,dataInputFill:this.config.contractDataInputFill},this.getContextObject()),this.context&&e.subscribeToContextEvents(this.context),e}deploy(e){return new yO(this,e)}getPastEvents(e,t,r){return yB(this,void 0,void 0,function*(){var n;let i="string"==typeof e?e:f2,s="string"==typeof e||lh(e)?lh(t)?{}:t:e,o=lh(e)?e:lh(t)?t:null!=r?r:this.defaultReturnFormat,a="allEvents"===i||i===f2?f3:this._jsonInterface.find(e=>"name"in e&&e.name===i);if(!a)throw new t7(`Event ${String(i)} not found.`);let{fromBlock:l,toBlock:c,topics:u,address:h}=yh(this.options,a,null!=s?s:{}),d=yield mL(this,{fromBlock:l,toBlock:c,topics:u,address:h},o),f=d?d.map(e=>"string"==typeof e?e:mc(a,e,this._jsonInterface,o)):[],p=null!=(n=null==s?void 0:s.filter)?n:{},g=Object.keys(p);return g.length>0?f.filter(e=>"string"==typeof e||g.every(t=>{var r;if(Array.isArray(p[t]))return p[t].some(r=>String(e.returnValues[t]).toUpperCase()===String(r).toUpperCase());let n=null==(r=a.inputs)?void 0:r.filter(e=>e.name===t)[0];return(null==n?!!void 0:!!n.indexed)&&"string"===n.type&&lb(p[t])===String(e.returnValues[t])||String(e.returnValues[t]).toUpperCase()===String(p[t]).toUpperCase()})):f})}_parseAndSetAddress(e,t=this.defaultReturnFormat){this._address=e?aQ(lm({format:"address"},e,t)):e}decodeMethodData(e){let t=e.slice(0,10),r=this._jsonInterface.filter(e=>"error"!==e.type).find(e=>t===gY(p_(e)));if(!r)throw new t7(`The ABI for the provided method signature ${t} was not found.`);return g0(r,e)}_parseAndSetJsonInterface(e,t=this.defaultReturnFormat){var r,n;this._functions={},this._methods={},this._events={};let i=[],s=e.filter(e=>"error"!==e.type),o=e.filter(e=>py(e));for(let e of s){let s=Object.assign(Object.assign({},e),{signature:""});if(pw(s)){let e=p_(s),t=gY(e);s.methodNameWithInputs=e,s.signature=t,s.constant="view"===s.stateMutability||"pure"===s.stateMutability||s.constant,s.payable="payable"===s.stateMutability||s.payable,this._overloadedMethodAbis.set(s.name,[...null!=(r=this._overloadedMethodAbis.get(s.name))?r:[],s]);let i=null!=(n=this._overloadedMethodAbis.get(s.name))?n:[],a=this._createContractMethod(i,o),l=this._createContractMethod(i,o,!0);this._functions[e]={signature:t,method:l},this._methods[s.name]=a,this._methods[e]=l,this._methods[t]=l}else if(pb(s)){let e=p_(s),r=pC(e),n=this._createContractEvent(s,t);s.signature=r,e in this._events&&"bound"!==s.name||(this._events[e]=n),this._events[s.name]=n,this._events[r]=n}i=[...i,s]}this._events.allEvents=this._createContractEvent(f3,t),this._jsonInterface=[...i],this._errorsInterface=o}_getAbiParams(e,t){var r;try{return oK(null!=(r=e.inputs)?r:[],t)}catch(t){throw new t7(`Invalid parameters for method ${e.name}: ${t.message}`)}}_createContractMethod(e,t,r=!1){let n=e[e.length-1];return(...e)=>{var i,s,o;let a,l=null!=(s=r?null==(i=this._overloadedMethodAbis.get(n.name))?void 0:i.filter(e=>e.signature===n.signature):this._overloadedMethodAbis.get(n.name))?s:[],c=l[0],u=t,h=l.filter(t=>{var r;return(null!=(r=t.inputs)?r:[]).length===e.length});if(1===l.length||0===h.length)a=this._getAbiParams(c,e),ab.validate(null!=(o=n.inputs)?o:[],a);else{let t=[],r=[];for(let n of h)try{a=this._getAbiParams(n,e),ab.validate(n.inputs,a),r.push(n)}catch(e){t.push(e)}if(1===r.length?[c]=r:r.length>1&&([c]=r,console.warn(`Multiple methods found that is compatible with the given inputs.
	Found ${r.length} compatible methods: ${JSON.stringify(r.map(e=>`${e.methodNameWithInputs} (signature: ${e.signature})`))} 
	The first one will be used: ${c.methodNameWithInputs}`)),t.length===h.length)throw new oR(t)}let d={arguments:a,call:(e,t)=>yB(this,void 0,void 0,function*(){return this._contractMethodCall(c,a,u,e,t)}),send:e=>this._contractMethodSend(c,a,u,e),populateTransaction:(t,r)=>{var i,s;let o=null!=r?r:this.options;o=Object.assign(Object.assign({},o),{input:void 0,from:null!=(s=null!=(i=null==o?void 0:o.from)?i:this.defaultAccount)?s:void 0});let a=y_({abi:n,params:e,options:Object.assign(Object.assign({},t),{dataInputFill:this.config.contractDataInputFill}),contractOptions:o});return a.dataInputFill&&delete a.dataInputFill,a},estimateGas:(e,...t)=>yB(this,[e,...t],void 0,function*(e,t=this.defaultReturnFormat){return this.contractMethodEstimateGas({abi:c,params:a,returnFormat:t,options:e})}),encodeABI:()=>yd(c,a),decodeData:e=>g0(c,e),createAccessList:(e,t)=>yB(this,void 0,void 0,function*(){return this._contractMethodCreateAccessList(c,a,u,e,t)})};return c.stateMutability,d}}_contractMethodCall(e,t,r,n,i){return yB(this,void 0,void 0,function*(){var s;let o=yI({abi:e,params:t,options:Object.assign(Object.assign({},n),{dataInputFill:this.config.contractDataInputFill}),contractOptions:Object.assign(Object.assign({},this.options),{from:null!=(s=this.options.from)?s:this.config.defaultAccount})});try{let t=yield mB(this,o,i,this.defaultReturnFormat);return g1(e,t)}catch(e){throw e instanceof rt&&g5(r,e.cause),e}})}_contractMethodCreateAccessList(e,t,r,n,i){return yB(this,void 0,void 0,function*(){var s;let o=yP({abi:e,params:t,options:Object.assign(Object.assign({},n),{dataInputFill:this.config.contractDataInputFill}),contractOptions:Object.assign(Object.assign({},this.options),{from:null!=(s=this.options.from)?s:this.config.defaultAccount})});try{return m$(this,o,i,this.defaultReturnFormat)}catch(e){throw e instanceof rt&&g5(r,e.cause),e}})}_contractMethodSend(e,t,r,n,i){var s,o;let a=null!=i?i:this.options;a=Object.assign(Object.assign({},a),{input:void 0,from:null!=(o=null!=(s=a.from)?s:this.defaultAccount)?o:void 0});let l=y_({abi:e,params:t,options:Object.assign(Object.assign({},n),{dataInputFill:this.config.contractDataInputFill}),contractOptions:a}),c=al(this.transactionMiddleware)?mR(this,l,this.defaultReturnFormat,{checkRevertBeforeSending:!1,contractAbi:this._jsonInterface}):mR(this,l,this.defaultReturnFormat,{checkRevertBeforeSending:!1,contractAbi:this._jsonInterface},this.transactionMiddleware);return c.on("error",e=>{e instanceof rt&&g5(r,e.cause)}),c}contractMethodEstimateGas(e){return yB(this,arguments,void 0,function*({abi:e,params:t,returnFormat:r,options:n,contractOptions:i}){return mM(this,yC({abi:e,params:t,options:Object.assign(Object.assign({},n),{dataInputFill:this.config.contractDataInputFill}),contractOptions:null!=i?i:this.options}),x.LATEST,null!=r?r:this.defaultReturnFormat)})}_createContractEvent(e,t=this.defaultReturnFormat){return(...r)=>{var n;let{topics:i,fromBlock:s}=yh(this.options,e,r[0]),o=new yf({address:this.options.address,topics:i,abi:e,jsonInterface:this._jsonInterface},{subscriptionManager:this.subscriptionManager,returnFormat:t});return al(s)||this.getPastEvents(e.name,{fromBlock:s,topics:i},t).then(e=>{e&&e.forEach(e=>o.emit("data",e))}).catch(e=>{o.emit("error",new rp("Failed to get past events.",e))}),null==(n=this.subscriptionManager)||n.addSubscription(o).catch(e=>{o.emit("error",new rp("Failed to subscribe.",e))}),o}}subscribeToContextEvents(e){let t=this;this.context=e,t.syncWithContext&&e.on(O.CONFIG_CHANGE,e=>{t.setConfig({[e.name]:e.newValue})})}}let yF=yL,yU={addr:"0x3b3b57de",name:"0x691f3431",abi:"0x2203ab56",pubkey:"0xc8690233",text:"0x59d1d43c",contenthash:"0xbc1c58d1"},yj={setAddr:"addr",addr:"addr",pubkey:"pubkey",contenthash:"contenthash",text:"text",name:"name"},y$={main:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",goerli:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},yH={"0x1":"main","0x5":"goerli"},yq=[{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"label",type:"bytes32"},{indexed:!1,internalType:"address",name:"owner",type:"address"}],name:"NewOwner",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"address",name:"resolver",type:"address"}],name:"NewResolver",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"address",name:"owner",type:"address"}],name:"Transfer",type:"event"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"}],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"}],name:"recordExists",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"}],name:"resolver",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"}],name:"ttl",outputs:[{internalType:"uint64",name:"",type:"uint64"}],stateMutability:"view",type:"function"}],yz=[{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"address",name:"a",type:"address"}],name:"AddrChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"coinType",type:"uint256"},{indexed:!1,internalType:"bytes",name:"newAddress",type:"bytes"}],name:"AddressChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"bytes",name:"hash",type:"bytes"}],name:"ContenthashChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"bytes",name:"name",type:"bytes"},{indexed:!1,internalType:"uint16",name:"resource",type:"uint16"},{indexed:!1,internalType:"bytes",name:"record",type:"bytes"}],name:"DNSRecordChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"bytes",name:"name",type:"bytes"},{indexed:!1,internalType:"uint16",name:"resource",type:"uint16"}],name:"DNSRecordDeleted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"}],name:"DNSZoneCleared",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"bytes",name:"lastzonehash",type:"bytes"},{indexed:!1,internalType:"bytes",name:"zonehash",type:"bytes"}],name:"DNSZonehashChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!0,internalType:"bytes4",name:"interfaceID",type:"bytes4"},{indexed:!1,internalType:"address",name:"implementer",type:"address"}],name:"InterfaceChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"string",name:"name",type:"string"}],name:"NameChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"x",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"y",type:"bytes32"}],name:"PubkeyChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"node",type:"bytes32"},{indexed:!0,internalType:"string",name:"indexedKey",type:"string"},{indexed:!1,internalType:"string",name:"key",type:"string"}],name:"TextChanged",type:"event"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"},{internalType:"uint256",name:"contentTypes",type:"uint256"}],name:"ABI",outputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"}],name:"addr",outputs:[{internalType:"address payable",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"},{internalType:"uint256",name:"coinType",type:"uint256"}],name:"addr",outputs:[{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"}],name:"contenthash",outputs:[{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"},{internalType:"bytes32",name:"name",type:"bytes32"},{internalType:"uint16",name:"resource",type:"uint16"}],name:"dnsRecord",outputs:[{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"},{internalType:"bytes32",name:"name",type:"bytes32"}],name:"hasDNSRecords",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"},{internalType:"bytes4",name:"interfaceID",type:"bytes4"}],name:"interfaceImplementer",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"}],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"}],name:"pubkey",outputs:[{internalType:"bytes32",name:"x",type:"bytes32"},{internalType:"bytes32",name:"y",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceID",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"},{internalType:"string",name:"key",type:"string"}],name:"text",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"}],name:"zonehash",outputs:[{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"node",type:"bytes32"},{internalType:"address",name:"a",type:"address"}],name:"setAddr",outputs:[],stateMutability:"nonpayable",type:"function"}];var yV="AEkU4AngDVgB0QKRAQYBOwDqATEAnwDbAIUApABsAOAAbwCRAEYAiQBPAHYAPgA+ACsANwAlAGMAHwAvACsAJQAWAC8AGwAiACIALwAUACsAEQAiAAsAGwARABcAGAA6ACkALAAsADUAFgAsABEAHQAhAA8AGwAdABUAFgAZAA0ADQAXABAAGQAUABIEqgYJAR4UFjfDBdMAsQCuPwFnAKUBA10jAK5/Ly8vLwE/pwUJ6/0HPwbkMQVXBVgAPSs5APa2EQbIwQuUCkEDyJ4zAsUKLwKOoQKG2D+Ob4kCxcsCg/IBH98JAPKtAUECLY0KP48A4wDiChUAF9S5yAwLPZ0EG3cA/QI5GL0P6wkGKekFBIFnDRsHLQCrAGmR76WcfwBbBpMjBukAGwA7DJMAWxVbqfu75wzbIM8IuykDsRQ7APcta6MAoX0YABcEJdcWAR0AuRnNBPoJIEw3CZcJiB4bVllM44NCABMADAAVAA5rVAAhAA4AR+4V2D3zOVjKleYuChAdX01YPewAEwAMABUADmsgXECXAMPrABsAOQzFABsVW6n7Adq4HB0FWwXiAtCfAsSwCkwcpGUUcxptTPUAuw1nAuEACy00iRfJkQKBewETGwC9DWcC4QALLQFIUCWRTAoDLfsFMgnXaRetAddDAEkrEncCMRYhAusnuTdrADnhAfUlAMcOy7UBG2OBALEFAAUAitNJBRvDHwcXAKgn0QGhKy0DmwBnAQoZPu03dAQYFwCqAccCIQDTKxJzOvNQsAWQOncnNUgF+icFWQVYr7gFaTtdQhI6WEGXe5NmX6H4CxMDxQcl8XcjBKNLAlNTAnUbqycBj6OlNVsDRRcEg2EJANEGqz8vIwcpAjldAGsBYR9xAIMdGQCVAUm3ACdpFwGvxQM3LSFDUwFvWQZlAmUA8UkXAykBBQBJQQCrAF0AcwArtQYH8+8ZjX8ACSEAKQCzG0cB0QHbBwsxl3iB6AAKABEANAA9ADgzd3nTwBBfEFwBTQlMbDoVCwKsD6YL5REVDNEqy9PYADSpB+sDUwfrA1MDUwfrB+sDUwfrA1MDUwNTA1McCvAa08AQXw9IBG0FjgWLBNYIgyZJEYEHKAjSVA10HhxHA0UA/CMlSRw7kzMLJUJMDE0DB/w2QmynfTgDRzGrVPWQogPLMk85bAEecRKgACoPcxw1tU5+ekdxoApLT661f0liTmcCvjqoP/gKIQmTb7t3TgY9EBcnoRDzDC8BsQE3DelL1ATtBjcExR95GRUPyZWYCKEt2QzpJt8unYBWI/EqfwXpS/A82QtJUWQPVQthCd86X4FKAx0BCSKHCtkNNQhpEO8KxWcN4RFBBzUD0UmWAKEG/QsNHTEVsSYMYqgLBTlzBvca8guLJqsTJXr4Bc8aHQZJASUa+wDLLuOFrFotXBhPWwX/CyEjwxSkUBwNIUCzeEQaFwcRJaUCjUNsSoNRMh6PIfI8OQ1iLg9ReAfxPAEZSwt9PJpGp0UKEc4+iT1EIkVMKAQxeywrJ4cJyw+BDLV8bgFVCR0JrQxtEy0REzfBCDUHFSmXICcRCB1GkWCWBPObA+8TzQMHBTsJPQcPA7EcKRMqFSUFCYEg0wLvNtEurwKLVnwBEwXHDyEf2xBMR9wO5QiXAmEDfyXnACkVHQATIpcIP18AW4/UUwEuxwjDamgjcANjFONdEW8HjQ5TB6McLxW7HN1wxF4HhgQon6sJVwFxCZUBWwTfCAU1V4ycID1nT4tUGJcgXUE7XfgCLQxhFZtEuYd0AocPZxIXATEBbwc1DP0CcxHpEWcQkQjnhgA1sTP0OiEESyF/IA0KIwNLbMoLIyb1DPRlAZ8SXgMINDl36menYLIgF/kHFTLBQVwh7QuOT8kMmBq9GD5UKhngB7sD7xrvJ+ZBUwX7A58POkkz6gS5C2UIhwk7AEUOnxMH0xhmCm2MzAEthwGzlQNTjX8Ca4sGMwcHAGMHgwV14QAZAqMInwABAMsDUwA1AqkHmQAVAIE9ATkDIysBHeECiwOPCC3HAZErAe8lBBe/DBEA8zNuRgLDrQKAZmaeBdlUAooCRTEBSSEEAUpDTQOrbd0A1wBHBg/bQwERp0bHFt8/AdtrJwDDAPcAATEHAT0ByQHvaQCzAVsLLQmer7EBSeUlAH8AEWcB0wKFANkAMQB77QFPAEkFVfUFzwJLRQENLRQnU10BtwMbAS8BCQB1BseJocUDGwRpB88CEBcV3QLvKgexAyLbE8lCwQK92lEAMhIKNAq1CrQfX/NcLwItbj1MAAofpD7DP0oFTTtPO1Q7TztUO087VDtPO1Q7TztUA5O73rveCmhfQWHnDKIN0ETEOkUT12BNYC4TxC2zFL0VyiVSGTkauCcBJeBVBQ8ALc9mLAgoNHEXuAA7KWSDPWOCHiwKRxzjU41U9C0XAK1LnjOrDagbEUQ8BUN16WImFgoKHgJkfQJiPldJq1c3HAKh8wJolAJmBQKfgDgXBwJmNwJmIgRqBHsDfw8Dfo45AjlzEzl+Oh8fAmwZAjIyOAYCbcMCbarrhi9jQScBYwDaAN0ARgEHlAyJAPoHvgAJsQJ3KwJ2njsCeUc/Ani2GVjXRapG0wJ8OwJ6xAJ9BQJ87AVVBRxH/Eh5XyAAJxFJVEpXERNKyALQ/QLQyEsjA4hLA4fiRMGRLgLynVz/AwOqS8pMKSHLTUhNqwKLOwKK1L0XAxk/YwGzAo4zAo5YPJN9Ao7VAo5YdFGwUzEGUtBUgQKT9wKTCADlABhVGlWrVcwCLBcpkYIy3XhiRTc1ApebAu+uWB2kAFUhApaLApZ4mAClWahaBX1JADcClrEClkpcQFzNApnHAplgXMZdAxUCnJc5vjqZApwSAp+XAp60hgAZCy0mCwKd7QKejgCxOWEwYesCns8CoGoBpQKemxsCnkqhY8RkIyEnAierAiZ6AqD3AqBIAqLZAqHAAqYrAqXKAqf7AHkCp+5oeGit/0VqGGrNAqzfAqyqAq1jAqz+AlcZAlXYArHd0wMfSmyTArK5CQKy5BNs3G1fbURbAyXJArZYNztujAMpQQK4WgK5QxECuSZzcDJw3QK9FQK71nCSAzINAr6Ecf4DM20CvhZzHnNLAsPHAsMAc350RzFBdNwDPKMDPJYDPbsCxXgCxkMCxgyFAshlTQLIQALJSwLJKgJkmQLdznh1XXiqeSFLzAMYn2b+AmHwGe+VIHsHXo5etw0Cz2cCz2grR0/O7w+bAMKpAs9vASXmA04OfkcBAtwjAtuGAtJLA1JYA1NbAP0DVYiAhTvHEulcQYIYgs+CyoOJAtrDAtnahAyERac4A4ahACsDZAqGbVX1AFEC32EC3rRvcwLiK+0QAfMsIwH0lwHyzoMC6+8C6Wx1Aur1AurgAPVDAbUC7oUC65iWppb/Au47A4XcmHVw3HGdAvL/AGUDjhKZjwL3DwORagOSgwL3lAL51QL4YpoYmqe3M5saA51/Av72ARcANZ8Yn68DBYkDpmYDptUAzcEDBmahhKIBBQMMRQELARsHaQZdtWMBALcEZ7sNhx6vCQATcTUAHwMvEkkDhXsBXyMdAIzrAB0A5p8Dm40IswYbn8EApwURu+kdPT4WeAVoNz5AK0IhQrRfcRFfvACWxQUyAJBMGZu5OyZgMhG6zw4vGMYYicn2BVcFWAVXBVgFYwVYBVcFWAVXBVgFVwVYBVcFWEYVCNeFZwICAgpkXukrBMkDsQYvu7sAuwSnuwDnQCkWsgVGPmk+cEI/QrZfdTdf6ABYETOrAIz+zGvL/KbnRno9JiMEKxYnNjV+bd9qwfEZwixpAWvXbjAXBV8FasnBybgIz0lbAAAACnxefYu+ADM/gQADFtEG5a0jBQCMwwsDAQ0A5WUdPSQfSkKxQrxBOCNfJ2A2JzgjCcE9CkQ/Qz54PoE+cD5xAolCvElCO1/LTk9qTQosa1QvagtuH1/gMzobCWebCmIjKzwdJkKrQrwrzAHL/F/JDh8uCQgJIn6d32o6LUoXyavJrAllwcvMCmBBXw/lEKMRAJONHUVCJRupbTnOOAozP0M+cEI/HAcKHUxHbFssLVrhvBIKfe0dK0I/HF0ISgkOM1RDQjcEO0OcLAqBGy1CPxv1CFMiIxgwMQAFj2HwXgpxZMlgC2AtI25DYBk5AhseYLMGAmsQZU5gTREBZOdgFWCVYH1gs2BLYJFoFhcGtQ7cVam8WgtDFqsBuyvNwQIfFQAcAx4BeQJsLzCVUoABigq4RxoA5CN0jgrKDaZN6gGbAoecTwVAXwD39wkANBZXDAulDCQfuq9HAE8MNAAVE58rggh6AtILS2URGwDYTgZ1BAoeWgAxALa4AZonCxZvqyQ4nxkBWwGGCfwD2e0PBqoGSga5AB3LValaCbthE4kLLT8OuwG7ASICR1ooKCggHh8hLBImBiEMjQBUAm5XkEmVAW4fD3FHAdN1D85RIBmpsE3qBxEFTF8A9/cKAHoGJGwKKwulODAtx69WDQsAX7wLAGNAlQh6AOpN7yIbvwAxALa4AZonLTsOzgKQGHtQu1jIdHKO16WbDvWZFT0b7AEpEFwSBg8bAccJOhCTBRArDDYLABEAs84BAgCkAOEAmIIABWtXLwAUAFsbxi5sdioNwRACOyQz0+EcHgsbfQJ7Ls6hHATBCqrxbAA3OS0Opge7CQAQOi7OERkAfavaHA+7GkcczaF3HgE9Kl8cAuugCAHCAULz5B9lAb4Jtwz6CDwKPgAFwAs9AksNuwi8DTwKvC7OoSoJPA67BZgBG2sKD4sa4QHDARELuxY7AKALOxC7BBige9wAO2sMPAACpgm8BRvQ9QUBvgH6bsoGewAHuwG7D00RErwBAQDqAQAAdBVbBhbLFPxvF7sYOwAuuwLrDlaouwAeuwJVICp/AAG7AALjAAg7FTwVuwAbuwG9KOClWw6/xAD0AGj7L7ZtvgNIo7vIqDsDAbuVJ0sAAlsACrsEAOfdGbsIGnsIoQUK/3AA37unuxjbGruji3lyBvupm4MAErsGGwsBvAAAhgBtuwYAC7unOwEaO7oIoZzKAbsL7QfAqTsA4XsBvwAA5QAVuwAG+wAJuwBpiwAauwAOuwIYu45pFfsAAVsADmsALkseAAa7ABe7CCEADUoBwgC3ryYBwAAAtAAOmwG+J+QAsloAHBsBv/7hCqEABcYLFRXbAAebAEK7AQIAabsAC3sAHbsACLsJoQAFygBunxnVAJEIIQAFygABOwAH2wAdmwghAAaaAAl7ABsrAG0bAOa7gAAIWwAUuwkhAAbKAOOLAAk7C6EOxPtfAAc7AG6cQEgARwADOwAJrQM3AAcbABl7Abv/Aab7AAobAAo7AAn7p+sGuwAJGwADCwAQOwAAFDsAEWsAD4sADesADbsAGQsGFhsAFTsAbpsWswG7ALoAEzsDAGkrCgDhSwACOwAEUgAXewUbAAbQABi7AAv7AF+7AGv7AOSLAbsAF3YBvAABcguhAAVKHgF7KFIAOUUA/gcNDHIAKCpwAaQFCF4BvF4jDAkHb0tsXyqJHzwUYi02A6EKtAHYABYC0QNuAXZyR1IUIQNPAhU+ASwGA3NGvHtSekAAKQAxAfsAUwrbAHuQLAErAHblDREyRgFKAFcFAAFQAQeKzAB4OwQgpQBaANYVAJVoNx+LAM1rsQDP1BYIwnVzGxhWHQnRAYiQqyJTU01IEjzCifkAfxw3QCkr4BGXTwByASksMClCGQ8DMFUE98XuAEtl3ABqAnECPxF6Osd4LjXVBgUAEBsdCggMKgQfHSlOU04IuboAChLNACYAARoAhgCJAI41AO4AtADgAJ08ALsAqwCmAKEA8gCfANMAnADrAQwBBwDAAHkAWgDLAM0BBwDXAOsAiACiATUA4wDYANUDAQcqM9TU1NS2wNzN0M5DMhcBTQFXL0cBVQFkAWMBVgFHS0NFaA0BThUHCAMyNgwHACINJCYpLDg6Oj09PT4/DkAeUVFRUVNTUlMpVFVXVlYcXWFhYGJhI2ZocG9ycnJycnJ0dHR0dHR0dHR0dHZ2d3Z1WwBA7ABFAJYAdAAuAGLyAIoAUwBTADMCc+kAh//y8gBgAI/sAJsASwBeAGD5+aoAgQCBAGUAUgCtAB4AsgB/AjwCPwD4AOMA+gD6AOQA+wDlAOUA5ADiACkCdwFNATwBOgFQAToBOgE6ATUBNAE0ATQBGAFUDwArCAAATRcKFgMVFg4AigCSAKIASwBkGAItAHAAaQCRAxIDJCoDHkE+RykAiwJLAMMCUwKgALoCkgKSApICkgKSApIChwKSApICkgKSApICkgKRApEClAKcApMCkgKSApACkAKQApACjgKRAnEB0AKTApsCkgKSApEWeQsA+gUDpwJdAjYXAVAQNQLeEQorEwFKNxNNkQF3pDwBZVkA/wM9RwEAAJMpHhiPagApYABpAC4AiQOUzIvwroRaBborDsIRAZ3VdCoLBCMxbAEzWmwBsgDdfoB/foB+gYKCfoOGhH6FiIaAh4KIgol+in6LfoyKjX6Ofo+CkH6RfpJ+k36Ug5WIloKXftoC2WzhAtdsAIJsJGygAINsbARCBD8EQQREBEIESARFBEAERgRIBEcEQwRFBEgAlmZsAKMDh2wAtGYBBWwAyVFsbADPbAIMbAD2WmwA9gEZAPYA9AD0APUA9AN8XmzUhCNlvwD2APQA9AD1APQcbGwAiVpsAPYAiQEZAPYAiQLsAPYAiQN8XmzUhCNlvxxsAPdabAEZAPYA9gD0APQA9QD0APcA9AD0APUA9AN8XmzUhCNlvxxsbACJWmwBGQD2AIkA9gCJAuwA9gCJA3xebNSEI2W/HGwCQwE2bAJKATlsAkvBbGwCV2xsA54C7AOeA54DnwOfA58DnwN8XmzUhCNlvxxsbACJWmwBGQOeAIkDngCJAuwDngCJA3xebNSEI2W/HGwEN2wAiQQ4AIkGjTFtIC9s1m4DJmwA/QDGWgJsbABVWv4UMgJsbACJAmwAVAEAuV5sAmxebGwAiV5sAmxebD3YAEls1gJsbEZFNiJ9FGVAe8xvEZKvxVfKZszAVTBzYBH2d1iyUXEHH7twNw7eZF5JJRHI5EgaRr5D20/3dfONrFLSq5qSrrgd2CEUq722WBQ/LzpA+bx1oREI5xy4BDSZNun0ZWORUJqInZSyMaioyvfSI0l5uFDzbWaQ28/zdB0hwR4OQZ0/jn9ALSLNikjFYGfqR389qtFlhD3a6KdIh97rhZYpywuLc7o8ql5/X8KCbPU3L/QlmCowhRXhsGDvg6wUNprA9bM/49uxlAj7ZVy3ouEY/BgFXBNyK0TLrSjZWeJm/T4nz6QGLT3cJNtWRZVZTvIdtaxMMJRHgig9+S11LjBh7Inr06ykoch1U097Rw0hvgmOrydQyaWcEQDg0RavuMuT0zYabUZl1e33HNSK1oNUCS03eh+9C2EvF3fq9h+XBaAMFuoWeZf+mfZgL4HzyiKDIUtfNU4oFu0aE9qt3VA3U4D3fOSrAcYVnjG3cSkp1vhXZnp3JQm4JknKdBitO2NVnGCYQwU3YMWHWB87NEd+4AHuOKI8BSIH92reW0pfs+kWCTJxDCbRjFv8Cfc4/DSBYJScJYTeAEgg9wTEvcwd/QuHRHqGzAQ4fXf5FUI1lPrO+fvEcPl4JInM1z9AtBT2bL4QYEREe7KiSnnxTwtmAFjn8lqT3mND8qTktX2F16Ae9cakqJ6/pEQsHURqyqWlRMCzKXRKfCHT7sYHWx9/T/ugYTFY6iVN3Btm58ATJR5alYZybKMWojwOw3HbFn23NFyeLl7+Er82RchyYuBoGQ3j7SAWNxiYvp5U+Fq/DEzB9cG5DlJWsqkosRze92OVlCtQEYo1S1lF72Z8xWc4ld/+fFcfTEDTFb9d8tJGQ75dpJEvcWyGmGBiTbiWDdGOcw93Dmxq5ISUrmasygONfHLvhgo83HQZenbdBtSzBkvYrCEQ/xEDMhMZsN6gqplx5jGG9mSQLhM81UEdEeJ59sdNJDAFy/gPyJoKlwPZgB/MkC/kICLiCB8va+nCdO2ry4aDfkmPFpF/H/SGQ3LJ6aAv9dtJ8DniHtLOckZix0BVb0iR5V3LAp521LBSIi6AtV7r2ZB/hQEvAw54EFNOQcFnl1xGUIc67tqK1INNwD2n/RbwgzO9h45LM6VMuN8V1ZNIQ6t+Xy3lTqyVCD5kqLy/t3/b8MLbgDg8JIWDkSZ+LrGhhr+gYpH+pr1TnCUnZPjpUdw6bSL6MWVXoDDciQDWECwU2e6VEpfrcOBbrSOijqGkEIoJPbpmeJLkcwbvA0yWIixQVjo0HnYh7fji+Dfdq1mtV1lG2Zz9R7eFMHS+FK7nybutu2fwzDpFldO2pZBshsHJWaltn3PWOoGJpCT2jE8EHOuC6FkejNWcfsWCqNqMLP9xTwcWArj2EiiI7D+EaDi7/2cqHL1gPiF6C/J7aUo7RQqogPZ11WqbyP97nsoMxPOC78wZMF7B1Y0g7JNXJV/nN1m4xx8hbqWz07KSaqr5hE4icB326DMR/vUKX9LoNjle/ZWtbUhrTAcsdgrLlG5Ne8aiR0bS/2ZhpNOVVxavWIZsEM/rd68EB4vjbbD13NkMK1qvMk74vGbSkL7ULO0sZ9R6APSCo6KH+Xn98wEdw1bCPAnDTaBsD6sidAGN58uiH4a3ovG1KyZAu2XtyGgF/vgWKGxw9R1lfAVcfuYE71DHuxtTzfGZnHaDpDGWmfEq0N4GawE7yIkaoz8jcmVmzJe1ydM8q0p08YIxFcY1YcqQc1djWBEoNETDFcgk5waRftEJasPREkrV++N/TOKkERF1fCLrXS8DFGYGRBeECMQRNEs0ES3FzUtXCcNxpYEM3Uei6XodZruXUIRnn+UXf2b/r7n1vQutoi6WoIbW7svDNWBbUWcDUc7F9SJK3bvSy9KIqhgyJHoW2Kpvv0J4ob14HFXGWWVsYXJzjwxS+SADShTgCRjhoDgjAYRGxwJ1Vonw+cpnCKhz8NQPrb0SFxHIRbmG95Q2hlC4mDxvPBRbkFa60cvWakd7f0kVBxxktzZ9agPJEWyA63RSHYVqt8cPrs2uFJ3rS3k9ETGKn5+A6F9IOrdZHfT1biEyUJKEvwzuscwshGCBJvd16TrefW03xVnJf4xvs72PdxrMidjJO8EiWyN/VWyB3fv9kc34YIuZTFtXGo9DuG3H1Uka5FgBMwDPEvRcSabi3WakNQkXFecJlFk6buLVk5YHpuKWTw6oF632FPPSVIVl5hgUAeHhj0t/sw/PEEvThLQDDFE34eCg/rLOyXT3r+L98oRKrlTO0MdALYQ3rRQqC7d822dJPGxF1K4J2TtfPSMFaCAg0n0NGk9yiaKKOJD1v2aBX9HUOIawjjfvwCmjHZJTR62R9c9x33JnBjWrN4QYEOmehy0oZMP9XM9Zyi6TYoe07PaLceRXcCWZiY/imRUWW6+mci7+wMxSdwMdbXckXtvhJH8sc4iQcTwm7yp+3f7CaesTTQB2qkgeXh+wFiSMXfMlH7Yil0OoZ2QTtRLTip2O0cLZ4SstqWHZ6H+8A2kZXhpm0kPbL9dUanTOvziqIUh6Ambwa3WrCb2eWbuCN3L1hgWUmjRC3JoL3dBhR3imSQI8xuCMfsszlji7cSShNSYdqCXPxEVwbqO9i5B6hf93YI7aeyI8jxgcVXK0I/klbvhSXjkjOIwZgPdVwmsFW7HGPLUAvDRuKm+itybRg7c8+Yqqjg824Qf+/NxsBSUNAK9KCoJpauFqK0XQULrWYj4FnxeKDuvr54iokpi+D57e6Y1zxRJJdsHnDR3JyraCUufHBRTKODWBVzthjm4k3/Hv+Q990XDVR+KW+TcJX045LW86EKhz/97aqj89A8ZvTk1//tczosU90loIPVaHuWegJU3wP//7XHcO7c0yQM2jM/IhQKrf8hiObHWiWDZManF8Uf/HzbmDfC2wT//aiZ4hGTv/xzgKwdb1sD6cGEkceow0s3b89/zg+3plyRm0HlZi886j5wUwFhdHiDTaBidZRo5cx/tMeLyguOATbzq17ydhzbrpxunuHx6lbFGiO97gsd4dk//7iCIo+Ew+hG2so5kvv+ITG4c1fzHPtu1Xn5QfUnqY3/uByVmB7gmnE/E+5zdm+6nDmoews5fr+NzThdSHzK4bBQOL9c4O8OI0xLSqjJ4lbniLJg1aFpQRLwaSMZmpkC9e/j6FOVrTQ6a/a4alGgfrl2ZL1sbHUQ3DOI7ntq9diHFfm3t1mul3rdJEJCHnlW/hlQntipMrpeMs7fUr6wK370D7VbXH0DUHzdYfRg/6Z11Ult1sffJS+heHbco15Sxy3+rDnPesqH1lajk0yu02hPUvEUqvcUXWXL7Ad0wNGMx5gOle4XJxq/r/YY0xdco2wRSEGwcT7YADlBrHc9ZbvzOL0QwyWCWWChB9Obg800v7tyBWaNvdwz+fL7Ph9i2irEeJkRgOzeEDw+JiD/V93vH9FgMEoFIJMoIuogmicZohf94SBuPn6hXaV9jP4VVVA/bu+Wg8S88GLtmEPSNRLdtlXx2XL/nuM8nKkhnlnjaropiKKLIH94pLIASci0pDBfj9Hi5BfaTSXQg5+PMjQX91Ktk4MOqK1K99l4BRPv5+vNovGZ3IxQv8ICvjV4/diThpoaM8uvd3D9d/DE477w3yAbW3IDm2i73pZ9aEj38JqS6h/s8/xgmUIVcuq2JTgefAyuoafzQxAuRASeg3NtG3ach/JEkyuX+JDt2PnDZTShUhyHHG3ttBg/6lhAchGjLJBtopj4e01MlCp2yqQRTr4sBBXru+lKaoanwYX8y2aWCJiR3KnhCOkYVFSvsO0oDRujUFOEptiNDTYrJoUbvOyvl4AhC9h3wORiTXK1MrpMfnvdnndnR/HRVSusMBgIxwrLdn3vq1VcncPiD0SquTx/kNmxeFyCT4uXVUd9AL+rSGmuq7OOCzDKeVPjiNWVaoP5KOFqYq5Xcuf/xW9S+u9eIq9GAtZWtQlgkRecjRtvG1NR4WXXpn+pwsTBTIy079Ikg8rSef1aVapIFcXCd6C2wHVjLXR+N0tw4Taw6x6H90BFRgNrtlq2up6hHKuV3inM5RJaQWZHd84e6RsKkk9po3dk9by54tpPw7cBkFas/G+GbHwuG+AwP55BZyXILTHCIVrPpXHEaUPYfL6nphJP1Rc10xG4UaCeY4IHCwuur8xmSQDgY4aVwhzWhjbtSHG8JO6P2i2nC9/0Bfx0zk6dYQq3aw7k5vIObD7SEKrxhz0fQ0+YTOfHW23CBNeZci1qNsUDhoeqmfyP6PvjoEjHk8QbrFyQVZPHVWijnb8YCM65iYNoEbvnchStZ/9cKg5Vd45j8KnB6UjzXl/bkyZx7VoD47ocUUi117WwgySSb4rXgLJ52Mv5XJbp3I+uBP81BUvOjy4Cacgi+GWWlC/8dwgqwiojjUBDnEOxyRyowwLQfytFra1OZS4XvRYr4uoamAfG3I/p2bA7G90yqKThH8Ke00Tqd+3l3dmJpaCZelBMYjGqNLVa3SM4+LQeL56gY6Bymy2LQPVOxjWfj5tq4o74swcxhyGJPynkS5xAjOXZP1/FAYcBT3u6qLoIkEfErwo4gozmyI1YCvM0oyI3ghjGPQSsof2sKUhq91WsKy9cYWN+4A2v4pG/Mxpdc6w6kI/HX7Xb0TuihmsiOy2wQIsrZbUmr3OBSUo6oDJNgQp+YqYkgTgYcWZDgawJw3DFfdzT//PhVUidgB2qa8uw/j9ToHBAS33iT8YLhhAfyXG0bQUFp7QmH7oQ3i6Flf4OTZLvJdh8pfuflmWu2ohm5pTiSg1pl3vq9uluTJwqXfh1hqy8e2iHoD+Y35gCIViTo6VOtK5dD8HYClucJucXASzwe2kPj4S4eYQtmkYHagXhAzp/F541xE8YFYqSPszDuz3soWzHy0p3E2jwZNQaIcGU9FNQwQxeDw0ZlK9dxXrj9IUHGUPTOyib8CqXmbZ7Ex54bn1rLx3qqAavu/gh6XjV0GmN1p+yyMK9HN5uYEvxgbAk43tsheREhyI+Q5WLIneKTGPmYiM/lxOp8fvqHy8YgXK0TlMiX0tliLI2JtfmWZP8eVV732sdYm+pcWzDzEmKLJZyeelyaZKkjPnnUO9keDwtgiLnmd5+t+Sr5y8brRnlvxcWEWfCqIALQYHvaXx6jTg4dAlye469uGwwOZVZCILLfGjaMg4LUCNMTtMSp1aC2y/3wR2t1v3w/iNBRQ+bNbtDqL2NAr7K4rUcyqbSpNrXZgAWXvjxBBtfYLK1uRYt3q2pfXJOAL0HtWcEwJLddOSJKV1SwvcvEuzg/4MPnA8MIUJOLqm3qI6wFyN99Ck6zYaV/zGSAzF/PGsaNa4vPLe5QnyuqVUnVQ6xELA6gbe53aGgeke+R/ycb2LJVyc7BhuzI90zA+c6wUDTb7NH//gdDSl2u/aW7lRJm8m1fLtPxcNuEM5JbkOCZKPM88HUsLRoC1pmKKlvWyeAXuxILbu0snpSxf8N+RgtLUSe5n2gdjOjoSTaN7mMZ7bF+cWk/MS8mFD4pcyl5UN7CbpFZH2a+Pm1VAnUTVfbw8qrmz1G9m5aKmRzY1SMhhPrlCn2t4uNUXNA3IFe6NOjSC1DEaAFZAfDlEkQCsbNhsZPj6NQPDSB3tLiTo0ZYoEbIeEIaKtU3Wk60rEszawTFuyHVd365LA/c/uarABN5M5rGq/dqTG3Ilye/5EKiYisisuzqNaZjmWv0z9TORc0CKbaTea214oNM9u2sXUZub/eqM3Pi/PjRSyQiOSwPWif2asTgu6hS6fb5UGosCWxdedMqdViIUUSSdIJx+qQ4KShfTT39VAWZbi+mB+iKICNwpt6cflY57Rcbs6d1kA26Iru73cuxYVlSvuJdcR5VfDYZRk8X0AXePROyw3Le6LaUdmTLzYsoNhhgQpd67xVNiHgk3pakmndeIAtTC4DCXy9oS6eU4CWxDdVmY53pKNbdAKmQsP37lrJZC6iDXMELGKcHjNuuZgcDyY8W/yv6ha3DX7OWm/35fpvhw55oitf4V+GULlcPWYyGGuVBdro19c8u0RDddDun40W7G5cSIzHLh/qZxb59R+EPY+wZ2XerkUim92hhXpKyW6WtAh6zQS97DrPyjCvKi3pCw96LeKynOpyjtsMQc2RmI/20zFOZcSa2AK++PoRcT6zeJyxlBZ7kk5mhqXGkLlM2hFKc+/T544xXP0Ua38Q6xdPTLTeG1PHnLMaOvksUQMrEFTB/lizCirmFQL8zYVU+OTeYQEFaITsBSMMYexS9HkajO2gGIf2micvntCZJsZQEwIH3/4JGJQGflBuH5rNXmnRRYXDQs3ZoEQoMtYDr1kFKUS/siiQSUxcTH9XYeBZiKDDFQoExREO9dddKQLO3BwMHvymCSTFyY+vxn3D27NDx6OlU092D5EDUwilttqVHpjJQDUceJYCLsK2swfXeNUVrBJT/w/sk+7si8rPtiMFis+oxvGdGQxirMBID700T39mULuNHzOyN+xBfcFACZcyngF1aSpv0JPkNUrAZTqfplv509cGXFUiEEm5dZb+OsP/blizqdK45/dSsIrufYTrCPY2lgJD6k6QljTfXVlHfYKSq+MsagyUcaMintyr95bD8kdTAeYNLNsMmo/Wdd8a2nStBP49ARIjqqpUHWY4q4mvO5Cq/CgCP+4/B+5zutGwX5pssgVLr1+fIM7WWLfiUQDk4c6ZdHZOWv5hG3g2dgQ5NXnpIY+BWwJpaouf25bXnjDzbHnQNofH/c6m+dEAS9Gs2h7pFRPKOBDnqswZ8KZjhId1ytHUTs533KwBoSiImoxKQUgZ7z6pA9QB3sZ8Cq0vwutJTTkfbX8AzCpm2cFXx/P22niUMHauU8IGc+78R6TsutoonoqFuoNA3l80t387YHMoL5KGAT1JO4zmx+vJ0LbLHlicHraSVYvJjnO9p++qnWgKw9OwFVVUagvZuf9qfiuum+hIicxP1q4zDnzkHsCNriLxBpxY9N+UOmqzdY1MunLMDgkMyi3uvnN3UBXJeZ8YLs5xr8QrOhimYoKuGBebZHAiBIkViv3DG8k2oNpp5OIgX6ulqaRN8V62QUPjn5tl1kPXhT9bcd8qIm8gi4or/FGbvQ6pgGSHmnayrugmf5E0upGxPRf/3xOtitGMaHLKJVm5zhglmVfI91o0yxhJZVS/5wQ8zfxK8Ylw0WmHXoGfRkoBRx9Hsnl/6sgTjAVwpmNuSeZtBwlX4qB8Bh8lxjqBDIuFGJ4I1wxN0XRlAAslzqMKwQfyA7OkuivCXfv+i+3XmhcBFM2n4jdT+NyUmBnQJPV3F2sZfKvJhUlXzSosFR4VevVVcOkFnnjdiRWc0TeSYxj41sJGYMbZTeLI3GvyZ8/gAAudQ1+4oFX+enX5V49MczGCYVBuoC4kHjp7ZVxj+clBwPr9k+v05SsezQK3enxLs1Nt/N7c7AImVUysjGou4iOohHo83Zs9/MI/OWB+OyXzOBD93NbApGHXrv8CVRHp2bwH+xB55cfNrdqFD35HSMx4iVmtzYAmSCIV8kXsHoq3DIb93riTWbubnjxbBW5zConVtbxLRStXHkIyAByaozME952Gc9aAdAbBpZSVCH88Uwb/4bPTVOVl+WoMYD7JIvK8VcMrJ8zHV4bbG0Dg7Kx17A4ej/ZcZ2Z5pVuVLUH1E/AccUTKm81SE+LQ6STTUDscUk0x2OWIbEORhg69tdoTGNkA1RfkGIRZHr5mCXOpLC55WWzCZoGPFUVtZRHwh0nq039CDdjEPo+JyaxSQAvDgR6Iqvxy0frrtEG1A385N81l05SSzN+IDm9bypF9m92EUqblnauZ5sjc37wRykOdl7w4o8WMgQsjii3EE/aJYDfHs1cH6DNBEujjcCc8qAefYFyIAURDcDnzun5UmkbBQsU4eu/W8I9nBE0qJKTdg2hwjq0+XV7a3TJ7R+alvJZCRia9lJ+grNB9dbrOmWEvUotMjvDhq4wV/kq4fvIBkzUGpDeYH74rne8uU3dgoNZdR9pUL6q9YDNRfOiF6Dyk+SYXQIghTjm9qR4tBHh0gnmF/9q3Qv22EzaLhSvDlDOxMrrCNRmLCl1jApzLrBCPn2mjn5zqK7OYK7VxOfQ5GfBfoPdyQwqFEgCVHkJ9oTnagRM3R0+rsuN5jQv9icCav/p1WqiEXSzCdLd/WEA6z6dDP7tPqPbeDYKAkVcz1lLGbFOC9b7cBd3MV0Ve8dZ89oR7OnxGS7uVpSry8banVZwpJg+nkH1jRBYa2BvBMY2xITH9ERXCjHzdZxs+ipdXP2DY7X+eWiBhtT2L0RRGTLPeazn5tpl4tu8iE2rWig731iuJDRbCHHy+g/Mb9+miAyVqfIpXT/iZeOxOxODO0hEpLM78I1+G2Z45yi3lS1K3m4WMQ559Lp4UML5vZUjYGJuxl+OPpUH5klpyBujkjprhei0TmUik10gjvNUp8mDkWlNKikmYspaVTqewbnOzJrmz8FLIpsT67EJLHIIfeDcWEfiP+DJrZ1jfxpoAb2abeMqLx+9RuZGzQoYtYVGgAWwEM9Kek2vPIeBNAKD6ao7nw6sgvfeLZPoXkbYO/tStHJdKzk+WFSFEU2NcALJAEP6S8pcnqqBBt57dwTrzQNCIdk2SocK4dLRbD/pu/VryKnm65ZYXiJCfHJk3mx9MRSl+nSK6OqEBSoGjz0/LADddwF/HqcfK3K3O+6YUGQcmj8pZL4PhZ6KrGkb8B38FmDvvLd3XQXbvS/FQmrXFTvJNkaN/FGo83KuS43BK1UfVnIqigGkCoP5fBda2MwAGTGNKX9K9t4Bx83pMFc5KSORmWKv+8VoVggWxoaBz3/9IBh6RwLd1tebwy89xvE5z6EEpXpDfrXWfRsMs6+ekUHH6idVosno55+xQ8Zqzelh0bxtJTgCcH3Z3/Cxlx9eNIS4JIFKOAVrDqbrXRszmY55a5+niJGHtkO3b6mnIDxLa1WXc7BAe33mt2KyM4Fbc3R6/WVTQN8QhlqAtave2WsQTqzWeSlKuGUVIJRqtObpv294rS0kDN1RKzdstZTXJebR2HlzsQ4P3NbMHUqFZMZw+/IKXnh4t+lY8qocp/B1oMszR03EFs3bPeND8QkItMvllObeCz3SZAjqZrobmLcrpFyQV7mwBjg3C3C8/bc5goQhv8j/IXMLGnt4mF7tybRDG5G0polxoUScQkPvmnga2/K+aapKeqSL0BTmo1Cm5g+booNOtdyKva2KoefRURaBk7113QKo3y+WTuFKtgETIK8HRluYS9DvlcciCDvnG8UaJRfZE2siZsiTHvRmN80xkUIInHeRZl5Re/+ATL6VhKFi8CZ/n/jbFV6T5pZ+Uoppvsi3qjacVFOJgWWfdlwVHKPW/TJO3na9hRM9bS2yo2rEsC6IBzRReVO6IesJU7PItzOamr+ROFfwGZmZ7ue8HNxAgLJKb7P3p8dMqk6Be5PJaT/5Rdc1deYVihWH9cjVKc9uz5EnfHqxLUkOO8iJUENBNVf5LyNy8zjLu/78k5WNTywiPfYeX3CPk7yc6CI3lum/CEZwfUaNpcI3KsPqfn2lmz3kd/acQjKA1ebkJaiuLD+epQ/Fc1llHXXMzofWzz/Kd29SNmOhcjMWw1jq1g3YfrXZ9rzXDYW4ZttfgfMi6oCUtBs0PkMVuxmq5lxEoCaSXPSqCJJ7MlKdRDidVt0AFlxk5cTdX++sBF2+E35mjwfm8ERVxH0FvuAQtsfA4V2G0TKTUxeyRGVjd/u6F1SvuAiU2/WaQjcNCU4Ep7VunXCYSbZj3U3wzu/LWM5MPlYuyQ3FOOCD/zt7K295hY2JhwF+ODDIZ676vGQFKveEQYkWj7lkK7rVmD7MhU0Y/tF8EcTTpo4/yqOufbd/zWIpMajnbDuWK2vn6OPPtz2rc9MIBNlPd8tt+yf+7SC4wqEPbozKMCwY5Bygx4JmoIEDsixWRDcdHd6S3/dZMHXOJAAv7+NIstl00crgSqHZKAEe4g3G4dzIV51EeZB01r7p8GNlfUnG/GjZgNGsqXZdYMBVtAtFNv3hJWPve4GvqZ2XxuiNkHTz5kxWgr0PjQdJlVywJ9Zf2ZvqeeTbolKtvK54re2Lq5BoyzfsRtvDfyao3kmyFzDQ88nM+qx83w74RDlkngtYiArI05Epre3GgBeSlMig0pE6RGQaFznKkGeb0SozLCyiOtxh7hgwZlbKbClzUUfC8ntMiHUOZE375RhTy9c4DA+oMLkUDkztSybZbdmP1xpaIbjUpPAHBq3cIq+CBFzbMlMMCCkUQ6d9LGV6GYCsYiEWZIy3nBnuxOYXeU4YTGDSin9e4/pCjPtQSHlg5LMEvIlF0ElthqrF129iK2RPBEWd3XWOl3SWV5uz5VUyZYp5kEFmz7QfP/B1W1BBzQ2iTGbSVT79lUHzcGXz3PJceSgz4uknETUwo0xffpr2KUvZF0i/r2sL3IFIClYx8CbIZE6Qt7MDJbOPB3xMScwaOcWG66IJfCnDkb0D2Mb+PHzX+oiCbxeTIogtyN+s2NJirNACk/OACSOTtV6vscwbzW4M168xqaI+RzR47S1nlV/rOoZnid87n/Ima2XYa3un3BuGAisNjb8eLMT9OnMtazQROFCuO1HiZXaOc0oUDbNC4eKLToOx8DzVhMgGA8XIAQ2x3b6I0uEyLssQjJX3QphcUMx4KsMgJ+72km4N2aqkBF2coKmUEt1eqIMGn+5txMT4kYVGd3ALO+y9Z4PP3d3l48JQK8s9ZZ/Qx/+NBKgBEJFlQ32psoJiihGO7FSYM5L81q72kaAYcilEFMG+ZK1BcMqELkflyCV7v8JEXLO4Rf/oZYNZHZVjJhfL6fnpP9Tio3Euue5uS7FMkfGOeRCTrBZ06Caev7tgufeTrX34Ur/Vvc+b8ksiIShNJtuF9WmYxOZ4xg8y6zTdy3KAB2y5kYkcRnXsptWwAFyKZ2I/QGySNeoQLkINUMloC+5L3WuMMx297Q1xUYLKqZ9XHavaobo6QQv4auMm+i84IhxRpPt9nUmcav9NcjCcP+TcMmxsQZ/F3mgeoA0fQgwvTsyXuuTaM3Sqtv2jaaajmaFQpK9W6uIbeqwvSDo34ZrY6elDUHwSCjHRRmlwmyy+eOra64Ssq0XSXYljMHtKY+FShcMkHsEUY/4Bw63dJ6KpwDaxmthlDdbdE+TvYF3v33cGSKqO+1H1pKYhJMvZD5ckQcHyNF8zrtiR5b0ko6NPGoRexUZTYP6VbUdn3zzxGBOi8Z0OqHjGqYxRXwN3mYi0GYEEZYq+Q3QvdKcEHILLLj8S+VFepSfErtmfZCdvxbfIifFSpEzKi+7VJsLMT+zEFeyp1OdwRC1VZrfTLIyR7xTPUcZFYPD9qI7D70uTb4hdpqPXsJIRNYbZtNwch1OI3trh3u2ScoQyM9POnInsUa+OovcwkUP1UfIzPb95n4BaF2ev57NHAej0+BVMF9/Cj9663HN2/JN3SQgslL914bKfiTTDFAz9PlQEL/dSv1H8xl3mtWxh1McFO9EJXlRDaKQDsyKO4vOJW90NFE6yw2tjbc2GeF95sbs0I9enAa6QwQVf/kJQhAD2BzUDKggOyjy1TEhED6sfk+418lQy3c/uj8aw8UEzZ6hIMCd8RohAkumMtIj9m73l2yPWoGHVTPaywkC7Yj9tBM1NxMgcrDwRtk4RO2WHT7Ql5kQCKdJj6kNuOTeyEBYBjLMhGz+O5/YGa84HEiTYEpZ6fFzy26GG2hWtTyteuYrhSyG56BjsT/wQeLRytpTY3D7sIMqZnJ9z1FDrfyjFlGl2TNw9BQysbaxOuwYYZs/7I6BANgkqCknWZC7/BBXvaeKwAmC959I+G39BUE9bExkNlbRoFRyEtNzv+NJ91FuisG3JCS6uYBeRnfv8AkAfKTeg9EYamqnsGfAV7d0f9DghHEQ5IsPGDIUhgoSj7obM4Bu5uhQ3/CYEDTHc92AsFvDK4XGrwUeGBWBHPlS+f4x+CxmmHz2sAGmSFNt65kwZC64mnaoWlu2310laYn8r62AqsR5dfjyK18MEdurdagldzfJtjFXlZs7St4QhdPiye6TPh2/ZAQLU/Fip5s7TDEM16KtRWrK9hmxnQ7bmfa/+7pa10Z8WDPK3NuJ+NN/RAbQ5vHx2uX0Lm7/w7cAEH/hvZA+mt7J7zGw7YtQYwnNN6dpgwkGjjrS3yQoeoYt1EnczmtmJfQZWzUlP3Hlg9Wzlr9IH23q3thGth+QNEANFettxKfskkGOlLk8AqoKJwDqOxAa6UzAx07plSSyNBJSGco9zjnC5gGbDoKvsMDuBR6bGRlGzJ+hFsGa/Izt78aI+WZ6dJlZKp4pGISuv9rV0sAS0MWEwCmfauO7oQZMiakHU35LBxiyJoOMddhUWgcZuC8r4Ksvn75TTcQXLJ7kWtYhGuGqPd9dZuFjBWQHNwosXY5snbHFQq72CvHXhIg+shQxycuLOuWYErwCLZeF24b7F78pO7xw4X6lIAR02hUOf5087Rl0nOaeb6CK4i/KA/EZv76ftOWZtjwxslNr0E/u8rWUmnf3amfg6UZmBAluuoj3Dd7UV+9IAJ6iYcDfSJlgmIImohjfIUMJ27z+opj50Ak9af2LCNrWrBJvMovA1OeNO+MF/MwZvnaCxTgG7Cw4QfSPF6AYCGFt21M8PySZFeV3t2Rqqs5JMzMYzGRgq4o+UaKRgBf9GHi/9X9HXA3wxkCsd/UhnHSh2zUVDiraio/6nP4y3XJqs8ABfALAtCYU7DHPMPRjgcM6Ad/HiSXDAbOdSMkvGZPAkHs8wuQTy6X2Ov/JFvcPuKfV3/r9Q28";let yK=new Map([[8217,"apostrophe"],[8260,"fraction slash"],[12539,"middle dot"]]),yG=4;function yW(e){let t=0;function r(){return e[t++]<<8|e[t++]}let n=r(),i=1,s=[0,1];for(let e=1;e<n;e++)s.push(i+=r());let o=r(),a=t;t+=o;let l=0,c=0;function u(){return 0==l&&(c=c<<8|e[t++],l=8),c>>--l&1}let h=31,d=2**h,f=d>>>1,p=f>>1,g=d-1,m=0;for(let e=0;e<h;e++)m=m<<1|u();let y=[],b=0,w=d;for(;;){let e=Math.floor(((m-b+1)*i-1)/w),t=0,r=n;for(;r-t>1;){let n=t+r>>>1;e<s[n]?r=n:t=n}if(0==t)break;y.push(t);let o=b+Math.floor(w*s[t]/i),a=b+Math.floor(w*s[t+1]/i)-1;for(;((o^a)&f)==0;)m=m<<1&g|u(),o=o<<1&g,a=a<<1&g|1;for(;o&~a&p;)m=m&f|m<<1&g>>>1|u(),o=o<<1^f,a=(a^f)<<1|f|1;b=o,w=1+a-o}let v=n-4;return y.map(t=>{switch(t-v){case 3:return v+65792+(e[a++]<<16|e[a++]<<8|e[a++]);case 2:return v+256+(e[a++]<<8|e[a++]);case 1:return v+e[a++];default:return t-1}})}function yQ(e){let t=0;return()=>e[t++]}function yJ(e){return yQ(yW(yZ(e)))}function yZ(e){let t=[];[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"].forEach((e,r)=>t[e.charCodeAt(0)]=r);let r=e.length,n=new Uint8Array(6*r>>3);for(let i=0,s=0,o=0,a=0;i<r;i++)a=a<<6|t[e.charCodeAt(i)],(o+=6)>=8&&(n[s++]=a>>(o-=8));return n}function yY(e){return 1&e?~e>>1:e>>1}function yX(e,t){let r=Array(e);for(let n=0,i=0;n<e;n++)r[n]=i+=yY(t());return r}function y0(e,t=0){let r=[];for(;;){let n=e(),i=e();if(!i)break;t+=n;for(let e=0;e<i;e++)r.push(t+e);t+=i+1}return r}function y1(e){return y3(()=>{let t=y0(e);if(t.length)return t})}function y2(e){let t=[];for(;;){let r=e();if(0==r)break;t.push(y5(r,e))}for(;;){let r=e()-1;if(r<0)break;t.push(y6(r,e))}return t.flat()}function y3(e){let t=[];for(;;){let r=e(t.length);if(!r)break;t.push(r)}return t}function y4(e,t,r){let n=Array(e).fill().map(()=>[]);for(let i=0;i<t;i++)yX(e,r).forEach((e,t)=>n[t].push(e));return n}function y5(e,t){let r=1+t(),n=t(),i=y3(t);return y4(i.length,1+e,t).flatMap((e,t)=>{let[s,...o]=e;return Array(i[t]).fill().map((e,t)=>{let i=t*n;return[s+t*r,o.map(e=>e+i)]})})}function y6(e,t){return y4(1+t(),1+e,t).map(e=>[e[0],e.slice(1)])}function y8(e){let t=[],r=y0(e);return i(n([]),[]),t;function n(t){return{S:e(),B:y3(()=>{let t=y0(e).map(e=>r[e]);if(t.length)return n(t)}),Q:t}}function i({S:e,B:r},n,s){if(!(4&e)||s!==n[n.length-1])for(let o of(2&e&&(s=n[n.length-1]),1&e&&t.push(n),r))for(let e of o.Q)i(o,[...n,e],s)}}function y7(e){return e.toString(16).toUpperCase().padStart(2,"0")}function y9(e){return`{${y7(e)}}`}function be(e){let t=[];for(let r=0,n=e.length;r<n;){let n=e.codePointAt(r);r+=n<65536?1:2,t.push(n)}return t}function bt(e){let t=4096,r=e.length;if(r<t)return String.fromCodePoint(...e);let n=[];for(let i=0;i<r;)n.push(String.fromCodePoint(...e.slice(i,i+=t)));return n.join("")}function br(e,t){let r=e.length,n=r-t.length;for(let i=0;0==n&&i<r;i++)n=e[i]-t[i];return n}var bn="AEUDVgHLCGMATwDUADIAdAAhADQAFAAtABQAIQAPACcADQASAAoAGAAJABIACQARAAUACwAFAAwABQAQAAMABwAEAAoABQAJAAIACgABAAQAFAALAAIACwABAAIAAQAHAAMAAwAEAAsADAAMAAwACwANAA0AAwAKAAkABAAdAAYAZwDTAeYDMwCxCl8B8xhZAqfoC190UGcThgBurwf7PT09Pb09AjgJum8OjDllxHYUKXAPxzq6tABAxgK8ysUvWAgMPT09PT09PSs6LT2HcgWXWwFLoSMEEEl5RFVMKvO0XQ8ExDdJMnIgPi89uj00MsvBXxEPAGPCDwBnQKoEbwRwBHEEcgRzBHQEdQR2BHcEeAR6BHsEfAR+BIAEgfndBQoBYgULAWIFDAFiBNcE2ATZBRAFEQUvBdALFAsVDPcNBw13DYcOMA4xDjMB4BllHI0B2grbAMDpHLkQ7QHVAPRNQQFnGRUEg0yEB2uaJF8AJpIBpob5AERSMAKNoAXqaQLUBMCzEiC+AZ4EWRJJFbEu7QDQLARtEbgECxDwAb/RyAk1AV4nD2cEQQKTAzsAGpobWgAahAGPCrysdy0OAKwAfFIcBAQFUmoA/PtZADkBIadVj2UMUgx5Il4ANQC9vAITAdQZWxDzALN9AhsZVwIcGSkCBAgXOhG7AqMZ4M7+1M0UAPDNAWsC+mcJDe8AAQA99zkEXLICyQozAo6lAobcP5JvjQLFzwKD9gU/OD8FEQCtEQL6bW+nAKUEvzjDHsuRyUvOFHcacUz5AqIFRSE2kzsBEQCuaQL5DQTlcgO6twSpTiUgCwIFCAUXBHQEqQV6swAVxUlmTmsCwjqsP/wKJQmXb793UgZBEBsnpRD3DDMBtQE7De1L2ATxBjsEyR99GRkPzZWcCKUt3QztJuMuoYBaI/UqgwXtS/Q83QtNUWgPWQtlCeM6Y4FOAyEBDSKLCt0NOQhtEPMKyWsN5RFFBzkD1UmaAKUHAQsRHTUVtSYQYqwLCTl3Bvsa9guPJq8TKXr8BdMaIQZNASka/wDPLueFsFoxXBxPXwYDCyUjxxSoUCANJUC3eEgaGwcVJakCkUNwSodRNh6TIfY8PQ1mLhNRfAf1PAUZTwuBPJ5Gq0UOEdI+jT1IIklMLAQ1fywvJ4sJzw+FDLl8cgFZCSEJsQxxEzERFzfFCDkHGS2XJCcVCCFGlWCaBPefA/MT0QMLBT8JQQcTA7UcLRMuFSkFDYEk1wLzNtUuswKPVoABFwXLDyUf3xBQR+AO6QibAmUDgyXrAC0VIQAXIpsIQ2MAX4/YUwUuywjHamwjdANnFOdhEXMHkQ5XB6ccMxW/HOFwyF4Lhggoo68JWwF1CZkBXwTjCAk1W4ygIEFnU4tYGJsgYUE/XfwCMQxlFZ9EvYd4AosPaxIbATUBcwc5DQECdxHtEWsQlQjrhgQ1tTP4OiUETyGDIBEKJwNPbM4LJyb5DPhpAaMSYgMMND137merYLYkF/0HGTLFQWAh8QuST80MnBrBGEJULhnkB78D8xrzJ+pBVwX/A6MDEzpNM+4EvQtpCIsJPwBJDqMXB9cYagpxjNABMYsBt5kDV5GDAm+PBjcHCwBnC4cFeeUAHQKnCKMABQDPA1cAOQKtB50AGQCFQQE9AycvASHlAo8DkwgxywGVLwHzKQQbwwwVAPc3bkoCw7ECgGpmogXdWAKOAkk1AU0lBAVOR1EDr3HhANsASwYT30cBFatKyxrjQwHfbysAxwD7AAU1BwVBAc0B820AtwFfCzEJorO1AU3pKQCDABVrAdcCiQDdADUAf/EBUwBNBVn5BdMCT0kBETEYK1dhAbsDHwEzAQ0AeQbLjaXJBx8EbQfTAhAbFeEC7y4HtQEDIt8TzULFAr3eVaFgAmSBAmJCW02vWzcgAqH3AmiYAmYJAp+EOBsLAmY7AmYmBG4EfwN/EwN+kjkGOXcXOYI6IyMCbB0CMjY4CgJtxwJtru+KM2dFKwFnAN4A4QBKBQeYDI0A/gvCAA21AncvAnaiPwJ5S0MCeLodXNtFrkbXAnw/AnrIAn0JAnzwBVkFIEgASH1jJAKBbQKAAAKABQJ/rklYSlsVF0rMAtEBAtDMSycDiE8Dh+ZExZEyAvKhXQMDA65LzkwtJQPPTUxNrwKLPwKK2MEbBx1DZwW3Ao43Ao5cQJeBAo7ZAo5ceFG0UzUKUtRUhQKT+wKTDADpABxVHlWvVdAGLBsplYYy4XhmRTs5ApefAu+yWCGoAFklApaPApZ8nACpWaxaCYFNADsClrUClk5cRFzRApnLAplkXMpdBxkCnJs5wjqdApwWAp+bAp64igAdDzEqDwKd8QKekgC1PWE0Ye8CntMCoG4BqQKenx8Cnk6lY8hkJyUrAievAiZ+AqD7AqBMAqLdAqHEAqYvAqXOAqf/AH0Cp/JofGixAANJahxq0QKs4wKsrgKtZwKtAgJXHQJV3AKx4dcDH05slwKyvQ0CsugXbOBtY21IXwMlzQK2XDs/bpADKUUCuF4CuUcVArkqd3A2cOECvRkCu9pwlgMyEQK+iHICAzNxAr4acyJzTwLDywLDBHOCdEs1RXTgAzynAzyaAz2/AsV8AsZHAsYQiQLIaVECyEQCyU8CyS4CZJ0C3dJ4eWF4rnklS9ADGKNnAgJh9BnzlSR7C16SXrsRAs9rAs9sL0tT0vMTnwDGrQLPcwEp6gNOEn5LBQLcJwLbigLSTwNSXANTXwEBA1WMgIk/AMsW7WBFghyC04LOg40C2scC2d6EEIRJpzwDhqUALwNkDoZxWfkAVQLfZQLeuHN3AuIv7RQB8zAnAfSbAfLShwLr8wLpcHkC6vkC6uQA+UcBuQLuiQLrnJaqlwMC7j8DheCYeXDgcaEC8wMAaQOOFpmTAvcTA5FuA5KHAveYAvnZAvhmmhyaq7s3mx4DnYMC/voBGwA5nxyfswMFjQOmagOm2QDRxQMGaqGIogUJAwxJAtQAPwMA4UEXUwER8wNrB5dnBQCTLSu3r73bAYmZFH8RBDkB+ykFIQ6dCZ8Akv0TtRQrxQL3LScApQC3BbmOkRc/xqdtQS4UJo0uAUMBgPwBtSYAdQMOBG0ALAIWDKEAAAoCPQJqA90DfgSRASBFBSF8CgAFAEQAEwA2EgJ3AQAF1QNr7wrFAgD3Cp8nv7G35QGRIUFCAekUfxE0wIkABAAbAFoCRQKEiwAGOlM6lI1tALg6jzrQAI04wTrcAKUA6ADLATqBOjs5/Dn5O3aJOls7nok6bzkYAVYBMwFsBS81XTWeNa01ZjV1NbY1xTWCNZE10jXhNZ41rTXuNf01sjXBNgI2ETXGNdU2FjYnNd417TYuNj02LjUtITY6Nj02PDbJNwgEkDxXNjg23TcgNw82yiA3iTcwCgSwPGc2JDcZN2w6jTchQtRDB0LgQwscDw8JmyhtKFFVBgDpfwDpsAD+mxQ91wLpNSMArQC9BbeOkRdLxptzBL8MDAMMAQgDAAkKCwsLCQoGBAVVBI/DvwDz9b29kaUCb0QtsRTNLt4eGBcSHAMZFhYZEhYEARAEBUEcQRxBHEEcQRxBHEEaQRxBHEFCSTxBPElISUhBNkM2QTYbNklISVmBVIgELgEaJZkC7aMAoQCjBcGOmxdNxrsBvwGJAaQcEZ0ePCklMAAhMvAIMAL54gC7Bm8EescjzQMpARQpKgDUHqSvAj5Gqwr7YrMUACT9AN3rlr3JG9m8w9lIAXltp/v8kfWaIaaR9OwpAES/I3ZVamDXSgB/UsOgAG6D0tq+5CIqE15FiAhV3yA2VhCQ7tj+m6xXaF53FIfGi/IAZIskMGAi2MU7MDVJNCbMzERyHZi+osdPtnFVbvq653O8rwaCy4IAf9OOok65AqJUtUriUfYsGPPVbe6jm0s9lbKlPCUKjdkHsFsEhvX4kT39ZCtAAbwQdn/h4TpO5hTByWAmr5n+Wuwhdegv6bmvX4LyOes3z2+cuHv2JFYwVMNuq2gzn8YHTjlUQd39osyWei4NKl3LAdfxlO876hh5ENp/cOvpuI9bF55guEthLLPOXjD4dktTH04P5TvZrWTM0e4+BHJxj7MLApXIFOs0sWKhNkG8iwuM5wR83my6V3wW06abhDzTXYfOr/ZpFXgXzmv4d12FFyP00/dPGbIVGV5ao8UufGzUwp/IHx6v/wDWJr9iaoCulhWwlZ7A8q/NMoD12+mBdNRgJYnThRLtMx1Bgwttn8/4Qn2CDfOSup9GVXEvA21ILgp0owHYxNOkpwLWz0G7K+WREIDjIzUzSn8I99CuJSmSpPyH0Ke6/NERYiNx+3dncSebPnOUnnWD61AhJ1n/tSLZmU5wYO5GfgzyAYJm6VL91LxZ8hL1lfximQxIDMRhIecQZBmeE5R0XlrpvwplVrJwpa8BBCdp93GPP9lyBeZ2zkRr920CR3cYbKpKHfogvm0nV7XdDz6EbjzlxADCMjSLXuXpIpyuizy39yY+I+H9rmpoIF3YwEjlH9MgGgWcCNTjHEWMqAbprn2Ox7rOHupaVE3lNyg3nt5XaZID6Y+uml5Ja+aOPu+BI+DZbiJVfaspUadakWUX6TA4dETkIqdJJHYnU4Z4yKpt5y8rVIahoMUf8A8kWtAQNCTbjp71gx3/zVdqNz1Sutkw0gFIMVm2BF4Xdv/0olw+NaDIR9Bb3DPweZA2K/cw+/b+AwyWl9ZOP67A9nexmeTNjfdzPGf9J6E6BMPKa5lJh+qNsdUz3HBUevU71eQFCqOcxiIYhacAhh/8PX0J5DdSViZ6WazDDx7cukJNpMfEkYLJ5Ao4vLoVd3d25Pg4qaVa2p2D2L3WvYPJ5Yf/A/MSxptjlgXL/KJtP2U0cRv2I09ATAiWCJYuRwiapeKFsqmi18yMMulDp3HdcIldq+7jkwsJUOHLHCzzzBw5XFvL0CAmo1ub456z7zb7shk3KPGCLZzr47oT1k/j06XNnJvG3Udv6XrP+wsqTBlZ5MaNPt9FOs/4Bt/ja/vbVhTNpBFl9Gq7MqINvGlWKOAwQzwOZy+EzSdjAqKJVV2YcskTuM94aIK+kc/AZaXiZLPREUDpkXIV947IFfj+85TrqPqLfkGcxgboMQjosf+az+odLNXdyp1mDNGsqSdK/pJ2Ca04mt/4d6s1X+lncOEYaGBBeW4pApGcjf7/XJCFbj3N3mFb+BtlIcw8ZiDKoClFX9Rf0bxCqtLpicObKJzBVVHr/6u4siH2hK75RNv7w9GfTbhJOQBYiFUZAByY4rn37tZBHT//kqKsNi3ryL9AqXJRzqiMIJMhILjoi/i8LVEsbu+Ih9bsyW16sgQqjYLO0qda6KaCPKj3DQcu6CfV5lKtjS3ZCdqLAZkOey9MR+QutJBGiz/r15GVD6rCVwJR4UUKC4GNJkfDf00OMW8aQtLSAGLXV8MIi9mbbl/qQEpxCm2L5hutFX4ekeLH4QgBWUFKs/2VVMKy46WtFE6AbwgmYm/Z0yHk5veDIrcl2HpVqb/rSE0PC9EbDzJEWqeaPhh7vF369Umq2kSiB3s5rBI6c/7N9bkRu4h2n+/h5nSwy+7n+/I+6oXQVANo2Jb5zDwtiBPf1ySCzHdT6yJShMzqSRZfnykX49CaFaxhoVF4PBhEuECJ1PrFYSpmHuyYsl14DTAV9ZxRms1XiR/kBrjhZjidOt0UNe+GSml7XNgpVw8YsUTmZXLTK+6iYnyW/wYR1W4UXwOi14xpFROHb6HcZzksgF5DbL2AFXzKNwHU2adjdAY+KCyM/cwRTBkkq/a227NI0q6DR2MkMCRu620t79bGcYUmACtqN3mk/0uNwd3JSXHqE1kzf6Yyj0W2083JNDRnIXDlgBxJ6uf58NN1f6FQiRCWB4egF8QDx74AixV8oTyw7PluIjr3/rj/WzgwPSq4xPojaF7V0xqG2u5ti2L1h6yYHv73Isrukr0kURDIEjClBsBx7kdcXUxaYMS0syT3ymLzDzslNDWQOT1Tao1YNmJHARUenhCkmV9tqCPGI5GqZaRpkiPxyjoncWjyOHYGqvbvRX+Bn1pn7EhRNXa1lqJPmoeN5VqdqIDPhEVhFsyG0d4iQEIYX0wZUbY2XbZWYlpZ/l66IrDDY0q1C1YzBDpHC4h05YqHQLqS9anyl22JQ6lEvjvdBwMHfE7z0luCXD34/rFeDa2TmSeEAykSpYO5j1G/nsgpR3qn0qaQEmLjnnLfcz+veoYqPnRqmRGwCJ6FJ3Gm/Z1/aVX5PSb03MMnjAf41ww54sD5k8FrkfBP+K0b1MrYpapWjtpZfve2HVf4ickX3LKSOhu7qI1Vd4c1kNrn2ajy1t4y93JhV4fnWCKq7OmFpcr7FjdJCXPTql0Drr14Ho3Z87+GPQ4Z/DcTiGqtvZxlRYi8cNuhXABveZIwNl/BX1huhVLaFax5OqypUrQRyb9OE3SSkPlDdy5uo5XGg2EIGEjLY1MO5cr1ibfiFWV7zspcTgkBKkwo5jPyAin04LqizZXb2tDRgwKJjGx4cVk3ngAQixwcxjYAg2Q7vmUR/hpwInMdw7OhC2qyf41vTPkudQAORS0DdLtOGQxb4fH2VYGsvJCkeWPeUwtf1/tuIhzXEThoCZzzSJqqjUtbaPI3ntHm3T5uf849hGUA0zU8ni5W+EEn3/0Y6oUhQFw9z0aGjkljBbAlFXc0y82G2wkd7VdgWa5KTgJJNjNwZMfmdnUIUn1JU5LiWX5UZEZbVlKSN76mlmjUR2ku+fucTNlO4IAAahnLjBhlvQNR9pe9swGBgq0YR7P3VCyI/seYwQ4QBzy9X+HPePgoF8WfKaJ4MBOhLCGHae6Z8xkNXwni9QAKvTNtVA56x8YJflZ/VvONRSlsSLmiSyNMnTjTaE1ko81zkzGEnVwEhjCzlwIqpxmpDAqwsEmtpdr3xpc7i/ZX3f2TzT3M0FdxIEQvO1jgmmiN+D1YpMduAzEhBtj2OBkMN/rv6p7Th4pSH6f5aH3aTvwFTl7EOSgGASI7ttyMehzpm4AVyK+bFEaFg9gnZsSUPpsbAe/0RFhrH+EXZ12Z7thf4dzN1+Sn+G8QrDA1VKaN4IFxD1rQz9Xq9Coii9S9/hPbTGjyBwFH3H1UdQuz5KsgPDEHua4/kPg2Gp/IIItsaLWBqiT9XH45MiQxSosGJ56H/0F2cjcCFd72l1665RNHURdC3lspI77esfJsl+rXXabkAy7vxDXG/XGGcKpwiKDPFfvMEgjkAHil4Za1F36RnyxxvdIAzvgfH8knukYDck07tc++DP4TdWeI7HXuq5Yl6VVFrUQtf64/dkXewlKZSHQo6YvCSpREB0GDrz+Ys2GfO8nw2SwrYwaf88AifzlPvP17bf1mI3AuccJvAjZIpBmqvharKFAebEjVKfGAwpQjWoXlm9LROsq9bCk1UeQ3CJxJqprzssS/Q04JeS1ReCCubL3J7sx86spkP4eNpp95UF+8K748icIs8vdILFklk9skQqi1So6cx3X906pvy1vz+KipTJ8fiVJxsV5MmT0XwA";let bi=44032,bs=4352,bo=4449,ba=4519,bl=28,bc=588,bu=55204,bh=4371,bd=4470,bf=4547;function bp(e){return e>>24&255}function bg(e){return 0xffffff&e}function bm(){let e=yJ(bn);for(let[t,r]of(s=new Map(y1(e).flatMap((e,t)=>e.map(e=>[e,t+1<<24]))),o=new Set(y0(e)),a=new Map,l=new Map,y2(e))){if(!o.has(t)&&2==r.length){let[e,n]=r,i=l.get(e);i||(i=new Map,l.set(e,i)),i.set(n,t)}a.set(t,r.reverse())}}function by(e){return e>=bi&&e<bu}function bb(e,t){if(e>=bs&&e<bh&&t>=bo&&t<bd)return bi+(e-bs)*bc+(t-bo)*bl;{if(by(e)&&t>ba&&t<bf&&(e-bi)%bl==0)return e+(t-ba);let r=l.get(e);return r&&(r=r.get(t))?r:-1}}function bw(e){s||bm();let t=[],r=[],n=!1;function i(e){let r=s.get(e);r&&(n=!0,e|=r),t.push(e)}for(let n of e)for(;;){if(n<128)t.push(n);else if(by(n)){let e=n-bi,t=e/bc|0,r=e%bc/bl|0,s=e%bl;i(bs+t),i(bo+r),s>0&&i(ba+s)}else{let e=a.get(n);e?r.push(...e):i(n)}if(!r.length)break;n=r.pop()}if(n&&t.length>1){let e=bp(t[0]);for(let r=1;r<t.length;r++){let n=bp(t[r]);if(0==n||e<=n){e=n;continue}let i=r-1;for(;;){let r=t[i+1];if(t[i+1]=t[i],t[i]=r,!i||(e=bp(t[--i]))<=n)break}e=bp(t[r])}}return t}function bv(e){let t=[],r=[],n=-1,i=0;for(let s of e){let e=bp(s),o=bg(s);if(-1==n)0==e?n=o:t.push(o);else if(i>0&&i>=e)0==e?(t.push(n,...r),r.length=0,n=o):r.push(o),i=e;else{let s=bb(n,o);s>=0?n=s:0==i&&0==e?(t.push(n),n=o):(r.push(o),i=e)}}return n>=0&&t.push(n,...r),t}function bE(e){return bw(e).map(bg)}function bA(e){return bv(bw(e))}let bx=45,bS=".",bk=65039,b_=1,bI=e=>Array.from(e);function bC(e,t){return e.P.has(t)||e.Q.has(t)}class bT extends Array{get is_emoji(){return!0}}function bP(){if(c)return;let e=yJ(yV),t=()=>y0(e),r=()=>new Set(t()),n=(e,t)=>t.forEach(t=>e.add(t));c=new Map(y2(e)),u=r(),h=t(),d=new Set(t().map(e=>h[e])),h=new Set(h),f=r(),p=r();let i=y1(e),s=e(),o=()=>{let e=new Set;return t().forEach(t=>n(e,i[t])),n(e,t()),e};g=y3(t=>{let r=y3(e).map(e=>e+96);if(r.length){let n=t>=s;r[0]-=32,r=bt(r),n&&(r=`Restricted[${r}]`);let i=o();return{N:r,P:i,Q:o(),M:!e(),R:n}}}),m=r(),y=new Map;let a=t().concat(bI(m)).sort((e,t)=>e-t);for(let{V:t,M:r}of(a.forEach((t,r)=>{let n=e(),i=a[r]=n?a[r-n]:{V:[],M:new Map};i.V.push(t),m.has(t)||y.set(t,i)}),new Set(y.values()))){let e=[];for(let r of t){let t=g.filter(e=>bC(e,r)),i=e.find(({G:e})=>t.some(t=>e.has(t)));i||(i={G:new Set,V:[]},e.push(i)),i.V.push(r),n(i.G,t)}let i=e.flatMap(e=>bI(e.G));for(let{G:t,V:n}of e){let e=new Set(i.filter(e=>!t.has(e)));for(let t of n)r.set(t,e)}}b=new Set;let l=new Set,E=e=>b.has(e)?l.add(e):b.add(e);for(let e of g){for(let t of e.P)E(t);for(let t of e.Q)E(t)}for(let e of b)y.has(e)||l.has(e)||y.set(e,b_);for(let t of(n(b,bE(b)),w=y8(e).map(e=>bT.from(e)).sort(br),v=new Map,w)){let e=[v];for(let r of t){let t=e.map(e=>{let t=e.get(r);return t||(t=new Map,e.set(r,t)),t});r===bk?e.push(...t):e=t}for(let r of e)r.V=t}}function bR(e){return(bF(e)?"":`${bO(bM([e]))} `)+y9(e)}function bO(e){return`"${e}"\u200E`}function bN(e){if(e.length>=4&&e[2]==bx&&e[3]==bx)throw Error(`invalid label extension: "${bt(e.slice(0,4))}"`)}function bD(e){let t=95;for(let r=e.lastIndexOf(t);r>0;)if(e[--r]!==t)throw Error("underscore allowed only at start")}function bB(e){let t=e[0],r=yK.get(t);if(r)throw bK(`leading ${r}`);let n=e.length,i=-1;for(let s=1;s<n;s++){t=e[s];let n=yK.get(t);if(n){if(i==s)throw bK(`${r} + ${n}`);i=s+1,r=n}}if(i==n)throw bK(`trailing ${r}`)}function bM(e,t=1/0,r=y9){let n=[];bL(e[0])&&n.push(""),e.length>t&&(t>>=1,e=[...e.slice(0,t),8230,...e.slice(-t)]);let i=0,s=e.length;for(let t=0;t<s;t++){let s=e[t];bF(s)&&(n.push(bt(e.slice(i,t))),n.push(r(s)),i=t+1)}return n.push(bt(e.slice(i,s))),n.join("")}function bL(e,t){return bP(),t?d.has(e):h.has(e)}function bF(e){return bP(),f.has(e)}function bU(e){return bq(bj(e,bA,bQ))}function bj(e,t,r){if(!e)return[];bP();let n=0;return e.split(bS).map(e=>{let i=be(e),s={input:i,offset:n};n+=i.length+1;try{let e,n=s.tokens=bW(i,t,r),o=n.length;if(!o)throw Error("empty label");let a=s.output=n.flat();if(bD(a),!(s.emoji=o>1||n[0].is_emoji)&&a.every(e=>e<128))bN(a),e="ASCII";else{let t=n.flatMap(e=>e.is_emoji?[]:e);if(t.length){if(h.has(a[0]))throw bK("leading combining mark");for(let e=1;e<o;e++){let t=n[e];if(!t.is_emoji&&h.has(t[0]))throw bK(`emoji + combining mark: "${bt(n[e-1])} + ${bM([t[0]])}"`)}bB(a);let r=bI(new Set(t)),[i]=bH(r);bG(i,t),b$(i,r),e=i.N}else e="Emoji"}s.type=e}catch(e){s.error=e}return s})}function b$(e,t){let r,n=[];for(let e of t){let t=y.get(e);if(t===b_)return;if(t){let n=t.M.get(e);if(!(r=r?r.filter(e=>n.has(e)):bI(n)).length)return}else n.push(e)}if(r){for(let t of r)if(n.every(e=>bC(t,e)))throw Error(`whole-script confusable: ${e.N}/${t.N}`)}}function bH(e){let t=g;for(let r of e){let e=t.filter(e=>bC(e,r));if(!e.length)if(g.some(e=>bC(e,r)))throw bV(t[0],r);else throw bz(r);if(t=e,1==e.length)break}return t}function bq(e){return e.map(({input:t,error:r,output:n})=>{if(r){let n=r.message;throw Error(1==e.length?n:`Invalid label ${bO(bM(t,63))}: ${n}`)}return bt(n)}).join(bS)}function bz(e){return Error(`disallowed character: ${bR(e)}`)}function bV(e,t){let r=bR(t),n=g.find(e=>e.P.has(t));return n&&(r=`${n.N} ${r}`),Error(`illegal mixture: ${e.N} + ${r}`)}function bK(e){return Error(`illegal placement: ${e}`)}function bG(e,t){for(let r of t)if(!bC(e,r))throw bV(e,r);if(e.M){let e=bE(t);for(let t=1,r=e.length;t<r;t++)if(d.has(e[t])){let n=t+1;for(let i;n<r&&d.has(i=e[n]);n++)for(let r=t;r<n;r++)if(e[r]==i)throw Error(`duplicate non-spacing marks: ${bR(i)}`);if(n-t>yG)throw Error(`excessive non-spacing marks: ${bO(bM(e.slice(t-1,n)))} (${n-t}/${yG})`);t=n}}}function bW(e,t,r){let n=[],i=[];for(e=e.slice().reverse();e.length;){let s=bJ(e);if(s)i.length&&(n.push(t(i)),i=[]),n.push(r(s));else{let t=e.pop();if(b.has(t))i.push(t);else{let e=c.get(t);if(e)i.push(...e);else if(!u.has(t))throw bz(t)}}}return i.length&&n.push(t(i)),n}function bQ(e){return e.filter(e=>e!=bk)}function bJ(e,t){let r,n=v,i=e.length;for(;i&&(n=n.get(e[--i]));){let{V:s}=n;s&&(r=s,t&&t.push(...e.slice(i).reverse()),e.length=i)}return r}let bZ="valid",bY="mapped",bX=e=>bU(e),b0=e=>{let t="";for(let e=0;e<32;e+=1)t+="00";if(e){let r=bX(e).split(".");for(let e=r.length-1;e>=0;e-=1){let n=lv(r[e]).slice(2);t=lv(`0x${t}${n}`).slice(2)}}return`0x${t}`};var b1=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class b2{constructor(e,t){this.contract=new yL(yq,null!=t?t:y$.main,e),this.context=e}getOwner(e){return b1(this,void 0,void 0,function*(){try{return this.contract.methods.owner(b0(e)).call()}catch(e){throw Error()}})}getTTL(e){return b1(this,void 0,void 0,function*(){try{return this.contract.methods.ttl(b0(e)).call()}catch(e){throw Error()}})}recordExists(e){return b1(this,void 0,void 0,function*(){try{return this.contract.methods.recordExists(b0(e)).call()}catch(e){throw Error()}})}getResolver(e){return b1(this,void 0,void 0,function*(){try{return this.contract.methods.resolver(b0(e)).call().then(e=>{if("string"==typeof e)return new yL(yz,e,this.context);throw Error()})}catch(e){throw Error()}})}get events(){return this.contract.events}}var b3=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class b4{constructor(e){this.registry=e}getResolverContractAdapter(e){return b3(this,void 0,void 0,function*(){return this.registry.getResolver(e)})}checkInterfaceSupport(e,t){var r,n;return b3(this,void 0,void 0,function*(){if(lt(yU[t]))throw new t9(null!=(r=e.options.address)?r:"",t);if(!(yield e.methods.supportsInterface(yU[t]).call()))throw new t9(null!=(n=e.options.address)?n:"",t)})}supportsInterface(e,t){var r;return b3(this,void 0,void 0,function*(){let n=yield this.getResolverContractAdapter(e),i=t;if(!oB(i)){if(i=null!=(r=lw(t))?r:"",""===t)throw Error("Invalid interface Id");i=i.slice(0,10)}return n.methods.supportsInterface(i).call()})}getAddress(e,t=60){return b3(this,void 0,void 0,function*(){let r=yield this.getResolverContractAdapter(e);return yield this.checkInterfaceSupport(r,yj.addr),r.methods.addr(b0(e),t).call()})}getPubkey(e){return b3(this,void 0,void 0,function*(){let t=yield this.getResolverContractAdapter(e);return yield this.checkInterfaceSupport(t,yj.pubkey),t.methods.pubkey(b0(e)).call()})}getContenthash(e){return b3(this,void 0,void 0,function*(){let t=yield this.getResolverContractAdapter(e);return yield this.checkInterfaceSupport(t,yj.contenthash),t.methods.contenthash(b0(e)).call()})}setAddress(e,t,r){return b3(this,void 0,void 0,function*(){let n=yield this.getResolverContractAdapter(e);return yield this.checkInterfaceSupport(n,yj.setAddr),n.methods.setAddr(b0(e),t).send(r)})}getText(e,t){return b3(this,void 0,void 0,function*(){let r=yield this.getResolverContractAdapter(e);return yield this.checkInterfaceSupport(r,yj.text),r.methods.text(b0(e),t).call()})}getName(e,t=!0){return b3(this,void 0,void 0,function*(){let r=`${e.toLowerCase().substring(2)}.addr.reverse`,n=yield this.getResolverContractAdapter(r);return t&&(yield this.checkInterfaceSupport(n,yj.name)),n.methods.name(b0(r)).call()})}}var b5=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class b6 extends dA{constructor(e,t){super(null!=t?t:""),this.registryAddress=null!=e?e:y$.main,this._registry=new b2(this.getContextObject(),e),this._resolver=new b4(this._registry)}getResolver(e){return b5(this,void 0,void 0,function*(){return this._registry.getResolver(e)})}recordExists(e){return b5(this,void 0,void 0,function*(){return this._registry.recordExists(e)})}getTTL(e){return b5(this,void 0,void 0,function*(){return this._registry.getTTL(e)})}getOwner(e){return b5(this,void 0,void 0,function*(){return this._registry.getOwner(e)})}getAddress(e,t=60){return b5(this,void 0,void 0,function*(){return this._resolver.getAddress(e,t)})}getText(e,t){return b5(this,void 0,void 0,function*(){return o5(e)?this._resolver.getText((yield this._resolver.getName(e,!1)),t):this._resolver.getText(e,t)})}getName(e,t=!0){return b5(this,void 0,void 0,function*(){return this._resolver.getName(e,t)})}getPubkey(e){return b5(this,void 0,void 0,function*(){return this._resolver.getPubkey(e)})}getContenthash(e){return b5(this,void 0,void 0,function*(){return this._resolver.getContenthash(e)})}checkNetwork(){return b5(this,void 0,void 0,function*(){let e=Date.now()/1e3;if(!this._lastSyncCheck||e-this._lastSyncCheck>3600){let t=yield mp(this);if(!("boolean"==typeof t&&!t))throw new ri;this._lastSyncCheck=e}if(this._detectedAddress)return this._detectedAddress;let t=yield fZ(this,Object.assign(Object.assign({},this.defaultReturnFormat),{number:E.HEX})),r=y$[yH[t]];if(void 0===r)throw new rn(t);return this._detectedAddress=r,this._detectedAddress})}supportsInterface(e,t){return b5(this,void 0,void 0,function*(){return this._resolver.supportsInterface(e,t)})}get events(){return this._registry.events}setAddress(e,t,r){return b5(this,void 0,void 0,function*(){return this._resolver.setAddress(e,t,r)})}}var b8=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let b7=e=>b8(void 0,void 0,void 0,function*(){return(yield fm(e)).map(aQ)}),b9=(e,t)=>b8(void 0,void 0,void 0,function*(){return ab.validate(["string"],[t]),aQ((yield fy(e,t)))}),we=(e,t,r,n)=>b8(void 0,void 0,void 0,function*(){return ab.validate(["address","string","uint"],[t,r,n]),fb(e,t,r,n)}),wt=(e,t)=>b8(void 0,void 0,void 0,function*(){return ab.validate(["address"],[t]),fw(e,t)}),wr=(e,t,r)=>b8(void 0,void 0,void 0,function*(){return ab.validate(["string","string"],[t,r]),fv(e,t,r)}),wn=(e,t,r,n)=>b8(void 0,void 0,void 0,function*(){return fE(e,fW(t,Y,{transactionSchema:null==n?void 0:n.customTransactionSchema}),r)}),wi=(e,t,r,n)=>b8(void 0,void 0,void 0,function*(){return fA(e,fW(t,Y,{transactionSchema:null==n?void 0:n.customTransactionSchema}),r)}),ws=(e,t,r,n)=>b8(void 0,void 0,void 0,function*(){return ab.validate(["string","address","string"],[t,r,n]),fx(e,oB(t)?t:aN(t),r,n)}),wo=(e,t,r)=>b8(void 0,void 0,void 0,function*(){return ab.validate(["string","string"],[t,r]),fS(e,oB(t)?t:aN(t),r)});var wa=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class wl extends dA{getAccounts(){return wa(this,void 0,void 0,function*(){return b7(this.requestManager)})}newAccount(e){return wa(this,void 0,void 0,function*(){return b9(this.requestManager,e)})}unlockAccount(e,t,r){return wa(this,void 0,void 0,function*(){return we(this.requestManager,e,t,r)})}lockAccount(e){return wa(this,void 0,void 0,function*(){return wt(this.requestManager,e)})}importRawKey(e,t){return wa(this,void 0,void 0,function*(){return wr(this.requestManager,e,t)})}sendTransaction(e,t){return wa(this,void 0,void 0,function*(){return wn(this.requestManager,e,t,this.config)})}signTransaction(e,t){return wa(this,void 0,void 0,function*(){return wi(this.requestManager,e,t,this.config)})}sign(e,t,r){return wa(this,void 0,void 0,function*(){return ws(this.requestManager,e,t,r)})}ecRecover(e,t){return wa(this,void 0,void 0,function*(){return wo(this.requestManager,e,t)})}}!function(e){e.HTTPS="https",e.WebSocket="wss"}(q||(q={})),function(e){e.ETH_MAINNET="eth_mainnet",e.ETH_SEPOLIA="eth_sepolia",e.ETH_HOLESKY="eth_holesky",e.POLYGON_MAINNET="polygon_mainnet",e.POLYGON_AMOY="polygon_amoy",e.AVALANCHE_C_MAINNET="avalanche_c_mainnet",e.AVALANCHE_P_MAINNET="avalanche_p_mainnet",e.AVALANCHE_X_MAINNET="avalanche_x_mainnet",e.ARBITRUM_MAINNET="arbitrum_mainnet",e.ARBITRUM_SEPOLIA="arbitrum_sepolia",e.BASE_MAINNET="base_mainnet",e.BASE_SEPOLIA="base_sepolia",e.OPTIMISM_MAINNET="optimism_mainnet",e.OPTIMISM_SEPOLIA="optimism_sepolia",e.FANTOM_MAINNET="fantom_mainnet",e.FANTOM_TESTNET="fantom_testnet",e.DYMENSION_MAINNET="dymension_mainnet",e.DYMENSION_TESTNET="dymension_testnet",e.BNB_MAINNET="bnb_mainnet",e.BNB_TESTNET="bnb_testnet",e.BSC_MAINNET="bsc_mainnet",e.BSC_TESTNET="bsc_testnet",e.ARBITRUM_ONE="arbitrum_one",e.ARBITRUM_NOVA="arbitrum_nova",e.AVALANCHE_FUJI_C="avalanche_fuji_c",e.AVALANCHE_FUJI_P="avalanche_fuji_p",e.AVALANCHE_FUJI_X="avalanche_fuji_x",e.BLAST_MAINNET="blast_mainnet",e.OPBNB_MAINNET="opbnb_mainnet",e.OPBNB_TESTNET="opbnb_testnet",e.GNOSIS_MAINNET="gnosis_mainnet",e.GNOSIS_CHIADO="gnosis_chiado",e.PULSECHAIN_MAINNET="pulsechain_mainnet",e.PULSECHAIN_TESTNET="pulsechain_testnet",e.KAVA_MAINNET="kava_mainnet",e.CRONOS_MAINNET="cronos_mainnet",e.MANTLE_MAINNET="mantle_mainnet",e.CHILIZ_MAINNET="chiliz_mainnet",e.CHILIZ_SPICY="chiliz_spicy",e.MOONBEAM_MAINNET="moonbeam_mainnet",e.TAIKO_MAINNET="taiko_mainnet",e.TAIKO_HEKLA="taiko_hekla",e.LINEA_MAINNET="linea_mainnet",e.LINEA_SEPOLIA="linea_sepolia",e.BAHAMUT_MAINNET="bahamut_mainnet",e.SCROLL_MAINNET="scroll_mainnet",e.SCROLL_SEPOLIA="scroll_sepolia",e.TRON_MAINNET="tron_mainnet",e.SYSCOIN_MAINNET="syscoin_mainnet",e.SYSCOIN_TANENBAUM="syscoin_tanenbaum",e.MOONRIVER_MAINNET="moonriver_mainnet",e.HAQQ_MAINNET="haqq_mainnet",e.EVMOS_MAINNET="evmos_mainnet",e.EVMOS_TESTNET="evmos_testnet",e.BERACHAIN_TESTNET="berachain_testnet"}(z||(z={}));let wc=1300;class wu extends tV{constructor(e){super("You've reach the rate limit of free RPC calls from our Partner Quick Nodes. There are two options you can either create a paid Quick Nodes account and get 20% off for 2 months using WEB3JS referral code, or use Free public RPC endpoint.",e),this.code=wc}}let wh=1301;class wd extends tV{constructor(e){super(`Invalid provider config options given for ${e}`),this.code=wh}}var wf=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class wp extends l4{constructor(e,t,r,n,i){if(super(),void 0===i||t!==q.HTTPS||"providerOptions"in i){if(void 0!==i&&t===q.WebSocket&&!("socketOptions"in i||"reconnectOptions"in i))throw new wd("Websocket Provider")}else throw new wd("HTTP Provider");this.transport=t,t===q.HTTPS?this.provider=new cn(this.getRPCURL(e,t,r,n),i):t===q.WebSocket&&(this.provider=new co(this.getRPCURL(e,t,r,n),null==i?void 0:i.socketOptions,null==i?void 0:i.reconnectOptions))}request(e,t){return wf(this,void 0,void 0,function*(){return this.transport===q.HTTPS?yield this.provider.request(e,t):this.provider.request(e)})}getStatus(){return this.provider.getStatus()}supportsSubscriptions(){return this.provider.supportsSubscriptions()}once(e,t){var r;(null==(r=this.provider)?void 0:r.once)&&this.provider.once(e,t)}removeAllListeners(e){var t;(null==(t=this.provider)?void 0:t.removeAllListeners)&&this.provider.removeAllListeners(e)}connect(){var e;(null==(e=this.provider)?void 0:e.connect)&&this.provider.connect()}disconnect(e,t){var r;(null==(r=this.provider)?void 0:r.disconnect)&&this.provider.disconnect(e,t)}reset(){var e;(null==(e=this.provider)?void 0:e.reset)&&this.provider.reset()}on(e,t){this.provider&&this.provider.on(e,t)}removeListener(e,t){this.provider&&this.provider.removeListener(e,t)}}var wg=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let wm=e=>void 0!==e&&e.trim().length>0;class wy extends wp{constructor(e=z.ETH_MAINNET,t=q.HTTPS,r="",n="",i){super(e,t,r,n,i)}request(e,t){let r=Object.create(null,{request:{get:()=>super.request}});return wg(this,void 0,void 0,function*(){try{return yield r.request.call(this,e,t)}catch(e){if(e instanceof no&&429===e.statusCode)throw new wu(e);throw e}})}getRPCURL(e,t,r,n){let i="",s="";switch(e){case z.ETH_MAINNET:i=wm(n)?n:"powerful-holy-bush.quiknode.pro",s=wm(r)?r:"3240624a343867035925ff7561eb60dfdba2a668";break;case z.ETH_SEPOLIA:i=wm(n)?n:"dimensional-fabled-glitter.ethereum-sepolia.quiknode.pro",s=wm(r)?r:"382a3b5a4b938f2d6e8686c19af4b22921fde2cd";break;case z.ETH_HOLESKY:i=wm(n)?n:"yolo-morning-card.ethereum-holesky.quiknode.pro",s=wm(r)?r:"481ebe70638c4dcf176af617a16d02ab866b9af9";break;case z.ARBITRUM_MAINNET:i=wm(n)?n:"autumn-divine-dinghy.arbitrum-mainnet.quiknode.pro",s=wm(r)?r:"a5d7bfbf60b5ae9ce3628e53d69ef50d529e9a8c";break;case z.ARBITRUM_SEPOLIA:i=wm(n)?n:"few-patient-pond.arbitrum-sepolia.quiknode.pro",s=wm(r)?r:"3be985450970628c860b959c65cd2642dcafe53c";break;case z.BNB_MAINNET:i=wm(n)?n:"purple-empty-reel.bsc.quiknode.pro",s=wm(r)?r:"ebf6c532961e21f092ff2facce1ec4c89c540158";break;case z.BNB_TESTNET:i=wm(n)?n:"floral-rough-scion.bsc-testnet.quiknode.pro",s=wm(r)?r:"5b297e5acff5f81f4c37ebf6f235f7299b6f9d28";break;case z.POLYGON_MAINNET:i=wm(n)?n:"small-chaotic-moon.matic.quiknode.pro",s=wm(r)?r:"847569f8a017e84d985e10d0f44365d965a951f1";break;case z.POLYGON_AMOY:i=wm(n)?n:"prettiest-side-shape.matic-amoy.quiknode.pro",s=wm(r)?r:"79a9476eea661d4f82de614db1d8a895b14b881c";break;default:throw Error("Network info not avalible.")}return`${t}://${i}/${s}`}}let wb=e=>void 0!==e&&e.trim().length>0,ww=[z.DYMENSION_MAINNET,z.DYMENSION_TESTNET,z.KAVA_MAINNET,z.CRONOS_MAINNET,z.POLYGON_MAINNET];class wv extends wp{constructor(e=z.ETH_MAINNET,t=q.HTTPS,r="",n){super(e,t,"",r,n)}getRPCURL(e,t,r,n){if(!wv.networkHostMap[e])throw Error("Network info not avalible.");let i=`${wv.networkHostMap[e]}.publicnode.com`,s=wb(n)?n:i;return ww.includes(e)&&t===q.WebSocket?`${t}://${s}/websocket`:`${t}://${s}`}}wv.networkHostMap={[z.POLYGON_AMOY]:"polygon-amoy-bor-rpc",[z.DYMENSION_MAINNET]:"dymension-evm-rpc",[z.DYMENSION_TESTNET]:"dymension-testnet-evm-rpc",[z.BLAST_MAINNET]:"blast-rpc",[z.GNOSIS_MAINNET]:"gnosis-rpc",[z.PULSECHAIN_MAINNET]:"pulsechain-rpc",[z.PULSECHAIN_TESTNET]:"pulsechain-testnet-rpc",[z.KAVA_MAINNET]:"kava-evm-rpc",[z.CRONOS_MAINNET]:"cronos-evm-rpc",[z.MANTLE_MAINNET]:"mantle-rpc",[z.TAIKO_MAINNET]:"taiko-rpc",[z.TAIKO_HEKLA]:"taiko-hekla-rpc",[z.LINEA_MAINNET]:"linea-rpc",[z.LINEA_SEPOLIA]:"linea-sepolia-rpc",[z.SCROLL_MAINNET]:"scroll-rpc",[z.SCROLL_SEPOLIA]:"scroll-sepolia-rpc",[z.SYSCOIN_MAINNET]:"syscoin-evm-rpc",[z.SYSCOIN_TANENBAUM]:"syscoin-tanenbaum-evm-rpc",[z.HAQQ_MAINNET]:"haqq-evm-rpc",[z.EVMOS_MAINNET]:"evmos-evm-rpc",[z.EVMOS_TESTNET]:"evmos-testnet-evm-rpc",[z.BERACHAIN_TESTNET]:"berachain-testnet-evm-rpc",[z.ETH_MAINNET]:"ethereum-rpc",[z.ETH_SEPOLIA]:"ethereum-sepolia-rpc",[z.ETH_HOLESKY]:"ethereum-holesky-rpc",[z.BSC_MAINNET]:"bsc-rpc",[z.BSC_TESTNET]:"bsc-testnet-rpc",[z.POLYGON_MAINNET]:"polygon-bor-rpc",[z.BASE_MAINNET]:"base-rpc",[z.BASE_SEPOLIA]:"base-sepolia-rpc",[z.ARBITRUM_ONE]:"arbitrum-one-rpc",[z.ARBITRUM_NOVA]:"arbitrum-nova-rpc",[z.ARBITRUM_SEPOLIA]:"arbitrum-sepolia-rpc",[z.AVALANCHE_C_MAINNET]:"avalanche-c-chain-rpc",[z.AVALANCHE_P_MAINNET]:"avalanche-p-chain-rpc",[z.AVALANCHE_X_MAINNET]:"avalanche-x-chain-rpc",[z.AVALANCHE_FUJI_C]:"avalanche-fuji-c-chain-rpc",[z.AVALANCHE_FUJI_P]:"avalanche-fuji-p-chain-rpc",[z.AVALANCHE_FUJI_X]:"avalanche-fuji-x-chain-rpc",[z.OPTIMISM_MAINNET]:"optimism-rpc",[z.OPTIMISM_SEPOLIA]:"optimism-sepolia-rpc",[z.FANTOM_MAINNET]:"fantom-rpc",[z.FANTOM_TESTNET]:"fantom-testnet-rpc",[z.OPBNB_MAINNET]:"opbnb-rpc",[z.OPBNB_TESTNET]:"opbnb-testnet-rpc",[z.GNOSIS_CHIADO]:"gnosis-chiado-rpc",[z.CHILIZ_MAINNET]:"chiliz-rpc",[z.CHILIZ_SPICY]:"chiliz-spicy-rpc",[z.MOONBEAM_MAINNET]:"moonbeam-rpc",[z.BAHAMUT_MAINNET]:"bahamut-rpc",[z.TRON_MAINNET]:"tron-evm-rpc",[z.MOONRIVER_MAINNET]:"moonriver-rpc"};let wE=new wy,wA={encodeEventSignature:pC,encodeFunctionCall:gX,encodeFunctionSignature:gY,encodeParameter:gW,encodeParameters:gK,decodeParameter:gZ,decodeParameters:gJ,decodeLog:g4};var wx=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};let wS=e=>{let t=(t,r)=>wx(void 0,void 0,void 0,function*(){return dc((yield yu(t,e)),lm({format:"bytes"},r,Y))}),r=e=>{let r=dg(e);return Object.assign(Object.assign({},r),{signTransaction:e=>wx(void 0,void 0,void 0,function*(){return t(e,r.privateKey)})})},n=(e,r,n)=>wx(void 0,void 0,void 0,function*(){var i;let s=yield dy(e,r,null==(i=null==n?void 0:n.nonStrict)||i);return Object.assign(Object.assign({},s),{signTransaction:e=>wx(void 0,void 0,void 0,function*(){return t(e,s.privateKey)})})}),i=()=>{let e=dm();return Object.assign(Object.assign({},e),{signTransaction:r=>wx(void 0,void 0,void 0,function*(){return t(r,e.privateKey)})})},s=new cA({create:i,privateKeyToAccount:r,decrypt:n});return{signTransaction:t,create:i,privateKeyToAccount:r,decrypt:n,recoverTransaction:du,hashMessage:ds,sign:dl,recover:dh,encrypt:dp,wallet:s,privateKeyToAddress:dd,parseAndValidatePrivateKey:di,privateKeyToPublicKey:df}},wk={version:"4.16.0"};var w_=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};!function(e){e.eip6963announceProvider="eip6963:announceProvider",e.eip6963requestProvider="eip6963:requestProvider"}(V||(V={}));let wI=new Map,wC="web3:providersMapUpdated",wT=()=>w_(void 0,void 0,void 0,function*(){return new Promise((e,t)=>{"undefined"==typeof window&&t(Error("window object not available, EIP-6963 is intended to be used within a browser")),window.addEventListener(V.eip6963announceProvider,t=>{wI.set(t.detail.info.uuid,t.detail);let r=new CustomEvent(wC,{detail:wI});window.dispatchEvent(r),e(wI)}),window.dispatchEvent(new Event(V.eip6963requestProvider))})}),wP=e=>{if("undefined"==typeof window)throw Error("window object not available, EIP-6963 is intended to be used within a browser");window.addEventListener(wC,e)};class wR extends dA{constructor(e=wE){var t;!lt(e)&&("string"!=typeof e||""!==e.trim())&&("string"==typeof e||cd(e)||e.provider)||console.warn("NOTE: web3.js is running without provider. You need to pass a provider in order to interact with the network!");let r={};"string"==typeof e||cd(e)?r.provider=e:r=e||{},r.registeredSubscriptions=Object.assign(Object.assign({},m1),null!=(t=r.registeredSubscriptions)?t:{}),super(r);let n=wS(this);this._wallet=n.wallet,this._accountProvider=n,this.utils=W;let i=this;class s extends yF{constructor(e,t,r,n,s){let a,l,c;if(le(t)&&le(r))throw new rs("Should not provide options at both 2nd and 3rd parameters");let u={};if(!lt(t)&&"object"!=typeof t&&"string"!=typeof t)throw new rs;if("string"==typeof t&&(a=t),u=le(t)?t:le(r)?r:{},l=t instanceof dA?t:r instanceof dA?r:n instanceof dA?n:i.getContextObject(),s?c=s:lh(r)?c=r:lh(n)&&(c=n),super(e,a,u,l,c),super.subscribeToContextEvents(i),!lt(o)){let e=o.getTransactionMiddleware();lt(e)||super.setTransactionMiddleware(e)}}}let o=i.use(m2);this.eth=Object.assign(o,{ens:i.use(b6,y$.main),Iban:dx,net:i.use(f1),personal:i.use(wl),Contract:s,abi:wA,accounts:n})}}wR.version=wk.version,wR.utils=W,wR.requestEIP6963Providers=wT,wR.onNewProviderDiscovered=wP,wR.modules={Web3Eth:m2,Iban:dx,Net:f1,ENS:b6,Personal:wl};let wO=wR},18593:(e,t,r)=>{"use strict";function n(e=0){return new Uint8Array(e)}function i(e=0){return new Uint8Array(e)}r.d(t,{K:()=>i,c:()=>n})},18993:(e,t,r)=>{"use strict";let{AbstractIterator:n}=r(97233),i=r(75799),s=r(13623),o=Symbol("cache"),a=Symbol("finished"),l=Symbol("options"),c=Symbol("currentOptions"),u=Symbol("position"),h=Symbol("location"),d=Symbol("first"),f={};class p extends n{constructor(e,t,r){super(e,r),this[o]=[],this[a]=0===this.limit,this[l]=r,this[c]={...r},this[u]=void 0,this[h]=t,this[d]=!0}_nextv(e,t,r){let n;if(this[d]=!1,this[a])return this.nextTick(r,null,[]);if(this[o].length>0)return e=Math.min(e,this[o].length),this.nextTick(r,null,this[o].splice(0,e));void 0!==this[u]&&(this[l].reverse?(this[c].lt=this[u],this[c].lte=void 0):(this[c].gt=this[u],this[c].gte=void 0));try{n=i(this[c])}catch(e){return this[a]=!0,this.nextTick(r,null,[])}let f=this.db.db.transaction([this[h]],"readonly"),p=f.objectStore(this[h]),m=[];if(this[l].reverse){let t=!this[l].values&&p.openKeyCursor?"openKeyCursor":"openCursor";p[t](n,"prev").onsuccess=t=>{let r=t.target.result;if(r){let{key:t,value:n}=r;this[u]=t,m.push([this[l].keys&&void 0!==t?s(t):void 0,this[l].values&&void 0!==n?s(n):void 0]),m.length<e?r.continue():g(f)}else this[a]=!0}}else{let t,r,i=()=>{if(void 0===t||void 0===r)return;let n=Math.max(t.length,r.length);0===n||e===1/0?this[a]=!0:this[u]=t[n-1],m.length=n;for(let e=0;e<n;e++){let n=t[e],i=r[e];m[e]=[this[l].keys&&void 0!==n?s(n):void 0,this[l].values&&void 0!==i?s(i):void 0]}g(f)};this[l].keys||e<1/0?p.getAllKeys(n,e<1/0?e:void 0).onsuccess=e=>{t=e.target.result,i()}:(t=[],this.nextTick(i)),this[l].values?p.getAll(n,e<1/0?e:void 0).onsuccess=e=>{r=e.target.result,i()}:(r=[],this.nextTick(i))}f.onabort=()=>{r(f.error||Error("aborted by user")),r=null},f.oncomplete=()=>{r(null,m),r=null}}_next(e){if(this[o].length>0){let[t,r]=this[o].shift();this.nextTick(e,null,t,r)}else if(this[a])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[d]&&(this[d]=!1,t=1),this._nextv(t,f,(t,r)=>{if(t)return e(t);this[o]=r,this._next(e)})}}_all(e,t){this[d]=!1;let r=this[o].splice(0,this[o].length),n=this.limit-this.count-r.length;if(n<=0)return this.nextTick(t,null,r);this._nextv(n,f,(e,n)=>{if(e)return t(e);r.length>0&&(n=r.concat(n)),t(null,n)})}_seek(e,t){let r;this[d]=!0,this[o]=[],this[a]=!1,this[u]=void 0,this[c]={...this[l]};try{r=i(this[l])}catch(e){this[a]=!0;return}null===r||r.includes(e)?this[l].reverse?this[c].lte=e:this[c].gte=e:this[a]=!0}}function g(e){"function"==typeof e.commit&&e.commit()}t.Iterator=p},19169:(e,t,r)=>{"use strict";var n,i=r(44134).Buffer;let s="[object ArrayBuffer]";class o{static isArrayBuffer(e){return Object.prototype.toString.call(e)===s}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){let r=o.toUint8Array(e),n=o.toUint8Array(t);if(r.length!==n.byteLength)return!1;for(let e=0;e<r.length;e++)if(r[e]!==n[e])return!1;return!0}static concat(...e){let t;t=!Array.isArray(e[0])||e[1]instanceof Function?Array.isArray(e[0])&&e[1]instanceof Function?e[0]:e[e.length-1]instanceof Function?e.slice(0,e.length-1):e:e[0];let r=0;for(let e of t)r+=e.byteLength;let n=new Uint8Array(r),i=0;for(let e of t){let t=this.toUint8Array(e);n.set(t,i),i+=t.length}return e[e.length-1]instanceof Function?this.toView(n,e[e.length-1]):n.buffer}}let a="string",l=/^[0-9a-f\s]+$/i,c=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,u=/^[a-zA-Z0-9-_]+$/;class h{static fromString(e){let t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r.buffer}static toString(e){let t=o.toUint8Array(e),r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return decodeURIComponent(escape(r))}}class d{static toString(e,t=!1){let r=o.toArrayBuffer(e),n=new DataView(r),i="";for(let e=0;e<r.byteLength;e+=2)i+=String.fromCharCode(n.getUint16(e,t));return i}static fromString(e,t=!1){let r=new ArrayBuffer(2*e.length),n=new DataView(r);for(let r=0;r<e.length;r++)n.setUint16(2*r,e.charCodeAt(r),t);return r}}class f{static isHex(e){return typeof e===a&&l.test(e)}static isBase64(e){return typeof e===a&&c.test(e)}static isBase64Url(e){return typeof e===a&&u.test(e)}static ToString(e,t="utf8"){let r=o.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return d.toString(r,!0);case"utf16":case"utf16be":return d.toString(r);default:throw Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return d.fromString(e,!0);case"utf16":case"utf16be":return d.fromString(e);default:throw Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){let t=o.toUint8Array(e);return"undefined"!=typeof btoa?btoa(this.ToString(t,"binary")):i.from(t).toString("base64")}static FromBase64(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!f.isBase64(t))throw TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(t)):new Uint8Array(i.from(t,"base64")).buffer}static FromBase64Url(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!f.isBase64Url(t))throw TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=f.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return h.fromString(e);case"utf16":case"utf16be":return d.fromString(e);case"utf16le":case"usc2":return d.fromString(e,!0);default:throw Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=f.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return h.toString(e);case"utf16":case"utf16be":return d.toString(e);case"utf16le":case"usc2":return d.toString(e,!0);default:throw Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){let t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return r.buffer}static ToBinary(e){let t=o.toUint8Array(e),r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return r}static ToHex(e){let t=o.toUint8Array(e),r="",n=t.length;for(let e=0;e<n;e++){let n=t[e];n<16&&(r+="0"),r+=n.toString(16)}return r}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!f.isHex(t))throw TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);let r=new Uint8Array(t.length/2);for(let e=0;e<t.length;e+=2){let n=t.slice(e,e+2);r[e/2]=parseInt(n,16)}return r.buffer}static ToUtf16String(e,t=!1){return d.toString(e,t)}static FromUtf16String(e,t=!1){return d.fromString(e,t)}static Base64Padding(e){let t=4-e.length%4;if(t<4)for(let r=0;r<t;r++)e+="=";return e}static formatString(e){return(null==e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}function p(e,...t){let r=arguments[0];for(let e=1;e<arguments.length;e++){let t=arguments[e];for(let e in t)r[e]=t[e]}return r}function g(...e){let t=new Uint8Array(e.map(e=>e.byteLength).reduce((e,t)=>e+t)),r=0;return e.map(e=>new Uint8Array(e)).forEach(e=>{for(let n of e)t[r++]=n}),t.buffer}function m(e,t){if(!(e&&t)||e.byteLength!==t.byteLength)return!1;let r=new Uint8Array(e),n=new Uint8Array(t);for(let t=0;t<e.byteLength;t++)if(r[t]!==n[t])return!1;return!0}f.DEFAULT_UTF8_ENCODING="utf8",t._H=o,t.U$=f,n=p,t.kg=g,t.n4=m},19178:(e,t,r)=>{"use strict";r.d(t,{qW:()=>m});var n,i=r(12115),s=r(85185),o=r(63655),a=r(6101),l=r(39033);function c(e,t=globalThis?.document){let r=(0,l.c)(e);i.useEffect(()=>{let e=e=>{"Escape"===e.key&&r(e)};return t.addEventListener("keydown",e,{capture:!0}),()=>t.removeEventListener("keydown",e,{capture:!0})},[r,t])}var u=r(95155),h="DismissableLayer",d="dismissableLayer.update",f="dismissableLayer.pointerDownOutside",p="dismissableLayer.focusOutside",g=i.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),m=i.forwardRef((e,t)=>{var r,l;let{disableOutsidePointerEvents:h=!1,onEscapeKeyDown:f,onPointerDownOutside:p,onFocusOutside:m,onInteractOutside:y,onDismiss:E,...A}=e,x=i.useContext(g),[S,k]=i.useState(null),_=null!=(l=null==S?void 0:S.ownerDocument)?l:null==(r=globalThis)?void 0:r.document,[,I]=i.useState({}),C=(0,a.s)(t,e=>k(e)),T=Array.from(x.layers),[P]=[...x.layersWithOutsidePointerEventsDisabled].slice(-1),R=T.indexOf(P),O=S?T.indexOf(S):-1,N=x.layersWithOutsidePointerEventsDisabled.size>0,D=O>=R,B=b(e=>{let t=e.target,r=[...x.branches].some(e=>e.contains(t));D&&!r&&(null==p||p(e),null==y||y(e),e.defaultPrevented||null==E||E())},_),M=w(e=>{let t=e.target;![...x.branches].some(e=>e.contains(t))&&(null==m||m(e),null==y||y(e),e.defaultPrevented||null==E||E())},_);return c(e=>{O===x.layers.size-1&&(null==f||f(e),!e.defaultPrevented&&E&&(e.preventDefault(),E()))},_),i.useEffect(()=>{if(S)return h&&(0===x.layersWithOutsidePointerEventsDisabled.size&&(n=_.body.style.pointerEvents,_.body.style.pointerEvents="none"),x.layersWithOutsidePointerEventsDisabled.add(S)),x.layers.add(S),v(),()=>{h&&1===x.layersWithOutsidePointerEventsDisabled.size&&(_.body.style.pointerEvents=n)}},[S,_,h,x]),i.useEffect(()=>()=>{S&&(x.layers.delete(S),x.layersWithOutsidePointerEventsDisabled.delete(S),v())},[S,x]),i.useEffect(()=>{let e=()=>I({});return document.addEventListener(d,e),()=>document.removeEventListener(d,e)},[]),(0,u.jsx)(o.sG.div,{...A,ref:C,style:{pointerEvents:N?D?"auto":"none":void 0,...e.style},onFocusCapture:(0,s.m)(e.onFocusCapture,M.onFocusCapture),onBlurCapture:(0,s.m)(e.onBlurCapture,M.onBlurCapture),onPointerDownCapture:(0,s.m)(e.onPointerDownCapture,B.onPointerDownCapture)})});m.displayName=h;var y="DismissableLayerBranch";function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(()=>{var e;return null==(e=globalThis)?void 0:e.document})(),r=(0,l.c)(e),n=i.useRef(!1),s=i.useRef(()=>{});return i.useEffect(()=>{let e=e=>{if(e.target&&!n.current){let n=function(){E(f,r,i,{discrete:!0})},i={originalEvent:e};"touch"===e.pointerType?(t.removeEventListener("click",s.current),s.current=n,t.addEventListener("click",s.current,{once:!0})):n()}else t.removeEventListener("click",s.current);n.current=!1},i=window.setTimeout(()=>{t.addEventListener("pointerdown",e)},0);return()=>{window.clearTimeout(i),t.removeEventListener("pointerdown",e),t.removeEventListener("click",s.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(()=>{var e;return null==(e=globalThis)?void 0:e.document})(),r=(0,l.c)(e),n=i.useRef(!1);return i.useEffect(()=>{let e=e=>{e.target&&!n.current&&E(p,r,{originalEvent:e},{discrete:!1})};return t.addEventListener("focusin",e),()=>t.removeEventListener("focusin",e)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function v(){let e=new CustomEvent(d);document.dispatchEvent(e)}function E(e,t,r,n){let{discrete:i}=n,s=r.originalEvent.target,a=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&s.addEventListener(e,t,{once:!0}),i?(0,o.hO)(s,a):s.dispatchEvent(a)}i.forwardRef((e,t)=>{let r=i.useContext(g),n=i.useRef(null),s=(0,a.s)(t,n);return i.useEffect(()=>{let e=n.current;if(e)return r.branches.add(e),()=>{r.branches.delete(e)}},[r.branches]),(0,u.jsx)(o.sG.div,{...e,ref:s})}).displayName=y},20492:(e,t,r)=>{"use strict";var n=r(80228).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(e){var t;if(!e)return"utf8";for(;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function o(e){var t=s(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw Error("Unknown encoding: "+e);return t||e}function a(e){var t;switch(this.encoding=o(e),this.encoding){case"utf16le":this.text=p,this.end=g,t=4;break;case"utf8":this.fillLast=h,t=4;break;case"base64":this.text=m,this.end=y,t=3;break;default:this.write=b,this.end=w;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function l(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function c(e,t,r){var n=t.length-1;if(n<r)return 0;var i=l(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||-2===i?0:(i=l(t[n]))>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||-2===i?0:(i=l(t[n]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}function u(e,t,r){if((192&t[0])!=128)return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if((192&t[1])!=128)return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&(192&t[2])!=128)return e.lastNeed=2,""}}function h(e){var t=this.lastTotal-this.lastNeed,r=u(this,e,t);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):void(e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length)}function d(e,t){var r=c(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)}function f(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t}function p(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function g(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function m(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function y(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function b(e){return e.toString(this.encoding)}function w(e){return e&&e.length?this.write(e):""}t.StringDecoder=a,a.prototype.write=function(e){var t,r;if(0===e.length)return"";if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},a.prototype.end=f,a.prototype.text=d,a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},21589:(e,t,r)=>{"use strict";var n=r(45329),i=r(71033),s=r(10681);e.exports=n?function(e){return n(e)}:i?function(e){if(!e||"object"!=typeof e&&"function"!=typeof e)throw TypeError("getProto: not an object");return i(e)}:s?function(e){return s(e)}:null},22169:(e,t,r)=>{"use strict";let n;r.d(t,{W:()=>KZ});var i,s,o,a,l,c,u,h,d,f,p,g,m,y,b,w,v,E,A,x,S,k,_,I,C,T,P,R,O,N,D,B,M,L,F,U,j,$,H,q,z,V,K,G,W,Q,J,Z,Y,X,ee,et,er,en,ei,es,eo,ea,el,ec,eu,eh,ed,ef,ep,eg,em,ey,eb,ew,ev,eE,eA,ex,eS,ek,e_,eI,eC,eT,eP,eR,eO,eN,eD,eB,eM,eL,eF,eU,ej,e$,eH,eq,ez,eV,eK,eG,eW,eQ,eJ,eZ,eY,eX,e0,e1,e2,e3,e4,e5,e6,e8,e7,e9,te,tt,tr,tn,ti,ts,to,ta,tl,tc,tu,th,td,tf,tp,tg,tm,ty,tb,tw,tv,tE,tA,tx,tS,tk,t_,tI,tC,tT,tP,tR,tO,tN,tD,tB,tM,tL,tF,tU,tj,t$,tH,tq,tz,tV,tK,tG,tW,tQ,tJ,tZ,tY,tX,t0={};r.r(t0),r.d(t0,{code:()=>rU,createLink:()=>rM,createNode:()=>rB,decode:()=>r$,encode:()=>rj,name:()=>rF,prepare:()=>rN,validate:()=>rD});var t1={};r.r(t1),r.d(t1,{code:()=>ab,decode:()=>av,decodeOptions:()=>am,encode:()=>aw,encodeOptions:()=>af,name:()=>ay,toByteView:()=>ah});var t2={};r.r(t2),r.d(t2,{code:()=>aB,decode:()=>aL,encode:()=>aM,format:()=>aF,name:()=>aD,parse:()=>aj,stringify:()=>aF});var t3={};function t4(e){return null!=e[Symbol.asyncIterator]}r.r(t3),r.d(t3,{Any:()=>Aj,BaseBlock:()=>EV,BaseStringBlock:()=>EG,BitString:()=>Ae,BmpString:()=>AE,Boolean:()=>E6,CharacterString:()=>AO,Choice:()=>A$,Constructed:()=>E1,DATE:()=>AB,DateTime:()=>AL,Duration:()=>AF,EndOfContent:()=>E3,Enumerated:()=>Ao,GeneralString:()=>AR,GeneralizedTime:()=>AD,GraphicString:()=>AT,HexBlock:()=>EU,IA5String:()=>AC,Integer:()=>As,Null:()=>E4,NumericString:()=>AS,ObjectIdentifier:()=>Ac,OctetString:()=>E7,Primitive:()=>EQ,PrintableString:()=>Ak,RawData:()=>Aq,RelativeObjectIdentifier:()=>Ad,Repeated:()=>AH,Sequence:()=>Af,Set:()=>Ap,TIME:()=>AU,TeletexString:()=>A_,TimeOfDay:()=>AM,UTCTime:()=>AN,UniversalString:()=>Ax,Utf8String:()=>Aw,ValueBlock:()=>E$,VideotexString:()=>AI,ViewWriter:()=>Ev,VisibleString:()=>AP,compareSchema:()=>Az,fromBER:()=>EY,verifySchema:()=>AV});let t5=function(e){if(t4(e))return(async()=>{for await(let t of e)return t})();for(let t of e)return t};function t6(e){return null!=e[Symbol.asyncIterator]}let t8=function(e,t=1){return(t=Number(t),t6(e))?async function*(){let r=[];if(t<1&&(t=1),t!==Math.round(t))throw Error("Batch size must be an integer");for await(let n of e)for(r.push(n);r.length>=t;)yield r.slice(0,t),r=r.slice(t);for(;r.length>0;)yield r.slice(0,t),r=r.slice(t)}():function*(){let r=[];if(t<1&&(t=1),t!==Math.round(t))throw Error("Batch size must be an integer");for(let n of e)for(r.push(n);r.length>=t;)yield r.slice(0,t),r=r.slice(t);for(;r.length>0;)yield r.slice(0,t),r=r.slice(t)}()};async function*t7(e,t=1){for await(let r of t8(e,t)){let e=r.map(async e=>e().then(e=>({ok:!0,value:e}),e=>({ok:!1,err:e})));for(let t=0;t<e.length;t++){let r=await e[t];if(r.ok)yield r.value;else throw r.err}}}var t9=r(18593);function re(e){return e}function rt(e,t){null==t&&(t=e.reduce((e,t)=>e+t.length,0));let r=(0,t9.K)(t),n=0;for(let t of e)r.set(t,n),n+=t.length;return re(r)}function rr(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}let rn=Symbol.for("@achingbrain/uint8arraylist");function ri(e,t){if(null==t||t<0)throw RangeError("index is out of bounds");let r=0;for(let n of e){let e=r+n.byteLength;if(t<e)return{buf:n,index:t-r};r=e}throw RangeError("index is out of bounds")}function rs(e){return!!e?.[rn]}class ro{bufs;length;[rn]=!0;constructor(...e){this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(let r of e)if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.push(r);else if(rs(r))t+=r.byteLength,this.bufs.push(...r.bufs);else throw Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(let r of e.reverse())if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.unshift(r);else if(rs(r))t+=r.byteLength,this.bufs.unshift(...r.bufs);else throw Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){let t=ri(this.bufs,e);return t.buf[t.index]}set(e,t){let r=ri(this.bufs,e);r.buf[r.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let r=0;r<e.length;r++)this.set(t+r,e[r]);else if(rs(e))for(let r=0;r<e.length;r++)this.set(t+r,e.get(r));else throw Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(!Number.isNaN(e=Math.trunc(e))&&!(e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){let{bufs:r,length:n}=this._subList(e,t);return rt(r,n)}subarray(e,t){let{bufs:r,length:n}=this._subList(e,t);return 1===r.length?r[0]:rt(r,n)}sublist(e,t){let{bufs:r,length:n}=this._subList(e,t),i=new ro;return i.length=n,i.bufs=[...r],i}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(0===e&&t===this.length)return{bufs:this.bufs,length:this.length};let r=[],n=0;for(let i=0;i<this.bufs.length;i++){let s=this.bufs[i],o=n,a=o+s.byteLength;if(n=a,e>=a)continue;let l=e>=o&&e<a,c=t>o&&t<=a;if(l&&c){if(e===o&&t===a){r.push(s);break}let n=e-o;r.push(s.subarray(n,n+(t-e)));break}if(l){if(0===e){r.push(s);continue}r.push(s.subarray(e-o));continue}if(c){if(t===a){r.push(s);break}r.push(s.subarray(0,t-o));break}r.push(s)}return{bufs:r,length:t-e}}indexOf(e,t=0){let r;if(!rs(e)&&!(e instanceof Uint8Array))throw TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=e instanceof Uint8Array?e:e.subarray();if(isNaN(t=Number(t??0))&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),0===e.length)return t>this.length?this.length:t;let i=n.byteLength;if(0===i)throw TypeError("search must be at least 1 byte long");let s=256,o=new Int32Array(256);for(let e=0;e<s;e++)o[e]=-1;for(let e=0;e<i;e++)o[n[e]]=e;let a=o,l=this.byteLength-n.byteLength,c=n.byteLength-1;for(let e=t;e<=l;e+=r){r=0;for(let t=c;t>=0;t--){let i=this.get(e+t);if(n[t]!==i){r=Math.max(1,t-a[i]);break}}if(0===r)return e}return -1}getInt8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){let r=(0,t9.K)(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt8(0,t),this.write(r,e)}getInt16(e,t){let r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt16(0,t)}setInt16(e,t,r){let n=(0,t9.c)(2);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt16(0,t,r),this.write(n,e)}getInt32(e,t){let r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt32(0,t)}setInt32(e,t,r){let n=(0,t9.c)(4);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt32(0,t,r),this.write(n,e)}getBigInt64(e,t){let r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigInt64(0,t)}setBigInt64(e,t,r){let n=(0,t9.c)(8);new DataView(n.buffer,n.byteOffset,n.byteLength).setBigInt64(0,t,r),this.write(n,e)}getUint8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){let r=(0,t9.K)(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint8(0,t),this.write(r,e)}getUint16(e,t){let r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint16(0,t)}setUint16(e,t,r){let n=(0,t9.c)(2);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint16(0,t,r),this.write(n,e)}getUint32(e,t){let r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint32(0,t)}setUint32(e,t,r){let n=(0,t9.c)(4);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint32(0,t,r),this.write(n,e)}getBigUint64(e,t){let r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigUint64(0,t)}setBigUint64(e,t,r){let n=(0,t9.c)(8);new DataView(n.buffer,n.byteOffset,n.byteLength).setBigUint64(0,t,r),this.write(n,e)}getFloat32(e,t){let r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat32(0,t)}setFloat32(e,t,r){let n=(0,t9.c)(4);new DataView(n.buffer,n.byteOffset,n.byteLength).setFloat32(0,t,r),this.write(n,e)}getFloat64(e,t){let r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat64(0,t)}setFloat64(e,t,r){let n=(0,t9.c)(8);new DataView(n.buffer,n.byteOffset,n.byteLength).setFloat64(0,t,r),this.write(n,e)}equals(e){if(null==e||!(e instanceof ro)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!rr(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){let r=new ro;return r.bufs=e,null==t&&(t=e.reduce((e,t)=>e+t.byteLength,0)),r.length=t,r}}let ra=262144,rl=(e={})=>{let t=e.chunkSize??ra;return async function*(e){let r=new ro,n=0,i=!1;for await(let s of e)for(r.append(s),n+=s.length;n>=t;)if(yield r.slice(0,t),i=!0,t===r.length)r=new ro,n=0;else{let e=new ro;e.append(r.sublist(t)),r=e,n-=t}(!i||n>0)&&(yield r.subarray(0,n))}};var rc=r(69685);let ru=new TextDecoder;function rh(e,t){let r=0;for(let n=0;;n+=7){if(n>=64)throw Error("protobuf: varint overflow");if(t>=e.length)throw Error("protobuf: unexpected end of data");let i=e[t++];if(r+=n<28?(127&i)<<n:(127&i)*2**n,i<128)break}return[r,t]}function rd(e,t){let r;[r,t]=rh(e,t);let n=t+r;if(r<0||n<0)throw Error("protobuf: invalid length");if(n>e.length)throw Error("protobuf: unexpected end of data");return[e.subarray(t,n),n]}function rf(e,t){let r;return[r,t]=rh(e,t),[7&r,r>>3,t]}function rp(e){let t={},r=e.length,n=0;for(;n<r;){let r,i;if([r,i,n]=rf(e,n),1===i){if(t.Hash)throw Error("protobuf: (PBLink) duplicate Hash section");if(2!==r)throw Error(`protobuf: (PBLink) wrong wireType (${r}) for Hash`);if(void 0!==t.Name)throw Error("protobuf: (PBLink) invalid order, found Name before Hash");if(void 0!==t.Tsize)throw Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[t.Hash,n]=rd(e,n)}else if(2===i){let i;if(void 0!==t.Name)throw Error("protobuf: (PBLink) duplicate Name section");if(2!==r)throw Error(`protobuf: (PBLink) wrong wireType (${r}) for Name`);if(void 0!==t.Tsize)throw Error("protobuf: (PBLink) invalid order, found Tsize before Name");[i,n]=rd(e,n),t.Name=ru.decode(i)}else if(3===i){if(void 0!==t.Tsize)throw Error("protobuf: (PBLink) duplicate Tsize section");if(0!==r)throw Error(`protobuf: (PBLink) wrong wireType (${r}) for Tsize`);[t.Tsize,n]=rh(e,n)}else throw Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${i}`)}if(n>r)throw Error("protobuf: (PBLink) unexpected end of data");return t}function rg(e){let t,r,n=e.length,i=0,s=!1;for(;i<n;){let n,o;if([n,o,i]=rf(e,i),2!==n)throw Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${n}`);if(1===o){if(r)throw Error("protobuf: (PBNode) duplicate Data section");[r,i]=rd(e,i),t&&(s=!0)}else if(2===o){let r;if(s)throw Error("protobuf: (PBNode) duplicate Links section");t||(t=[]),[r,i]=rd(e,i),t.push(rp(r))}else throw Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${o}`)}if(i>n)throw Error("protobuf: (PBNode) unexpected end of data");let o={};return r&&(o.Data=r),o.Links=t||[],o}let rm=new TextEncoder,ry=0x100000000,rb=0x80000000;function rw(e,t){let r=t.length;if("number"==typeof e.Tsize){if(e.Tsize<0)throw Error("Tsize cannot be negative");if(!Number.isSafeInteger(e.Tsize))throw Error("Tsize too large for encoding");r=rx(t,r,e.Tsize)-1,t[r]=24}if("string"==typeof e.Name){let n=rm.encode(e.Name);r-=n.length,t.set(n,r),r=rx(t,r,n.length)-1,t[r]=18}return e.Hash&&(r-=e.Hash.length,t.set(e.Hash,r),r=rx(t,r,e.Hash.length)-1,t[r]=10),t.length-r}function rv(e){let t=rA(e),r=new Uint8Array(t),n=t;if(e.Data&&(n-=e.Data.length,r.set(e.Data,n),n=rx(r,n,e.Data.length)-1,r[n]=10),e.Links)for(let t=e.Links.length-1;t>=0;t--){let i=rw(e.Links[t],r.subarray(0,n));n-=i,n=rx(r,n,i)-1,r[n]=18}return r}function rE(e){let t=0;if(e.Hash){let r=e.Hash.length;t+=1+r+rS(r)}if("string"==typeof e.Name){let r=rm.encode(e.Name).length;t+=1+r+rS(r)}return"number"==typeof e.Tsize&&(t+=1+rS(e.Tsize)),t}function rA(e){let t=0;if(e.Data){let r=e.Data.length;t+=1+r+rS(r)}if(e.Links)for(let r of e.Links){let e=rE(r);t+=1+e+rS(e)}return t}function rx(e,t,r){let n=t-=rS(r);for(;r>=rb;)e[t++]=127&r|128,r/=128;for(;r>=128;)e[t++]=127&r|128,r>>>=7;return e[t]=r,n}function rS(e){return e%2==0&&e++,Math.floor((rk(e)+6)/7)}function rk(e){let t=0;return e>=ry&&(e=Math.floor(e/ry),t=32),e>=65536&&(e>>>=16,t+=16),e>=256&&(e>>>=8,t+=8),t+r_[e]}let r_=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],rI=["Data","Links"],rC=["Hash","Name","Tsize"],rT=new TextEncoder;function rP(e,t){if(e===t)return 0;let r=e.Name?rT.encode(e.Name):[],n=t.Name?rT.encode(t.Name):[],i=r.length,s=n.length;for(let e=0,t=Math.min(i,s);e<t;++e)if(r[e]!==n[e]){i=r[e],s=n[e];break}return i<s?-1:+(s<i)}function rR(e,t){return!Object.keys(e).some(e=>!t.includes(e))}function rO(e){if("object"==typeof e.asCID){let t=rc.TO.asCID(e);if(!t)throw TypeError("Invalid DAG-PB form");return{Hash:t}}if("object"!=typeof e||Array.isArray(e))throw TypeError("Invalid DAG-PB form");let t={};if(e.Hash){let r=rc.TO.asCID(e.Hash);try{!r&&("string"==typeof e.Hash?r=rc.TO.parse(e.Hash):e.Hash instanceof Uint8Array&&(r=rc.TO.decode(e.Hash)))}catch(e){throw TypeError(`Invalid DAG-PB form: ${e.message}`)}r&&(t.Hash=r)}if(!t.Hash)throw TypeError("Invalid DAG-PB form");return"string"==typeof e.Name&&(t.Name=e.Name),"number"==typeof e.Tsize&&(t.Tsize=e.Tsize),t}function rN(e){if((e instanceof Uint8Array||"string"==typeof e)&&(e={Data:e}),"object"!=typeof e||Array.isArray(e))throw TypeError("Invalid DAG-PB form");let t={};if(void 0!==e.Data)if("string"==typeof e.Data)t.Data=rT.encode(e.Data);else if(e.Data instanceof Uint8Array)t.Data=e.Data;else throw TypeError("Invalid DAG-PB form");if(void 0!==e.Links)if(Array.isArray(e.Links))t.Links=e.Links.map(rO),t.Links.sort(rP);else throw TypeError("Invalid DAG-PB form");else t.Links=[];return t}function rD(e){if(!e||"object"!=typeof e||Array.isArray(e)||e instanceof Uint8Array||e["/"]&&e["/"]===e.bytes)throw TypeError("Invalid DAG-PB form");if(!rR(e,rI))throw TypeError("Invalid DAG-PB form (extraneous properties)");if(void 0!==e.Data&&!(e.Data instanceof Uint8Array))throw TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(e.Links))throw TypeError("Invalid DAG-PB form (Links must be a list)");for(let t=0;t<e.Links.length;t++){let r=e.Links[t];if(!r||"object"!=typeof r||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw TypeError("Invalid DAG-PB form (bad link)");if(!rR(r,rC))throw TypeError("Invalid DAG-PB form (extraneous properties on link)");if(void 0===r.Hash)throw TypeError("Invalid DAG-PB form (link must have a Hash)");if(null==r.Hash||!r.Hash["/"]||r.Hash["/"]!==r.Hash.bytes)throw TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(void 0!==r.Name&&"string"!=typeof r.Name)throw TypeError("Invalid DAG-PB form (link Name must be a string)");if(void 0!==r.Tsize){if("number"!=typeof r.Tsize||r.Tsize%1!=0)throw TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(r.Tsize<0)throw TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(t>0&&-1===rP(r,e.Links[t-1]))throw TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function rB(e,t=[]){return rN({Data:e,Links:t})}function rM(e,t,r){return rO({Hash:r,Name:e,Tsize:t})}function rL(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}let rF="dag-pb",rU=112;function rj(e){rD(e);let t={};return e.Links&&(t.Links=e.Links.map(e=>{let t={};return e.Hash&&(t.Hash=e.Hash.bytes),void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t})),e.Data&&(t.Data=e.Data),rv(t)}function r$(e){let t=rg(rL(e)),r={};return t.Data&&(r.Data=t.Data),t.Links&&(r.Links=t.Links.map(e=>{let t={};try{t.Hash=rc.TO.decode(e.Hash)}catch(e){}if(!t.Hash)throw Error("Invalid Hash field found in link, expected CID");return void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t})),r}class rH extends Error{static name="InvalidTypeError";static code="ERR_INVALID_TYPE";name=rH.name;code=rH.code;constructor(e="Invalid type"){super(e)}}let rq=128,rz=16384,rV=2097152,rK=0x10000000,rG=0x800000000,rW=0x40000000000,rQ=0x2000000000000,rJ=128,rZ=127;function rY(e){if(e<rq)return 1;if(e<rz)return 2;if(e<rV)return 3;if(e<rK)return 4;if(e<rG)return 5;if(e<rW)return 6;if(e<rQ)return 7;if(null!=Number.MAX_SAFE_INTEGER&&e>Number.MAX_SAFE_INTEGER)throw RangeError("Could not encode varint");return 8}function rX(e,t,r=0){switch(rY(e)){case 8:t[r++]=255&e|rJ,e/=128;case 7:t[r++]=255&e|rJ,e/=128;case 6:t[r++]=255&e|rJ,e/=128;case 5:t[r++]=255&e|rJ,e/=128;case 4:t[r++]=255&e|rJ,e>>>=7;case 3:t[r++]=255&e|rJ,e>>>=7;case 2:t[r++]=255&e|rJ,e>>>=7;case 1:t[r++]=255&e,e>>>=7;break;default:throw Error("unreachable")}return t}function r0(e,t,r=0){switch(rY(e)){case 8:t.set(r++,255&e|rJ),e/=128;case 7:t.set(r++,255&e|rJ),e/=128;case 6:t.set(r++,255&e|rJ),e/=128;case 5:t.set(r++,255&e|rJ),e/=128;case 4:t.set(r++,255&e|rJ),e>>>=7;case 3:t.set(r++,255&e|rJ),e>>>=7;case 2:t.set(r++,255&e|rJ),e>>>=7;case 1:t.set(r++,255&e),e>>>=7;break;default:throw Error("unreachable")}return t}function r1(e,t){let r,n=e[t];if(r=0+(n&rZ),n<rJ||(r+=((n=e[t+1])&rZ)<<7,n<rJ)||(r+=((n=e[t+2])&rZ)<<14,n<rJ)||(r+=((n=e[t+3])&rZ)<<21,n<rJ)||(r+=((n=e[t+4])&rZ)*rK,n<rJ)||(r+=((n=e[t+5])&rZ)*rG,n<rJ)||(r+=((n=e[t+6])&rZ)*rW,n<rJ)||(r+=((n=e[t+7])&rZ)*rQ,n<rJ))return r;throw RangeError("Could not decode varint")}function r2(e,t){let r,n=e.get(t);if(r=0+(n&rZ),n<rJ||(r+=((n=e.get(t+1))&rZ)<<7,n<rJ)||(r+=((n=e.get(t+2))&rZ)<<14,n<rJ)||(r+=((n=e.get(t+3))&rZ)<<21,n<rJ)||(r+=((n=e.get(t+4))&rZ)*rK,n<rJ)||(r+=((n=e.get(t+5))&rZ)*rG,n<rJ)||(r+=((n=e.get(t+6))&rZ)*rW,n<rJ)||(r+=((n=e.get(t+7))&rZ)*rQ,n<rJ))return r;throw RangeError("Could not decode varint")}function r3(e,t,r=0){return(null==t&&(t=(0,t9.K)(rY(e))),t instanceof Uint8Array)?rX(e,t,r):r0(e,t,r)}function r4(e,t=0){return e instanceof Uint8Array?r1(e,t):r2(e,t)}let r5=new Float32Array([-0]),r6=new Uint8Array(r5.buffer);function r8(e,t,r){r5[0]=e,t[r]=r6[0],t[r+1]=r6[1],t[r+2]=r6[2],t[r+3]=r6[3]}function r7(e,t){return r6[0]=e[t],r6[1]=e[t+1],r6[2]=e[t+2],r6[3]=e[t+3],r5[0]}let r9=new Float64Array([-0]),ne=new Uint8Array(r9.buffer);function nt(e,t,r){r9[0]=e,t[r]=ne[0],t[r+1]=ne[1],t[r+2]=ne[2],t[r+3]=ne[3],t[r+4]=ne[4],t[r+5]=ne[5],t[r+6]=ne[6],t[r+7]=ne[7]}function nr(e,t){return ne[0]=e[t],ne[1]=e[t+1],ne[2]=e[t+2],ne[3]=e[t+3],ne[4]=e[t+4],ne[5]=e[t+5],ne[6]=e[t+6],ne[7]=e[t+7],r9[0]}let nn=BigInt(Number.MAX_SAFE_INTEGER),ni=BigInt(Number.MIN_SAFE_INTEGER);class ns{lo;hi;constructor(e,t){this.lo=0|e,this.hi=0|t}toNumber(e=!1){if(!e&&this.hi>>>31>0){let e=~this.lo+1>>>0,t=~this.hi>>>0;return 0===e&&(t=t+1>>>0),-(e+0x100000000*t)}return this.lo+0x100000000*this.hi}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31!=0){let e=~this.lo+1>>>0,t=~this.hi>>>0;return 0===e&&(t=t+1>>>0),-(BigInt(e)+(BigInt(t)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){let e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){let e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){let e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}static fromBigInt(e){if(0n===e)return no;if(e<nn&&e>ni)return this.fromNumber(Number(e));let t=e<0n;t&&(e=-e);let r=e>>32n,n=e-(r<<32n);return t&&(r=0n|~r,n=0n|~n,++n>na&&(n=0n,++r>na&&(r=0n))),new ns(Number(n),Number(r))}static fromNumber(e){if(0===e)return no;let t=e<0;t&&(e=-e);let r=e>>>0,n=(e-r)/0x100000000>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>0xffffffff&&(r=0,++n>0xffffffff&&(n=0))),new ns(r,n)}static from(e){return"number"==typeof e?ns.fromNumber(e):"bigint"==typeof e?ns.fromBigInt(e):"string"==typeof e?ns.fromBigInt(BigInt(e)):null!=e.low||null!=e.high?new ns(e.low>>>0,e.high>>>0):no}}let no=new ns(0,0);no.toBigInt=function(){return 0n},no.zzEncode=no.zzDecode=function(){return this},no.length=function(){return 1};let na=4294967296n;function nl(e){let t=0,r=0;for(let n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:(64512&r)==55296&&(64512&e.charCodeAt(n+1))==56320?(++n,t+=4):t+=3;return t}function nc(e,t,r){let n,i;if(r-t<1)return"";let s=[],o=0;for(;t<r;)(i=e[t++])<128?s[o++]=i:i>191&&i<224?s[o++]=(31&i)<<6|63&e[t++]:i>239&&i<365?(i=((7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[o++]=55296+(i>>10),s[o++]=56320+(1023&i)):s[o++]=(15&i)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((n??(n=[])).push(String.fromCharCode.apply(String,s)),o=0);return null!=n?(o>0&&n.push(String.fromCharCode.apply(String,s.slice(0,o))),n.join("")):String.fromCharCode.apply(String,s.slice(0,o))}function nu(e,t,r){let n,i,s=r;for(let s=0;s<e.length;++s)(n=e.charCodeAt(s))<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:((64512&n)==55296&&(64512&(i=e.charCodeAt(s+1)))==56320?(n=65536+((1023&n)<<10)+(1023&i),++s,t[r++]=n>>18|240,t[r++]=n>>12&63|128):t[r++]=n>>12|224,t[r++]=n>>6&63|128),t[r++]=63&n|128);return r-s}function nh(e,t){return RangeError(`index out of range: ${e.pos} + ${t??1} > ${e.len}`)}function nd(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}class nf{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(e){this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=0xffffffff;if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,nh(this,10);return e}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}bool(){return 0!==this.uint32()}fixed32(){if(this.pos+4>this.len)throw nh(this,4);return nd(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw nh(this,4);return 0|nd(this.buf,this.pos+=4)}float(){if(this.pos+4>this.len)throw nh(this,4);let e=r7(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw nh(this,4);let e=nr(this.buf,this.pos);return this.pos+=8,e}bytes(){let e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw nh(this,e);return this.pos+=e,t===r?new Uint8Array(0):this.buf.subarray(t,r)}string(){let e=this.bytes();return nc(e,0,e.length)}skip(e){if("number"==typeof e){if(this.pos+e>this.len)throw nh(this,e);this.pos+=e}else do if(this.pos>=this.len)throw nh(this);while((128&this.buf[this.pos++])!=0);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){let e=new ns(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw nh(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw nh(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw nh(this,8);return new ns(nd(this.buf,this.pos+=4),nd(this.buf,this.pos+=4))}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let e=r1(this.buf,this.pos);return this.pos+=rY(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function np(e){return new nf(e instanceof Uint8Array?e:e.subarray())}function ng(e,t,r){let n=np(e);return t.decode(n,void 0,r)}var nm=r(22938);function ny(e){let t,r=e??8192,n=r>>>1,i=r;return function(e){if(e<1||e>n)return(0,t9.K)(e);i+e>r&&(t=(0,t9.K)(r),i=0);let s=t.subarray(i,i+=e);return(7&i)!=0&&(i=(7|i)+1),s}}class nb{fn;len;next;val;constructor(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}}function nw(){}class nv{head;tail;len;next;constructor(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}let nE=ny();function nA(e){return null!=globalThis.Buffer?(0,t9.K)(e):nE(e)}class nx{len;head;tail;states;constructor(){this.len=0,this.head=new nb(nw,0,0),this.tail=this.head,this.states=null}_push(e,t,r){return this.tail=this.tail.next=new nb(e,t,r),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new n_((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<0x10000000?4:5,e)).len,this}int32(e){return e<0?this._push(nI,10,ns.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){let t=ns.fromBigInt(e);return this._push(nI,t.length(),t)}uint64Number(e){return this._push(rX,rY(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){let t=ns.fromBigInt(e).zzEncode();return this._push(nI,t.length(),t)}sint64Number(e){let t=ns.fromNumber(e).zzEncode();return this._push(nI,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(nS,1,+!!e)}fixed32(e){return this._push(nC,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){let t=ns.fromBigInt(e);return this._push(nC,4,t.lo)._push(nC,4,t.hi)}fixed64Number(e){let t=ns.fromNumber(e);return this._push(nC,4,t.lo)._push(nC,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(r8,4,e)}double(e){return this._push(nt,8,e)}bytes(e){let t=e.length>>>0;return 0===t?this._push(nS,1,0):this.uint32(t)._push(nT,t,e)}string(e){let t=nl(e);return 0!==t?this.uint32(t)._push(nu,t,e):this._push(nS,1,0)}fork(){return this.states=new nv(this),this.head=this.tail=new nb(nw,0,0),this.len=0,this}reset(){return null!=this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new nb(nw,0,0),this.len=0),this}ldelim(){let e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),0!==r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this}finish(){let e=this.head.next,t=nA(this.len),r=0;for(;null!=e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t}}function nS(e,t,r){t[r]=255&e}function nk(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}class n_ extends nb{next;constructor(e,t){super(nk,e,t),this.next=void 0}}function nI(e,t,r){for(;0!==e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function nC(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function nT(e,t,r){t.set(e,r)}function nP(e,t,r){t.set(e,r)}function nR(e,t,r){e.length<40?nu(e,t,r):null!=t.utf8Write?t.utf8Write(e,r):t.set((0,nm.s)(e),r)}function nO(){return new nx}function nN(e,t){let r=nO();return t.encode(e,r,{lengthDelimited:!1}),r.finish()}function nD(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function nB(e){function t(t){if(null==e[t.toString()])throw Error("Invalid enum value");return e[t]}let r=function(e,r){let n=t(e);r.int32(n)},n=function(e){return t(e.int32())};return nD("enum",i.VARINT,r,n)}function nM(e,t){return nD("message",i.LENGTH_DELIMITED,e,t)}null!=globalThis.Buffer&&(nx.prototype.bytes=function(e){let t=e.length>>>0;return this.uint32(t),t>0&&this._push(nP,t,e),this},nx.prototype.string=function(e){let t=globalThis.Buffer.byteLength(e);return this.uint32(t),t>0&&this._push(nR,t,e),this}),function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"}(i||(i={}));class nL extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"}class nF extends Error{code="ERR_MAX_SIZE";name="MaxSizeError"}!function(e){let t,r,n;!function(e){e.Raw="Raw",e.Directory="Directory",e.File="File",e.Metadata="Metadata",e.Symlink="Symlink",e.HAMTShard="HAMTShard"}(t=e.DataType||(e.DataType={})),function(e){e[e.Raw=0]="Raw",e[e.Directory=1]="Directory",e[e.File=2]="File",e[e.Metadata=3]="Metadata",e[e.Symlink=4]="Symlink",e[e.HAMTShard=5]="HAMTShard"}(r||(r={})),function(e){e.codec=()=>nB(r)}(t=e.DataType||(e.DataType={})),e.codec=()=>(null==n&&(n=nM((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.Type&&(r.uint32(8),e.DataType.codec().encode(t.Type,r)),null!=t.Data&&(r.uint32(18),r.bytes(t.Data)),null!=t.filesize&&(r.uint32(24),r.uint64(t.filesize)),null!=t.blocksizes)for(let e of t.blocksizes)r.uint32(32),r.uint64(e);null!=t.hashType&&(r.uint32(40),r.uint64(t.hashType)),null!=t.fanout&&(r.uint32(48),r.uint64(t.fanout)),null!=t.mode&&(r.uint32(56),r.uint32(t.mode)),null!=t.mtime&&(r.uint32(66),o.codec().encode(t.mtime,r)),!1!==n.lengthDelimited&&r.ldelim()},(t,r)=>{let n={blocksizes:[]},i=null==r?t.len:t.pos+r;for(;t.pos<i;){let r=t.uint32();switch(r>>>3){case 1:n.Type=e.DataType.codec().decode(t);break;case 2:n.Data=t.bytes();break;case 3:n.filesize=t.uint64();break;case 4:n.blocksizes.push(t.uint64());break;case 5:n.hashType=t.uint64();break;case 6:n.fanout=t.uint64();break;case 7:n.mode=t.uint32();break;case 8:n.mtime=o.codec().decode(t,t.uint32());break;default:t.skipType(7&r)}}return n})),n),e.encode=t=>nN(t,e.codec()),e.decode=t=>ng(t,e.codec())}(s||(s={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Seconds&&(t.uint32(8),t.int64(e.Seconds)),null!=e.FractionalNanoseconds&&(t.uint32(21),t.fixed32(e.FractionalNanoseconds)),!1!==r.lengthDelimited&&t.ldelim()},(e,t)=>{let r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.Seconds=e.int64();break;case 2:r.FractionalNanoseconds=e.fixed32();break;default:e.skipType(7&t)}}return r})),t),e.encode=t=>nN(t,e.codec()),e.decode=t=>ng(t,e.codec())}(o||(o={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.MimeType&&(t.uint32(10),t.string(e.MimeType)),!1!==r.lengthDelimited&&t.ldelim()},(e,t)=>{let r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){let t=e.uint32();t>>>3==1?r.MimeType=e.string():e.skipType(7&t)}return r})),t),e.encode=t=>nN(t,e.codec()),e.decode=t=>ng(t,e.codec())}(a||(a={}));let nU={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},nj=["directory","hamt-sharded-directory"],n$=parseInt("0644",8),nH=parseInt("0755",8);class nq{static unmarshal(e){let t=s.decode(e),r=new nq({type:nU[null!=t.Type?t.Type.toString():"File"],data:t.Data,blockSizes:t.blocksizes,mode:t.mode,mtime:null!=t.mtime?{secs:t.mtime.Seconds??0n,nsecs:t.mtime.FractionalNanoseconds}:void 0,fanout:t.fanout});return r._originalMode=t.mode??0,r}type;data;blockSizes;hashType;fanout;mtime;_mode;_originalMode;constructor(e={type:"file"}){let{type:t,data:r,blockSizes:n,hashType:i,fanout:s,mtime:o,mode:a}=e;if(null!=t&&!Object.values(nU).includes(t))throw new rH("Type: "+t+" is not valid");this.type=t??"file",this.data=r,this.hashType=i,this.fanout=s,this.blockSizes=n??[],this._originalMode=0,this.mode=a,this.mtime=o}set mode(e){null==e?this._mode=this.isDirectory()?nH:n$:this._mode=4095&e}get mode(){return this._mode}isDirectory(){return nj.includes(this.type)}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0n;let e=0n;return this.blockSizes.forEach(t=>{e+=t}),null!=this.data&&(e+=BigInt(this.data.length)),e}marshal(){let e,t,r;switch(this.type){case"raw":e=s.DataType.Raw;break;case"directory":e=s.DataType.Directory;break;case"file":e=s.DataType.File;break;case"metadata":e=s.DataType.Metadata;break;case"symlink":e=s.DataType.Symlink;break;case"hamt-sharded-directory":e=s.DataType.HAMTShard;break;default:throw new rH(`Type: ${e} is not valid`)}let n=this.data;return(null==this.data||0===this.data.length)&&(n=void 0),null!=this.mode&&((t=0xfffff000&this._originalMode|(this.mode??0))!==n$||this.isDirectory()||(t=void 0),t===nH&&this.isDirectory()&&(t=void 0)),null!=this.mtime&&(r={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),s.encode({Type:e,Data:n,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:t,mtime:r})}}var nz=r(34269);class nV extends Event{type;detail;constructor(e,t){super(e),this.type=e,this.detail=t}}var nK=r(97141);let nG=async(e,t,r)=>{null==r.codec&&(r.codec=t0);let n=await nK.sha256.digest(e),i=rc.TO.create(r.cidVersion,r.codec.code,n);return await t.put(i,e,r),i};function nW(e){return async function*(t,r){let n=0n;for await(let i of t.content)yield async()=>{let s,o={codec:t0,cidVersion:e.cidVersion,onProgress:e.onProgress};e.rawLeaves?(o.codec=nz,o.cidVersion=1):i=rj({Data:(s=new nq({type:e.leafType,data:i})).marshal(),Links:[]});let a=await nG(i,r,o);return n+=BigInt(i.byteLength),e.onProgress?.(new nV("unixfs:importer:progress:file:write",{bytesWritten:n,cid:a,path:t.path})),{cid:a,unixfs:s,size:BigInt(i.length),block:i}}}}class nQ extends Error{static name="InvalidParametersError";static code="ERR_INVALID_PARAMS";name=nQ.name;code=nQ.code;constructor(e="Invalid parameters"){super(e)}}class nJ extends Error{static name="InvalidAvgChunkSizeError";static code="ERR_INVALID_AVG_CHUNK_SIZE";name=nJ.name;code=nJ.code;constructor(e="Invalid avg chunk size"){super(e)}}class nZ extends Error{static name="InvalidChunkSizeError";static code="ERR_INVALID_CHUNK_SIZE";name=nZ.name;code=nZ.code;constructor(e="Invalid chunk size"){super(e)}}class nY extends Error{static name="InvalidMinChunkSizeError";static code="ERR_INVALID_MIN_CHUNK_SIZE";name=nY.name;code=nY.code;constructor(e="Invalid min chunk size"){super(e)}}class nX extends Error{static name="InvalidContentError";static code="ERR_INVALID_CONTENT";name=nX.name;code=nX.code;constructor(e="Invalid content"){super(e)}}let n0=async(e,t,r)=>{let n=new nq({type:"directory",mtime:e.mtime,mode:e.mode}),i=rj(rN({Data:n.marshal()}));return{cid:await nG(i,t,r),path:e.path,unixfs:n,size:BigInt(i.length),originalPath:e.originalPath,block:i}};async function*n1(e,t,r){let n,i=-1;for await(let s of t7(r.bufferImporter(e,t),r.blockWriteConcurrency)){if(0==++i){n={...s,single:!0};continue}1===i&&null!=n&&(yield{...n,block:void 0,single:void 0},n=void 0),yield{...s,block:void 0}}null!=n&&(yield n)}function n2(e){return!0===e.single}let n3=(e,t,r)=>async function(n){if(1===n.length&&n2(n[0])&&r.reduceSingleLeafToSelf){let i=n[0],s=i.block;return n2(i)&&(void 0!==e.mtime||void 0!==e.mode)&&(i.unixfs=new nq({type:"file",mtime:e.mtime,mode:e.mode,data:i.block}),s={Data:i.unixfs.marshal(),Links:[]},i.block=rj(rN(s)),i.cid=await nG(i.block,t,{...r,cidVersion:r.cidVersion}),i.size=BigInt(i.block.length)),r.onProgress?.(new nV("unixfs:importer:progress:file:layout",{cid:i.cid,path:i.originalPath})),{cid:i.cid,path:e.path,unixfs:i.unixfs,size:i.size,originalPath:i.originalPath}}let i=new nq({type:"file",mtime:e.mtime,mode:e.mode}),s=n.filter(e=>!!(e.cid.code===nz.code&&e.size>0||null!=e.unixfs&&null==e.unixfs.data&&e.unixfs.fileSize()>0n)||!!e.unixfs?.data?.length).map(e=>(e.cid.code===nz.code?i.addBlockSize(e.size):e.unixfs?.data==null?i.addBlockSize(e.unixfs?.fileSize()??0n):i.addBlockSize(BigInt(e.unixfs.data.length)),{Name:"",Tsize:Number(e.size),Hash:e.cid})),o={Data:i.marshal(),Links:s},a=rj(rN(o)),l=await nG(a,t,r);return r.onProgress?.(new nV("unixfs:importer:progress:file:layout",{cid:l,path:e.originalPath})),{cid:l,path:e.path,unixfs:i,size:BigInt(a.length+o.Links.reduce((e,t)=>e+(t.Tsize??0),0)),originalPath:e.originalPath,block:a}},n4=async(e,t,r)=>r.layout(n1(e,t,r),n3(e,t,r));function n5(e){return Symbol.iterator in e}function n6(e){return Symbol.asyncIterator in e}function n8(e){try{if(e instanceof Uint8Array)return async function*(){yield e}();if(n5(e))return async function*(){yield*e}();if(n6(e))return e}catch{}throw new nX("Content was invalid")}function n7(e){return async function*(t,r){for await(let n of t){let t;if(null!=n.path&&(t=n.path,n.path=n.path.split("/").filter(e=>null!=e&&"."!==e).join("/")),n9(n)){let i={path:n.path,mtime:n.mtime,mode:n.mode,content:async function*(){let t=0n;for await(let r of e.chunker(e.chunkValidator(n8(n.content)))){let i=BigInt(r.byteLength);t+=i,e.onProgress?.(new nV("unixfs:importer:progress:file:read",{bytesRead:t,chunkSize:i,path:n.path})),yield r}}(),originalPath:t};yield async()=>n4(i,r,e)}else if(null!=n.path){let i={path:n.path,mtime:n.mtime,mode:n.mode,originalPath:t};yield async()=>n0(i,r,e)}else throw Error("Import candidate must have content or path or both")}}}function n9(e){return null!=e.content}let ie=()=>async function*(e){for await(let t of e){if(void 0===t.length)throw new nX("Content was invalid");if("string"==typeof t||t instanceof String)yield(0,nm.s)(t.toString());else if(Array.isArray(t))yield Uint8Array.from(t);else if(t instanceof Uint8Array)yield t;else throw new nX("Content was invalid")}},it=174;function ir(e){let t=e?.maxChildrenPerNode??it;return async function e(r,n){let i=[];for await(let e of t8(r,t))i.push(await n(e));return i.length>1?e(i,n):i[0]}}class ii{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}}let is=rc.TO.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),io=rc.TO.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi");class ia extends ii{_children;constructor(e,t){super(e,t),this._children=new Map}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,this._children.set(e,t)}async get(e){return Promise.resolve(this._children.get(e))}childCount(){return this._children.size}directChildrenCount(){return this.childCount()}onlyChild(){return this._children.values().next().value}async *eachChildSeries(){for(let[e,t]of this._children.entries())yield{key:e,child:t}}estimateNodeSize(){if(void 0!==this.nodeSize)return this.nodeSize;for(let[e,t]of(this.nodeSize=0,this._children.entries()))null!=t.size&&null!=t.cid&&(this.nodeSize+=e.length+(1===this.options.cidVersion?io.bytes.byteLength:is.bytes.byteLength));return this.nodeSize}async *flush(e){let t=[];for(let[r,n]of this._children.entries()){let i=n;if(n instanceof ii)for await(let t of n.flush(e))i=t,yield t;null!=i.size&&null!=i.cid&&t.push({Name:r,Tsize:Number(i.size),Hash:i.cid})}let r=new nq({type:"directory",mtime:this.mtime,mode:this.mode}),n={Data:r.marshal(),Links:t},i=rj(rN(n)),s=await nG(i,e,this.options),o=i.length+n.Links.reduce((e,t)=>e+(t.Tsize??0),0);this.cid=s,this.size=o,yield{cid:s,unixfs:r,path:this.path,size:BigInt(o)}}}var il=r(16121),ic=r(65639),iu=r(31588);function ih(e){let t=[,,,,];for(let r=0;r<4;r++)t[r]=255&e,e>>=8;return new Uint8Array(t)}(0,ic.H)({name:"murmur3-32",code:35,encode:e=>ih(iu.x86.hash32(e))});let id=(0,ic.H)({name:"murmur3-128",code:34,encode:e=>il.ee.fromHex(iu.x64.hash128(e))});(0,ic.H)({name:"murmur3-x64-64",code:34,encode:e=>il.ee.fromHex(iu.x64.hash128(e)).subarray(0,8)});var ip=r(84116);class ig{_options;_popCount;_parent;_posAtParent;_children;key;constructor(e,t,r=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=r,this._children=new ip,this.key=null}async put(e,t){let r=await this._findNewBucketAndPos(e);r.bucket._putAt(r,e,t)}async get(e){let t=await this._findChild(e);if(null!=t)return t.value}async del(e){let t=await this._findPlace(e),r=t.bucket._at(t.pos);null!=r&&r.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce((e,t)=>t instanceof ig?e+t.leafCount():e+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){for(let e of this._children.compactArray())e instanceof ig?yield*e.eachLeafSeries():yield e}serialize(e,t){let r=[];return t(this._children.reduce((r,n,i)=>(null!=n&&(n instanceof ig?r.push(n.serialize(e,t)):r.push(e(n,i))),r),r))}async asyncTransform(e,t){return iw(this,e,t)}toJSON(){return this.serialize(iy,ib)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){let t=await this._findPlace(e),r=t.bucket._at(t.pos);if(!(r instanceof ig)&&null!=r&&r.key===e)return r}async _findPlace(e){let t=this._options.hash("string"==typeof e?(0,nm.s)(e):e),r=await t.take(this._options.bits),n=this._children.get(r);return n instanceof ig?n._findPlace(t):{bucket:this,pos:r,hash:t,existingChild:n}}async _findNewBucketAndPos(e){let t=await this._findPlace(e);if(null!=t.existingChild&&t.existingChild.key!==e){let e=new ig(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,e);let r=await e._findPlace(t.existingChild.hash);return r.bucket._putAt(r,t.existingChild.key,t.existingChild.value),e._findNewBucketAndPos(t.hash)}return t}_putAt(e,t,r){this._putObjectAt(e.pos,{key:t,value:r,hash:e.hash})}_putObjectAt(e,t){null==this._children.get(e)&&this._popCount++,this._children.set(e,t)}_delAt(e){if(-1===e)throw Error("Invalid position");null!=this._children.get(e)&&this._popCount--,this._children.unset(e),this._level()}_level(){if(null!=this._parent&&this._popCount<=1)if(1===this._popCount){let e=this._children.find(im);if(null!=e&&!(e instanceof ig)){let t=e.hash;t.untake(this._options.bits);let r={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(r,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}}function im(e){return!!e}function iy(e,t){return e.key}function ib(e){return e}async function iw(e,t,r){let n=[];for(let i of e._children.compactArray())if(i instanceof ig)await iw(i,t,r);else{let r=await t(i);n.push({bitField:e._children.bitField(),children:r})}return r(n)}let iv=[255,254,252,248,240,224,192,128],iE=[1,3,7,15,31,63,127,255];class iA{_value;_currentBytePos;_currentBitPos;constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,r=0;for(;t>0&&this._haveBits();){let e=this._value[this._currentBytePos],n=this._currentBitPos+1,i=Math.min(n,t),s=ix(e,n-i,i);r=(r<<i)+s,t-=i,this._currentBitPos-=i,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return r}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function ix(e,t,r){return(e&iS(t,r))>>>t}function iS(e,t){return iv[e]&iE[Math.min(t+e-1,7)]}function ik(e){return function(t){return t instanceof i_?t:new i_(t,e)}}class i_{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(e,t){if(!(e instanceof Uint8Array))throw Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let r=0;for(;t>0;){let e=this._buffers[this._currentBufferIndex],n=Math.min(e.availableBits(),t),i=e.take(n);r=(r<<n)+i,t-=n,this._availableBits-=n,0===e.availableBits()&&this._currentBufferIndex++}return r}untake(e){let t=e;for(;t>0;){let e=this._buffers[this._currentBufferIndex],r=Math.min(e.totalBits()-e.availableBits(),t);e.untake(r),t-=r,this._availableBits+=r,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;let e=this._depth>0?rt([this._value,Uint8Array.from([this._depth])]):this._value,t=new iA(await this._hashFn(e));this._buffers.push(t),this._availableBits+=t.availableBits()}}function iI(e){if(null==e||null==e.hashFn)throw Error("please define an options.hashFn");return new ig({bits:e.bits??8,hash:ik(e.hashFn)})}async function iC(e){return(await id.encode(e)).slice(0,8).reverse()}let iT=BigInt(34),iP=8;class iR extends ii{_bucket;constructor(e,t){super(e,t),this._bucket=iI({hashFn:iC,bits:t.shardFanoutBits??iP})}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(e,t)}async get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async *eachChildSeries(){for await(let{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return void 0!==this.nodeSize||(this.nodeSize=iB(this._bucket,this,this.options)),this.nodeSize}async *flush(e){for await(let t of iN(this._bucket,e,this,this.options))yield{...t,path:this.path}}}let iO=iR;async function*iN(e,t,r,n){let i=e._children,s=(e.tableSize()-1).toString(16).length,o=[],a=0n;for(let e=0;e<i.length;e++){let r=i.get(e);if(null==r)continue;let l=e.toString(16).toUpperCase().padStart(s,"0");if(r instanceof ig){let e;for await(let i of iN(r,t,null,n))e=i;if(null==e)throw Error("Could not flush sharded directory, no subshard found");o.push({Name:l,Tsize:Number(e.size),Hash:e.cid}),a+=e.size}else if(iD(r.value)){let e;for await(let n of r.value.flush(t))e=n,yield e;if(null==e)throw Error("Did not flush dir");let n=l+r.key;o.push({Name:n,Tsize:Number(e.size),Hash:e.cid}),a+=e.size}else{let e=r.value;if(null==e.cid)continue;let t=l+r.key,n=e.size;o.push({Name:t,Tsize:Number(n),Hash:e.cid}),a+=BigInt(n??0)}}let l=new nq({type:"hamt-sharded-directory",data:Uint8Array.from(i.bitField().reverse()),fanout:BigInt(e.tableSize()),hashType:iT,mtime:r?.mtime,mode:r?.mode}),c=rj(rN({Data:l.marshal(),Links:o})),u=await nG(c,t,n),h=BigInt(c.byteLength)+a;yield{cid:u,unixfs:l,size:h}}function iD(e){return"function"==typeof e.flush}function iB(e,t,r){let n=e._children,i=(e.tableSize()-1).toString(16).length,s=[];for(let e=0;e<n.length;e++){let t=n.get(e);if(null==t)continue;let o=e.toString(16).toUpperCase().padStart(i,"0");if(t instanceof ig){let e=iB(t,null,r);s.push({Name:o,Tsize:Number(e),Hash:0===r.cidVersion?is:io})}else if("function"==typeof t.value.flush){let e=t.value.nodeSize();s.push({Name:o+t.key,Tsize:Number(e),Hash:0===r.cidVersion?is:io})}else{let e=t.value;if(null==e.cid)continue;let r=o+t.key,n=e.size;s.push({Name:r,Tsize:Number(n),Hash:e.cid})}}return rj(rN({Data:new nq({type:"hamt-sharded-directory",data:Uint8Array.from(n.bitField().reverse()),fanout:BigInt(e.tableSize()),hashType:iT,mtime:t?.mtime,mode:t?.mode}).marshal(),Links:s})).length}async function iM(e,t,r,n){let i=t;t instanceof ia&&t.estimateNodeSize()>r&&(i=await iL(t,n));let s=i.parent;if(null!=s){if(i!==t){if(null!=e&&(e.parent=i),null==i.parentKey)throw Error("No parent key found");await s.put(i.parentKey,i)}return iM(i,s,r,n)}return i}async function iL(e,t){let r=new iO({root:e.root,dir:!0,parent:e.parent,parentKey:e.parentKey,path:e.path,dirty:e.dirty,flat:!1,mtime:e.mtime,mode:e.mode},t);for await(let{key:t,child:n}of e.eachChildSeries())await r.put(t,n);return r}let iF=(e="")=>e.split(/(?<!\\)\//).filter(Boolean);async function iU(e,t,r){let n=iF(e.path??""),i=n.length-1,s=t,o="";for(let a=0;a<n.length;a++){let l=n[a];o+=`${""!==o?"/":""}${l}`;let c=a===i;if(s.dirty=!0,s.cid=void 0,s.size=void 0,c)await s.put(l,e),t=await iM(null,s,r.shardSplitThresholdBytes,r);else{let e=await s.get(l);null!=e&&e instanceof ii||(e=new ia({root:!1,dir:!0,parent:s,parentKey:l,path:o,dirty:!0,flat:!0,mtime:e?.unixfs?.mtime,mode:e?.unixfs?.mode},r)),await s.put(l,e),s=e}}return t}async function*ij(e,t){if(!(e instanceof ii)){e.unixfs?.isDirectory()===!0&&(yield e);return}yield*e.flush(t)}function i$(e){return async function*(t,r){let n,i=new ia({root:!0,dir:!0,path:"",dirty:!0,flat:!0},e),s=!1;for await(let r of t){if(null==r)continue;let t=`${r.originalPath??""}`.split("/")[0];null!=t&&""!==t&&(null==n?(n=t,s=!0):n!==t&&(s=!1)),i=await iU(r,i,e),r.unixfs?.isDirectory()!==!0&&(yield r)}if(e.wrapWithDirectory||s&&i.childCount()>1)yield*ij(i,r);else for await(let e of i.eachChildSeries())null!=e&&(yield*ij(e.child,r))}}async function*iH(e,t,r={}){let n;n=Symbol.asyncIterator in e||Symbol.iterator in e?e:[e];let i=r.wrapWithDirectory??!1,s=r.shardSplitThresholdBytes??262144,o=r.shardFanoutBits??8,a=r.cidVersion??1,l=r.rawLeaves??!0,c=r.leafType??"file",u=r.fileImportConcurrency??50,h=r.blockWriteConcurrency??10,d=r.reduceSingleLeafToSelf??!0,f=r.chunker??rl(),p=r.chunkValidator??ie(),g=r.dagBuilder??n7({chunker:f,chunkValidator:p,wrapWithDirectory:i,layout:r.layout??ir(),bufferImporter:r.bufferImporter??nW({cidVersion:a,rawLeaves:l,leafType:c,onProgress:r.onProgress}),blockWriteConcurrency:h,reduceSingleLeafToSelf:d,cidVersion:a,onProgress:r.onProgress});for await(let e of(r.treeBuilder??i$({wrapWithDirectory:i,shardSplitThresholdBytes:s,shardFanoutBits:o,cidVersion:a,onProgress:r.onProgress}))(t7(g(n,t),u),t))yield{cid:e.cid,path:e.path,unixfs:e.unixfs,size:e.size}}async function iq(e,t,r={}){let n=await t5(iH([e],t,r));if(null==n)throw new nQ("Nothing imported");return n}async function iz(e,t,r={}){return iq({content:e},t,r)}async function iV(e,t,r={}){return iq({content:e},t,r)}function iK(e){return null!=e[Symbol.asyncIterator]}let iG=function(e){let t;if(iK(e))return(async()=>{let t;for await(let r of e)t=r;return t})();for(let r of e)t=r;return t};class iW extends Error{name;code;constructor(e,t,r){super(e),this.name=t,this.code=r}}class iQ extends iW{constructor(e="not a Unixfs node"){super(e,"NotUnixFSError","ERR_NOT_UNIXFS")}}class iJ extends iW{constructor(e="invalid PBNode"){super(e,"InvalidPBNodeError","ERR_INVALID_PB_NODE")}}class iZ extends iW{constructor(e="unknown error"){super(e,"InvalidPBNodeError","ERR_UNKNOWN_ERROR")}}class iY extends iW{constructor(e="path already exists"){super(e,"AlreadyExistsError","ERR_ALREADY_EXISTS")}}class iX extends iW{constructor(e="path does not exist"){super(e,"DoesNotExistError","ERR_DOES_NOT_EXIST")}}class i0 extends iW{constructor(e="no content"){super(e,"NoContentError","ERR_NO_CONTENT")}}class i1 extends iW{constructor(e="not a file"){super(e,"NotAFileError","ERR_NOT_A_FILE")}}class i2 extends iW{constructor(e="not a directory"){super(e,"NotADirectoryError","ERR_NOT_A_DIRECTORY")}}class i3 extends iW{constructor(e="invalid parameters"){super(e,"InvalidParametersError","ERR_INVALID_PARAMETERS")}}let i4={cidVersion:1,rawLeaves:!0,layout:ir({maxChildrenPerNode:1024}),chunker:rl({chunkSize:1048576})};async function*i5(e,t,r={}){yield*iH(e,t,{...i4,...r})}async function i6(e,t,r={}){let{cid:n}=await iz(e,t,{...i4,...r});return n}async function i8(e,t,r={}){let{cid:n}=await iV(e,t,{...i4,...r});return n}async function i7(e,t,r={}){if(null==e.path)throw new i3("path is required");if(null==e.content)throw new i3("content is required");let n=await iG(i5([e],t,{...i4,...r,wrapWithDirectory:!0}));if(null==n)throw new i3("Nothing imported");return n.cid}async function i9(e,t,r={}){if(null!=e.content)throw new i3("Directories cannot have content, use addFile instead");let n=null==e.path?t5:iG,i=await n(i5([{...e,path:e.path??"-"}],t,{...i4,...r,wrapWithDirectory:null!=e.path}));if(null==i)throw new i3("Nothing imported");return i.cid}class se extends Error{static name="BadPathError";static code="ERR_BAD_PATH";name=se.name;code=se.code;constructor(e="Bad path"){super(e)}}class st extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=st.name;code=st.code;constructor(e="Not found"){super(e)}}class sr extends Error{static name="NoResolverError";static code="ERR_NO_RESOLVER";name=sr.name;code=sr.code;constructor(e="No resolver"){super(e)}}class sn extends Error{static name="NotUnixFSError";static code="ERR_NOT_UNIXFS";name=sn.name;code=sn.code;constructor(e="Not UnixFS"){super(e)}}class si extends Error{static name="OverReadError";static code="ERR_OVER_READ";name=si.name;code=si.code;constructor(e="Over read"){super(e)}}class ss extends Error{static name="UnderReadError";static code="ERR_UNDER_READ";name=ss.name;code=ss.code;constructor(e="Under read"){super(e)}}class so extends Error{static name="NoPropError";static code="ERR_NO_PROP";name=so.name;code=so.code;constructor(e="No Property found"){super(e)}}class sa extends Error{static name="InvalidParametersError";static code="ERR_INVALID_PARAMS";name=sa.name;code=sa.code;constructor(e="Invalid parameters"){super(e)}}let sl=["string","number","bigint","symbol"],sc=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function su(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";let t=typeof e;if(sl.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(sh(e))return"Buffer";let r=sd(e);return r||"Object"}function sh(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}function sd(e){let t=Object.prototype.toString.call(e).slice(8,-1);if(sc.includes(t))return t}class sf{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:+(this.major>e.major)}}sf.uint=new sf(0,"uint",!0),sf.negint=new sf(1,"negint",!0),sf.bytes=new sf(2,"bytes",!0),sf.string=new sf(3,"string",!0),sf.array=new sf(4,"array",!1),sf.map=new sf(5,"map",!1),sf.tag=new sf(6,"tag",!1),sf.float=new sf(7,"float",!0),sf.false=new sf(7,"false",!0),sf.true=new sf(7,"true",!0),sf.null=new sf(7,"null",!0),sf.undefined=new sf(7,"undefined",!0),sf.break=new sf(7,"break",!0);class sp{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}let sg=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,sm=new TextDecoder,sy=new TextEncoder;function sb(e){return sg&&globalThis.Buffer.isBuffer(e)}function sw(e){return e instanceof Uint8Array?sb(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}let sv=sg?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):sC(e,t,r):(e,t,r)=>r-t>64?sm.decode(e.subarray(t,r)):sC(e,t,r),sE=sg?e=>e.length>64?globalThis.Buffer.from(e):sI(e):e=>e.length>64?sy.encode(e):sI(e),sA=e=>Uint8Array.from(e),sx=sg?(e,t,r)=>sb(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),sS=sg?(e,t)=>(e=e.map(e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e)),sw(globalThis.Buffer.concat(e,t))):(e,t)=>{let r=new Uint8Array(t),n=0;for(let t of e)n+t.length>r.length&&(t=t.subarray(0,r.length-n)),r.set(t,n),n+=t.length;return r},sk=sg?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function s_(e,t){if(sb(e)&&sb(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}function sI(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t}function sC(e,t,r){let n=[];for(;t<r;){let i=e[t],s=null,o=i>239?4:i>223?3:i>191?2:1;if(t+o<=r){let r,n,a,l;switch(o){case 1:i<128&&(s=i);break;case 2:(192&(r=e[t+1]))==128&&(l=(31&i)<<6|63&r)>127&&(s=l);break;case 3:r=e[t+1],n=e[t+2],(192&r)==128&&(192&n)==128&&(l=(15&i)<<12|(63&r)<<6|63&n)>2047&&(l<55296||l>57343)&&(s=l);break;case 4:r=e[t+1],n=e[t+2],a=e[t+3],(192&r)==128&&(192&n)==128&&(192&a)==128&&(l=(15&i)<<18|(63&r)<<12|(63&n)<<6|63&a)>65535&&l<1114112&&(s=l)}}null===s?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),t+=o}return sP(n)}let sT=4096;function sP(e){let t=e.length;if(t<=sT)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=sT));return r}let sR=256;class sO{constructor(e=sR){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){let e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=sk(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(1===this.chunks.length){let r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=sx(r,0,this.cursor)}else t=sS(this.chunks,this.cursor);return e&&this.reset(),t}}let sN="CBOR decode error:",sD="CBOR encode error:",sB=[];function sM(e,t,r){if(e.length-t<r)throw Error(`${sN} not enough data for type`)}sB[23]=1,sB[24]=2,sB[25]=3,sB[26]=5,sB[27]=9;let sL=[24,256,65536,0x100000000,BigInt("18446744073709551616")];function sF(e,t,r){sM(e,t,1);let n=e[t];if(!0===r.strict&&n<sL[0])throw Error(`${sN} integer encoded in more bytes than necessary (strict decode)`);return n}function sU(e,t,r){sM(e,t,2);let n=e[t]<<8|e[t+1];if(!0===r.strict&&n<sL[1])throw Error(`${sN} integer encoded in more bytes than necessary (strict decode)`);return n}function sj(e,t,r){sM(e,t,4);let n=0x1000000*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===r.strict&&n<sL[2])throw Error(`${sN} integer encoded in more bytes than necessary (strict decode)`);return n}function s$(e,t,r){sM(e,t,8);let n=0x1000000*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],i=0x1000000*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],s=(BigInt(n)<<BigInt(32))+BigInt(i);if(!0===r.strict&&s<sL[3])throw Error(`${sN} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(!0===r.allowBigInt)return s;throw Error(`${sN} integers outside of the safe integer range are not supported`)}function sH(e,t,r,n){return new sp(sf.uint,sF(e,t+1,n),2)}function sq(e,t,r,n){return new sp(sf.uint,sU(e,t+1,n),3)}function sz(e,t,r,n){return new sp(sf.uint,sj(e,t+1,n),5)}function sV(e,t,r,n){return new sp(sf.uint,s$(e,t+1,n),9)}function sK(e,t){return sG(e,0,t.value)}function sG(e,t,r){if(r<sL[0]){let n=Number(r);e.push([t|n])}else if(r<sL[1]){let n=Number(r);e.push([24|t,n])}else if(r<sL[2]){let n=Number(r);e.push([25|t,n>>>8,255&n])}else if(r<sL[3]){let n=Number(r);e.push([26|t,n>>>24&255,n>>>16&255,n>>>8&255,255&n])}else{let n=BigInt(r);if(n<sL[4]){let r=[27|t,0,0,0,0,0,0,0],i=Number(n&BigInt(0xffffffff)),s=Number(n>>BigInt(32)&BigInt(0xffffffff));r[8]=255&i,i>>=8,r[7]=255&i,i>>=8,r[6]=255&i,i>>=8,r[5]=255&i,r[4]=255&s,s>>=8,r[3]=255&s,s>>=8,r[2]=255&s,s>>=8,r[1]=255&s,e.push(r)}else throw Error(`${sN} encountered BigInt larger than allowable range`)}}function sW(e,t,r,n){return new sp(sf.negint,-1-sF(e,t+1,n),2)}function sQ(e,t,r,n){return new sp(sf.negint,-1-sU(e,t+1,n),3)}function sJ(e,t,r,n){return new sp(sf.negint,-1-sj(e,t+1,n),5)}sK.encodedSize=function(e){return sG.encodedSize(e.value)},sG.encodedSize=function(e){return e<sL[0]?1:e<sL[1]?2:e<sL[2]?3:e<sL[3]?5:9},sK.compareTokens=function(e,t){return e.value<t.value?-1:+(e.value>t.value)};let sZ=BigInt(-1),sY=BigInt(1);function sX(e,t,r,n){let i=s$(e,t+1,n);if("bigint"!=typeof i){let e=-1-i;if(e>=Number.MIN_SAFE_INTEGER)return new sp(sf.negint,e,9)}if(!0!==n.allowBigInt)throw Error(`${sN} integers outside of the safe integer range are not supported`);return new sp(sf.negint,sZ-BigInt(i),9)}function s0(e,t){let r=t.value,n="bigint"==typeof r?r*sZ-sY:-1*r-1;sG(e,t.type.majorEncoded,n)}function s1(e,t,r,n){sM(e,t,r+n);let i=sx(e,t+r,t+r+n);return new sp(sf.bytes,i,r+n)}function s2(e,t,r,n){return s1(e,t,1,r)}function s3(e,t,r,n){return s1(e,t,2,sF(e,t+1,n))}function s4(e,t,r,n){return s1(e,t,3,sU(e,t+1,n))}function s5(e,t,r,n){return s1(e,t,5,sj(e,t+1,n))}function s6(e,t,r,n){let i=s$(e,t+1,n);if("bigint"==typeof i)throw Error(`${sN} 64-bit integer bytes lengths not supported`);return s1(e,t,9,i)}function s8(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===sf.string?sE(e.value):e.value),e.encodedBytes}function s7(e,t){let r=s8(t);sG(e,t.type.majorEncoded,r.length),e.push(r)}function s9(e,t){return e.length<t.length?-1:e.length>t.length?1:s_(e,t)}function oe(e,t,r,n,i){let s=r+n;sM(e,t,s);let o=new sp(sf.string,sv(e,t+r,t+s),s);return!0===i.retainStringBytes&&(o.byteValue=sx(e,t+r,t+s)),o}function ot(e,t,r,n){return oe(e,t,1,r,n)}function or(e,t,r,n){return oe(e,t,2,sF(e,t+1,n),n)}function on(e,t,r,n){return oe(e,t,3,sU(e,t+1,n),n)}function oi(e,t,r,n){return oe(e,t,5,sj(e,t+1,n),n)}function os(e,t,r,n){let i=s$(e,t+1,n);if("bigint"==typeof i)throw Error(`${sN} 64-bit integer string lengths not supported`);return oe(e,t,9,i,n)}s0.encodedSize=function(e){let t=e.value,r="bigint"==typeof t?t*sZ-sY:-1*t-1;return r<sL[0]?1:r<sL[1]?2:r<sL[2]?3:r<sL[3]?5:9},s0.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},s7.encodedSize=function(e){let t=s8(e);return sG.encodedSize(t.length)+t.length},s7.compareTokens=function(e,t){return s9(s8(e),s8(t))};let oo=s7;function oa(e,t,r,n){return new sp(sf.array,n,r)}function ol(e,t,r,n){return oa(e,t,1,r)}function oc(e,t,r,n){return oa(e,t,2,sF(e,t+1,n))}function ou(e,t,r,n){return oa(e,t,3,sU(e,t+1,n))}function oh(e,t,r,n){return oa(e,t,5,sj(e,t+1,n))}function od(e,t,r,n){let i=s$(e,t+1,n);if("bigint"==typeof i)throw Error(`${sN} 64-bit integer array lengths not supported`);return oa(e,t,9,i)}function of(e,t,r,n){if(!1===n.allowIndefinite)throw Error(`${sN} indefinite length items not allowed`);return oa(e,t,1,1/0)}function op(e,t){sG(e,sf.array.majorEncoded,t.value)}function og(e,t,r,n){return new sp(sf.map,n,r)}function om(e,t,r,n){return og(e,t,1,r)}function oy(e,t,r,n){return og(e,t,2,sF(e,t+1,n))}function ob(e,t,r,n){return og(e,t,3,sU(e,t+1,n))}function ow(e,t,r,n){return og(e,t,5,sj(e,t+1,n))}function ov(e,t,r,n){let i=s$(e,t+1,n);if("bigint"==typeof i)throw Error(`${sN} 64-bit integer map lengths not supported`);return og(e,t,9,i)}function oE(e,t,r,n){if(!1===n.allowIndefinite)throw Error(`${sN} indefinite length items not allowed`);return og(e,t,1,1/0)}function oA(e,t){sG(e,sf.map.majorEncoded,t.value)}function ox(e,t,r,n){return new sp(sf.tag,r,1)}function oS(e,t,r,n){return new sp(sf.tag,sF(e,t+1,n),2)}function ok(e,t,r,n){return new sp(sf.tag,sU(e,t+1,n),3)}function o_(e,t,r,n){return new sp(sf.tag,sj(e,t+1,n),5)}function oI(e,t,r,n){return new sp(sf.tag,s$(e,t+1,n),9)}function oC(e,t){sG(e,sf.tag.majorEncoded,t.value)}op.compareTokens=sK.compareTokens,op.encodedSize=function(e){return sG.encodedSize(e.value)},oA.compareTokens=sK.compareTokens,oA.encodedSize=function(e){return sG.encodedSize(e.value)},oC.compareTokens=sK.compareTokens,oC.encodedSize=function(e){return sG.encodedSize(e.value)};let oT=20,oP=21,oR=22,oO=23;function oN(e,t,r,n){if(!1===n.allowUndefined)throw Error(`${sN} undefined values are not supported`);return!0===n.coerceUndefinedToNull?new sp(sf.null,null,1):new sp(sf.undefined,void 0,1)}function oD(e,t,r,n){if(!1===n.allowIndefinite)throw Error(`${sN} indefinite length items not allowed`);return new sp(sf.break,void 0,1)}function oB(e,t,r){if(r){if(!1===r.allowNaN&&Number.isNaN(e))throw Error(`${sN} NaN values are not supported`);if(!1===r.allowInfinity&&(e===1/0||e===-1/0))throw Error(`${sN} Infinity values are not supported`)}return new sp(sf.float,e,t)}function oM(e,t,r,n){return oB(oz(e,t+1),3,n)}function oL(e,t,r,n){return oB(oK(e,t+1),5,n)}function oF(e,t,r,n){return oB(oW(e,t+1),9,n)}function oU(e,t,r){let n=t.value;if(!1===n)e.push([sf.float.majorEncoded|oT]);else if(!0===n)e.push([sf.float.majorEncoded|oP]);else if(null===n)e.push([sf.float.majorEncoded|oR]);else if(void 0===n)e.push([sf.float.majorEncoded|oO]);else{let t,i=!1;r&&!0===r.float64||(oq(n),n===(t=oz(oH,1))||Number.isNaN(n)?(oH[0]=249,e.push(oH.slice(0,3)),i=!0):(oV(n),n===(t=oK(oH,1))&&(oH[0]=250,e.push(oH.slice(0,5)),i=!0))),i||(oG(n),t=oW(oH,1),oH[0]=251,e.push(oH.slice(0,9)))}}oU.encodedSize=function(e,t){let r=e.value;if(!1===r||!0===r||null==r)return 1;if(!t||!0!==t.float64){oq(r);let e=oz(oH,1);if(r===e||Number.isNaN(r))return 3;if(oV(r),r===(e=oK(oH,1)))return 5}return 9};let oj=new ArrayBuffer(9),o$=new DataView(oj,1),oH=new Uint8Array(oj,0);function oq(e){if(e===1/0)o$.setUint16(0,31744,!1);else if(e===-1/0)o$.setUint16(0,64512,!1);else if(Number.isNaN(e))o$.setUint16(0,32256,!1);else{o$.setFloat32(0,e);let t=o$.getUint32(0),r=(0x7f800000&t)>>23,n=8388607&t;if(255===r)o$.setUint16(0,31744,!1);else if(0===r)o$.setUint16(0,(0x80000000&e)>>16|n>>13,!1);else{let e=r-127;e<-24?o$.setUint16(0,0):e<-14?o$.setUint16(0,(0x80000000&t)>>16|1<<24+e,!1):o$.setUint16(0,(0x80000000&t)>>16|e+15<<10|n>>13,!1)}}}function oz(e,t){let r;if(e.length-t<2)throw Error(`${sN} not enough data for float16`);let n=(e[t]<<8)+e[t+1];if(31744===n)return 1/0;if(64512===n)return-1/0;if(32256===n)return NaN;let i=n>>10&31,s=1023&n;return r=0===i?5960464477539063e-23*s:31!==i?(s+1024)*2**(i-25):0===s?1/0:NaN,32768&n?-r:r}function oV(e){o$.setFloat32(0,e,!1)}function oK(e,t){if(e.length-t<4)throw Error(`${sN} not enough data for float32`);let r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function oG(e){o$.setFloat64(0,e,!1)}function oW(e,t){if(e.length-t<8)throw Error(`${sN} not enough data for float64`);let r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}function oQ(e,t,r){throw Error(`${sN} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function oJ(e){return()=>{throw Error(`${sN} ${e}`)}}oU.compareTokens=sK.compareTokens;let oZ=[];for(let e=0;e<=23;e++)oZ[e]=oQ;oZ[24]=sH,oZ[25]=sq,oZ[26]=sz,oZ[27]=sV,oZ[28]=oQ,oZ[29]=oQ,oZ[30]=oQ,oZ[31]=oQ;for(let e=32;e<=55;e++)oZ[e]=oQ;oZ[56]=sW,oZ[57]=sQ,oZ[58]=sJ,oZ[59]=sX,oZ[60]=oQ,oZ[61]=oQ,oZ[62]=oQ,oZ[63]=oQ;for(let e=64;e<=87;e++)oZ[e]=s2;oZ[88]=s3,oZ[89]=s4,oZ[90]=s5,oZ[91]=s6,oZ[92]=oQ,oZ[93]=oQ,oZ[94]=oQ,oZ[95]=oJ("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)oZ[e]=ot;oZ[120]=or,oZ[121]=on,oZ[122]=oi,oZ[123]=os,oZ[124]=oQ,oZ[125]=oQ,oZ[126]=oQ,oZ[127]=oJ("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)oZ[e]=ol;oZ[152]=oc,oZ[153]=ou,oZ[154]=oh,oZ[155]=od,oZ[156]=oQ,oZ[157]=oQ,oZ[158]=oQ,oZ[159]=of;for(let e=160;e<=183;e++)oZ[e]=om;oZ[184]=oy,oZ[185]=ob,oZ[186]=ow,oZ[187]=ov,oZ[188]=oQ,oZ[189]=oQ,oZ[190]=oQ,oZ[191]=oE;for(let e=192;e<=215;e++)oZ[e]=ox;oZ[216]=oS,oZ[217]=ok,oZ[218]=o_,oZ[219]=oI,oZ[220]=oQ,oZ[221]=oQ,oZ[222]=oQ,oZ[223]=oQ;for(let e=224;e<=243;e++)oZ[e]=oJ("simple values are not supported");oZ[244]=oQ,oZ[245]=oQ,oZ[246]=oQ,oZ[247]=oN,oZ[248]=oJ("simple values are not supported"),oZ[249]=oM,oZ[250]=oL,oZ[251]=oF,oZ[252]=oQ,oZ[253]=oQ,oZ[254]=oQ,oZ[255]=oD;let oY=[];for(let e=0;e<24;e++)oY[e]=new sp(sf.uint,e,1);for(let e=-1;e>=-24;e--)oY[31-e]=new sp(sf.negint,e,1);oY[64]=new sp(sf.bytes,new Uint8Array(0),1),oY[96]=new sp(sf.string,"",1),oY[128]=new sp(sf.array,0,1),oY[160]=new sp(sf.map,0,1),oY[244]=new sp(sf.false,!1,1),oY[245]=new sp(sf.true,!0,1),oY[246]=new sp(sf.null,null,1);let oX={float64:!1,mapSorter:o8,quickEncodeToken:function(e){switch(e.type){case sf.false:return sA([244]);case sf.true:return sA([245]);case sf.null:return sA([246]);case sf.bytes:if(!e.value.length)return sA([64]);return;case sf.string:if(""===e.value)return sA([96]);return;case sf.array:if(0===e.value)return sA([128]);return;case sf.map:if(0===e.value)return sA([160]);return;case sf.uint:if(e.value<24)return sA([Number(e.value)]);return;case sf.negint:if(e.value>=-24)return sA([31-Number(e.value)])}}},o0=function(){let e=[];return e[sf.uint.major]=sK,e[sf.negint.major]=s0,e[sf.bytes.major]=s7,e[sf.string.major]=oo,e[sf.array.major]=op,e[sf.map.major]=oA,e[sf.tag.major]=oC,e[sf.float.major]=oU,e}(),o1=new sO;class o2{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw Error(`${sD} object contains circular references`);return new o2(t,e)}}let o3={null:new sp(sf.null,null),undefined:new sp(sf.undefined,void 0),true:new sp(sf.true,!0),false:new sp(sf.false,!1),emptyArray:new sp(sf.array,0),emptyMap:new sp(sf.map,0)},o4={number:(e,t,r,n)=>Number.isInteger(e)&&Number.isSafeInteger(e)?e>=0?new sp(sf.uint,e):new sp(sf.negint,e):new sp(sf.float,e),bigint:(e,t,r,n)=>e>=BigInt(0)?new sp(sf.uint,e):new sp(sf.negint,e),Uint8Array:(e,t,r,n)=>new sp(sf.bytes,e),string:(e,t,r,n)=>new sp(sf.string,e),boolean:(e,t,r,n)=>e?o3.true:o3.false,null:(e,t,r,n)=>o3.null,undefined:(e,t,r,n)=>o3.undefined,ArrayBuffer:(e,t,r,n)=>new sp(sf.bytes,new Uint8Array(e)),DataView:(e,t,r,n)=>new sp(sf.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,r,n){if(!e.length)return!0===r.addBreakTokens?[o3.emptyArray,new sp(sf.break)]:o3.emptyArray;n=o2.createCheck(n,e);let i=[],s=0;for(let t of e)i[s++]=o5(t,r,n);return r.addBreakTokens?[new sp(sf.array,e.length),i,new sp(sf.break)]:[new sp(sf.array,e.length),i]},Object(e,t,r,n){let i="Object"!==t,s=i?e.keys():Object.keys(e),o=i?e.size:s.length;if(!o)return!0===r.addBreakTokens?[o3.emptyMap,new sp(sf.break)]:o3.emptyMap;n=o2.createCheck(n,e);let a=[],l=0;for(let t of s)a[l++]=[o5(t,r,n),o5(i?e.get(t):e[t],r,n)];return(o6(a,r),r.addBreakTokens)?[new sp(sf.map,o),a,new sp(sf.break)]:[new sp(sf.map,o),a]}};for(let e of(o4.Map=o4.Object,o4.Buffer=o4.Uint8Array,"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" ")))o4[`${e}Array`]=o4.DataView;function o5(e,t={},r){let n=su(e),i=t&&t.typeEncoders&&t.typeEncoders[n]||o4[n];if("function"==typeof i){let s=i(e,n,t,r);if(null!=s)return s}let s=o4[n];if(!s)throw Error(`${sD} unsupported type: ${n}`);return s(e,n,t,r)}function o6(e,t){t.mapSorter&&e.sort(t.mapSorter)}function o8(e,t){let r=Array.isArray(e[0])?e[0][0]:e[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(r.type!==n.type)return r.type.compare(n.type);let i=o0[r.type.major].compareTokens(r,n);return 0===i&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i}function o7(e,t,r,n){if(Array.isArray(t))for(let i of t)o7(e,i,r,n);else r[t.type.major](e,t,n)}function o9(e,t,r){let n=o5(e,r);if(!Array.isArray(n)&&r.quickEncodeToken){let e=r.quickEncodeToken(n);if(e)return e;let i=t[n.type.major];if(i.encodedSize){let e=new sO(i.encodedSize(n,r));if(i(e,n,r),1!==e.chunks.length)throw Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return sw(e.chunks[0])}}return o1.reset(),o7(o1,n,t,r),o1.toBytes(!0)}function ae(e,t){return o9(e,o0,t=Object.assign({},oX,t))}let at={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class ar{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){let e=this.data[this._pos],t=oY[e];if(void 0===t){let r=oZ[e];if(!r)throw Error(`${sN} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let n=31&e;t=r(this.data,this._pos,n,this.options)}return this._pos+=t.encodedLength,t}}let an=Symbol.for("DONE"),ai=Symbol.for("BREAK");function as(e,t,r){let n=[];for(let i=0;i<e.value;i++){let s=aa(t,r);if(s===ai){if(e.value===1/0)break;throw Error(`${sN} got unexpected break to lengthed array`)}if(s===an)throw Error(`${sN} found array but not enough entries (got ${i}, expected ${e.value})`);n[i]=s}return n}function ao(e,t,r){let n=!0===r.useMaps,i=n?void 0:{},s=n?new Map:void 0;for(let o=0;o<e.value;o++){let a=aa(t,r);if(a===ai){if(e.value===1/0)break;throw Error(`${sN} got unexpected break to lengthed map`)}if(a===an)throw Error(`${sN} found map but not enough entries (got ${o} [no key], expected ${e.value})`);if(!0!==n&&"string"!=typeof a)throw Error(`${sN} non-string keys not supported (got ${typeof a})`);if(!0===r.rejectDuplicateMapKeys&&(n&&s.has(a)||!n&&a in i))throw Error(`${sN} found repeat map key "${a}"`);let l=aa(t,r);if(l===an)throw Error(`${sN} found map but not enough entries (got ${o} [no value], expected ${e.value})`);n?s.set(a,l):i[a]=l}return n?s:i}function aa(e,t){if(e.done())return an;let r=e.next();if(r.type===sf.break)return ai;if(r.type.terminal)return r.value;if(r.type===sf.array)return as(r,e,t);if(r.type===sf.map)return ao(r,e,t);if(r.type===sf.tag){if(t.tags&&"function"==typeof t.tags[r.value]){let n=aa(e,t);return t.tags[r.value](n)}throw Error(`${sN} tag not supported (${r.value})`)}throw Error("unsupported")}function al(e,t){if(!(e instanceof Uint8Array))throw Error(`${sN} data to decode must be a Uint8Array`);let r=(t=Object.assign({},at,t)).tokenizer||new ar(e,t),n=aa(r,t);if(n===an)throw Error(`${sN} did not find any content to decode`);if(n===ai)throw Error(`${sN} got unexpected break`);return[n,e.subarray(r.pos())]}function ac(e,t){let[r,n]=al(e,t);if(n.length>0)throw Error(`${sN} too many terminals, data makes no sense`);return r}let au=42;function ah(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}let ad={float64:!0,typeEncoders:{Object:function(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;let t=rc.TO.asCID(e);if(!t)return null;let r=new Uint8Array(t.bytes.byteLength+1);return r.set(t.bytes,1),[new sp(sf.tag,au),new sp(sf.bytes,r)]},undefined:function(){throw Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")},number:function(e){if(Number.isNaN(e))throw Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}}},af={...ad,typeEncoders:{...ad.typeEncoders}};function ap(e){if(0!==e[0])throw Error("Invalid CID for CBOR tag 42; expected leading 0x00");return rc.TO.decode(e.subarray(1))}let ag={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};ag.tags[au]=ap;let am={...ag,tags:ag.tags.slice()},ay="dag-cbor",ab=113,aw=e=>ae(e,ad),av=e=>ac(ah(e),ag);class aE extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){let t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===sf.array&&(t.elements++,1!==t.elements&&e.push([44])),t.type===sf.map&&(t.elements++,1!==t.elements&&(t.elements%2==1?e.push([44]):e.push([58]))))}[sf.uint.major](e,t){this.prefix(e);let r=String(t.value),n=[];for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);e.push(n)}[sf.negint.major](e,t){this[sf.uint.major](e,t)}[sf.bytes.major](e,t){throw Error(`${sD} unsupported type: Uint8Array`)}[sf.string.major](e,t){this.prefix(e);let r=sE(JSON.stringify(t.value));e.push(r.length>32?sw(r):r)}[sf.array.major](e,t){this.prefix(e),this.inRecursive.push({type:sf.array,elements:0}),e.push([91])}[sf.map.major](e,t){this.prefix(e),this.inRecursive.push({type:sf.map,elements:0}),e.push([123])}[sf.tag.major](e,t){}[sf.float.major](e,t){if("break"===t.type.name){let t=this.inRecursive.pop();if(t){if(t.type===sf.array)e.push([93]);else if(t.type===sf.map)e.push([125]);else throw Error("Unexpected recursive type; this should not happen!");return}throw Error("Unexpected break; this should not happen!")}if(void 0===t.value)throw Error(`${sD} unsupported type: undefined`);if(this.prefix(e),"true"===t.type.name)return void e.push([116,114,117,101]);if("false"===t.type.name)return void e.push([102,97,108,115,101]);if("null"===t.type.name)return void e.push([110,117,108,108]);let r=String(t.value),n=[],i=!1;for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e),i||46!==n[e]&&101!==n[e]&&69!==n[e]||(i=!0);i||(n.push(46),n.push(48)),e.push(n)}}let aA={addBreakTokens:!0,mapSorter:function(e,t){if(Array.isArray(e[0])||Array.isArray(t[0]))throw Error(`${sD} complex map keys are not supported`);let r=e[0],n=t[0];if(r.type!==sf.string||n.type!==sf.string)throw Error(`${sD} non-string map keys are not supported`);if(r<n)return -1;if(r>n)return 1;throw Error(`${sD} unexpected duplicate map keys, this is not supported`)}};function ax(e,t){return t=Object.assign({},aA,t),o9(e,new aE,t)}class aS{constructor(e,t={}){this._pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;32===e||9===e||13===e||10===e;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw Error(`${sN} unexpected end of input at position ${this._pos}`);for(let t=0;t<e.length;t++)if(this.data[this._pos++]!==e[t])throw Error(`${sN} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){let e=this._pos,t=!1,r=!1,n=e=>{for(;!this.done();){let t=this.ch();if(e.includes(t))this._pos++;else break}};if(45===this.ch()&&(t=!0,this._pos++),48===this.ch()){if(this._pos++,46!==this.ch())return new sp(sf.uint,0,this._pos-e);this._pos++,r=!0}if(n([48,49,50,51,52,53,54,55,56,57]),t&&this._pos===e+1)throw Error(`${sN} unexpected token at position ${this._pos}`);if(!this.done()&&46===this.ch()){if(r)throw Error(`${sN} unexpected token at position ${this._pos}`);r=!0,this._pos++,n([48,49,50,51,52,53,54,55,56,57])}this.done()||101!==this.ch()&&69!==this.ch()||(r=!0,this._pos++,!this.done()&&(43===this.ch()||45===this.ch())&&this._pos++,n([48,49,50,51,52,53,54,55,56,57]));let i=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),s=parseFloat(i);return r?new sp(sf.float,s,this._pos-e):!0!==this.options.allowBigInt||Number.isSafeInteger(s)?new sp(s>=0?sf.uint:sf.negint,s,this._pos-e):new sp(s>=0?sf.uint:sf.negint,BigInt(i),this._pos-e)}parseString(){if(34!==this.ch())throw Error(`${sN} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let e=this._pos,t=0;e<this.data.length&&t<65536;e++,t++){let r=this.data[e];if(92===r||r<32||r>=128)break;if(34===r){let r=String.fromCharCode.apply(null,this.data.subarray(this._pos,e));return this._pos=e+1,new sp(sf.string,r,t)}}let e=this._pos,t=[],r=()=>{if(this._pos+4>=this.data.length)throw Error(`${sN} unexpected end of unicode escape sequence at position ${this._pos}`);let e=0;for(let t=0;t<4;t++){let t=this.ch();if(t>=48&&t<=57)t-=48;else if(t>=97&&t<=102)t=t-97+10;else if(t>=65&&t<=70)t=t-65+10;else throw Error(`${sN} unexpected unicode escape character at position ${this._pos}`);e=16*e+t,this._pos++}return e},n=()=>{let e,r,n,i,s=this.ch(),o=null,a=s>239?4:s>223?3:s>191?2:1;if(this._pos+a>this.data.length)throw Error(`${sN} unexpected unicode sequence at position ${this._pos}`);switch(a){case 1:s<128&&(o=s);break;case 2:(192&(e=this.data[this._pos+1]))==128&&(i=(31&s)<<6|63&e)>127&&(o=i);break;case 3:e=this.data[this._pos+1],r=this.data[this._pos+2],(192&e)==128&&(192&r)==128&&(i=(15&s)<<12|(63&e)<<6|63&r)>2047&&(i<55296||i>57343)&&(o=i);break;case 4:e=this.data[this._pos+1],r=this.data[this._pos+2],n=this.data[this._pos+3],(192&e)==128&&(192&r)==128&&(192&n)==128&&(i=(15&s)<<18|(63&e)<<12|(63&r)<<6|63&n)>65535&&i<1114112&&(o=i)}null===o?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|1023&o),t.push(o),this._pos+=a};for(;!this.done();){let i,s=this.ch();switch(s){case 92:if(this._pos++,this.done())throw Error(`${sN} unexpected string termination at position ${this._pos}`);switch(i=this.ch(),this._pos++,i){case 34:case 39:case 92:case 47:t.push(i);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(r());break;default:throw Error(`${sN} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new sp(sf.string,sP(t),this._pos-e);default:if(s<32)throw Error(`${sN} invalid control character at position ${this._pos}`);s<128?(t.push(s),this._pos++):n()}}throw Error(`${sN} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new sp(sf.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new sp(sf.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new sp(sf.null,null,4);case 102:return this.expect([102,97,108,115,101]),new sp(sf.false,!1,5);case 116:return this.expect([116,114,117,101]),new sp(sf.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw Error(`${sN} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":if(this.modeStack.pop(),93===this.ch())return this._pos++,this.skipWhitespace(),new sp(sf.break,void 0,1);if(44!==this.ch())throw Error(`${sN} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"array-start":if(this.modeStack.pop(),93===this.ch())return this._pos++,this.skipWhitespace(),new sp(sf.break,void 0,1);return this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"obj-key":if(125===this.ch())return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new sp(sf.break,void 0,1);if(44!==this.ch())throw Error(`${sN} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),125===this.ch())return this._pos++,this.skipWhitespace(),new sp(sf.break,void 0,1);let e=this.parseString();if(this.skipWhitespace(),58!==this.ch())throw Error(`${sN} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw Error(`${sN} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}}function ak(e,t){return t=Object.assign({tokenizer:new aS(e,t)},t),ac(e,t)}var a_=r(53647);function aI(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}function aC(e){let t=a_.base64.encode(e).slice(1);return[new sp(sf.map,1/0,1),new sp(sf.string,"/",1),new sp(sf.map,1/0,1),new sp(sf.string,"bytes",5),new sp(sf.string,t,t.length),new sp(sf.break,void 0,1),new sp(sf.break,void 0,1)]}function aT(e){return aC(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}function aP(e){return aC(new Uint8Array(e))}let aR={typeEncoders:{Object:function(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;let t=il.TO.asCID(e);if(!t)return null;let r=t.toString();return[new sp(sf.map,1/0,1),new sp(sf.string,"/",1),new sp(sf.string,r,r.length),new sp(sf.break,void 0,1)]},Buffer:aC,Uint8Array:aC,Int8Array:aT,Uint16Array:aT,Int16Array:aT,Uint32Array:aT,Int32Array:aT,Float32Array:aT,Float64Array:aT,Uint8ClampedArray:aT,BigInt64Array:aT,BigUint64Array:aT,DataView:aT,ArrayBuffer:aP,undefined:function(){throw Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")},number:function(e){if(Number.isNaN(e))throw Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}}};class aO extends aS{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return 0===this.tokenBuffer.length&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){let e=this._next();if(e.type===sf.map){let e=this._next();if(e.type===sf.string&&"/"===e.value){let e=this._next();if(e.type===sf.string){if(this._next().type!==sf.break)throw Error("Invalid encoded CID form");return this.tokenBuffer.push(e),new sp(sf.tag,42,0)}if(e.type===sf.map){let e=this._next();if(e.type===sf.string&&"bytes"===e.value){let e=this._next();if(e.type===sf.string){for(let e=0;e<2;e++)if(this._next().type!==sf.break)throw Error("Invalid encoded Bytes form");let t=a_.base64.decode(`m${e.value}`);return new sp(sf.bytes,t,e.value.length)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}return e}}let aN={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};aN.tags[42]=il.TO.parse;let aD="dag-json",aB=297,aM=e=>ax(e,aR),aL=e=>{let t=aI(e),r=Object.assign(aN,{tokenizer:new aO(t,aN)});return ak(t,r)},aF=e=>aU.decode(aM(e)),aU=new TextDecoder,aj=e=>aL(a$.encode(e)),a$=new TextEncoder;var aH=r(47951),aq=r(30946);function az(e,t,r,n,i,s,o){let a=e,l=i;for(;s.length>0;){let c=s[0];if(c in a){s.shift(),l=`${l}/${c}`;let u=rc.TO.asCID(a[c]);if(null!=u)return{entry:{type:"object",name:n,path:i,cid:r,node:t,depth:o,size:BigInt(t.length),content:async function*(){yield e}},next:{cid:u,name:c,path:l,toResolve:s}};a=a[c]}else throw new so(`No property named ${c} found in node ${r}`)}return{entry:{type:"object",name:n,path:i,cid:r,node:t,depth:o,size:BigInt(t.length),content:async function*(){yield e}}}}let aV=async(e,t,r,n,i,s,o,a)=>{let l=await o.get(e,a);return az(av(l),l,e,t,r,n,s)},aK=async(e,t,r,n,i,s,o,a)=>{let l=await o.get(e,a);return az(aL(l),l,e,t,r,n,s)};var aG=r(87704);let aW=function(e,t,r,n){let i=BigInt(t+BigInt(e.length));return r>=i||n<t?new Uint8Array(0):(n>=t&&n<i&&(e=e.subarray(0,Number(n-t))),r>=t&&r<i&&(e=e.subarray(Number(r-t))),e)},aQ=(e,t=0,r=e)=>{let n=BigInt(e),i=BigInt(t??0),s=BigInt(r);if(s!==n&&(s=i+s),s>n&&(s=n),i<0n)throw new sa("Offset must be greater than or equal to 0");if(i>n)throw new sa("Offset must be less than the file size");if(s<0n)throw new sa("Length must be greater than or equal to 0");if(s>n)throw new sa("Length must be less than the file size");return{start:i,end:s}},aJ=e=>async function*(t={}){let{start:r,end:n}=aQ(e.length,t.offset,t.length),i=aW(e,0n,r,n);t.onProgress?.(new nV("unixfs:exporter:progress:identity",{bytesRead:BigInt(i.byteLength),totalBytes:n-r,fileSize:BigInt(e.byteLength)})),yield i},aZ=async(e,t,r,n,i,s,o,a)=>{if(n.length>0)throw new st(`No link named ${r} found in raw node ${e}`);let l=aG.decode(e.multihash.bytes);return{entry:{type:"identity",name:t,path:r,cid:e,content:aJ(l.digest),depth:s,size:BigInt(l.digest.length),node:l.digest}}},aY=async(e,t,r,n,i,s,o,a)=>{let l=await o.get(e,a);return az(aH.decode(l),l,e,t,r,n,s)},aX=e=>async function*(t={}){let{start:r,end:n}=aQ(e.length,t.offset,t.length),i=aW(e,0n,r,n);t.onProgress?.(new nV("unixfs:exporter:progress:raw",{bytesRead:BigInt(i.byteLength),totalBytes:n-r,fileSize:BigInt(e.byteLength)})),yield i},a0=async(e,t,r,n,i,s,o,a)=>{if(n.length>0)throw new st(`No link named ${r} found in raw node ${e}`);let l=await o.get(e,a);return{entry:{type:"raw",name:t,path:r,cid:e,content:aX(l),depth:s,size:BigInt(l.length),node:l}}},a1=async function(e){return(await id.encode(e)).slice(0,8).reverse()},a2=async(e,t,r)=>{let n=(t.tableSize()-1).toString(16).length;await Promise.all(e.map(async e=>{if(null==e.Name)throw Error("Unexpected Link without a Name");if(e.Name.length===n){let n=parseInt(e.Name,16);t._putObjectAt(n,new ig({hash:r._options.hash,bits:r._options.bits},t,n));return}await r.put(e.Name.substring(2),!0)}))},a3=(e,t)=>e.toString(16).toUpperCase().padStart(t,"0").substring(0,t),a4=e=>{let t=e.bucket,r=[];for(;null!=t._parent;)r.push(t),t=t._parent;return r.push(t),r.reverse()},a5=async(e,t,r,n,i)=>{if(null==n){let t;if(null==e.Data)throw new sn("no data in PBNode");try{t=nq.unmarshal(e.Data)}catch(e){throw new sn(e.message)}if("hamt-sharded-directory"!==t.type)throw new sn("not a HAMT");if(null==t.fanout)throw new sn("missing fanout");let r=iI({hashFn:a1,bits:Math.log2(Number(t.fanout))});n={rootBucket:r,hamtDepth:1,lastBucket:r}}let s=(n.lastBucket.tableSize()-1).toString(16).length;await a2(e.Links,n.lastBucket,n.rootBucket);let o=await n.rootBucket._findNewBucketAndPos(t),a=a3(o.pos,s),l=a4(o);l.length>n.hamtDepth&&(n.lastBucket=l[n.hamtDepth],a=a3(n.lastBucket._posAtParent,s));let c=e.Links.find(e=>{if(null==e.Name)return!1;let r=e.Name.substring(0,s),n=e.Name.substring(s);return r===a&&(""===n||n===t)});return null==c?void 0:null!=c.Name&&c.Name.substring(s)===t?c.Hash:(n.hamtDepth++,a5(e=r$(await r.get(c.Hash,i)),t,r,n,i))},a6=a5;var a8=r(76520),a7=r(7786),a9=r(31133);let le=globalThis.CustomEvent??Event;async function*lt(e,t={}){let r,n=t.concurrency??1/0;n<1&&(n=1/0);let i=t.ordered??!1,s=new EventTarget,o=[],a=(0,a9.A)(),l=(0,a9.A)(),c=!1,u=!1;function h(){return i?o[0]?.done:!!o.find(e=>e.done)}function*d(){for(;o.length>0&&o[0].done;){let e=o[0];if(o.shift(),e.ok)yield e.value;else throw u=!0,a.resolve(),e.err;a.resolve()}}function*f(){for(;h();)for(let e=0;e<o.length;e++)if(o[e].done){let t=o[e];if(o.splice(e,1),e--,t.ok)yield t.value;else throw u=!0,a.resolve(),t.err;a.resolve()}}for(s.addEventListener("task-complete",()=>{l.resolve()}),Promise.resolve().then(async()=>{try{for await(let t of e){if(o.length===n&&(a=(0,a9.A)(),await a.promise),u)break;let e={done:!1};o.push(e),t().then(t=>{e.done=!0,e.ok=!0,e.value=t,s.dispatchEvent(new le("task-complete"))},t=>{e.done=!0,e.err=t,s.dispatchEvent(new le("task-complete"))})}c=!0,s.dispatchEvent(new le("task-complete"))}catch(e){r=e,s.dispatchEvent(new le("task-complete"))}});;){if(h()||(l=(0,a9.A)(),await l.promise),null!=r||(i?yield*d():yield*f(),null!=r))throw r;if(c&&0===o.length)break}}var lr=r(45346);let ln=(e,t,r,n,i,s,o)=>async function*(r={}){let a=r.offset??0,l=r.length??t.Links.length,c=t.Links.slice(a,l);r.onProgress?.(new nV("unixfs:exporter:walk:directory",{cid:e})),yield*(0,lr.F)(c,e=>(0,a7.A)(e,e=>async()=>{let t=e.Name??"",a=`${n}/${t}`;return(await i(e.Hash,t,a,[],s+1,o,r)).entry}),e=>lt(e,{ordered:!0,concurrency:r.blockReadConcurrency}),e=>(0,a8.A)(e,e=>null!=e))};var li=r(62954),ls=r(15484);class lo extends Error{constructor(e){super(e),this.name="TimeoutError"}}class la extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}let ll=e=>void 0===globalThis.DOMException?new la(e):new DOMException(e),lc=e=>{let t=void 0===e.reason?ll("This operation was aborted."):e.reason;return t instanceof Error?t:ll(t)};function lu(e,t){let r,n,{milliseconds:i,fallback:s,message:o,customTimers:a={setTimeout,clearTimeout}}=t,l=new Promise((l,c)=>{if("number"!=typeof i||1!==Math.sign(i))throw TypeError(`Expected \`milliseconds\` to be a positive number, got \`${i}\``);if(t.signal){let{signal:e}=t;e.aborted&&c(lc(e)),n=()=>{c(lc(e))},e.addEventListener("abort",n,{once:!0})}if(i===Number.POSITIVE_INFINITY)return void e.then(l,c);let u=new lo;r=a.setTimeout.call(void 0,()=>{if(s){try{l(s())}catch(e){c(e)}return}"function"==typeof e.cancel&&e.cancel(),!1===o?l():o instanceof Error?c(o):(u.message=o??`Promise timed out after ${i} milliseconds`,c(u))},i),(async()=>{try{l(await e)}catch(e){c(e)}})()}).finally(()=>{l.clear(),n&&t.signal&&t.signal.removeEventListener("abort",n)});return l.clear=()=>{a.clearTimeout.call(void 0,r),r=void 0},l}function lh(e,t,r){let n=0,i=e.length;for(;i>0;){let s=Math.trunc(i/2),o=n+s;0>=r(e[o],t)?(n=++o,i-=s+1):i=s}return n}class ld{#e=[];enqueue(e,t){let r={priority:(t={priority:0,...t}).priority,id:t.id,run:e};if(0===this.size||this.#e[this.size-1].priority>=t.priority)return void this.#e.push(r);let n=lh(this.#e,r,(e,t)=>t.priority-e.priority);this.#e.splice(n,0,r)}setPriority(e,t){let r=this.#e.findIndex(t=>t.id===e);if(-1===r)throw ReferenceError(`No promise function with the id "${e}" exists in the queue.`);let[n]=this.#e.splice(r,1);this.enqueue(n.run,{priority:t,id:e})}dequeue(){let e=this.#e.shift();return e?.run}filter(e){return this.#e.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this.#e.length}}class lf extends ls.b{#t;#r;#n=0;#i;#s;#o=0;#a;#l;#e;#c;#u=0;#h;#d;#f;#p=1n;timeout;constructor(e){if(super(),!("number"==typeof(e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:ld,...e}).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap?.toString()??""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval?.toString()??""}\` (${typeof e.interval})`);this.#t=e.carryoverConcurrencyCount,this.#r=e.intervalCap===Number.POSITIVE_INFINITY||0===e.interval,this.#i=e.intervalCap,this.#s=e.interval,this.#e=new e.queueClass,this.#c=e.queueClass,this.concurrency=e.concurrency,this.timeout=e.timeout,this.#f=!0===e.throwOnTimeout,this.#d=!1===e.autoStart}get #g(){return this.#r||this.#n<this.#i}get #m(){return this.#u<this.#h}#y(){this.#u--,this.#b(),this.emit("next")}#w(){this.#v(),this.#E(),this.#l=void 0}get #A(){let e=Date.now();if(void 0===this.#a){let t=this.#o-e;if(!(t<0))return void 0===this.#l&&(this.#l=setTimeout(()=>{this.#w()},t)),!0;this.#n=this.#t?this.#u:0}return!1}#b(){if(0===this.#e.size)return this.#a&&clearInterval(this.#a),this.#a=void 0,this.emit("empty"),0===this.#u&&this.emit("idle"),!1;if(!this.#d){let e=!this.#A;if(this.#g&&this.#m){let t=this.#e.dequeue();return!!t&&(this.emit("active"),t(),e&&this.#E(),!0)}}return!1}#E(){this.#r||void 0!==this.#a||(this.#a=setInterval(()=>{this.#v()},this.#s),this.#o=Date.now()+this.#s)}#v(){0===this.#n&&0===this.#u&&this.#a&&(clearInterval(this.#a),this.#a=void 0),this.#n=this.#t?this.#u:0,this.#x()}#x(){for(;this.#b(););}get concurrency(){return this.#h}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this.#h=e,this.#x()}async #S(e){return new Promise((t,r)=>{e.addEventListener("abort",()=>{r(e.reason)},{once:!0})})}setPriority(e,t){this.#e.setPriority(e,t)}async add(e,t={}){return t.id??=(this.#p++).toString(),t={timeout:this.timeout,throwOnTimeout:this.#f,...t},new Promise((r,n)=>{this.#e.enqueue(async()=>{this.#u++,this.#n++;try{t.signal?.throwIfAborted();let n=e({signal:t.signal});t.timeout&&(n=lu(Promise.resolve(n),{milliseconds:t.timeout})),t.signal&&(n=Promise.race([n,this.#S(t.signal)]));let i=await n;r(i),this.emit("completed",i)}catch(e){if(e instanceof lo&&!t.throwOnTimeout)return void r();n(e),this.emit("error",e)}finally{this.#y()}},t),this.emit("add"),this.#b()})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this.#d&&(this.#d=!1,this.#x()),this}pause(){this.#d=!0}clear(){this.#e=new this.#c}async onEmpty(){0!==this.#e.size&&await this.#k("empty")}async onSizeLessThan(e){this.#e.size<e||await this.#k("next",()=>this.#e.size<e)}async onIdle(){(0!==this.#u||0!==this.#e.size)&&await this.#k("idle")}async #k(e,t){return new Promise(r=>{let n=()=>{(!t||t())&&(this.off(e,n),r())};this.on(e,n)})}get size(){return this.#e.size}sizeBy(e){return this.#e.filter(e).length}get pending(){return this.#u}get isPaused(){return this.#d}}async function lp(e,t,r,n,i,s,o){let a;if(t instanceof Uint8Array){let e=aW(t,n,i,s);r.push(e);return}if(null==t.Data)throw new sn("no data in PBNode");try{a=nq.unmarshal(t.Data)}catch(e){throw new sn(e.message)}if(null!=a.data){let e=aW(a.data,n,i,s);r.push(e),n+=BigInt(e.byteLength)}let l=[];if(t.Links.length!==a.blockSizes.length)throw new sn("Inconsistent block sizes and dag links");for(let e=0;e<t.Links.length;e++){let r=t.Links[e],o=n,c=o+a.blockSizes[e];if((i>=o&&i<c||s>=o&&s<=c||i<o&&s>c)&&l.push({link:r,blockStart:n}),(n=c)>s)break}await (0,lr.F)(l,t=>(0,a7.A)(t,t=>async()=>{let r=await e.get(t.link.Hash,o);return{...t,block:r}}),e=>lt(e,{ordered:!0,concurrency:o.blockReadConcurrency}),async t=>{for await(let{link:n,block:a,blockStart:l}of t){let t;switch(n.Hash.code){case rU:t=r$(a);break;case nz.code:t=a;break;default:r.end(new sn(`Unsupported codec: ${n.Hash.code}`));return}let c=new lf({concurrency:1});c.on("error",e=>{r.end(e)}),c.add(async()=>{o.onProgress?.(new nV("unixfs:exporter:walk:file",{cid:n.Hash})),await lp(e,t,r,l,i,s,o)}),await c.onIdle()}}),n>=s&&r.end()}let lg=(e,t,r,n,i,s,o)=>async function*(n={}){let i=r.fileSize();if(void 0===i)throw Error("File was a directory");let{start:s,end:a}=aQ(i,n.offset,n.length);if(0n===a)return;let l=0n,c=a-s,u=(0,li.Ny)();for await(let r of(n.onProgress?.(new nV("unixfs:exporter:walk:file",{cid:e})),lp(o,t,u,0n,s,a,n).catch(e=>{u.end(e)}),u))if(null!=r){if(l+=BigInt(r.byteLength),l>c)throw u.end(),new si("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect");l===c&&u.end(),n.onProgress?.(new nV("unixfs:exporter:progress:unixfs:file",{bytesRead:l,totalBytes:c,fileSize:i})),yield r}if(l<c)throw new ss("Traversed entire DAG but did not read enough bytes")};async function*lm(e,t,r,n,i,s){let o,a=e.Links;if(null==e.Data)throw new sn("no data in PBNode");try{o=nq.unmarshal(e.Data)}catch(e){throw new sn(e.message)}if(null==o.fanout)throw new sn("missing fanout");let l=(o.fanout-1n).toString(16).length;for await(let{entries:o}of(0,lr.F)(a,o=>(0,a7.A)(o,o=>async()=>{let a=null!=o.Name?o.Name.substring(l):null;if(null==a||""===a)return e=r$(await i.get(o.Hash,s)),s.onProgress?.(new nV("unixfs:exporter:walk:hamt-sharded-directory",{cid:o.Hash})),{entries:lm(e,t,r,n,i,s)};{let e=await r(o.Hash,a,`${t}/${a}`,[],n+1,i,s);return{entries:null==e.entry?[]:[e.entry]}}}),e=>lt(e,{ordered:!0,concurrency:s.blockReadConcurrency})))yield*o}let ly=(e,t)=>{let r=e.Links.find(e=>e.Name===t);return r?.Hash},lb={raw:lg,file:lg,directory:ln,"hamt-sharded-directory":(e,t,r,n,i,s,o)=>function(r={}){return r.onProgress?.(new nV("unixfs:exporter:walk:hamt-sharded-directory",{cid:e})),lm(t,n,i,s,o,r)},metadata:(e,t,r,n,i,s,o)=>()=>[],symlink:(e,t,r,n,i,s,o)=>()=>[]},lw={[rU]:async(e,t,r,n,i,s,o,a)=>{let l,c,u=r$(await o.get(e,a));if(null==t&&(t=e.toString()),null==u.Data)throw new sn("no data in PBNode");try{l=nq.unmarshal(u.Data)}catch(e){throw new sn(e.message)}if(null==r&&(r=t),n.length>0){let e;if(null==(e=l?.type==="hamt-sharded-directory"?await a6(u,n[0],o):ly(u,n[0])))throw new st("file does not exist");let t=n.shift(),i=`${r}/${t}`;c={cid:e,toResolve:n,name:t??"",path:i}}let h=lb[l.type](e,u,l,r,i,s,o);if(null==h)throw new st("could not find content exporter");return l.isDirectory()?{entry:{type:"directory",name:t,path:r,cid:e,content:h,unixfs:l,depth:s,node:u,size:l.fileSize()},next:c}:{entry:{type:"file",name:t,path:r,cid:e,content:h,unixfs:l,depth:s,node:u,size:l.fileSize()},next:c}},[nz.code]:a0,[ab]:aV,[aB]:aK,[aq.identity.code]:aZ,[aH.code]:aY},lv=async(e,t,r,n,i,s,o)=>{let a=lw[e.code];if(null==a)throw new sr(`No resolver for code ${e.code}`);return a(e,t,r,n,lv,i,s,o)},lE=lv,lA=(e="")=>(e.trim().match(/([^\\^/]|\\\/)+/g)??[]).filter(Boolean),lx=e=>{if(e instanceof Uint8Array)return{cid:rc.TO.decode(e),toResolve:[]};let t=rc.TO.asCID(e);if(null!=t)return{cid:t,toResolve:[]};if("string"==typeof e){0===e.indexOf("/ipfs/")&&(e=e.substring(6));let t=lA(e);return{cid:rc.TO.parse(t[0]),toResolve:t.slice(1)}}throw new se(`Unknown path type ${e}`)};async function*lS(e,t,r={}){let{cid:n,toResolve:i}=lx(e),s=n.toString(),o=s,a=i.length;for(;;){let l=await lE(n,s,o,i,a,t,r);if(null==l.entry&&null==l.next)throw new st(`Could not resolve ${e}`);if(null!=l.entry&&(yield l.entry),null==l.next)return;i=l.next.toResolve,n=l.next.cid,s=l.next.name,o=l.next.path}}async function lk(e,t,r={}){let n=await iG(lS(e,t,r));if(null==n)throw new st(`Could not resolve ${e}`);return n}async function*l_(e,t,r={}){let n=await lk(e,t,r);if(null!=n&&(yield n,"directory"===n.type))for await(let e of i(n,r))yield e;async function*i(e,t){for await(let r of e.content(t))yield r,r instanceof Uint8Array||"directory"===r.type&&(yield*i(r,t))}}let lI=r(73737);var lC=r(3204),lT=r(4157);function lP(e){return function(t){return t instanceof lR?t:new lR(t,e)}}class lR{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(e,t){if(!(e instanceof Uint8Array))throw Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let r=0;for(;t>0;){let e=this._buffers[this._currentBufferIndex],n=Math.min(e.availableBits(),t),i=e.take(n);r=(r<<n)+i,t-=n,this._availableBits-=n,0===e.availableBits()&&this._currentBufferIndex++}return r}untake(e){let t=e;for(;t>0;){let e=this._buffers[this._currentBufferIndex],r=Math.min(e.totalBits()-e.availableBits(),t);e.untake(r),t-=r,this._availableBits+=r,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;let e=this._depth>0?rt([this._value,Uint8Array.from([this._depth])]):this._value,t=new lD(await this._hashFn(e));this._buffers.push(t),this._availableBits+=t.availableBits()}}let lO=[255,254,252,248,240,224,192,128],lN=[1,3,7,15,31,63,127,255];class lD{_value;_currentBytePos;_currentBitPos;constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,r=0;for(;t>0&&this._haveBits();){let e=this._value[this._currentBytePos],n=this._currentBitPos+1,i=Math.min(n,t),s=lB(e,n-i,i);r=(r<<i)+s,t-=i,this._currentBitPos-=i,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return r}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function lB(e,t,r){return(e&lM(t,r))>>>t}function lM(e,t){return lO[e]&lN[Math.min(t+e-1,7)]}let lL=BigInt(id.code),lF=8;async function lU(e){return(await id.encode(e)).subarray(0,8).reverse()}let lj=async(e,t,r)=>{null==r.codec&&(r.codec=t0);let n=await nK.sha256.digest(e),i=rc.TO.create(r.cidVersion,r.codec.code,n);return await t.put(i,e,{...r,signal:r.signal}),i};class l${options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}}class lH extends l${_bucket;constructor(e,t){super(e,t),this._bucket=iI({hashFn:lU,bits:8})}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(e,t)}async get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async *eachChildSeries(){for await(let{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return void 0!==this.nodeSize||(this.nodeSize=lV(this._bucket,this,this.options)),this.nodeSize}async *flush(e){for await(let t of lq(this._bucket,e,this,this.options))yield{...t,path:this.path}}}async function*lq(e,t,r,n){let i=e._children,s=[],o=0n;for(let e=0;e<i.length;e++){let r=i.get(e);if(null==r)continue;let a=e.toString(16).toUpperCase().padStart(2,"0");if(r instanceof ig){let e;for await(let i of lq(r,t,null,n))e=i;if(null==e)throw Error("Could not flush sharded directory, no sub-shard found");s.push({Name:a,Tsize:Number(e.size),Hash:e.cid}),o+=e.size}else if(lz(r.value)){let e;for await(let n of r.value.flush(t))e=n,yield e;if(null==e)throw Error("Did not flush dir");let n=a+r.key;s.push({Name:n,Tsize:Number(e.size),Hash:e.cid}),o+=e.size}else{let e=r.value;if(null==e.cid)continue;let t=a+r.key,n=e.size;s.push({Name:t,Tsize:Number(n),Hash:e.cid}),o+=BigInt(n??0)}}let a=new nq({type:"hamt-sharded-directory",data:Uint8Array.from(i.bitField().reverse()),fanout:BigInt(e.tableSize()),hashType:lL,mtime:r?.mtime,mode:r?.mode}),l=rj(rN({Data:a.marshal(),Links:s})),c=await lj(l,t,n),u=BigInt(l.byteLength)+o;yield{cid:c,unixfs:a,size:u}}function lz(e){return"function"==typeof e.flush}function lV(e,t,r){let n=e._children,i=[];for(let e=0;e<n.length;e++){let t=n.get(e);if(null==t)continue;let s=e.toString(16).toUpperCase().padStart(2,"0");if(t instanceof ig){let e=lV(t,null,r);i.push({Name:s,Tsize:Number(e),Hash:0===r.cidVersion?lK:lG})}else if("function"==typeof t.value.flush){let e=t.value.nodeSize();i.push({Name:s+t.key,Tsize:Number(e),Hash:0===r.cidVersion?lK:lG})}else{let e=t.value;if(null==e.cid)continue;let r=s+t.key,n=e.size;i.push({Name:r,Tsize:Number(n),Hash:e.cid})}}return rj(rN({Data:new nq({type:"hamt-sharded-directory",data:Uint8Array.from(n.bitField().reverse()),fanout:BigInt(e.tableSize()),hashType:lL,mtime:t?.mtime,mode:t?.mode}).marshal(),Links:i})).length}let lK=rc.TO.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),lG=rc.TO.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi"),lW=(0,lC.vF)("helia:unixfs:commands:utils:hamt-utils"),lQ=e=>e.toString(16).toUpperCase().padStart(2,"0").substring(0,2),lJ=async(e,t,r)=>{let n=new lH({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:r.mtime,mode:r.mode},r);for(let e=0;e<t.length;e++)await n._bucket.put(t[e].name,{size:t[e].size,cid:t[e].cid});let i=await iG(n.flush(e));if(null==i)throw Error("Flushing shard yielded no result");return i},lZ=async(e,t,r)=>{let n,i,s=nq.unmarshal(e[0].node.Data??new Uint8Array(0)),o=BigInt(Math.pow(2,lF));e.reverse();for(let a=0;a<e.length;a++){let l=a===e.length-1,c=e[a],u=new nq({type:"hamt-sharded-directory",data:Uint8Array.from(c.children.bitField().reverse()),fanout:o,hashType:lL});l&&(u.mtime=s.mtime,u.mode=s.mode);let h=rj(rN(i={Data:u.marshal(),Links:c.node.Links}));if(n=await lj(h,t,r),!l){let t=e[a+1];if(null==t)throw Error("Was not operating on shard root but also had no parent?");lW("updating link in parent sub-shard with prefix %s",t.prefix),t.node.Links=t.node.Links.filter(e=>e.Name!==t.prefix),t.node.Links.push({Name:t.prefix,Hash:n,Tsize:c.node.Links.reduce((e,t)=>e+(t.Tsize??0),h.byteLength)})}}if(null==n||null==i)throw Error("Noting persisted");return{cid:n,node:i}},lY=async(e,t,r,n)=>{let i=lP(lU)((0,nm.s)(t)),s=[];for(;;){let o,a=r$(await r.get(e,n)),l=new ip,c=lQ(await i.take(lF));for(let e of(s.push({prefix:c,children:l,node:a}),a.Links)){let t=e.Name??"";if(t.length<2)throw Error("Invalid HAMT - link name was too short");let r=parseInt(t.substring(0,2),16);l.set(r,!0),t.startsWith(c)&&(o=e)}if(null==o){lW("no link found with prefix %s for %s",c,t);break}let u=o.Name??"";if(u.length<2)throw Error("Invalid HAMT - link name was too short");if(2===u.length){e=o.Hash,lW("descend into sub-shard with prefix %s",u);continue}break}return{path:s,hash:i}};async function lX(e,t,r,n){let i;if(null==e.Data)throw Error("DagPB node had no data");let s=nq.unmarshal(e.Data);if("directory"===s.type)i=l0(e);else if("hamt-sharded-directory"===s.type)i=await l1(e,0,r,t,n);else throw Error("Can only estimate the size of directories or shards");return i>r}function l0(e){let t=0;for(let r of e.Links)t+=(r.Name??"").length,t+=1===r.Hash.version?lG.bytes.byteLength:lK.bytes.byteLength;return t}async function l1(e,t,r,n,i){if(t>r)return r;if(null==e.Data||!nq.unmarshal(e.Data).isDirectory())return t;for(let s of e.Links){let e=s.Name??"";if(t+=(e=e.substring(2)).length,t+=s.Hash.bytes.byteLength,s.Hash.code===rU){let e=r$(await n.get(s.Hash,i));t+=await l1(e,t,r,n,i)}}return t}let l2=(0,lC.vF)("helia:unixfs:components:utils:add-link");async function l3(e,t,r,n){if(null==e.node.Data)throw new i3("Invalid parent passed to addLink");if("hamt-sharded-directory"===nq.unmarshal(e.node.Data).type)return l2("adding link to sharded directory"),l6(e,t,r,n);l2(`adding ${t.Name} (${t.Hash}) to regular directory`);let i=await l5(e,t,r,n);if(await lX(i.node,r,n.shardSplitThresholdBytes,n)){l2("converting directory to sharded directory");let e=await l4(i,r);i.cid=e.cid,i.node=r$(await r.get(e.cid,n))}return i}let l4=async(e,t)=>{if(null==e.node.Data)throw new i3("Invalid parent passed to convertToShardedDirectory");let r=nq.unmarshal(e.node.Data),n=await lJ(t,e.node.Links.map(e=>({name:e.Name??"",size:BigInt(e.Tsize??0),cid:e.Hash})),{mode:r.mode,mtime:r.mtime,cidVersion:e.cid.version});return l2(`converted directory to sharded directory ${n.cid}`),n},l5=async(e,t,r,n)=>{let i,s=e.node.Links.filter(e=>{let r=e.Name===t.Name;if(r&&!n.allowOverwriting)throw new iY;return!r});if(s.push(t),null==e.node.Data)throw new iJ("Parent node with no data passed to addToDirectory");let o=nq.unmarshal(e.node.Data);if(null!=o.mtime){let e=Date.now(),t=Math.floor(e/1e3);o.mtime={secs:BigInt(t),nsecs:(e-1e3*t)*1e3},i=o.marshal()}else i=e.node.Data;e.node=rN({Data:i,Links:s});let a=rj(e.node),l=await nK.sha256.digest(a),c=rc.TO.create(e.cid.version,rU,l);return await r.put(c,a),{node:e.node,cid:c}},l6=async(e,t,r,n)=>{let{path:i,hash:s}=await lY(e.cid,t.Name,r,n),o=i[i.length-1];if(null==o)throw Error("Invalid HAMT, could not generate path");let a=o.prefix,l=parseInt(a,16);l2("next prefix for %s is %s",t.Name,a);let c=`${a}${t.Name}`,u=o.node.Links.find(e=>(e.Name??"").startsWith(a));if(null!=u)if(l2("link %s was present in shard",c),u.Name===c){if(!n.allowOverwriting)throw new iY;l2("overwriting %s in sub-shard",t.Name),o.node.Links=o.node.Links.filter(e=>e.Name!==c),o.node.Links.push({Name:c,Hash:t.Hash,Tsize:t.Tsize})}else if(u.Name?.length===2)throw Error("Existing link was sub-shard?!");else{l2("prefix %s already exists, creating new sub-shard",a);let e=o.node.Links.findIndex(e=>e.Name?.startsWith(a)),r=o.node.Links.splice(e,1)[0],n=(r.Name??"").substring(2),l=lP(lU)((0,nm.s)(n));for(let e=0;e<i.length;e++)await l.take(lF);for(;;){let e=await l.take(lF),o=lQ(e);r.Name=`${o}${n}`;let c=await s.take(lF),u=lQ(c);if(o===u){let e=new ip;e.set(c,!0),i.push({prefix:u,children:e,node:{Links:[]}});continue}let h=new ip;h.set(c,!0),h.set(e,!0),i.push({prefix:a,children:h,node:{Links:[r,{Name:`${u}${t.Name}`,Hash:t.Hash,Tsize:t.Tsize}]}});break}}else l2("link %s was not present in sub-shard",c),t.Name=c,o.node.Links.push(t),o.children.set(l,!0),l2("adding %s to existing sub-shard",c);return lZ(i,r,n)};async function l8(e,t,r={}){let n=await lk(e,t,r);if("directory"!==n.type)throw new i2(`${e.toString()} was not a UnixFS directory`);return{cid:e,node:n.node}}async function l7(e,t,r,n){let i=await lk(e,r,n);if("directory"!==i.type&&"file"!==i.type&&"raw"!==i.type)throw new iQ(`${e.toString()} was not a UnixFS node`);return{Name:t,Tsize:i.node instanceof Uint8Array?i.node.byteLength:l9(i.node),Hash:e}}function l9(e){let t=e.Links.reduce((e,t)=>e+(t.Tsize??0),0);return rj(e).byteLength+t}let ce=(0,lC.vF)("helia:unixfs:components:utils:resolve");async function ct(e,t,r,n){if(null==t||""===t)return{cid:e};let i=`/ipfs/${e}${null==t?"":`/${t}`}`,s=await (0,lT.A)(lS(i,r,n));if(0===s.length)throw new iX("Could not find path in directory");return ce("resolved %s to %c",t,e),{cid:s[s.length-1].cid,path:t,segments:s}}async function cr(e,t,r,n){if(null==t.segments||0===t.segments.length)return e;let i=t.segments.pop();if(null==i)throw Error("Insufficient segments");for(let s of(i.cid=e,t.segments.reverse(),t.segments)){let[t,o]=await Promise.all([l8(s.cid,r,n),l7(i.cid,i.name,r,n)]);s.cid=e=(await l3(t,o,r,{...n,allowOverwriting:!0,cidVersion:e.version})).cid,i=s}return e}let cn=lI.bind({ignoreUndefined:!0}),ci={};async function*cs(e,t,r={}){let n=cn(ci,r),i=await ct(e,n.path,t,n),s=await lk(i.cid,t,n);if("file"!==s.type&&"raw"!==s.type)throw new i1;if(null==s.content)throw new i0;yield*s.content(n)}let co=262144,ca=lI.bind({ignoreUndefined:!0}),cl=(0,lC.vF)("helia:unixfs:chmod"),cc={recursive:!1,shardSplitThresholdBytes:co};async function cu(e,t,r,n={}){let i,s=ca(cc,n),o=await ct(e,s.path,r,n);if(cl("chmod %c %d",o.cid,t),s.recursive){let i=await (0,lr.F)(async function*(){for await(let e of l_(o.cid,r,n)){let r,n=[];if("raw"===e.type)r=new nq({type:"file",data:e.node});else if("file"===e.type||"directory"===e.type)r=e.unixfs,n=e.node.Links;else throw new iQ;r.mode=t;let i={Data:r.marshal(),Links:n};yield{path:e.path,content:i}}},t=>iH(t,r,{...s,dagBuilder:async function*(t,r){for await(let n of t)yield async function(){let t=n.content,i=rj(t),o=await lj(i,r,{...s,cidVersion:e.version});if(null==t.Data)throw new iJ(`${o} had no data`);let a=nq.unmarshal(t.Data);return{cid:o,size:BigInt(i.length),path:n.path,unixfs:a}}}}),async e=>iG(e));if(null==i)throw new iZ(`Could not chmod ${o.cid.toString()}`);return cr(i.cid,o,r,s)}let a=await r.get(o.cid,n),l=[];if(o.cid.code===nz.code)i=new nq({type:"file",data:a});else{let e=r$(a);if(null==e.Data)throw new iJ(`${o.cid.toString()} had no data`);l=e.Links,i=nq.unmarshal(e.Data)}i.mode=t;let c=rj({Data:i.marshal(),Links:l}),u=await nK.sha256.digest(c),h=rc.TO.create(o.cid.version,rU,u);return await r.put(h,c),cr(h,o,r,s)}let ch=lI.bind({ignoreUndefined:!0}),cd=(0,lC.vF)("helia:unixfs:cp"),cf={force:!1,shardSplitThresholdBytes:co};async function cp(e,t,r,n,i={}){let s=ch(cf,i);if(r.includes("/"))throw new i3("Name must not have slashes");let[o,a]=await Promise.all([l8(t,n,s),l7(e,r,n,s)]);return cd('Adding %c as "%s" to %c',e,r,t),(await l3(o,a,n,{allowOverwriting:s.force,cidVersion:t.version,...s})).cid}let cg=lI.bind({ignoreUndefined:!0}),cm={};async function*cy(e,t,r={}){let n=cg(cm,r),i=await ct(e,n.path,t,n),s=await lk(i.cid,t);if("file"===s.type||"raw"===s.type)return void(yield s);if(null==s.content)throw new i0;if("directory"!==s.type)throw new i2;yield*s.content({offset:r.offset,length:r.length})}let cb=lI.bind({ignoreUndefined:!0}),cw=(0,lC.vF)("helia:unixfs:mkdir"),cv={cidVersion:1,force:!1,shardSplitThresholdBytes:co};async function cE(e,t,r,n={}){let i=cb(cv,n);if(t.includes("/"))throw new i3("Path must not have slashes");if("directory"!==(await lk(e,r,n)).type)throw new i2(`${e.toString()} was not a UnixFS directory`);cw("creating %s",t);let s=rj({Data:new nq({type:"directory",mode:i.mode,mtime:i.mtime}).marshal(),Links:[]}),o=await nK.sha256.digest(s),a=rc.TO.create(i.cidVersion,rU,o);await r.put(a,s);let[l,c]=await Promise.all([l8(e,r,i),l7(a,t,r,i)]);return cw("adding empty dir called %s to %c",t,e),(await l3(l,c,r,{...i,allowOverwriting:i.force})).cid}let cA=(0,lC.vF)("helia:unixfs:utils:remove-link");async function cx(e,t,r,n){if(null==e.node.Data)throw new iJ("Parent node had no data");if("hamt-sharded-directory"===nq.unmarshal(e.node.Data).type){cA(`removing ${t} from sharded directory`);let i=await ck(e,t,r,n);return await lX(i.node,r,n.shardSplitThresholdBytes,n)?i:(cA("converting shard to flat directory %c",e.cid),c_(i,r,n))}return cA(`removing link ${t} regular directory`),cS(e,t,r,n)}let cS=async(e,t,r,n)=>{e.node.Links=e.node.Links.filter(e=>e.Name!==t);let i=rj(e.node),s=await lj(i,r,{...n,cidVersion:e.cid.version});return cA(`Updated regular directory ${s}`),{node:e.node,cid:s}},ck=async(e,t,r,n)=>{let{path:i}=await lY(e.cid,t,r,n),s=i[i.length-1];if(null==s)throw Error("Invalid HAMT, could not generate path");let o=s.node.Links.filter(e=>(e.Name??"").substring(2)===t).map(e=>e.Name).pop();if(null==o)throw Error("File not found");let a=parseInt(o.substring(0,2),16);if(s.node.Links=s.node.Links.filter(e=>e.Name!==o),s.children.unset(a),1===s.node.Links.length)for(;1!==i.length;){let e=i[i.length-1];if(null==e||e.node.Links.length>1)break;i.pop();let t=i[i.length-1];if(null==t)break;let r=e.node.Links[0];t.node.Links=t.node.Links.filter(e=>!(e.Name??"").startsWith(t.prefix)),t.node.Links.push({Hash:r.Hash,Name:`${t.prefix}${(r.Name??"").substring(2)}`,Tsize:r.Tsize})}return lZ(i,r,n)},c_=async(e,t,r)=>{if(null==e.node.Data)throw new i3("Invalid parent passed to convertToFlatDirectory");let n={Links:[]},i=await lk(e.cid,t);if("directory"!==i.type)throw Error("Unexpected node type");for await(let e of i.content()){let t=0;t=e.node instanceof Uint8Array?e.node.byteLength:rj(e.node).length,n.Links.push({Hash:e.cid,Name:e.name,Tsize:t})}let s=nq.unmarshal(e.node.Data);n.Data=new nq({type:"directory",mode:s.mode,mtime:s.mtime}).marshal();let o=rj(rN(n));return{cid:await lj(o,t,{codec:t0,cidVersion:e.cid.version,signal:r.signal}),node:n}},cI=lI.bind({ignoreUndefined:!0}),cC=(0,lC.vF)("helia:unixfs:rm"),cT={shardSplitThresholdBytes:co};async function cP(e,t,r,n={}){let i=cI(cT,n);if(t.includes("/"))throw new i3("Name must not have slashes");let s=await l8(e,r,i);return cC("Removing %s from %c",t,e),(await cx(s,t,r,{...i,cidVersion:e.version})).cid}let cR=64;class cO{fp;h;seed;constructor(e,t,r,n=2){if(n>cR)throw TypeError("Invalid Fingerprint Size");let i=t.hashV(e,r),s=(0,t9.c)(n);for(let e=0;e<s.length;e++)s[e]=i[e];0===s.length&&(s[0]=7),this.fp=s,this.h=t,this.seed=r}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return e?.fp instanceof Uint8Array&&rr(this.fp,e.fp)}}function cN(e,t){return Math.floor(Math.random()*(t-e))+e}class cD{contents;constructor(e){this.contents=Array(e).fill(null)}has(e){if(!(e instanceof cO))throw TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof cO))throw TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(null==this.contents[t]){this.contents[t]=e;break}return!0}swap(e){if(!(e instanceof cO))throw TypeError("Invalid Fingerprint");let t=cN(0,this.contents.length-1),r=this.contents[t];return this.contents[t]=e,r}remove(e){if(!(e instanceof cO))throw TypeError("Invalid Fingerprint");let t=this.contents.findIndex(t=>e.equals(t));return t>-1&&(this.contents[t]=null,!0)}}let cB={32:16777619n,64:1099511628211n,128:0x1000000000000000000013bn,256:0x1000000000000000000000000000000000000000163n,512:0x100000000000000000000000000000000000000000000000000000000000000000000000000000000000157n,1024:0x10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000018dn},cM={32:2166136261n,64:0xcbf29ce484222325n,128:0x6c62272e07bb014262b821756295c58dn,256:0xdd268dbcaac550362d98c384c4e576ccc8b1536847b6bbb31023b4c8caee0535n,512:0xb86db0b1171f4416dca1e50f309990acac87d059c90000000000000000000d21e948f68a34c192f62ea79bc942dbe7ce182036415f56e34bac982aac4afe9fd9n,1024:0x5f7a76758ecc4d32e56d5a591028b74b29fc4223fdada16c3bf34eda3674da9a21d9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004c6d7eb6e73802734510a555f256cc005ae556bde8cc9c6a93b21aff4b16c71ee90b3n},cL=new globalThis.TextEncoder;function cF(e,t){let r=cB[t],n=cM[t];for(let i=0;i<e.length;i++)n^=BigInt(e[i]),n=BigInt.asUintN(t,n*r);return n}function cU(e,t,r){if(0===r.length)throw Error("The `utf8Buffer` option must have a length greater than zero");let n=cB[t],i=cM[t],s=e;for(;s.length>0;){let e=cL.encodeInto(s,r);s=s.slice(e.read);for(let s=0;s<e.written;s++)i^=BigInt(r[s]),i=BigInt.asUintN(t,i*n)}return i}function cj(e,{size:t=32,utf8Buffer:r}={}){if(!cB[t])throw Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if("string"==typeof e){if(r)return cU(e,t,r);e=cL.encode(e)}return cF(e,t)}let c$={hash:e=>Number(cj(e,{size:32})),hashV:(e,t)=>cH(c$.hash(e,t))};function cH(e){let t=e.toString(16);return t.length%2==1&&(t=`0${t}`),(0,nm.s)(t,"base16")}let cq=500;class cz{bucketSize;filterSize;fingerprintSize;buckets;count;hash;seed;constructor(e){this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??c$,this.seed=e.seed??cN(0,1024)}add(e){"string"==typeof e&&(e=(0,nm.s)(e));let t=new cO(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,n=(r^t.hash())%this.filterSize;if(null==this.buckets[r]&&(this.buckets[r]=new cD(this.bucketSize)),null==this.buckets[n]&&(this.buckets[n]=new cD(this.bucketSize)),this.buckets[r].add(t)||this.buckets[n].add(t))return this.count++,!0;let i=[r,n],s=i[cN(0,i.length-1)];null==this.buckets[s]&&(this.buckets[s]=new cD(this.bucketSize));for(let e=0;e<cq;e++){let e=this.buckets[s].swap(t);if(null!=e){if(s=(s^e.hash())%this.filterSize,null==this.buckets[s]&&(this.buckets[s]=new cD(this.bucketSize)),this.buckets[s].add(e))return this.count++,!0;continue}}return!1}has(e){"string"==typeof e&&(e=(0,nm.s)(e));let t=new cO(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,n=this.buckets[r]?.has(t)??!1;if(n)return n;let i=(r^t.hash())%this.filterSize;return this.buckets[i]?.has(t)??!1}remove(e){"string"==typeof e&&(e=(0,nm.s)(e));let t=new cO(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,n=this.buckets[r]?.remove(t)??!1;if(n)return this.count--,n;let i=(r^t.hash())%this.filterSize,s=this.buckets[i]?.remove(t)??!1;return s&&this.count--,s}get reliable(){return 90>=Math.floor(100*(this.count/this.filterSize))}}let cV={1:.5,2:.84,4:.95,8:.98};function cK(e=.001){return e>.002?2:e>1e-5?4:8}function cG(e,t=.001){let r=cK(t),n=Math.round(e/cV[r]),i=Math.min(Math.ceil(Math.log2(1/t)+Math.log2(2*r)),cR);return{filterSize:n,bucketSize:r,fingerprintSize:i}}class cW{filterSize;bucketSize;fingerprintSize;scale;filterSeries;hash;seed;constructor(e){this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??262144/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??c$,this.seed=e.seed??cN(0,1024),this.filterSeries=[new cz({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if("string"==typeof e&&(e=(0,nm.s)(e)),this.has(e))return!0;let t=this.filterSeries.find(e=>e.reliable);return null==t&&(t=new cz({filterSize:this.filterSize*Math.pow(this.scale,this.filterSeries.length),bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)),t.add(e)}has(e){"string"==typeof e&&(e=(0,nm.s)(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){"string"==typeof e&&(e=(0,nm.s)(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}}function cQ(e,t=.001,r){return new cW({...cG(e,t),...r??{}})}let cJ=1877,cZ=1604,cY=lI.bind({ignoreUndefined:!0}),cX=(0,lC.vF)("helia:unixfs:stat"),c0={};async function c1(e,t,r={}){let n=cY(c0,r),i=await ct(e,r.path,t,n);cX("stat %c",i.cid);let s=await lk(i.cid,t,n);if("raw"===s.type)return!0===r.extended?c5(s):c4(s);if("file"===s.type||"directory"===s.type)return!0===r.extended?c3(s,t,r.filter??new cW({filterSize:1024}),r):c2(s);throw new iQ}function c2(e){return{type:e.type,cid:e.cid,unixfs:e.unixfs,mode:e.unixfs.mode??(e.unixfs.isDirectory()?cJ:cZ),mtime:e.unixfs.mtime,size:e.unixfs.fileSize()}}async function c3(e,t,r,n){let i=await c6(e.cid,t,!1,r,n);return{type:e.type,cid:e.cid,unixfs:e.unixfs,size:e.unixfs.isDirectory()?i.dirSize:e.unixfs.fileSize(),mode:e.unixfs.mode??(e.unixfs.isDirectory()?cJ:cZ),mtime:e.unixfs.mtime,localSize:i.localSize,dagSize:i.dagSize,deduplicatedDagSize:i.deduplicatedDagSize,blocks:i.blocks,uniqueBlocks:i.uniqueBlocks}}function c4(e){return{type:e.type,cid:e.cid,unixfs:void 0,mode:cZ,mtime:void 0,size:BigInt(e.node.byteLength)}}function c5(e){return{type:e.type,cid:e.cid,unixfs:void 0,mode:cZ,mtime:void 0,size:BigInt(e.node.byteLength),localSize:BigInt(e.node.byteLength),dagSize:BigInt(e.node.byteLength),deduplicatedDagSize:BigInt(e.node.byteLength),blocks:1n,uniqueBlocks:1n}}async function c6(e,t,r,n,i){let s={dirSize:0n,localSize:0n,dagSize:0n,deduplicatedDagSize:0n,blocks:0n,uniqueBlocks:0n};try{let o=n.has(e.bytes);n.add(e.bytes);let a=await t.get(e,i);if(s.blocks++,s.dagSize+=BigInt(a.byteLength),o||(s.uniqueBlocks++,s.deduplicatedDagSize+=BigInt(a.byteLength)),e.code===nz.code)s.localSize+=BigInt(a.byteLength),r&&(s.dirSize+=BigInt(a.byteLength));else if(e.code===rU){let o,l=r$(a);if(null!=l.Data&&(o=nq.unmarshal(l.Data)),l.Links.length>0){for(let e of l.Links){let r=await c6(e.Hash,t,c8(e,o),n,i);s.localSize+=r.localSize,s.dagSize+=r.dagSize,s.deduplicatedDagSize+=r.deduplicatedDagSize,s.blocks+=r.blocks,s.uniqueBlocks+=r.uniqueBlocks,s.dirSize+=r.dirSize}r&&null!=o&&(s.dirSize+=o.fileSize())}else{if(null==o)throw new iJ(`PBNode ${e.toString()} had no data`);null!=o.data&&(s.localSize+=BigInt(o.data.byteLength??0)),r&&(s.dirSize+=o.fileSize())}}else throw new iZ(`${e.toString()} was neither DAG_PB nor RAW`)}catch(e){if("NotFoundError"!==e.name||!0!==i.offline)throw e}return s}function c8(e,t){if(null==t)return!1;let r=e.Name;return null!=r&&("directory"===t.type||"hamt-sharded-directory"===t.type&&!!(r.length>2))}let c7=lI.bind({ignoreUndefined:!0}),c9=(0,lC.vF)("helia:unixfs:touch"),ue={recursive:!1,shardSplitThresholdBytes:co};async function ut(e,t,r={}){let n,i=c7(ue,r),s=await ct(e,i.path,t,i),o=i.mtime??{secs:BigInt(Math.round(Date.now()/1e3)),nsecs:0};if(c9("touch %c %o",s.cid,o),i.recursive){let r=await (0,lr.F)(async function*(){for await(let e of l_(s.cid,t)){let t,r;if("raw"===e.type)t=new nq({data:e.node}),r=[];else if("file"===e.type||"directory"===e.type)t=e.unixfs,r=e.node.Links;else throw new iQ;t.mtime=o;let n={Data:t.marshal(),Links:r};yield{path:e.path,content:n}}},r=>iH(r,t,{...i,dagBuilder:async function*(t,r){for await(let n of t)yield async function(){let t=n.content,s=rj(t),o=await lj(s,r,{...i,cidVersion:e.version});if(null==t.Data)throw new iJ(`${o} had no data`);let a=nq.unmarshal(t.Data);return{cid:o,size:BigInt(s.length),path:n.path,unixfs:a}}}}),async e=>iG(e));if(null==r)throw new iZ(`Could not chmod ${s.cid.toString()}`);return cr(r.cid,s,t,i)}let a=await t.get(s.cid,r),l=[];if(s.cid.code===nz.code)n=new nq({data:a});else{let e=r$(a);if(l=e.Links,null==e.Data)throw new iJ(`${s.cid.toString()} had no data`);n=nq.unmarshal(e.Data)}n.mtime=o;let c=rj({Data:n.marshal(),Links:l}),u=await nK.sha256.digest(c),h=rc.TO.create(s.cid.version,rU,u);return await t.put(h,c),cr(h,s,t,i)}class ur{components;constructor(e){this.components=e}async *addAll(e,t={}){yield*i5(e,this.components.blockstore,t)}async addBytes(e,t={}){return i6(e,this.components.blockstore,t)}async addByteStream(e,t={}){return i8(e,this.components.blockstore,t)}async addFile(e,t={}){return i7(e,this.components.blockstore,t)}async addDirectory(e={},t={}){return i9(e,this.components.blockstore,t)}async *cat(e,t={}){yield*cs(e,this.components.blockstore,t)}async chmod(e,t,r={}){return cu(e,t,this.components.blockstore,r)}async cp(e,t,r,n={}){return cp(e,t,r,this.components.blockstore,n)}async *ls(e,t={}){yield*cy(e,this.components.blockstore,t)}async mkdir(e,t,r={}){return cE(e,t,this.components.blockstore,r)}async rm(e,t,r={}){return cP(e,t,this.components.blockstore,r)}async stat(e,t={}){return c1(e,this.components.blockstore,t)}async touch(e,t={}){return ut(e,this.components.blockstore,t)}}function un(e){return new ur(e)}class ui{dbName;ipfs;providerCID;fs;protocol;constructor(e,t){this.dbName=e,this.ipfs=t,this.protocol=`/astradb/${this.dbName}`}async init(e){this.providerCID=await this.constructProviderCID(this.dbName),await this.ipfs.libp2p.handle(this.protocol,({stream:e})=>{console.log(`Received connection from /astradb/${this.dbName} peer`)}),this.startService(async()=>{await this.connectToProviders()}),e&&this.startService(async()=>{await this.provideDB(this.providerCID)}),this.setupEvents()}async constructProviderCID(e){this.fs=un(this.ipfs);let t=new TextEncoder,r=await this.fs.addBytes(t.encode(e));if(!await this.ipfs.pins.isPinned(r))for await(let e of this.ipfs.pins.add(r))console.log(`Pinned CID: ${e}`);return console.log(`Provider CID created: ${r}`),r}async provideDB(e){let t=!1;for(console.log("Providing CID address...");!t;)try{let r=performance.now();await this.ipfs.routing.provide(e);let n=performance.now();t=!0,console.log(`CID ${e} provided, took ${(n-r)/1e3} seconds`)}catch(e){console.error("Error providing CID:",e),console.log("Retrying provide...")}}async connectToProviders(){try{for await(let e of this.ipfs.libp2p.contentRouting.findProviders(this.providerCID))try{if(e.id.equals(this.ipfs.libp2p.peerId)||this.ipfs.libp2p.getConnections(e.id).length>0)continue;console.log(`New provider found, connecting: ${e.id}`),this.ipfs.libp2p.dial(e.id).then(t=>{console.log(`Connected to provider ${e.id}`),this.manageNewConnection(e.id)},t=>{console.error(`Error connecting to provider ${e.id}: ${t}`)})}catch(t){console.error(`Error connecting to provider ${e.id}: ${t}`)}}catch(e){console.error("Error finding providers:",e)}}setupEvents(){this.ipfs.libp2p.addEventListener("peer:connect",e=>{let t=e.detail;this.manageNewConnection(t)})}async manageNewConnection(e){let t,r=!1,n=0;for(;!r;){if(!await this.ipfs.libp2p.peerStore.has(e)){if(n>10)return void console.log("Warning: New connection peer info not found, skipping peer. Triggered by: ",e);n++,await new Promise(e=>setTimeout(e,100));continue}t=await this.ipfs.libp2p.peerStore.get(e),r=!0}t.protocols.includes(this.protocol)&&(console.log(`Provider is an /astradb/${this.dbName} peer: ${e}`),await this.ipfs.libp2p.peerStore.merge(e,{tags:{"astradb-peer":{value:100}}}))}async startService(e){for(;;){try{await e()}catch(e){console.error("Error in service function:",e)}await new Promise(e=>setTimeout(e,6e4))}}}let us=Symbol.for("@libp2p/content-routing"),uo=Symbol.for("@libp2p/peer-routing");function ua(e){return null!=e&&"function"==typeof e.start&&"function"==typeof e.stop}async function ul(...e){let t=[];for(let r of e)ua(r)&&t.push(r);await Promise.all(t.map(async e=>{null!=e.beforeStart&&await e.beforeStart()})),await Promise.all(t.map(async e=>{await e.start()})),await Promise.all(t.map(async e=>{null!=e.afterStart&&await e.afterStart()}))}async function uc(...e){let t=[];for(let r of e)ua(r)&&t.push(r);await Promise.all(t.map(async e=>{null!=e.beforeStop&&await e.beforeStop()})),await Promise.all(t.map(async e=>{await e.stop()})),await Promise.all(t.map(async e=>{null!=e.afterStop&&await e.afterStop()}))}function uu(e){let t=[l.A];return null==e?t:Array.isArray(e)?0===e.length?t:e:[e]}var uh=r(77477);let ud=60;function uf(e){return{Status:e.Status??0,TC:e.TC??e.flag_tc??!1,RD:e.RD??e.flag_rd??!1,RA:e.RA??e.flag_ra??!1,AD:e.AD??e.flag_ad??!1,CD:e.CD??e.flag_cd??!1,Question:(e.Question??e.questions??[]).map(e=>({name:e.name,type:l[e.type]})),Answer:(e.Answer??e.answers??[]).map(e=>({name:e.name,type:l[e.type],TTL:e.TTL??e.ttl??ud,data:e.data instanceof Uint8Array?(0,uh.d)(e.data):e.data}))}}let up=4;function ug(e,t={}){let r=new lf({concurrency:t.queryConcurrency??up});return async(t,n={})=>{let i=new URLSearchParams;i.set("name",t),uu(n.types).forEach(e=>{i.append("type",l[e])}),n.onProgress?.(new nV("dns:query",{detail:t}));let s=await r.add(async()=>{let t=await fetch(`${e}?${i}`,{headers:{accept:"application/dns-json"},signal:n?.signal});if(200!==t.status)throw Error(`Unexpected HTTP status: ${t.status} - ${t.statusText}`);let r=uf(await t.json());return n.onProgress?.(new nV("dns:response",{detail:r})),r},{signal:n.signal});if(null==s)throw Error("No DNS response received");return s}}function um(){return[ug("https://cloudflare-dns.com/dns-query"),ug("https://dns.google/resolve")]}var uy=r(91011);class ub{lru;constructor(e){this.lru=uy(e)}get(e,t){let r=!0,n=[];for(let i of t){let t=this.getAnswers(e,i);if(0===t.length){r=!1;break}n.push(...t)}if(r)return uf({answers:n})}getAnswers(e,t){let r=`${e.toLowerCase()}-${t}`,n=this.lru.get(r);if(null!=n){let e=n.filter(e=>e.expires>Date.now()).map(({expires:e,value:t})=>({...t,TTL:Math.round((e-Date.now())/1e3),type:l[t.type]}));return 0===e.length&&this.lru.remove(r),e}return[]}add(e,t){let r=`${e.toLowerCase()}-${t.type}`,n=this.lru.get(r)??[];n.push({expires:Date.now()+(t.TTL??ud)*1e3,value:t}),this.lru.set(r,n)}remove(e,t){let r=`${e.toLowerCase()}-${t}`;this.lru.remove(r)}clear(){this.lru.clear()}}function uw(e){return new ub(e)}let uv=1e3;class uE{resolvers;cache;constructor(e){this.resolvers={},this.cache=uw(e.cacheSize??uv),Object.entries(e.resolvers??{}).forEach(([e,t])=>{Array.isArray(t)||(t=[t]),e.endsWith(".")||(e=`${e}.`),this.resolvers[e]=t}),null==this.resolvers["."]&&(this.resolvers["."]=um())}async query(e,t={}){let r=uu(t.types),n=!1!==t.cached?this.cache.get(e,r):void 0;if(null!=n)return t.onProgress?.(new nV("dns:cache",{detail:n})),n;let i=`${e.split(".").pop()}.`,s=(this.resolvers[i]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),o=[];for(let n of s){if(t.signal?.aborted===!0)break;try{let i=await n(e,{...t,types:r});for(let t of i.Answer)this.cache.add(e,t);return i}catch(e){o.push(e),t.onProgress?.(new nV("dns:error",{detail:e}))}}if(1===o.length)throw o[0];throw AggregateError(o,`DNS lookup of ${e} ${r} failed`)}}function uA(e={}){return new uE(e)}!function(e){e[e.A=1]="A",e[e.CNAME=5]="CNAME",e[e.TXT=16]="TXT",e[e.AAAA=28]="AAAA"}(l||(l={}));var ux=r(24802);class uS extends EventTarget{#_=new Map;constructor(){super()}listenerCount(e){let t=this.#_.get(e);return null==t?0:t.length}addEventListener(e,t,r){super.addEventListener(e,t,r);let n=this.#_.get(e);null==n&&(n=[],this.#_.set(e,n)),n.push({callback:t,once:(!0!==r&&!1!==r&&r?.once)??!1})}removeEventListener(e,t,r){super.removeEventListener(e.toString(),t??null,r);let n=this.#_.get(e);null!=n&&(n=n.filter(({callback:e})=>e!==t),this.#_.set(e,n))}dispatchEvent(e){let t=super.dispatchEvent(e),r=this.#_.get(e.type);return null==r||(r=r.filter(({once:e})=>!e),this.#_.set(e.type,r)),t}safeDispatchEvent(e,t={}){return this.dispatchEvent(new CustomEvent(e,t))}}class uk extends Error{static name="AbortError";constructor(e="The operation was aborted"){super(e),this.name="AbortError"}}class u_ extends Error{static name="UnexpectedPeerError";constructor(e="Unexpected Peer"){super(e),this.name="UnexpectedPeerError"}}class uI extends Error{static name="InvalidCryptoExchangeError";constructor(e="Invalid crypto exchange"){super(e),this.name="InvalidCryptoExchangeError"}}class uC extends Error{static name="InvalidParametersError";constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}}class uT extends Error{static name="InvalidPublicKeyError";constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}}class uP extends Error{static name="InvalidPrivateKeyError";constructor(e="Invalid private key"){super(e),this.name="InvalidPrivateKeyError"}}class uR extends Error{static name="ConnectionClosingError";constructor(e="The connection is closing"){super(e),this.name="ConnectionClosingError"}}class uO extends Error{static name="ConnectionClosedError";constructor(e="The connection is closed"){super(e),this.name="ConnectionClosedError"}}class uN extends Error{static name="ConnectionFailedError";constructor(e="Connection failed"){super(e),this.name="ConnectionFailedError"}}class uD extends Error{static name="MuxerClosedError";constructor(e="The muxer is closed"){super(e),this.name="MuxerClosedError"}}class uB extends Error{static name="StreamResetError";constructor(e="The stream has been reset"){super(e),this.name="StreamResetError"}}class uM extends Error{static name="StreamStateError";constructor(e="The stream is in an invalid state"){super(e),this.name="StreamStateError"}}class uL extends Error{static name="NotFoundError";constructor(e="Not found"){super(e),this.name="NotFoundError"}}class uF extends Error{static name="InvalidPeerIdError";constructor(e="Invalid PeerID"){super(e),this.name="InvalidPeerIdError"}}class uU extends Error{static name="InvalidMultiaddrError";constructor(e="Invalid multiaddr"){super(e),this.name="InvalidMultiaddrError"}}class uj extends Error{static name="InvalidCIDError";constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}}class u$ extends Error{static name="InvalidMultihashError";constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}}class uH extends Error{static name="UnsupportedProtocolError";constructor(e="Unsupported protocol error"){super(e),this.name="UnsupportedProtocolError"}}class uq extends Error{static name="InvalidMessageError";constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}}class uz extends Error{static name="ProtocolError";constructor(e="Protocol error"){super(e),this.name="ProtocolError"}}class uV extends Error{static name="TimeoutError";constructor(e="Timed out"){super(e),this.name="TimeoutError"}}class uK extends Error{static name="NotStartedError";constructor(e="Not started"){super(e),this.name="NotStartedError"}}class uG extends Error{static name="DialError";constructor(e="Dial error"){super(e),this.name="DialError"}}class uW extends Error{static name="ListenError";constructor(e="Listen error"){super(e),this.name="ListenError"}}class uQ extends Error{static name="LimitedConnectionError";constructor(e="Limited connection"){super(e),this.name="LimitedConnectionError"}}class uJ extends Error{static name="TooManyInboundProtocolStreamsError";constructor(e="Too many inbound protocol streams"){super(e),this.name="TooManyInboundProtocolStreamsError"}}class uZ extends Error{static name="TooManyOutboundProtocolStreamsError";constructor(e="Too many outbound protocol streams"){super(e),this.name="TooManyOutboundProtocolStreamsError"}}class uY extends Error{static name="UnsupportedKeyTypeError";constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}}class uX extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.name="AbortError",this.code=t??"ABORT_ERR"}}async function u0(e,t,r,n){let i=new uX(n?.errorMessage,n?.errorCode);return r?.aborted===!0?Promise.reject(i):new Promise((s,o)=>{function a(){r?.removeEventListener("abort",u),e.removeEventListener(t,l),n?.errorEvent!=null&&e.removeEventListener(n.errorEvent,c)}let l=e=>{try{if(n?.filter?.(e)===!1)return}catch(e){a(),o(e);return}a(),s(e)},c=e=>{a(),o(e.detail)},u=()=>{a(),o(i)};r?.addEventListener("abort",u),e.addEventListener(t,l),n?.errorEvent!=null&&e.addEventListener(n.errorEvent,c)})}class u1 extends Error{remainingPoints;msBeforeNext;consumedPoints;isFirstInDuration;constructor(e="Rate limit exceeded",t){super(e),this.name="RateLimitError",this.remainingPoints=t.remainingPoints,this.msBeforeNext=t.msBeforeNext,this.consumedPoints=t.consumedPoints,this.isFirstInDuration=t.isFirstInDuration}}class u2 extends Error{static name="QueueFullError";constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}var u3=r(10258);class u4{deferred;signal;constructor(e){this.signal=e,this.deferred=(0,a9.A)(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new uk)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}}function u5(){return`${parseInt(String(1e9*Math.random()),10).toString()}${Date.now()}`}class u6{id;fn;options;recipients;status;timeline;controller;constructor(e,t){this.id=u5(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((e,t)=>e&&t.signal?.aborted===!0,!0)&&(this.controller.abort(new uk),this.cleanup())}async join(e={}){let t=new u4(e.signal);return this.recipients.push(t),e.signal?.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();let e=await (0,u3.W)(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{e.cleanup(),e.signal?.removeEventListener("abort",this.onAbort)})}}class u8 extends uS{concurrency;maxSize;queue;pending;sort;constructor(e={}){super(),this.concurrency=e.concurrency??Number.POSITIVE_INFINITY,this.maxSize=e.maxSize??Number.POSITIVE_INFINITY,this.pending=0,null!=e.metricName&&e.metrics?.registerMetricGroup(e.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})}),this.sort=e.sort,this.queue=[]}tryToStartAnother(){if(0===this.size)return queueMicrotask(()=>{this.safeDispatchEvent("empty")}),0===this.running&&queueMicrotask(()=>{this.safeDispatchEvent("idle")}),!1;if(this.pending<this.concurrency){let e;for(let t of this.queue)if("queued"===t.status){e=t;break}return null!=e&&(this.safeDispatchEvent("active"),this.pending++,e.run().finally(()=>{for(let t=0;t<this.queue.length;t++)if(this.queue[t]===e){this.queue.splice(t,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(e){this.queue.push(e),null!=this.sort&&this.queue.sort(this.sort)}async add(e,t){if(t?.signal?.throwIfAborted(),this.size===this.maxSize)throw new u2;let r=new u6(e,t);return this.enqueue(r),this.safeDispatchEvent("add"),this.tryToStartAnother(),r.join(t).then(e=>(this.safeDispatchEvent("completed",{detail:e}),this.safeDispatchEvent("success",{detail:{job:r,result:e}}),e)).catch(e=>{if("queued"===r.status){for(let e=0;e<this.queue.length;e++)if(this.queue[e]===r){this.queue.splice(e,1);break}}throw this.safeDispatchEvent("error",{detail:e}),this.safeDispatchEvent("failure",{detail:{job:r,error:e}}),e})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(e=>{e.abort(new uk)}),this.clear()}async onEmpty(e){0!==this.size&&await u0(this,"empty",e?.signal)}async onSizeLessThan(e,t){this.size<e||await u0(this,"next",t?.signal,{filter:()=>this.size<e})}async onIdle(e){(0!==this.pending||0!==this.size)&&await u0(this,"idle",e?.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async *toGenerator(e){e?.signal?.throwIfAborted();let t=(0,li.Ny)({objectMode:!0}),r=e=>{null!=e?this.abort():this.clear(),t.end(e)},n=e=>{null!=e.detail&&t.push(e.detail)},i=e=>{r(e.detail)},s=()=>{r()},o=()=>{r(new uk("Queue aborted"))};this.addEventListener("completed",n),this.addEventListener("error",i),this.addEventListener("idle",s),e?.signal?.addEventListener("abort",o);try{yield*t}finally{this.removeEventListener("completed",n),this.removeEventListener("error",i),this.removeEventListener("idle",s),e?.signal?.removeEventListener("abort",o),r()}}}var u7=r(31987),u9=r(41472);function he({enumerable:e=!0,configurable:t=!1}={}){return{enumerable:e,configurable:t,writable:!1}}function*ht(e,t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))for(let[r,n]of t.entries()){let t=[...e,r],i=il.TO.asCID(n);null!=i?yield[t.join("/"),i]:"object"==typeof n&&(yield*hr(n,t))}else{let r=il.TO.asCID(t);null!=r?yield[e.join("/"),r]:yield*hr(t,e)}}function*hr(e,t){if(null==e||e instanceof Uint8Array)return;let r=il.TO.asCID(e);for(let[n,i]of(null!=r&&(yield[t.join("/"),r]),Object.entries(e))){let e=[...t,n];yield*ht(e,i)}}function*hn(e,t){if(Array.isArray(t))for(let[r,n]of t.entries()){let t=[...e,r];yield t.join("/"),"object"==typeof n&&null==il.TO.asCID(n)&&(yield*hi(n,t))}else yield*hi(t,e)}function*hi(e,t){if(null!=e&&"object"==typeof e)for(let[r,n]of Object.entries(e)){let e=[...t,r];yield e.join("/"),null==n||n instanceof Uint8Array||"object"!=typeof n||null!=il.TO.asCID(n)||(yield*hn(e,n))}}function hs(e,t){let r=e;for(let[e,n]of t.entries()){if(null==(r=r[n]))throw Error(`Object has no property at ${t.slice(0,e+1).map(e=>`[${JSON.stringify(e)}]`).join("")}`);let i=il.TO.asCID(r);if(null!=i)return{value:i,remaining:t.slice(e+1).join("/")}}return{value:r}}class ho{cid;bytes;value;asBlock;constructor({cid:e,bytes:t,value:r}){if(null==e||null==t||void 0===r)throw Error("Missing required argument");this.cid=e,this.bytes=t,this.value=r,this.asBlock=this,Object.defineProperties(this,{cid:he(),bytes:he(),value:he(),asBlock:he()})}links(){return hr(this.value,[])}tree(){return hi(this.value,[])}get(e="/"){return hs(this.value,e.split("/").filter(Boolean))}}function ha({bytes:e,cid:t,value:r,codec:n}){let i=void 0!==r?r:n?.decode(e);if(void 0===i)throw Error('Missing required argument, must either provide "value" or "codec"');return new ho({cid:t,bytes:e,value:i})}let hl="/pin/",hc="/pinned-block/",hu=u9.base36,hh=1;function hd(e){return 0===e.version&&(e=e.toV1()),new u7.U(`${hl}${e.toString(hu)}`)}class hf{datastore;blockstore;getCodec;constructor(e,t,r){this.datastore=e,this.blockstore=t,this.getCodec=r}async *add(e,t={}){let r=hd(e);if(await this.datastore.has(r))throw Error("Already pinned");let n=Math.round(t.depth??1/0);if(n<0)throw Error("Depth must be greater than or equal to 0");let i=new u8({concurrency:hh});for await(let r of this.#I(e,i,{...t,depth:n}))await this.#C(r,t=>null==t.pinnedBy.find(t=>rr(t,e.bytes))&&(t.pinCount++,t.pinnedBy.push(e.bytes),!0),t),yield r;let s={depth:n,metadata:t.metadata??{}};await this.datastore.put(r,ae(s),t)}async *#I(e,t,r){if(-1===r.depth)return;let n=await this.getCodec(e.code),i=ha({bytes:await this.blockstore.get(e,r),cid:e,codec:n});for await(let[,n]of(yield e,i.links()))yield*await t.add(async()=>this.#I(n,t,{...r,depth:r.depth-1}))}async #C(e,t,r){let n=new u7.U(`${hc}${hu.encode(e.multihash.bytes)}`),i={pinCount:0,pinnedBy:[]};try{i=ac(await this.datastore.get(n,r))}catch(e){if("NotFoundError"!==e.name)throw e}if(t(i)){if(0===i.pinCount&&await this.datastore.has(n))return void await this.datastore.delete(n);await this.datastore.put(n,ae(i),r),r.onProgress?.(new nV("helia:pin:add",e))}}async *rm(e,t={}){let r=hd(e),n=ac(await this.datastore.get(r,t));await this.datastore.delete(r,t);let i=new u8({concurrency:hh});for await(let r of this.#I(e,i,{...t,depth:n.depth}))await this.#C(r,t=>(t.pinCount--,t.pinnedBy=t.pinnedBy.filter(t=>rr(t,e.bytes)),!0),{...t,depth:n.depth}),yield r}async *ls(e={}){for await(let{key:t,value:r}of this.datastore.query({prefix:hl+(null!=e.cid?`${e.cid.toString(u9.base36)}`:"")},e)){let e=rc.TO.parse(t.toString().substring(5),u9.base36),n=ac(r);yield{cid:e,...n}}}async isPinned(e,t={}){let r=new u7.U(`${hc}${hu.encode(e.multihash.bytes)}`);return this.datastore.has(r,t)}async get(e,t){let r=hd(e);return ac(await this.datastore.get(r,t))}async setMetadata(e,t,r){let n=hd(e),i=ac(await this.datastore.get(n,r));i.metadata=t??{},await this.datastore.put(n,ae(i),r)}}class hp extends Error{static name="InsufficientProvidersError";constructor(e="Insufficient providers found"){super(e),this.name="InsufficientProvidersError"}}class hg extends Error{static name="NoRoutersAvailableError";constructor(e="No routers available"){super(e),this.name="NoRoutersAvailableError"}}class hm extends Error{static name="UnknownHashAlgorithmError";constructor(e="Unknown hash algorithm"){super(e),this.name="UnknownHashAlgorithmError"}}class hy extends Error{static name="UnknownCodecError";constructor(e="Unknown codec"){super(e),this.name="UnknownCodecError"}}class hb extends u8{has(e){return null!=this.find(e)}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}}var hw=r(62897);let hv=5;class hE{log;routers;providerLookupConcurrency;constructor(e,t){this.log=e.logger.forComponent("helia:routing"),this.routers=t.routers??[],this.providerLookupConcurrency=t.providerLookupConcurrency??hv,this.findProviders=e.metrics?.traceFunction("helia.routing.findProviders",this.findProviders.bind(this),{optionsIndex:1})??this.findProviders,this.provide=e.metrics?.traceFunction("helia.routing.provide",this.provide.bind(this),{optionsIndex:1})??this.provide,this.cancelReprovide=e.metrics?.traceFunction("helia.routing.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1})??this.cancelReprovide,this.put=e.metrics?.traceFunction("helia.routing.put",this.put.bind(this),{optionsIndex:2})??this.put,this.get=e.metrics?.traceFunction("helia.routing.get",this.get.bind(this),{optionsIndex:1})??this.get,this.findPeer=e.metrics?.traceFunction("helia.routing.findPeer",this.findPeer.bind(this),{optionsIndex:1})??this.findPeer,this.getClosestPeers=e.metrics?.traceFunction("helia.routing.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1})??this.getClosestPeers}async start(){await ul(...this.routers)}async stop(){await uc(...this.routers)}async *findProviders(e,t={}){if(0===this.routers.length)throw new hg("No content routers available");let r=new hb({concurrency:this.providerLookupConcurrency});for await(let n of(r.addEventListener("error",()=>{}),(0,hw.A)(r.toGenerator(),...hA(this.routers,"findProviders").map(r=>r.findProviders(e,t)))))if(null!=n){if(0===n.multiaddrs.length){if(null!=r.find(n.id))continue;r.add(async()=>{try{let e=await this.findPeer(n.id,t);if(0===e.multiaddrs.length)return null;return e}catch(e){return this.log.error("could not load multiaddrs for peer %p",n.id,e),null}},{peerId:n.id,signal:t.signal}).catch(e=>{this.log.error("could not load multiaddrs for peer %p",n.id,e)})}yield n}}async provide(e,t={}){if(0===this.routers.length)throw new hg("No content routers available");await Promise.all(hA(this.routers,"provide").map(async r=>{await r.provide(e,t)}))}async cancelReprovide(e,t={}){await Promise.all(hA(this.routers,"cancelReprovide").map(async r=>{await r.cancelReprovide(e,t)}))}async put(e,t,r){await Promise.all(hA(this.routers,"put").map(async n=>{await n.put(e,t,r)}))}async get(e,t){return Promise.any(hA(this.routers,"get").map(async r=>r.get(e,t)))}async findPeer(e,t){if(0===this.routers.length)throw new hg("No peer routers available");let r=this;for await(let n of(0,hw.A)(...hA(this.routers,"findPeer").map(n=>(async function*(){try{yield await n.findPeer(e,t)}catch(e){r.log.error(e)}})())))if(null!=n)return n;throw new uL("Could not find peer in routing")}async *getClosestPeers(e,t={}){if(0===this.routers.length)throw new hg("No peer routers available");for await(let r of(0,hw.A)(...hA(this.routers,"getClosestPeers").map(r=>r.getClosestPeers(e,t))))null!=r&&(yield r)}}function hA(e,t){return e.filter(e=>null!=e[t])}let hx={},hS=e=>{e.addEventListener("message",t=>{hS.dispatchEvent("message",e,t)}),null!=e.port&&e.port.addEventListener("message",t=>{hS.dispatchEvent("message",e,t)})};hS.addEventListener=(e,t)=>{null==hx[e]&&(hx[e]=[]),hx[e].push(t)},hS.removeEventListener=(e,t)=>{null!=hx[e]&&(hx[e]=hx[e].filter(e=>e===t))},hS.dispatchEvent=function(e,t,r){null!=hx[e]&&hx[e].forEach(e=>e(t,r))};let hk=hS,h_="lock:worker:request-read",hI="lock:worker:release-read",hC="lock:master:grant-read",hT="lock:worker:request-write",hP="lock:worker:release-write",hR="lock:master:grant-write",hO=(e=21)=>Math.random().toString().substring(2),hN=(e,t,r,n,i)=>(s,o)=>{if(o.data.type!==r)return;let a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};e.dispatchEvent(new MessageEvent(t,{data:{name:a.name,handler:async()=>{s.postMessage({type:i,name:a.name,identifier:a.identifier}),await new Promise(e=>{let t=r=>{if(r?.data==null)return;let i={type:r.data.type,name:r.data.name,identifier:r.data.identifier};i.type===n&&i.identifier===a.identifier&&(s.removeEventListener("message",t),e())};s.addEventListener("message",t)})}}}))},hD=(e,t,r,n)=>async()=>{let i=hO();return globalThis.postMessage({type:t,identifier:i,name:e}),new Promise(t=>{let s=o=>{if(o?.data==null)return;let a={type:o.data.type,identifier:o.data.identifier};a.type===r&&a.identifier===i&&(globalThis.removeEventListener("message",s),t(()=>{globalThis.postMessage({type:n,identifier:i,name:e})}))};globalThis.addEventListener("message",s)})},hB={singleProcess:!1},hM=e=>{if(e=Object.assign({},hB,e),globalThis.document||e.singleProcess){let e=new EventTarget;return hk.addEventListener("message",hN(e,"requestReadLock",h_,hI,hC)),hk.addEventListener("message",hN(e,"requestWriteLock",hT,hP,hR)),e}return{isWorker:!0,readLock:e=>hD(e,h_,hC,hI),writeLock:e=>hD(e,hT,hR,hP)}},hL={};async function hF(e,t){let r,n=new Promise(e=>{r=e});return e.add(async()=>lu((async()=>{await new Promise(e=>{r(()=>{e()})})})(),{milliseconds:t.timeout})),n}let hU=(e,t)=>{let r;if(!0===n.isWorker)return{readLock:n.readLock(e,t),writeLock:n.writeLock(e,t)};let i=new lf({concurrency:1});return{async readLock(){if(null!=r)return hF(r,t);let e=r=new lf({concurrency:t.concurrency,autoStart:!1}),n=hF(r,t);return i.add(async()=>{e.start(),await e.onIdle().then(()=>{r===e&&(r=null)})}),n},writeLock:async()=>(r=null,hF(i,t))}},hj={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function h$(e){let t=Object.assign({},hj,e);return null==n&&!0!==(n=hM(t)).isWorker&&(n.addEventListener("requestReadLock",e=>{null!=hL[e.data.name]&&hL[e.data.name].readLock().then(async t=>e.data.handler().finally(()=>{t()}))}),n.addEventListener("requestWriteLock",async e=>{null!=hL[e.data.name]&&hL[e.data.name].writeLock().then(async t=>e.data.handler().finally(()=>{t()}))})),null==hL[t.name]&&(hL[t.name]=hU(t.name,t)),hL[t.name]}class hH{lock;child;pins;started;constructor(e,t,r={}){this.child=e,this.pins=t,this.lock=h$({singleProcess:r.holdGcLock}),this.started=!1}isStarted(){return this.started}async start(){await ul(this.child),this.started=!0}async stop(){await uc(this.child),this.started=!1}unwrap(){return this.child}async put(e,t,r={}){r?.signal?.throwIfAborted();let n=await this.lock.readLock();try{return await this.child.put(e,t,r)}finally{n()}}async *putMany(e,t={}){t?.signal?.throwIfAborted();let r=await this.lock.readLock();try{yield*this.child.putMany(e,t)}finally{r()}}async get(e,t={}){t?.signal?.throwIfAborted();let r=await this.lock.readLock();try{return await this.child.get(e,t)}finally{r()}}async *getMany(e,t={}){t?.signal?.throwIfAborted();let r=await this.lock.readLock();try{yield*this.child.getMany(e,t)}finally{r()}}async delete(e,t={}){t?.signal?.throwIfAborted();let r=await this.lock.writeLock();try{if(await this.pins.isPinned(e))throw Error("CID was pinned");await this.child.delete(e,t)}finally{r()}}async *deleteMany(e,t={}){t?.signal?.throwIfAborted();let r=await this.lock.writeLock();try{let r=this;yield*this.child.deleteMany(async function*(){for await(let t of e){if(await r.pins.isPinned(t))throw Error("CID was pinned");yield t}}(),t)}finally{r()}}async has(e,t={}){t?.signal?.throwIfAborted();let r=await this.lock.readLock();try{return await this.child.has(e,t)}finally{r()}}async *getAll(e={}){e?.signal?.throwIfAborted();let t=await this.lock.readLock();try{yield*this.child.getAll(e)}finally{t()}}createSession(e,t){return t?.signal?.throwIfAborted(),this.child.createSession(e,t)}}let hq=new u7.U("/version"),hz=1;async function hV(e){if(!await e.has(hq))return void await e.put(hq,(0,nm.s)(`${hz}`));let t=await e.get(hq);if(parseInt((0,uh.d)(t),10)!==hz)throw Error("Unknown datastore version, a datastore migration may be required")}function hK(e){return e?.then!=null}function hG(e=[],t){let r={[rU]:t0,[nz.code]:nz,[ab]:t1,[aB]:t2,[aH.code]:aH};return e.forEach(e=>{r[e.code]=e}),async e=>{let n=r[e];if(null==n&&null!=t){let i=t(e);r[(n=hK(i)?await i:i).code]=n}if(null!=n)return n;throw new hy(`Could not load codec for ${e}`)}}function hW(e=[],t){let r={[nK.sha256.code]:nK.sha256,[nK.sha512.code]:nK.sha512,[aq.identity.code]:aq.identity};return e.forEach(e=>{r[e.code]=e}),async e=>{let n=r[e];if(null==n&&null!=t){let i=t(e);r[(n=hK(i)?await i:i).code]=n}if(null!=n)return n;throw new hm(`No hasher configured for multihash code 0x${e.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`)}}function hQ(e){let t=new globalThis.AbortController;function r(){for(let n of(t.abort(),e))n?.removeEventListener!=null&&n.removeEventListener("abort",r)}for(let t of e){if(t?.aborted===!0){r();break}t?.addEventListener!=null&&t.addEventListener("abort",r)}function n(){for(let t of e)t?.removeEventListener!=null&&t.removeEventListener("abort",r)}let i=t.signal;return i.clear=n,i}var hJ=r(98897),hZ=r(90161);let hY=0;class hX extends hZ.i{child;constructor(e){super(),this.child=e}put(e,t){return e.multihash.code===hY||null==this.child?e:this.child.put(e,t)}get(e){if(e.multihash.code===hY)return e.multihash.digest;if(null==this.child)throw new hJ.m_;return this.child.get(e)}has(e){return e.multihash.code===hY||null!=this.child&&this.child.has(e)}delete(e){if(e.code!==hY&&null!=this.child)return this.child.delete(e)}getAll(e){return null!=this.child?this.child.getAll(e):[]}}var h0=r(1707);function h1(e){return null!=e[Symbol.asyncIterator]}function h2(e){return e?.then!=null}let h3=function(e,t){let r=0;if(h1(e))return async function*(){for await(let n of e){let e=t(n,r++);h2(e)&&await e,yield n}}();let n=(0,h0.A)(e),{value:i,done:s}=n.next();if(!0===s)return function*(){}();let o=t(i,r++);if("function"==typeof o?.then)return async function*(){for await(let e of(yield i,n)){let n=t(e,r++);h2(n)&&await n,yield e}}();let a=t;return function*(){for(let e of(yield i,n))a(e,r++),yield e}()};class h4{child;getHasher;log;logger;components;constructor(e){this.log=e.logger.forComponent("helia:networked-storage"),this.logger=e.logger,this.components=e,this.child=new hX(e.blockstore),this.getHasher=e.getHasher}async put(e,t,r={}){return await this.child.has(e,r)?(r.onProgress?.(new nV("blocks:put:duplicate",e)),e):(r.onProgress?.(new nV("blocks:put:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async n=>n.announce?.(e,t,r))),r.onProgress?.(new nV("blocks:put:blockstore:put",e)),this.child.put(e,t,r))}async *putMany(e,t={}){let r=h3((0,a8.A)(e,async({cid:e})=>{let r=await this.child.has(e,t);return r&&t.onProgress?.(new nV("blocks:put-many:duplicate",e)),!r}),async({cid:e,block:r})=>{t.onProgress?.(new nV("blocks:put-many:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async n=>n.announce?.(e,r,t)))});t.onProgress?.(new nV("blocks:put-many:blockstore:put-many")),yield*this.child.putMany(r,t)}async get(e,t={}){if(!0!==t.offline&&!await this.child.has(e,t)){let r=await this.getHasher(e.multihash.code);t.onProgress?.(new nV("blocks:get:providers:get",e));let n=await h9(e,this.components.blockBrokers,r,{...t,log:this.log});return t.onProgress?.(new nV("blocks:get:blockstore:put",e)),await this.child.put(e,n,t),t.onProgress?.(new nV("blocks:get:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async r=>r.announce?.(e,n,t))),n}return t.onProgress?.(new nV("blocks:get:blockstore:get",e)),this.child.get(e,t)}async *getMany(e,t={}){t.onProgress?.(new nV("blocks:get-many:blockstore:get-many")),yield*this.child.getMany(h3(e,async e=>{if(!0!==t.offline&&!await this.child.has(e,t)){let r=await this.getHasher(e.multihash.code);t.onProgress?.(new nV("blocks:get-many:providers:get",e));let n=await h9(e,this.components.blockBrokers,r,{...t,log:this.log});t.onProgress?.(new nV("blocks:get-many:blockstore:put",e)),await this.child.put(e,n,t),t.onProgress?.(new nV("blocks:get-many:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async r=>r.announce?.(e,n,t)))}}))}async delete(e,t={}){t.onProgress?.(new nV("blocks:delete:blockstore:delete",e)),await this.child.delete(e,t)}async *deleteMany(e,t={}){t.onProgress?.(new nV("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany(async function*(){for await(let t of e)yield t}(),t)}async has(e,t={}){return this.child.has(e,t)}async *getAll(e={}){e.onProgress?.(new nV("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(e)}}class h5 extends h4{started;constructor(e){super(e),this.started=!1}isStarted(){return this.started}async start(){await ul(this.child,...this.components.blockBrokers),this.started=!0}async stop(){await uc(this.child,...this.components.blockBrokers),this.started=!1}unwrap(){return this.child}createSession(e,t){let r=this.components.blockBrokers.map(e=>null==e.createSession?e:e.createSession(t));return new h6({blockstore:this.child,blockBrokers:r,getHasher:this.getHasher,logger:this.logger},{root:e})}}class h6 extends h4{closeController;constructor(e,t){super(e),this.closeController=new AbortController,this.closeController.signal,this.log=e.logger.forComponent(`helia:session-storage:${t.root}`)}close(){this.closeController.abort()}async put(e,t,r={}){let n=hQ([this.closeController.signal,r.signal]);try{return await super.put(e,t,{...r,signal:n})}finally{n.clear()}}async *putMany(e,t={}){let r=hQ([this.closeController.signal,t.signal]);try{yield*super.putMany(e,{...t,signal:r})}finally{r.clear()}}async get(e,t={}){let r=hQ([this.closeController.signal,t.signal]);try{return await super.get(e,{...t,signal:r})}finally{r.clear()}}async *getMany(e,t={}){let r=hQ([this.closeController.signal,t.signal]);try{yield*super.getMany(e,{...t,signal:r})}finally{r.clear()}}async delete(e,t={}){let r=hQ([this.closeController.signal,t.signal]);try{await super.delete(e,{...t,signal:r})}finally{r.clear()}}async *deleteMany(e,t={}){let r=hQ([this.closeController.signal,t.signal]);try{yield*super.deleteMany(e,{...t,signal:r})}finally{r.clear()}}async has(e,t={}){let r=hQ([this.closeController.signal,t.signal]);try{return await super.has(e,{...t,signal:r})}finally{r.clear()}}async *getAll(e={}){let t=hQ([this.closeController.signal,e.signal]);try{yield*super.getAll({...e,signal:t})}finally{t.clear()}}}function h8(e){return"function"==typeof e.retrieve}let h7=(e,t)=>{if(null==t)throw new uC(`No hasher configured for multihash code 0x${e.multihash.code.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`);return async r=>{let n,i=t.digest(r);if(!rr((n=hK(i)?await i:i).digest,e.multihash.digest))throw new u$("Hash of downloaded block did not match multihash from passed CID")}};async function h9(e,t,r,n){let i=h7(e,r),s=new AbortController,o=hQ([s.signal,n.signal]);s.signal;let a=[];for(let e of t)h8(e)&&a.push(e);try{return await Promise.any(a.map(async t=>{try{let r=!1,s=await t.retrieve(e,{...n,signal:o,validateFn:async e=>{await i(e),r=!0}});return r||await i(s),s}catch(t){throw n.log.error("could not retrieve verified block for %c",e,t),t}}))}finally{s.abort(),o.clear()}}class de{blockstore;datastore;pins;logger;routing;getCodec;getHasher;dns;metrics;log;constructor(e){this.logger=e.logger??(0,lC.Um)(),this.log=this.logger.forComponent("helia"),this.getHasher=hW(e.hashers,e.loadHasher),this.getCodec=hG(e.codecs,e.loadCodec),this.dns=e.dns??uA(),this.metrics=e.metrics;let t={blockstore:e.blockstore,datastore:e.datastore,logger:this.logger,blockBrokers:[],getHasher:this.getHasher,getCodec:this.getCodec,dns:this.dns,metrics:this.metrics,...e.components??{}};this.routing=t.routing=new hE(t,{routers:(e.routers??[]).flatMap(e=>{let t=[e];return null!=e[us]&&t.push(e[us]),null!=e[uo]&&t.push(e[uo]),t}),providerLookupConcurrency:e.providerLookupConcurrency});let r=new h5(t);this.pins=new hf(e.datastore,r,this.getCodec),this.blockstore=new hH(r,this.pins,{holdGcLock:e.holdGcLock??!0}),this.datastore=e.datastore,t.blockBrokers=e.blockBrokers.map(e=>e(t))}async start(){await hV(this.datastore),await ul(this.blockstore,this.datastore,this.routing)}async stop(){await uc(this.blockstore,this.datastore,this.routing)}async gc(e={}){let t=await this.blockstore.lock.writeLock();try{let t=this,r=this.blockstore.unwrap();this.log("gc start"),await (0,ux.A)(r.deleteMany(async function*(){for await(let{cid:n}of r.getAll())try{if(await t.pins.isPinned(n,e))continue;yield n,e.onProgress?.(new nV("helia:gc:deleted",n))}catch(r){t.log.error("Error during gc",r),e.onProgress?.(new nV("helia:gc:error",r))}}()))}finally{t()}this.log("gc finished")}}class dt extends de{libp2p;constructor(e){super({...e,components:{libp2p:e.libp2p}}),this.libp2p=e.libp2p}async start(){await super.start(),await this.libp2p.start()}async stop(){await super.stop(),await this.libp2p.stop()}}let dr=8,dn=4194304;class di extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class ds extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class da extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}class dl extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}function dc(e){return null!=e[Symbol.asyncIterator]}function du(e,t){if(e.byteLength>t)throw new ds("Message length too long")}let dh=e=>{let t=rY(e),r=(0,t9.K)(t);return r3(e,r),dh.bytes=t,r};function dd(e,t){let r=(t=t??{}).lengthEncoder??dh,n=t?.maxDataLength??dn;function*i(e){du(e,n);let t=r(e.byteLength);t instanceof Uint8Array?yield t:yield*t,e instanceof Uint8Array?yield e:yield*e}return dc(e)?async function*(){for await(let t of e)yield*i(t)}():function*(){for(let t of e)yield*i(t)}()}dh.bytes=0,dd.single=(e,t)=>{let r=(t=t??{}).lengthEncoder??dh;return du(e,t?.maxDataLength??dn),new ro(r(e.byteLength),e)},function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(c||(c={}));let df=e=>{let t=r4(e);return df.bytes=rY(t),t};function dp(e,t){let r=new ro,n=c.LENGTH,i=-1,s=t?.lengthDecoder??df,o=t?.maxLengthLength??dr,a=t?.maxDataLength??dn;function*l(){for(;r.byteLength>0;){if(n===c.LENGTH)try{if((i=s(r))<0)throw new di("Invalid message length");if(i>a)throw new ds("Message length too long");let e=s.bytes;r.consume(e),t?.onLength!=null&&t.onLength(i),n=c.DATA}catch(e){if(e instanceof RangeError){if(r.byteLength>o)throw new da("Message length length too long");break}throw e}if(n===c.DATA){if(r.byteLength<i)break;let e=r.sublist(0,i);r.consume(i),t?.onData!=null&&t.onData(e),yield e,n=c.LENGTH}}}return dc(e)?async function*(){for await(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new dl("Unexpected end of input")}():function*(){for(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new dl("Unexpected end of input")}()}df.bytes=0,dp.fromReader=(e,t)=>{let r=1,n=async function*(){for(;;)try{let{done:t,value:n}=await e.next(r);if(!0===t)return;null!=n&&(yield n)}catch(e){if("ERR_UNDER_READ"===e.code)return{done:!0,value:null};throw e}finally{r=1}}(),i=e=>{r=e};return dp(n,{...t??{},onLength:i})};var dg=r(91295);let dm="/ipfs/bitswap/1.2.0",dy=1024,db=1024,dw=1024,dv=5e3,dE=10,dA=50,dx=!1,dS=3,dk=4194304,d_=4194304;function dI(e,t){for(let[r,n]of t.wantlist.entries()){let t=e.wantlist.get(r);null!=t&&(t.priority>n.priority&&(n.priority=t.priority),n.cancel=n.cancel??t.cancel,n.wantType=n.wantType??t.wantType,n.sendDontHave=n.sendDontHave??t.sendDontHave),e.wantlist.set(r,n)}for(let[r,n]of t.blockPresences.entries())e.blockPresences.set(r,n);for(let[r,n]of t.blocks.entries())e.blocks.set(r,n);return t.full&&!e.full&&(e.full=!0),e}!function(e){e.WantBlock="WantBlock",e.WantHave="WantHave"}(u||(u={})),function(e){e[e.WantBlock=0]="WantBlock",e[e.WantHave=1]="WantHave"}(h||(h={})),function(e){e.codec=()=>nB(h)}(u||(u={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.cid&&e.cid.byteLength>0&&(t.uint32(10),t.bytes(e.cid)),null!=e.priority&&0!==e.priority&&(t.uint32(16),t.int32(e.priority)),null!=e.cancel&&(t.uint32(24),t.bool(e.cancel)),null!=e.wantType&&(t.uint32(32),u.codec().encode(e.wantType,t)),null!=e.sendDontHave&&(t.uint32(40),t.bool(e.sendDontHave)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={cid:(0,t9.c)(0),priority:0},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.cid=e.bytes();break;case 2:n.priority=e.int32();break;case 3:n.cancel=e.bool();break;case 4:n.wantType=u.codec().decode(e);break;case 5:n.sendDontHave=e.bool();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(d||(d={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.entries)for(let r of e.entries)t.uint32(10),d.codec().encode(r,t);null!=e.full&&(t.uint32(16),t.bool(e.full)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={entries:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:if(r.limits?.entries!=null&&n.entries.length===r.limits.entries)throw new nL('Decode error - map field "entries" had too many elements');n.entries.push(d.codec().decode(e,e.uint32(),{limits:r.limits?.entries$}));break;case 2:n.full=e.bool();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(f||(f={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.prefix&&e.prefix.byteLength>0&&(t.uint32(10),t.bytes(e.prefix)),null!=e.data&&e.data.byteLength>0&&(t.uint32(18),t.bytes(e.data)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={prefix:(0,t9.c)(0),data:(0,t9.c)(0)},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.prefix=e.bytes();break;case 2:n.data=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(p||(p={})),function(e){e.HaveBlock="HaveBlock",e.DoNotHaveBlock="DoNotHaveBlock"}(g||(g={})),function(e){e[e.HaveBlock=0]="HaveBlock",e[e.DoNotHaveBlock=1]="DoNotHaveBlock"}(m||(m={})),function(e){e.codec=()=>nB(m)}(g||(g={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.cid&&e.cid.byteLength>0&&(t.uint32(10),t.bytes(e.cid)),null!=e.type&&0!==m[e.type]&&(t.uint32(16),g.codec().encode(e.type,t)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={cid:(0,t9.c)(0),type:g.HaveBlock},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.cid=e.bytes();break;case 2:n.type=g.codec().decode(e);break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(y||(y={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.wantlist&&(t.uint32(10),f.codec().encode(e.wantlist,t)),null!=e.blocks)for(let r of e.blocks)t.uint32(26),p.codec().encode(r,t);if(null!=e.blockPresences)for(let r of e.blockPresences)t.uint32(34),y.codec().encode(r,t);null!=e.pendingBytes&&0!==e.pendingBytes&&(t.uint32(40),t.int32(e.pendingBytes)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={blocks:[],blockPresences:[],pendingBytes:0},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.wantlist=f.codec().decode(e,e.uint32(),{limits:r.limits?.wantlist});break;case 3:if(r.limits?.blocks!=null&&n.blocks.length===r.limits.blocks)throw new nL('Decode error - map field "blocks" had too many elements');n.blocks.push(p.codec().decode(e,e.uint32(),{limits:r.limits?.blocks$}));break;case 4:if(r.limits?.blockPresences!=null&&n.blockPresences.length===r.limits.blockPresences)throw new nL('Decode error - map field "blockPresences" had too many elements');n.blockPresences.push(y.codec().decode(e,e.uint32(),{limits:r.limits?.blockPresences$}));break;case 5:n.pendingBytes=e.int32();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(b||(b={}));class dC extends Error{static name="BlockTooLargeError";constructor(e="Block too large"){super(e),this.name="BlockTooLargeError"}}let dT=4193664;function*dP(e,t){let r=[...e.wantlist.values()],n=[...e.blockPresences.values()],i=[...e.blocks.values()],s=0,o=0,a=0,l=!1;for(;;){let c={wantlist:{full:e.full??!1,entries:[]},blockPresences:[],blocks:[],pendingBytes:0},u=b.encode(c).byteLength,{added:h,hasMore:d,newSize:f}=dR(i,c.blocks,a,t,u,dO);a+=h,u=f;let p=d;({added:h,hasMore:d,newSize:f}=dR(n,c.blockPresences,o,t,u,dN)),o+=h,u=f;let g=d;({added:h,hasMore:d,newSize:f}=dR(r,c.wantlist.entries,s,t,u,dD)),s+=h,u=f;let m=d;if((l=!p&&!g&&!m)||(c.wantlist.full=!1),yield b.encode(c),l)break}}function dR(e,t,r,n,i,s){let o=0,a=!1;for(let l=r;l<e.length;l++){let r=e[l],c=s(r);if(c>dT)throw new dC("Cannot send block as after encoding it is over the max message size");let u=i+c;if(u>n){a=!0;break}t.push(r),o++,i=u}return{hasMore:a,added:o,newSize:i}}function dO(e){return dB(3,p.encode(e))}function dN(e){return dB(4,y.encode(e))}function dD(e){return dB(1,d.encode(e))}function dB(e,t){return rY(e)+rY(t.byteLength)+t.byteLength}class dM extends uS{log;libp2p;routing;protocols;running;maxInboundStreams;maxOutboundStreams;messageReceiveTimeout;registrarIds;metrics;sendQueue;runOnLimitedConnections;maxOutgoingMessageSize;maxIncomingMessageSize;constructor(e,t={}){super(),this.log=e.logger.forComponent("helia:bitswap:network"),this.libp2p=e.libp2p,this.routing=e.routing,this.protocols=t.protocols??[dm],this.registrarIds=[],this.running=!1,this._onStream=this._onStream.bind(this),this.maxInboundStreams=t.maxInboundStreams??db,this.maxOutboundStreams=t.maxOutboundStreams??dw,this.messageReceiveTimeout=t.messageReceiveTimeout??dv,this.runOnLimitedConnections=t.runOnLimitedConnections??dx,this.maxIncomingMessageSize=t.maxIncomingMessageSize??dk,this.maxOutgoingMessageSize=t.maxOutgoingMessageSize??t.maxIncomingMessageSize??d_,this.metrics={blocksSent:e.metrics?.registerCounter("helia_bitswap_sent_blocks_total"),dataSent:e.metrics?.registerCounter("helia_bitswap_sent_data_bytes_total")},this.sendQueue=new hb({concurrency:t.messageSendConcurrency??dA,metrics:e.metrics,metricName:"helia_bitswap_message_send_queue"}),this.sendQueue.addEventListener("error",e=>{this.log.error("error sending wantlist to peer",e.detail)})}async start(){if(this.running)return;this.running=!0,await this.libp2p.handle(this.protocols,this._onStream,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnections});let e={onConnect:e=>{this.safeDispatchEvent("peer:connected",{detail:e})},onDisconnect:e=>{this.safeDispatchEvent("peer:disconnected",{detail:e})}};for(let t of(this.registrarIds=[],this.protocols))this.registrarIds.push(await this.libp2p.register(t,e));this.libp2p.getConnections().forEach(e=>{this.safeDispatchEvent("peer:connected",{detail:e.remotePeer})})}async stop(){if(this.running=!1,await this.libp2p.unhandle(this.protocols),null!=this.registrarIds){for(let e of this.registrarIds)this.libp2p.unregister(e);this.registrarIds=[]}}_onStream(e){if(!this.running)return;let{stream:t,connection:r}=e;Promise.resolve().then(async()=>{this.log("incoming new bitswap %s stream from %p",t.protocol,r.remotePeer);let e=()=>{"open"===t.status?t.abort(new uV(`Incoming Bitswap stream timed out after ${this.messageReceiveTimeout}ms`)):this.log("stream aborted with status %s",t.status)},n=AbortSignal.timeout(this.messageReceiveTimeout);n.addEventListener("abort",e),await t.closeWrite(),await (0,lr.F)(t,e=>dp(e,{maxDataLength:this.maxIncomingMessageSize}),async i=>{for await(let s of i)try{let i=b.decode(s);this.log("incoming new bitswap %s message from %p on stream",t.protocol,r.remotePeer,t.id),this.safeDispatchEvent("bitswap:message",{detail:{peer:r.remotePeer,message:i}}),n.removeEventListener("abort",e),(n=AbortSignal.timeout(this.messageReceiveTimeout)).addEventListener("abort",e)}catch(e){this.log.error("error reading incoming bitswap message from %p on stream",r.remotePeer,t.id,e),t.abort(e);break}})}).catch(e=>{this.log.error("error handling incoming stream from %p",r.remotePeer,e),t.abort(e)})}async *findProviders(e,t){for await(let r of(t?.onProgress?.(new nV("bitswap:network:find-providers",e)),this.routing.findProviders(e,t)))await this.libp2p.isDialable(r.multiaddrs,{runOnLimitedConnection:this.runOnLimitedConnections})&&(yield r)}async findAndConnect(e,t){t?.providers!=null&&await Promise.all(t.providers.map(async e=>this.connectTo(e).catch(e=>{this.log.error("could not connect to supplied provider - %e",e)}))),await (0,ux.A)((0,a7.A)((0,dg.A)(this.findProviders(e,t),t?.maxProviders??dS),async e=>this.connectTo(e.id,t))).catch(e=>{this.log.error(e)})}async sendMessage(e,t,r){if(!this.running)throw Error("network isn't running");let n=this.sendQueue.queue.find(t=>e.equals(t.options.peerId)&&"queued"===t.status);if(null!=n){n.options.message=dI(n.options.message,t),await n.join({signal:r?.signal});return}await this.sendQueue.add(async t=>{let r=t?.message;if(null==r)throw new uC("No message to send");this.log("sendMessage to %p",e),t?.onProgress?.(new nV("bitswap:network:send-wantlist",e));let n=await this.libp2p.dialProtocol(e,dm,t);await n.closeRead();try{await (0,lr.F)(dP(r,this.maxOutgoingMessageSize),e=>dd(e),n),await n.close(t)}catch(r){t?.onProgress?.(new nV("bitswap:network:send-wantlist:error",{peer:e,error:r})),this.log.error("error sending message to %p",e,r),n.abort(r)}this._updateSentStats(r.blocks)},{peerId:e,signal:r?.signal,message:t})}async connectTo(e,t){if(!this.running)throw new uK("Network isn't running");t?.onProgress?.(new nV("bitswap:network:dial",e));let[r]=await Promise.all([this.libp2p.dial(e,t),u0(this.libp2p,"peer:identify",t?.signal,{filter:t=>{if(!t.detail.peerId.equals(e))return!1;if(t.detail.protocols.includes(dm))return!0;throw new uH(`${e} did not support ${dm}`)}})]);return r}_updateSentStats(e){let t=0;for(let r of e.values())t+=r.data.byteLength;this.metrics.dataSent?.increment(t),this.metrics.blocksSent?.increment(e.size)}}let dL="1.2.840.10045.3.1.7",dF="1.3.132.0.34",dU="1.3.132.0.35";async function dj(e="P-256"){let t=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:e},!0,["sign","verify"]);return{publicKey:await crypto.subtle.exportKey("jwk",t.publicKey),privateKey:await crypto.subtle.exportKey("jwk",t.privateKey)}}async function d$(e,t){let r=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["sign"]),n=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},r,t.subarray());return new Uint8Array(n,0,n.byteLength)}async function dH(e,t,r){let n=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["verify"]);return crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},n,t,r.subarray())}let dq=parseInt("11111",2),dz=parseInt("10000000",2),dV=parseInt("01111111",2),dK={0:dQ,1:dQ,2:dJ,3:dX,4:d0,5:dY,6:dZ,16:dQ,22:dQ,48:dQ};function dG(e,t={offset:0}){let r=e[t.offset]&dq;if(t.offset++,null!=dK[r])return dK[r](e,t);throw Error("No decoder for tag "+r)}function dW(e,t){let r=0;if((e[t.offset]&dz)===dz){let n=e[t.offset]&dV,i="0x";t.offset++;for(let r=0;r<n;r++,t.offset++)i+=e[t.offset].toString(16).padStart(2,"0");r=parseInt(i,16)}else r=e[t.offset],t.offset++;return r}function dQ(e,t){dW(e,t);let r=[];for(;!(t.offset>=e.byteLength);){let n=dG(e,t);if(null===n)break;r.push(n)}return r}function dJ(e,t){let r=dW(e,t),n=t.offset,i=t.offset+r,s=[];for(let t=n;t<i;t++)(t!==n||0!==e[t])&&s.push(e[t]);return t.offset+=r,Uint8Array.from(s)}function dZ(e,t){let r=dW(e,t),n=t.offset+r,i=e[t.offset];t.offset++;let s=0,o=0;i<40?(s=0,o=i):i<80?(s=1,o=i-40):(s=2,o=i-80);let a=`${s}.${o}`,l=[];for(;t.offset<n;){let r=e[t.offset];if(t.offset++,l.push(127&r),r<128){l.reverse();let e=0;for(let t=0;t<l.length;t++)e+=l[t]<<7*t;a+=`.${e}`,l=[]}}return a}function dY(e,t){return t.offset++,null}function dX(e,t){let r=dW(e,t),n=e[t.offset];t.offset++;let i=e.subarray(t.offset,t.offset+r-1);if(t.offset+=r,0!==n)throw Error("Unused bits in bit string is unimplemented");return i}function d0(e,t){let r=dW(e,t),n=e.subarray(t.offset,t.offset+r);return t.offset+=r,n}function d1(e){let t=e.toString(16);t.length%2==1&&(t="0"+t);let r=new ro;for(let e=0;e<t.length;e+=2)r.append(Uint8Array.from([parseInt(`${t[e]}${t[e+1]}`,16)]));return r}function d2(e){if(e.byteLength<128)return Uint8Array.from([e.byteLength]);let t=d1(e.byteLength);return new ro(Uint8Array.from([t.byteLength|dz]),t)}function d3(e){let t=new ro,r=128;return(e.subarray()[0]&r)===r&&t.append(Uint8Array.from([0])),t.append(e),new ro(Uint8Array.from([2]),d2(t),t)}function d4(e){let t=new ro(Uint8Array.from([0]),e);return new ro(Uint8Array.from([3]),d2(t),t)}function d5(e){return new ro(Uint8Array.from([4]),d2(e),e)}function d6(e,t=48){let r=new ro;for(let t of e)r.append(t);return new ro(Uint8Array.from([t]),d2(r),r)}var d8=r(7796);class d7{type="ECDSA";jwk;_raw;constructor(e){this.jwk=e}get raw(){return null==this._raw&&(this._raw=fp(this.jwk)),this._raw}toMultihash(){return aq.identity.digest(yu(this))}toCID(){return rc.TO.createV1(114,this.toMultihash())}toString(){return d8.base58btc.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&rr(this.raw,e.raw)}async verify(e,t){return dH(this.jwk,t,e)}}class d9{type="ECDSA";jwk;publicKey;_raw;constructor(e){this.jwk=e,this.publicKey=new d7({crv:e.crv,ext:e.ext,key_ops:["verify"],kty:"EC",x:e.x,y:e.y})}get raw(){return null==this._raw&&(this._raw=ff(this.jwk)),this._raw}equals(e){return null!=e&&e.raw instanceof Uint8Array&&rr(this.raw,e.raw)}async sign(e){return d$(this.jwk,e)}}let fe=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),ft=Uint8Array.from([6,5,43,129,4,0,34]),fr=Uint8Array.from([6,5,43,129,4,0,35]),fn={ext:!0,kty:"EC",crv:"P-256"},fi={ext:!0,kty:"EC",crv:"P-384"},fs={ext:!0,kty:"EC",crv:"P-521"},fo=32,fa=48,fl=66;function fc(e){return fu(dG(e))}function fu(e){let t,r,n=e[1],i=(0,uh.d)(n,"base64url"),s=e[2][1][0],o=1;if(n.byteLength===fo)return t=(0,uh.d)(s.subarray(o,o+fo),"base64url"),r=(0,uh.d)(s.subarray(o+fo),"base64url"),new d9({...fn,key_ops:["sign"],d:i,x:t,y:r});if(n.byteLength===fa)return t=(0,uh.d)(s.subarray(o,o+fa),"base64url"),r=(0,uh.d)(s.subarray(o+fa),"base64url"),new d9({...fi,key_ops:["sign"],d:i,x:t,y:r});if(n.byteLength===fl)return t=(0,uh.d)(s.subarray(o,o+fl),"base64url"),r=(0,uh.d)(s.subarray(o+fl),"base64url"),new d9({...fs,key_ops:["sign"],d:i,x:t,y:r});throw new uC(`Private key length was wrong length, got ${n.byteLength}, expected 32, 48 or 66`)}function fh(e){return fd(dG(e))}function fd(e){let t,r,n=e[1][1][0],i=1;if(n.byteLength===2*fo+1)return t=(0,uh.d)(n.subarray(i,i+fo),"base64url"),r=(0,uh.d)(n.subarray(i+fo),"base64url"),new d7({...fn,key_ops:["verify"],x:t,y:r});if(n.byteLength===2*fa+1)return t=(0,uh.d)(n.subarray(i,i+fa),"base64url"),r=(0,uh.d)(n.subarray(i+fa),"base64url"),new d7({...fi,key_ops:["verify"],x:t,y:r});if(n.byteLength===2*fl+1)return t=(0,uh.d)(n.subarray(i,i+fl),"base64url"),r=(0,uh.d)(n.subarray(i+fl),"base64url"),new d7({...fs,key_ops:["verify"],x:t,y:r});throw new uC(`coordinates were wrong length, got ${n.byteLength}, expected 65, 97 or 133`)}function ff(e){return d6([d3(Uint8Array.from([1])),d5((0,nm.s)(e.d??"","base64url")),d6([fg(e.crv)],160),d6([d4(new ro(Uint8Array.from([4]),(0,nm.s)(e.x??"","base64url"),(0,nm.s)(e.y??"","base64url")))],161)]).subarray()}function fp(e){return d6([d3(Uint8Array.from([1])),d6([fg(e.crv)],160),d6([d4(new ro(Uint8Array.from([4]),(0,nm.s)(e.x??"","base64url"),(0,nm.s)(e.y??"","base64url")))],161)]).subarray()}function fg(e){if("P-256"===e)return fe;if("P-384"===e)return ft;if("P-521"===e)return fr;throw new uC(`Invalid curve ${e}`)}async function fm(e="P-256"){return new d9((await dj(e)).privateKey)}let fy="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function fb(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function fw(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function fv(e,...t){if(!fb(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function fE(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.createHasher");fw(e.outputLen),fw(e.blockLen)}function fA(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function fx(e,t){fv(e);let r=t.outputLen;if(e.length<r)throw Error("digestInto() expects output buffer of length at least "+r)}function fS(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function fk(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function f_(e,t){return e<<32-t|e>>>t}function fI(e,t){return e<<t|e>>>32-t>>>0}(e,t)=>t.toString(16).padStart(2,"0");let fC={_0:48,_9:57,A:65,F:70,a:97,f:102},fT=async()=>{};async function fP(e,t,r){let n=Date.now();for(let i=0;i<e;i++){r(i);let e=Date.now()-n;e>=0&&e<t||(await fT(),n+=e)}}function fR(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function fO(e){return"string"==typeof e&&(e=fR(e)),fv(e),e}function fN(e){return"string"==typeof e&&(e=fR(e)),fv(e),e}function fD(...e){let t=0;for(let r=0;r<e.length;r++){let n=e[r];fv(n),t+=n.length}let r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){let i=e[t];r.set(i,n),n+=i.length}return r}function fB(e,t){if(void 0!==t&&"[object Object]"!==({}).toString.call(t))throw Error("options should be object or undefined");return Object.assign(e,t)}class fM{}function fL(e){let t=t=>e().update(fO(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function fF(e=32){if(fy&&"function"==typeof fy.getRandomValues)return fy.getRandomValues(new Uint8Array(e));if(fy&&"function"==typeof fy.randomBytes)return Uint8Array.from(fy.randomBytes(e));throw Error("crypto.getRandomValues must be defined")}function fU(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);let i=BigInt(32),s=BigInt(0xffffffff),o=Number(r>>i&s),a=Number(r&s),l=4*!!n,c=4*!n;e.setUint32(t+l,o,n),e.setUint32(t+c,a,n)}function fj(e,t,r){return e&t^~e&r}function f$(e,t,r){return e&t^e&r^t&r}class fH extends fM{constructor(e,t,r,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=n,this.buffer=new Uint8Array(e),this.view=fk(this.buffer)}update(e){fA(this),fv(e=fO(e));let{view:t,buffer:r,blockLen:n}=this,i=e.length;for(let s=0;s<i;){let o=Math.min(n-this.pos,i-s);if(o===n){let t=fk(e);for(;n<=i-s;s+=n)this.process(t,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){fA(this),fx(e,this),this.finished=!0;let{buffer:t,view:r,blockLen:n,isLE:i}=this,{pos:s}=this;t[s++]=128,fS(this.buffer.subarray(s)),this.padOffset>n-s&&(this.process(r,0),s=0);for(let e=s;e<n;e++)t[e]=0;fU(r,n-8,BigInt(8*this.length),i),this.process(r,0);let o=fk(e),a=this.outputLen;if(a%4)throw Error("_sha2: outputLen should be aligned to 32bit");let l=a/4,c=this.get();if(l>c.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<l;e++)o.setUint32(4*e,c[e],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:n,finished:i,destroyed:s,pos:o}=this;return e.destroyed=s,e.finished=i,e.length=n,e.pos=o,n%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}let fq=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),fz=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),fV=BigInt(0x100000000-1),fK=BigInt(32);function fG(e,t=!1){return t?{h:Number(e&fV),l:Number(e>>fK&fV)}:{h:0|Number(e>>fK&fV),l:0|Number(e&fV)}}function fW(e,t=!1){let r=e.length,n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){let{h:r,l:o}=fG(e[s],t);[n[s],i[s]]=[r,o]}return[n,i]}let fQ=(e,t,r)=>e>>>r,fJ=(e,t,r)=>e<<32-r|t>>>r,fZ=(e,t,r)=>e>>>r|t<<32-r,fY=(e,t,r)=>e<<32-r|t>>>r,fX=(e,t,r)=>e<<64-r|t>>>r-32,f0=(e,t,r)=>e>>>r-32|t<<64-r;function f1(e,t,r,n){let i=(t>>>0)+(n>>>0);return{h:e+r+(i/0x100000000|0)|0,l:0|i}}let f2=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),f3=(e,t,r,n)=>t+r+n+(e/0x100000000|0)|0,f4=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),f5=(e,t,r,n,i)=>t+r+n+i+(e/0x100000000|0)|0,f6=(e,t,r,n,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(i>>>0),f8=(e,t,r,n,i,s)=>t+r+n+i+s+(e/0x100000000|0)|0,f7=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),f9=new Uint32Array(64);class pe extends fH{constructor(e=32){super(64,e,8,!1),this.A=0|fq[0],this.B=0|fq[1],this.C=0|fq[2],this.D=0|fq[3],this.E=0|fq[4],this.F=0|fq[5],this.G=0|fq[6],this.H=0|fq[7]}get(){let{A:e,B:t,C:r,D:n,E:i,F:s,G:o,H:a}=this;return[e,t,r,n,i,s,o,a]}set(e,t,r,n,i,s,o,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)f9[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=f9[e-15],r=f9[e-2],n=f_(t,7)^f_(t,18)^t>>>3,i=f_(r,17)^f_(r,19)^r>>>10;f9[e]=i+f9[e-7]+n+f9[e-16]|0}let{A:r,B:n,C:i,D:s,E:o,F:a,G:l,H:c}=this;for(let e=0;e<64;e++){let t=c+(f_(o,6)^f_(o,11)^f_(o,25))+fj(o,a,l)+f7[e]+f9[e]|0,u=(f_(r,2)^f_(r,13)^f_(r,22))+f$(r,n,i)|0;c=l,l=a,a=o,o=s+t|0,s=i,i=n,n=r,r=t+u|0}r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(r,n,i,s,o,a,l,c)}roundClean(){fS(f9)}destroy(){this.set(0,0,0,0,0,0,0,0),fS(this.buffer)}}let pt=fW(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),pr=pt[0],pn=pt[1],pi=new Uint32Array(80),ps=new Uint32Array(80);class po extends fH{constructor(e=64){super(128,e,16,!1),this.Ah=0|fz[0],this.Al=0|fz[1],this.Bh=0|fz[2],this.Bl=0|fz[3],this.Ch=0|fz[4],this.Cl=0|fz[5],this.Dh=0|fz[6],this.Dl=0|fz[7],this.Eh=0|fz[8],this.El=0|fz[9],this.Fh=0|fz[10],this.Fl=0|fz[11],this.Gh=0|fz[12],this.Gl=0|fz[13],this.Hh=0|fz[14],this.Hl=0|fz[15]}get(){let{Ah:e,Al:t,Bh:r,Bl:n,Ch:i,Cl:s,Dh:o,Dl:a,Eh:l,El:c,Fh:u,Fl:h,Gh:d,Gl:f,Hh:p,Hl:g}=this;return[e,t,r,n,i,s,o,a,l,c,u,h,d,f,p,g]}set(e,t,r,n,i,s,o,a,l,c,u,h,d,f,p,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|n,this.Ch=0|i,this.Cl=0|s,this.Dh=0|o,this.Dl=0|a,this.Eh=0|l,this.El=0|c,this.Fh=0|u,this.Fl=0|h,this.Gh=0|d,this.Gl=0|f,this.Hh=0|p,this.Hl=0|g}process(e,t){for(let r=0;r<16;r++,t+=4)pi[r]=e.getUint32(t),ps[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){let t=0|pi[e-15],r=0|ps[e-15],n=fZ(t,r,1)^fZ(t,r,8)^fQ(t,r,7),i=fY(t,r,1)^fY(t,r,8)^fJ(t,r,7),s=0|pi[e-2],o=0|ps[e-2],a=fZ(s,o,19)^fX(s,o,61)^fQ(s,o,6),l=f4(i,fY(s,o,19)^f0(s,o,61)^fJ(s,o,6),ps[e-7],ps[e-16]),c=f5(l,n,a,pi[e-7],pi[e-16]);pi[e]=0|c,ps[e]=0|l}let{Ah:r,Al:n,Bh:i,Bl:s,Ch:o,Cl:a,Dh:l,Dl:c,Eh:u,El:h,Fh:d,Fl:f,Gh:p,Gl:g,Hh:m,Hl:y}=this;for(let e=0;e<80;e++){let t=fZ(u,h,14)^fZ(u,h,18)^fX(u,h,41),b=fY(u,h,14)^fY(u,h,18)^f0(u,h,41),w=u&d^~u&p,v=f6(y,b,h&f^~h&g,pn[e],ps[e]),E=f8(v,m,t,w,pr[e],pi[e]),A=0|v,x=fZ(r,n,28)^fX(r,n,34)^fX(r,n,39),S=fY(r,n,28)^f0(r,n,34)^f0(r,n,39),k=r&i^r&o^i&o,_=n&s^n&a^s&a;m=0|p,y=0|g,p=0|d,g=0|f,d=0|u,f=0|h,({h:u,l:h}=f1(0|l,0|c,0|E,0|A)),l=0|o,c=0|a,o=0|i,a=0|s,i=0|r,s=0|n;let I=f2(A,S,_);r=f3(I,E,x,k),n=0|I}({h:r,l:n}=f1(0|this.Ah,0|this.Al,0|r,0|n)),({h:i,l:s}=f1(0|this.Bh,0|this.Bl,0|i,0|s)),({h:o,l:a}=f1(0|this.Ch,0|this.Cl,0|o,0|a)),({h:l,l:c}=f1(0|this.Dh,0|this.Dl,0|l,0|c)),({h:u,l:h}=f1(0|this.Eh,0|this.El,0|u,0|h)),({h:d,l:f}=f1(0|this.Fh,0|this.Fl,0|d,0|f)),({h:p,l:g}=f1(0|this.Gh,0|this.Gl,0|p,0|g)),({h:m,l:y}=f1(0|this.Hh,0|this.Hl,0|m,0|y)),this.set(r,n,i,s,o,a,l,c,u,h,d,f,p,g,m,y)}roundClean(){fS(pi,ps)}destroy(){fS(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let pa=fL(()=>new pe),pl=fL(()=>new po),pc=BigInt(0),pu=BigInt(1);function ph(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function pd(e){if(!ph(e))throw Error("Uint8Array expected")}function pf(e,t){if("boolean"!=typeof t)throw Error(e+" boolean expected, got "+t)}function pp(e){let t=e.toString(16);return 1&t.length?"0"+t:t}function pg(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);return""===e?pc:BigInt("0x"+e)}let pm="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,py=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function pb(e){if(pd(e),pm)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=py[e[r]];return t}let pw={_0:48,_9:57,A:65,F:70,a:97,f:102};function pv(e){return e>=pw._0&&e<=pw._9?e-pw._0:e>=pw.A&&e<=pw.F?e-(pw.A-10):e>=pw.a&&e<=pw.f?e-(pw.a-10):void 0}function pE(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);if(pm)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let t=0,i=0;t<r;t++,i+=2){let r=pv(e.charCodeAt(i)),s=pv(e.charCodeAt(i+1));if(void 0===r||void 0===s)throw Error('hex string expected, got non-hex character "'+(e[i]+e[i+1])+'" at index '+i);n[t]=16*r+s}return n}function pA(e){return pg(pb(e))}function px(e){return pd(e),pg(pb(Uint8Array.from(e).reverse()))}function pS(e,t){return pE(e.toString(16).padStart(2*t,"0"))}function pk(e,t){return pS(e,t).reverse()}function p_(e,t,r){let n;if("string"==typeof t)try{n=pE(t)}catch(t){throw Error(e+" must be hex string or Uint8Array, cause: "+t)}else if(ph(t))n=Uint8Array.from(t);else throw Error(e+" must be hex string or Uint8Array");let i=n.length;if("number"==typeof r&&i!==r)throw Error(e+" of length "+r+" expected, got "+i);return n}function pI(...e){let t=0;for(let r=0;r<e.length;r++){let n=e[r];pd(n),t+=n.length}let r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){let i=e[t];r.set(i,n),n+=i.length}return r}let pC=e=>"bigint"==typeof e&&pc<=e;function pT(e,t,r){return pC(e)&&pC(t)&&pC(r)&&t<=e&&e<r}function pP(e,t,r,n){if(!pT(t,r,n))throw Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function pR(e){let t;for(t=0;e>pc;e>>=pu,t+=1);return t}let pO=e=>(pu<<BigInt(e))-pu,pN=e=>new Uint8Array(e),pD=e=>Uint8Array.from(e);function pB(e,t,r){if("number"!=typeof e||e<2)throw Error("hashLen must be a number");if("number"!=typeof t||t<2)throw Error("qByteLen must be a number");if("function"!=typeof r)throw Error("hmacFn must be a function");let n=pN(e),i=pN(e),s=0,o=()=>{n.fill(1),i.fill(0),s=0},a=(...e)=>r(i,n,...e),l=(e=pN(0))=>{i=a(pD([0]),e),n=a(),0!==e.length&&(i=a(pD([1]),e),n=a())},c=()=>{if(s++>=1e3)throw Error("drbg: tried 1000 values");let e=0,r=[];for(;e<t;){let t=(n=a()).slice();r.push(t),e+=n.length}return pI(...r)};return(e,t)=>{let r;for(o(),l(e);!(r=t(c()));)l();return o(),r}}let pM={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||ph(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function pL(e,t,r={}){let n=(t,r,n)=>{let i=pM[r];if("function"!=typeof i)throw Error("invalid validator function");let s=e[t];if((!n||void 0!==s)&&!i(s,e))throw Error("param "+String(t)+" is invalid. Expected "+r+", got "+s)};for(let[e,r]of Object.entries(t))n(e,r,!1);for(let[e,t]of Object.entries(r))n(e,t,!0);return e}function pF(e){let t=new WeakMap;return(r,...n)=>{let i=t.get(r);if(void 0!==i)return i;let s=e(r,...n);return t.set(r,s),s}}let pU=BigInt(0),pj=BigInt(1),p$=BigInt(2),pH=BigInt(3),pq=BigInt(4),pz=BigInt(5),pV=BigInt(8);function pK(e,t){let r=e%t;return r>=pU?r:t+r}function pG(e,t,r){let n=e;for(;t-- >pU;)n*=n,n%=r;return n}function pW(e,t){if(e===pU)throw Error("invert: expected non-zero number");if(t<=pU)throw Error("invert: expected positive modulus, got "+t);let r=pK(e,t),n=t,i=pU,s=pj,o=pj,a=pU;for(;r!==pU;){let e=n/r,t=n%r,l=i-o*e,c=s-a*e;n=r,r=t,i=o,s=a,o=l,a=c}if(n!==pj)throw Error("invert: does not exist");return pK(i,t)}function pQ(e,t){let r=(e.ORDER+pj)/pq,n=e.pow(t,r);if(!e.eql(e.sqr(n),t))throw Error("Cannot find square root");return n}function pJ(e,t){let r=(e.ORDER-pz)/pV,n=e.mul(t,p$),i=e.pow(n,r),s=e.mul(t,i),o=e.mul(e.mul(s,p$),i),a=e.mul(s,e.sub(o,e.ONE));if(!e.eql(e.sqr(a),t))throw Error("Cannot find square root");return a}function pZ(e){if(e<BigInt(3))throw Error("sqrt is not defined for small field");let t=e-pj,r=0;for(;t%p$===pU;)t/=p$,r++;let n=p$,i=p6(e);for(;1===p4(i,n);)if(n++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===r)return pQ;let s=i.pow(n,t),o=(t+pj)/p$;return function(e,n){if(e.is0(n))return n;if(1!==p4(e,n))throw Error("Cannot find square root");let i=r,a=e.mul(e.ONE,s),l=e.pow(n,t),c=e.pow(n,o);for(;!e.eql(l,e.ONE);){if(e.is0(l))return e.ZERO;let t=1,r=e.sqr(l);for(;!e.eql(r,e.ONE);)if(t++,r=e.sqr(r),t===i)throw Error("Cannot find square root");let n=pj<<BigInt(i-t-1),s=e.pow(a,n);i=t,a=e.sqr(s),l=e.mul(l,a),c=e.mul(c,s)}return c}}function pY(e){return e%pq===pH?pQ:e%pV===pz?pJ:pZ(e)}let pX=(e,t)=>(pK(e,t)&pj)===pj,p0=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function p1(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"};return pL(e,p0.reduce((e,t)=>(e[t]="function",e),t))}function p2(e,t,r){if(r<pU)throw Error("invalid exponent, negatives unsupported");if(r===pU)return e.ONE;if(r===pj)return t;let n=e.ONE,i=t;for(;r>pU;)r&pj&&(n=e.mul(n,i)),i=e.sqr(i),r>>=pj;return n}function p3(e,t,r=!1){let n=Array(t.length).fill(r?e.ZERO:void 0),i=t.reduce((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r)),e.ONE),s=e.inv(i);return t.reduceRight((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r)),s),n}function p4(e,t){let r=(e.ORDER-pj)/p$,n=e.pow(t,r),i=e.eql(n,e.ONE),s=e.eql(n,e.ZERO),o=e.eql(n,e.neg(e.ONE));if(!i&&!s&&!o)throw Error("invalid Legendre symbol result");return i?1:s?0:-1}function p5(e,t){void 0!==t&&fw(t);let r=void 0!==t?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function p6(e,t,r=!1,n={}){let i;if(e<=pU)throw Error("invalid field: expected ORDER > 0, got "+e);let{nBitLength:s,nByteLength:o}=p5(e,t);if(o>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let a=Object.freeze({ORDER:e,isLE:r,BITS:s,BYTES:o,MASK:pO(s),ZERO:pU,ONE:pj,create:t=>pK(t,e),isValid:t=>{if("bigint"!=typeof t)throw Error("invalid field element: expected bigint, got "+typeof t);return pU<=t&&t<e},is0:e=>e===pU,isOdd:e=>(e&pj)===pj,neg:t=>pK(-t,e),eql:(e,t)=>e===t,sqr:t=>pK(t*t,e),add:(t,r)=>pK(t+r,e),sub:(t,r)=>pK(t-r,e),mul:(t,r)=>pK(t*r,e),pow:(e,t)=>p2(a,e,t),div:(t,r)=>pK(t*pW(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>pW(t,e),sqrt:n.sqrt||(t=>(i||(i=pY(e)),i(a,t))),toBytes:e=>r?pk(e,o):pS(e,o),fromBytes:e=>{if(e.length!==o)throw Error("Field.fromBytes: expected "+o+" bytes, got "+e.length);return r?px(e):pA(e)},invertBatch:e=>p3(a,e),cmov:(e,t,r)=>r?t:e});return Object.freeze(a)}function p8(e){if("bigint"!=typeof e)throw Error("field order must be bigint");return Math.ceil(e.toString(2).length/8)}function p7(e){let t=p8(e);return t+Math.ceil(t/2)}function p9(e,t,r=!1){let n=e.length,i=p8(t),s=p7(t);if(n<16||n<s||n>1024)throw Error("expected "+s+"-1024 bytes of input, got "+n);let o=pK(r?px(e):pA(e),t-pj)+pj;return r?pk(o,i):pS(o,i)}let ge=BigInt(0),gt=BigInt(1);function gr(e,t){let r=t.negate();return e?r:t}function gn(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw Error("invalid window size, expected [1.."+t+"], got W="+e)}function gi(e,t){gn(e,t);let r=Math.ceil(t/e)+1,n=2**(e-1),i=2**e;return{windows:r,windowSize:n,mask:pO(e),maxNumber:i,shiftBy:BigInt(e)}}function gs(e,t,r){let{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r,a=Number(e&i),l=e>>o;a>n&&(a-=s,l+=gt);let c=t*n,u=c+Math.abs(a)-1;return{nextN:l,offset:u,isZero:0===a,isNeg:a<0,isNegF:t%2!=0,offsetF:c}}function go(e,t){if(!Array.isArray(e))throw Error("array expected");e.forEach((e,r)=>{if(!(e instanceof t))throw Error("invalid point at index "+r)})}function ga(e,t){if(!Array.isArray(e))throw Error("array of scalars expected");e.forEach((e,r)=>{if(!t.isValid(e))throw Error("invalid scalar at index "+r)})}let gl=new WeakMap,gc=new WeakMap;function gu(e){return gc.get(e)||1}function gh(e,t){return{constTimeNegate:gr,hasPrecomputes:e=>1!==gu(e),unsafeLadder(t,r,n=e.ZERO){let i=t;for(;r>ge;)r&gt&&(n=n.add(i)),i=i.double(),r>>=gt;return n},precomputeWindow(e,r){let{windows:n,windowSize:i}=gi(r,t),s=[],o=e,a=o;for(let e=0;e<n;e++){a=o,s.push(a);for(let e=1;e<i;e++)a=a.add(o),s.push(a);o=a.double()}return s},wNAF(r,n,i){let s=e.ZERO,o=e.BASE,a=gi(r,t);for(let e=0;e<a.windows;e++){let{nextN:t,offset:r,isZero:l,isNeg:c,isNegF:u,offsetF:h}=gs(i,e,a);i=t,l?o=o.add(gr(u,n[h])):s=s.add(gr(c,n[r]))}return{p:s,f:o}},wNAFUnsafe(r,n,i,s=e.ZERO){let o=gi(r,t);for(let e=0;e<o.windows&&i!==ge;e++){let{nextN:t,offset:r,isZero:a,isNeg:l}=gs(i,e,o);if(i=t,!a){let e=n[r];s=s.add(l?e.negate():e)}}return s},getPrecomputes(e,t,r){let n=gl.get(t);return n||(n=this.precomputeWindow(t,e),1!==e&&gl.set(t,r(n))),n},wNAFCached(e,t,r){let n=gu(e);return this.wNAF(n,this.getPrecomputes(n,e,r),t)},wNAFCachedUnsafe(e,t,r,n){let i=gu(e);return 1===i?this.unsafeLadder(e,t,n):this.wNAFUnsafe(i,this.getPrecomputes(i,e,r),t,n)},setWindowSize(e,r){gn(r,t),gc.set(e,r),gl.delete(e)}}}function gd(e,t,r,n){go(r,e),ga(n,t);let i=r.length,s=n.length;if(i!==s)throw Error("arrays of points and scalars must have equal length");let o=e.ZERO,a=pR(BigInt(i)),l=1;a>12?l=a-3:a>4?l=a-2:a>0&&(l=2);let c=pO(l),u=Array(Number(c)+1).fill(o),h=Math.floor((t.BITS-1)/l)*l,d=o;for(let e=h;e>=0;e-=l){u.fill(o);for(let t=0;t<s;t++){let i=Number(n[t]>>BigInt(e)&c);u[i]=u[i].add(r[t])}let t=o;for(let e=u.length-1,r=o;e>0;e--)r=r.add(u[e]),t=t.add(r);if(d=d.add(t),0!==e)for(let e=0;e<l;e++)d=d.double()}return d}function gf(e){return p1(e.Fp),pL(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...p5(e.n,e.nBitLength),...e,...{p:e.Fp.ORDER}})}let gp=BigInt(0),gg=BigInt(1),gm=BigInt(2),gy=BigInt(8),gb={zip215:!0};function gw(e){let t=gf(e);return pL(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function gv(e){let t=gw(e),{Fp:r,n:n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:l}=t,c=gm<<BigInt(8*a)-gg,u=r.create,h=p6(t.n,t.nBitLength);if(!function(e,n){let i=r.sqr(e),s=r.sqr(n),o=r.add(r.mul(t.a,i),s),a=r.add(r.ONE,r.mul(t.d,r.mul(i,s)));return r.eql(o,a)}(t.Gx,t.Gy))throw Error("bad curve params: generator point");let d=t.uvRatio||((e,t)=>{try{return{isValid:!0,value:r.sqrt(e*r.inv(t))}}catch(e){return{isValid:!1,value:gp}}}),f=t.adjustScalarBytes||(e=>e),p=t.domain||((e,t,r)=>{if(pf("phflag",r),t.length||r)throw Error("Contexts/pre-hash are not supported");return e});function g(e,t,r=!1){pP("coordinate "+e,t,r?gg:gp,c)}function m(e){if(!(e instanceof w))throw Error("ExtendedPoint expected")}let y=pF((e,t)=>{let{ex:n,ey:i,ez:s}=e,o=e.is0();null==t&&(t=o?gy:r.inv(s));let a=u(n*t),l=u(i*t),c=u(s*t);if(o)return{x:gp,y:gg};if(c!==gg)throw Error("invZ was invalid");return{x:a,y:l}}),b=pF(e=>{let{a:r,d:n}=t;if(e.is0())throw Error("bad point: ZERO");let{ex:i,ey:s,ez:o,et:a}=e,l=u(i*i),c=u(s*s),h=u(o*o),d=u(h*h),f=u(l*r);if(u(h*u(f+c))!==u(d+u(n*u(l*c))))throw Error("bad point: equation left != right (1)");if(u(i*s)!==u(o*a))throw Error("bad point: equation left != right (2)");return!0});class w{constructor(e,t,r,n){g("x",e),g("y",t),g("z",r,!0),g("t",n),this.ex=e,this.ey=t,this.ez=r,this.et=n,Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(e){if(e instanceof w)throw Error("extended point not allowed");let{x:t,y:r}=e||{};return g("x",t),g("y",r),new w(t,r,gg,u(t*r))}static normalizeZ(e){let t=p3(r,e.map(e=>e.ez));return e.map((e,r)=>e.toAffine(t[r])).map(w.fromAffine)}static msm(e,t){return gd(w,h,e,t)}_setWindowSize(e){A.setWindowSize(this,e)}assertValidity(){b(this)}equals(e){m(e);let{ex:t,ey:r,ez:n}=this,{ex:i,ey:s,ez:o}=e,a=u(t*o),l=u(i*n),c=u(r*o),h=u(s*n);return a===l&&c===h}is0(){return this.equals(w.ZERO)}negate(){return new w(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){let{a:e}=t,{ex:r,ey:n,ez:i}=this,s=u(r*r),o=u(n*n),a=u(gm*u(i*i)),l=u(e*s),c=r+n,h=u(u(c*c)-s-o),d=l+o,f=d-a,p=l-o,g=u(h*f),m=u(d*p),y=u(h*p);return new w(g,m,u(f*d),y)}add(e){m(e);let{a:r,d:n}=t,{ex:i,ey:s,ez:o,et:a}=this,{ex:l,ey:c,ez:h,et:d}=e,f=u(i*l),p=u(s*c),g=u(a*n*d),y=u(o*h),b=u((i+s)*(l+c)-f-p),v=y-g,E=y+g,A=u(p-r*f),x=u(b*v),S=u(E*A),k=u(b*A);return new w(x,S,u(v*E),k)}subtract(e){return this.add(e.negate())}wNAF(e){return A.wNAFCached(this,e,w.normalizeZ)}multiply(e){let t=e;pP("scalar",t,gg,n);let{p:r,f:i}=this.wNAF(t);return w.normalizeZ([r,i])[0]}multiplyUnsafe(e,t=w.ZERO){let r=e;return(pP("scalar",r,gp,n),r===gp)?E:this.is0()||r===gg?this:A.wNAFCachedUnsafe(this,r,w.normalizeZ,t)}isSmallOrder(){return this.multiplyUnsafe(l).is0()}isTorsionFree(){return A.unsafeLadder(this,n).is0()}toAffine(e){return y(this,e)}clearCofactor(){let{h:e}=t;return e===gg?this:this.multiplyUnsafe(e)}static fromHex(e,n=!1){let{d:i,a:s}=t,o=r.BYTES;e=p_("pointHex",e,o),pf("zip215",n);let a=e.slice(),l=e[o-1];a[o-1]=-129&l;let h=px(a);pP("pointHex.y",h,gp,n?c:r.ORDER);let f=u(h*h),{isValid:p,value:g}=d(u(f-gg),u(i*f-s));if(!p)throw Error("Point.fromHex: invalid y coordinate");let m=(g&gg)===gg,y=(128&l)!=0;if(!n&&g===gp&&y)throw Error("Point.fromHex: x=0 and x_0=1");return y!==m&&(g=u(-g)),w.fromAffine({x:g,y:h})}static fromPrivateKey(e){let{scalar:t}=k(e);return v.multiply(t)}toRawBytes(){let{x:e,y:t}=this.toAffine(),n=pk(t,r.BYTES);return n[n.length-1]|=e&gg?128:0,n}toHex(){return pb(this.toRawBytes())}}w.BASE=new w(t.Gx,t.Gy,gg,u(t.Gx*t.Gy)),w.ZERO=new w(gp,gg,gg,gp);let{BASE:v,ZERO:E}=w,A=gh(w,8*a);function x(e){return pK(e,n)}function S(e){return x(px(e))}function k(e){let t=r.BYTES;e=p_("private key",e,t);let n=p_("hashed private key",s(e),2*t),i=f(n.slice(0,t)),o=n.slice(t,2*t),a=S(i);return{head:i,prefix:o,scalar:a}}function _(e){let{head:t,prefix:r,scalar:n}=k(e),i=v.multiply(n),s=i.toRawBytes();return{head:t,prefix:r,scalar:n,point:i,pointBytes:s}}function I(e){return _(e).pointBytes}function C(e=Uint8Array.of(),...t){return S(s(p(pI(...t),p_("context",e),!!i)))}function T(e,t,s={}){e=p_("message",e),i&&(e=i(e));let{prefix:o,scalar:a,pointBytes:l}=_(t),c=C(s.context,o,e),u=v.multiply(c).toRawBytes(),h=x(c+C(s.context,u,l,e)*a);return pP("signature.s",h,gp,n),p_("result",pI(u,pk(h,r.BYTES)),2*r.BYTES)}let P=gb;function R(e,t,n,s=P){let o,a,l,{context:c,zip215:u}=s,h=r.BYTES;e=p_("signature",e,2*h),t=p_("message",t),n=p_("publicKey",n,h),void 0!==u&&pf("zip215",u),i&&(t=i(t));let d=px(e.slice(h,2*h));try{o=w.fromHex(n,u),a=w.fromHex(e.slice(0,h),u),l=v.multiplyUnsafe(d)}catch(e){return!1}if(!u&&o.isSmallOrder())return!1;let f=C(c,a.toRawBytes(),o.toRawBytes(),t);return a.add(o.multiplyUnsafe(f)).subtract(l).clearCofactor().equals(w.ZERO)}v._setWindowSize(8);let O={getExtendedPublicKey:_,randomPrivateKey:()=>o(r.BYTES),precompute:(e=8,t=w.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};return{CURVE:t,getPublicKey:I,sign:T,verify:R,ExtendedPoint:w,utils:O}}let gE=BigInt(0),gA=BigInt(1),gx=BigInt(2);function gS(e){return pL(e,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...e})}function gk(e){let t=gS(e),{P:r,type:n,adjustScalarBytes:i,powPminus2:s}=t,o="x25519"===n;if(!o&&"x448"!==n)throw Error("invalid type");let a=o?255:448,l=o?32:56,c=o?BigInt(9):BigInt(5),u=o?BigInt(121665):BigInt(39081),h=o?gx**BigInt(254):gx**BigInt(447),d=h+(o?BigInt(8)*gx**BigInt(251)-gA:BigInt(4)*gx**BigInt(445)-gA)+gA,f=e=>pK(e,r),p=g(c);function g(e){return pk(f(e),l)}function m(e){let t=p_("u coordinate",e,l);return o&&(t[31]&=127),f(px(t))}function y(e){return px(i(p_("scalar",e,l)))}function b(e,t){let r=E(m(t),y(e));if(r===gE)throw Error("invalid private or public key received");return g(r)}function w(e){return b(e,p)}function v(e,t,r){let n=f(e*(t-r));return{x_2:t=f(t-n),x_3:r=f(r+n)}}function E(e,t){pP("u",e,gE,r),pP("scalar",t,h,d);let n=t,i=e,o=gA,l=gE,c=e,p=gA,g=gE;for(let e=BigInt(a-1);e>=gE;e--){let t=n>>e&gA;g^=t,({x_2:o,x_3:c}=v(g,o,c)),({x_2:l,x_3:p}=v(g,l,p)),g=t;let r=o+l,s=f(r*r),a=o-l,h=f(a*a),d=s-h,m=c+p,y=f((c-p)*r),b=f(m*a),w=y+b,E=y-b;c=f(w*w),p=f(i*f(E*E)),o=f(s*h),l=f(d*(s+f(u*d)))}return{x_2:o,x_3:c}=v(g,o,c),{x_2:l,x_3:p}=v(g,l,p),f(o*s(l))}return{scalarMult:b,scalarMultBase:w,getSharedSecret:(e,t)=>b(e,t),getPublicKey:e=>w(e),utils:{randomPrivateKey:()=>t.randomBytes(l)},GuBytes:p.slice()}}let g_=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),gI=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);let gC=BigInt(1),gT=BigInt(2),gP=BigInt(3),gR=BigInt(5),gO=BigInt(8);function gN(e){let t=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=g_,o=e*e%s*e%s,a=pG(o,gT,s)*o%s,l=pG(a,gC,s)*e%s,c=pG(l,gR,s)*l%s,u=pG(c,t,s)*c%s,h=pG(u,r,s)*u%s,d=pG(h,n,s)*h%s,f=pG(d,i,s)*d%s,p=pG(f,i,s)*d%s,g=pG(p,t,s)*c%s;return{pow_p_5_8:pG(g,gT,s)*e%s,b2:o}}function gD(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}function gB(e,t){let r=g_,n=pK(t*t*t,r),i=gN(e*pK(n*n*t,r)).pow_p_5_8,s=pK(e*n*i,r),o=pK(t*s*s,r),a=s,l=pK(s*gI,r),c=o===e,u=o===pK(-e,r),h=o===pK(-e*gI,r);return c&&(s=a),(u||h)&&(s=l),pX(s,r)&&(s=pK(-s,r)),{isValid:c||u,value:s}}let gM=p6(g_,void 0,!0),gL=gv({a:gM.create(BigInt(-1)),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:gM,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:gO,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:pl,randomBytes:fF,adjustScalarBytes:gD,uvRatio:gB}),gF=gk({P:g_,type:"x25519",powPminus2:e=>{let t=g_,{pow_p_5_8:r,b2:n}=gN(e);return pK(pG(r,gP,t)*n,t)},adjustScalarBytes:gD,randomBytes:fF}),gU=null,gj=null,g$=32,gH=64,gq=32;function gz(){let e=gL.utils.randomPrivateKey(),t=gL.getPublicKey(e);return{privateKey:gG(e,t),publicKey:t}}function gV(e,t){let r=e.subarray(0,gq);return gL.sign(t instanceof Uint8Array?t:t.subarray(),r)}function gK(e,t,r){return gL.verify(t,r instanceof Uint8Array?r:r.subarray(),e)}function gG(e,t){let r=new Uint8Array(gH);for(let n=0;n<gq;n++)r[n]=e[n],r[gq+n]=t[n];return r}class gW{type="Ed25519";raw;constructor(e){this.raw=gX(e,g$)}toMultihash(){return aq.identity.digest(yu(this))}toCID(){return rc.TO.createV1(114,this.toMultihash())}toString(){return d8.base58btc.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&rr(this.raw,e.raw)}verify(e,t){return gK(this.raw,t,e)}}class gQ{type="Ed25519";raw;publicKey;constructor(e,t){this.raw=gX(e,gH),this.publicKey=new gW(t)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&rr(this.raw,e.raw)}sign(e){return gV(this.raw,e)}}function gJ(e){return e.length>gH?new gQ((e=gX(e,gH+g$)).subarray(0,gH),e.subarray(gH,e.length)):new gQ((e=gX(e,gH)).subarray(0,gH),e.subarray(g$))}function gZ(e){return new gW(e=gX(e,g$))}async function gY(){let{privateKey:e,publicKey:t}=gz();return new gQ(e,t)}function gX(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw new uC(`Key must be a Uint8Array of length ${t}, got ${e.length}`);return e}!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.secp256k1="secp256k1",e.ECDSA="ECDSA"}(w||(w={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.secp256k1=2]="secp256k1",e[e.ECDSA=3]="ECDSA"}(v||(v={})),function(e){e.codec=()=>nB(v)}(w||(w={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),w.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.Type=w.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(E||(E={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),w.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.Type=w.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(A||(A={}));class g0 extends Error{constructor(e="An error occurred while signing a message"){super(e),this.name="SigningError"}}class g1 extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class g2 extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}let g3={get(e=globalThis){let t=e.crypto;if(t?.subtle==null)throw new g2("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}},g4="1.2.840.113549.1.1.1";async function g5(e){let t=await g3.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await g7(t);return{privateKey:r[0],publicKey:r[1]}}async function g6(e,t){let r=await g3.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await g3.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,t instanceof Uint8Array?t:t.subarray());return new Uint8Array(n,0,n.byteLength)}async function g8(e,t,r){let n=await g3.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return g3.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r instanceof Uint8Array?r:r.subarray())}async function g7(e){if(null==e.privateKey||null==e.publicKey)throw new uC("Private and public key are required");return Promise.all([g3.get().subtle.exportKey("jwk",e.privateKey),g3.get().subtle.exportKey("jwk",e.publicKey)])}function g9(e){if("RSA"!==e.kty)throw new uC("invalid key type");if(null==e.n)throw new uC("invalid key modulus");return 8*(0,nm.s)(e.n,"base64url").length}let me=pa;class mt{type="RSA";jwk;_raw;_multihash;constructor(e,t){this.jwk=e,this._multihash=t}get raw(){return null==this._raw&&(this._raw=mu(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return rc.TO.createV1(114,this._multihash)}toString(){return d8.base58btc.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&rr(this.raw,e.raw)}verify(e,t){return g8(this.jwk,t,e)}}class mr{type="RSA";jwk;_raw;publicKey;constructor(e,t){this.jwk=e,this.publicKey=t}get raw(){return null==this._raw&&(this._raw=ml(this.jwk)),this._raw}equals(e){return null!=e&&e.raw instanceof Uint8Array&&rr(this.raw,e.raw)}sign(e){return g6(this.jwk,e)}}let mn=8192,mi=18,ms=1062,mo=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function ma(e){return{n:(0,uh.d)(e[1],"base64url"),e:(0,uh.d)(e[2],"base64url"),d:(0,uh.d)(e[3],"base64url"),p:(0,uh.d)(e[4],"base64url"),q:(0,uh.d)(e[5],"base64url"),dp:(0,uh.d)(e[6],"base64url"),dq:(0,uh.d)(e[7],"base64url"),qi:(0,uh.d)(e[8],"base64url"),kty:"RSA"}}function ml(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new uC("JWK was missing components");return d6([d3(Uint8Array.from([0])),d3((0,nm.s)(e.n,"base64url")),d3((0,nm.s)(e.e,"base64url")),d3((0,nm.s)(e.d,"base64url")),d3((0,nm.s)(e.p,"base64url")),d3((0,nm.s)(e.q,"base64url")),d3((0,nm.s)(e.dp,"base64url")),d3((0,nm.s)(e.dq,"base64url")),d3((0,nm.s)(e.qi,"base64url"))]).subarray()}function mc(e){let t=dG(e[1],{offset:0});return{kty:"RSA",n:(0,uh.d)(t[0],"base64url"),e:(0,uh.d)(t[1],"base64url")}}function mu(e){if(null==e.n||null==e.e)throw new uC("JWK was missing components");return d6([mo,d4(d6([d3((0,nm.s)(e.n,"base64url")),d3((0,nm.s)(e.e,"base64url"))]))]).subarray()}function mh(e){return md(dG(e))}function md(e){return mg(ma(e))}function mf(e,t){if(e.byteLength>=ms)throw new uT("Key size is too large");return mp(dG(e,{offset:0}),e,t)}function mp(e,t,r){let n=mc(e);if(null==r){let e=me(E.encode({Type:w.RSA,Data:t}));r=(0,aG.create)(mi,e)}return new mt(n,r)}function mg(e){if(g9(e)>mn)throw new uC("Key size is too large");let t=my(e),r=me(E.encode({Type:w.RSA,Data:mu(t.publicKey)})),n=(0,aG.create)(mi,r);return new mr(t.privateKey,new mt(t.publicKey,n))}async function mm(e){if(e>mn)throw new uC("Key size is too large");let t=await g5(e),r=me(E.encode({Type:w.RSA,Data:mu(t.publicKey)})),n=(0,aG.create)(mi,r);return new mr(t.privateKey,new mt(t.publicKey,n))}function my(e){if(null==e)throw new uC("Missing key parameter");return{privateKey:e,publicKey:{kty:e.kty,n:e.n,e:e.e}}}class mb extends fM{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,fE(e);let r=fO(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let n=this.blockLen,i=new Uint8Array(n);i.set(r.length>n?e.create().update(r).digest():r);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),fS(i)}update(e){return fA(this),this.iHash.update(e),this}digestInto(e){fA(this),fv(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:r,finished:n,destroyed:i,blockLen:s,outputLen:o}=this;return e.finished=n,e.destroyed=i,e.blockLen=s,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let mw=(e,t,r)=>new mb(e,t).update(r).digest();function mv(e){void 0!==e.lowS&&pf("lowS",e.lowS),void 0!==e.prehash&&pf("prehash",e.prehash)}function mE(e){let t=gf(e);pL(t,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});let{endo:r,Fp:n,a:i}=t;if(r){if(!n.eql(i,n.ZERO))throw Error("invalid endo: CURVE.a must be 0");if("object"!=typeof r||"bigint"!=typeof r.beta||"function"!=typeof r.splitScalar)throw Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...t})}mw.create=(e,t)=>new mb(e,t);class mA extends Error{constructor(e=""){super(e)}}let mx={Err:mA,_tlv:{encode:(e,t)=>{let{Err:r}=mx;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(1&t.length)throw new r("tlv.encode: unpadded data");let n=t.length/2,i=pp(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");let s=n>127?pp(i.length/2|128):"";return pp(e)+s+i+t},decode(e,t){let{Err:r}=mx,n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");let i=t[n++],s=0;if(128&i){let e=127&i;if(!e)throw new r("tlv.decode(long): indefinite length not supported");if(e>4)throw new r("tlv.decode(long): byte length is too big");let o=t.subarray(n,n+e);if(o.length!==e)throw new r("tlv.decode: length bytes not complete");if(0===o[0])throw new r("tlv.decode(long): zero leftmost byte");for(let e of o)s=s<<8|e;if(n+=e,s<128)throw new r("tlv.decode(long): not minimal encoding")}else s=i;let o=t.subarray(n,n+s);if(o.length!==s)throw new r("tlv.decode: wrong value length");return{v:o,l:t.subarray(n+s)}}},_int:{encode(e){let{Err:t}=mx;if(e<mk)throw new t("integer: negative integers are not allowed");let r=pp(e);if(8&Number.parseInt(r[0],16)&&(r="00"+r),1&r.length)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=mx;if(128&e[0])throw new t("invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new t("invalid signature integer: unnecessary leading zero");return pA(e)}},toSig(e){let{Err:t,_int:r,_tlv:n}=mx,i=p_("signature",e),{v:s,l:o}=n.decode(48,i);if(o.length)throw new t("invalid signature: left bytes after parsing");let{v:a,l:l}=n.decode(2,s),{v:c,l:u}=n.decode(2,l);if(u.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(c)}},hexFromSig(e){let{_tlv:t,_int:r}=mx,n=t.encode(2,r.encode(e.r))+t.encode(2,r.encode(e.s));return t.encode(48,n)}};function mS(e,t){return pb(pS(e,t))}let mk=BigInt(0),m_=BigInt(1),mI=BigInt(2),mC=BigInt(3),mT=BigInt(4);function mP(e){let t=mE(e),{Fp:r}=t,n=p6(t.n,t.nBitLength),i=t.toBytes||((e,t,n)=>{let i=t.toAffine();return pI(Uint8Array.from([4]),r.toBytes(i.x),r.toBytes(i.y))}),s=t.fromBytes||(e=>{let t=e.subarray(1);return{x:r.fromBytes(t.subarray(0,r.BYTES)),y:r.fromBytes(t.subarray(r.BYTES,2*r.BYTES))}});function o(e){let{a:n,b:i}=t,s=r.sqr(e),o=r.mul(s,e);return r.add(r.add(o,r.mul(e,n)),i)}function a(e,t){let n=r.sqr(t),i=o(e);return r.eql(n,i)}if(!a(t.Gx,t.Gy))throw Error("bad curve params: generator point");let l=r.mul(r.pow(t.a,mC),mT),c=r.mul(r.sqr(t.b),BigInt(27));if(r.is0(r.add(l,c)))throw Error("bad curve params: a or b");function u(e){return pT(e,m_,t.n)}function h(e){let r,{allowedPrivateKeyLengths:n,nByteLength:i,wrapPrivateKey:s,n:o}=t;if(n&&"bigint"!=typeof e){if(ph(e)&&(e=pb(e)),"string"!=typeof e||!n.includes(e.length))throw Error("invalid private key");e=e.padStart(2*i,"0")}try{r="bigint"==typeof e?e:pA(p_("private key",e,i))}catch(t){throw Error("invalid private key, expected hex or "+i+" bytes, got "+typeof e)}return s&&(r=pK(r,o)),pP("private key",r,m_,o),r}function d(e){if(!(e instanceof g))throw Error("ProjectivePoint expected")}let f=pF((e,t)=>{let{px:n,py:i,pz:s}=e;if(r.eql(s,r.ONE))return{x:n,y:i};let o=e.is0();null==t&&(t=o?r.ONE:r.inv(s));let a=r.mul(n,t),l=r.mul(i,t),c=r.mul(s,t);if(o)return{x:r.ZERO,y:r.ZERO};if(!r.eql(c,r.ONE))throw Error("invZ was invalid");return{x:a,y:l}}),p=pF(e=>{if(e.is0()){if(t.allowInfinityPoint&&!r.is0(e.py))return;throw Error("bad point: ZERO")}let{x:n,y:i}=e.toAffine();if(!r.isValid(n)||!r.isValid(i))throw Error("bad point: x or y not FE");if(!a(n,i))throw Error("bad point: equation left != right");if(!e.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});class g{constructor(e,t,n){if(null==e||!r.isValid(e))throw Error("x required");if(null==t||!r.isValid(t)||r.is0(t))throw Error("y required");if(null==n||!r.isValid(n))throw Error("z required");this.px=e,this.py=t,this.pz=n,Object.freeze(this)}static fromAffine(e){let{x:t,y:n}=e||{};if(!e||!r.isValid(t)||!r.isValid(n))throw Error("invalid affine point");if(e instanceof g)throw Error("projective point not allowed");let i=e=>r.eql(e,r.ZERO);return i(t)&&i(n)?g.ZERO:new g(t,n,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){let t=p3(r,e.map(e=>e.pz));return e.map((e,r)=>e.toAffine(t[r])).map(g.fromAffine)}static fromHex(e){let t=g.fromAffine(s(p_("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return g.BASE.multiply(h(e))}static msm(e,t){return gd(g,n,e,t)}_setWindowSize(e){b.setWindowSize(this,e)}assertValidity(){p(this)}hasEvenY(){let{y:e}=this.toAffine();if(r.isOdd)return!r.isOdd(e);throw Error("Field doesn't support isOdd")}equals(e){d(e);let{px:t,py:n,pz:i}=this,{px:s,py:o,pz:a}=e,l=r.eql(r.mul(t,a),r.mul(s,i)),c=r.eql(r.mul(n,a),r.mul(o,i));return l&&c}negate(){return new g(this.px,r.neg(this.py),this.pz)}double(){let{a:e,b:n}=t,i=r.mul(n,mC),{px:s,py:o,pz:a}=this,l=r.ZERO,c=r.ZERO,u=r.ZERO,h=r.mul(s,s),d=r.mul(o,o),f=r.mul(a,a),p=r.mul(s,o);return p=r.add(p,p),u=r.mul(s,a),u=r.add(u,u),l=r.mul(e,u),c=r.mul(i,f),c=r.add(l,c),l=r.sub(d,c),c=r.add(d,c),c=r.mul(l,c),l=r.mul(p,l),u=r.mul(i,u),f=r.mul(e,f),p=r.sub(h,f),p=r.mul(e,p),p=r.add(p,u),u=r.add(h,h),h=r.add(u,h),h=r.add(h,f),h=r.mul(h,p),c=r.add(c,h),f=r.mul(o,a),f=r.add(f,f),h=r.mul(f,p),l=r.sub(l,h),u=r.mul(f,d),u=r.add(u,u),new g(l,c,u=r.add(u,u))}add(e){d(e);let{px:n,py:i,pz:s}=this,{px:o,py:a,pz:l}=e,c=r.ZERO,u=r.ZERO,h=r.ZERO,f=t.a,p=r.mul(t.b,mC),m=r.mul(n,o),y=r.mul(i,a),b=r.mul(s,l),w=r.add(n,i),v=r.add(o,a);w=r.mul(w,v),v=r.add(m,y),w=r.sub(w,v),v=r.add(n,s);let E=r.add(o,l);return v=r.mul(v,E),E=r.add(m,b),v=r.sub(v,E),E=r.add(i,s),c=r.add(a,l),E=r.mul(E,c),c=r.add(y,b),E=r.sub(E,c),h=r.mul(f,v),c=r.mul(p,b),h=r.add(c,h),c=r.sub(y,h),h=r.add(y,h),u=r.mul(c,h),y=r.add(m,m),y=r.add(y,m),b=r.mul(f,b),v=r.mul(p,v),y=r.add(y,b),b=r.sub(m,b),b=r.mul(f,b),v=r.add(v,b),m=r.mul(y,v),u=r.add(u,m),m=r.mul(E,v),c=r.mul(w,c),c=r.sub(c,m),m=r.mul(w,y),h=r.mul(E,h),new g(c,u,h=r.add(h,m))}subtract(e){return this.add(e.negate())}is0(){return this.equals(g.ZERO)}wNAF(e){return b.wNAFCached(this,e,g.normalizeZ)}multiplyUnsafe(e){let{endo:n,n:i}=t;pP("scalar",e,mk,i);let s=g.ZERO;if(e===mk)return s;if(this.is0()||e===m_)return this;if(!n||b.hasPrecomputes(this))return b.wNAFCachedUnsafe(this,e,g.normalizeZ);let{k1neg:o,k1:a,k2neg:l,k2:c}=n.splitScalar(e),u=s,h=s,d=this;for(;a>mk||c>mk;)a&m_&&(u=u.add(d)),c&m_&&(h=h.add(d)),d=d.double(),a>>=m_,c>>=m_;return o&&(u=u.negate()),l&&(h=h.negate()),h=new g(r.mul(h.px,n.beta),h.py,h.pz),u.add(h)}multiply(e){let n,i,{endo:s,n:o}=t;if(pP("scalar",e,m_,o),s){let{k1neg:t,k1:o,k2neg:a,k2:l}=s.splitScalar(e),{p:c,f:u}=this.wNAF(o),{p:h,f:d}=this.wNAF(l);c=b.constTimeNegate(t,c),h=b.constTimeNegate(a,h),h=new g(r.mul(h.px,s.beta),h.py,h.pz),n=c.add(h),i=u.add(d)}else{let{p:t,f:r}=this.wNAF(e);n=t,i=r}return g.normalizeZ([n,i])[0]}multiplyAndAddUnsafe(e,t,r){let n=g.BASE,i=(e,t)=>t!==mk&&t!==m_&&e.equals(n)?e.multiply(t):e.multiplyUnsafe(t),s=i(this,t).add(i(e,r));return s.is0()?void 0:s}toAffine(e){return f(this,e)}isTorsionFree(){let{h:e,isTorsionFree:r}=t;if(e===m_)return!0;if(r)return r(g,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:e,clearCofactor:r}=t;return e===m_?this:r?r(g,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return pf("isCompressed",e),this.assertValidity(),i(g,this,e)}toHex(e=!0){return pf("isCompressed",e),pb(this.toRawBytes(e))}}g.BASE=new g(t.Gx,t.Gy,r.ONE),g.ZERO=new g(r.ZERO,r.ONE,r.ZERO);let{endo:m,nBitLength:y}=t,b=gh(g,m?Math.ceil(y/2):y);return{CURVE:t,ProjectivePoint:g,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:u}}function mR(e){let t=gf(e);return pL(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function mO(e){let t=mR(e),{Fp:r,n:n,nByteLength:i,nBitLength:s}=t,o=r.BYTES+1,a=2*r.BYTES+1;function l(e){return pK(e,n)}function c(e){return pW(e,n)}let{ProjectivePoint:u,normPrivateKeyToScalar:h,weierstrassEquation:d,isWithinCurveOrder:f}=mP({...t,toBytes(e,t,n){let i=t.toAffine(),s=r.toBytes(i.x),o=pI;return(pf("isCompressed",n),n)?o(Uint8Array.from([t.hasEvenY()?2:3]),s):o(Uint8Array.from([4]),s,r.toBytes(i.y))},fromBytes(e){let t=e.length,n=e[0],i=e.subarray(1);if(t===o&&(2===n||3===n)){let e,t=pA(i);if(!pT(t,m_,r.ORDER))throw Error("Point is not on curve");let s=d(t);try{e=r.sqrt(s)}catch(e){throw Error("Point is not on curve"+(e instanceof Error?": "+e.message:""))}return(1&n)==1!=((e&m_)===m_)&&(e=r.neg(e)),{x:t,y:e}}if(t===a&&4===n)return{x:r.fromBytes(i.subarray(0,r.BYTES)),y:r.fromBytes(i.subarray(r.BYTES,2*r.BYTES))};throw Error("invalid Point, expected length of "+o+", or uncompressed "+a+", got "+t)}});function p(e){return e>n>>m_}function g(e){return p(e)?l(-e):e}let m=(e,t,r)=>pA(e.slice(t,r));class y{constructor(e,t,r){pP("r",e,m_,n),pP("s",t,m_,n),this.r=e,this.s=t,null!=r&&(this.recovery=r),Object.freeze(this)}static fromCompact(e){let t=i;return new y(m(e=p_("compactSignature",e,2*t),0,t),m(e,t,2*t))}static fromDER(e){let{r:t,s:r}=mx.toSig(p_("DER",e));return new y(t,r)}assertValidity(){}addRecoveryBit(e){return new y(this.r,this.s,e)}recoverPublicKey(e){let{r:n,s:i,recovery:s}=this,o=x(p_("msgHash",e));if(null==s||![0,1,2,3].includes(s))throw Error("recovery id invalid");let a=2===s||3===s?n+t.n:n;if(a>=r.ORDER)throw Error("recovery id 2 or 3 invalid");let h=(1&s)==0?"02":"03",d=u.fromHex(h+mS(a,r.BYTES)),f=c(a),p=l(-o*f),g=l(i*f),m=u.BASE.multiplyAndAddUnsafe(d,p,g);if(!m)throw Error("point at infinify");return m.assertValidity(),m}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,l(-this.s),this.recovery):this}toDERRawBytes(){return pE(this.toDERHex())}toDERHex(){return mx.hexFromSig(this)}toCompactRawBytes(){return pE(this.toCompactHex())}toCompactHex(){let e=i;return mS(this.r,e)+mS(this.s,e)}}let b={isValidPrivateKey(e){try{return h(e),!0}catch(e){return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{let e=p7(t.n);return p9(t.randomBytes(e),t.n)},precompute:(e=8,t=u.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function w(e,t=!0){return u.fromPrivateKey(e).toRawBytes(t)}function v(e){if("bigint"==typeof e)return!1;if(e instanceof u)return!0;let n=p_("key",e).length,s=r.BYTES,o=s+1,a=2*s+1;if(!t.allowedPrivateKeyLengths&&i!==o)return n===o||n===a}function E(e,t,r=!0){if(!0===v(e))throw Error("first arg must be private key");if(!1===v(t))throw Error("second arg must be public key");return u.fromHex(t).multiply(h(e)).toRawBytes(r)}let A=t.bits2int||function(e){if(e.length>8192)throw Error("input is too large");let t=pA(e),r=8*e.length-s;return r>0?t>>BigInt(r):t},x=t.bits2int_modN||function(e){return l(A(e))},S=pO(s);function k(e){return pP("num < 2^"+s,e,mk,S),pS(e,i)}function _(e,n,i=I){if(["recovered","canonical"].some(e=>e in i))throw Error("sign() legacy options not supported");let{hash:s,randomBytes:o}=t,{lowS:a,prehash:d,extraEntropy:m}=i;null==a&&(a=!0),e=p_("msgHash",e),mv(i),d&&(e=p_("prehashed msgHash",s(e)));let b=x(e),w=h(n),v=[k(w),k(b)];if(null!=m&&!1!==m){let e=!0===m?o(r.BYTES):m;v.push(p_("extraEntropy",e))}let E=pI(...v),S=b;return{seed:E,k2sig:function(e){let t=A(e);if(!f(t))return;let r=c(t),n=u.BASE.multiply(t).toAffine(),i=l(n.x);if(i===mk)return;let s=l(r*l(S+i*w));if(s===mk)return;let o=2*(n.x!==i)|Number(n.y&m_),h=s;return a&&p(s)&&(h=g(s),o^=1),new y(i,h,o)}}}let I={lowS:t.lowS,prehash:!1},C={lowS:t.lowS,prehash:!1};function T(e,r,n=I){let{seed:i,k2sig:s}=_(e,r,n),o=t;return pB(o.hash.outputLen,o.nByteLength,o.hmac)(i,s)}function P(e,r,n,i=C){let s,o,a=e;r=p_("msgHash",r),n=p_("publicKey",n);let{lowS:h,prehash:d,format:f}=i;if(mv(i),"strict"in i)throw Error("options.strict was renamed to lowS");if(void 0!==f&&"compact"!==f&&"der"!==f)throw Error("format must be compact or der");let p="string"==typeof a||ph(a),g=!p&&!f&&"object"==typeof a&&null!==a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!p&&!g)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");try{if(g&&(o=new y(a.r,a.s)),p){try{"compact"!==f&&(o=y.fromDER(a))}catch(e){if(!(e instanceof mx.Err))throw e}o||"der"===f||(o=y.fromCompact(a))}s=u.fromHex(n)}catch(e){return!1}if(!o||h&&o.hasHighS())return!1;d&&(r=t.hash(r));let{r:m,s:b}=o,w=x(r),v=c(b),E=l(w*v),A=l(m*v),S=u.BASE.multiplyAndAddUnsafe(s,E,A)?.toAffine();return!!S&&l(S.x)===m}return u.BASE._setWindowSize(8),{CURVE:t,getPublicKey:w,getSharedSecret:E,sign:T,verify:P,ProjectivePoint:u,Signature:y,utils:b}}function mN(e){return{hash:e,hmac:(t,...r)=>mw(e,t,fD(...r)),randomBytes:fF}}function mD(e,t){let r=t=>mO({...e,...mN(t)});return{...r(t),create:r}}let mB=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),mM=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),mL=BigInt(0),mF=BigInt(1),mU=BigInt(2),mj=(e,t)=>(e+t/mU)/t;function m$(e){let t=mB,r=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=e*e*e%t,u=c*c*e%t,h=pG(u,r,t)*u%t,d=pG(h,r,t)*u%t,f=pG(d,mU,t)*c%t,p=pG(f,i,t)*f%t,g=pG(p,s,t)*p%t,m=pG(g,a,t)*g%t,y=pG(m,l,t)*m%t,b=pG(y,a,t)*g%t,w=pG(b,r,t)*u%t,v=pG(w,o,t)*p%t,E=pG(v,n,t)*c%t,A=pG(E,mU,t);if(!mH.eql(mH.sqr(A),e))throw Error("Cannot find square root");return A}let mH=p6(mB,void 0,void 0,{sqrt:m$}),mq=mD({a:mL,b:BigInt(7),Fp:mH,n:mM,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=mM,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-mF*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=mj(s*e,t),l=mj(-n*e,t),c=pK(e-a*r-l*i,t),u=pK(-a*n-l*s,t),h=c>o,d=u>o;if(h&&(c=t-c),d&&(u=t-u),c>o||u>o)throw Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:h,k1:c,k2neg:d,k2:u}}}},pa),mz={};function mV(e,...t){let r=mz[e];if(void 0===r){let t=sha256(Uint8Array.from(e,e=>e.charCodeAt(0)));r=concatBytes(t,t),mz[e]=r}return sha256(concatBytes(r,...t))}let mK=e=>e.toRawBytes(!0).slice(1),mG=e=>numberToBytesBE(e,32),mW=e=>mod(e,mB),mQ=e=>mod(e,mM),mJ=null,mZ=(e,t,r)=>mJ.BASE.multiplyAndAddUnsafe(e,t,r);function mY(e){aInRange("x",e,mF,mB);let t=mW(e*e),r=m$(mW(t*e+BigInt(7)));r%mU!==mL&&(r=mW(-r));let n=new mJ(e,r,mF);return n.assertValidity(),n}let mX=null;function m0(...e){return mQ(mX(mV("BIP0340/challenge",...e)))}function m1(e){return null!=e&&"function"==typeof e.then&&"function"==typeof e.catch&&"function"==typeof e.finally}let m2=33,m3=32;function m4(e,t){let r=nK.sha256.digest(t instanceof Uint8Array?t:t.subarray());if(m1(r))return r.then(({digest:t})=>mq.sign(t,e).toDERRawBytes()).catch(e=>{throw new g0(String(e))});try{return mq.sign(r.digest,e).toDERRawBytes()}catch(e){throw new g0(String(e))}}function m5(e,t,r){let n=nK.sha256.digest(r instanceof Uint8Array?r:r.subarray());if(m1(n))return n.then(({digest:r})=>mq.verify(t,r,e)).catch(e=>{throw new g1(String(e))});try{return mq.verify(t,n.digest,e)}catch(e){throw new g1(String(e))}}class m6{type="secp256k1";raw;_key;constructor(e){this._key=yn(e),this.raw=yt(this._key)}toMultihash(){return aq.identity.digest(yu(this))}toCID(){return rc.TO.createV1(114,this.toMultihash())}toString(){return d8.base58btc.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&rr(this.raw,e.raw)}verify(e,t){return m5(this._key,t,e)}}class m8{type="secp256k1";raw;publicKey;constructor(e,t){this.raw=yr(e),this.publicKey=new m6(t??yi(e))}equals(e){return null!=e&&e.raw instanceof Uint8Array&&rr(this.raw,e.raw)}sign(e){return m4(this.raw,e)}}function m7(e){return new m8(e)}function m9(e){return new m6(e)}async function ye(){return new m8(ys())}function yt(e){return mq.ProjectivePoint.fromHex(e).toRawBytes(!0)}function yr(e){try{return mq.getPublicKey(e,!0),e}catch(e){throw new uP(String(e))}}function yn(e){try{return mq.ProjectivePoint.fromHex(e),e}catch(e){throw new uT(String(e))}}function yi(e){try{return mq.getPublicKey(e,!0)}catch(e){throw new uP(String(e))}}function ys(){return mq.utils.randomPrivateKey()}async function yo(e,t){if("Ed25519"===e)return gY();if("secp256k1"===e)return ye();if("RSA"===e)return mm(yp(t));if("ECDSA"===e)return fm(yg(t));throw new uY}function ya(e,t){let{Type:r,Data:n}=E.decode(e),i=n??new Uint8Array;switch(r){case w.RSA:return mf(i,t);case w.Ed25519:return gZ(i);case w.secp256k1:return m9(i);case w.ECDSA:return fh(i);default:throw new uY}}function yl(e){if(e.byteLength===g$)return gZ(e);if(e.byteLength===m2)return m9(e);let t=dG(e),r=t[1]?.[0];if(r===dL||r===dF||r===dU)return fd(t);if(t[0]?.[0]===g4)return mp(t,e);throw new uC("Could not extract public key from raw bytes")}function yc(e){let{Type:t,Data:r}=E.decode(e.digest),n=r??new Uint8Array;switch(t){case w.Ed25519:return gZ(n);case w.secp256k1:return m9(n);case w.ECDSA:return fh(n);default:throw new uY}}function yu(e){return E.encode({Type:w[e.type],Data:e.raw})}function yh(e){let t=A.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case w.RSA:return mh(r);case w.Ed25519:return gJ(r);case w.secp256k1:return m7(r);case w.ECDSA:return fc(r);default:throw new uY}}function yd(e){if(e.byteLength===gH)return gJ(e);if(e.byteLength===m3)return m7(e);let t=dG(e),r=t[2]?.[0];if(r===dL||r===dF||r===dU)return fu(t);if(t.length>8)return md(t);throw new uC("Could not extract private key from raw bytes")}function yf(e){return A.encode({Type:w[e.type],Data:e.raw})}function yp(e){return null==e?2048:parseInt(e,10)}function yg(e){if("P-256"===e||null==e)return"P-256";if("P-384"===e)return"P-384";if("P-521"===e)return"P-521";throw new uC("Unsupported curve, should be P-256, P-384 or P-521")}async function ym(e){if("RSA"===e.type)return{privateKey:await crypto.subtle.importKey("jwk",e.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",e.publicKey.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])};if("ECDSA"===e.type)return{privateKey:await crypto.subtle.importKey("jwk",e.jwk,{name:"ECDSA",namedCurve:e.jwk.crv??"P-256"},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",e.publicKey.jwk,{name:"ECDSA",namedCurve:e.publicKey.jwk.crv??"P-256"},!0,["verify"])};throw new uC("Only RSA and ECDSA keys are supported")}let yy=Symbol.for("@libp2p/peer-id");function yb(e){return!!e?.[yy]}let yw=Symbol.for("nodejs.util.inspect.custom"),yv=114;class yE{type;multihash;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[yy]=!0;toString(){return null==this.string&&(this.string=d8.base58btc.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return rc.TO.createV1(yv,this.multihash)}toJSON(){return this.toString()}equals(e){if(null==e)return!1;if(e instanceof Uint8Array)return rr(this.multihash.bytes,e);if("string"==typeof e)return this.toString()===e;if(e?.toMultihash()?.bytes!=null)return rr(this.multihash.bytes,e.toMultihash().bytes);throw Error("not valid Id")}[yw](){return`PeerId(${this.toString()})`}}class yA extends yE{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class yx extends yE{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.publicKey}}class yS extends yE{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.publicKey}}let yk=2336;class y_{type="url";multihash;publicKey;url;constructor(e){this.url=e.toString(),this.multihash=aq.identity.digest((0,nm.s)(this.url))}[yw](){return`PeerId(${this.url})`}[yy]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return rc.TO.createV1(yk,this.toMultihash())}toJSON(){return this.toString()}equals(e){return null!=e&&(e instanceof Uint8Array&&(e=(0,uh.d)(e)),e.toString()===this.toString())}}let yI=114,yC=2336;function yT(e,t){let r;if("1"===e.charAt(0)||"Q"===e.charAt(0))r=aG.decode(d8.base58btc.decode(`z${e}`));else{if(e.startsWith("k51qzi5uqu5")||e.startsWith("kzwfwjn5ji4")||e.startsWith("k2k4r8")||e.startsWith("bafz"))return yN(rc.TO.parse(e));if(null==t)throw new uC('Please pass a multibase decoder for strings that do not start with "1" or "Q"');r=aG.decode(t.decode(e))}return yO(r)}function yP(e){if("Ed25519"===e.type)return new yx({multihash:e.toCID().multihash,publicKey:e});if("secp256k1"===e.type)return new yS({multihash:e.toCID().multihash,publicKey:e});if("RSA"===e.type)return new yA({multihash:e.toCID().multihash,publicKey:e});throw new uY}function yR(e){return yP(e.publicKey)}function yO(e){if(yB(e))return new yA({multihash:e});if(yD(e))try{let t=yc(e);if("Ed25519"===t.type)return new yx({multihash:e,publicKey:t});if("secp256k1"===t.type)return new yS({multihash:e,publicKey:t})}catch(t){return new y_(new URL((0,uh.d)(e.digest)))}throw new u$("Supplied PeerID Multihash is invalid")}function yN(e){if(e?.multihash==null||null==e.version||1===e.version&&e.code!==yI&&e.code!==yC)throw new uj("Supplied PeerID CID is invalid");return e.code===yC?new y_(new URL((0,uh.d)(e.multihash.digest))):yO(e.multihash)}function yD(e){return e.code===aq.identity.code}function yB(e){return e.code===nK.sha256.code}function yM(e,t){let r={[Symbol.iterator]:()=>r,next:()=>{let r=e.next(),n=r.value;return!0===r.done||null==n?{done:!0,value:void 0}:{done:!1,value:t(n)}}};return r}function yL(e){return yO(aG.decode(d8.base58btc.decode(`z${e}`)))}class yF{map;constructor(e){if(this.map=new Map,null!=e)for(let[t,r]of e.entries())this.map.set(t.toString(),{key:t,value:r})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return yM(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,r)=>{e(t.value,t.key,this)})}get(e){return this.map.get(e.toString())?.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return yM(this.map.values(),e=>e.key)}values(){return yM(this.map.values(),e=>e.value)}get size(){return this.map.size}}class yU extends yF{metric;constructor(e){super();let{name:t,metrics:r}=e;this.metric=r.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){let t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function yj(e){let t,{name:r,metrics:n}=e;return null!=n?new yU({name:r,metrics:n}):new yF}class y${full;pendingBytes;wantlist;blocks;blockPresences;constructor(e=!1,t=0){this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}addWantlistEntry(e,t){let r=a_.base64.encode(e.multihash.bytes);this.wantlist.set(r,t)}addBlockPresence(e,t){let r=a_.base64.encode(e.multihash.bytes);this.blockPresences.set(r,t)}addBlock(e,t){let r=a_.base64.encode(e.multihash.bytes);this.blocks.set(r,t)}}let yH=function(e){let t=new Uint8Array(e.reduce((e,t)=>e+rY(t),0)),r=0;for(let n of e)t=r3(n,t,r),r+=rY(n);return t};function yq(e){return yH([e.version,e.code,e.multihash.code,e.multihash.digest.byteLength])}class yz{peerId;blockstore;network;wants;exchangeCount;bytesSent;bytesReceived;lastExchange;maxSizeReplaceHasWithBlock;log;constructor(e,t){this.peerId=e.peerId,this.blockstore=e.blockstore,this.network=e.network,this.wants=new Map,this.log=e.logger.forComponent(`helia:bitswap:ledger:${e.peerId}`),this.exchangeCount=0,this.bytesSent=0,this.bytesReceived=0,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock??dy}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesReceived+=e}debtRatio(){return this.bytesSent/(this.bytesReceived+1)}async sendBlocksToPeer(e){let t=new y$,r=new Set;for(let[n,i]of this.wants.entries())try{let s=await this.blockstore.get(i.cid,e);i.wantType===u.WantHave?s.byteLength<this.maxSizeReplaceHasWithBlock?(this.log("sending have and block for %c",i.cid),r.add(n),t.addBlock(i.cid,{data:s,prefix:yq(i.cid)})):(this.log("sending have for %c",i.cid),t.addBlockPresence(i.cid,{cid:i.cid.bytes,type:g.HaveBlock})):(this.log("sending block for %c",i.cid),r.add(n),t.addBlock(i.cid,{data:s,prefix:yq(i.cid)}))}catch(e){if("NotFoundError"!==e.name)throw e;if(this.log("do not have block for %c",i.cid),!i.sendDontHave||!0===i.sentDoNotHave)continue;i.sentDoNotHave=!0,t.addBlockPresence(i.cid,{cid:i.cid.bytes,type:g.DoNotHaveBlock})}if(t.blocks.size>0||t.blockPresences.size>0)for(let n of(this.log("sending message"),await this.network.sendMessage(this.peerId,t,e),this.log("sent message"),this.sentBytes([...t.blocks.values()].reduce((e,t)=>e+t.data.byteLength,0)),r))this.wants.delete(n)}}class yV{blockstore;network;ledgerMap;maxSizeReplaceHasWithBlock;log;logger;constructor(e,t={}){this.blockstore=e.blockstore,this.network=e.network,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock,this.log=e.logger.forComponent("helia:bitswap:peer-want-lists"),this.logger=e.logger,this.ledgerMap=yj({name:"helia_bitswap_ledger_map",metrics:e.metrics}),this.network.addEventListener("bitswap:message",e=>{this.receiveMessage(e.detail.peer,e.detail.message).catch(t=>{this.log.error("error receiving bitswap message from %p",e.detail.peer,t)})}),this.network.addEventListener("peer:disconnected",e=>{this.peerDisconnected(e.detail)})}ledgerForPeer(e){let t=this.ledgerMap.get(e);if(null!=t)return{peer:t.peerId,value:t.debtRatio(),sent:t.bytesSent,received:t.bytesReceived,exchanged:t.exchangeCount}}wantListForPeer(e){let t=this.ledgerMap.get(e);if(null!=t)return[...t.wants.values()]}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.peerId)}async receiveMessage(e,t){let r=this.ledgerMap.get(e);if(null==r&&(r=new yz({peerId:e,blockstore:this.blockstore,network:this.network,logger:this.logger},{maxSizeReplaceHasWithBlock:this.maxSizeReplaceHasWithBlock}),this.ledgerMap.set(e,r)),r.receivedBytes(t.blocks?.reduce((e,t)=>e+t.data.byteLength,0)??0),null!=t.wantlist)for(let n of(!0===t.wantlist.full&&r.wants.clear(),t.wantlist.entries)){let t=rc.TO.decode(n.cid),i=(0,uh.d)(t.multihash.bytes,"base64");!0===n.cancel?(this.log("peer %p cancelled want of block for %c",e,t),r.wants.delete(i)):(n.wantType===u.WantHave?this.log("peer %p wanted block presence for %c",e,t):this.log("peer %p wanted block for %c",e,t),r.wants.set(i,{cid:t,priority:n.priority,wantType:n.wantType??u.WantBlock,sendDontHave:n.sendDontHave??!1}))}this.log("send blocks to peer"),await r.sendBlocksToPeer()}async receivedBlock(e,t){let r=(0,uh.d)(e.multihash.bytes,"base64"),n=[];for(let e of this.ledgerMap.values())e.wants.has(r)&&n.push(e);await Promise.all(n.map(async e=>e.sendBlocksToPeer(t)))}peerDisconnected(e){this.ledgerMap.delete(e)}}let yK=1,yG=5;class yW extends uS{initialPeerSearchComplete;requests;name;log;logger;minProviders;maxProviders;providers;evictionFilter;initialProviders;constructor(e,t){super(),this.name=t.name,this.logger=e.logger,this.log=e.logger.forComponent(this.name),this.requests=new Map,this.minProviders=t.minProviders??yK,this.maxProviders=t.maxProviders??yG,this.providers=[],this.evictionFilter=cQ(this.maxProviders),this.initialProviders=t.providers??[]}async retrieve(e,t={}){let r=a_.base64.encode(e.multihash.bytes),n=this.requests.get(r);if(null!=n)return this.log("join existing request for %c",e),n;let i=(0,a9.A)();if(this.requests.set(r,i.promise),0===this.providers.length){let r=!1;null==this.initialPeerSearchComplete&&(r=!0,this.log=this.logger.forComponent(`${this.name}:${e}`),this.initialPeerSearchComplete=this.findProviders(e,this.minProviders,t)),await this.initialPeerSearchComplete,r&&this.log("found initial session peers for %c",e)}let s=!1,o=new u8({concurrency:this.maxProviders});o.addEventListener("error",()=>{}),o.addEventListener("failure",e=>{this.log.error("error querying provider %o, evicting from session",e.detail.job.options.provider,e.detail.error),this.evict(e.detail.job.options.provider)}),o.addEventListener("success",e=>{s=!0,i.resolve(e.detail.result)}),o.addEventListener("idle",()=>{if(s||t.signal?.aborted===!0)return void this.log.trace("session idle, found block");Promise.resolve().then(async()=>{this.log("no session peers had block for for %c, finding new providers",e);for(let e=0;e<this.minProviders&&0!==this.providers.length;e++){let e=this.providers[Math.floor(Math.random()*this.providers.length)];this.evict(e)}await this.findProviders(e,this.minProviders,t),this.log("found new providers re-retrieving %c",e),this.requests.delete(r),i.resolve(await this.retrieve(e,t))}).catch(t=>{this.log.error("could not find new providers for %c",e,t),i.reject(t)})});let a=r=>{o.add(async()=>this.queryProvider(e,r.detail,t),{provider:r.detail}).catch(r=>{t.signal?.aborted!==!0&&this.log.error("error retrieving session block for %c",e,r)})};this.addEventListener("provider",a),Promise.all([...this.providers].map(async r=>o.add(async()=>this.queryProvider(e,r,t),{provider:r}))).catch(r=>{t.signal?.aborted!==!0&&this.log.error("error retrieving session block for %c",e,r)});let l=()=>{i.reject(new uk(t.signal?.reason??"Session aborted")),o.abort()};t.signal?.addEventListener("abort",l);try{return await i.promise}finally{this.removeEventListener("provider",a),t.signal?.removeEventListener("abort",l),o.clear(),this.requests.delete(r)}}evict(e){this.evictionFilter.add(this.toEvictionKey(e));let t=this.providers.findIndex(t=>this.equals(t,e));-1!==t&&this.providers.splice(t,1)}isEvicted(e){return this.evictionFilter.has(this.toEvictionKey(e))}hasProvider(e){return!!(null!=this.providers.find(t=>this.equals(t,e))||this.isEvicted(e))}async findProviders(e,t,r){let n=(0,a9.A)(),i=0;return Promise.resolve().then(async()=>{if(this.log("finding %d-%d new provider(s) for %c",t,this.maxProviders,e),this.initialProviders.length>0)for(;i<t&&this.initialProviders.length>0;){let e=this.initialProviders.pop();if(null==e)break;let s=await this.convertToProvider(e,r);if(r.signal?.aborted===!0)break;if(!(null==s||this.hasProvider(s))&&(this.log("found %d/%d new providers",i,this.maxProviders),this.providers.push(s),this.safeDispatchEvent("provider",{detail:s}),++i===t&&(this.log("session is ready"),n.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",i);break}}if(i<this.maxProviders)for await(let s of this.findNewProviders(e,r)){if(i===this.maxProviders||r.signal?.aborted===!0)break;if(!this.hasProvider(s)&&(this.log("found %d/%d new providers",i,this.maxProviders),this.providers.push(s),this.safeDispatchEvent("provider",{detail:s}),++i===t&&(this.log("session is ready"),n.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",i);break}}if(this.log("found %d/%d new session peers",i,this.maxProviders),i<t)throw new hp(`Found ${i} of ${t} ${this.name} providers for ${e}`)}).catch(t=>{this.log.error("error searching routing for potential session peers for %c",e,t.errors??t),n.reject(t)}),n.promise}}class yQ extends yW{wantList;network;libp2p;constructor(e,t){super(e,{...t,name:"helia:bitswap:session"}),this.wantList=e.wantList,this.network=e.network,this.libp2p=e.libp2p}async queryProvider(e,t,r){this.log("sending WANT-BLOCK for %c to %p",e,t);let n=await this.wantList.wantSessionBlock(e,t,r);if(this.log("%p %s %c",t,n.has?"has":"does not have",e),n.has&&null!=n.block)return n.block;throw Error("Provider did not have block")}async *findNewProviders(e,t={}){for await(let r of this.network.findProviders(e,t))yield r.id}toEvictionKey(e){return e.toMultihash().bytes}equals(e,t){return e.equals(t)}async convertToProvider(e,t){return yb(e)?e:(await this.libp2p.dial(e,t)).remotePeer}}function yJ(e,t){return new yQ(e,t)}class yZ{blocksReceived;duplicateBlocksReceived;dataReceived;duplicateDataReceived;constructor(e){this.blocksReceived=e.metrics?.registerMetricGroup("helia_bitswap_received_blocks"),this.duplicateBlocksReceived=e.metrics?.registerMetricGroup("helia_bitswap_duplicate_received_blocks"),this.dataReceived=e.metrics?.registerMetricGroup("helia_bitswap_data_received_bytes"),this.duplicateDataReceived=e.metrics?.registerMetricGroup("helia_bitswap_duplicate_data_received_bytes")}updateBlocksReceived(e=1,t){let r={global:e};null!=t&&(r[t.toString()]=e),this.blocksReceived?.increment(r)}updateDuplicateBlocksReceived(e=1,t){let r={global:e};null!=t&&(r[t.toString()]=e),this.duplicateBlocksReceived?.increment(r)}updateDataReceived(e,t){let r={global:e};null!=t&&(r[t.toString()]=e),this.dataReceived?.increment(r)}updateDuplicateDataReceived(e,t){let r={global:e};null!=t&&(r[t.toString()]=e),this.duplicateDataReceived?.increment(r)}}class yY extends Map{metric;constructor(e){super();let{name:t,metrics:r}=e;this.metric=r.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){let t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function yX(e){let t,{name:r,metrics:n}=e;return null!=n?new yY({name:r,metrics:n}):new Map}let y0=function(e){if(!(e instanceof Uint8Array))throw Error("arg needs to be a Uint8Array");let t=[];for(;e.length>0;){let r=r4(e);t.push(r),e=e.slice(rY(r))}return t};class y1 extends uS{peers;wants;network;log;sendMessagesDelay;sendMessagesTimeout;hashLoader;sendingMessages;constructor(e,t={}){super(),this.peers=yj({name:"helia_bitswap_peers",metrics:e.metrics}),this.wants=yX({name:"helia_bitswap_wantlist",metrics:e.metrics}),this.network=e.network,this.sendMessagesDelay=t.sendMessagesDelay??dE,this.log=e.logger.forComponent("helia:bitswap:wantlist"),this.hashLoader=t.hashLoader,this.network.addEventListener("bitswap:message",e=>{this.receiveMessage(e.detail.peer,e.detail.message).catch(t=>{this.log.error("error receiving bitswap message from %p",e.detail.peer,t)})}),this.network.addEventListener("peer:connected",e=>{this.peerConnected(e.detail).catch(t=>{this.log.error("error processing newly connected bitswap peer %p",e.detail,t)})}),this.network.addEventListener("peer:disconnected",e=>{this.peerDisconnected(e.detail)})}async addEntry(e,t){let r=(0,uh.d)(e.multihash.bytes,"base64"),n=this.wants.get(r);null==n&&(n={cid:e,priority:t.priority??1,wantType:t.wantType??u.WantBlock,cancel:!1,sendDontHave:!0},this.wants.set(r,n)),n.wantType===u.WantHave&&t.wantType===u.WantBlock&&(n.wantType=u.WantBlock),await this.sendMessagesDebounced();try{if(t.wantType===u.WantBlock)return(await u0(this,"block",t?.signal,{filter:t=>rr(e.multihash.digest,t.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail;return(await u0(this,"presence",t?.signal,{filter:t=>rr(e.multihash.digest,t.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail}finally{t.signal?.aborted===!0&&(this.log("want for %c was aborted, cancelling want",e),n.cancel=!0,await this.sendMessagesDebounced())}}async sendMessagesDebounced(){await this.sendingMessages?.promise,clearTimeout(this.sendMessagesTimeout),this.sendMessagesTimeout=setTimeout(()=>{this.sendMessages().catch(e=>{this.log("error sending messages to peers",e)})},this.sendMessagesDelay)}async sendMessages(){for(let[e,t]of(this.sendingMessages=(0,a9.A)(),await Promise.all([...this.peers.entries()].map(async([e,t])=>{let r=new Set,n=new y$;for(let[e,i]of this.wants.entries())t.has(e)||i.cancel||(r.add(e),n.addWantlistEntry(i.cid,{cid:i.cid.bytes,priority:i.priority,wantType:i.wantType,cancel:i.cancel,sendDontHave:i.sendDontHave}));if(0!==n.wantlist.size)try{for(let i of(await this.network.sendMessage(e,n),r))t.add(i)}catch(e){this.log.error("error sending full wantlist to new peer",e)}})).catch(e=>{this.log.error("error sending messages",e)}),this.wants))if(t.cancel)for(let t of(this.wants.delete(e),this.peers.values()))t.delete(e);this.sendingMessages.resolve()}has(e){let t=(0,uh.d)(e.multihash.bytes,"base64");return this.wants.has(t)}async wantSessionPresence(e,t,r={}){let n=new y$;return n.addWantlistEntry(e,{cid:e.bytes,sendDontHave:!0,wantType:u.WantHave,priority:1}),await this.network.sendMessage(t,n),(await u0(this,"presence",r.signal,{filter:r=>t.equals(r.detail.sender)&&rr(e.multihash.digest,r.detail.cid.multihash.digest)})).detail}async wantBlock(e,t={}){return this.addEntry(e,{...t,wantType:u.WantBlock})}async wantSessionBlock(e,t,r={}){let n=new y$;return n.addWantlistEntry(e,{cid:e.bytes,sendDontHave:!0,wantType:u.WantBlock,priority:1}),await this.network.sendMessage(t,n),(await u0(this,"presence",r.signal,{filter:r=>t.equals(r.detail.sender)&&rr(e.multihash.digest,r.detail.cid.multihash.digest)})).detail}async receivedBlock(e,t){let r=(0,uh.d)(e.multihash.bytes,"base64"),n=this.wants.get(r);null!=n&&(n.cancel=!0,await this.sendMessagesDebounced())}async receiveMessage(e,t){this.log("received message from %p with %d blocks",e,t.blocks.length);let r=!1;for(let n of t.blocks){if(null==n.prefix||null==n.data)continue;let t=y0(n.prefix),i=t[0],s=t[1],o=t[2],a=o===nK.sha256.code?nK.sha256:await this.hashLoader?.getHasher(o);if(null==a){this.log.error("unknown hash algorithm",o);continue}let l=a.digest(n.data);null!=l.then&&(l=await l);let c=rc.TO.create(+(0!==i),s,l);this.log("received block from %p for %c",e,c),this.safeDispatchEvent("block",{detail:{sender:e,cid:c,block:n.data}}),this.safeDispatchEvent("presence",{detail:{sender:e,cid:c,has:!0,block:n.data}});let u=(0,uh.d)(c.multihash.bytes,"base64"),h=this.wants.get(u);null!=h&&(h.cancel=!0,r=!0)}for(let{cid:r,type:n}of t.blockPresences){let t=rc.TO.decode(r);this.log("received %s from %p for %c",n,e,t),this.safeDispatchEvent("presence",{detail:{sender:e,cid:t,has:n===g.HaveBlock}})}r&&await this.sendMessagesDebounced()}async peerConnected(e){let t=new Set,r=new y$(!0);for(let[e,n]of this.wants.entries())n.cancel||(t.add(e),r.addWantlistEntry(n.cid,{cid:n.cid.bytes,priority:1,wantType:u.WantBlock,cancel:!1,sendDontHave:!1}));if(0===r.wantlist.size)return void this.peers.set(e,t);try{await this.network.sendMessage(e,r),this.peers.set(e,t)}catch(t){this.log.error("error sending full wantlist to new peer %p",e,t)}}peerDisconnected(e){this.peers.delete(e)}start(){}stop(){this.peers.clear(),clearTimeout(this.sendMessagesTimeout)}}class y2{log;logger;stats;network;blockstore;peerWantLists;wantList;libp2p;constructor(e,t={}){this.logger=e.logger,this.log=e.logger.forComponent("helia:bitswap"),this.blockstore=e.blockstore,this.libp2p=e.libp2p,this.stats=new yZ(e),this.network=new dM(e,t),this.peerWantLists=new yV({...e,network:this.network},t),this.wantList=new y1({...e,network:this.network},t)}createSession(e={}){return yJ({wantList:this.wantList,network:this.network,logger:this.logger,libp2p:this.libp2p},e)}async want(e,t={}){let r=new AbortController,n=hQ([r.signal,t.signal]);r.signal,this.network.findAndConnect(e,{...t,signal:n}).catch(t=>{r.signal.aborted||this.log.error("error during finding and connect for cid %c",e,t)});try{return(await this.wantList.wantBlock(e,{...t,signal:n})).block}finally{r.abort(),n.clear()}}async notify(e,t,r={}){await Promise.all([this.peerWantLists.receivedBlock(e,r),this.wantList.receivedBlock(e,r)])}getWantlist(){return[...this.wantList.wants.values()].filter(e=>!e.cancel).map(e=>({cid:e.cid,priority:e.priority,wantType:e.wantType}))}getPeerWantlist(e){return this.peerWantLists.wantListForPeer(e)}async start(){this.wantList.start(),await this.network.start()}async stop(){this.wantList.stop(),await this.network.stop()}}let y3=(e,t={})=>new y2(e,t);class y4{bitswap;started;constructor(e,t={}){let{getHasher:r}=e;this.bitswap=y3(e,{hashLoader:{getHasher:async e=>r(e)},...t}),this.started=!1}isStarted(){return this.started}async start(){await this.bitswap.start(),this.started=!0}async stop(){await this.bitswap.stop(),this.started=!1}async announce(e,t,r){await this.bitswap.notify(e,t,r)}async retrieve(e,t={}){return this.bitswap.want(e,t)}createSession(e){let t=this.bitswap.createSession(e);return{announce:async(e,t,r)=>{await this.bitswap.notify(e,t,r)},retrieve:async(e,r)=>t.retrieve(e,r)}}}function y5(e={}){return t=>new y4(t,e)}class y6{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){let t=this.index,r=e();return void 0===r&&(this.index=t),r}parseWith(e){let t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{let t=this.readChar();if(t===e)return t})}readSeparator(e,t,r){return this.readAtomically(()=>{if(!(t>0)||void 0!==this.readGivenChar(e))return r()})}readNumber(e,t,r,n){return this.readAtomically(()=>{let i=0,s=0,o=this.peekChar();if(void 0===o)return;let a="0"===o,l=2**(8*n)-1;for(;;){let r=this.readAtomically(()=>{let t=this.readChar();if(void 0===t)return;let r=Number.parseInt(t,e);if(!Number.isNaN(r))return r});if(void 0===r)break;if(i*=e,(i+=r)>l||(s+=1,void 0!==t&&s>t))return}return 0===s||!r&&a&&s>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{let e=new Uint8Array(4);for(let t=0;t<e.length;t++){let r=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(void 0===r)return;e[t]=r}return e})}readIPv6Addr(){let e=e=>{for(let t=0;t<e.length/2;t++){let r=2*t;if(t<e.length-3){let n=this.readSeparator(":",t,()=>this.readIPv4Addr());if(void 0!==n)return e[r]=n[0],e[r+1]=n[1],e[r+2]=n[2],e[r+3]=n[3],[r+4,!0]}let n=this.readSeparator(":",t,()=>this.readNumber(16,4,!0,2));if(void 0===n)return[r,!1];e[r]=n>>8,e[r+1]=255&n}return[e.length,!1]};return this.readAtomically(()=>{let t=new Uint8Array(16),[r,n]=e(t);if(16===r)return t;if(n||void 0===this.readGivenChar(":")||void 0===this.readGivenChar(":"))return;let i=new Uint8Array(14),s=16-(r+2),[o]=e(i.subarray(0,s));return t.set(i.subarray(0,o),16-o),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}let y8=45,y7=15,y9=new y6;function be(e){if(!(e.length>y7))return y9.new(e).parseWith(()=>y9.readIPv4Addr())}function bt(e){if(e.includes("%")&&(e=e.split("%")[0]),!(e.length>y8))return y9.new(e).parseWith(()=>y9.readIPv6Addr())}function br(e,t=!1){if(e.includes("%")&&(e=e.split("%")[0]),e.length>y8)return;let r=y9.new(e).parseWith(()=>y9.readIPAddr());if(r)return t&&4===r.length?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,r[0],r[1],r[2],r[3]]):r}function bn(e,t,r){let n=0;for(let i of e)if(!(n<t)){if(n>r)break;if(255!==i)return!1;n++}return!0}function bi(e,t,r,n){let i=0;for(let s of e)if(!(i<r)){if(i>n)break;if(s!==t[i])return!1;i++}return!0}function bs(e){switch(e.length){case bl:return e.join(".");case bc:{let t=[];for(let r=0;r<e.length;r++)r%2==0&&t.push(e[r].toString(16).padStart(2,"0")+e[r+1].toString(16).padStart(2,"0"));return t.join(":")}default:throw Error("Invalid ip length")}}function bo(e){let t=0;for(let[r,n]of e.entries()){if(255===n){t+=8;continue}for(;(128&n)!=0;)t++,n<<=1;if((128&n)!=0)return -1;for(let t=r+1;t<e.length;t++)if(0!=e[t])return -1;break}return t}function ba(e){let t="0x";for(let r of e)t+=(r>>4).toString(16)+(15&r).toString(16);return t}let bl=4,bc=16;parseInt("0xFFFF",16);let bu=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function bh(e,t){t.length===bc&&e.length===bl&&bn(t,0,11)&&(t=t.slice(12)),t.length===bl&&e.length===bc&&bi(e,bu,0,11)&&(e=e.slice(12));let r=e.length;if(r!=t.length)throw Error("Failed to mask ip");let n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=e[i]&t[i];return n}function bd(e,t){if("string"==typeof t&&(t=br(t)),null==t)throw Error("Invalid ip");if(t.length!==e.network.length)return!1;for(let r=0;r<t.length;r++)if((e.network[r]&e.mask[r])!=(t[r]&e.mask[r]))return!1;return!0}function bf(e){let[t,r]=e.split("/");if(!t||!r)throw Error("Failed to parse given CIDR: "+e);let n=bl,i=be(t);if(null==i&&(n=bc,null==(i=bt(t))))throw Error("Failed to parse given CIDR: "+e);let s=parseInt(r,10);if(Number.isNaN(s)||String(s).length!==r.length||s<0||s>8*n)throw Error("Failed to parse given CIDR: "+e);let o=bp(s,8*n);return{network:bh(i,o),mask:o}}function bp(e,t){if(t!==8*bl&&t!==8*bc||e<0||e>t)throw Error("Invalid CIDR mask");let r=t/8,n=new Uint8Array(r);for(let t=0;t<r;t++){if(e>=8){n[t]=255,e-=8;continue}n[t]=255-(255>>e),e=0}return n}class bg{constructor(e,t){if(null==t)({network:this.network,mask:this.mask}=bf(e));else{let r=br(e);if(null==r)throw Error("Failed to parse network");let n=parseInt(t=String(t),10);if(Number.isNaN(n)||String(n).length!==t.length||n<0||n>8*r.length){let e=br(t);if(null==e)throw Error("Failed to parse mask");this.mask=e}else this.mask=bp(n,8*r.length);this.network=bh(r,this.mask)}}contains(e){return bd({network:this.network,mask:this.mask},e)}toString(){let e=bo(this.mask),t=-1!==e?String(e):ba(this.mask);return bs(this.network)+"/"+t}}function bm(e,t){return new bg(e).contains(t)}var by=r(43716),bb=r(69600);function bw(e){return!!be(e)}function bv(e){return!!bt(e)}function bE(e){return!!br(e)}let bA=bw,bx=bv,bS=function(e){let t=0;if(bA(e=e.toString().trim())){let r=new Uint8Array(t+4);return e.split(/\./g).forEach(e=>{r[t++]=255&parseInt(e,10)}),r}if(bx(e)){let r,n=e.split(":",8);for(r=0;r<n.length;r++){let e;bA(n[r])&&(e=bS(n[r]),n[r]=(0,uh.d)(e.slice(0,2),"base16")),null!=e&&++r<8&&n.splice(r,0,(0,uh.d)(e.slice(2,4),"base16"))}if(""===n[0])for(;n.length<8;)n.unshift("0");else if(""===n[n.length-1])for(;n.length<8;)n.push("0");else if(n.length<8){for(r=0;r<n.length&&""!==n[r];r++);let e=[r,1];for(r=9-n.length;r>0;r--)e.push("0");n.splice.apply(n,e)}let i=new Uint8Array(t+16);for(r=0;r<n.length;r++){let e=parseInt(n[r],16);i[t++]=e>>8&255,i[t++]=255&e}return i}throw Error("invalid ip address")},bk=function(e,t=0,r){t=~~t,r=r??e.length-t;let n=new DataView(e.buffer);if(4===r){let n=[];for(let i=0;i<r;i++)n.push(e[t+i]);return n.join(".")}if(16===r){let e=[];for(let i=0;i<r;i+=2)e.push(n.getUint16(t+i).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},b_={},bI={};function bC(e,t,r,n,i){return{code:e,size:t,name:r,resolvable:!!n,path:!!i}}function bT(e){if("number"==typeof e){if(null!=bI[e])return bI[e];throw Error(`no protocol with code: ${e}`)}if("string"==typeof e){if(null!=b_[e])return b_[e];throw Error(`no protocol with name: ${e}`)}throw Error(`invalid protocol id type: ${typeof e}`)}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,-1,"http-path"],[777,-1,"memory"]].forEach(e=>{let t=bC(...e);bI[t.code]=t,b_[t.name]=t});let bP=bT("ip4"),bR=bT("ip6"),bO=bT("ipcidr");function bN(e,t){switch(bT(e).code){case 4:case 41:return bU(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return bq(t);case 43:return(0,uh.d)(t,"base10");case 6:case 273:case 33:case 132:return b$(t).toString();case 421:return bG(t);case 444:case 445:return bJ(t);case 466:return bK(t);case 481:return globalThis.encodeURIComponent(bq(t));default:return(0,uh.d)(t,"base16")}}function bD(e,t){switch(bT(e).code){case 4:case 41:return bF(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return bH(t);case 43:return(0,nm.s)(t,"base10");case 6:case 273:case 33:case 132:return bj(parseInt(t,10));case 421:return bz(t);case 444:return bW(t);case 445:return bQ(t);case 466:return bV(t);case 481:return bH(globalThis.decodeURIComponent(t));default:return(0,nm.s)(t,"base16")}}function bB(e){let t,r;if(e.stringTuples().forEach(([e,n])=>{(e===bP.code||e===bR.code)&&(r=n),e===bO.code&&(t=n)}),null==t||null==r)throw Error("Invalid multiaddr");return new bg(r,t)}let bM=Object.values(bb.Fo).map(e=>e.decoder),bL=function(){let e=bM[0].or(bM[1]);return bM.slice(2).forEach(t=>e=e.or(t)),e}();function bF(e){if(!bE(e))throw Error("invalid ip address");return bS(e)}function bU(e){let t=bk(e,0,e.length);if(null==t)throw Error("ipBuff is required");if(!bE(t))throw Error("invalid ip address");return t}function bj(e){let t=new ArrayBuffer(2);return new DataView(t).setUint16(0,e),new Uint8Array(t)}function b$(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function bH(e){let t=(0,nm.s)(e),r=Uint8Array.from(r3(t.length));return rt([r,t],r.length+t.length)}function bq(e){let t=r4(e);if((e=e.slice(rY(t))).length!==t)throw Error("inconsistent lengths");return(0,uh.d)(e)}function bz(e){let t;t="Q"===e[0]||"1"===e[0]?aG.decode(d8.base58btc.decode(`z${e}`)).bytes:rc.TO.parse(e).multihash.bytes;let r=Uint8Array.from(r3(t.length));return rt([r,t],r.length+t.length)}function bV(e){let t=bL.decode(e),r=Uint8Array.from(r3(t.length));return rt([r,t],r.length+t.length)}function bK(e){let t=r4(e),r=e.slice(rY(t));if(r.length!==t)throw Error("inconsistent lengths");return"u"+(0,uh.d)(r,"base64url")}function bG(e){let t=r4(e),r=e.slice(rY(t));if(r.length!==t)throw Error("inconsistent lengths");return(0,uh.d)(r,"base58btc")}function bW(e){let t=e.split(":");if(2!==t.length)throw Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(16!==t[0].length)throw Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);let r=by.base32.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw Error("Port number is not in range(1, 65536)");let i=bj(n);return rt([r,i],r.length+i.length)}function bQ(e){let t=e.split(":");if(2!==t.length)throw Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(56!==t[0].length)throw Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);let r=by.base32.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw Error("Port number is not in range(1, 65536)");let i=bj(n);return rt([r,i],r.length+i.length)}function bJ(e){let t=e.slice(0,e.length-2),r=e.slice(e.length-2),n=(0,uh.d)(t,"base32"),i=b$(r);return`${n}:${i}`}function bZ(e){e=b2(e);let t=[],r=[],n=null,i=e.split("/").slice(1);if(1===i.length&&""===i[0])return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let s=0;s<i.length;s++){let o=bT(i[s]);if(0===o.size){t.push([o.code]),r.push([o.code]);continue}if(++s>=i.length)throw new b3("invalid address: "+e);if(!0===o.path){n=b2(i.slice(s).join("/")),t.push([o.code,bD(o.code,n)]),r.push([o.code,n]);break}let a=bD(o.code,i[s]);t.push([o.code,a]),r.push([o.code,bN(o.code,a)])}return{string:bX(r),bytes:b0(t),tuples:t,stringTuples:r,path:n}}function bY(e){let t=[],r=[],n=null,i=0;for(;i<e.length;){let s=r4(e,i),o=rY(s),a=bT(s),l=b1(a,e.slice(i+o));if(0===l){t.push([s]),r.push([s]),i+=o;continue}let c=e.slice(i+o,i+o+l);if((i+=l+o)>e.length)throw new b3("Invalid address Uint8Array: "+(0,uh.d)(e,"base16"));t.push([s,c]);let u=bN(s,c);if(r.push([s,u]),!0===a.path){n=u;break}}return{bytes:Uint8Array.from(e),string:bX(r),tuples:t,stringTuples:r,path:n}}function bX(e){let t=[];return e.map(e=>{let r=bT(e[0]);return t.push(r.name),e.length>1&&null!=e[1]&&t.push(e[1]),null}),b2(t.join("/"))}function b0(e){return rt(e.map(e=>{let t=bT(e[0]),r=Uint8Array.from(r3(t.code));return e.length>1&&null!=e[1]&&(r=rt([r,e[1]])),r}))}function b1(e,t){if(e.size>0)return e.size/8;{if(0===e.size)return 0;let r=r4(t instanceof Uint8Array?t:Uint8Array.from(t));return r+rY(r)}}function b2(e){return"/"+e.trim().split("/").filter(e=>e).join("/")}class b3 extends Error{static name="ParseError";name="ParseError";constructor(e){super(`Error parsing address: ${e}`)}}let b4=Symbol.for("nodejs.util.inspect.custom"),b5=Symbol.for("@multiformats/js-multiaddr/multiaddr"),b6=[bT("dns").code,bT("dns4").code,bT("dns6").code,bT("dnsaddr").code];class b8 extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}}class b7{bytes;#T;#P;#R;#O;[b5]=!0;constructor(e){let t;if(null==e&&(e=""),e instanceof Uint8Array)t=bY(e);else if("string"==typeof e){if(e.length>0&&"/"!==e.charAt(0))throw Error(`multiaddr "${e}" must start with a "/"`);t=bZ(e)}else if(we(e))t=bY(e.bytes);else throw Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,this.#T=t.string,this.#P=t.tuples,this.#R=t.stringTuples,this.#O=t.path}toString(){return this.#T}toJSON(){return this.toString()}toOptions(){let e,t,r,n,i="",s=bT("tcp"),o=bT("udp"),a=bT("ip4"),l=bT("ip6"),c=bT("dns6"),u=bT("ip6zone");for(let[h,d]of this.stringTuples())h===u.code&&(i=`%${d??""}`),b6.includes(h)&&(t="tcp"===s.name?"tcp":"udp",n=443,r=`${d??""}${i}`,e=h===c.code?6:4),(h===s.code||h===o.code)&&(t="tcp"===bT(h).name?"tcp":"udp",n=parseInt(d??"")),(h===a.code||h===l.code)&&(t="tcp"===bT(h).name?"tcp":"udp",r=`${d??""}${i}`,e=h===l.code?6:4);if(null==e||null==t||null==r||null==n)throw Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:r,transport:t,port:n}}protos(){return this.#P.map(([e])=>Object.assign({},bT(e)))}protoCodes(){return this.#P.map(([e])=>e)}protoNames(){return this.#P.map(([e])=>bT(e).name)}tuples(){return this.#P.map(([e,t])=>null==t?[e]:[e,t])}stringTuples(){return this.#R.map(([e,t])=>null==t?[e]:[e,t])}encapsulate(e){return e=new b7(e),new b7(this.toString()+e.toString())}decapsulate(e){let t=e.toString(),r=this.toString(),n=r.lastIndexOf(t);if(n<0)throw Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new b7(r.slice(0,n))}decapsulateCode(e){let t=this.tuples();for(let r=t.length-1;r>=0;r--)if(t[r][0]===e)return new b7(b0(t.slice(0,r)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([t,r])=>{t===b_.p2p.code&&e.push([t,r]),t===b_["p2p-circuit"].code&&(e=[])});let t=e.pop();if(t?.[1]!=null){let e=t[1];if("Q"===e[0]||"1"===e[0])return(0,uh.d)(d8.base58btc.decode(`z${e}`),"base58btc");return(0,uh.d)(rc.TO.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){return this.#O}equals(e){return rr(this.bytes,e.bytes)}async resolve(e){let t=this.protos().find(e=>e.resolvable);if(null==t)return[this];let r=b9.get(t.name);if(null==r)throw new b8(`no available resolver for ${t.name}`);return(await r(this,e)).map(e=>wt(e))}nodeAddress(){let e=this.toOptions();if("tcp"!==e.transport&&"udp"!==e.transport)throw Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){let t=(e??this).protos();return 2===t.length&&(4===t[0].code||41===t[0].code)&&(6===t[1].code||273===t[1].code)}[b4](){return`Multiaddr(${this.#T})`}}let b9=new Map;function we(e){return!!e?.[b5]}function wt(e){return new b7(e)}let wr=[bT("tcp").code,bT("dns").code,bT("dnsaddr").code,bT("dns4").code,bT("dns6").code];function wn(e){return ws("sni",e)?.[1]}function wi(e){let t=ws("tcp",e)?.[1];return null==t?"":`:${t}`}function ws(e,t){let r;try{r=bT(e).code}catch(e){return}for(let[e,n]of t)if(e===r&&null!=n)return[e,n]}function wo(e){return e.some(([e,t])=>e===bT("tls").code)}function wa(e,t,r){let n=wl[bT(e).name];if(null==n)throw Error(`Can't interpret protocol ${bT(e).name}`);let i=n(t,r);return e===bT("ip6").code?`[${i}]`:i}let wl={ip4:(e,t)=>e,ip6:(e,t)=>0===t.length?e:`[${e}]`,tcp:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return`tcp://${wa(r[0],r[1]??"",t)}:${e}`},udp:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return`udp://${wa(r[0],r[1]??"",t)}:${e}`},dnsaddr:(e,t)=>e,dns4:(e,t)=>e,dns6:(e,t)=>e,dns:(e,t)=>e,ipfs:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return`${wa(r[0],r[1]??"",t)}`},p2p:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return`${wa(r[0],r[1]??"",t)}`},http:(e,t)=>{let r=wo(t),n=wn(t),i=wi(t);if(r&&null!=n)return`https://${n}${i}`;let s=r?"https://":"http://",o=t.pop();if(null==o)throw Error("Unexpected end of multiaddr");let a=wa(o[0],o[1]??"",t);return a=a.replace("tcp://",""),`${s}${a}`},"http-path":(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");let n=wa(r[0],r[1]??"",t),i=decodeURIComponent(e);return`${n}/${i}`},tls:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return wa(r[0],r[1]??"",t)},sni:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");return wa(r[0],r[1]??"",t)},https:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");let n=wa(r[0],r[1]??"",t);return n=n.replace("tcp://",""),`https://${n}`},ws:(e,t)=>{let r=wo(t),n=wn(t),i=wi(t);if(r&&null!=n)return`wss://${n}${i}`;let s=r?"wss://":"ws://",o=t.pop();if(null==o)throw Error("Unexpected end of multiaddr");let a=wa(o[0],o[1]??"",t);return a=a.replace("tcp://",""),`${s}${a}`},wss:(e,t)=>{let r=t.pop();if(null==r)throw Error("Unexpected end of multiaddr");let n=wa(r[0],r[1]??"",t);return n=n.replace("tcp://",""),`wss://${n}`}};function wc(e,t){let r=wt(e).stringTuples(),n=r.pop();if(null==n)throw Error("Unexpected end of multiaddr");let i=bT(n[0]),s=wl[i.name];if(null==s)throw Error(`No interpreter found for ${i.name}`);let o=s(n[1]??"",r);return t?.assumeHttp!==!1&&wr.includes(n[0])&&(o=o.replace(/^.*:\/\//,""),o="443"===n[1]?`https://${o}`:`http://${o}`),(o.startsWith("http://")||o.startsWith("https://")||o.startsWith("ws://")||o.startsWith("wss://"))&&(o=new URL(o).toString()).endsWith("/")&&(o=o.substring(0,o.length-1)),o}class wu{url;#N=0;#D=0;#B=0;#M=0;#L=new Map;log;transformRequestInit;constructor(e,{logger:t,transformRequestInit:r}){this.url=e instanceof URL?e:new URL(e),this.transformRequestInit=r,this.log=t.forComponent(`helia:trustless-gateway-block-broker:${this.url.hostname}`)}#F(e){let t=e.multihash.bytes;return a_.base64.encode(t)}async getRawBlock(e,t){let r=new URL(this.url.toString());if(r.pathname=`/ipfs/${e.toString()}`,r.search="?format=raw",t?.aborted===!0)throw Error(`Signal to fetch raw block for CID ${e} from gateway ${this.url} was aborted prior to fetch`);let n=this.#F(e),i=new AbortController,s=()=>{i.abort()};t?.addEventListener("abort",s);try{let t=this.#L.get(n);if(null==t){this.#N++;let s={signal:i.signal,headers:{Accept:"application/vnd.ipld.raw"},cache:"force-cache"},o=null!=this.transformRequestInit?await this.transformRequestInit(s):s;t=fetch(r.toString(),o).then(async t=>{if(this.log("GET %s %d",r,t.status),!t.ok)throw this.#D++,Error(`unable to fetch raw block for CID ${e} from gateway ${this.url}`);return this.#M++,new Uint8Array(await t.arrayBuffer())}),this.#L.set(n,t)}return await t}catch(r){if(t?.aborted===!0)throw Error(`fetching raw block for CID ${e} from gateway ${this.url} was aborted`);throw this.#D++,Error(`unable to fetch raw block for CID ${e}`)}finally{t?.removeEventListener("abort",s),this.#L.delete(n)}}reliability(){return 0===this.#N?1:this.#B>0?-1/0:this.#M/(this.#N+3*this.#D)}incrementInvalidBlocks(){this.#B++}getStats(){return{attempts:this.#N,errors:this.#D,invalidBlocks:this.#B,successes:this.#M,pendingResponses:this.#L.size}}}var wh=r(73002);let wd=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"].map(e=>new wh.Netmask(e));function wf(e){for(let t of wd)if(t.contains(e))return!0;return!1}function wp(e){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(e)}function wg(e){let t=e.split(":");if(t.length<2)return!1;let r=t[t.length-1].padStart(4,"0"),n=t[t.length-2].padStart(4,"0");return wf(`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(r.substring(0,2),16)}.${parseInt(r.substring(2),16)}`)}function wm(e){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)}function wy(e){let t=e.split(":");return wf(t[t.length-1])}function wb(e){return/^::$/.test(e)||/^::1$/.test(e)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(e)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(e)||/^ff([0-9a-fA-F]{2,2}):/i.test(e)}function ww(e){return bw(e)?wf(e):wp(e)?wg(e):wm(e)?wy(e):bv(e)?wb(e):void 0}let wv=e=>e.toString().split("/").slice(1),wE=e=>({match:t=>!(t.length<1)&&!!e(t[0])&&t.slice(1),pattern:"fn"}),wA=e=>({match:t=>wE(t=>t===e).match(t),pattern:e}),wx=()=>({match:e=>wE(e=>"string"==typeof e).match(e),pattern:"{string}"}),wS=()=>({match:e=>wE(e=>!isNaN(parseInt(e))).match(e),pattern:"{number}"}),wk=()=>({match:e=>{if(e.length<2||"p2p"!==e[0]&&"ipfs"!==e[0]||!(e[1].startsWith("Q")||e[1].startsWith("1")))return!1;try{d8.base58btc.decode(`z${e[1]}`)}catch(e){return!1}return e.slice(2)},pattern:"/p2p/{peerid}"}),w_=()=>({match:e=>{if(e.length<2||"certhash"!==e[0])return!1;try{a_.base64url.decode(e[1])}catch{return!1}return e.slice(2)},pattern:"/certhash/{certhash}"}),wI=e=>({match:t=>{let r=e.match(t);return!1===r?t:r},pattern:`optional(${e.pattern})`}),wC=(...e)=>({match:t=>{let r;for(let n of e){let e=n.match(t);!1!==e&&(null==r||e.length<r.length)&&(r=e)}return null!=r&&r},pattern:`or(${e.map(e=>e.pattern).join(", ")})`}),wT=(...e)=>({match:t=>{for(let r of e){let e=r.match(t);if(!1===e)return!1;t=e}return t},pattern:`and(${e.map(e=>e.pattern).join(", ")})`});function wP(...e){function t(t){let r=wv(t);for(let t of e){let e=t.match(r);if(!1===e)return!1;r=e}return r}return{matchers:e,matches:function(e){return!1!==t(e)},exactMatch:function(e){let r=t(e);return!1!==r&&0===r.length}}}let wR=wP(wk()),wO=wT(wA("dns4"),wx()),wN=wT(wA("dns6"),wx()),wD=wT(wA("dnsaddr"),wx()),wB=wT(wA("dns"),wx());wP(wO,wI(wk())),wP(wN,wI(wk())),wP(wD,wI(wk()));let wM=wP(wC(wB,wD,wO,wN),wI(wk())),wL=wT(wA("ip4"),wE(bw)),wF=wT(wA("ip6"),wE(bv)),wU=wC(wL,wF),wj=wC(wU,wB,wO,wN,wD),w$=wP(wC(wU,wT(wC(wB,wD,wO,wN),wI(wk())))),wH=wP(wL),wq=wP(wF),wz=wP(wU),wV=wT(wj,wA("tcp"),wS()),wK=wT(wj,wA("udp"),wS()),wG=wP(wT(wV,wI(wk())));wP(wK);let wW=wT(wK,wA("quic"),wI(wk())),wQ=wT(wK,wA("quic-v1"),wI(wk())),wJ=wC(wW,wQ);wP(wW);let wZ=wP(wQ),wY=wC(wj,wV,wK,wW,wQ),wX=wC(wT(wY,wA("ws"),wI(wk()))),w0=wP(wX),w1=wC(wT(wY,wA("wss"),wI(wk())),wT(wY,wA("tls"),wI(wT(wA("sni"),wx())),wA("ws"),wI(wk()))),w2=wP(w1),w3=wT(wK,wA("webrtc-direct"),wI(w_()),wI(w_()),wI(wk())),w4=wP(w3),w5=wT(wQ,wA("webtransport"),wI(w_()),wI(w_()),wI(wk())),w6=wP(w5),w8=wC(wX,w1,wT(wV,wI(wk())),wT(wJ,wI(wk())),wT(wj,wI(wk())),w3,w5,wk()),w7=wP(w8),w9=wP(wT(w8,wA("p2p-circuit"),wk())),ve=wP(wC(wT(w8,wA("p2p-circuit"),wA("webrtc"),wI(wk())),wT(w8,wA("webrtc"),wI(wk())),wT(wA("webrtc"),wI(wk())))),vt=wP(wC(wT(wj,wA("tcp"),wS(),wA("http"),wI(wk())),wT(wj,wA("http"),wI(wk())))),vr=wP(wC(wT(wj,wA("tcp"),wC(wT(wA("443"),wA("http")),wT(wS(),wA("https")),wT(wS(),wA("tls"),wA("http"))),wI(wk())),wT(wj,wA("tls"),wA("http"),wI(wk())),wT(wj,wA("https"),wI(wk()))));function vn(e,t,r){return e.filter(e=>{if(vr.matches(e)||t&&vt.matches(e))return!!(r||wM.matches(e))||!1===ww(e.toOptions().host);if(!t&&r){let{host:t}=e.toOptions();if("127.0.0.1"===t||"localhost"===t||t.endsWith(".localhost"))return!0}return!1})}async function*vi(e,t,r,n,i,s={}){for await(let o of t.findProviders(e,s)){let e=vn(o.multiaddrs,n,i);if(0===e.length)continue;let t=wc(e[0]);yield new wu(t,{logger:r,transformRequestInit:s.transformRequestInit})}}wP(wC(wT(wA("memory"),wx(),wI(wk()))));class vs extends yW{routing;allowInsecure;allowLocal;transformRequestInit;constructor(e,t){super(e,{...t,name:"helia:trustless-gateway:session"}),this.routing=e.routing,this.allowInsecure=t.allowInsecure??vl,this.allowLocal=t.allowLocal??vc,this.transformRequestInit=t.transformRequestInit}async queryProvider(e,t,r){this.log("fetching BLOCK for %c from %s",e,t.url);let n=await t.getRawBlock(e,r.signal);return this.log.trace("got block for %c from %s",e,t.url),await r.validateFn?.(n),n}async *findNewProviders(e,t={}){yield*vi(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...t,transformRequestInit:this.transformRequestInit})}toEvictionKey(e){return e.url.toString()}equals(e,t){return e.url.toString()===t.url.toString()}async convertToProvider(e,t){if(yb(e))return;let r=vn(Array.isArray(e)?e:[e],this.allowInsecure,this.allowLocal);if(0!==r.length)return new wu(wc(r[0]),{logger:this.logger,transformRequestInit:this.transformRequestInit})}}function vo(e,t){return new vs(e,t)}class va{allowInsecure;allowLocal;transformRequestInit;routing;log;logger;constructor(e,t={}){this.log=e.logger.forComponent("helia:trustless-gateway-block-broker"),this.logger=e.logger,this.routing=e.routing,this.allowInsecure=t.allowInsecure??vl,this.allowLocal=t.allowLocal??vc,this.transformRequestInit=t.transformRequestInit}async retrieve(e,t={}){let r=[];for await(let n of vi(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...t,transformRequestInit:this.transformRequestInit})){this.log("getting block for %c from %s",e,n.url);try{let r=await n.getRawBlock(e,t.signal);this.log.trace("got block for %c from %s",e,n.url);try{await t.validateFn?.(r)}catch(t){this.log.error("failed to validate block for %c from %s",e,n.url,t);continue}return r}catch(i){if(this.log.error("failed to get block for %c from %s",e,n.url,i),i instanceof Error?r.push(i):r.push(Error(`Unable to fetch raw block for CID ${e} from gateway ${n.url}`)),t.signal?.aborted===!0){this.log.trace("request aborted while fetching raw block for CID %c from gateway %s",e,n.url);break}}}if(r.length>0)throw AggregateError(r,`Unable to fetch raw block for CID ${e} from any gateway`);throw Error(`Unable to fetch raw block for CID ${e} from any gateway`)}createSession(e={}){return vo({logger:this.logger,routing:this.routing},{...e,allowLocal:this.allowLocal,allowInsecure:this.allowInsecure,transformRequestInit:this.transformRequestInit})}}let vl=!1,vc=!1;function vu(e={}){return t=>new va(t,e)}class vh{libp2p;constructor(e){this.libp2p=e}async provide(e,t){await this.libp2p.contentRouting.provide(e,t)}async cancelReprovide(e,t){await this.libp2p.contentRouting.cancelReprovide(e,t)}async *findProviders(e,t){yield*this.libp2p.contentRouting.findProviders(e,t)}async put(e,t,r){await this.libp2p.contentRouting.put(e,t,r)}async get(e,t){return this.libp2p.contentRouting.get(e,t)}async findPeer(e,t){return this.libp2p.peerRouting.findPeer(e,t)}async *getClosestPeers(e,t){yield*this.libp2p.peerRouting.getClosestPeers(e,t)}}function vd(e){return new vh(e)}let vf="[a-fA-F\\d:]",vp=e=>e&&e.includeBoundaries?`(?:(?<=\\s|^)(?=${vf})|(?<=${vf})(?=\\s|$))`:"",vg="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",vm="[a-fA-F\\d]{1,4}",vy=`
(?:
(?:${vm}:){7}(?:${vm}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${vm}:){6}(?:${vg}|:${vm}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${vm}:){5}(?::${vg}|(?::${vm}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${vm}:){4}(?:(?::${vm}){0,1}:${vg}|(?::${vm}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${vm}:){3}(?:(?::${vm}){0,2}:${vg}|(?::${vm}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${vm}:){2}(?:(?::${vm}){0,3}:${vg}|(?::${vm}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${vm}:){1}(?:(?::${vm}){0,4}:${vg}|(?::${vm}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${vm}){0,5}:${vg}|(?::${vm}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),vb=RegExp(`(?:^${vg}$)|(?:^${vy}$)`),vw=RegExp(`^${vg}$`),vv=RegExp(`^${vy}$`),vE=e=>e&&e.exact?vb:RegExp(`(?:${vp(e)}${vg}${vp(e)})|(?:${vp(e)}${vy}${vp(e)})`,"g");vE.v4=e=>e&&e.exact?vw:RegExp(`${vp(e)}${vg}${vp(e)}`,"g"),vE.v6=e=>e&&e.exact?vv:RegExp(`${vp(e)}${vy}${vp(e)}`,"g");let vA=vE;function vx(e){let t=(...t)=>e(...t);return Object.defineProperty(t,"name",{value:`functionTimeout(${e.name||"<anonymous>"})`,configurable:!0}),t}function vS(){return!1}let{toString:vk}=Object.prototype;function v_(e){return"[object RegExp]"===vk.call(e)}let vI={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function vC(e,t={}){if(!v_(e))throw TypeError("Expected a RegExp instance");let r=Object.keys(vI).map(r=>("boolean"==typeof t[r]?t[r]:e[r])?vI[r]:"").join(""),n=new RegExp(t.source||e.source,r);return n.lastIndex="number"==typeof t.lastIndex?t.lastIndex:e.lastIndex,n}function vT(e,t,{timeout:r}={}){try{return vx(()=>vC(e).test(t),{timeout:r})()}catch(e){if(vS(e))return!1;throw e}}let vP=15,vR=45,vO={timeout:400};function vN(e){return!(e.length>vR)&&vT(vA.v6({exact:!0}),e,vO)}function vD(e){return!(e.length>vP)&&vT(vA.v4({exact:!0}),e,vO)}let vB={http:"80",https:"443",ws:"80",wss:"443"},vM=["http","https","ws","wss"];function vL(e,t){let r=(t=t??{}).defaultDnsType??"dns",{scheme:n,hostname:i,port:s,path:o}=vF(e),a=[vU(i,r),vj(s,n),v$(n)];return null!=o&&a.push(vH(o)),wt("/"+a.filter(e=>!!e).reduce((e,t)=>e.concat(t),[]).join("/"))}function vF(e){let t,[r]=e.split(":");vM.includes(r)||(e="http"+e.substring(r.length));let{protocol:n,hostname:i,port:s,pathname:o,search:a}=new URL(e);if(null==s||""===s){let e=vq(r);null!=e&&(s=e),null==e&&"http:"===n&&(s="80")}return null!=o&&""!==o&&"/"!==o&&(o.startsWith("/")&&(o=o.substring(1)),t=o),null!=a&&""!==a&&(t=(t??"")+a),{scheme:r,hostname:i,port:s,path:t}}function vU(e,t){if(null!=e&&""!==e){if(vD(e))return["ip4",e];if(vN(e))return["ip6",e];if("["===e[0]){let t=e.substring(1,e.length-1);if(vN(t))return["ip6",t]}return[t,e]}}function vj(e,t){if(null!=e&&""!==e)return"udp"===t?["udp",e]:["tcp",e]}function v$(e){if(null==e.match(/^tcp$|^udp$/))return"https"===e?["/tls/http"]:"wss"===e?["/tls/ws"]:[e]}function vH(e){if(null!=e&&""!==e)return["http-path",encodeURIComponent(e)]}function vq(e){if(null!=e&&""!==e&&null!=vB[e])return vB[e]}let vz=["https://trustless-gateway.link","https://4everland.io"],vV=2336;function vK(e){return e=e.toString(),{id:yN(rc.TO.createV1(vV,aq.identity.digest((0,nm.s)(e)))),multiaddrs:[vL(e)]}}class vG{gateways;shuffle;constructor(e={}){this.gateways=(e.gateways??vz).map(e=>vK(e)),this.shuffle=e.shuffle??!0}async *findProviders(e,t){yield*(this.shuffle?this.gateways.toSorted(()=>Math.random()>.5?1:-1):this.gateways).map(e=>({...e,protocols:["transport-ipfs-gateway-http"]}))}}function vW(e={}){return new vG(e)}var vQ=r(46923),vJ=r(68250);function vZ(e,t,r,n){fE(e);let{c:i,dkLen:s,asyncTick:o}=fB({dkLen:32,asyncTick:10},n);if(fw(i),fw(s),fw(o),i<1)throw Error("iterations (c) should be >= 1");let a=fN(t),l=fN(r),c=new Uint8Array(s),u=mw.create(e,a),h=u._cloneInto().update(l);return{c:i,dkLen:s,asyncTick:o,DK:c,PRF:u,PRFSalt:h}}function vY(e,t,r,n,i){return e.destroy(),t.destroy(),n&&n.destroy(),fS(i),r}function vX(e,t,r,n){let i,{c:s,dkLen:o,DK:a,PRF:l,PRFSalt:c}=vZ(e,t,r,n),u=new Uint8Array(4),h=fk(u),d=new Uint8Array(l.outputLen);for(let e=1,t=0;t<o;e++,t+=l.outputLen){let r=a.subarray(t,t+l.outputLen);h.setInt32(0,e,!1),(i=c._cloneInto(i)).update(u).digestInto(d),r.set(d.subarray(0,r.length));for(let e=1;e<s;e++){l._cloneInto(i).update(d).digestInto(d);for(let e=0;e<r.length;e++)r[e]^=d[e]}}return vY(l,c,a,i,d)}async function v0(e,t,r,n){let i,{c:s,dkLen:o,asyncTick:a,DK:l,PRF:c,PRFSalt:u}=vZ(e,t,r,n),h=new Uint8Array(4),d=fk(h),f=new Uint8Array(c.outputLen);for(let e=1,t=0;t<o;e++,t+=c.outputLen){let r=l.subarray(t,t+c.outputLen);d.setInt32(0,e,!1),(i=u._cloneInto(i)).update(h).digestInto(f),r.set(f.subarray(0,r.length)),await fP(s-1,a,()=>{c._cloneInto(i).update(f).digestInto(f);for(let e=0;e<r.length;e++)r[e]^=f[e]})}return vY(c,u,l,i,f)}let v1=Uint32Array.from([0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0]),v2=new Uint32Array(80);class v3 extends fH{constructor(){super(64,20,8,!1),this.A=0|v1[0],this.B=0|v1[1],this.C=0|v1[2],this.D=0|v1[3],this.E=0|v1[4]}get(){let{A:e,B:t,C:r,D:n,E:i}=this;return[e,t,r,n,i]}set(e,t,r,n,i){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i}process(e,t){for(let r=0;r<16;r++,t+=4)v2[r]=e.getUint32(t,!1);for(let e=16;e<80;e++)v2[e]=fI(v2[e-3]^v2[e-8]^v2[e-14]^v2[e-16],1);let{A:r,B:n,C:i,D:s,E:o}=this;for(let e=0;e<80;e++){let t,a;e<20?(t=fj(n,i,s),a=0x5a827999):e<40?(t=n^i^s,a=0x6ed9eba1):e<60?(t=f$(n,i,s),a=0x8f1bbcdc):(t=n^i^s,a=0xca62c1d6);let l=fI(r,5)+t+o+a+v2[e]|0;o=s,s=i,i=fI(n,30),n=r,r=l}r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,this.set(r,n,i,s,o)}roundClean(){fS(v2)}destroy(){this.set(0,0,0,0,0),fS(this.buffer)}}let v4=fL(()=>new v3),v5=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),v6=Uint8Array.from(Array(16).fill(0).map((e,t)=>t)),v8=v6.map(e=>(9*e+5)%16),v7=(()=>{let e=[[v6],[v8]];for(let t=0;t<4;t++)for(let r of e)r.push(r[t].map(e=>v5[e]));return e})();v7[0],v7[1],e=>Uint8Array.from(e);let v9=pl,Ee={sha1:v4,"sha2-256":me,"sha2-512":v9};function Et(e,t,r,n,i){if("sha1"!==i&&"sha2-256"!==i&&"sha2-512"!==i){let e=Object.keys(Ee).join(" / ");throw new uC(`Hash '${i}' is unknown or not supported. Must be ${e}`)}let s=vX(Ee[i],e,t,{c:r,dkLen:n});return a_.base64.encode(s).substring(1)}function Er(e){if(isNaN(e)||e<=0)throw new uC("random bytes length must be a Number bigger than 0");return fF(e)}let En=Symbol.for("@libp2p/service-capabilities"),Ei=Symbol.for("@libp2p/service-dependencies");var Es=r(86620),Eo=r(3305);let Ea={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function El(e){let t=e?.algorithm??"AES-GCM",r=e?.keyLength??16,n=e?.nonceLength??12,i=e?.digest??"SHA-256",s=e?.saltLength??16,o=e?.iterations??32767,a=g3.get();return r*=8,{encrypt:async function(e,l){let c,u=a.getRandomValues(new Uint8Array(s)),h={name:t,iv:a.getRandomValues(new Uint8Array(n))};if("string"==typeof l&&(l=(0,nm.s)(l)),0===l.length){c=await a.subtle.importKey("jwk",Ea,{name:"AES-GCM"},!0,["encrypt"]);try{let e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",l,{name:"PBKDF2"},!1,["deriveKey"]);c=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}catch{c=await a.subtle.importKey("jwk",Ea,{name:"AES-GCM"},!0,["encrypt"])}}else{let e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",l,{name:"PBKDF2"},!1,["deriveKey"]);c=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}let d=await a.subtle.encrypt(h,c,e);return rt([u,h.iv,new Uint8Array(d)])},decrypt:async function(e,l){let c,u=e.subarray(0,s),h=e.subarray(s,s+n),d=e.subarray(s+n),f={name:t,iv:h};if("string"==typeof l&&(l=(0,nm.s)(l)),0===l.length)try{let e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",l,{name:"PBKDF2"},!1,["deriveKey"]);c=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}catch{c=await a.subtle.importKey("jwk",Ea,{name:"AES-GCM"},!0,["decrypt"])}else{let e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",l,{name:"PBKDF2"},!1,["deriveKey"]);c=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}return new Uint8Array(await a.subtle.decrypt(f,c,d))}}}var Ec=r(19169);function Eu(e,t){let r=0;if(1===e.length)return e[0];for(let n=e.length-1;n>=0;n--)r+=e[e.length-1-n]*Math.pow(2,t*n);return r}function Eh(e,t,r=-1){let n=r,i=e,s=0,o=Math.pow(2,t);for(let r=1;r<8;r++){if(e<o){let e;if(n<0)e=new ArrayBuffer(r),s=r;else{if(n<r)return new ArrayBuffer(0);e=new ArrayBuffer(n),s=n}let o=new Uint8Array(e);for(let e=r-1;e>=0;e--){let r=Math.pow(2,e*t);o[s-e-1]=Math.floor(i/r),i-=o[s-e-1]*r}return e}o*=Math.pow(2,t)}return new ArrayBuffer(0)}function Ed(...e){let t=0,r=0;for(let r of e)t+=r.length;let n=new Uint8Array(new ArrayBuffer(t));for(let t of e)n.set(t,r),r+=t.length;return n}function Ef(){let e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){let t=255===e[0]&&128&e[1],r=0===e[0]&&(128&e[1])==0;(t||r)&&this.warnings.push("Needlessly long format")}let t=new Uint8Array(new ArrayBuffer(this.valueHex.byteLength));for(let e=0;e<this.valueHex.byteLength;e++)t[e]=0;t[0]=128&e[0];let r=Eu(t,8),n=new Uint8Array(new ArrayBuffer(this.valueHex.byteLength));for(let t=0;t<this.valueHex.byteLength;t++)n[t]=e[t];return n[0]&=127,Eu(n,8)-r}function Ep(e){let t=e<0?-1*e:e,r=128;for(let n=1;n<8;n++){if(t<=r){if(e<0){let e=Eh(r-t,8,n),i=new Uint8Array(e);return i[0]|=128,e}let i=Eh(t,8,n),s=new Uint8Array(i);if(128&s[0]){let e=i.slice(0),t=new Uint8Array(e);s=new Uint8Array(i=new ArrayBuffer(i.byteLength+1));for(let r=0;r<e.byteLength;r++)s[r+1]=t[r];s[0]=0}return i}r*=256}return new ArrayBuffer(0)}function Eg(e,t){if(e.byteLength!==t.byteLength)return!1;let r=new Uint8Array(e),n=new Uint8Array(t);for(let e=0;e<r.length;e++)if(r[e]!==n[e])return!1;return!0}function Em(e,t){let r=e.toString(10);if(t<r.length)return"";let n=t-r.length,i=Array(n);for(let e=0;e<n;e++)i[e]="0";return i.join("").concat(r)}function Ey(){if("undefined"==typeof BigInt)throw Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Eb(e){let t=0,r=0;for(let r=0;r<e.length;r++)t+=e[r].byteLength;let n=new Uint8Array(t);for(let t=0;t<e.length;t++){let i=e[t];n.set(new Uint8Array(i),r),r+=i.byteLength}return n.buffer}function Ew(e,t,r,n){return t instanceof Uint8Array?t.byteLength?r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):n<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-n<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class Ev{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return Eb(this.items)}}let EE=[new Uint8Array([1])],EA="0123456789",Ex="name",ES="valueHexView",Ek="isHexOnly",E_="idBlock",EI="tagClass",EC="tagNumber",ET="isConstructed",EP="fromBER",ER="toBER",EO="local",EN="",ED=new ArrayBuffer(0),EB=new Uint8Array(0),EM="EndOfContent",EL="OCTET STRING",EF="BIT STRING";function EU(e){var t;return(t=class extends e{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(e){this.valueHexView=new Uint8Array(e)}constructor(...e){var t;super(...e);let r=e[0]||{};this.isHexOnly=null!=(t=r.isHexOnly)&&t,this.valueHexView=r.valueHex?Ec._H.toUint8Array(r.valueHex):EB}fromBER(e,t,r){let n=e instanceof ArrayBuffer?new Uint8Array(e):e;if(!Ew(this,n,t,r))return -1;let i=t+r;return(this.valueHexView=n.subarray(t,i),this.valueHexView.length)?(this.blockLength=r,i):(this.warnings.push("Zero buffer length"),t)}toBER(e=!1){return this.isHexOnly?e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",ED)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:Ec.U$.ToHex(this.valueHexView)}}}).NAME="hexBlock",t}class Ej{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=EN,warnings:r=[],valueBeforeDecode:n=EB}={}){this.blockLength=e,this.error=t,this.warnings=r,this.valueBeforeDecodeView=Ec._H.toUint8Array(n)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Ec.U$.ToHex(this.valueBeforeDecodeView)}}}Ej.NAME="baseBlock";class E$ extends Ej{fromBER(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}E$.NAME="valueBlock";class EH extends EU(Ej){constructor({idBlock:e={}}={}){var t,r,n,i;super(),e?(this.isHexOnly=null!=(t=e.isHexOnly)&&t,this.valueHexView=e.valueHex?Ec._H.toUint8Array(e.valueHex):EB,this.tagClass=null!=(r=e.tagClass)?r:-1,this.tagNumber=null!=(n=e.tagNumber)?n:-1,this.isConstructed=null!=(i=e.isConstructed)&&i):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",ED}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){let r=new Uint8Array(1);if(!e){let e=this.tagNumber;e&=31,t|=e,r[0]=t}return r.buffer}if(!this.isHexOnly){let r=Eh(this.tagNumber,7),n=new Uint8Array(r),i=r.byteLength,s=new Uint8Array(i+1);if(s[0]=31|t,!e){for(let e=0;e<i-1;e++)s[e+1]=128|n[e];s[i]=n[i-1]}return s.buffer}let r=new Uint8Array(this.valueHexView.byteLength+1);if(r[0]=31|t,!e){let e=this.valueHexView;for(let t=0;t<e.length-1;t++)r[t+1]=128|e[t];r[this.valueHexView.byteLength]=e[e.length-1]}return r.buffer}fromBER(e,t,r){let n=Ec._H.toUint8Array(e);if(!Ew(this,n,t,r))return -1;let i=n.subarray(t,t+r);if(0===i.length)return this.error="Zero buffer length",-1;switch(192&i[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(32&i[0])==32,this.isHexOnly=!1;let s=31&i[0];if(31!==s)this.tagNumber=s,this.blockLength=1;else{let e=1,t=this.valueHexView=new Uint8Array(255),r=255;for(;128&i[e];){if(t[e-1]=127&i[e],++e>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(e===r){let e=new Uint8Array(r+=255);for(let r=0;r<t.length;r++)e[r]=t[r];t=this.valueHexView=new Uint8Array(r)}}this.blockLength=e+1,t[e-1]=127&i[e];let n=new Uint8Array(e);for(let r=0;r<e;r++)n[r]=t[r];(t=this.valueHexView=new Uint8Array(e)).set(n),this.blockLength<=9?this.tagNumber=Eu(t,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}EH.NAME="identificationBlock";class Eq extends Ej{constructor({lenBlock:e={}}={}){var t,r,n;super(),this.isIndefiniteForm=null!=(t=e.isIndefiniteForm)&&t,this.longFormUsed=null!=(r=e.longFormUsed)&&r,this.length=null!=(n=e.length)?n:0}fromBER(e,t,r){let n=Ec._H.toUint8Array(e);if(!Ew(this,n,t,r))return -1;let i=n.subarray(t,t+r);if(0===i.length)return this.error="Zero buffer length",-1;if(255===i[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===i[0],this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&i[0]),!1===this.longFormUsed)return this.length=i[0],this.blockLength=1,t+this.blockLength;let s=127&i[0];if(s>8)return this.error="Too big integer",-1;if(s+1>i.length)return this.error="End of input reached before message was fully decoded",-1;let o=t+1,a=n.subarray(o,o+s);return 0===a[s-1]&&this.warnings.push("Needlessly long encoded length"),this.length=Eu(a,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=s+1,t+this.blockLength}toBER(e=!1){let t,r;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),!1===e&&((r=new Uint8Array(t))[0]=128),t;if(this.longFormUsed){let n=Eh(this.length,8);if(n.byteLength>127)return this.error="Too big length",ED;if(t=new ArrayBuffer(n.byteLength+1),e)return t;let i=new Uint8Array(n);(r=new Uint8Array(t))[0]=128|n.byteLength;for(let e=0;e<n.byteLength;e++)r[e+1]=i[e];return t}return t=new ArrayBuffer(1),!1===e&&((r=new Uint8Array(t))[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}Eq.NAME="lengthBlock";let Ez={};class EV extends Ej{constructor({name:e=EN,optional:t=!1,primitiveSchema:r,...n}={},i){super(n),this.name=e,this.optional=t,r&&(this.primitiveSchema=r),this.idBlock=new EH(n),this.lenBlock=new Eq(n),this.valueBlock=i?new i(n):new E$(n)}fromBER(e,t,r){let n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return -1===n?this.error=this.valueBlock.error:(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength)),n}toBER(e,t){let r=t||new Ev;t||EK(this);let n=this.idBlock.toBER(e);if(r.write(n),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{let t=this.valueBlock.toBER(e);this.lenBlock.length=t.byteLength;let n=this.lenBlock.toBER(e);r.write(n),r.write(t)}return t?ED:r.final()}toJSON(){let e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return"ascii"===e?this.onAsciiEncoding():Ec.U$.ToHex(this.toBER())}onAsciiEncoding(){let e=this.constructor.NAME,t=Ec.U$.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){return this===e||e instanceof this.constructor&&Eg(this.toBER(),e.toBER())}}function EK(e){var t;if(e instanceof Ez.Constructed)for(let t of e.valueBlock.value)EK(t)&&(e.lenBlock.isIndefiniteForm=!0);return!!(null==(t=e.lenBlock)?void 0:t.isIndefiniteForm)}EV.NAME="BaseBlock";class EG extends EV{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=EN,...t}={},r){super(t,r),e&&this.fromString(e)}fromBER(e,t,r){let n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return -1===n?this.error=this.valueBlock.error:(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength)),n}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}EG.NAME="BaseStringBlock";class EW extends EU(E$){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}EW.NAME="PrimitiveValueBlock";class EQ extends EV{constructor(e={}){super(e,EW),this.idBlock.isConstructed=!1}}function EJ(e,t){if(e instanceof t)return e;let r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecodeView=e.valueBeforeDecodeView,r}function EZ(e,t=0,r=e.length){let n=t,i=new EV({},E$),s=new Ej;if(!Ew(s,e,t,r))return i.error=s.error,{offset:-1,result:i};if(!e.subarray(t,t+r).length)return i.error="Zero buffer length",{offset:-1,result:i};let o=i.idBlock.fromBER(e,t,r);if(i.idBlock.warnings.length&&i.warnings.concat(i.idBlock.warnings),-1===o)return i.error=i.idBlock.error,{offset:-1,result:i};if(t=o,r-=i.idBlock.blockLength,o=i.lenBlock.fromBER(e,t,r),i.lenBlock.warnings.length&&i.warnings.concat(i.lenBlock.warnings),-1===o)return i.error=i.lenBlock.error,{offset:-1,result:i};if(t=o,r-=i.lenBlock.blockLength,!i.idBlock.isConstructed&&i.lenBlock.isIndefiniteForm)return i.error="Indefinite length form used for primitive encoding form",{offset:-1,result:i};let a=EV;if(1===i.idBlock.tagClass){if(i.idBlock.tagNumber>=37&&!1===i.idBlock.isHexOnly)return i.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:i};switch(i.idBlock.tagNumber){case 0:if(i.idBlock.isConstructed&&i.lenBlock.length>0)return i.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:i};a=Ez.EndOfContent;break;case 1:a=Ez.Boolean;break;case 2:a=Ez.Integer;break;case 3:a=Ez.BitString;break;case 4:a=Ez.OctetString;break;case 5:a=Ez.Null;break;case 6:a=Ez.ObjectIdentifier;break;case 10:a=Ez.Enumerated;break;case 12:a=Ez.Utf8String;break;case 13:a=Ez.RelativeObjectIdentifier;break;case 14:a=Ez.TIME;break;case 15:return i.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:i};case 16:a=Ez.Sequence;break;case 17:a=Ez.Set;break;case 18:a=Ez.NumericString;break;case 19:a=Ez.PrintableString;break;case 20:a=Ez.TeletexString;break;case 21:a=Ez.VideotexString;break;case 22:a=Ez.IA5String;break;case 23:a=Ez.UTCTime;break;case 24:a=Ez.GeneralizedTime;break;case 25:a=Ez.GraphicString;break;case 26:a=Ez.VisibleString;break;case 27:a=Ez.GeneralString;break;case 28:a=Ez.UniversalString;break;case 29:a=Ez.CharacterString;break;case 30:a=Ez.BmpString;break;case 31:a=Ez.DATE;break;case 32:a=Ez.TimeOfDay;break;case 33:a=Ez.DateTime;break;case 34:a=Ez.Duration;break;default:{let e=i.idBlock.isConstructed?new Ez.Constructed:new Ez.Primitive;e.idBlock=i.idBlock,e.lenBlock=i.lenBlock,e.warnings=i.warnings,i=e}}}else a=i.idBlock.isConstructed?Ez.Constructed:Ez.Primitive;return o=(i=EJ(i,a)).fromBER(e,t,i.lenBlock.isIndefiniteForm?r:i.lenBlock.length),i.valueBeforeDecodeView=e.subarray(n,n+i.blockLength),{offset:o,result:i}}function EY(e){if(!e.byteLength){let e=new EV({},E$);return e.error="Input buffer has zero length",{offset:-1,result:e}}return EZ(Ec._H.toUint8Array(e).slice(),0,e.byteLength)}function EX(e,t){return e?1:t}x=EQ,(()=>{Ez.Primitive=x})(),EQ.NAME="PRIMITIVE";class E0 extends E${constructor({value:e=[],isIndefiniteForm:t=!1,...r}={}){super(r),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,r){let n=Ec._H.toUint8Array(e);if(!Ew(this,n,t,r))return -1;if(this.valueBeforeDecodeView=n.subarray(t,t+r),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),t;let i=t;for(;EX(this.isIndefiniteForm,r)>0;){let e=EZ(n,i,r);if(-1===e.offset)return this.error=e.result.error,this.warnings.concat(e.result.warnings),-1;if(i=e.offset,this.blockLength+=e.result.blockLength,r-=e.result.blockLength,this.value.push(e.result),this.isIndefiniteForm&&e.result.constructor.NAME===EM)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===EM?this.value.pop():this.warnings.push("No EndOfContent block encoded")),i}toBER(e,t){let r=t||new Ev;for(let t=0;t<this.value.length;t++)this.value[t].toBER(e,r);return t?ED:r.final()}toJSON(){let e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(let t of this.value)e.value.push(t.toJSON());return e}}E0.NAME="ConstructedValueBlock";class E1 extends EV{constructor(e={}){super(e,E0),this.idBlock.isConstructed=!0}fromBER(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;let n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return -1===n?this.error=this.valueBlock.error:(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength)),n}onAsciiEncoding(){let e=[];for(let t of this.valueBlock.value)e.push(t.toString("ascii").split("\n").map(e=>`  ${e}`).join("\n"));let t=3===this.idBlock.tagClass?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join("\n")}`:`${t} :`}}S=E1,(()=>{Ez.Constructed=S})(),E1.NAME="CONSTRUCTED";class E2 extends E${fromBER(e,t,r){return t}toBER(e){return ED}}E2.override="EndOfContentValueBlock";class E3 extends EV{constructor(e={}){super(e,E2),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}k=E3,(()=>{Ez.EndOfContent=k})(),E3.NAME=EM;class E4 extends EV{constructor(e={}){super(e,E$),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,r){return(this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength)?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}toBER(e,t){let r=new ArrayBuffer(2);if(!e){let e=new Uint8Array(r);e[0]=5,e[1]=0}return t&&t.write(r),r}onAsciiEncoding(){return`${this.constructor.NAME}`}}_=E4,(()=>{Ez.Null=_})(),E4.NAME="NULL";class E5 extends EU(E$){get value(){for(let e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=255*!!e}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=Ec._H.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,r){let n=Ec._H.toUint8Array(e);return Ew(this,n,t,r)?(this.valueHexView=n.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,Ef.call(this),this.blockLength=r,t+r):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}E5.NAME="BooleanValueBlock";class E6 extends EV{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,E5),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}}I=E6,(()=>{Ez.Boolean=I})(),E6.NAME="BOOLEAN";class E8 extends EU(E0){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,r){let n=0;if(this.isConstructed){if(this.isHexOnly=!1,-1===(n=E0.prototype.fromBER.call(this,e,t,r)))return n;for(let e=0;e<this.value.length;e++){let t=this.value[e].constructor.NAME;if(t===EM)if(!this.isIndefiniteForm)return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1;else break;if(t!==EL)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,n=super.fromBER(e,t,r),this.blockLength=r;return n}toBER(e,t){return this.isConstructed?E0.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}E8.NAME="OctetStringValueBlock";class E7 extends EV{constructor({idBlock:e={},lenBlock:t={},...r}={}){var n,i;null!=(n=r.isConstructed)||(r.isConstructed=!!(null==(i=r.value)?void 0:i.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},E8),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,r){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===r)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){let n=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+r);try{if(n.byteLength){let e=EZ(n,0,n.byteLength);-1!==e.offset&&e.offset===r&&(this.valueBlock.value=[e.result])}}catch{}}return super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return E1.prototype.onAsciiEncoding.call(this);let e=this.constructor.NAME,t=Ec.U$.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;let e=[];for(let t of this.valueBlock.value)t instanceof C&&e.push(t.valueBlock.valueHexView);return Ec._H.concat(e)}}C=E7,(()=>{Ez.OctetString=C})(),E7.NAME=EL;class E9 extends EU(E0){constructor({unusedBits:e=0,isConstructed:t=!1,...r}={}){super(r),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,r){if(!r)return t;let n=-1;if(this.isConstructed){if(-1===(n=E0.prototype.fromBER.call(this,e,t,r)))return n;for(let e of this.value){let t=e.constructor.NAME;if(t===EM)if(!this.isIndefiniteForm)return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1;else break;if(t!==EF)return this.error="BIT STRING may consists of BIT STRINGs only",-1;let r=e.valueBlock;if(this.unusedBits>0&&r.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=r.unusedBits}return n}let i=Ec._H.toUint8Array(e);if(!Ew(this,i,t,r))return -1;let s=i.subarray(t,t+r);if(this.unusedBits=s[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){let e=s.subarray(1);try{if(e.byteLength){let t=EZ(e,0,e.byteLength);-1!==t.offset&&t.offset===r-1&&(this.value=[t.result])}}catch{}}return this.valueHexView=s.subarray(1),this.blockLength=s.length,t+r}toBER(e,t){if(this.isConstructed)return E0.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return ED;let r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}E9.NAME="BitStringValueBlock";class Ae extends EV{constructor({idBlock:e={},lenBlock:t={},...r}={}){var n,i;null!=(n=r.isConstructed)||(r.isConstructed=!!(null==(i=r.value)?void 0:i.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},E9),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,r){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return E1.prototype.onAsciiEncoding.call(this);{let e=[];for(let t of this.valueBlock.valueHexView)e.push(t.toString(2).padStart(8,"0"));let t=e.join(""),r=this.constructor.NAME,n=t.substring(0,t.length-this.valueBlock.unusedBits);return`${r} : ${n}`}}}function At(e,t){let r=new Uint8Array([0]),n=new Uint8Array(e),i=new Uint8Array(t),s=n.slice(0),o=s.length-1,a=i.slice(0),l=a.length-1,c=0,u=l<o?o:l,h=0;for(let e=u;e>=0;e--,h++)c=!0==h<a.length?s[o-h]+a[l-h]+r[0]:s[o-h]+r[0],r[0]=c/10,!0==h>=s.length?s=Ed(new Uint8Array([c%10]),s):s[o-h]=c%10;return r[0]>0&&(s=Ed(r,s)),s}function Ar(e){if(e>=EE.length)for(let t=EE.length;t<=e;t++){let e=new Uint8Array([0]),r=EE[t-1].slice(0);for(let t=r.length-1;t>=0;t--){let n=new Uint8Array([(r[t]<<1)+e[0]]);e[0]=n[0]/10,r[t]=n[0]%10}e[0]>0&&(r=Ed(e,r)),EE.push(r)}return EE[e]}function An(e,t){let r,n=0,i=new Uint8Array(e),s=new Uint8Array(t),o=i.slice(0),a=o.length-1,l=s.slice(0),c=l.length-1,u=0;for(let e=c;e>=0;e--,u++)!0==(r=o[a-u]-l[c-u]-n)<0?(n=1,o[a-u]=r+10):(n=0,o[a-u]=r);if(n>0)for(let e=a-c+1;e>=0;e--,u++)if((r=o[a-u]-n)<0)n=1,o[a-u]=r+10;else{n=0,o[a-u]=r;break}return o.slice()}T=Ae,(()=>{Ez.BitString=T})(),Ae.NAME=EF;class Ai extends EU(E$){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=Ef.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),void 0!==e&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(Ep(e))}get valueDec(){return this._valueDec}fromDER(e,t,r,n=0){let i=this.fromBER(e,t,r);if(-1===i)return i;let s=this.valueHexView;return 0===s[0]&&(128&s[1])!=0?this.valueHexView=s.subarray(1):0!==n&&s.length<n&&(n-s.length>1&&(n=s.length+1),this.valueHexView=s.subarray(n-s.length)),i}toDER(e=!1){let t=this.valueHexView;switch(!0){case(128&t[0])!=0:{let e=new Uint8Array(this.valueHexView.length+1);e[0]=0,e.set(t,1),this.valueHexView=e}break;case 0===t[0]&&(128&t[1])==0:this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(e)}fromBER(e,t,r){let n=super.fromBER(e,t,r);return -1===n||this.setValueHex(),n}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){let e,t=8*this.valueHexView.length-1,r=new Uint8Array(8*this.valueHexView.length/3),n=0,i=this.valueHexView,s="",o=!1;for(let o=i.byteLength-1;o>=0;o--){e=i[o];for(let i=0;i<8;i++)(1&e)==1&&(n===t?(r=An(Ar(n),r),s="-"):r=At(r,Ar(n))),n++,e>>=1}for(let e=0;e<r.length;e++)r[e]&&(o=!0),o&&(s+=EA.charAt(r[e]));return!1===o&&(s+=EA.charAt(0)),s}}P=Ai,Ai.NAME="IntegerValueBlock",(()=>{Object.defineProperty(P.prototype,"valueHex",{set:function(e){this.valueHexView=new Uint8Array(e),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}})})();class As extends EV{constructor(e={}){super(e,Ai),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return Ey(),BigInt(this.valueBlock.toString())}static fromBigInt(e){Ey();let t=BigInt(e),r=new Ev,n=t.toString(16).replace(/^-/,""),i=new Uint8Array(Ec.U$.FromHex(n));if(t<0){let e=new Uint8Array(i.length+(128&i[0]?1:0));e[0]|=128;let n=BigInt(`0x${Ec.U$.ToHex(e)}`)+t,s=Ec._H.toUint8Array(Ec.U$.FromHex(n.toString(16)));s[0]|=128,r.write(s)}else 128&i[0]&&r.write(new Uint8Array([0])),r.write(i);return new R({valueHex:r.final()})}convertToDER(){let e=new R({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new R({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}R=As,(()=>{Ez.Integer=R})(),As.NAME="INTEGER";class Ao extends As{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}O=Ao,(()=>{Ez.Enumerated=O})(),Ao.NAME="ENUMERATED";class Aa extends EU(E$){constructor({valueDec:e=-1,isFirstSid:t=!1,...r}={}){super(r),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,r){if(!r)return t;let n=Ec._H.toUint8Array(e);if(!Ew(this,n,t,r))return -1;let i=n.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let e=0;e<r&&(this.valueHexView[e]=127&i[e],this.blockLength++,(128&i[e])!=0);e++);let s=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength;e++)s[e]=this.valueHexView[e];return(this.valueHexView=s,(128&i[this.blockLength-1])!=0)?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Eu(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){Ey();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;let r=new Uint8Array(t.length/7);for(let e=0;e<r.length;e++)r[e]=parseInt(t.slice(7*e,7*e+7),2)+128*(e+1<r.length);this.fromBER(r.buffer,0,r.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let t=this.valueHexView,r=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)r[e]=128|t[e];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}let t=Eh(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",ED;let r=new Uint8Array(t.byteLength);if(!e){let e=new Uint8Array(t),n=t.byteLength-1;for(let t=0;t<n;t++)r[t]=128|e[t];r[n]=e[n]}return r}toString(){let e="";if(this.isHexOnly)e=Ec.U$.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}Aa.NAME="sidBlock";class Al extends E${constructor({value:e=EN,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let n=t;for(;r>0;){let t=new Aa;if(-1===(n=t.fromBER(e,n,r))){this.blockLength=0,this.error=t.error;break}0===this.value.length&&(t.isFirstSid=!0),this.blockLength+=t.blockLength,r-=t.blockLength,this.value.push(t)}return n}toBER(e){let t=[];for(let r=0;r<this.value.length;r++){let n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,ED;t.push(n)}return Eb(t)}fromString(e){this.value=[];let t=0,r=0,n="",i=!1;do if(n=-1===(r=e.indexOf(".",t))?e.substring(t):e.substring(t,r),t=r+1,i){let e=this.value[0],t=0;switch(e.valueDec){case 0:break;case 1:t=40;break;case 2:t=80;break;default:this.value=[];return}let r=parseInt(n,10);if(isNaN(r))return;e.valueDec=r+t,i=!1}else{let e=new Aa;if(n>Number.MAX_SAFE_INTEGER)Ey(),e.valueBigInt=BigInt(n);else if(e.valueDec=parseInt(n,10),isNaN(e.valueDec))return;this.value.length||(e.isFirstSid=!0,i=!0),this.value.push(e)}while(-1!==r)}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let n=this.value[r].toString();0!==r&&(e=`${e}.`),t?(n=`{${n}}`,this.value[r].isFirstSid?e=`2.{${n} - 80}`:e+=n):e+=n}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}Al.NAME="ObjectIdentifierValueBlock";class Ac extends EV{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,Al),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}N=Ac,(()=>{Ez.ObjectIdentifier=N})(),Ac.NAME="OBJECT IDENTIFIER";class Au extends EU(Ej){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,r){if(0===r)return t;let n=Ec._H.toUint8Array(e);if(!Ew(this,n,t,r))return -1;let i=n.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let e=0;e<r&&(this.valueHexView[e]=127&i[e],this.blockLength++,(128&i[e])!=0);e++);let s=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength;e++)s[e]=this.valueHexView[e];return(this.valueHexView=s,(128&i[this.blockLength-1])!=0)?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Eu(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let t=this.valueHexView,r=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)r[e]=128|t[e];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}let t=Eh(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",ED;let r=new Uint8Array(t.byteLength);if(!e){let e=new Uint8Array(t),n=t.byteLength-1;for(let t=0;t<n;t++)r[t]=128|e[t];r[n]=e[n]}return r.buffer}toString(){let e="";return this.isHexOnly?Ec.U$.ToHex(this.valueHexView):this.valueDec.toString()}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}Au.NAME="relativeSidBlock";class Ah extends E${constructor({value:e=EN,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let n=t;for(;r>0;){let t=new Au;if(-1===(n=t.fromBER(e,n,r))){this.blockLength=0,this.error=t.error;break}this.blockLength+=t.blockLength,r-=t.blockLength,this.value.push(t)}return n}toBER(e,t){let r=[];for(let t=0;t<this.value.length;t++){let n=this.value[t].toBER(e);if(0===n.byteLength)return this.error=this.value[t].error,ED;r.push(n)}return Eb(r)}fromString(e){this.value=[];let t=0,r=0,n="";do{n=-1===(r=e.indexOf(".",t))?e.substring(t):e.substring(t,r),t=r+1;let i=new Au;if(i.valueDec=parseInt(n,10),isNaN(i.valueDec))break;this.value.push(i)}while(-1!==r);return!0}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let n=this.value[r].toString();0!==r&&(e=`${e}.`),t?e+=n=`{${n}}`:e+=n}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}Ah.NAME="RelativeObjectIdentifierValueBlock";class Ad extends EV{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,Ah),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}D=Ad,(()=>{Ez.RelativeObjectIdentifier=D})(),Ad.NAME="RelativeObjectIdentifier";class Af extends E1{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}B=Af,(()=>{Ez.Sequence=B})(),Af.NAME="SEQUENCE";class Ap extends E1{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}M=Ap,(()=>{Ez.Set=M})(),Ap.NAME="SET";class Ag extends EU(E$){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=EN}toJSON(){return{...super.toJSON(),value:this.value}}}Ag.NAME="StringValueBlock";class Am extends Ag{}Am.NAME="SimpleStringValueBlock";class Ay extends EG{constructor({...e}={}){super(e,Am)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,Ec._H.toUint8Array(e))}fromString(e){let t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);this.valueBlock.value=e}}Ay.NAME="SIMPLE STRING";class Ab extends Ay{fromBuffer(e){this.valueBlock.valueHexView=Ec._H.toUint8Array(e);try{this.valueBlock.value=Ec.U$.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=Ec.U$.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(Ec.U$.FromUtf8String(e)),this.valueBlock.value=e}}Ab.NAME="Utf8StringValueBlock";class Aw extends Ab{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}L=Aw,(()=>{Ez.Utf8String=L})(),Aw.NAME="UTF8String";class Av extends Ay{fromBuffer(e){this.valueBlock.value=Ec.U$.ToUtf16String(e),this.valueBlock.valueHexView=Ec._H.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(Ec.U$.FromUtf16String(e))}}Av.NAME="BmpStringValueBlock";class AE extends Av{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}F=AE,(()=>{Ez.BmpString=F})(),AE.NAME="BMPString";class AA extends Ay{fromBuffer(e){let t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t);for(let e=0;e<r.length;e+=4)r[e]=r[e+3],r[e+1]=r[e+2],r[e+2]=0,r[e+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){let t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(4*t);for(let n=0;n<t;n++){let t=new Uint8Array(Eh(e.charCodeAt(n),8));if(t.length>4)continue;let i=4-t.length;for(let e=t.length-1;e>=0;e--)r[4*n+e+i]=t[e]}this.valueBlock.value=e}}AA.NAME="UniversalStringValueBlock";class Ax extends AA{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}U=Ax,(()=>{Ez.UniversalString=U})(),Ax.NAME="UniversalString";class AS extends Ay{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}j=AS,(()=>{Ez.NumericString=j})(),AS.NAME="NumericString";class Ak extends Ay{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}$=Ak,(()=>{Ez.PrintableString=$})(),Ak.NAME="PrintableString";class A_ extends Ay{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}H=A_,(()=>{Ez.TeletexString=H})(),A_.NAME="TeletexString";class AI extends Ay{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}q=AI,(()=>{Ez.VideotexString=q})(),AI.NAME="VideotexString";class AC extends Ay{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}z=AC,(()=>{Ez.IA5String=z})(),AC.NAME="IA5String";class AT extends Ay{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}V=AT,(()=>{Ez.GraphicString=V})(),AT.NAME="GraphicString";class AP extends Ay{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}K=AP,(()=>{Ez.VisibleString=K})(),AP.NAME="VisibleString";class AR extends Ay{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}G=AR,(()=>{Ez.GeneralString=G})(),AR.NAME="GeneralString";class AO extends Ay{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}W=AO,(()=>{Ez.CharacterString=W})(),AO.NAME="CharacterString";class AN extends AP{constructor({value:e,valueDate:t,...r}={}){if(super(r),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let t=0;t<e.length;t++)this.valueBlock.valueHexView[t]=e.charCodeAt(t)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,Ec._H.toUint8Array(e)))}toBuffer(){let e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){let t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(null===t){this.error="Wrong input string for conversion";return}let r=parseInt(t[1],10);r>=50?this.year=1900+r:this.year=2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}toString(e="iso"){if("iso"===e){let e=Array(7);return e[0]=Em(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=Em(this.month,2),e[2]=Em(this.day,2),e[3]=Em(this.hour,2),e[4]=Em(this.minute,2),e[5]=Em(this.second,2),e[6]="Z",e.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}Q=AN,(()=>{Ez.UTCTime=Q})(),AN.NAME="UTCTime";class AD extends AN{constructor(e={}){var t;super(e),null!=(t=this.millisecond)||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(e){let t,r=!1,n="",i="",s=0,o=0,a=0;if("Z"===e[e.length-1])n=e.substring(0,e.length-1),r=!0;else{if(isNaN(new Number(e[e.length-1]).valueOf()))throw Error("Wrong input string for conversion");n=e}if(r){if(-1!==n.indexOf("+")||-1!==n.indexOf("-"))throw Error("Wrong input string for conversion")}else{let e=1,t=n.indexOf("+"),r="";if(-1===t&&(t=n.indexOf("-"),e=-1),-1!==t){if(r=n.substring(t+1),n=n.substring(0,t),2!==r.length&&4!==r.length)throw Error("Wrong input string for conversion");let i=parseInt(r.substring(0,2),10);if(isNaN(i.valueOf()))throw Error("Wrong input string for conversion");if(o=e*i,4===r.length){if(isNaN((i=parseInt(r.substring(2,4),10)).valueOf()))throw Error("Wrong input string for conversion");a=e*i}}}let l=n.indexOf(".");if(-1===l&&(l=n.indexOf(",")),-1!==l){let e=new Number(`0${n.substring(l)}`);if(isNaN(e.valueOf()))throw Error("Wrong input string for conversion");s=e.valueOf(),i=n.substring(0,l)}else i=n;switch(!0){case 8===i.length:if(t=/(\d{4})(\d{2})(\d{2})/ig,-1!==l)throw Error("Wrong input string for conversion");break;case 10===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,-1!==l){let e=60*s;this.minute=Math.floor(e),e=60*(e-this.minute),this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 12===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,-1!==l){let e=60*s;this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 14===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,-1!==l){let e=1e3*s;this.millisecond=Math.floor(e)}break;default:throw Error("Wrong input string for conversion")}let c=t.exec(i);if(null===c)throw Error("Wrong input string for conversion");for(let e=1;e<c.length;e++)switch(e){case 1:this.year=parseInt(c[e],10);break;case 2:this.month=parseInt(c[e],10);break;case 3:this.day=parseInt(c[e],10);break;case 4:this.hour=parseInt(c[e],10)+o;break;case 5:this.minute=parseInt(c[e],10)+a;break;case 6:this.second=parseInt(c[e],10);break;default:throw Error("Wrong input string for conversion")}if(!1===r){let e=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=e.getUTCFullYear(),this.month=e.getUTCMonth(),this.day=e.getUTCDay(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}}toString(e="iso"){if("iso"===e){let e=[];return e.push(Em(this.year,4)),e.push(Em(this.month,2)),e.push(Em(this.day,2)),e.push(Em(this.hour,2)),e.push(Em(this.minute,2)),e.push(Em(this.second,2)),0!==this.millisecond&&(e.push("."),e.push(Em(this.millisecond,3))),e.push("Z"),e.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}J=AD,(()=>{Ez.GeneralizedTime=J})(),AD.NAME="GeneralizedTime";class AB extends Aw{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}Z=AB,(()=>{Ez.DATE=Z})(),AB.NAME="DATE";class AM extends Aw{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}Y=AM,(()=>{Ez.TimeOfDay=Y})(),AM.NAME="TimeOfDay";class AL extends Aw{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}X=AL,(()=>{Ez.DateTime=X})(),AL.NAME="DateTime";class AF extends Aw{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}ee=AF,(()=>{Ez.Duration=ee})(),AF.NAME="Duration";class AU extends Aw{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}et=AU,(()=>{Ez.TIME=et})(),AU.NAME="TIME";class Aj{constructor({name:e=EN,optional:t=!1}={}){this.name=e,this.optional=t}}class A$ extends Aj{constructor({value:e=[],...t}={}){super(t),this.value=e}}class AH extends Aj{constructor({value:e=new Aj,local:t=!1,...r}={}){super(r),this.value=e,this.local=t}}class Aq{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=Ec._H.toUint8Array(e)}constructor({data:e=EB}={}){this.dataView=Ec._H.toUint8Array(e)}fromBER(e,t,r){let n=t+r;return this.dataView=Ec._H.toUint8Array(e).subarray(t,n),n}toBER(e){return this.dataView.slice().buffer}}function Az(e,t,r){if(r instanceof A$){for(let n of r.value)if(Az(e,t,n).verified)return{verified:!0,result:e};{let e={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty(Ex)&&(e.name=r.name),e}}if(r instanceof Aj)return r.hasOwnProperty(Ex)&&(e[r.name]=t),{verified:!0,result:e};if(e instanceof Object==!1)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object==!1||E_ in r==!1||EP in r.idBlock==!1||ER in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let n=r.idBlock.toBER(!1);if(0===n.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(n,0,n.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty(EI))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty(EC))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty(ET))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if(!(Ek in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(r.idBlock.isHexOnly){if(ES in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let n=r.idBlock.valueHexView,i=t.idBlock.valueHexView;if(n.length!==i.length)return{verified:!1,result:e};for(let t=0;t<n.length;t++)if(n[t]!==i[1])return{verified:!1,result:e}}if(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,EN),r.name&&(e[r.name]=t)),r instanceof Ez.Constructed){let n=0,i={verified:!1,result:{error:"Unknown error"}},s=r.valueBlock.value.length;if(s>0&&r.valueBlock.value[0]instanceof AH&&(s=t.valueBlock.value.length),0===s)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==r.valueBlock.value.length){let t=!0;for(let e=0;e<r.valueBlock.value.length;e++)t=t&&(r.valueBlock.value[e].optional||!1);return t?{verified:!0,result:e}:(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,EN),r.name&&delete e[r.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(let o=0;o<s;o++)if(o-n>=t.valueBlock.value.length){if(!1===r.valueBlock.value[o].optional){let t={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,EN),r.name&&(delete e[r.name],t.name=r.name)),t}}else if(r.valueBlock.value[0]instanceof AH){if(!1===(i=Az(e,t.valueBlock.value[o],r.valueBlock.value[0].value)).verified)if(!r.valueBlock.value[0].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,EN),r.name&&delete e[r.name]),i;else n++;if(Ex in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){let n={};void 0===(n=EO in r.valueBlock.value[0]&&r.valueBlock.value[0].local?t:e)[r.valueBlock.value[0].name]&&(n[r.valueBlock.value[0].name]=[]),n[r.valueBlock.value[0].name].push(t.valueBlock.value[o])}}else if(!1===(i=Az(e,t.valueBlock.value[o-n],r.valueBlock.value[o])).verified)if(!r.valueBlock.value[o].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,EN),r.name&&delete e[r.name]),i;else n++;if(!1===i.verified){let t={verified:!1,result:e};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,EN),r.name&&(delete e[r.name],t.name=r.name)),t}return{verified:!0,result:e}}if(r.primitiveSchema&&ES in t.valueBlock){let n=EZ(t.valueBlock.valueHexView);if(-1===n.offset){let t={verified:!1,result:n.result};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,EN),r.name&&(delete e[r.name],t.name=r.name)),t}return Az(e,n.result,r.primitiveSchema)}return{verified:!0,result:e}}function AV(e,t){if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};let r=EZ(Ec._H.toUint8Array(e));return -1===r.offset?{verified:!1,result:r.result}:Az(r.result,r.result,t)}let AK=16,AG=32,AW=1e4;async function AQ(e,t){let r=El(),n=await r.encrypt(e,t);return a_.base64.encode(n)}async function AJ(e,t,r){if("RSA"===e.type)return A0(e,t,r);if("Ed25519"===e.type)return AZ(e,t,r);if("secp256k1"===e.type)return AY(e,t,r);if("ECDSA"===e.type)return AX(e,t,r);throw new uY}async function AZ(e,t,r="libp2p-key"){if("libp2p-key"===r)return AQ(yf(e),t);throw new uC(`export format '${r}' is not supported`)}async function AY(e,t,r="libp2p-key"){if("libp2p-key"===r)return AQ(yf(e),t);throw new uC("Export format is not supported")}async function AX(e,t,r="libp2p-key"){if("libp2p-key"===r)return AQ(yf(e),t);throw new uC(`export format '${r}' is not supported`)}async function A0(e,t,r="pkcs-8"){if("pkcs-8"===r)return A1(e,t);if("libp2p-key"===r)return AQ(yf(e),t);throw new uC("Export format is not supported")}async function A1(e,t){let r=g3.get(),n=new Af({value:[new As({value:0}),new Af({value:[new Ac({value:"1.2.840.113549.1.1.1"}),new E4]}),new E7({valueHex:e.raw})]}).toBER(),i=new Uint8Array(n,0,n.byteLength),s=Er(AK),o=await v0(v9,t,s,{c:AW,dkLen:AG}),a=Er(16),l=await r.subtle.importKey("raw",o,"AES-CBC",!1,["encrypt"]),c=await r.subtle.encrypt({name:"AES-CBC",iv:a},l,i),u=new Af({value:[new E7({valueHex:s}),new As({value:AW}),new As({value:AG}),new Af({value:[new Ac({value:"1.2.840.113549.2.11"}),new E4]})]}),h=new Af({value:[new Ac({value:"1.2.840.113549.1.5.13"}),new Af({value:[new Af({value:[new Ac({value:"1.2.840.113549.1.5.12"}),u]}),new Af({value:[new Ac({value:"2.16.840.1.101.3.4.1.42"}),new E7({valueHex:a})]})]})]}),d=new Af({value:[h,new E7({valueHex:c})]}).toBER(),f=new Uint8Array(d,0,d.byteLength);return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...(0,uh.d)(f,"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join("\n")}async function A2(e,t){try{let r=await A3(e,t);return yh(r)}catch{}if(!e.includes("BEGIN"))throw new uC("Encrypted key was not a libp2p-key or a PEM file");return A4(e,t)}async function A3(e,t){let r=a_.base64.decode(e);return El().decrypt(r,t)}async function A4(e,t){let r,n=g3.get();if(e.includes("-----BEGIN ENCRYPTED PRIVATE KEY-----")){let{result:i}=EY((0,nm.s)(e.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad")),{iv:s,salt:o,iterations:a,keySize:l,cipherText:c}=A5(i),u=await v0(v9,t,o,{c:a,dkLen:l}),h=await n.subtle.importKey("raw",u,"AES-CBC",!1,["decrypt"]),{result:d}=EY(A8(await n.subtle.decrypt({name:"AES-CBC",iv:s},h,c)));r=A6(d)}else if(e.includes("-----BEGIN PRIVATE KEY-----")){let{result:t}=EY((0,nm.s)(e.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"));r=A6(t)}else throw new uC("Could not parse private key from PEM data");let i=yd(r);if("RSA"!==i.type)throw new uC("Could not parse RSA private key from PEM data");return i}function A5(e){let t=e.valueBlock.value[0];if("OBJECT IDENTIFIER : 1.2.840.113549.1.5.13"!==t.valueBlock.value[0].toString())throw new uC("Only pkcs5PBES2 encrypted private keys are supported");let r=t.valueBlock.value[1].valueBlock.value[0];if("OBJECT IDENTIFIER : 1.2.840.113549.1.5.12"!==r.valueBlock.value[0].toString())throw new uC("Only pkcs5PBKDF2 key derivation functions are supported");let n=r.valueBlock.value[1],i=A8(n.valueBlock.value[0].getValue()),s=AW,o=AG;if(3===n.valueBlock.value.length)s=Number(n.valueBlock.value[1].toBigInt()),o=Number(n.valueBlock.value[2].toBigInt());else if(2===n.valueBlock.value.length)throw new uC("Could not derive key size and iterations from PEM file - please use @libp2p/rsa to re-import your key");let a=t.valueBlock.value[1].valueBlock.value[1],l=a.valueBlock.value[0].toString();if("OBJECT IDENTIFIER : 1.2.840.113549.3.7"===l);else if("OBJECT IDENTIFIER : 1.3.14.3.2.7"===l);else if("OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.2"===l);else if("OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.22"===l);else if("OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.42"===l);else throw new uC("Only AES-CBC encryption schemes are supported");let c=A8(a.valueBlock.value[1].getValue());return{cipherText:A8(e.valueBlock.value[1].getValue()),salt:i,iterations:s,keySize:o,iv:c}}function A6(e){return A8(e.valueBlock.value[2].getValue())}function A8(e){return new Uint8Array(e,0,e.byteLength)}let A7="/pkcs8/",A9="/info/",xe=new WeakMap,xt={minKeyLength:14,minSaltLength:16,minIterationCount:1e3},xr={dek:{keyLength:64,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function xn(e){return null!=e&&"string"==typeof e&&e===Eo(e.trim())&&e.length>0}async function xi(){let e=800*Math.random()+200;await new Promise(t=>setTimeout(t,e))}function xs(e){return new Es.U(A7+e)}function xo(e){return new Es.U(A9+e)}async function xa(e){let t=yf(e),r=await nK.sha256.digest(t);return d8.base58btc.encode(r.bytes).substring(1)}class xl{components;init;log;self;constructor(e,t){if(this.components=e,this.log=e.logger.forComponent("libp2p:keychain"),this.init=lI(xr,t),this.self=t.selfKey??"self",null!=this.init.pass&&this.init.pass?.length<20)throw Error("pass must be least 20 characters");if(this.init.dek?.keyLength!=null&&this.init.dek.keyLength<xt.minKeyLength)throw Error(`dek.keyLength must be least ${xt.minKeyLength} bytes`);if(this.init.dek?.salt?.length!=null&&this.init.dek.salt.length<xt.minSaltLength)throw Error(`dek.saltLength must be least ${xt.minSaltLength} bytes`);if(this.init.dek?.iterationCount!=null&&this.init.dek.iterationCount<xt.minIterationCount)throw Error(`dek.iterationCount must be least ${xt.minIterationCount}`);let r=null!=this.init.pass&&this.init.dek?.salt!=null?Et(this.init.pass,this.init.dek?.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";xe.set(this,{dek:r})}[Symbol.toStringTag]="@libp2p/keychain";[En]=["@libp2p/keychain"];static generateOptions(){let e=Object.assign({},xr),t=3*Math.ceil(xt.minSaltLength/3);return e.dek.salt=(0,uh.d)(Er(t),"base64"),e}static get options(){return xr}async findKeyByName(e){if(!xn(e))throw await xi(),new uC(`Invalid key name '${e}'`);let t=xo(e);try{let e=await this.components.datastore.get(t);return JSON.parse((0,uh.d)(e))}catch(t){throw await xi(),this.log.error(t),new uL(`Key '${e}' does not exist.`)}}async findKeyById(e){try{let t={prefix:A9};for await(let r of this.components.datastore.query(t)){let t=JSON.parse((0,uh.d)(r.value));if(t.id===e)return t}throw new uC(`Key with id '${e}' does not exist.`)}catch(e){throw await xi(),e}}async importKey(e,t){let r,n;if(!xn(e))throw await xi(),new uC(`Invalid key name '${e}'`);if(null==t)throw await xi(),new uC("Key is required");let i=xs(e);if(await this.components.datastore.has(i))throw await xi(),new uC(`Key '${e}' already exists`);try{r=await xa(t);let e=xe.get(this);if(null==e)throw new uC("dek missing");let i=e.dek;n=await AJ(t,i,"RSA"===t.type?"pkcs-8":"libp2p-key")}catch(e){throw await xi(),e}let s={name:e,id:r},o=this.components.datastore.batch();return o.put(i,(0,nm.s)(n)),o.put(xo(e),(0,nm.s)(JSON.stringify(s))),await o.commit(),s}async exportKey(e){if(!xn(e))throw await xi(),new uC(`Invalid key name '${e}'`);let t=xs(e);try{let e=await this.components.datastore.get(t),r=(0,uh.d)(e),n=xe.get(this);if(null==n)throw new uC("dek missing");let i=n.dek;return await A2(r,i)}catch(e){throw await xi(),e}}async removeKey(e){if(!xn(e)||e===this.self)throw await xi(),new uC(`Invalid key name '${e}'`);let t=xs(e),r=await this.findKeyByName(e),n=this.components.datastore.batch();return n.delete(t),n.delete(xo(e)),await n.commit(),r}async listKeys(){let e={prefix:A9},t=[];for await(let r of this.components.datastore.query(e))t.push(JSON.parse((0,uh.d)(r.value)));return t}async renameKey(e,t){if(!xn(e)||e===this.self)throw await xi(),new uC(`Invalid old key name '${e}'`);if(!xn(t)||t===this.self)throw await xi(),new uC(`Invalid new key name '${t}'`);let r=xs(e),n=xs(t),i=xo(e),s=xo(t);if(await this.components.datastore.has(n))throw await xi(),new uC(`Key '${t}' already exists`);try{let e=await this.components.datastore.get(r),o=await this.components.datastore.get(i),a=JSON.parse((0,uh.d)(o));a.name=t;let l=this.components.datastore.batch();return l.put(n,e),l.put(s,(0,nm.s)(JSON.stringify(a))),l.delete(r),l.delete(i),await l.commit(),a}catch(e){throw await xi(),e}}async rotateKeychainPass(e,t){if("string"!=typeof e)throw await xi(),new uC(`Invalid old pass type '${typeof e}'`);if("string"!=typeof t)throw await xi(),new uC(`Invalid new pass type '${typeof t}'`);if(t.length<20)throw await xi(),new uC(`Invalid pass length ${t.length}`);this.log("recreating keychain");let r=xe.get(this);if(null==r)throw new uC("dek missing");let n=r.dek;this.init.pass=t;let i=null!=t&&this.init.dek?.salt!=null?Et(t,this.init.dek.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";for(let e of(xe.set(this,{dek:i}),await this.listKeys())){let t=await this.components.datastore.get(xs(e.name)),r=(0,uh.d)(t),s=await A2(r,n),o=i.toString(),a=await AJ(s,o,"RSA"===s.type?"pkcs-8":"libp2p-key"),l=this.components.datastore.batch(),c={name:e.name,id:e.id};l.put(xs(e.name),(0,nm.s)(a)),l.put(xo(e.name),(0,nm.s)(JSON.stringify(c))),await l.commit()}this.log("keychain reconstructed")}}function xc(e={}){return t=>new xl(t,e)}async function xu(e,t={}){let r,n=t.selfKey??"self",i=xc(t)({datastore:e,logger:(0,lC.Um)()});return await e.has(new u7.U(`/pkcs8/${n}`))?r=await i.exportKey(n):(r=await yo(t.keyType??"Ed25519"),await i.importKey(n,r)),r}let xh=Symbol.for("@libp2p/transport");!function(e){e[e.FATAL_ALL=0]="FATAL_ALL",e[e.NO_FATAL=1]="NO_FATAL"}(er||(er={}));let xd=32,{code:xf}=bT("dnsaddr");class xp extends Error{constructor(e="Max recursive depth reached"){super(e),this.name="RecursionLimitError"}}let xg=async function(e,t={}){let r=t.maxRecursiveDepth??xd;if(0===r)throw new xp("Max recursive depth reached");let[,n]=e.stringTuples().find(([e])=>e===xf)??[],i=t?.dns??uA(),s=await i.query(`_dnsaddr.${n}`,{signal:t?.signal,types:[l.TXT]}),o=e.getPeerId(),a=[];for(let e of s.Answer){let n=e.data.replace(/["']/g,"").trim().split("=")[1];if(null==n||null!=o&&!n.includes(o))continue;let i=wt(n);if(n.startsWith("/dnsaddr")){let e=await i.resolve({...t,maxRecursiveDepth:r-1});a.push(...e.map(e=>e.toString()))}else a.push(i.toString())}return a},xm={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:e=>e},connectionManager:{resolvers:{dnsaddr:xg}},transportManager:{faultTolerance:er.FATAL_ALL}};async function xy(e){let t=lI(xm,e);if(null===t.connectionProtector&&globalThis.process?.env?.LIBP2P_FORCE_PNET!=null)throw new uC("Private network is enforced, but no protector was provided");return t}let xb=Symbol.for("@libp2p/peer-discovery");class xw{set;constructor(e){if(this.set=new Set,null!=e)for(let t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return yM(this.set.entries(),e=>{let t=yL(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{let r=yL(t);e(r,r,this)})}has(e){return this.set.has(e.toString())}values(){return yM(this.set.values(),e=>yL(e))}intersection(e){let t=new xw;for(let r of e)this.has(r)&&t.add(r);return t}difference(e){let t=new xw;for(let r of this)e.has(r)||t.add(r);return t}union(e){let t=new xw;for(let r of e)t.add(r);for(let e of this)t.add(e);return t}}function xv(){return new xw}!function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.publicKey&&e.publicKey.byteLength>0&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.payloadType&&e.payloadType.byteLength>0&&(t.uint32(18),t.bytes(e.payloadType)),null!=e.payload&&e.payload.byteLength>0&&(t.uint32(26),t.bytes(e.payload)),null!=e.signature&&e.signature.byteLength>0&&(t.uint32(42),t.bytes(e.signature)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={publicKey:(0,t9.c)(0),payloadType:(0,t9.c)(0),payload:(0,t9.c)(0),signature:(0,t9.c)(0)},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.publicKey=e.bytes();break;case 2:n.payloadType=e.bytes();break;case 3:n.payload=e.bytes();break;case 5:n.signature=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(en||(en={}));class xE extends Error{constructor(e="Invalid signature"){super(e),this.name="InvalidSignatureError"}}class xA{static createFromProtobuf=async e=>{let t=en.decode(e);return new xA({publicKey:ya(t.publicKey),payloadType:t.payloadType,payload:t.payload,signature:t.signature})};static seal=async(e,t)=>{if(null==t)throw Error("Missing private key");let r=e.domain,n=e.codec,i=e.marshal(),s=xx(r,n,i),o=await t.sign(s.subarray());return new xA({publicKey:t.publicKey,payloadType:n,payload:i,signature:o})};static openAndCertify=async(e,t)=>{let r=await xA.createFromProtobuf(e);if(!await r.validate(t))throw new xE("Envelope signature is not valid for the given domain");return r};publicKey;payloadType;payload;signature;marshaled;constructor(e){let{publicKey:t,payloadType:r,payload:n,signature:i}=e;this.publicKey=t,this.payloadType=r,this.payload=n,this.signature=i}marshal(){return null==this.marshaled&&(this.marshaled=en.encode({publicKey:yu(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return rr(this.marshal(),e.marshal())}async validate(e){let t=xx(e,this.payloadType,this.payload);return this.publicKey.verify(t.subarray(),this.signature)}}let xx=(e,t,r)=>{let n=(0,nm.s)(e),i=r3(n.byteLength);return new ro(i,n,r3(t.length),t,r3(r.length),r)};function xS(e,t){let r=(e,t)=>e.toString().localeCompare(t.toString());return e.length===t.length&&(t.sort(r),e.sort(r).every((e,r)=>t[r].equals(e)))}let xk="libp2p-peer-record",x_=Uint8Array.from([3,1]);!function(e){let t,r;!function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.multiaddr&&e.multiaddr.byteLength>0&&(t.uint32(10),t.bytes(e.multiaddr)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={multiaddr:(0,t9.c)(0)},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();t>>>3==1?n.multiaddr=e.bytes():e.skipType(7&t)}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(t=e.AddressInfo||(e.AddressInfo={})),e.codec=()=>(null==r&&(r=nM((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.peerId&&t.peerId.byteLength>0&&(r.uint32(10),r.bytes(t.peerId)),null!=t.seq&&0n!==t.seq&&(r.uint32(16),r.uint64(t.seq)),null!=t.addresses)for(let n of t.addresses)r.uint32(26),e.AddressInfo.codec().encode(n,r);!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={peerId:(0,t9.c)(0),seq:0n,addresses:[]},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.peerId=t.bytes();break;case 2:i.seq=t.uint64();break;case 3:if(n.limits?.addresses!=null&&i.addresses.length===n.limits.addresses)throw new nL('Decode error - map field "addresses" had too many elements');i.addresses.push(e.AddressInfo.codec().decode(t,t.uint32(),{limits:n.limits?.addresses$}));break;default:t.skipType(7&r)}}return i})),r),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(ei||(ei={}));class xI{static createFromProtobuf=e=>{let t=ei.decode(e),r=yO(aG.decode(t.peerId));return new xI({peerId:r,multiaddrs:(t.addresses??[]).map(e=>wt(e.multiaddr)),seqNumber:t.seq})};static DOMAIN=xk;static CODEC=x_;peerId;multiaddrs;seqNumber;domain=xI.DOMAIN;codec=xI.CODEC;marshaled;constructor(e){let{peerId:t,multiaddrs:r,seqNumber:n}=e;this.peerId=t,this.multiaddrs=r??[],this.seqNumber=n??BigInt(Date.now())}marshal(){return null==this.marshaled&&(this.marshaled=ei.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return e instanceof xI&&!!this.peerId.equals(e.peerId)&&this.seqNumber===e.seqNumber&&!!xS(this.multiaddrs,e.multiaddrs)}}let xC=36e5,xT=216e5;function xP(e,t){let r;if(null!=e.publicKey||null==t.publicKey)return e;if("RSA"===e.type){let t=d8.base58btc.decode(`z${e}`);r=aG.decode(t)}return yP(ya(t.publicKey,r))}function xR(e,t,r){return xO(e,es.decode(t),r)}function xO(e,t,r){let n=new Map,i=BigInt(Date.now());for(let[e,r]of t.tags.entries())null!=r.expiry&&r.expiry<i||n.set(e,r);return{...t,id:xP(e,t),addresses:t.addresses.filter(({observed:e})=>null!=e&&e>Date.now()-r).map(({multiaddr:e,isCertified:t})=>({multiaddr:wt(e),isCertified:t??!1})),metadata:t.metadata,peerRecordEnvelope:t.peerRecordEnvelope??void 0,tags:n}}function xN(e,t){return xD(e.addresses,t.addresses)&&xB(e.protocols,t.protocols)&&xM(e.publicKey,t.publicKey)&&xL(e.peerRecordEnvelope,t.peerRecordEnvelope)&&xF(e.metadata,t.metadata)&&xU(e.tags,t.tags)}function xD(e,t){return x$(e,t,(e,t)=>e.isCertified===t.isCertified&&!!rr(e.multiaddr,t.multiaddr))}function xB(e,t){return x$(e,t,(e,t)=>e===t)}function xM(e,t){return xj(e,t)}function xL(e,t){return xj(e,t)}function xF(e,t){return xH(e,t,(e,t)=>rr(e,t))}function xU(e,t){return xH(e,t,(e,t)=>e.value===t.value&&e.expiry===t.expiry)}function xj(e,t){return null==e&&null==t||null!=e&&null!=t&&rr(e,t)}function x$(e,t,r){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!r(e[n],t[n]))return!1;return!0}function xH(e,t,r){if(e.size!==t.size)return!1;for(let[n,i]of e.entries()){let e=t.get(n);if(null==e||!r(i,e))return!1}return!0}!function(e){let t,r,n;!function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.key&&""!==e.key&&(t.uint32(10),t.string(e.key)),null!=e.value&&e.value.byteLength>0&&(t.uint32(18),t.bytes(e.value)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={key:"",value:(0,t9.c)(0)},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.key=e.string();break;case 2:n.value=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(t=e.Peer$metadataEntry||(e.Peer$metadataEntry={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.key&&""!==e.key&&(t.uint32(10),t.string(e.key)),null!=e.value&&(t.uint32(18),ea.codec().encode(e.value,t)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={key:""},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.key=e.string();break;case 2:n.value=ea.codec().decode(e,e.uint32(),{limits:r.limits?.value});break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(r=e.Peer$tagsEntry||(e.Peer$tagsEntry={})),e.codec=()=>(null==n&&(n=nM((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.addresses)for(let e of t.addresses)r.uint32(10),eo.codec().encode(e,r);if(null!=t.protocols)for(let e of t.protocols)r.uint32(18),r.string(e);if(null!=t.publicKey&&(r.uint32(34),r.bytes(t.publicKey)),null!=t.peerRecordEnvelope&&(r.uint32(42),r.bytes(t.peerRecordEnvelope)),null!=t.metadata&&0!==t.metadata.size)for(let[n,i]of t.metadata.entries())r.uint32(50),e.Peer$metadataEntry.codec().encode({key:n,value:i},r);if(null!=t.tags&&0!==t.tags.size)for(let[n,i]of t.tags.entries())r.uint32(58),e.Peer$tagsEntry.codec().encode({key:n,value:i},r);null!=t.updated&&(r.uint32(64),r.uint64Number(t.updated)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={addresses:[],protocols:[],metadata:new Map,tags:new Map},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:if(n.limits?.addresses!=null&&i.addresses.length===n.limits.addresses)throw new nL('Decode error - map field "addresses" had too many elements');i.addresses.push(eo.codec().decode(t,t.uint32(),{limits:n.limits?.addresses$}));break;case 2:if(n.limits?.protocols!=null&&i.protocols.length===n.limits.protocols)throw new nL('Decode error - map field "protocols" had too many elements');i.protocols.push(t.string());break;case 4:i.publicKey=t.bytes();break;case 5:i.peerRecordEnvelope=t.bytes();break;case 6:{if(n.limits?.metadata!=null&&i.metadata.size===n.limits.metadata)throw new nF('Decode error - map field "metadata" had too many elements');let r=e.Peer$metadataEntry.codec().decode(t,t.uint32());i.metadata.set(r.key,r.value);break}case 7:{if(n.limits?.tags!=null&&i.tags.size===n.limits.tags)throw new nF('Decode error - map field "tags" had too many elements');let r=e.Peer$tagsEntry.codec().decode(t,t.uint32(),{limits:{value:n.limits?.tags$value}});i.tags.set(r.key,r.value);break}case 8:i.updated=t.uint64Number();break;default:t.skipType(7&r)}}return i})),n),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(es||(es={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.multiaddr&&e.multiaddr.byteLength>0&&(t.uint32(10),t.bytes(e.multiaddr)),null!=e.isCertified&&(t.uint32(16),t.bool(e.isCertified)),null!=e.observed&&(t.uint32(24),t.uint64Number(e.observed)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={multiaddr:(0,t9.c)(0)},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.multiaddr=e.bytes();break;case 2:n.isCertified=e.bool();break;case 3:n.observed=e.uint64Number();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(eo||(eo={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.value&&0!==e.value&&(t.uint32(8),t.uint32(e.value)),null!=e.expiry&&(t.uint32(16),t.uint64(e.expiry)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={value:0},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.value=e.uint32();break;case 2:n.expiry=e.uint64();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(ea||(ea={}));let xq="/peers/";function xz(e){if(!yb(e)||null==e.type)throw new uC("Invalid PeerId");let t=e.toCID().toString();return new Es.U(`${xq}${t}`)}async function xV(e,t,r,n){let i=new Map;for(let n of r){if(null==n)continue;if(n.multiaddr instanceof Uint8Array&&(n.multiaddr=wt(n.multiaddr)),!we(n.multiaddr))throw new uC("Multiaddr was invalid");if(!await t(e,n.multiaddr))continue;let r=n.isCertified??!1,s=n.multiaddr.toString(),o=i.get(s);null!=o?n.isCertified=o.isCertified||r:i.set(s,{multiaddr:n.multiaddr,isCertified:r})}return[...i.values()].sort((e,t)=>e.multiaddr.toString().localeCompare(t.multiaddr.toString())).map(({isCertified:e,multiaddr:t})=>({isCertified:e,multiaddr:t.bytes}))}async function xK(e,t,r,n){let i;if(null==t)throw new uC("Invalid PeerData");if(null!=t.publicKey&&null!=e.publicKey&&!t.publicKey.equals(e.publicKey))throw new uC("publicKey bytes do not match peer id publicKey bytes");let s=n.existingPeer?.peer;if(null!=s&&!e.equals(s.id))throw new uC("peer id did not match existing peer id");let o=s?.addresses??[],a=new Set(s?.protocols??[]),l=s?.metadata??new Map,c=s?.tags??new Map,u=s?.peerRecordEnvelope;if("patch"===r&&((null!=t.multiaddrs||null!=t.addresses)&&(o=[],null!=t.multiaddrs&&o.push(...t.multiaddrs.map(e=>({isCertified:!1,multiaddr:e}))),null!=t.addresses&&o.push(...t.addresses)),null!=t.protocols&&(a=new Set(t.protocols)),null!=t.metadata&&(l=xG(t.metadata instanceof Map?[...t.metadata.entries()]:Object.entries(t.metadata),{validate:xW})),null!=t.tags&&(c=xG(t.tags instanceof Map?[...t.tags.entries()]:Object.entries(t.tags),{validate:xQ,map:xJ})),null!=t.peerRecordEnvelope&&(u=t.peerRecordEnvelope)),"merge"===r){if(null!=t.multiaddrs&&o.push(...t.multiaddrs.map(e=>({isCertified:!1,multiaddr:e}))),null!=t.addresses&&o.push(...t.addresses),null!=t.protocols&&(a=new Set([...a,...t.protocols])),null!=t.metadata){for(let[e,r]of t.metadata instanceof Map?[...t.metadata.entries()]:Object.entries(t.metadata))null==r?l.delete(e):l.set(e,r);l=xG([...l.entries()],{validate:xW})}if(null!=t.tags){let e=t.tags instanceof Map?[...t.tags.entries()]:Object.entries(t.tags),r=new Map(c);for(let[t,n]of e)null==n?r.delete(t):r.set(t,n);c=xG([...r.entries()],{validate:xQ,map:xJ})}null!=t.peerRecordEnvelope&&(u=t.peerRecordEnvelope)}s?.id.publicKey!=null?i=yu(s.id.publicKey):null!=t.publicKey?i=yu(t.publicKey):null!=e.publicKey&&(i=yu(e.publicKey));let h={addresses:await xV(e,n.addressFilter??(async()=>!0),o,n.existingPeer?.peerPB.addresses),protocols:[...a.values()].sort((e,t)=>e.localeCompare(t)),metadata:l,tags:c,publicKey:i,peerRecordEnvelope:u};return h.addresses.forEach(e=>{e.observed=n.existingPeer?.peerPB.addresses?.find(e=>rr(e.multiaddr,e.multiaddr))?.observed??Date.now()}),"RSA"!==e.type&&delete h.publicKey,h}function xG(e,t){let r=new Map;for(let[r,n]of e)null!=n&&t.validate(r,n);for(let[n,i]of e.sort(([e],[t])=>e.localeCompare(t)))null!=i&&r.set(n,t.map?.(n,i)??i);return r}function xW(e,t){if("string"!=typeof e)throw new uC("Metadata key must be a string");if(!(t instanceof Uint8Array))throw new uC("Metadata value must be a Uint8Array")}function xQ(e,t){if("string"!=typeof e)throw new uC("Tag name must be a string");if(null!=t.value){if(parseInt(`${t.value}`,10)!==t.value)throw new uC("Tag value must be an integer");if(t.value<0||t.value>100)throw new uC("Tag value must be between 0-100")}if(null!=t.ttl){if(parseInt(`${t.ttl}`,10)!==t.ttl)throw new uC("Tag ttl must be an integer");if(t.ttl<0)throw new uC("Tag ttl must be between greater than 0")}}function xJ(e,t){let r;return null!=t.expiry&&(r=t.expiry),null!=t.ttl&&(r=BigInt(Date.now()+Number(t.ttl))),{value:t.value??0,expiry:r}}function xZ(e){let t=e.toString().split("/")[2];return yN(rc.TO.parse(t,by.base32))}function xY(e,t,r){return xR(xZ(e),t,r)}function xX(e,t){return{prefix:xq,filters:(e.filters??[]).map(e=>({key:r,value:n})=>e(xY(r,n,t))),orders:(e.orders??[]).map(e=>(r,n)=>e(xY(r.key,r.value,t),xY(n.key,n.value,t)))}}class x0{peerId;datastore;lock;addressFilter;log;maxAddressAge;maxPeerAge;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-store"),this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.lock=h$({name:"peer-store",singleProcess:!0}),this.maxAddressAge=t.maxAddressAge??xC,this.maxPeerAge=t.maxPeerAge??xT}async has(e){try{return await this.load(e),!0}catch(e){if("NotFoundError"!==e.name)throw e}return!1}async delete(e){this.peerId.equals(e)||await this.datastore.delete(xz(e))}async load(e){let t=xz(e),r=await this.datastore.get(t),n=es.decode(r);if(this.#U(e,n))throw await this.datastore.delete(t),new uL;return xO(e,n,this.peerId.equals(e)?1/0:this.maxAddressAge)}async save(e,t){let r=await this.#j(e),n=await xK(e,t,"patch",{addressFilter:this.addressFilter});return this.#$(e,n,r)}async patch(e,t){let r=await this.#j(e),n=await xK(e,t,"patch",{addressFilter:this.addressFilter,existingPeer:r});return this.#$(e,n,r)}async merge(e,t){let r=await this.#j(e),n=await xK(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:r});return this.#$(e,n,r)}async *all(e){for await(let{key:t,value:r}of this.datastore.query(xX(e??{},this.maxAddressAge))){let e=xZ(t);if(e.equals(this.peerId))continue;let n=es.decode(r);if(this.#U(e,n)){await this.datastore.delete(t);continue}yield xO(e,n,this.peerId.equals(e)?1/0:this.maxAddressAge)}}async #j(e){try{let t=xz(e),r=await this.datastore.get(t),n=es.decode(r);if(this.#U(e,n))throw await this.datastore.delete(t),new uL;return{peerPB:n,peer:xR(e,r,this.maxAddressAge)}}catch(e){"NotFoundError"!==e.name&&this.log.error("invalid peer data found in peer store - %e",e)}}async #$(e,t,r){t.updated=Date.now();let n=es.encode(t);return await this.datastore.put(xz(e),n),{peer:xR(e,n,this.maxAddressAge),previous:r?.peer,updated:null==r||!xN(t,r.peerPB)}}#U(e,t){if(null==t.updated)return!0;if(this.peerId.equals(e))return!1;let r=t.updated<Date.now()-this.maxPeerAge,n=Date.now()-this.maxAddressAge,i=t.addresses.filter(e=>null!=e.observed&&e.observed>n);return r&&0===i.length}}class x1{store;events;peerId;log;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new x0(e,t)}[Symbol.toStringTag]="@libp2p/peer-store";async forEach(e,t){this.log.trace("forEach await read lock");let r=await this.store.lock.readLock();this.log.trace("forEach got read lock");try{for await(let r of this.store.all(t))e(r)}finally{this.log.trace("forEach release read lock"),r()}}async all(e){this.log.trace("all await read lock");let t=await this.store.lock.readLock();this.log.trace("all got read lock");try{return await (0,lT.A)(this.store.all(e))}finally{this.log.trace("all release read lock"),t()}}async delete(e){this.log.trace("delete await write lock");let t=await this.store.lock.writeLock();this.log.trace("delete got write lock");try{await this.store.delete(e)}finally{this.log.trace("delete release write lock"),t()}}async has(e){this.log.trace("has await read lock");let t=await this.store.lock.readLock();this.log.trace("has got read lock");try{return await this.store.has(e)}finally{this.log.trace("has release read lock"),t()}}async get(e){this.log.trace("get await read lock");let t=await this.store.lock.readLock();this.log.trace("get got read lock");try{return await this.store.load(e)}finally{this.log.trace("get release read lock"),t()}}async save(e,t){this.log.trace("save await write lock");let r=await this.store.lock.writeLock();this.log.trace("save got write lock");try{let r=await this.store.save(e,t);return this.#H(e,r),r.peer}finally{this.log.trace("save release write lock"),r()}}async patch(e,t){this.log.trace("patch await write lock");let r=await this.store.lock.writeLock();this.log.trace("patch got write lock");try{let r=await this.store.patch(e,t);return this.#H(e,r),r.peer}finally{this.log.trace("patch release write lock"),r()}}async merge(e,t){this.log.trace("merge await write lock");let r=await this.store.lock.writeLock();this.log.trace("merge got write lock");try{let r=await this.store.merge(e,t);return this.#H(e,r),r.peer}finally{this.log.trace("merge release write lock"),r()}}async consumePeerRecord(e,t){let r,n=await xA.openAndCertify(e,xI.DOMAIN),i=yN(n.publicKey.toCID());if(t?.equals(i)===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",t,i),!1;let s=xI.createFromProtobuf(n.payload);try{r=await this.get(i)}catch(e){if("NotFoundError"!==e.name)throw e}if(r?.peerRecordEnvelope!=null){let e=await xA.createFromProtobuf(r.peerRecordEnvelope),t=xI.createFromProtobuf(e.payload);if(t.seqNumber>=s.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",t.seqNumber,s.seqNumber),!1}return await this.patch(s.peerId,{peerRecordEnvelope:e,addresses:s.multiaddrs.map(e=>({isCertified:!0,multiaddr:e}))}),!0}#H(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))}}function x2(e,t={}){return new x1(e,t)}var x3=r(3972);function x4(e,t){let r,n=function(){let n=function(){r=void 0,e()};clearTimeout(r),r=setTimeout(n,t)};return n.start=()=>{},n.stop=()=>{clearTimeout(r)},n}let x5=864e13,x6=448,x8=449,x7=53,x9=54,Se=55,St=56;class Sr{log;mappings;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=new Map}has(e){let t=this.findHost(e);for(let e of this.mappings.values())if(e.domain===t)return!0;return!1}add(e,t){t.forEach(t=>{this.log("add DNS mapping %s to %s",t,e);let r=!0===ww(t);this.mappings.set(t,{domain:e,verified:r,expires:r?x5-Date.now():0,lastVerified:r?x5-Date.now():void 0})})}remove(e){let t=this.findHost(e),r=!1;for(let[e,n]of this.mappings.entries())n.domain===t&&(this.log("removing %s to %s DNS mapping %e",e,n.domain,Error("where")),this.mappings.delete(e),r=r||n.verified);return r}getAll(e){let t=[];for(let r=0;r<e.length;r++){let n=e[r].multiaddr.stringTuples(),i=n[0][1];if(null!=i)for(let[s,o]of this.mappings.entries())i===s&&this.maybeAddSNITuple(n,o.domain)&&(e.splice(r,1),r--,t.push({multiaddr:wt(`/${n.map(e=>[bT(e[0]).name,e[1]].join("/")).join("/")}`),verified:o.verified,type:"dns-mapping",expires:o.expires,lastVerified:o.lastVerified}))}return t}maybeAddSNITuple(e,t){for(let r=0;r<e.length;r++)if(e[r][0]===x6&&e[r+1]?.[0]!==x8)return e.splice(r+1,0,[x8,t]),!0;return!1}confirm(e,t){let r=this.findHost(e),n=!1;for(let[e,i]of this.mappings.entries())i.domain===r&&(this.log("marking %s to %s DNS mapping as verified",e,i.domain),n=i.verified,i.verified=!0,i.expires=Date.now()+t,i.lastVerified=Date.now());return n}unconfirm(e,t){let r=this.findHost(e),n=!1;for(let[e,i]of this.mappings.entries())i.domain===r&&(this.log("removing verification of %s to %s DNS mapping",e,i.domain),n=n||i.verified,i.verified=!1,i.expires=Date.now()+t);return n}findHost(e){for(let t of e.stringTuples())if(t[0]===x8||t[0]===x7||t[0]===x9||t[0]===Se||t[0]===St)return t[1]}}let Sn=4,Si=41,Ss=6,So=273;class Sa{log;mappings;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=new Map}has(e){let t=e.stringTuples();for(let e of this.mappings.values())for(let r of e)if(r.externalIp===t[0][1])return!0;return!1}add(e,t,r,n=t,i="tcp"){let s=`${e}-${t}-${i}`,o=this.mappings.get(s)??[],a={internalIp:e,internalPort:t,externalIp:r,externalPort:n,externalFamily:bw(r)?4:6,protocol:i,verified:!1,expires:0};o.push(a),this.mappings.set(s,o)}remove(e){let t=e.stringTuples(),r=t[0][1]??"",n=t[1][0]===Ss?"tcp":"udp",i=parseInt(t[1][1]??"0"),s=!1;for(let[e,t]of this.mappings.entries()){for(let e=0;e<t.length;e++){let o=t[e];o.externalIp===r&&o.externalPort===i&&o.protocol===n&&(this.log("removing %s:%s to %s:%s %s IP mapping",o.externalIp,o.externalPort,r,i,n),s=s||o.verified,t.splice(e,1),e--)}0===t.length&&this.mappings.delete(e)}return s}getAll(e){let t=[];for(let{multiaddr:r}of e){let e,n=r.stringTuples();if((n[0][0]===Sn||n[0][0]===Si)&&n[1][0]===Ss?e=`${n[0][1]}-${n[1][1]}-tcp`:(n[0][0]===Sn||n[0][0]===Si)&&n[1][0]===So&&(e=`${n[0][1]}-${n[1][1]}-udp`),null==e)continue;let i=this.mappings.get(e);if(null!=i)for(let e of i)n[0][0]=4===e.externalFamily?Sn:Si,n[0][1]=e.externalIp,n[1][1]=`${e.externalPort}`,t.push({multiaddr:wt(`/${n.map(e=>[bT(e[0]).name,e[1]].join("/")).join("/")}`),verified:e.verified,type:"ip-mapping",expires:e.expires,lastVerified:e.lastVerified})}return t}confirm(e,t){let r=e.stringTuples()[0][1],n=!1;for(let e of this.mappings.values())for(let i of e)i.externalIp===r&&(this.log("marking %s to %s IP mapping as verified",i.internalIp,i.externalIp),n=i.verified,i.verified=!0,i.expires=Date.now()+t,i.lastVerified=Date.now());return n}unconfirm(e,t){let r=e.stringTuples(),n=r[0][1]??"",i=r[1][0]===Ss?"tcp":"udp",s=parseInt(r[1][1]??"0"),o=!1;for(let e of this.mappings.values())for(let r=0;r<e.length;r++){let a=e[r];a.externalIp===n&&a.externalPort===s&&a.protocol===i&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",a.externalIp,a.externalPort,n,s,i),o=o||a.verified,a.verified=!1,a.expires=Date.now()+t)}return o}}let Sl=4,Sc=41;function Su(e){try{let[[t,r]]=e.stringTuples();if(null==r)return!1;if(t===Sl)return r.startsWith("169.254.");if(t===Sc)return r.toLowerCase().startsWith("fe80")}catch{}return!1}let Sh=4,Sd=41;function Sf(e){try{let[[t]]=e.stringTuples();return t===Sh||t===Sd}catch{}return!1}function Sp(e){try{if(!Sf(e))return!1;let[[,t]]=e.stringTuples();if(null==t)return!1;return ww(t)??!1}catch{}return!0}let Sg={maxObservedAddresses:10};class Sm{log;addresses;maxObservedAddresses;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??Sg.maxObservedAddresses}has(e){return this.addresses.has(e.toString())}removePrefixed(e){for(let t of this.addresses.keys())t.toString().startsWith(e)&&this.addresses.delete(t)}add(e){this.addresses.size!==this.maxObservedAddresses&&(Sp(e)||Su(e)||(this.log("adding observed address %a",e),this.addresses.set(e.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([e,t])=>({multiaddr:wt(e),verified:t.verified,type:"observed",expires:t.expires,lastVerified:t.lastVerified}))}remove(e){let t=this.addresses.get(e.toString())?.verified??!1;return this.log("removing observed address %a",e),this.addresses.delete(e.toString()),t}confirm(e,t){let r=e.toString(),n=this.addresses.get(r)??{verified:!1,expires:Date.now()+t,lastVerified:Date.now()},i=n.verified;return n.verified=!0,n.expires=Date.now()+t,n.lastVerified=Date.now(),this.log("marking observed address %a as verified",r),this.addresses.set(r,n),i}}let Sy=[4,41,53,54,55,56];function Sb(e){try{let[[t]]=e.stringTuples();return Sy.includes(t)}catch{}return!1}let Sw={maxObservedAddresses:10};class Sv{log;addresses;maxObservedAddresses;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??Sw.maxObservedAddresses}get(e,t){if(Sp(e))return{multiaddr:e,verified:!0,type:"transport",expires:Date.now()+t,lastVerified:Date.now()};let r=this.toKey(e),n=this.addresses.get(r);return null==n&&(n={verified:!Sb(e),expires:0},this.addresses.set(r,n)),{multiaddr:e,verified:n.verified,type:"transport",expires:n.expires,lastVerified:n.lastVerified}}has(e){let t=this.toKey(e);return this.addresses.has(t)}remove(e){let t=this.toKey(e),r=this.addresses.get(t)?.verified??!1;return this.log("removing observed address %a",e),this.addresses.delete(t),r}confirm(e,t){let r=this.toKey(e),n=this.addresses.get(r)??{verified:!1,expires:0,lastVerified:0},i=n.verified;return n.verified=!0,n.expires=Date.now()+t,n.lastVerified=Date.now(),this.addresses.set(r,n),i}unconfirm(e,t){let r=this.toKey(e),n=this.addresses.get(r)??{verified:!1,expires:0},i=n.verified;return n.verified=!1,n.expires=Date.now()+t,this.addresses.set(r,n),i}toKey(e){if(Sb(e)){let t=e.toOptions();return`${t.host}-${t.port}-${t.transport}`}return e.toString()}}let SE={addressVerificationTTL:6e5,addressVerificationRetry:3e5},SA=e=>e;function Sx(e,t){let r=e.getPeerId();return null!=r&&yT(r).equals(t)&&(e=e.decapsulate(wt(`/p2p/${t.toString()}`))),e}class SS{log;components;listen;announce;appendAnnounce;announceFilter;observed;dnsMappings;ipMappings;transportAddresses;observedAddressFilter;addressVerificationTTL;addressVerificationRetry;constructor(e,t={}){let{listen:r=[],announce:n=[],appendAnnounce:i=[]}=t;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=r.map(e=>e.toString()),this.announce=new Set(n.map(e=>e.toString())),this.appendAnnounce=new Set(i.map(e=>e.toString())),this.observed=new Sm(e,t),this.dnsMappings=new Sr(e,t),this.ipMappings=new Sa(e,t),this.transportAddresses=new Sv(e,t),this.announceFilter=t.announceFilter??SA,this.observedAddressFilter=cQ(1024),this.addressVerificationTTL=t.addressVerificationTTL??SE.addressVerificationTTL,this.addressVerificationRetry=t.addressVerificationRetry??SE.addressVerificationRetry,this._updatePeerStoreAddresses=x4(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}[Symbol.toStringTag]="@libp2p/address-manager";_updatePeerStoreAddresses(){let e=this.getAddresses().map(e=>e.getPeerId()===this.components.peerId.toString()?e.decapsulate(`/p2p/${this.components.peerId.toString()}`):e);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(e=>{this.log.error("error updating addresses",e)})}getListenAddrs(){return Array.from(this.listen).map(e=>wt(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>wt(e))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(e=>wt(e))}getObservedAddrs(){return this.observed.getAll().map(e=>e.multiaddr)}addObservedAddr(e){let t=e.stringTuples(),r=`${t[0][1]}:${t[1][1]}`;if(!this.observedAddressFilter.has(r))this.observedAddressFilter.add(r),e=Sx(e,this.components.peerId),!this.ipMappings.has(e)&&(this.dnsMappings.has(e)||this.observed.add(e))}confirmObservedAddr(e,t){e=Sx(e,this.components.peerId);let r=!0;(t?.type==="transport"||this.transportAddresses.has(e))&&!this.transportAddresses.confirm(e,t?.ttl??this.addressVerificationTTL)&&r&&(r=!1),(t?.type==="dns-mapping"||this.dnsMappings.has(e))&&!this.dnsMappings.confirm(e,t?.ttl??this.addressVerificationTTL)&&r&&(r=!1),(t?.type==="ip-mapping"||this.ipMappings.has(e))&&!this.ipMappings.confirm(e,t?.ttl??this.addressVerificationTTL)&&r&&(r=!1),(t?.type==="observed"||this.observed.has(e))&&(this.maybeUpgradeToIPMapping(e)?(this.ipMappings.confirm(e,t?.ttl??this.addressVerificationTTL),r=!1):!this.observed.confirm(e,t?.ttl??this.addressVerificationTTL)&&r&&(r=!1)),r||this._updatePeerStoreAddresses()}removeObservedAddr(e,t){e=Sx(e,this.components.peerId);let r=!1;this.observed.has(e)&&!this.observed.remove(e)&&r&&(r=!1),this.transportAddresses.has(e)&&!this.transportAddresses.unconfirm(e,t?.ttl??this.addressVerificationRetry)&&r&&(r=!1),this.dnsMappings.has(e)&&!this.dnsMappings.unconfirm(e,t?.ttl??this.addressVerificationRetry)&&r&&(r=!1),this.ipMappings.has(e)&&!this.ipMappings.unconfirm(e,t?.ttl??this.addressVerificationRetry)&&r&&(r=!1),r&&this._updatePeerStoreAddresses()}getAddresses(){let e=new Set,t=this.getAddressesWithMetadata().filter(t=>{if(!t.verified)return!1;let r=t.multiaddr.toString();return!e.has(r)&&(e.add(r),!0)}).map(e=>e.multiaddr);return this.announceFilter(t.map(e=>{let t=wt(e);return t.protos().pop()?.path===!0||t.getPeerId()===this.components.peerId.toString()?t:t.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){let e=this.getAnnounceAddrs();if(e.length>0)return this.components.transportManager.getListeners().forEach(t=>{t.updateAnnounceAddrs(e)}),e.map(e=>({multiaddr:e,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let t=[];t=t.concat(this.components.transportManager.getAddrs().map(e=>this.transportAddresses.get(e,this.addressVerificationTTL)));let r=this.getAppendAnnounceAddrs();return r.length>0&&(this.components.transportManager.getListeners().forEach(e=>{e.updateAnnounceAddrs(r)}),t=t.concat(r.map(e=>({multiaddr:e,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))),t=(t=(t=t.concat(this.observed.getAll())).concat(this.ipMappings.getAll(t))).concat(this.dnsMappings.getAll(t))}addDNSMapping(e,t){this.dnsMappings.add(e,t)}removeDNSMapping(e){this.dnsMappings.remove(wt(`/dns/${e}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(e,t,r,n=t,i="tcp"){this.ipMappings.add(e,t,r,n,i),this.observed.removePrefixed(`/ip${bw(r)?4:6}/${r}/${i}/${n}`)}removePublicAddressMapping(e,t,r,n=t,i="tcp"){this.ipMappings.remove(wt(`/ip${bw(r)?4:6}/${r}/${i}/${n}`))&&this._updatePeerStoreAddresses()}maybeUpgradeToIPMapping(e){if(this.ipMappings.has(e))return!1;let t=e.toOptions();if(6===t.family||"127.0.0.1"===t.host||!0===ww(t.host))return!1;let r=this.components.transportManager.getListeners();for(let n of[e=>w0.exactMatch(e)||w2.exactMatch(e),e=>wG.exactMatch(e),e=>wZ.exactMatch(e)]){if(!n(e))continue;let i=r.filter(e=>e.getAddrs().filter(e=>4===e.toOptions().family&&n(e)).length>0);if(1!==i.length)continue;let s=i[0].getAddrs().filter(e=>"127.0.0.1"!==e.toOptions().host).pop();if(null==s)continue;let o=s.toOptions();return this.observed.remove(e),this.ipMappings.add(o.host,o.port,t.host,t.port,t.transport),!0}return!1}}!function(e){e.NOT_STARTED_YET="The libp2p node is not started yet",e.NOT_FOUND="Not found"}(el||(el={}));class Sk extends Error{constructor(e="Missing service"){super(e),this.name="MissingServiceError"}}class S_ extends Error{constructor(e="Unmet service dependencies"){super(e),this.name="UnmetServiceDependenciesError"}}class SI extends Error{constructor(e="No content routers available"){super(e),this.name="NoContentRoutersError"}}class SC extends Error{constructor(e="No peer routers available"){super(e),this.name="NoPeerRoutersError"}}class ST extends Error{constructor(e="Should not try to find self"){super(e),this.name="QueriedForSelfError"}}class SP extends Error{constructor(e="Unhandled protocol error"){super(e),this.name="UnhandledProtocolError"}}class SR extends Error{constructor(e="Duplicate protocol handler error"){super(e),this.name="DuplicateProtocolHandlerError"}}class SO extends Error{constructor(e="Dial denied error"){super(e),this.name="DialDeniedError"}}class SN extends Error{constructor(e="No transport was configured to listen on this address"){super(e),this.name="UnsupportedListenAddressError"}}class SD extends Error{constructor(e="Configured listen addresses could not be listened on"){super(e),this.name="UnsupportedListenAddressesError"}}class SB extends Error{constructor(e="No valid addresses"){super(e),this.name="NoValidAddressesError"}}class SM extends Error{constructor(e="Connection intercepted"){super(e),this.name="ConnectionInterceptedError"}}class SL extends Error{constructor(e="Connection denied"){super(e),this.name="ConnectionDeniedError"}}class SF extends Error{constructor(e="Stream is not multiplexed"){super(e),this.name="MuxerUnavailableError"}}class SU extends Error{constructor(e="Encryption failed"){super(e),this.name="EncryptionFailedError"}}class Sj extends Error{constructor(e="Transport unavailable"){super(e),this.name="TransportUnavailableError"}}class S${components={};_started=!1;constructor(e={}){for(let[t,r]of(this.components={},Object.entries(e)))this.components[t]=r;null==this.components.logger&&(this.components.logger=(0,lC.Um)())}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter(e=>ua(e)).map(async t=>{await t[e]?.()}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}let SH=["metrics","connectionProtector","dns"],Sq=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function Sz(e={}){let t=new S$(e);return new Proxy(t,{get(e,r,n){if("string"==typeof r&&!Sq.includes(r)){let e=t.components[r];if(null==e&&!SH.includes(r))throw new Sk(`${r} not set`);return e}return Reflect.get(e,r,n)},set:(e,r,n)=>("string"==typeof r?t.components[r]=n:Reflect.set(e,r,n),!0)})}function SV(e){let t={};for(let r of Object.values(e.components))for(let e of SK(r))t[e]=!0;for(let r of Object.values(e.components))for(let e of SG(r))if(!0!==t[e])throw new S_(`Service "${SW(r)}" required capability "${e}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}function SK(e){return Array.isArray(e?.[En])?e[En]:[]}function SG(e){return Array.isArray(e?.[Ei])?e[Ei]:[]}function SW(e){return e?.[Symbol.toStringTag]??e?.toString()??"unknown"}let SQ=4,SJ=41;function SZ(e={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{if(w0.matches(e))return!1;let t=e.stringTuples();return(t[0][0]===SQ||t[0][0]===SJ)&&!!ww(`${t[0][1]}`)},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...e}}let SY=()=>{let e=Error("Delay aborted");return e.name="AbortError",e},SX=new WeakMap,S0=function({clearTimeout:e,setTimeout:t}={}){return(r,{value:n,signal:i}={})=>{let s,o,a;if(i?.aborted)return Promise.reject(SY());let l=e??clearTimeout,c=()=>{l(s),a(SY())},u=()=>{i&&i.removeEventListener("abort",c)},h=new Promise((e,i)=>{o=()=>{u(),e(n)},a=i,s=(t??setTimeout)(o,r)});return i&&i.addEventListener("abort",c,{once:!0}),SX.set(h,()=>{l(s),s=null,o()}),h}}();class S1{memoryStorage;points;duration;blockDuration;execEvenly;execEvenlyMinDelayMs;keyPrefix;constructor(e={}){this.points=e.points??4,this.duration=e.duration??1,this.blockDuration=e.blockDuration??0,this.execEvenly=e.execEvenly??!1,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs??1e3*this.duration/this.points,this.keyPrefix=e.keyPrefix??"rlflx",this.memoryStorage=new S2}async consume(e,t=1,r={}){let n=this.getKey(e),i=this._getKeySecDuration(r),s=this.memoryStorage.incrby(n,t,i);if(s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s.consumedPoints>this.points)throw this.blockDuration>0&&s.consumedPoints<=this.points+t&&(s=this.memoryStorage.set(n,s.consumedPoints,this.blockDuration)),new u1("Rate limit exceeded",s);if(this.execEvenly&&s.msBeforeNext>0&&!s.isFirstInDuration){let e=Math.ceil(s.msBeforeNext/(s.remainingPoints+2));e<this.execEvenlyMinDelayMs&&(e=s.consumedPoints*this.execEvenlyMinDelayMs),await S0(e)}return s}penalty(e,t=1,r={}){let n=this.getKey(e),i=this._getKeySecDuration(r),s=this.memoryStorage.incrby(n,t,i);return s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s}reward(e,t=1,r={}){let n=this.getKey(e),i=this._getKeySecDuration(r),s=this.memoryStorage.incrby(n,-t,i);return s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s}block(e,t){let r=1e3*t,n=this.points+1;return this.memoryStorage.set(this.getKey(e),n,t),{remainingPoints:0,msBeforeNext:0===r?-1:r,consumedPoints:n,isFirstInDuration:!1}}set(e,t,r=0){let n=(r>=0?r:this.duration)*1e3;return this.memoryStorage.set(this.getKey(e),t,r),{remainingPoints:0,msBeforeNext:0===n?-1:n,consumedPoints:t,isFirstInDuration:!1}}get(e){let t=this.memoryStorage.get(this.getKey(e));return null!=t&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return e?.customDuration!=null&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}}class S2{storage;constructor(){this.storage=new Map}incrby(e,t,r){let n=this.storage.get(e);if(null!=n){let e=null!=n.expiresAt?n.expiresAt.getTime()-new Date().getTime():-1;if(null==n.expiresAt||e>0)return n.value+=t,{remainingPoints:0,msBeforeNext:e,consumedPoints:n.value,isFirstInDuration:!1}}return this.set(e,t,r)}set(e,t,r){let n=1e3*r,i=this.storage.get(e);null!=i&&clearTimeout(i.timeoutId);let s={value:t,expiresAt:n>0?new Date(Date.now()+n):void 0};return this.storage.set(e,s),n>0&&(s.timeoutId=setTimeout(()=>{this.storage.delete(e)},n),null!=s.timeoutId.unref&&s.timeoutId.unref()),{remainingPoints:0,msBeforeNext:0===n?-1:n,consumedPoints:s.value,isFirstInDuration:!0}}get(e){let t=this.storage.get(e);if(null!=t)return{remainingPoints:0,msBeforeNext:null!=t.expiresAt?t.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}delete(e){let t=this.storage.get(e);return null!=t&&(null!=t.timeoutId&&clearTimeout(t.timeoutId),this.storage.delete(e),!0)}}function S3(e){let t;if(yb(e))return{peerId:e,multiaddrs:[]};let r=Array.isArray(e)?e:[e];if(r.length>0){let e=r[0].getPeerId();t=null==e?void 0:yT(e),r.forEach(e=>{if(!we(e))throw new uU("Invalid multiaddr");let r=e.getPeerId();if(null==r){if(null!=t)throw new uC("Multiaddrs must all have the same peer id or have no peer id")}else{let e=yT(r);if(t?.equals(e)!==!0)throw new uC("Multiaddrs must all have the same peer id or have no peer id")}})}return r=r.filter(e=>!wR.exactMatch(e)),{peerId:t,multiaddrs:r}}let S4=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];async function S5(e,t){let r=e?.streams?.map(e=>e.protocol)??[],n=t?.closableProtocols??S4;if(!(r.filter(e=>null!=e&&!n.includes(e)).length>0))try{await e?.close(t)}catch(t){e?.abort(t)}}let S6=100,S8=50;async function S7(e,t){let r=!1;for(let t of b9.keys())if(r=e.protoNames().includes(t))break;if(!r)return[e];let n=await e.resolve(t);return t.log("resolved %s to",e,n.map(e=>e.toString())),n}function S9(e){try{let t;if(!(t="string"==typeof e?wt(e):e).protoNames().includes("ipcidr")){let e=t.protoNames().includes("ip6")?"/ipcidr/128":"/ipcidr/32";t=t.encapsulate(e)}return bB(t)}catch(t){throw Error(`Can't convert to IpNet, Invalid multiaddr format: ${e}`)}}let ke={maxConnections:100};class kt{maxConnections;connectionManager;peerStore;allow;events;log;constructor(e,t={}){this.maxConnections=t.maxConnections??ke.maxConnections,this.allow=(t.allow??[]).map(e=>S9(e)),this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(e=>{this.log.error("error while pruning connections %e",e)})}async _maybePruneConnections(){let e=this.connectionManager.getConnections(),t=e.length;if(this.log("checking max connections limit %d/%d",t,this.maxConnections),t<=this.maxConnections)return;let r=new yF;for(let t of e){let e=t.remotePeer;if(!r.has(e)){r.set(e,0);try{let t=await this.peerStore.get(e);r.set(e,[...t.tags.values()].reduce((e,t)=>e+t.value,0))}catch(e){"NotFoundError"!==e.name&&this.log.error("error loading peer tags",e)}}}let n=this.sortConnections(e,r),i=Math.max(t-this.maxConnections,0),s=[];for(let e of n)if(this.log("too many connections open - closing a connection to %p",e.remotePeer),this.allow.some(t=>t.contains(e.remoteAddr.nodeAddress().address))||s.push(e),s.length===i)break;await Promise.all(s.map(async e=>{await S5(e,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:s})}sortConnections(e,t){return e.sort((e,t)=>{let r=e.timeline.open,n=t.timeline.open;return r<n?1:r>n?-1:0}).sort((e,t)=>"outbound"===e.direction&&"inbound"===t.direction?1:"inbound"===e.direction&&"outbound"===t.direction?-1:0).sort((e,t)=>e.streams.length>t.streams.length?1:e.streams.length<t.streams.length?-1:0).sort((e,r)=>{let n=t.get(e.remotePeer)??0,i=t.get(r.remotePeer)??0;return n>i?1:n<i?-1:0})}}let kr=1e4,kn=1e4,ki=1e4,ks=25,ko=5,ka=10,kl=5,kc="last-dial-failure",ku="last-dial-success",kh=500;class kd extends u8{constructor(e={}){super({...e,sort:(e,t)=>e.options.priority>t.options.priority?-1:+(e.options.priority<t.options.priority)})}}function kf(e){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^::1$/.test(e)}function kp(e){if(!Sf(e))return!1;let{address:t}=e.nodeAddress();return kf(t)}function kg(e,t){let r=wG.exactMatch(e.multiaddr),n=wG.exactMatch(t.multiaddr);if(r&&!n)return -1;if(!r&&n)return 1;let i=w2.exactMatch(e.multiaddr),s=w2.exactMatch(t.multiaddr);if(i&&!s)return -1;if(!i&&s)return 1;let o=w0.exactMatch(e.multiaddr),a=w0.exactMatch(t.multiaddr);if(o&&!a)return -1;if(!o&&a)return 1;let l=ve.exactMatch(e.multiaddr),c=ve.exactMatch(t.multiaddr);if(l&&!c)return -1;if(!l&&c)return 1;let u=w4.exactMatch(e.multiaddr),h=w4.exactMatch(t.multiaddr);if(u&&!h)return -1;if(!u&&h)return 1;let d=w6.exactMatch(e.multiaddr),f=w6.exactMatch(t.multiaddr);return d&&!f?-1:!d&&f?1:0}function km(e,t){let r=kp(e.multiaddr),n=kp(t.multiaddr);return r&&!n?1:!r&&n?-1:0}function ky(e,t){let r=Sp(e.multiaddr),n=Sp(t.multiaddr);return r&&!n?1:!r&&n?-1:0}function kb(e,t){return e.isCertified&&!t.isCertified?-1:!e.isCertified&&t.isCertified?1:0}function kw(e,t){let r=w9.exactMatch(e.multiaddr),n=w9.exactMatch(t.multiaddr);return r&&!n?1:!r&&n?-1:0}function kv(e){return e.sort(kg).sort(kb).sort(kw).sort(ky).sort(km)}let kE={maxParallelDials:S8,maxDialQueueLength:kh,maxPeerAddrsToDial:ks,dialTimeout:kr};class kA{queue;components;addressSorter;maxPeerAddrsToDial;maxDialQueueLength;dialTimeout;shutDownController;connections;log;constructor(e,t={}){for(let[r,n]of(this.addressSorter=t.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??kE.maxPeerAddrsToDial,this.maxDialQueueLength=t.maxDialQueueLength??kE.maxDialQueueLength,this.dialTimeout=t.dialTimeout??kE.dialTimeout,this.connections=t.connections??new yF,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.shutDownController=new AbortController,this.shutDownController.signal,Object.entries(t.resolvers??{})))b9.set(r,n);this.queue=new kd({concurrency:t.maxParallelDials??kE.maxParallelDials,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("error",e=>{e.detail?.name!==uk.name&&this.log.error("error in dial queue - %e",e.detail)})}start(){this.shutDownController=new AbortController,this.shutDownController.signal}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(e,t={}){let{peerId:r,multiaddrs:n}=S3(e),i=Array.from(this.connections.values()).flat().find(e=>!0!==t.force&&(!!e.remotePeer.equals(r)||n.find(t=>t.equals(e.remoteAddr))));if(i?.status==="open")return this.log("already connected to %a",i.remoteAddr),t.onProgress?.(new nV("dial-queue:already-connected")),i;let s=this.queue.queue.find(e=>{if(r?.equals(e.options.peerId)===!0)return!0;let t=e.options.multiaddrs;if(null==t)return!1;for(let e of n)if(t.has(e.toString()))return!0;return!1});if(null!=s){for(let e of(this.log("joining existing dial target for %p",r),n))s.options.multiaddrs.add(e.toString());return t.onProgress?.(new nV("dial-queue:already-in-dial-queue")),s.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new uG("Dial queue is full");return this.log("creating dial target for %p",r,n.map(e=>e.toString())),t.onProgress?.(new nV("dial-queue:add-to-dial-queue")),this.queue.add(async e=>{e.onProgress?.(new nV("dial-queue:start-dial"));let t=hQ([this.shutDownController.signal,e.signal]);try{return await this.dialPeer(e,t)}finally{t.clear()}},{peerId:r,priority:t.priority??kD,multiaddrs:new Set(n.map(e=>e.toString())),signal:t.signal??AbortSignal.timeout(this.dialTimeout),onProgress:t.onProgress})}async dialPeer(e,t){let r=e.peerId,n=e.multiaddrs,i=new Set,s=0===e.multiaddrs.size,o=0,a=0,l=[];for(this.log("starting dial to %p",r);s||n.size>0;){a++,s=!1;let c=[],u=new Set(e.multiaddrs);for(let s of(n.clear(),this.log("calculating addrs to dial %p from %s",r,[...u]),await this.calculateMultiaddrs(r,u,{...e,signal:t}))){if(i.has(s.multiaddr.toString())){this.log.trace("skipping previously failed multiaddr %a while dialing %p",s.multiaddr,r);continue}c.push(s)}for(let n of(this.log("%s dial to %p with %s",1===a?"starting":"continuing",r,c.map(e=>e.multiaddr.toString())),e?.onProgress?.(new nV("dial-queue:calculated-addresses",c)),c)){if(o===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",o,e.peerId),new uG("Peer had more than maxPeerAddrsToDial");o++;try{let i=await this.components.transportManager.dial(n.multiaddr,{...e,signal:t});this.log("dial to %a succeeded",n.multiaddr);try{await this.components.peerStore.merge(i.remotePeer,{multiaddrs:[i.remoteAddr],metadata:{[ku]:(0,nm.s)(Date.now().toString())}})}catch(e){this.log.error("could not update last dial failure key for %p",r,e)}return i}catch(e){if(this.log.error("dial failed to %a",n.multiaddr,e),i.add(n.multiaddr.toString()),null!=r)try{await this.components.peerStore.merge(r,{metadata:{[kc]:(0,nm.s)(Date.now().toString())}})}catch(e){this.log.error("could not update last dial failure key for %p",r,e)}if(t.aborted)throw new uV(e.message);l.push(e)}}}if(1===l.length)throw l[0];throw AggregateError(l,"All multiaddr dials failed")}async calculateMultiaddrs(e,t=new Set,r={}){let n=[...t].map(e=>({multiaddr:wt(e),isCertified:!1}));if(null!=e){if(this.components.peerId.equals(e))throw new uG("Tried to dial self");if(await this.components.connectionGater.denyDialPeer?.(e)===!0)throw new SO("The dial request is blocked by gater.allowDialPeer");if(0===n.length){this.log("loading multiaddrs for %p",e);try{let t=await this.components.peerStore.get(e);n.push(...t.addresses),this.log("loaded multiaddrs for %p",e,n.map(({multiaddr:e})=>e.toString()))}catch(e){if("NotFoundError"!==e.name)throw e}}if(0===n.length){this.log("looking up multiaddrs for %p in the peer routing",e);try{let t=await this.components.peerRouting.findPeer(e,r);this.log("found multiaddrs for %p in the peer routing",e,n.map(({multiaddr:e})=>e.toString())),n.push(...t.multiaddrs.map(e=>({multiaddr:e,isCertified:!1})))}catch(t){"NoPeerRoutersError"===t.name?this.log("no peer routers configured",e):this.log.error("looking up multiaddrs for %p in the peer routing failed - %e",e,t)}}}let i=(await Promise.all(n.map(async e=>{let t=await S7(e.multiaddr,{dns:this.components.dns,...r,log:this.log});return 1===t.length&&t[0].equals(e.multiaddr)?e:t.map(e=>({multiaddr:e,isCertified:!1}))}))).flat();if(null!=e){let t=`/p2p/${e.toString()}`;i=i.map(e=>{let r=e.multiaddr.protos().pop();return r?.path===!0?e:null==e.multiaddr.getPeerId()?{multiaddr:e.multiaddr.encapsulate(t),isCertified:e.isCertified}:e})}let s=i.filter(t=>{if(null==this.components.transportManager.dialTransportForMultiaddr(t.multiaddr))return!1;let r=t.multiaddr.getPeerId();return null==e||null==r||e.equals(r)}),o=new Map;for(let e of s){let t=e.multiaddr.toString(),r=o.get(t);if(null!=r){r.isCertified=r.isCertified||e.isCertified||!1;continue}o.set(t,e)}let a=[...o.values()];if(0===a.length)throw new SB("The dial request has no valid addresses");let l=[];for(let e of a)null!=this.components.connectionGater.denyDialMultiaddr&&await this.components.connectionGater.denyDialMultiaddr(e.multiaddr)||l.push(e);let c=null==this.addressSorter?kv(l):l.sort(this.addressSorter);if(0===c.length)throw new SO("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",e??"unknown peer",i.map(({multiaddr:e})=>e.toString())),this.log.trace("addresses for %p after filtering",e??"unknown peer",c.map(({multiaddr:e})=>e.toString())),c}async isDialable(e,t={}){Array.isArray(e)||(e=[e]);try{let r=await this.calculateMultiaddrs(void 0,new Set(e.map(e=>e.toString())),t);if(!1===t.runOnLimitedConnection)return null!=r.find(e=>!w9.matches(e.multiaddr));return!0}catch(e){this.log.trace("error calculating if multiaddr(s) were dialable",e)}return!1}}let kx="keep-alive";var kS=r(84896);let kk=Object.prototype.toString,k_=e=>"[object Error]"===kk.call(e),kI=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);function kC(e){return!!(e&&k_(e)&&"TypeError"===e.name&&"string"==typeof e.message)&&("Load failed"===e.message?void 0===e.stack:kI.has(e.message))}class kT extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}let kP=(e,t,r)=>{let n=r.retries-(t-1);return e.attemptNumber=t,e.retriesLeft=n,e};async function kR(e,t){return new Promise((r,n)=>{t={...t},t.onFailedAttempt??=()=>{},t.shouldRetry??=()=>!0,t.retries??=10;let i=kS.operation(t),s=()=>{i.stop(),n(t.signal?.reason)};t.signal&&!t.signal.aborted&&t.signal.addEventListener("abort",s,{once:!0});let o=()=>{t.signal?.removeEventListener("abort",s),i.stop()};i.attempt(async s=>{try{let t=await e(s);o(),r(t)}catch(e){try{if(!(e instanceof Error))throw TypeError(`Non-error was thrown: "${e}". You should only throw errors.`);if(e instanceof kT)throw e.originalError;if(e instanceof TypeError&&!kC(e))throw e;if(kP(e,s,t),await t.shouldRetry(e)||(i.stop(),n(e)),await t.onFailedAttempt(e),!i.retry(e))throw i.mainError()}catch(e){kP(e,s,t),o(),n(e)}}})})}class kO{log;queue;started;peerStore;retries;retryInterval;backoffFactor;connectionManager;events;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.queue=new hb({concurrency:t.maxParallelReconnects??kl,metricName:"libp2p_reconnect_queue",metrics:e.metrics}),this.started=!1,this.retries=t.retries??5,this.backoffFactor=t.backoffFactor,this.retryInterval=t.retryInterval,this.events=e.events,e.events.addEventListener("peer:disconnect",e=>{this.maybeReconnect(e.detail).catch(t=>{this.log.error("failed to maybe reconnect to %p - %e",e.detail,t)})})}async maybeReconnect(e){if(!this.started)return;let t=await this.peerStore.get(e);kN(t)&&(this.queue.has(e)||this.queue.add(async t=>{await kR(async r=>{if(this.started)try{await this.connectionManager.openConnection(e,{signal:t?.signal})}catch(t){throw this.log("reconnecting to %p attempt %d of %d failed - %e",e,r,this.retries,t),t}},{signal:t?.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})},{peerId:e}).catch(async r=>{this.log.error("failed to reconnect to %p - %e",e,r);let n={};[...t.tags.keys()].forEach(e=>{e.startsWith(kx)&&(n[e]=void 0)}),await this.peerStore.merge(e,{tags:n}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:e})}).catch(async t=>{this.log.error("failed to remove keep-alive tag from %p - %e",e,t)}))}start(){this.started=!0}async afterStart(){Promise.resolve().then(async()=>{let e=await this.peerStore.all({filters:[e=>kN(e)]});await Promise.all(e.map(async e=>{await this.connectionManager.openConnection(e.id).catch(e=>{this.log.error(e)})}))}).catch(e=>{this.log.error(e)})}stop(){this.started=!1,this.queue.abort()}}function kN(e){for(let t of e.tags.keys())if(t.startsWith(kx))return!0;return!1}let kD=50,kB={maxConnections:S6,inboundConnectionThreshold:ko,maxIncomingPendingConnections:ka};class kM{started;connections;allow;deny;maxIncomingPendingConnections;incomingPendingConnections;outboundPendingConnections;maxConnections;dialQueue;reconnectQueue;connectionPruner;inboundConnectionRateLimiter;peerStore;metrics;events;log;peerId;constructor(e,t={}){if(this.maxConnections=t.maxConnections??kB.maxConnections,this.maxConnections<1)throw new uC("Connection Manager maxConnections must be greater than 0");this.connections=new yF,this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(t.allow??[]).map(e=>S9(e)),this.deny=(t.deny??[]).map(e=>S9(e)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??kB.maxIncomingPendingConnections,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new S1({points:t.inboundConnectionThreshold??kB.inboundConnectionThreshold,duration:1}),this.connectionPruner=new kt({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{maxConnections:this.maxConnections,allow:t.allow?.map(e=>wt(e))}),this.dialQueue=new kA(e,{addressSorter:t.addressSorter,maxParallelDials:t.maxParallelDials??S8,maxDialQueueLength:t.maxDialQueueLength??kh,maxPeerAddrsToDial:t.maxPeerAddrsToDial??ks,dialTimeout:t.dialTimeout??kr,resolvers:t.resolvers??{dnsaddr:xg},connections:this.connections}),this.reconnectQueue=new kO({events:e.events,peerStore:e.peerStore,logger:e.logger,connectionManager:this},{retries:t.reconnectRetries,retryInterval:t.reconnectRetryInterval,backoffFactor:t.reconnectBackoffFactor,maxParallelReconnects:t.maxParallelReconnects})}[Symbol.toStringTag]="@libp2p/connection-manager";async start(){this.metrics?.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{let e={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(let t of this.connections.values())for(let r of t)e[r.direction]++;return e}}),this.metrics?.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{let e={};for(let t of this.connections.values())for(let r of t)for(let t of r.streams){let r=`${t.direction} ${t.protocol??"unnegotiated"}`;e[r]=(e[r]??0)+1}return e}}),this.metrics?.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{let e={};for(let t of this.connections.values())for(let r of t){let t={};for(let e of r.streams){let r=`${e.direction} ${e.protocol??"unnegotiated"}`;t[r]=(t[r]??0)+1}for(let[r,n]of Object.entries(t))e[r]=e[r]??[],e[r].push(n)}let t={};for(let[r,n]of Object.entries(e)){let e=Math.floor(.9*(n=n.sort((e,t)=>e-t)).length);t[r]=n[e]}return t}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),await ul(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")}async stop(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),await uc(this.reconnectQueue,this.dialQueue,this.connectionPruner);let e=[];for(let t of this.connections.values())for(let r of t)e.push((async()=>{try{await r.close()}catch(e){this.log.error(e)}})());this.log("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),this.log("stopped")}getMaxConnections(){return this.maxConnections}onConnect(e){this._onConnect(e).catch(e=>{this.log.error(e)})}async _onConnect(e){let{detail:t}=e;if(!this.started)return void await t.close();if("open"!==t.status)return;let r=t.remotePeer,n=!this.connections.has(r),i=this.connections.get(r)??[];i.push(t),this.connections.set(r,i),null!=r.publicKey&&"RSA"===r.type&&await this.peerStore.patch(r,{publicKey:r.publicKey}),n&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){let{detail:t}=e,r=t.remotePeer,n=(this.connections.get(r)??[]).filter(e=>e.id!==t.id);this.connections.set(r,n),0===n.length&&(this.log("onDisconnect remove all connections for peer %p",r),this.connections.delete(r),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(null!=e)return this.connections.get(e)??[];let t=[];for(let e of this.connections.values())t=t.concat(e);return t}getConnectionsMap(){return this.connections}async openConnection(e,t={}){if(!this.started)throw new uK("Not started");this.outboundPendingConnections++;try{t.signal?.throwIfAborted();let{peerId:r}=S3(e);if(this.peerId.equals(r))throw new uF("Can not dial self");if(null!=r&&!0!==t.force){this.log("dial %p",r);let e=this.getConnections(r).find(e=>null==e.limits);if(null!=e)return this.log("had an existing non-limited connection to %p",r),t.onProgress?.(new nV("dial-queue:already-connected")),e}let n=await this.dialQueue.dial(e,{...t,priority:t.priority??kD});if("open"!==n.status)throw new uO("Remote closed connection during opening");let i=this.connections.get(n.remotePeer);null==i&&(i=[],this.connections.set(n.remotePeer,i));let s=!1;for(let e of i)if(e.id===n.id&&(s=!0),!0!==t.force&&e.id!==n.id&&e.remoteAddr.equals(n.remoteAddr))return n.abort(new uU("Duplicate multiaddr connection")),e;return s||i.push(n),n}finally{this.outboundPendingConnections--}}async closeConnections(e,t={}){let r=this.connections.get(e)??[];await Promise.all(r.map(async e=>{try{await e.close(t)}catch(t){e.abort(t)}}))}async acceptIncomingConnection(e){if(this.deny.some(t=>t.contains(e.remoteAddr.nodeAddress().address)))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(t=>t.contains(e.remoteAddr.nodeAddress().address)))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){let t=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(t,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,t),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){let e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map(e=>wt(e))}))}async isDialable(e,t={}){return this.dialQueue.isDialable(e,t)}}class kL{movingAverage;variance;deviation;forecast;timeSpan;previousTime;constructor(e){this.timeSpan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timeSpan)}push(e,t=Date.now()){if(null!=this.previousTime){let r=this.alpha(t,this.previousTime),n=e-this.movingAverage,i=r*n;this.movingAverage=r*e+(1-r)*this.movingAverage,this.variance=(1-r)*(this.variance+n*i),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+r*n}else this.movingAverage=e;this.previousTime=t}}let kF=1.2,kU=2,kj=2e3;class k${success;failure;next;metric;timeoutMultiplier;failureMultiplier;minTimeout;constructor(e={}){this.success=new kL(e.interval??5e3),this.failure=new kL(e.interval??5e3),this.next=new kL(e.interval??5e3),this.failureMultiplier=e.failureMultiplier??kU,this.timeoutMultiplier=e.timeoutMultiplier??kF,this.minTimeout=e.minTimeout??kj,null!=e.metricName&&(this.metric=e.metrics?.registerMetricGroup(e.metricName))}getTimeoutSignal(e={}){let t=Math.max(Math.round(this.next.movingAverage*(e.timeoutFactor??this.timeoutMultiplier)),this.minTimeout),r=AbortSignal.timeout(t),n=hQ([e.signal,r]);return n.start=Date.now(),n.timeout=t,n}cleanUp(e){let t=Date.now()-e.start;e.aborted?(this.failure.push(t),this.next.push(t*this.failureMultiplier),this.metric?.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:t})):(this.success.push(t),this.next.push(t),this.metric?.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:t}))}}class kH{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=(0,a9.A)(),this.haveNext=(0,a9.A)()}[Symbol.asyncIterator](){return this}async next(){if(null==this.nextResult&&await this.haveNext.promise,null==this.nextResult)throw Error("HaveNext promise resolved but nextResult was undefined");let e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=(0,a9.A)(),e}async throw(e){return this.ended=!0,this.error=e,null!=e&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){let e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){null!=e?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(null!=e&&this.ended)throw this.error??Error("Cannot push value onto an ended pushable");for(;null!=this.nextResult;)await this.readNext.promise;null!=e?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=(0,a9.A)(),await (0,u3.W)(this.readNext.promise,t?.signal,t)}}function kq(){return new kH}class kz extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}function kV(e,t){let r=kq();e.sink(r).catch(async e=>{await r.end(e)}),e.sink=async e=>{for await(let t of e)await r.push(t);await r.end()};let n=e.source;null!=e.source[Symbol.iterator]?n=e.source[Symbol.iterator]():null!=e.source[Symbol.asyncIterator]&&(n=e.source[Symbol.asyncIterator]());let i=new ro;return{read:async e=>{if(e?.signal?.throwIfAborted(),e?.bytes==null){let{done:t,value:r}=await (0,u3.W)(n.next(),e?.signal);return!0===t?null:r}for(;i.byteLength<e.bytes;){let{value:t,done:r}=await (0,u3.W)(n.next(),e?.signal);if(!0===r)throw new kz("unexpected end of input");i.append(t)}let t=i.sublist(0,e.bytes);return i.consume(e.bytes),t},write:async(e,t)=>{t?.signal?.throwIfAborted(),e instanceof Uint8Array?await r.push(e,t):await r.push(e.subarray(),t)},unwrap:()=>{if(i.byteLength>0){let r=e.source;e.source=async function*(){t?.yieldBytes===!1?yield i:yield*i,yield*r}()}return e}}}let kK=1e4,kG="1.0.0",kW="ping",kQ="ipfs",kJ=32,kZ=!0;class kY{protocol;components;log;heartbeatInterval;pingIntervalMs;abortController;timeout;abortConnectionOnPingFailure;constructor(e,t={}){this.components=e,this.protocol=`/${t.protocolPrefix??kQ}/${kW}/${kG}`,this.log=e.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=t.pingInterval??kK,this.abortConnectionOnPingFailure=t.abortConnectionOnPingFailure??kZ,this.timeout=new k$({...t.pingTimeout??{},metrics:e.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}[Symbol.toStringTag]="@libp2p/connection-monitor";[En]=["@libp2p/connection-monitor"];start(){this.abortController=new AbortController,this.abortController.signal,this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(e=>{Promise.resolve().then(async()=>{let t=Date.now();try{let r=this.timeout.getTimeoutSignal({signal:this.abortController?.signal}),n=await e.newStream(this.protocol,{signal:r,runOnLimitedConnection:!0}),i=kV(n);t=Date.now(),await Promise.all([i.write(Er(kJ),{signal:r}),i.read({bytes:kJ,signal:r})]),e.rtt=Date.now()-t,await i.unwrap().close({signal:r})}catch(r){if("UnsupportedProtocolError"!==r.name)throw r;e.rtt=(Date.now()-t)/2}}).catch(t=>{this.log.error("error during heartbeat",t),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),e.abort(t)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){this.abortController?.abort(),null!=this.heartbeatInterval&&clearInterval(this.heartbeatInterval)}}class kX{routers;started;components;constructor(e,t){this.routers=t.routers??[],this.started=!1,this.components=e,this.findProviders=e.metrics?.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([e],t)=>({...t,cid:e.toString()}),getAttributesFromYieldedValue:(e,t)=>({...t,providers:[...Array.isArray(t.providers)?t.providers:[],e.id.toString()]})})??this.findProviders,this.provide=e.metrics?.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([e],t)=>({...t,cid:e.toString()})})??this.provide,this.cancelReprovide=e.metrics?.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([e],t)=>({...t,cid:e.toString()})})??this.cancelReprovide,this.put=e.metrics?.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([e])=>({key:(0,uh.d)(e,"base36")})})??this.put,this.get=e.metrics?.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([e])=>({key:(0,uh.d)(e,"base36")})})??this.get}[Symbol.toStringTag]="@libp2p/content-routing";isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async *findProviders(e,t={}){if(0===this.routers.length)throw new SI("No content routers available");let r=this,n=new xw;for await(let i of(0,hw.A)(...r.routers.map(r=>r.findProviders(e,t))))null!=i&&(i.multiaddrs.length>0&&await this.components.peerStore.merge(i.id,{multiaddrs:i.multiaddrs}),n.has(i.id)||(n.add(i.id),yield i))}async provide(e,t={}){if(0===this.routers.length)throw new SI("No content routers available");await Promise.all(this.routers.map(async r=>{await r.provide(e,t)}))}async cancelReprovide(e,t={}){if(0===this.routers.length)throw new SI("No content routers available");await Promise.all(this.routers.map(async r=>{await r.cancelReprovide(e,t)}))}async put(e,t,r){if(!this.isStarted())throw new uK;await Promise.all(this.routers.map(async n=>{await n.put(e,t,r)}))}async get(e,t){if(!this.isStarted())throw new uK;return Promise.any(this.routers.map(async r=>r.get(e,t)))}}class k0{log;peerId;peerStore;routers;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=t.routers??[],this.findPeer=e.metrics?.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([e],t)=>({...t,peer:e.toString()})})??this.findPeer,this.getClosestPeers=e.metrics?.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([e],t)=>({...t,key:(0,uh.d)(e,"base36")}),getAttributesFromYieldedValue:(e,t)=>({...t,peers:[...Array.isArray(t.peers)?t.peers:[],e.id.toString()]})})??this.getClosestPeers}[Symbol.toStringTag]="@libp2p/peer-routing";async findPeer(e,t){if(0===this.routers.length)throw new SC("No peer routers available");if(e.toString()===this.peerId.toString())throw new ST("Should not try to find self");let r=this;for await(let n of(0,hw.A)(...this.routers.map(n=>(async function*(){try{yield await n.findPeer(e,t)}catch(e){r.log.error(e)}})())))if(null!=n)return n.multiaddrs.length>0&&await this.peerStore.merge(n.id,{multiaddrs:n.multiaddrs}),n;throw new uL}async *getClosestPeers(e,t={}){if(0===this.routers.length)throw new SC("No peer routers available");let r=this,n=cQ(1024);for await(let i of lt(async function*(){for await(let n of(0,hw.A)(...r.routers.map(r=>r.getClosestPeers(e,t))))yield async()=>{if(0===n.multiaddrs.length)try{n=await r.findPeer(n.id,{...t,useCache:!1})}catch(e){r.log.error("could not find peer multiaddrs",e);return}return n}}()))null!=i&&(i.multiaddrs.length>0&&await this.peerStore.merge(i.id,{multiaddrs:i.multiaddrs}),n.has(i.id.toMultihash().bytes)||(n.add(i.id.toMultihash().bytes),yield i))}}class k1 extends uS{peerRouting;log;walking;walkers;shutdownController;walkController;needNext;constructor(e){super(),this.log=e.logger.forComponent("libp2p:random-walk"),this.peerRouting=e.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,this.shutdownController.signal}[Symbol.toStringTag]="@libp2p/random-walk";start(){this.shutdownController=new AbortController,this.shutdownController.signal}stop(){this.shutdownController.abort()}async *walk(e){this.walking||this.startWalk(),this.walkers++;let t=hQ([this.shutdownController.signal,e?.signal]);try{for(;;){this.needNext?.resolve(),this.needNext=(0,a9.A)();let e=await u0(this,"walk:peer",t,{errorEvent:"walk:error"});yield e.detail}}finally{t.clear(),this.walkers--,0===this.walkers&&(this.walkController?.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,this.walkController.signal;let e=hQ([this.walkController.signal,this.shutdownController.signal]),t=Date.now(),r=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{let t=Er(32),n=Date.now();for await(let i of this.peerRouting.getClosestPeers(t,{signal:e}))e.aborted&&this.log("aborting walk"),e.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",i.id,Date.now()-n,this.walkers),r++,this.safeDispatchEvent("walk:peer",{detail:i}),1===this.walkers&&null!=this.needNext&&(this.log("wait for need next"),await (0,u3.W)(this.needNext.promise,e)),n=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",t,this.walkers,r)}catch(e){this.log.error("random walk errored",e),this.safeDispatchEvent("walk:error",{detail:e})}this.log("no walkers left, ended walk")}).catch(e=>{this.log.error("random walk errored",e)}).finally(()=>{this.log("finished walk, found %d peers after %dms",r,Date.now()-t),this.walking=!1})}}let k2=32,k3=64;class k4{log;topologies;handlers;components;constructor(e){this.log=e.logger.forComponent("libp2p:registrar"),this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}[Symbol.toStringTag]="@libp2p/registrar";getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){let t=this.handlers.get(e);if(null==t)throw new SP(`No handler registered for protocol ${e}`);return t}getTopologies(e){let t=this.topologies.get(e);return null==t?[]:[...t.values()]}async handle(e,t,r){if(this.handlers.has(e)&&r?.force!==!0)throw new SR(`Handler already registered for protocol ${e}`);let n=lI.bind({ignoreUndefined:!0})({maxInboundStreams:k2,maxOutboundStreams:k3},r);this.handlers.set(e,{handler:t,options:n}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]})}async unhandle(e){(Array.isArray(e)?e:[e]).forEach(e=>{this.handlers.delete(e)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()})}async register(e,t){if(null==t)throw new uC("invalid topology");let r=`${(1e9*Math.random()).toString(36)}${Date.now()}`,n=this.topologies.get(e);return null==n&&(n=new Map,this.topologies.set(e,n)),n.set(r,t),r}unregister(e){for(let[t,r]of this.topologies.entries())r.has(e)&&(r.delete(e),0===r.size&&this.topologies.delete(t))}_onDisconnect(e){let t=e.detail;this.components.peerStore.get(t).then(e=>{for(let r of e.protocols){let e=this.topologies.get(r);if(null!=e)for(let r of e.values())r.filter?.has(t)!==!1&&(r.filter?.remove(t),r.onDisconnect?.(t))}}).catch(e=>{"NotFoundError"!==e.name&&this.log.error("could not inform topologies of disconnecting peer %p",t,e)})}_onPeerUpdate(e){let{peer:t,previous:r}=e.detail;for(let e of(r?.protocols??[]).filter(e=>!t.protocols.includes(e))){let r=this.topologies.get(e);if(null!=r)for(let e of r.values())e.filter?.has(t.id)!==!1&&(e.filter?.remove(t.id),e.onDisconnect?.(t.id))}}_onPeerIdentify(e){let t=e.detail.protocols,r=e.detail.connection,n=e.detail.peerId;for(let e of t){let t=this.topologies.get(e);if(null!=t)for(let e of t.values())(null==r.limits||!0===e.notifyOnLimitedConnection)&&e.filter?.has(n)!==!0&&(e.filter?.add(n),e.onConnect?.(n,r))}}}class k5{log;components;transports;listeners;faultTolerance;started;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=new Map,this.listeners=yX({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??er.FATAL_ALL}[Symbol.toStringTag]="@libp2p/transport-manager";add(e){let t=e[Symbol.toStringTag];if(null==t)throw new uC("Transport must have a valid tag");if(this.transports.has(t))throw new uC(`There is already a transport with the tag ${t}`);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){let e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){let e=[];for(let[t,r]of this.listeners)for(this.log("closing listeners for %s",t);r.length>0;){let t=r.pop();null!=t&&e.push(t.close())}for(let t of(await Promise.all(e),this.log("all listeners closed"),this.listeners.keys()))this.listeners.set(t,[]);this.started=!1}async dial(e,t){let r=this.dialTransportForMultiaddr(e);if(null==r)throw new Sj(`No transport available for address ${String(e)}`);return t?.onProgress?.(new nV("transport-manager:selected-transport",r[Symbol.toStringTag])),r.dial(e,{...t,upgrader:this.components.upgrader})}getAddrs(){let e=[];for(let t of this.listeners.values())for(let r of t)e=[...e,...r.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(e){for(let t of this.transports.values())if(t.dialFilter([e]).length>0)return t}listenTransportForMultiaddr(e){for(let t of this.transports.values())if(t.listenFilter([e]).length>0)return t}async listen(e){if(!this.isStarted())throw new uK("Not started");if(null==e||0===e.length)return void this.log("no addresses were provided for listening, this node is dial only");let t={errors:new Map,ipv4:{success:0,attempts:0},ipv6:{success:0,attempts:0}};e.forEach(e=>{t.errors.set(e.toString(),new SN)});let r=[];for(let[n,i]of this.transports.entries())for(let s of i.listenFilter(e)){this.log("creating listener for %s on %a",n,s);let e=i.createListener({upgrader:this.components.upgrader}),o=this.listeners.get(n)??[];null==o&&(o=[],this.listeners.set(n,o)),o.push(e),e.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:e})}),e.addEventListener("close",()=>{let t=o.findIndex(t=>t===e);o.splice(t,1),this.components.events.safeDispatchEvent("transport:close",{detail:e})}),wH.matches(s)?t.ipv4.attempts++:wq.matches(s)&&t.ipv6.attempts++,r.push(e.listen(s).then(()=>{t.errors.delete(s.toString()),wH.matches(s)&&t.ipv4.success++,wq.matches(s)&&t.ipv6.success++},e=>{throw this.log.error("transport %s could not listen on address %a - %e",n,s,e),t.errors.set(s.toString(),e),e}))}let n=await Promise.allSettled(r);if(!(n.length>0&&n.every(e=>"fulfilled"===e.status))){if(this.ipv6Unsupported(t))return void this.log("all IPv4 addresses succeed but all IPv6 failed");if(this.faultTolerance===er.NO_FATAL)return void this.log("failed to listen on any address but fault tolerance allows this");throw new SD(`Some configured addresses failed to be listened on, you may need to remove one or more listen addresses from your configuration or set \`transportManager.faultTolerance\` to NO_FATAL:
${[...t.errors.entries()].map(([e,t])=>`
  ${e}: ${`${t.stack??t}`.split("\n").join("\n  ")}
`).join("")}`)}}ipv6Unsupported(e){if(0===e.ipv4.attempts||0===e.ipv6.attempts)return!1;let t=e.ipv4.attempts===e.ipv4.success,r=0===e.ipv6.success;return t&&r}async remove(e){let t=this.listeners.get(e)??[];this.log.trace("removing transport %s",e);let r=[];for(this.log.trace("closing listeners for %s",e);t.length>0;){let e=t.pop();null!=e&&r.push(e.close())}await Promise.all(r),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){let e=[];for(let t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}let k6=8,k8=4194304;class k7 extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class k9 extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class _e extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}class _t extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}function _r(e){return null!=e[Symbol.asyncIterator]}function _n(e,t){if(e.byteLength>t)throw new k9("Message length too long")}let _i=e=>{let t=rY(e),r=(0,t9.K)(t);return r3(e,r),_i.bytes=t,r};function _s(e,t){let r=(t=t??{}).lengthEncoder??_i,n=t?.maxDataLength??k8;function*i(e){_n(e,n);let t=r(e.byteLength);t instanceof Uint8Array?yield t:yield*t,e instanceof Uint8Array?yield e:yield*e}return _r(e)?async function*(){for await(let t of e)yield*i(t)}():function*(){for(let t of e)yield*i(t)}()}_i.bytes=0,_s.single=(e,t)=>{let r=(t=t??{}).lengthEncoder??_i;return _n(e,t?.maxDataLength??k8),new ro(r(e.byteLength),e)},function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(ec||(ec={}));let _o=e=>{let t=r4(e);return _o.bytes=rY(t),t};function _a(e,t){let r=new ro,n=ec.LENGTH,i=-1,s=t?.lengthDecoder??_o,o=t?.maxLengthLength??k6,a=t?.maxDataLength??k8;function*l(){for(;r.byteLength>0;){if(n===ec.LENGTH)try{if((i=s(r))<0)throw new k7("Invalid message length");if(i>a)throw new k9("Message length too long");let e=s.bytes;r.consume(e),t?.onLength!=null&&t.onLength(i),n=ec.DATA}catch(e){if(e instanceof RangeError){if(r.byteLength>o)throw new _e("Message length length too long");break}throw e}if(n===ec.DATA){if(r.byteLength<i)break;let e=r.sublist(0,i);r.consume(i),t?.onData!=null&&t.onData(e),yield e,n=ec.LENGTH}}}return _r(e)?async function*(){for await(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new _t("Unexpected end of input")}():function*(){for(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new _t("Unexpected end of input")}()}_o.bytes=0,_a.fromReader=(e,t)=>{let r=1,n=async function*(){for(;;)try{let{done:t,value:n}=await e.next(r);if(!0===t)return;null!=n&&(yield n)}catch(e){if("ERR_UNDER_READ"===e.code)return{done:!0,value:null};throw e}finally{r=1}}(),i=e=>{r=e};return _a(n,{...t??{},onLength:i})};class _l extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class _c extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class _u extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}function _h(e,t={}){let r=kV(e,t);null!=t.maxDataLength&&null==t.maxLengthLength&&(t.maxLengthLength=rY(t.maxDataLength));let n=t?.lengthDecoder??r4,i=t?.lengthEncoder??r3;return{read:async e=>{let i=-1,s=new ro;for(;;){s.append(await r.read({...e,bytes:1}));try{i=n(s)}catch(e){if(e instanceof RangeError)continue;throw e}if(i<0)throw new _l("Invalid message length");if(t?.maxLengthLength!=null&&s.byteLength>t.maxLengthLength)throw new _u("message length length too long");if(i>-1)break}if(t?.maxDataLength!=null&&i>t.maxDataLength)throw new _c("message length too long");return r.read({...e,bytes:i})},write:async(e,t)=>{await r.write(new ro(i(e.byteLength),e),t)},writeV:async(e,t)=>{let n=new ro(...e.flatMap(e=>[i(e.byteLength),e]));await r.write(n,t)},unwrap:()=>r.unwrap()}}let _d="/multistream/1.0.0",_f=1024,_p=(0,nm.s)("\n");async function _g(e,t,r){await e.write(t,r)}async function _m(e,t,r){await e.writeV(t,r)}async function _y(e,t){let r=await e.read(t);if(0===r.byteLength||r.get(r.byteLength-1)!==_p[0])throw t.log.error("Invalid mss message - missing newline",r),new uq("Missing newline");return r.sublist(0,-1)}async function _b(e,t){let r=await _y(e,t);return(0,uh.d)(r.subarray())}async function _w(e,t,r){t=Array.isArray(t)?t:[t],r.log.trace("handle: available protocols %s",t);let n=_h(e,{...r,maxDataLength:_f,maxLengthLength:2});for(;;){r.log.trace("handle: reading incoming string");let e=await _b(n,r);if(r.log.trace('handle: read "%s"',e),e===_d){r.log.trace('handle: respond with "%s" for "%s"',_d,e),await _g(n,(0,nm.s)(`${_d}
`),r),r.log.trace('handle: responded with "%s" for "%s"',_d,e);continue}if(t.includes(e))return r.log.trace('handle: respond with "%s" for "%s"',e,e),await _g(n,(0,nm.s)(`${e}
`),r),r.log.trace('handle: responded with "%s" for "%s"',e,e),{stream:n.unwrap(),protocol:e};if("ls"===e){let i=new ro(...t.map(e=>_s.single((0,nm.s)(`${e}
`))),(0,nm.s)("\n"));r.log.trace('handle: respond with "%s" for %s',t,e),await _g(n,i,r),r.log.trace('handle: responded with "%s" for %s',t,e);continue}r.log.trace('handle: respond with "na" for "%s"',e),await _g(n,(0,nm.s)("na\n"),r),r.log('handle: responded with "na" for "%s"',e)}}async function _v(e,t,r){if(1===(t=Array.isArray(t)?[...t]:[t]).length&&!1===r.negotiateFully)return _E(e,t[0],r);let n=_h(e,{...r,maxDataLength:_f}),i=t.shift();if(null==i)throw Error("At least one protocol must be specified");r.log.trace('select: write ["%s", "%s"]',_d,i);let s=(0,nm.s)(`${_d}
`),o=(0,nm.s)(`${i}
`);await _m(n,[s,o],r),r.log.trace("select: reading multistream-select header");let a=await _b(n,r);if(r.log.trace('select: read "%s"',a),a===_d&&(r.log.trace("select: reading protocol response"),a=await _b(n,r),r.log.trace('select: read "%s"',a)),a===i)return{stream:n.unwrap(),protocol:i};for(let e of t){r.log.trace('select: write "%s"',e),await _g(n,(0,nm.s)(`${e}
`),r),r.log.trace("select: reading protocol response");let t=await _b(n,r);if(r.log.trace('select: read "%s" for "%s"',t,e),t===e)return{stream:n.unwrap(),protocol:e}}throw new uH("protocol selection failed")}function _E(e,t,r){let n=e.sink.bind(e),i=e.source,s=!1,o=!1,a=(0,a9.A)(),l=!1,c=!1,u=(0,a9.A)(),h=!1,d=!1,f=(0,a9.A)(),p=_h({sink:n,source:i},{...r,maxDataLength:_f});async function g(){if(o){r.log.trace("optimistic: already negotiating %s stream",t),await a.promise;return}o=!0;try{l||(r.log.trace("optimistic: doing send protocol for %s stream",t),await m()),h||(r.log.trace("optimistic: doing read protocol for %s stream",t),await y())}finally{o=!1,s=!0,a.resolve()}}async function m(){if(c)return void await u.promise;c=!0;try{r.log.trace('optimistic: write ["%s", "%s", data] in source',_d,t),await p.writeV([(0,nm.s)(`${_d}
`),(0,nm.s)(`${t}
`)]),r.log.trace('optimistic: wrote ["%s", "%s", data] in source',_d,t)}finally{l=!0,c=!1,u.resolve()}}async function y(){if(d)return void await f.promise;d=!0;try{r.log.trace("optimistic: reading multistream select header");let e=await _b(p,r);if(r.log.trace('optimistic: read multistream select header "%s"',e),e===_d&&(e=await _b(p,r)),r.log.trace('optimistic: read protocol "%s", expecting "%s"',e,t),e!==t)throw new uH("protocol selection failed")}finally{h=!0,d=!1,f.resolve()}}if(e.sink=async e=>{let{sink:n}=p.unwrap();await n(async function*(){let n=!1;for await(let i of e){if(c&&await u.promise,l)yield i;else{c=!0,r.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',_d,t,i.byteLength);let e=`${t}
`;yield new ro(Uint8Array.from([19]),(0,nm.s)(`${_d}
`),r3(e.length),(0,nm.s)(e),i).subarray(),r.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',_d,t,i.byteLength),l=!0,c=!1,u.resolve(),g().catch(e=>{r.log.error("could not finish optimistic protocol negotiation of %s",t,e)})}n=!0}n||await g()}())},e.source=async function*(){await g(),r.log.trace('optimistic: reading data from "%s" stream',t),yield*p.unwrap().source}(),null!=e.closeRead){let t=e.closeRead.bind(e);e.closeRead=async e=>{s||await g().catch(e=>{r.log.error("could not negotiate protocol before close read",e)}),await t(e)}}if(null!=e.closeWrite){let t=e.closeWrite.bind(e);e.closeWrite=async e=>{s||await g().catch(e=>{r.log.error("could not negotiate protocol before close write",e)}),await t(e)}}if(null!=e.close){let t=e.close.bind(e);e.close=async e=>{let r=[];c&&r.push(u.promise),d&&r.push(f.promise),r.length>0?await (0,u3.W)(Promise.all(r),e?.signal):(s=!0,o=!1,a.resolve()),await t(e)}}return{stream:e,protocol:t}}let _A=Symbol.for("@libp2p/connection"),_x=500;class _S{id;remoteAddr;remotePeer;direction;timeline;multiplexer;encryption;status;limits;log;tags;_newStream;_close;_abort;_getStreams;constructor(e){let{remoteAddr:t,remotePeer:r,newStream:n,close:i,abort:s,getStreams:o}=e;this.id=`${parseInt(String(1e9*Math.random())).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=r,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.limits=e.limits,this.log=e.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),null==this.remoteAddr.getPeerId()&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=n,this._close=i,this._abort=s,this._getStreams=o,this.tags=[]}[Symbol.toStringTag]="Connection";[_A]=!0;get streams(){return this._getStreams()}async newStream(e,t){if("closing"===this.status)throw new uR("the connection is being closed");if("closed"===this.status)throw new uO("the connection is closed");if(Array.isArray(e)||(e=[e]),null!=this.limits&&t?.runOnLimitedConnection!==!0)throw new uQ("Cannot open protocol stream on limited connection");let r=await this._newStream(e,t);return r.direction="outbound",r}async close(e={}){if("closed"!==this.status&&"closing"!==this.status){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",null==e.signal){let t=AbortSignal.timeout(_x);e={...e,signal:t}}try{this.log.trace("closing underlying transport"),await this._close(e),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(e){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,e),this.abort(e)}}}abort(e){"closed"!==this.status&&(this.log.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this._abort(e),this.status="closed",this.timeline.close=Date.now())}}function _k(e){return new _S(e)}function __(e,t){try{let{options:r}=t.getHandler(e);return r.maxInboundStreams}catch(e){if("UnhandledProtocolError"!==e.name)throw e}return k2}function _I(e,t,r={}){try{let{options:r}=t.getHandler(e);if(null!=r.maxOutboundStreams)return r.maxOutboundStreams}catch(e){if("UnhandledProtocolError"!==e.name)throw e}return r.maxOutboundStreams??k3}function _C(e,t,r){let n=0;return r.streams.forEach(r=>{r.direction===t&&r.protocol===e&&n++}),n}class _T{components;connectionEncrypters;streamMuxers;inboundUpgradeTimeout;inboundStreamProtocolNegotiationTimeout;outboundStreamProtocolNegotiationTimeout;events;metrics;constructor(e,t){this.components=e,this.connectionEncrypters=new Map,t.connectionEncrypters.forEach(e=>{this.connectionEncrypters.set(e.protocol,e)}),this.streamMuxers=new Map,t.streamMuxers.forEach(e=>{this.streamMuxers.set(e.protocol,e)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??kn,this.inboundStreamProtocolNegotiationTimeout=t.inboundStreamProtocolNegotiationTimeout??ki,this.outboundStreamProtocolNegotiationTimeout=t.outboundStreamProtocolNegotiationTimeout??ki,this.events=e.events,this.metrics={dials:e.metrics?.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:e.metrics?.registerCounterGroup("libp2p_connection_manager_dial_errors_total")}}[Symbol.toStringTag]="@libp2p/upgrader";async shouldBlockConnection(e,...t){let r=this.components.connectionGater[e];if(null!=r&&!0===await r.apply(this.components.connectionGater,t))throw new SM(`The multiaddr connection is blocked by gater.${e}`)}createInboundAbortSignal(e){return hQ([AbortSignal.timeout(this.inboundUpgradeTimeout),e])}async upgradeInbound(e,t){let r=!1,n=this.createInboundAbortSignal(t.signal);try{if(this.metrics.dials?.increment({inbound:!0}),!(r=await this.components.connectionManager.acceptIncomingConnection(e)))throw new SL("Connection denied");await this.shouldBlockConnection("denyInboundConnection",e),await this._performUpgrade(e,"inbound",{...t,signal:n})}catch(e){throw this.metrics.errors?.increment({inbound:!0}),e}finally{n.clear(),r&&this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,t){try{let r;this.metrics.dials?.increment({outbound:!0});let n=e.remoteAddr.getPeerId();null!=n&&(r=yT(n),await this.shouldBlockConnection("denyOutboundConnection",r,e));let i="outbound";return!1===t.initiator&&(i="inbound"),await this._performUpgrade(e,i,t)}catch(e){throw this.metrics.errors?.increment({outbound:!0}),e}}async _performUpgrade(e,t,r){let n,i,s,o,a;this.components.metrics?.trackMultiaddrConnection(e),e.log.trace("starting the %s connection upgrade",t);let l=e;if(r?.skipProtection!==!0){let n=this.components.connectionProtector;null!=n&&(e.log("protecting the %s connection",t),l=await n.protect(e,r))}try{if(n=l,r?.skipEncryption!==!0){r?.onProgress?.(new nV(`upgrader:encrypt-${t}-connection`)),{conn:n,remotePeer:i,protocol:a,streamMuxer:o}=await ("inbound"===t?this._encryptInbound(l,r):this._encryptOutbound(l,r));let e={...l,...n};await this.shouldBlockConnection("inbound"===t?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",i,e)}else{let r=e.remoteAddr.getPeerId();if(null==r)throw new uU(`${t} connection that skipped encryption must have a peer id`);let n=yT(r);a="native",i=n}if(i.equals(this.components.peerId)){let t=new uF("Can not dial self");throw e.abort(t),t}if(s=n,r?.muxerFactory!=null)o=r.muxerFactory;else if(null==o&&this.streamMuxers.size>0){r?.onProgress?.(new nV(`upgrader:multiplex-${t}-connection`));let e=await ("inbound"===t?this._multiplexInbound({...l,...n},this.streamMuxers,r):this._multiplexOutbound({...l,...n},this.streamMuxers,r));o=e.muxerFactory,s=e.stream}}catch(r){throw e.log.error("failed to upgrade inbound connection %s %a - %e","inbound"===t?"from":"to",e.remoteAddr,r),r}return await this.shouldBlockConnection("inbound"===t?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",i,e),e.log("successfully upgraded %s connection",t),this._createConnection({cryptoProtocol:a,direction:t,maConn:e,upgradedConn:s,muxerFactory:o,remotePeer:i,limits:r?.limits})}_createConnection(e){let t,r,n,{cryptoProtocol:i,direction:s,maConn:o,upgradedConn:a,remotePeer:l,muxerFactory:c,limits:u}=e;null!=c&&(t=c.createStreamMuxer({direction:s,onIncomingStream:e=>{null!=n&&Promise.resolve().then(async()=>{let t=this.components.registrar.getProtocols(),r=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout),{stream:i,protocol:s}=await _w(e,t,{signal:r,log:e.log,yieldBytes:!1});if(null==n)return;n.log("incoming stream opened on %s",s);let o=__(s,this.components.registrar);if(_C(s,"inbound",n)===o){let t=new uJ(`Too many inbound protocol streams for protocol "${s}" - limit ${o}`);throw e.abort(t),t}e.source=i.source,e.sink=i.sink,e.protocol=s,null!=i.closeWrite&&(e.closeWrite=i.closeWrite),null!=i.closeRead&&(e.closeRead=i.closeRead),null!=i.close&&(e.close=i.close),await this.components.peerStore.merge(l,{protocols:[s]}),this.components.metrics?.trackProtocolStream(e,n),this._onStream({connection:n,stream:e,protocol:s})}).catch(async t=>{n.log.error("error handling incoming stream id %s - %e",e.id,t),null==e.timeline.close&&await e.close()})}}),r=async(r,i={})=>{if(null==t)throw new SF("Connection is not multiplexed");n.log.trace("starting new stream for protocols %s",r);let o=await t.newStream();n.log.trace("started new stream %s for protocols %s",o.id,r);try{if(null==i.signal){o.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",r);let e=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);i={...i,signal:e}}o.log.trace("selecting protocol from protocols %s",r);let{stream:e,protocol:t}=await _v(o,r,{...i,log:o.log,yieldBytes:!0});o.log.trace("selected protocol %s",t);let s=_I(t,this.components.registrar,i),a=_C(t,"outbound",n);if(a>=s){let e=new uZ(`Too many outbound protocol streams for protocol "${t}" - ${a}/${s}`);throw o.abort(e),e}return await this.components.peerStore.merge(l,{protocols:[t]}),o.source=e.source,o.sink=e.sink,o.protocol=t,null!=e.closeWrite&&(o.closeWrite=e.closeWrite),null!=e.closeRead&&(o.closeRead=e.closeRead),null!=e.close&&(o.close=e.close),this.components.metrics?.trackProtocolStream(o,n),o}catch(t){throw n.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e","inbound"===s?"from":"to",e.maConn.remoteAddr,r,t),null==o.timeline.close&&o.abort(t),t}},Promise.all([t.sink(a.source),a.sink(t.source)]).catch(e=>{n.log.error("error piping data through muxer - %e",e)}));let h=o.timeline;o.timeline=new Proxy(h,{set:(...e)=>("close"===e[1]&&null!=e[2]&&null==h.close&&(async()=>{try{"open"===n.status&&await n.close()}catch(e){n.log.error("error closing connection after timeline close %e",e)}finally{this.events.safeDispatchEvent("connection:close",{detail:n})}})().catch(e=>{n.log.error("error thrown while dispatching connection:close event %e",e)}),Reflect.set(...e))}),o.timeline.upgraded=Date.now();let d=()=>{throw new SF("Connection is not multiplexed")};return n=_k({remoteAddr:o.remoteAddr,remotePeer:l,status:"open",direction:s,timeline:o.timeline,multiplexer:t?.protocol,encryption:i,limits:u,logger:this.components.logger,newStream:r??d,getStreams:()=>t?.streams??[],close:async e=>{await t?.close(e),await o.close(e)},abort:e=>{o.abort(e),t?.abort(e)}}),this.events.safeDispatchEvent("connection:open",{detail:n}),n.__maConnTimeline=h,n}_onStream(e){let{connection:t,stream:r,protocol:n}=e,{handler:i,options:s}=this.components.registrar.getHandler(n);if(null!=t.limits&&!0!==s.runOnLimitedConnection)throw new uQ("Cannot open protocol stream on limited connection");i({connection:t,stream:r})}async _encryptInbound(e,t){let r=Array.from(this.connectionEncrypters.keys());try{let{stream:n,protocol:i}=await _w(e,r,{...t,log:e.log}),s=this.connectionEncrypters.get(i);if(null==s)throw new SU(`no crypto module found for ${i}`);return e.log("encrypting inbound connection to %a using %s",e.remoteAddr,i),{...await s.secureInbound(n,t),protocol:i}}catch(t){throw e.log.error("encrypting inbound connection from %a failed",e.remoteAddr,t),new SU(t.message)}}async _encryptOutbound(e,t){let r=Array.from(this.connectionEncrypters.keys());try{e.log.trace("selecting encrypter from %s",r);let{stream:n,protocol:i}=await _v(e,r,{...t,log:e.log,yieldBytes:!0}),s=this.connectionEncrypters.get(i);if(null==s)throw new SU(`no crypto module found for ${i}`);return e.log("encrypting outbound connection to %a using %s",e.remoteAddr,i),{...await s.secureOutbound(n,t),protocol:i}}catch(t){throw e.log.error("encrypting outbound connection to %a failed",e.remoteAddr,t),new SU(t.message)}}async _multiplexOutbound(e,t,r){let n=Array.from(t.keys());e.log("outbound selecting muxer %s",n);try{e.log.trace("selecting stream muxer from %s",n);let{stream:i,protocol:s}=await _v(e,n,{...r,log:e.log,yieldBytes:!0});e.log("selected %s as muxer protocol",s);let o=t.get(s);return{stream:i,muxerFactory:o}}catch(t){throw e.log.error("error multiplexing outbound connection",t),new SF(String(t))}}async _multiplexInbound(e,t,r){let n=Array.from(t.keys());e.log("inbound handling muxers %s",n);try{let{stream:i,protocol:s}=await _w(e,n,{...r,log:e.log}),o=t.get(s);return{stream:i,muxerFactory:o}}catch(t){throw e.log.error("error multiplexing inbound connection",t),new SF(String(t))}}getConnectionEncrypters(){return this.connectionEncrypters}getStreamMuxers(){return this.streamMuxers}}let _P="2.8.5",_R="js-libp2p";function _O(e,t){return`${e??_R}/${t??_P} browser/${globalThis.navigator.userAgent}`}class _N extends uS{peerId;peerStore;contentRouting;peerRouting;metrics;services;logger;status;components;log;constructor(e){super(),this.status="stopped";let t=new uS,r=t.dispatchEvent.bind(t);t.dispatchEvent=e=>{let t=r(e),n=this.dispatchEvent(new CustomEvent(e.type,{detail:e.detail}));return t||n},this.peerId=e.peerId,this.logger=e.logger??(0,lC.Um)(),this.log=this.logger.forComponent("libp2p"),this.services={};let n=e.nodeInfo?.name??_R,i=e.nodeInfo?.version??_P,s=this.components=Sz({peerId:e.peerId,privateKey:e.privateKey,nodeInfo:{name:n,version:i,userAgent:e.nodeInfo?.userAgent??_O(n,i)},logger:this.logger,events:t,datastore:e.datastore??new x3.b,connectionGater:SZ(e.connectionGater),dns:e.dns});this.peerStore=this.configureComponent("peerStore",x2(s,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...e.peerStore})),null!=e.metrics&&(this.metrics=this.configureComponent("metrics",e.metrics(this.components))),s.events.addEventListener("peer:update",e=>{if(null==e.detail.previous){let t={id:e.detail.peer.id,multiaddrs:e.detail.peer.addresses.map(e=>e.multiaddr)};s.events.safeDispatchEvent("peer:discovery",{detail:t})}}),null!=e.connectionProtector&&this.configureComponent("connectionProtector",e.connectionProtector(s)),this.components.upgrader=new _T(this.components,{connectionEncrypters:(e.connectionEncrypters??[]).map((e,t)=>this.configureComponent(`connection-encryption-${t}`,e(this.components))),streamMuxers:(e.streamMuxers??[]).map((e,t)=>this.configureComponent(`stream-muxers-${t}`,e(this.components))),inboundUpgradeTimeout:e.connectionManager?.inboundUpgradeTimeout,inboundStreamProtocolNegotiationTimeout:e.connectionManager?.inboundStreamProtocolNegotiationTimeout??e.connectionManager?.protocolNegotiationTimeout,outboundStreamProtocolNegotiationTimeout:e.connectionManager?.outboundStreamProtocolNegotiationTimeout??e.connectionManager?.protocolNegotiationTimeout}),this.configureComponent("transportManager",new k5(this.components,e.transportManager)),this.configureComponent("connectionManager",new kM(this.components,e.connectionManager)),e.connectionMonitor?.enabled!==!1&&this.configureComponent("connectionMonitor",new kY(this.components,e.connectionMonitor)),this.configureComponent("registrar",new k4(this.components)),this.configureComponent("addressManager",new SS(this.components,e.addresses));let o=(e.peerRouters??[]).map((e,t)=>this.configureComponent(`peer-router-${t}`,e(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new k0(this.components,{routers:o}));let a=(e.contentRouters??[]).map((e,t)=>this.configureComponent(`content-router-${t}`,e(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new kX(this.components,{routers:a})),this.configureComponent("randomWalk",new k1(this.components)),(e.peerDiscovery??[]).forEach((e,t)=>{this.configureComponent(`peer-discovery-${t}`,e(this.components)).addEventListener("peer",e=>{this.#q(e)})}),e.transports?.forEach((e,t)=>{this.components.transportManager.add(this.configureComponent(`transport-${t}`,e(this.components)))}),null!=e.services)for(let t of Object.keys(e.services)){let r=(0,e.services[t])(this.components);if(null==r){this.log.error("service factory %s returned null or undefined instance",t);continue}this.services[t]=r,this.configureComponent(t,r),null!=r[us]&&(this.log("registering service %s for content routing",t),a.push(r[us])),null!=r[uo]&&(this.log("registering service %s for peer routing",t),o.push(r[uo])),null!=r[xb]&&(this.log("registering service %s for peer discovery",t),r[xb].addEventListener?.("peer",e=>{this.#q(e)}))}SV(s)}configureComponent(e,t){return null==t&&this.log.error("component %s was null or undefined",e),this.components[e]=t,t}async start(){if("stopped"===this.status){this.status="starting",this.log("libp2p is starting");try{await this.components.beforeStart?.(),await this.components.start(),await this.components.afterStart?.(),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(e){throw this.log.error("An error occurred starting libp2p",e),this.status="started",await this.stop(),e}}}async stop(){"started"===this.status&&(this.log("libp2p is stopping"),this.status="stopping",await this.components.beforeStop?.(),await this.components.stop(),await this.components.afterStop?.(),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(e){return this.components.connectionManager.getConnections(e)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){let e=new xw;for(let t of this.components.connectionManager.getConnections())e.add(t.remotePeer);return Array.from(e)}async dial(e,t={}){return this.components.connectionManager.openConnection(e,{priority:75,...t})}async dialProtocol(e,t,r={}){if(null==t||0===(t=Array.isArray(t)?t:[t]).length)throw new uC("no protocols were provided to open a stream");return(await this.dial(e,r)).newStream(t,r)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(e,t={}){we(e)&&(e=yT(e.getPeerId()??"")),await this.components.connectionManager.closeConnections(e,t)}async getPublicKey(e,t={}){if(this.log("getPublicKey %p",e),null!=e.publicKey)return e.publicKey;try{let t=await this.peerStore.get(e);if(null!=t.id.publicKey)return t.id.publicKey}catch(e){if("NotFoundError"!==e.name)throw e}let r=rt([(0,nm.s)("/pk/"),e.toMultihash().bytes]),n=ya(await this.contentRouting.get(r,t));return await this.peerStore.patch(e,{publicKey:n}),n}async handle(e,t,r){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async e=>{await this.components.registrar.handle(e,t,r)}))}async unhandle(e){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async e=>{await this.components.registrar.unhandle(e)}))}async register(e,t){return this.components.registrar.register(e,t)}unregister(e){this.components.registrar.unregister(e)}async isDialable(e,t={}){return this.components.connectionManager.isDialable(e,t)}#q(e){let{detail:t}=e;if(t.id.toString()===this.peerId.toString())return void this.log.error("peer discovery mechanism discovered self");this.components.peerStore.merge(t.id,{multiaddrs:t.multiaddrs}).catch(e=>{this.log.error(e)})}}async function _D(e={}){e.privateKey??=await yo("Ed25519");let t=new _N({...await xy(e),peerId:yR(e.privateKey)});return!1!==e.start&&await t.start(),t}let _B=8,_M=4194304;class _L extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class _F extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class _U extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}class _j extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}function _$(e){return null!=e[Symbol.asyncIterator]}function _H(e,t){if(e.byteLength>t)throw new _F("Message length too long")}let _q=e=>{let t=rY(e),r=(0,t9.K)(t);return r3(e,r),_q.bytes=t,r};_q.bytes=0,function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(eu||(eu={}));let _z=e=>{let t=r4(e);return _z.bytes=rY(t),t};function _V(e,t){let r=new ro,n=eu.LENGTH,i=-1,s=t?.lengthDecoder??_z,o=t?.maxLengthLength??_B,a=t?.maxDataLength??_M;function*l(){for(;r.byteLength>0;){if(n===eu.LENGTH)try{if((i=s(r))<0)throw new _L("Invalid message length");if(i>a)throw new _F("Message length too long");let e=s.bytes;r.consume(e),t?.onLength!=null&&t.onLength(i),n=eu.DATA}catch(e){if(e instanceof RangeError){if(r.byteLength>o)throw new _U("Message length length too long");break}throw e}if(n===eu.DATA){if(r.byteLength<i)break;let e=r.sublist(0,i);r.consume(i),t?.onData!=null&&t.onData(e),yield e,n=eu.LENGTH}}}return _$(e)?async function*(){for await(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new _j("Unexpected end of input")}():function*(){for(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new _j("Unexpected end of input")}()}function _K(){let e=(0,a9.A)(),t=!1;return{sink:async r=>{if(t)throw Error("already piped");t=!0,e.resolve(r)},source:async function*(){let t=await e.promise;yield*t}()}}function _G(){let e=_K(),t=_K();return[{source:e.source,sink:t.sink},{source:t.source,sink:e.sink}]}_z.bytes=0,_V.fromReader=(e,t)=>{let r=1,n=async function*(){for(;;)try{let{done:t,value:n}=await e.next(r);if(!0===t)return;null!=n&&(yield n)}catch(e){if("ERR_UNDER_READ"===e.code)return{done:!0,value:null};throw e}finally{r=1}}(),i=e=>{r=e};return _V(n,{...t??{},onLength:i})};let _W=65535,_Q=65519,_J=!!globalThis.process?.env?.DUMP_SESSION_KEYS;function _Z(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function _Y(e){if("boolean"!=typeof e)throw Error(`boolean expected, not ${e}`)}function _X(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function _0(e,...t){if(!_Z(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function _1(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function _2(e,t){_0(e);let r=t.outputLen;if(e.length<r)throw Error("digestInto() expects output buffer of length at least "+r)}function _3(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function _4(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function _5(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}let _6=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0],_8=null,_7=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0")),_9={_0:48,_9:57,A:65,F:70,a:97,f:102};function Ie(e){return e>=_9._0&&e<=_9._9?e-_9._0:e>=_9.A&&e<=_9.F?e-(_9.A-10):e>=_9.a&&e<=_9.f?e-(_9.a-10):void 0}function It(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function Ir(e){if("string"==typeof e)e=It(e);else if(_Z(e))e=Iu(e);else throw Error("Uint8Array expected, got "+typeof e);return e}function In(e,t){if(null==t||"object"!=typeof t)throw Error("options must be defined");return Object.assign(e,t)}function Ii(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r}let Is=(e,t)=>{function r(n,...i){if(_0(n),!_6)throw Error("Non little-endian hardware is not yet supported");if(void 0!==e.nonceLength){let t=i[0];if(!t)throw Error("nonce / iv required");e.varSizeNonce?_0(t):_0(t,e.nonceLength)}let s=e.tagLength;s&&void 0!==i[1]&&_0(i[1]);let o=t(n,...i),a=(e,t)=>{if(void 0!==t){if(2!==e)throw Error("cipher output not supported");_0(t)}},l=!1;return{encrypt(e,t){if(l)throw Error("cannot encrypt() twice with same key + nonce");return l=!0,_0(e),a(o.encrypt.length,t),o.encrypt(e,t)},decrypt(e,t){if(_0(e),s&&e.length<s)throw Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,t),o.decrypt(e,t)}}}return Object.assign(r,e),r};function Io(e,t,r=!0){if(void 0===t)return new Uint8Array(e);if(t.length!==e)throw Error("invalid output length, expected "+e+", got: "+t.length);if(r&&!Ic(t))throw Error("invalid output, must be aligned");return t}function Ia(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);let i=BigInt(32),s=BigInt(0xffffffff),o=Number(r>>i&s),a=Number(r&s),l=4*!!n,c=4*!n;e.setUint32(t+l,o,n),e.setUint32(t+c,a,n)}function Il(e,t,r){_Y(r);let n=new Uint8Array(16),i=_5(n);return Ia(i,0,BigInt(t),r),Ia(i,8,BigInt(e),r),n}function Ic(e){return e.byteOffset%4==0}function Iu(e){return Uint8Array.from(e)}let Ih=e=>Uint8Array.from(e.split("").map(e=>e.charCodeAt(0))),Id=Ih("expand 16-byte k"),If=Ih("expand 32-byte k"),Ip=_3(Id),Ig=_3(If);function Im(e,t){return e<<t|e>>>32-t}function Iy(e){return e.byteOffset%4==0}let Ib=64,Iw=16,Iv=0x100000000-1,IE=new Uint32Array;function IA(e,t,r,n,i,s,o,a){let l=i.length,c=new Uint8Array(Ib),u=_3(c),h=Iy(i)&&Iy(s),d=h?_3(i):IE,f=h?_3(s):IE;for(let p=0;p<l;o++){if(e(t,r,n,u,o,a),o>=Iv)throw Error("arx: counter overflow");let g=Math.min(Ib,l-p);if(h&&g===Ib){let e=p/4;if(p%4!=0)throw Error("arx: invalid block position");for(let t=0,r;t<Iw;t++)f[r=e+t]=d[r]^u[t];p+=Ib;continue}for(let e=0,t;e<g;e++)s[t=p+e]=i[t]^c[e];p+=g}}function Ix(e,t){let{allowShortKeys:r,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=In({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw Error("core must be a function");return _X(i),_X(o),_Y(s),_Y(r),(t,a,l,c,u=0)=>{let h,d;_0(t),_0(a),_0(l);let f=l.length;if(void 0===c&&(c=new Uint8Array(f)),_0(c),_X(u),u<0||u>=Iv)throw Error("arx: counter overflow");if(c.length<f)throw Error(`arx: output (${c.length}) is shorter than data (${f})`);let p=[],g=t.length;if(32===g)p.push(h=Iu(t)),d=Ig;else if(16===g&&r)(h=new Uint8Array(32)).set(t),h.set(t,16),d=Ip,p.push(h);else throw Error(`arx: invalid 32-byte key, got length=${g}`);Iy(a)||p.push(a=Iu(a));let m=_3(h);if(n){if(24!==a.length)throw Error("arx: extended nonce must be 24 bytes");n(d,m,_3(a.subarray(0,16)),m),a=a.subarray(16)}let y=16-i;if(y!==a.length)throw Error(`arx: nonce must be ${y} or 16 bytes`);if(12!==y){let e=new Uint8Array(12);e.set(a,s?0:12-a.length),a=e,p.push(a)}return IA(e,d,m,_3(a),l,c,u,o),_4(...p),c}}let IS=(e,t)=>255&e[t++]|(255&e[t++])<<8;class Ik{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,_0(e=Ir(e),32);let t=IS(e,0),r=IS(e,2),n=IS(e,4),i=IS(e,6),s=IS(e,8),o=IS(e,10),a=IS(e,12),l=IS(e,14);this.r[0]=8191&t,this.r[1]=(t>>>13|r<<3)&8191,this.r[2]=(r>>>10|n<<6)&7939,this.r[3]=(n>>>7|i<<9)&8191,this.r[4]=(i>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|o<<2)&8191,this.r[7]=(o>>>11|a<<5)&8065,this.r[8]=(a>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let t=0;t<8;t++)this.pad[t]=IS(e,16+2*t)}process(e,t,r=!1){let n=2048*!r,{h:i,r:s}=this,o=s[0],a=s[1],l=s[2],c=s[3],u=s[4],h=s[5],d=s[6],f=s[7],p=s[8],g=s[9],m=IS(e,t+0),y=IS(e,t+2),b=IS(e,t+4),w=IS(e,t+6),v=IS(e,t+8),E=IS(e,t+10),A=IS(e,t+12),x=IS(e,t+14),S=i[0]+(8191&m),k=i[1]+((m>>>13|y<<3)&8191),_=i[2]+((y>>>10|b<<6)&8191),I=i[3]+((b>>>7|w<<9)&8191),C=i[4]+((w>>>4|v<<12)&8191),T=i[5]+(v>>>1&8191),P=i[6]+((v>>>14|E<<2)&8191),R=i[7]+((E>>>11|A<<5)&8191),O=i[8]+((A>>>8|x<<8)&8191),N=i[9]+(x>>>5|n),D=0,B=0+S*o+5*g*k+5*p*_+5*f*I+5*d*C;D=B>>>13,B&=8191,B+=5*h*T+5*u*P+5*c*R+5*l*O+5*a*N,D+=B>>>13,B&=8191;let M=D+S*a+k*o+5*g*_+5*p*I+5*f*C;D=M>>>13,M&=8191,M+=5*d*T+5*h*P+5*u*R+5*c*O+5*l*N,D+=M>>>13,M&=8191;let L=D+S*l+k*a+_*o+5*g*I+5*p*C;D=L>>>13,L&=8191,L+=5*f*T+5*d*P+5*h*R+5*u*O+5*c*N,D+=L>>>13,L&=8191;let F=D+S*c+k*l+_*a+I*o+5*g*C;D=F>>>13,F&=8191,F+=5*p*T+5*f*P+5*d*R+5*h*O+5*u*N,D+=F>>>13,F&=8191;let U=D+S*u+k*c+_*l+I*a+C*o;D=U>>>13,U&=8191,U+=5*g*T+5*p*P+5*f*R+5*d*O+5*h*N,D+=U>>>13,U&=8191;let j=D+S*h+k*u+_*c+I*l+C*a;D=j>>>13,j&=8191,j+=T*o+5*g*P+5*p*R+5*f*O+5*d*N,D+=j>>>13,j&=8191;let $=D+S*d+k*h+_*u+I*c+C*l;D=$>>>13,$&=8191,$+=T*a+P*o+5*g*R+5*p*O+5*f*N,D+=$>>>13,$&=8191;let H=D+S*f+k*d+_*h+I*u+C*c;D=H>>>13,H&=8191,H+=T*l+P*a+R*o+5*g*O+5*p*N,D+=H>>>13,H&=8191;let q=D+S*p+k*f+_*d+I*h+C*u;D=q>>>13,q&=8191,q+=T*c+P*l+R*a+O*o+5*g*N,D+=q>>>13,q&=8191;let z=D+S*g+k*p+_*f+I*d+C*h;D=z>>>13,z&=8191,z+=T*u+P*c+R*l+O*a+N*o,D+=z>>>13,z&=8191,B=8191&(D=(D=(D<<2)+D|0)+B|0),D>>>=13,M+=D,i[0]=B,i[1]=M,i[2]=L,i[3]=F,i[4]=U,i[5]=j,i[6]=$,i[7]=H,i[8]=q,i[9]=z}finalize(){let{h:e,pad:t}=this,r=new Uint16Array(10),n=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=n,n=e[t]>>>13,e[t]&=8191;e[0]+=5*n,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,r[0]=e[0]+5,n=r[0]>>>13,r[0]&=8191;for(let t=1;t<10;t++)r[t]=e[t]+n,n=r[t]>>>13,r[t]&=8191;r[9]-=8192;let i=(1^n)-1;for(let e=0;e<10;e++)r[e]&=i;i=~i;for(let t=0;t<10;t++)e[t]=e[t]&i|r[t];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let s=e[0]+t[0];e[0]=65535&s;for(let r=1;r<8;r++)s=(e[r]+t[r]|0)+(s>>>16)|0,e[r]=65535&s;_4(r)}update(e){_1(this),_0(e=Ir(e));let{buffer:t,blockLen:r}=this,n=e.length;for(let i=0;i<n;){let s=Math.min(r-this.pos,n-i);if(s===r){for(;r<=n-i;i+=r)this.process(e,i);continue}t.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===r&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){_4(this.h,this.r,this.buffer,this.pad)}digestInto(e){_1(this),_2(e,this),this.finished=!0;let{buffer:t,h:r}=this,{pos:n}=this;if(n){for(t[n++]=1;n<16;n++)t[n]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let t=0;t<8;t++)e[i++]=r[t]>>>0,e[i++]=r[t]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}}let I_=function(e){let t=(t,r)=>e(r).update(Ir(t)).digest(),r=e(new Uint8Array(32));return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}(e=>new Ik(e));function II(e,t,r,n,i,s=20){let o=e[0],a=e[1],l=e[2],c=e[3],u=t[0],h=t[1],d=t[2],f=t[3],p=t[4],g=t[5],m=t[6],y=t[7],b=i,w=r[0],v=r[1],E=r[2],A=o,x=a,S=l,k=c,_=u,I=h,C=d,T=f,P=p,R=g,O=m,N=y,D=b,B=w,M=v,L=E;for(let e=0;e<s;e+=2)P=P+(D=Im(D^(A=A+_|0),16))|0,A=A+(_=Im(_^P,12))|0,P=P+(D=Im(D^A,8))|0,_=Im(_^P,7),R=R+(B=Im(B^(x=x+I|0),16))|0,x=x+(I=Im(I^R,12))|0,R=R+(B=Im(B^x,8))|0,I=Im(I^R,7),O=O+(M=Im(M^(S=S+C|0),16))|0,S=S+(C=Im(C^O,12))|0,O=O+(M=Im(M^S,8))|0,C=Im(C^O,7),N=N+(L=Im(L^(k=k+T|0),16))|0,k=k+(T=Im(T^N,12))|0,N=N+(L=Im(L^k,8))|0,T=Im(T^N,7),O=O+(L=Im(L^(A=A+I|0),16))|0,A=A+(I=Im(I^O,12))|0,O=O+(L=Im(L^A,8))|0,I=Im(I^O,7),N=N+(D=Im(D^(x=x+C|0),16))|0,x=x+(C=Im(C^N,12))|0,N=N+(D=Im(D^x,8))|0,C=Im(C^N,7),P=P+(B=Im(B^(S=S+T|0),16))|0,S=S+(T=Im(T^P,12))|0,P=P+(B=Im(B^S,8))|0,T=Im(T^P,7),R=R+(M=Im(M^(k=k+_|0),16))|0,k=k+(_=Im(_^R,12))|0,R=R+(M=Im(M^k,8))|0,_=Im(_^R,7);let F=0;n[F++]=o+A|0,n[F++]=a+x|0,n[F++]=l+S|0,n[F++]=c+k|0,n[F++]=u+_|0,n[F++]=h+I|0,n[F++]=d+C|0,n[F++]=f+T|0,n[F++]=p+P|0,n[F++]=g+R|0,n[F++]=m+O|0,n[F++]=y+N|0,n[F++]=b+D|0,n[F++]=w+B|0,n[F++]=v+M|0,n[F++]=E+L|0}function IC(e,t,r,n){let i=e[0],s=e[1],o=e[2],a=e[3],l=t[0],c=t[1],u=t[2],h=t[3],d=t[4],f=t[5],p=t[6],g=t[7],m=r[0],y=r[1],b=r[2],w=r[3];for(let e=0;e<20;e+=2)d=d+(m=Im(m^(i=i+l|0),16))|0,i=i+(l=Im(l^d,12))|0,d=d+(m=Im(m^i,8))|0,l=Im(l^d,7),f=f+(y=Im(y^(s=s+c|0),16))|0,s=s+(c=Im(c^f,12))|0,f=f+(y=Im(y^s,8))|0,c=Im(c^f,7),p=p+(b=Im(b^(o=o+u|0),16))|0,o=o+(u=Im(u^p,12))|0,p=p+(b=Im(b^o,8))|0,u=Im(u^p,7),g=g+(w=Im(w^(a=a+h|0),16))|0,a=a+(h=Im(h^g,12))|0,g=g+(w=Im(w^a,8))|0,h=Im(h^g,7),p=p+(w=Im(w^(i=i+c|0),16))|0,i=i+(c=Im(c^p,12))|0,p=p+(w=Im(w^i,8))|0,c=Im(c^p,7),g=g+(m=Im(m^(s=s+u|0),16))|0,s=s+(u=Im(u^g,12))|0,g=g+(m=Im(m^s,8))|0,u=Im(u^g,7),d=d+(y=Im(y^(o=o+h|0),16))|0,o=o+(h=Im(h^d,12))|0,d=d+(y=Im(y^o,8))|0,h=Im(h^d,7),f=f+(b=Im(b^(a=a+l|0),16))|0,a=a+(l=Im(l^f,12))|0,f=f+(b=Im(b^a,8))|0,l=Im(l^f,7);let v=0;n[v++]=i,n[v++]=s,n[v++]=o,n[v++]=a,n[v++]=m,n[v++]=y,n[v++]=b,n[v++]=w}let IT=Ix(II,{counterRight:!1,counterLength:4,allowShortKeys:!1}),IP=Ix(II,{counterRight:!1,counterLength:8,extendNonceFn:IC,allowShortKeys:!1}),IR=new Uint8Array(16),IO=(e,t)=>{e.update(t);let r=t.length%16;r&&e.update(IR.subarray(r))},IN=new Uint8Array(32);function ID(e,t,r,n,i){let s=e(t,r,IN),o=I_.create(s);i&&IO(o,i),IO(o,n);let a=Il(n.length,i?i.length:0,!0);o.update(a);let l=o.digest();return _4(s,a),l}let IB=e=>(t,r,n)=>{let i=16;return{encrypt(s,o){let a=s.length;(o=Io(a+i,o,!1)).set(s);let l=o.subarray(0,-i);e(t,r,l,l,1);let c=ID(e,t,r,l,n);return o.set(c,a),_4(c),o},decrypt(s,o){o=Io(s.length-i,o,!1);let a=s.subarray(0,-i),l=s.subarray(-i),c=ID(e,t,r,a,n);if(!Ii(l,c))throw Error("invalid tag");return o.set(s.subarray(0,-i)),e(t,r,o,o,1),_4(c),o}}},IM=Is({blockSize:64,nonceLength:12,tagLength:16},IB(IT));function IL(e,t,r){return fE(e),void 0===r&&(r=new Uint8Array(e.outputLen)),mw(e,fO(r),fO(t))}IB(IP);let IF=Uint8Array.from([0]),IU=Uint8Array.of();function Ij(e,t,r,n=32){fE(e),fw(n);let i=e.outputLen;if(n>255*i)throw Error("Length should be <= 255*HashLen");let s=Math.ceil(n/i);void 0===r&&(r=IU);let o=new Uint8Array(s*i),a=mw.create(e,t),l=a._cloneInto(),c=new Uint8Array(a.outputLen);for(let e=0;e<s;e++)IF[0]=e+1,l.update(0===e?IU:c).update(r).update(IF).digestInto(c),o.set(c,i*e),a._cloneInto(l);return a.destroy(),l.destroy(),fS(c,IF),o.slice(0,n)}let I$={hashSHA256:e=>me(e.subarray()),getHKDF(e,t){let r=IL(me,t,e),n=Ij(me,r,void 0,96),i=n.subarray(0,32);return[i,n.subarray(32,64),n.subarray(64,96)]},generateX25519KeyPair(){let e=gF.utils.randomPrivateKey();return{publicKey:gF.getPublicKey(e),privateKey:e}},generateX25519KeyPairFromSeed:e=>({publicKey:gF.getPublicKey(e),privateKey:e}),generateX25519SharedKey:(e,t)=>gF.getSharedSecret(e.subarray(),t.subarray()),chaCha20Poly1305Encrypt:(e,t,r,n)=>IM(n,t,r).encrypt(e.subarray()),chaCha20Poly1305Decrypt:(e,t,r,n,i)=>IM(n,t,r).decrypt(e.subarray(),i)};function IH(e){return{generateKeypair:e.generateX25519KeyPair,dh:(t,r)=>e.generateX25519SharedKey(t.privateKey,r).subarray(0,32),encrypt:e.chaCha20Poly1305Encrypt,decrypt:e.chaCha20Poly1305Decrypt,hash:e.hashSHA256,hkdf:e.getHKDF}}let Iq=e=>{let t=(0,t9.K)(2);return t[0]=e>>8,t[1]=e,t};Iq.bytes=2;let Iz=e=>{if(e.length<2)throw RangeError("Could not decode int16BE");if(e instanceof Uint8Array){let t;return 0+(e[0]<<8)+e[1]}return e.getUint16(0)};function IV(e){return{xxHandshakeSuccesses:e.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:e.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:e.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:e.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:e.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function IK(e,t){t.enabled&&_J&&(e?(t(`LOCAL_STATIC_PUBLIC_KEY ${(0,uh.d)(e.publicKey,"hex")}`),t(`LOCAL_STATIC_PRIVATE_KEY ${(0,uh.d)(e.privateKey,"hex")}`)):t("Missing local static keys."))}function IG(e,t){t.enabled&&_J&&(e?(t(`LOCAL_PUBLIC_EPHEMERAL_KEY ${(0,uh.d)(e.publicKey,"hex")}`),t(`LOCAL_PRIVATE_EPHEMERAL_KEY ${(0,uh.d)(e.privateKey,"hex")}`)):t("Missing local ephemeral keys."))}function IW(e,t){t.enabled&&_J&&t(e?`REMOTE_STATIC_PUBLIC_KEY ${(0,uh.d)(e.subarray(),"hex")}`:"Missing remote static public key.")}function IQ(e,t){t.enabled&&_J&&t(e?`REMOTE_EPHEMERAL_PUBLIC_KEY ${(0,uh.d)(e.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function IJ(e,t,r){r.enabled&&_J&&(r(`CIPHER_STATE_1 ${e.n.getUint64()} ${e.k&&(0,uh.d)(e.k,"hex")}`),r(`CIPHER_STATE_2 ${t.n.getUint64()} ${t.k&&(0,uh.d)(t.k,"hex")}`))}Iz.bytes=2;class IZ extends Error{code;constructor(e="Invalid crypto exchange"){super(e),this.code=IZ.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"}let IY=0,IX=0xffffffff,I0="Cipherstate has reached maximum n, a new handshake must be performed";class I1{n;bytes;view;constructor(e=IY){this.n=e,this.bytes=(0,t9.c)(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>IX)throw Error(I0)}}let I2=(0,t9.c)(0);class I3{k;n;crypto;constructor(e,t,r=0){this.crypto=e,this.k=t,this.n=new I1(r)}hasKey(){return!!this.k}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();let r=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),r}decryptWithAd(e,t,r){if(!this.hasKey())return t;this.n.assertValue();let n=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,r);return this.n.increment(),n}}class I4{cs;ck;h;crypto;constructor(e,t){this.crypto=e;let r=(0,nm.s)(t,"utf-8");this.h=I8(e,r),this.ck=this.h,this.cs=new I3(e)}mixKey(e){let[t,r]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new I3(this.crypto,r)}mixHash(e){this.h=this.crypto.hash(new ro(this.h,e))}encryptAndHash(e){let t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){let t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){let[e,t]=this.crypto.hkdf(this.ck,I2);return[new I3(this.crypto,e),new I3(this.crypto,t)]}}class I5{ss;s;e;rs;re;initiator;crypto;constructor(e){let{crypto:t,protocolName:r,prologue:n,initiator:i,s,e:o,rs:a,re:l}=e;this.crypto=t,this.ss=new I4(t,r),this.ss.mixHash(n),this.initiator=i,this.s=s,this.e=o,this.rs=a,this.re=l}writeE(){if(this.e)throw Error("ephemeral keypair is already set");let e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw Error("ephemeral keypair is not set");if(!this.re)throw Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw Error("ephemeral keypair is not set");if(!this.rs)throw Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw Error("static keypair is not set");if(!this.re)throw Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw Error("static keypair is not set");if(!this.re)throw Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw Error("ephemeral keypair is not set");if(!this.rs)throw Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e,t=0){if(this.re)throw Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e,t=0){if(this.rs)throw Error("remote static public key is already set");let r=32+16*!!this.ss.cs.hasKey();if(e.byteLength<t+r)throw Error("message is not long enough");let n=e.sublist(t,t+r);return this.rs=this.ss.decryptAndHash(n),r}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}}class I6 extends I5{writeMessageA(e){return new ro(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){let t=this.writeE();this.writeEE();let r=this.writeS();return this.writeES(),new ro(t,r,this.ss.encryptAndHash(e))}writeMessageC(e){let t=this.writeS();return this.writeSE(),new ro(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(e){throw new IZ(`handshake stage 0 validation fail: ${e.message}`)}}readMessageB(e){try{this.readE(e),this.readEE();let t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(e){throw new IZ(`handshake stage 1 validation fail: ${e.message}`)}}readMessageC(e){try{let t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(e){throw new IZ(`handshake stage 2 validation fail: ${e.message}`)}}}function I8(e,t){if(!(t.length<=32))return e.hash(t);{let e=(0,t9.c)(32);return e.set(t),e}}async function I7(e,t,r){let n=await e.sign(Ce(t));return ed.encode({identityKey:yu(e.publicKey),identitySig:n,extensions:r})}async function I9(e,t,r){try{let n=ed.decode(e),i=ya(n.identityKey);if(r?.equals(i)===!1)throw Error(`Payload identity key ${i} does not match expected remote identity key ${r}`);if(!t)throw Error("Remote static does not exist");let s=Ce(t);if(!await i.verify(s,n.identitySig))throw Error("Invalid payload signature");return n}catch(e){throw new u_(e.message)}}function Ce(e){let t=(0,nm.s)("noise-libp2p-static-key:");return e instanceof Uint8Array?rt([t,e],t.length+e.length):(e.prepend(t),e)}async function Ct(e,t){let{log:r,connection:n,crypto:i,privateKey:s,prologue:o,s:a,remoteIdentityKey:l,extensions:c}=e,u=await I7(s,a.publicKey,c),h=new I6({crypto:i,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:o,s:a});IK(h.s,r),r.trace("Stage 0 - Initiator starting to send first message."),await n.write(h.writeMessageA(I2),t),r.trace("Stage 0 - Initiator finished sending first message."),IG(h.e,r),r.trace("Stage 1 - Initiator waiting to receive first message from responder...");let d=h.readMessageB(await n.read(t));r.trace("Stage 1 - Initiator received the message."),IQ(h.re,r),IW(h.rs,r),r.trace("Initiator going to check remote's signature...");let f=await I9(d,h.rs,l);r.trace("All good with the signature!"),r.trace("Stage 2 - Initiator sending third handshake message."),await n.write(h.writeMessageC(u),t),r.trace("Stage 2 - Initiator sent message with signed payload.");let[p,g]=h.ss.split();return IJ(p,g,r),{payload:f,encrypt:e=>p.encryptWithAd(I2,e),decrypt:(e,t)=>g.decryptWithAd(I2,e,t)}}async function Cr(e,t){let{log:r,connection:n,crypto:i,privateKey:s,prologue:o,s:a,remoteIdentityKey:l,extensions:c}=e,u=await I7(s,a.publicKey,c),h=new I6({crypto:i,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:o,s:a});IK(h.s,r),r.trace("Stage 0 - Responder waiting to receive first message."),h.readMessageA(await n.read(t)),r.trace("Stage 0 - Responder received first message."),IQ(h.re,r),r.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(h.writeMessageB(u),t),r.trace("Stage 1 - Responder sent the second handshake message with signed payload."),IG(h.e,r),r.trace("Stage 2 - Responder waiting for third handshake message...");let d=h.readMessageC(await n.read(t));r.trace("Stage 2 - Responder received the message, finished handshake.");let f=await I9(d,h.rs,l),[p,g]=h.ss.split();return IJ(p,g,r),{payload:f,encrypt:e=>g.encryptWithAd(I2,e),decrypt:(e,t)=>p.decryptWithAd(I2,e,t)}}!function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.webtransportCerthashes)for(let r of e.webtransportCerthashes)t.uint32(10),t.bytes(r);if(null!=e.streamMuxers)for(let r of e.streamMuxers)t.uint32(18),t.string(r);!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={webtransportCerthashes:[],streamMuxers:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:if(r.limits?.webtransportCerthashes!=null&&n.webtransportCerthashes.length===r.limits.webtransportCerthashes)throw new nL('Decode error - map field "webtransportCerthashes" had too many elements');n.webtransportCerthashes.push(e.bytes());break;case 2:if(r.limits?.streamMuxers!=null&&n.streamMuxers.length===r.limits.streamMuxers)throw new nL('Decode error - map field "streamMuxers" had too many elements');n.streamMuxers.push(e.string());break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(eh||(eh={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.identityKey&&e.identityKey.byteLength>0&&(t.uint32(10),t.bytes(e.identityKey)),null!=e.identitySig&&e.identitySig.byteLength>0&&(t.uint32(18),t.bytes(e.identitySig)),null!=e.extensions&&(t.uint32(34),eh.codec().encode(e.extensions,t)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={identityKey:(0,t9.c)(0),identitySig:(0,t9.c)(0)},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.identityKey=e.bytes();break;case 2:n.identitySig=e.bytes();break;case 4:n.extensions=eh.codec().decode(e,e.uint32(),{limits:r.limits?.extensions});break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(ed||(ed={}));let Cn=16;function Ci(e,t){return async function*(r){for await(let n of r)for(let r=0;r<n.length;r+=_Q){let i,s=r+_Q;s>n.length&&(s=n.length),i=n instanceof Uint8Array?e.encrypt(n.subarray(r,s)):e.encrypt(n.sublist(r,s)),t?.encryptedPackets.increment(),yield new ro(Iq(i.byteLength),i)}}}function Cs(e,t){return async function*(r){for await(let n of r)for(let r=0;r<n.length;r+=_W){let i=r+_W;if(i>n.length&&(i=n.length),i-Cn<r)throw Error("Invalid chunk");let s=n.sublist(r,i),o=n.subarray(r,i-Cn);try{let r=e.decrypt(s,o);t?.decryptedPackets.increment(),yield r}catch(e){throw t?.decryptErrors.increment(),e}}}}class Co{protocol="/noise";crypto;prologue;staticKey;extensions;metrics;components;constructor(e,t={}){let{staticNoiseKey:r,extensions:n,crypto:i,prologueBytes:s}=t,{metrics:o}=e;this.components=e;let a=i??I$;this.crypto=IH(a),this.extensions={webtransportCerthashes:[],...n},this.metrics=o?IV(o):void 0,r?this.staticKey=a.generateX25519KeyPairFromSeed(r):this.staticKey=a.generateX25519KeyPair(),this.prologue=s??(0,t9.c)(0)}[Symbol.toStringTag]="@chainsafe/libp2p-noise";[En]=["@libp2p/connection-encryption","@chainsafe/libp2p-noise"];async secureOutbound(e,t){let r=_h(e,{lengthEncoder:Iq,lengthDecoder:Iz,maxDataLength:_W}),n=await this.performHandshakeInitiator(r,this.components.privateKey,t?.remotePeer?.publicKey,t),i=await this.createSecureConnection(r,n);e.source=i.source,e.sink=i.sink;let s=ya(n.payload.identityKey);return{conn:e,remoteExtensions:n.payload.extensions,remotePeer:yP(s),streamMuxer:t?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(n.payload.extensions?.streamMuxers)}}getStreamMuxer(e){if(null==e||0===e.length)return;let t=this.components.upgrader.getStreamMuxers();if(null!=t)for(let r of e){let e=t.get(r);if(null!=e)return e}if(e.length)throw new uI("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(e,t){let r=_h(e,{lengthEncoder:Iq,lengthDecoder:Iz,maxDataLength:_W}),n=await this.performHandshakeResponder(r,this.components.privateKey,t?.remotePeer?.publicKey,t),i=await this.createSecureConnection(r,n);e.source=i.source,e.sink=i.sink;let s=ya(n.payload.identityKey);return{conn:e,remoteExtensions:n.payload.extensions,remotePeer:yP(s),streamMuxer:t?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(n.payload.extensions?.streamMuxers)}}async performHandshakeInitiator(e,t,r,n){let i,s=n?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{i=await Ct({connection:e,privateKey:t,remoteIdentityKey:r,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:s,webtransportCerthashes:[],...this.extensions}},n),this.metrics?.xxHandshakeSuccesses.increment()}catch(e){throw this.metrics?.xxHandshakeErrors.increment(),e}return i}async performHandshakeResponder(e,t,r,n){let i,s=n?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{i=await Cr({connection:e,privateKey:t,remoteIdentityKey:r,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:s,webtransportCerthashes:[],...this.extensions}},n),this.metrics?.xxHandshakeSuccesses.increment()}catch(e){throw this.metrics?.xxHandshakeErrors.increment(),e}return i}async createSecureConnection(e,t){let[r,n]=_G(),i=e.unwrap();return await (0,lr.F)(r,Ci(t,this.metrics),i,e=>_V(e,{lengthDecoder:Iz}),Cs(t,this.metrics),r),n}}function Ca(e={}){return t=>new Co(t,e)}function Cl(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw Error("argument is not an iterator or iterable")}class Cc extends Error{static name="InvalidFrameError";constructor(e="The frame was invalid"){super(e),this.name="InvalidFrameError"}}class Cu extends Error{static name="UnrequestedPingError";constructor(e="Unrequested ping error"){super(e),this.name="UnrequestedPingError"}}class Ch extends Error{static name="NotMatchingPingError";constructor(e="Unrequested ping error"){super(e),this.name="NotMatchingPingError"}}class Cd extends Error{static name="InvalidStateError";constructor(e="Invalid state"){super(e),this.name="InvalidStateError"}}class Cf extends Error{static name="StreamAlreadyExistsError";constructor(e="Strean already exists"){super(e),this.name="StreamAlreadyExistsError"}}class Cp extends Error{static name="DecodeInvalidVersionError";constructor(e="Decode invalid version"){super(e),this.name="DecodeInvalidVersionError"}}class Cg extends Error{static name="BothClientsError";constructor(e="Both clients"){super(e),this.name="BothClientsError"}}class Cm extends Error{static name="ReceiveWindowExceededError";constructor(e="Receive window exceeded"){super(e),this.name="ReceiveWindowExceededError"}}let Cy=new Set([Cc.name,Cu.name,Ch.name,Cf.name,Cp.name,Cg.name,Cm.name]),Cb=262144,Cw={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:262144,maxStreamWindowSize:0x1000000,maxMessageSize:65536};function Cv(e){if(e.keepAliveInterval<=0)throw new uC("keep-alive interval must be positive");if(e.maxInboundStreams<0)throw new uC("max inbound streams must be larger or equal 0");if(e.maxOutboundStreams<0)throw new uC("max outbound streams must be larger or equal 0");if(e.initialStreamWindowSize<Cb)throw new uC("InitialStreamWindowSize must be larger or equal 256 kB");if(e.maxStreamWindowSize<e.initialStreamWindowSize)throw new uC("MaxStreamWindowSize must be larger than the InitialStreamWindowSize");if(e.maxStreamWindowSize>0x100000000-1)throw new uC("MaxStreamWindowSize must be less than equal MAX_UINT32");if(e.maxMessageSize<1024)throw new uC("MaxMessageSize must be greater than a kilobyte")}!function(e){e[e.Data=0]="Data",e[e.WindowUpdate=1]="WindowUpdate",e[e.Ping=2]="Ping",e[e.GoAway=3]="GoAway"}(ef||(ef={})),function(e){e[e.SYN=1]="SYN",e[e.ACK=2]="ACK",e[e.FIN=4]="FIN",e[e.RST=8]="RST"}(ep||(ep={})),Object.values(ep).filter(e=>"string"!=typeof e);let CE=0;!function(e){e[e.NormalTermination=0]="NormalTermination",e[e.ProtocolError=1]="ProtocolError",e[e.InternalError=2]="InternalError"}(eg||(eg={}));let CA=12,Cx=0x1000000;function CS(e){if(e[0]!==CE)throw new Cc("Invalid frame version");return{type:e[1],flag:(e[2]<<8)+e[3],streamID:e[4]*Cx+(e[5]<<16)+(e[6]<<8)+e[7],length:e[8]*Cx+(e[9]<<16)+(e[10]<<8)+e[11]}}class Ck{source;buffer;frameInProgress;constructor(e){this.source=C_(e),this.buffer=new ro,this.frameInProgress=!1}async *emitFrames(){for await(let e of this.source)for(this.buffer.append(e);;){let e=this.readHeader();if(void 0===e)break;let{type:t,length:r}=e;t===ef.Data?(this.frameInProgress=!0,yield{header:e,readData:this.readBytes.bind(this,r)}):yield{header:e}}}readHeader(){if(this.frameInProgress)throw new Cd("decoding frame already in progress");if(this.buffer.length<CA)return;let e=CS(this.buffer.subarray(0,CA));return this.buffer.consume(CA),e}async readBytes(e){if(this.buffer.length<e){for await(let t of this.source)if(this.buffer.append(t),this.buffer.length>=e)break}let t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t}}function C_(e){if(void 0!==e[Symbol.iterator]){let t=e[Symbol.iterator]();return t.return=void 0,{[Symbol.iterator]:()=>t}}if(void 0!==e[Symbol.asyncIterator]){let t=e[Symbol.asyncIterator]();return t.return=void 0,{[Symbol.asyncIterator]:()=>t}}throw Error("a source must be either an iterable or an async iterable")}function CI(e){let t=new Uint8Array(CA);return t[1]=e.type,t[2]=e.flag>>>8,t[3]=e.flag,t[4]=e.streamID>>>24,t[5]=e.streamID>>>16,t[6]=e.streamID>>>8,t[7]=e.streamID,t[8]=e.length>>>24,t[9]=e.length>>>16,t[10]=e.length>>>8,t[11]=e.length,t}function CC(e){return null!=e&&"function"==typeof e.then&&"function"==typeof e.catch&&"function"==typeof e.finally}function CT(e,t){let r=Cl(e).return?.();CC(r)&&r.catch(e=>{t.error("could not cause iterator to return",e)})}let CP=5e3;function CR(e){return null!=e&&"function"==typeof e.then&&"function"==typeof e.catch&&"function"==typeof e.finally}class CO{id;direction;timeline;protocol;metadata;source;status;readStatus;writeStatus;log;sinkController;sinkEnd;closed;endErr;streamSource;onEnd;onCloseRead;onCloseWrite;onReset;onAbort;sendCloseWriteTimeout;sendingData;constructor(e){this.sinkController=new AbortController,this.sinkEnd=(0,a9.A)(),this.closed=(0,a9.A)(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=e.sendCloseWriteTimeout??CP,this.onEnd=e.onEnd,this.onCloseRead=e?.onCloseRead,this.onCloseWrite=e?.onCloseWrite,this.onReset=e?.onReset,this.onAbort=e?.onAbort,this.source=this.streamSource=(0,li.Ny)({onEnd:e=>{null!=e?this.log.trace("source ended with error",e):this.log.trace("source ended"),this.onSourceEnd(e)}}),this.sink=this.sink.bind(this)}async sink(e){if("ready"!==this.writeStatus)throw new uM(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";let t={signal:this.sinkController.signal};if("outbound"===this.direction){let e=this.sendNewStream(t);CR(e)&&await e}let r=()=>{CT(e,this.log)};try{for await(let n of(this.sinkController.signal.addEventListener("abort",r),this.log.trace("sink reading from source"),e)){n=n instanceof Uint8Array?new ro(n):n;let e=this.sendData(n,t);CR(e)&&(this.sendingData=(0,a9.A)(),await e,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",r)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),"writing"===this.writeStatus&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(e){throw this.log.trace("sink ended with error, calling abort with error",e),this.abort(e),e}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){null==this.timeline.closeRead&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",null!=e&&null==this.endErr&&(this.endErr=e),this.onCloseRead?.(),null!=this.timeline.closeWrite?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),"aborted"!==this.status&&"reset"!==this.status&&(this.status="closed"),null!=this.onEnd&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){null==this.timeline.closeWrite&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",null!=e&&null==this.endErr&&(this.endErr=e),this.onCloseWrite?.(),null!=this.timeline.closeRead?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),"aborted"!==this.status&&"reset"!==this.status&&(this.status="closed"),null!=this.onEnd&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(e){"open"===this.status&&(this.log.trace("closing gracefully"),this.status="closing",await (0,u3.W)(Promise.all([this.closeWrite(e),this.closeRead(e),this.closed.promise]),e?.signal),this.status="closed",this.log.trace("closed gracefully"))}async closeRead(e={}){if("closing"===this.readStatus||"closed"===this.readStatus)return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);let t=this.readStatus;this.readStatus="closing","reset"!==this.status&&"aborted"!==this.status&&null==this.timeline.closeRead&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),"ready"===t&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(e={}){"closing"!==this.writeStatus&&"closed"!==this.writeStatus&&(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),"ready"===this.writeStatus&&(this.log.trace("sink was never sunk, sink an empty array"),await (0,u3.W)(this.sink([]),e.signal)),"writing"===this.writeStatus&&(null!=this.sendingData&&await (0,u3.W)(this.sendingData.promise,e.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await (0,u3.W)(this.sinkEnd.promise,e.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){if("closed"===this.status||"aborted"===this.status||"reset"===this.status)return;this.log("abort with error",e),this.log("try to send reset to remote");let t=this.sendReset();CR(t)&&t.catch(e=>{this.log.error("error sending reset message",e)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),this.onAbort?.(e)}reset(){if("closed"===this.status||"aborted"===this.status||"reset"===this.status)return;let e=new uB("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(e),this.onReset?.()}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){"writing"===this.writeStatus&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){"closing"!==this.readStatus&&"closed"!==this.readStatus&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){if("closing"===this.readStatus||"closed"===this.readStatus)return void this.log("received remote close write but local source is already closed");this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if("closing"===this.writeStatus||"closed"===this.writeStatus)return void this.log("received remote close read but local sink is already closed");this.log.trace("remote close read"),this._closeSink()}destroy(){if("closed"===this.status||"aborted"===this.status||"reset"===this.status)return void this.log("received destroy but we are already closed");this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}!function(e){e[e.Init=0]="Init",e[e.SYNSent=1]="SYNSent",e[e.SYNReceived=2]="SYNReceived",e[e.Established=3]="Established",e[e.Finished=4]="Finished"}(em||(em={}));class CN extends CO{name;state;config;_id;sendWindowCapacity;sendWindowCapacityUpdate;recvWindow;recvWindowCapacity;epochStart;getRTT;sendFrame;constructor(e){super({...e,onEnd:t=>{this.state=em.Finished,e.onEnd?.(t)}}),this.config=e.config,this._id=parseInt(e.id,10),this.name=e.name,this.state=e.state,this.sendWindowCapacity=Cb,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=e.getRTT,this.sendFrame=e.sendFrame,this.source=h3(this.source,()=>{this.sendWindowUpdate()})}async sendNewStream(){}async sendData(e,t={}){for(e=e.sublist();0!==e.byteLength;){if(0===this.sendWindowCapacity&&(this.log?.trace("wait for send window capacity, status %s",this.status),await this.waitForSendWindowCapacity(t),"closed"===this.status||"aborted"===this.status||"reset"===this.status))return void this.log?.trace("%s while waiting for send window capacity",this.status);let r=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-CA,e.length),n=this.getSendFlags();this.sendFrame({type:ef.Data,flag:n,streamID:this._id,length:r},e.sublist(0,r)),this.sendWindowCapacity-=r,e.consume(r)}}async sendReset(){this.sendFrame({type:ef.WindowUpdate,flag:ep.RST,streamID:this._id,length:0})}async sendCloseWrite(){let e=this.getSendFlags()|ep.FIN;this.sendFrame({type:ef.WindowUpdate,flag:e,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(e={}){let t,r;if(this.sendWindowCapacity>0)return;let n=()=>{"open"===this.status||"closing"===this.status?r(new uk("Stream aborted")):t()};e.signal?.addEventListener("abort",n);try{await new Promise((e,n)=>{this.sendWindowCapacityUpdate=()=>{e()},r=n,t=e})}finally{e.signal?.removeEventListener("abort",n)}}handleWindowUpdate(e){this.log?.trace("stream received window update id=%s",this._id),this.processFlags(e.flag);let t=this.sendWindowCapacity;this.sendWindowCapacity+=e.length,0===t&&e.length>0&&this.sendWindowCapacityUpdate?.()}async handleData(e,t){if(this.log?.trace("stream received data id=%s",this._id),this.processFlags(e.flag),this.recvWindowCapacity<e.length)throw new Cm("Receive window exceeded");let r=await t();this.recvWindowCapacity-=e.length,this.sourcePush(r)}processFlags(e){(e&ep.ACK)===ep.ACK&&this.state===em.SYNSent&&(this.state=em.Established),(e&ep.FIN)===ep.FIN&&this.remoteCloseWrite(),(e&ep.RST)===ep.RST&&this.reset()}getSendFlags(){switch(this.state){case em.Init:return this.state=em.SYNSent,ep.SYN;case em.SYNReceived:return this.state=em.Established,ep.ACK;default:return 0}}sendWindowUpdate(){let e=this.getSendFlags(),t=Date.now(),r=this.getRTT();if(0===e&&r>-1&&t-this.epochStart<4*r&&(this.recvWindow=Math.min(2*this.recvWindow,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&0===e)return;let n=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=t,this.sendFrame({type:ef.WindowUpdate,flag:e,streamID:this._id,length:n})}}let CD="/yamux/1.0.0",CB=500;class CM{protocol=CD;_components;_init;constructor(e,t={}){this._components=e,this._init=t}[Symbol.toStringTag]="@chainsafe/libp2p-yamux";[En]=["@libp2p/stream-multiplexing"];createStreamMuxer(e){return new CL(this._components,{...this._init,...e})}}class CL{protocol=CD;source;sink;config;log;logger;closeController;nextStreamID;_streams;nextPingID;activePing;rtt;client;localGoAway;remoteGoAway;numInboundStreams;numOutboundStreams;onIncomingStream;onStreamEnd;constructor(e,t){this.client="outbound"===t.direction,this.config={...Cw,...t},this.logger=e.logger,this.log=this.logger.forComponent("libp2p:yamux"),Cv(this.config),this.closeController=new AbortController,this.closeController.signal,this.onIncomingStream=t.onIncomingStream,this.onStreamEnd=t.onStreamEnd,this._streams=new Map,this.source=(0,li.Ny)({onEnd:()=>{this.log?.trace("muxer source ended"),this._streams.forEach(e=>{e.destroy()})}}),this.sink=async e=>{let t,r,n=()=>{let t=Cl(e);if(null!=t.return){let e=t.return();CF(e)&&e.catch(e=>{this.log?.("could not cause sink source to return",e)})}};try{let r=new Ck(e);try{for await(let e of(this.closeController.signal.addEventListener("abort",n),r.emitFrames()))await this.handleFrame(e.header,e.readData)}finally{this.closeController.signal.removeEventListener("abort",n)}t=eg.NormalTermination}catch(e){Cy.has(e.name)?(this.log?.error("protocol error in sink",e),t=eg.ProtocolError):(this.log?.error("internal error in sink",e),t=eg.InternalError),r=e}this.log?.trace("muxer sink ended"),null!=r?this.abort(r,t):await this.close({reason:t})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,this.log?.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch(e=>this.log?.error("keepalive error: %s",e)),this.ping().catch(e=>this.log?.error("ping error: %s",e))}get streams(){return Array.from(this._streams.values())}newStream(e){if(void 0!==this.remoteGoAway)throw new uD("Muxer closed remotely");if(void 0!==this.localGoAway)throw new uD("Muxer closed locally");let t=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new uZ("max outbound streams exceeded");this.log?.trace("new outgoing stream id=%s",t);let r=this._newStream(t,e,em.Init,"outbound");return this._streams.set(t,r),this.numOutboundStreams++,r.sendWindowUpdate(),r}async ping(){if(void 0!==this.remoteGoAway)throw new uD("Muxer closed remotely");if(void 0!==this.localGoAway)throw new uD("Muxer closed locally");if(void 0===this.activePing){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise((t,r)=>{let n=()=>{r(new uD("Muxer closed locally"))};this.closeController.signal.addEventListener("abort",n,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",n),t()}}),resolve:e};let t=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}let r=Date.now();this.rtt=r-t}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(e={}){if(this.closeController.signal.aborted)return;let t=e?.reason??eg.NormalTermination;if(this.log?.trace("muxer close reason=%s",t),null==e.signal){let t=AbortSignal.timeout(CB);e={...e,signal:t}}try{await Promise.all([...this._streams.values()].map(async t=>t.close(e))),this.sendGoAway(t),this._closeMuxer()}catch(e){this.abort(e)}}abort(e,t){if(!this.closeController.signal.aborted){for(let r of(t=t??eg.InternalError,this.log?.error("muxer abort reason=%s error=%s",t,e),this._streams.values()))r.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,r,n){if(null!=this._streams.get(e))throw new uC("Stream already exists with that id");let i=new CN({id:e.toString(),name:t,state:r,direction:n,sendFrame:this.sendFrame.bind(this),onEnd:()=>{this.closeStream(e),this.onStreamEnd?.(i)},log:this.logger.forComponent(`libp2p:yamux:${n}:${e}`),config:this.config,getRTT:this.getRTT.bind(this)});return i}closeStream(e){this.client===(e%2==0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}async keepAliveLoop(){let e=new Promise((e,t)=>{this.closeController.signal.addEventListener("abort",t,{once:!0})});for(this.log?.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let t;try{await Promise.race([e,new Promise(e=>{t=setTimeout(e,this.config.keepAliveInterval)})]),this.ping().catch(e=>this.log?.error("ping error: %s",e))}catch(e){clearInterval(t);return}}}async handleFrame(e,t){let{streamID:r,type:n,length:i}=e;if(this.log?.trace("received frame %o",e),0===r)switch(n){case ef.Ping:return void this.handlePing(e);case ef.GoAway:return void this.handleGoAway(i);default:throw new Cc("Invalid frame type")}switch(e.type){case ef.Data:case ef.WindowUpdate:return void await this.handleStreamMessage(e,t);default:throw new Cc("Invalid frame type")}}handlePing(e){if(e.flag===ep.SYN)this.log?.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,ep.ACK);else if(e.flag===ep.ACK)this.log?.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length);else throw new Cc("Invalid frame flag")}handlePingResponse(e){if(void 0===this.activePing)throw new Cu("ping not requested");if(this.activePing.id!==e)throw new Ch("ping doesn't match our id");this.activePing.resolve()}handleGoAway(e){for(let t of(this.log?.trace("received GoAway reason=%s",eg[e]??"unknown"),this.remoteGoAway=e,this._streams.values()))t.reset();this._closeMuxer()}async handleStreamMessage(e,t){let{streamID:r,flag:n,type:i}=e;(n&ep.SYN)===ep.SYN&&this.incomingStream(r);let s=this._streams.get(r);if(void 0===s){if(i===ef.Data){if(this.log?.("discarding data for stream id=%s",r),void 0===t)throw Error("unreachable");await t()}else this.log?.trace("frame for missing stream id=%s",r);return}switch(i){case ef.WindowUpdate:return void s.handleWindowUpdate(e);case ef.Data:if(void 0===t)throw Error("unreachable");await s.handleData(e,t);return;default:throw Error("unreachable")}}incomingStream(e){if(this.client!==(e%2==0))throw new uC("Both endpoints are clients");if(this._streams.has(e))return;if(this.log?.trace("new incoming stream id=%s",e),void 0!==this.localGoAway)return void this.sendFrame({type:ef.WindowUpdate,flag:ep.RST,streamID:e,length:0});if(this.numInboundStreams>=this.config.maxInboundStreams){this.log?.("maxIncomingStreams exceeded, forcing stream reset"),this.sendFrame({type:ef.WindowUpdate,flag:ep.RST,streamID:e,length:0});return}let t=this._newStream(e,void 0,em.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,t),this.onIncomingStream?.(t)}sendFrame(e,t){if(this.log?.trace("sending frame %o",e),e.type===ef.Data){if(void 0===t)throw new Cc("Invalid frame");this.source.push(new ro(CI(e),t))}else this.source.push(CI(e))}sendPing(e,t=ep.SYN){t===ep.SYN?this.log?.trace("sending ping request pingId=%s",e):this.log?.trace("sending ping response pingId=%s",e),this.sendFrame({type:ef.Ping,flag:t,streamID:0,length:e})}sendGoAway(e=eg.NormalTermination){this.log?.("sending GoAway reason=%s",eg[e]),this.localGoAway=e,this.sendFrame({type:ef.GoAway,flag:0,streamID:0,length:e})}}function CF(e){return null!=e&&"function"==typeof e.then}function CU(e={}){return t=>new CM(t,e)}async function*Cj(e,t={}){let r=e.getReader();try{for(;;){let e=await r.read();if(e.done)return;yield e.value}}finally{!0!==t.preventCancel&&await r.cancel(),r.releaseLock()}}class C$ extends Error{static name="SignatureVerificationError";constructor(e="Record signature verification failed"){super(e),this.name="SignatureVerificationError"}}class CH extends Error{static name="RecordExpiredError";constructor(e="Record has expired"){super(e),this.name="RecordExpiredError"}}class Cq extends Error{static name="UnsupportedValidityError";constructor(e="The validity type is unsupported"){super(e),this.name="UnsupportedValidityError"}}class Cz extends Error{static name="RecordTooLargeError";constructor(e="The record is too large"){super(e),this.name="RecordTooLargeError"}}class CV extends Error{static name="InvalidValueError";constructor(e="Value must be a valid content path starting with /"){super(e),this.name="InvalidValueError"}}class CK extends Error{static name="InvalidRecordDataError";constructor(e="Invalid record data"){super(e),this.name="InvalidRecordDataError"}}class CG extends Error{static name="InvalidEmbeddedPublicKeyError";constructor(e="Invalid embedded public key"){super(e),this.name="InvalidEmbeddedPublicKeyError"}}!function(e){let t,r,n;!function(e){e.EOL="EOL"}(t=e.ValidityType||(e.ValidityType={})),function(e){e[e.EOL=0]="EOL"}(r||(r={})),function(e){e.codec=()=>nB(r)}(t=e.ValidityType||(e.ValidityType={})),e.codec=()=>(null==n&&(n=nM((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.value&&(r.uint32(10),r.bytes(t.value)),null!=t.signatureV1&&(r.uint32(18),r.bytes(t.signatureV1)),null!=t.validityType&&(r.uint32(24),e.ValidityType.codec().encode(t.validityType,r)),null!=t.validity&&(r.uint32(34),r.bytes(t.validity)),null!=t.sequence&&(r.uint32(40),r.uint64(t.sequence)),null!=t.ttl&&(r.uint32(48),r.uint64(t.ttl)),null!=t.pubKey&&(r.uint32(58),r.bytes(t.pubKey)),null!=t.signatureV2&&(r.uint32(66),r.bytes(t.signatureV2)),null!=t.data&&(r.uint32(74),r.bytes(t.data)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.value=t.bytes();break;case 2:i.signatureV1=t.bytes();break;case 3:i.validityType=e.ValidityType.codec().decode(t);break;case 4:i.validity=t.bytes();break;case 5:i.sequence=t.uint64();break;case 6:i.ttl=t.uint64();break;case 7:i.pubKey=t.bytes();break;case 8:i.signatureV2=t.bytes();break;case 9:i.data=t.bytes();break;default:t.skipType(7&r)}}return i})),n),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(ey||(ey={}));let CW=(0,lC.vF)("ipns:utils"),CQ=(0,nm.s)("/ipns/"),CJ=0,CZ=18;function CY(e){let t;if(null!=e.pubKey)try{t=ya(e.pubKey)}catch(e){throw CW.error(e),e}if(null!=t)return t}function CX(e){return rt([(0,nm.s)("ipns-signature:"),e])}function C0(e){return"signatureV1"in e?ey.encode({value:(0,nm.s)(e.value),signatureV1:e.signatureV1,validityType:e.validityType,validity:(0,nm.s)(e.validity),sequence:e.sequence,ttl:e.ttl,pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data}):ey.encode({pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data})}function C1(e){let t=ey.decode(e);if(null!=t.sequence&&(t.sequence=BigInt(t.sequence)),null!=t.ttl&&(t.ttl=BigInt(t.ttl)),null==t.signatureV2||null==t.data)throw new C$("Missing data or signatureV2");let r=C4(t.data),n=C5(r.Value),i=(0,uh.d)(r.Validity);if(null!=t.value&&null!=t.signatureV1)return C6(t),{value:n,validityType:ey.ValidityType.EOL,validity:i,sequence:r.Sequence,ttl:r.TTL,pubKey:t.pubKey,signatureV1:t.signatureV1,signatureV2:t.signatureV2,data:t.data};if(null!=t.signatureV2)return{value:n,validityType:ey.ValidityType.EOL,validity:i,sequence:r.Sequence,ttl:r.TTL,pubKey:t.pubKey,signatureV2:t.signatureV2,data:t.data};throw Error("invalid record: does not include signatureV1 or signatureV2")}function C2(e){return rt([CQ,e.bytes])}function C3(e){let t=aG.decode(e.slice(CQ.length));if(!C7(t,CJ)&&!C7(t,CZ))throw new u$("Multihash in IPNS key was not identity or sha2-256");return t}function C4(e){let t=ac(e);if(0===t.ValidityType)t.ValidityType=ey.ValidityType.EOL;else throw new Cq("The validity type is unsupported");return Number.isInteger(t.Sequence)&&(t.Sequence=BigInt(t.Sequence)),Number.isInteger(t.TTL)&&(t.TTL=BigInt(t.TTL)),t}function C5(e){let t=(0,uh.d)(e).trim();if(t.startsWith("/"))return t;try{return`/ipfs/${rc.TO.decode(e).toV1().toString()}`}catch{}try{return`/ipfs/${rc.TO.parse(t).toV1().toString()}`}catch{}throw new CV("Value must be a valid content path starting with /")}function C6(e){if(null==e.data)throw new CK("Record data is missing");let t=C4(e.data);if(!rr(t.Value,e.value??new Uint8Array(0)))throw new C$('Field "value" did not match between protobuf and CBOR');if(!rr(t.Validity,e.validity??new Uint8Array(0)))throw new C$('Field "validity" did not match between protobuf and CBOR');if(t.ValidityType!==e.validityType)throw new C$('Field "validityType" did not match between protobuf and CBOR');if(t.Sequence!==e.sequence)throw new C$('Field "sequence" did not match between protobuf and CBOR');if(t.TTL!==e.ttl)throw new C$('Field "ttl" did not match between protobuf and CBOR')}function C8(e){return"function"==typeof e?.toCID}function C7(e,t){return e.code===t}var C9=r(77338);let Te=(0,lC.vF)("ipns:validator"),Tt=10240,Tr=async(e,t)=>{let r,n=C1(t);try{let t=CX(n.data);r=await e.verify(t,n.signatureV2)}catch(e){r=!1}if(!r)throw Te.error("record signature verification failed"),new C$("Record signature verification failed");if(n.validityType===ey.ValidityType.EOL){if(C9.fromString(n.validity).toDate().getTime()<Date.now())throw Te.error("record has expired"),new CH("record has expired")}else if(null!=n.validityType)throw Te.error("the validity type is unsupported"),new Cq("The validity type is unsupported");Te("ipns record for %s is valid",n.value)};async function Tn(e,t){let r;if(t.byteLength>Tt)throw new Cz("The record is too large");let n=C3(e);C7(n,0)&&(r=yc(n));let i=CY(C1(t))??r;if(null==i)throw new CG("Could not extract public key from IPNS record or routing key");if(!rr(C2(i.toMultihash()),e))throw new CG("Embedded public key did not match routing key");await Tr(i,t)}class Ti extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MESSAGE_LENGTH"}async function*Ts(e,t={}){let r=/\r?\n/,n=new TextDecoder("utf8"),i="";for await(let s of e){if("string"==typeof s&&(s=new TextEncoder().encode(s)),rs(s)&&(s=s.subarray()),(i+=n.decode(s,{stream:!0})).length>(t?.maxMessageLength??i.length))throw new Ti("Incoming message too long");let e=i.split(r);i=e.pop()??"";for(let t=0;t<e.length;t++)yield JSON.parse(e[t])}""!==(i+=n.decode())&&(yield JSON.parse(i))}class To extends Error{static name="InvalidRequestError";constructor(e="Invalid request"){super(e),this.name="InvalidRequestError"}}class Ta extends Error{static name="BadResponseError";constructor(e="Bad response"){super(e),this.name="BadResponseError"}}let Tl=(0,nm.s)("/ipns/");function Tc(e){return rr(e.subarray(0,Tl.byteLength),Tl)}class Tu{client;constructor(e){this.client=e}async *findProviders(e,t={}){yield*(0,a7.A)(this.client.getProviders(e,t),e=>({id:e.ID,multiaddrs:e.Addrs??[]}))}async provide(){}async cancelReprovide(){}async put(e,t,r){if(!Tc(e))return;let n=C3(e),i=rc.TO.createV1(114,n),s=C1(t);await this.client.putIPNS(i,s,r)}async get(e,t){if(!Tc(e))throw new uL("Not found");let r=C3(e),n=rc.TO.createV1(114,r);try{let e=await this.client.getIPNS(n,t);return C0(e)}catch(e){if("BadResponseError"===e.name)throw new uL("Not found");throw e}}}class Th{client;constructor(e){this.client=e}async findPeer(e,t={}){let r=await t5(this.client.getPeers(e,t));if(null!=r)return{id:r.ID,multiaddrs:r.Addrs??[]};throw new uL("Not found")}async *getClosestPeers(e,t={}){}}let Td=(0,lC.vF)("delegated-routing-v1-http-api-client"),Tf={concurrentRequests:4,timeout:3e4,cacheTTL:3e5,cacheName:"delegated-routing-v1-cache"};class Tp{started;httpQueue;shutDownController;clientUrl;timeout;contentRouting;peerRouting;filterAddrs;filterProtocols;inFlightRequests;cacheName;cache;cacheTTL;constructor(e,t={}){this.started=!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.httpQueue=new lf({concurrency:t.concurrentRequests??Tf.concurrentRequests}),this.inFlightRequests=new Map,this.clientUrl=e instanceof URL?e:new URL(e),this.timeout=t.timeout??Tf.timeout,this.filterAddrs=t.filterAddrs,this.filterProtocols=t.filterProtocols,this.contentRouting=new Tu(this),this.peerRouting=new Th(this),this.cacheName=t.cacheName??Tf.cacheName,this.cacheTTL=t.cacheTTL??Tf.cacheTTL}get[us](){return this.contentRouting}get[uo](){return this.peerRouting}isStarted(){return this.started}async start(){!this.started&&(this.started=!0,this.cacheTTL>0&&(this.cache=await globalThis.caches?.open(this.cacheName),null!=this.cache&&Td("cache enabled with ttl %d",this.cacheTTL)))}async stop(){this.httpQueue.clear(),this.shutDownController.abort(),await globalThis.caches?.delete(this.cacheName),this.started=!1}async *getProviders(e,t={}){Td("getProviders starts: %c",e);let r=AbortSignal.timeout(this.timeout),n=hQ([this.shutDownController.signal,r,t.signal]),i=(0,a9.A)(),s=(0,a9.A)();this.httpQueue.add(async()=>(i.resolve(),s.promise));try{await i.promise;let r=new URL(`${this.clientUrl}routing/v1/providers/${e.toString()}`);this.#z(r,t.filterAddrs,t.filterProtocols);let s={headers:{Accept:"application/x-ndjson"},signal:n},o=await this.#V(r.toString(),s);if(null==o)throw new Ta("No response received");if(!o.ok){if(404===o.status)throw new uL("No matching records found");if(422===o.status)throw new To("Request does not conform to schema or semantic constraints");throw new Ta(`Unexpected status code: ${o.status}`)}if(null==o.body)throw new Ta("Routing response had no body");let a=o.headers.get("Content-Type");if(null==a)throw new Ta("No Content-Type header received");if(a?.startsWith("application/json"))for(let e of(await o.json()).Providers){let t=this.#K(e);null!=t&&(yield t)}else if(a.includes("application/x-ndjson"))for await(let e of Ts(Cj(o.body))){let t=this.#K(e);null!=t&&(yield t)}else throw new Ta(`Unsupported Content-Type: ${a}`)}finally{n.clear(),s.resolve(),Td("getProviders finished: %c",e)}}async *getPeers(e,t={}){Td("getPeers starts: %c",e);let r=AbortSignal.timeout(this.timeout),n=hQ([this.shutDownController.signal,r,t.signal]),i=(0,a9.A)(),s=(0,a9.A)();this.httpQueue.add(async()=>(i.resolve(),s.promise));try{await i.promise;let r=new URL(`${this.clientUrl}routing/v1/peers/${e.toCID().toString()}`);this.#z(r,t.filterAddrs,t.filterProtocols);let s={headers:{Accept:"application/x-ndjson"},signal:n},o=await this.#V(r.toString(),s);if(404===o.status)throw new uL("No matching records found");if(422===o.status)throw new To("Request does not conform to schema or semantic constraints");if(null==o.body)throw new Ta("Routing response had no body");let a=o.headers.get("Content-Type");if("application/json"===a)for(let e of(await o.json()).Peers){let t=this.#K(e);null!=t&&(yield t)}else for await(let e of Ts(Cj(o.body))){let t=this.#K(e);null!=t&&(yield t)}}catch(e){Td.error("getPeers errored:",e)}finally{n.clear(),s.resolve(),Td("getPeers finished: %c",e)}}async getIPNS(e,t={}){Td("getIPNS starts: %s",e);let r=AbortSignal.timeout(this.timeout),n=hQ([this.shutDownController.signal,r,t.signal]),i=(0,a9.A)(),s=(0,a9.A)();this.httpQueue.add(async()=>(i.resolve(),s.promise));let o=`${this.clientUrl}routing/v1/ipns/${e}`;try{await i.promise;let r={headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:n},s=await this.#V(o,r);if(Td("getIPNS GET %s %d",o,s.status),404===s.status)throw new uL("No matching records found");if(422===s.status)throw new To("Request does not conform to schema or semantic constraints");if(null==s.body)throw new Ta("GET ipns response had no body");let a=await s.arrayBuffer(),l=new Uint8Array(a,0,a.byteLength);return!1!==t.validate&&await Tn(C2(e.multihash),l),C1(l)}catch(e){throw Td.error("getIPNS GET %s error:",o,e),e}finally{n.clear(),s.resolve(),Td("getIPNS finished: %s",e)}}async putIPNS(e,t,r={}){Td("putIPNS starts: %c",e);let n=AbortSignal.timeout(this.timeout),i=hQ([this.shutDownController.signal,n,r.signal]),s=(0,a9.A)(),o=(0,a9.A)();this.httpQueue.add(async()=>(s.resolve(),o.promise));let a=`${this.clientUrl}routing/v1/ipns/${e}`;try{await s.promise;let e=C0(t),r={method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:e,signal:i},n=await this.#V(a,r);if(Td("putIPNS PUT %s %d",a,n.status),200!==n.status)throw new Ta("PUT ipns response had status other than 200")}catch(e){throw Td.error("putIPNS PUT %s error:",a,e.stack),e}finally{i.clear(),o.resolve(),Td("putIPNS finished: %c",e)}}#K(e){try{let t=[],r=e.Addrs?.map(wt)??[];return null!=e.Protocols&&t.push(...e.Protocols),null!=e.Protocol&&(t.push(e.Protocol),delete e.Protocol),{...e,Schema:"peer",ID:yT(e.ID),Addrs:r,Protocols:t}}catch(e){Td.error("could not conform record to peer schema",e)}}#z(e,t,r){if(null!=t||null!=this.filterAddrs){let r=t?.join(",")??this.filterAddrs?.join(",")??"";""!==r&&e.searchParams.set("filter-addrs",r)}if(null!=r||null!=this.filterProtocols){let t=r?.join(",")??this.filterProtocols?.join(",")??"";""!==t&&e.searchParams.set("filter-protocols",t)}}async #V(e,t){let r=t.method??"GET",n=`${r}-${e}`;if("GET"===r){let t=await this.cache?.match(e);if(null!=t){if(parseInt(t.headers.get("x-cache-expires")??"0",10)>Date.now())return Td("returning cached response for %s",n),t;await this.cache?.delete(e)}}let i=this.inFlightRequests.get(n);if(null!=i){let e=await i;return Td("deduplicating outgoing request for %s",n),e.clone()}let s=fetch(e,t).then(async t=>{if(null!=this.cache&&t.ok&&"GET"===r){let r=Date.now()+this.cacheTTL,n=new Headers(t.headers);n.set("x-cache-expires",r.toString());let i=new Response(t.clone().body,{status:t.status,statusText:t.statusText,headers:n});await this.cache.put(e,i)}return t}).finally(()=>{this.inFlightRequests.delete(n)});return this.inFlightRequests.set(n,s),await s}}function Tg(e,t={}){return new Tp(new URL(e),t)}function Tm(){return{filterProtocols:["unknown","transport-bitswap","transport-ipfs-gateway-http"],filterAddrs:["https","webtransport","webrtc","webrtc-direct","wss","tls"]}}let Ty=41;function Tb(e){try{let[[t,r]]=e.stringTuples();if(null==r)return!1;if(t===Ty)return bm("2000::/3",r)}catch{}return!1}function Tw(e,t,r){let n,i;function s(){let o={signal:i.signal};r?.timeout!=null&&(o.signal=hQ([i.signal,AbortSignal.timeout(r.timeout)])),Promise.resolve().then(async()=>{await e(o)}).catch(()=>{}).finally(()=>{i.signal.aborted||(n=setTimeout(s,t))})}let o=!1;return{setInterval:e=>{t=e,null!=n&&(clearTimeout(n),n=setTimeout(s,t))},setTimeout:e=>{null==r&&(r={}),r.timeout=e},start:()=>{o||(o=!0,(i=new AbortController).signal,r?.runImmediately===!0?queueMicrotask(()=>{s()}):n=setTimeout(s,t))},stop:()=>{clearTimeout(n),i?.abort(),o=!1}}}function Tv(e,t){let r=_h(e,t),n={read:async(e,t)=>{let n=await r.read(t);return e.decode(n)},write:async(e,t,n)=>{await r.write(t.encode(e),n)},writeV:async(e,t,n)=>{await r.writeV(e.map(e=>t.encode(e)),n)},pb:e=>({read:async t=>n.read(e,t),write:async(t,r)=>n.write(t,e,r),writeV:async(t,r)=>n.writeV(t,e,r),unwrap:()=>n}),unwrap:()=>r.unwrap()};return n}let TE="libp2p",TA="autonat",Tx="1.0.0",TS=3e4,Tk=2,T_=20,TI=80,TC=8192;!function(e){let t,r,n,i,s,o,a,l;!function(e){e.DIAL="DIAL",e.DIAL_RESPONSE="DIAL_RESPONSE"}(t=e.MessageType||(e.MessageType={})),function(e){e[e.DIAL=0]="DIAL",e[e.DIAL_RESPONSE=1]="DIAL_RESPONSE"}(r||(r={})),function(e){e.codec=()=>nB(r)}(t=e.MessageType||(e.MessageType={})),function(e){e.OK="OK",e.E_DIAL_ERROR="E_DIAL_ERROR",e.E_DIAL_REFUSED="E_DIAL_REFUSED",e.E_BAD_REQUEST="E_BAD_REQUEST",e.E_INTERNAL_ERROR="E_INTERNAL_ERROR"}(n=e.ResponseStatus||(e.ResponseStatus={})),function(e){e[e.OK=0]="OK",e[e.E_DIAL_ERROR=100]="E_DIAL_ERROR",e[e.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",e[e.E_BAD_REQUEST=200]="E_BAD_REQUEST",e[e.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"}(i||(i={})),function(e){e.codec=()=>nB(i)}(n=e.ResponseStatus||(e.ResponseStatus={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.id&&(t.uint32(10),t.bytes(e.id)),null!=e.addrs)for(let r of e.addrs)t.uint32(18),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={addrs:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.id=e.bytes();break;case 2:if(r.limits?.addrs!=null&&n.addrs.length===r.limits.addrs)throw new nL('Decode error - map field "addrs" had too many elements');n.addrs.push(e.bytes());break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(s=e.PeerInfo||(e.PeerInfo={})),function(t){let r;t.codec=()=>(null==r&&(r=nM((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.peer&&(r.uint32(10),e.PeerInfo.codec().encode(t.peer,r)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();r>>>3==1?i.peer=e.PeerInfo.codec().decode(t,t.uint32(),{limits:n.limits?.peer}):t.skipType(7&r)}return i})),r),t.encode=e=>nN(e,t.codec()),t.decode=(e,r)=>ng(e,t.codec(),r)}(o=e.Dial||(e.Dial={})),function(t){let r;t.codec=()=>(null==r&&(r=nM((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.status&&(r.uint32(8),e.ResponseStatus.codec().encode(t.status,r)),null!=t.statusText&&(r.uint32(18),r.string(t.statusText)),null!=t.addr&&(r.uint32(26),r.bytes(t.addr)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.status=e.ResponseStatus.codec().decode(t);break;case 2:i.statusText=t.string();break;case 3:i.addr=t.bytes();break;default:t.skipType(7&r)}}return i})),r),t.encode=e=>nN(e,t.codec()),t.decode=(e,r)=>ng(e,t.codec(),r)}(a=e.DialResponse||(e.DialResponse={})),e.codec=()=>(null==l&&(l=nM((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.MessageType.codec().encode(t.type,r)),null!=t.dial&&(r.uint32(18),e.Dial.codec().encode(t.dial,r)),null!=t.dialResponse&&(r.uint32(26),e.DialResponse.codec().encode(t.dialResponse,r)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.type=e.MessageType.codec().decode(t);break;case 2:i.dial=e.Dial.codec().decode(t,t.uint32(),{limits:n.limits?.dial});break;case 3:i.dialResponse=e.DialResponse.codec().decode(t,t.uint32(),{limits:n.limits?.dialResponse});break;default:t.skipType(7&r)}}return i})),l),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(eb||(eb={}));let TT=4,TP=8;class TR{components;protocol;timeout;maxInboundStreams;maxOutboundStreams;maxMessageSize;started;log;topologyId;dialResults;findPeers;addressFilter;connectionThreshold;constructor(e,t){this.components=e,this.log=e.logger.forComponent("libp2p:auto-nat"),this.started=!1,this.protocol=`/${t.protocolPrefix??TE}/${TA}/${Tx}`,this.timeout=t.timeout??TS,this.maxInboundStreams=t.maxInboundStreams??Tk,this.maxOutboundStreams=t.maxOutboundStreams??T_,this.connectionThreshold=t.connectionThreshold??TI,this.maxMessageSize=t.maxMessageSize??TC,this.dialResults=new Map,this.findPeers=Tw(this.findRandomPeers.bind(this),6e4),this.addressFilter=cQ(1024)}[Symbol.toStringTag]="@libp2p/autonat";[En]=["@libp2p/autonat"];get[Ei](){return["@libp2p/identify"]}isStarted(){return this.started}async start(){this.started||(await this.components.registrar.handle(this.protocol,e=>{this.handleIncomingAutonatStream(e).catch(e=>{this.log.error("error handling incoming autonat stream - %e",e)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.topologyId=await this.components.registrar.register(this.protocol,{onConnect:(e,t)=>{this.verifyExternalAddresses(t).catch(e=>{this.log.error("could not verify addresses - %e",e)})}}),this.findPeers.start(),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),null!=this.topologyId&&await this.components.registrar.unhandle(this.topologyId),this.dialResults.clear(),this.findPeers.stop(),this.started=!1}allAddressesAreVerified(){return this.components.addressManager.getAddressesWithMetadata().every(e=>e.expires>Date.now()||e.verified)}async findRandomPeers(e){if(this.allAddressesAreVerified())return;let t=hQ([AbortSignal.timeout(1e4),e?.signal]);try{for await(let e of(this.log("starting random walk to find peers to run AutoNAT"),this.components.randomWalk.walk({signal:t}))){if(!await this.components.connectionManager.isDialable(e.multiaddrs)){this.log.trace("random peer %p was not dialable %s",e.id,e.multiaddrs.map(e=>e.toString()).join(", "));continue}try{this.log.trace("dial random peer %p",e.id),await this.components.connectionManager.openConnection(e.multiaddrs,{signal:t})}catch{}if(this.allAddressesAreVerified())return void this.log("stopping random walk, all addresses are verified");if(!this.hasConnectionCapacity())return void this.log("stopping random walk, too close to max connections")}}catch{}}async handleIncomingAutonatStream(e){let t=AbortSignal.timeout(this.timeout),r=Tv(e.stream,{maxDataLength:this.maxMessageSize}).pb(eb);try{let n=await r.read({signal:t}),i=await this.handleAutonatMessage(n,e.connection,{signal:t});await r.write(i,{signal:t}),await r.unwrap().unwrap().close({signal:t})}catch(t){this.log.error("error handling incoming autonat stream - %e",t),e.stream.abort(t)}}async handleAutonatMessage(e,t,r){let n,i=this.components.addressManager.getAddresses().map(e=>e.toOptions().host),s=e.dial;if(null==s)return this.log.error("dial was missing from message"),{type:eb.MessageType.DIAL_RESPONSE,dialResponse:{status:eb.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}};let o=s.peer;if(o?.id==null)return this.log.error("PeerId missing from message"),{type:eb.MessageType.DIAL_RESPONSE,dialResponse:{status:eb.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}};try{let e=aG.decode(o.id);n=yO(e)}catch(e){return this.log.error("invalid PeerId - %e",e),{type:eb.MessageType.DIAL_RESPONSE,dialResponse:{status:eb.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}}}if(this.log("incoming request from %p",n),!t.remotePeer.equals(n))return this.log("target peer %p did not equal sending peer %p",n,t.remotePeer),{type:eb.MessageType.DIAL_RESPONSE,dialResponse:{status:eb.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}};let a=o.addrs.map(e=>wt(e)).filter(e=>{let r=e.toOptions();return!Sp(e)&&(r.host!==t.remoteAddr.toOptions().host?(this.log.trace("not dialing %a - target host did not match remote host %a",e,t.remoteAddr),!1):!i.includes(r.host)&&(null!=this.components.transportManager.dialTransportForMultiaddr(e)||(this.log.trace("not dialing %a - transport unsupported",e),!1)))}).map(e=>(null==e.getPeerId()&&(e=e.encapsulate(`/p2p/${n.toString()}`)),e));if(0===a.length)return this.log("refused to dial all multiaddrs for %p from message",n),{type:eb.MessageType.DIAL_RESPONSE,dialResponse:{status:eb.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}};this.log("dial multiaddrs %s for peer %p",a.map(e=>e.toString()).join(", "),n);let l="",c=a[0];for await(let e of a){let t;c=e;try{if(!(t=await this.components.connectionManager.openConnection(e,r)).remoteAddr.equals(e))throw this.log.error("tried to dial %a but dialed %a",e,t.remoteAddr),Error("Unexpected remote address");return this.log("successfully dialed %p via %a",n,e),{type:eb.MessageType.DIAL_RESPONSE,dialResponse:{status:eb.ResponseStatus.OK,addr:t.remoteAddr.decapsulateCode(bT("p2p").code).bytes}}}catch(e){this.log.error("could not dial %p - %e",n,e),l=e.message}finally{null!=t&&await t.close()}}return{type:eb.MessageType.DIAL_RESPONSE,dialResponse:{status:eb.ResponseStatus.E_DIAL_ERROR,statusText:l,addr:c.bytes}}}getFirstUnverifiedMultiaddr(e,t){for(let r of this.components.addressManager.getAddressesWithMetadata().sort((e,t)=>"observed"===e.type&&"observed"!==t.type?1:"observed"===t.type&&"observed"!==e.type?-1:0).filter(e=>!!(e.expires<Date.now())&&(6!==e.multiaddr.toOptions().family||!!t&&!!Tb(e.multiaddr))&&!Sp(e.multiaddr))){let t=r.multiaddr.toString(),n=this.dialResults.get(t);if(null!=n){if(n.networkSegments.includes(e)){this.log.trace("%a already has a network segment result from %s",n.multiaddr,e);continue}if(n.queue.size>10){this.log.trace("%a already has enough peers queued",n.multiaddr);continue}}if(null==n){let e=r.expires<Date.now();if(e&&this.addressFilter.remove?.(t),this.addressFilter.has(t))continue;this.addressFilter.add(t),this.log.trace("creating dial result %s %s",e?"to revalidate":"for",t),n={multiaddr:r.multiaddr,success:0,failure:0,networkSegments:[],verifyingPeers:xv(),queue:new hb({concurrency:3,maxSize:50}),type:r.type,lastVerified:r.lastVerified},this.dialResults.set(t,n)}return n}}removeOutdatedMultiaddrResults(){let e=new Set(this.components.addressManager.getAddressesWithMetadata().filter(({expires:e})=>e<Date.now()).map(({multiaddr:e})=>e.toString()));for(let t of this.dialResults.keys())e.has(t)||(this.log.trace("remove results for %a",t),this.dialResults.delete(t))}async verifyExternalAddresses(e){if(!this.isStarted())return;this.removeOutdatedMultiaddrResults();let t=(await this.components.peerStore.get(e.remotePeer)).addresses.some(({multiaddr:e})=>6===e.toOptions().family),r=this.getNetworkSegment(e.remoteAddr),n=this.getFirstUnverifiedMultiaddr(r,t);return null==n?void this.log.trace("no unverified public addresses found for peer %p to verify, not requesting verification",e.remotePeer):this.hasConnectionCapacity()?void n.queue.add(async t=>{await this.askPeerToVerify(e,r,t)},{peerId:e.remotePeer,multiaddr:n.multiaddr}).catch(t=>{n?.result==null&&this.log.error("error from %p verifying address %a - %e",e.remotePeer,n?.multiaddr,t)}):void(null!=n.lastVerified?(this.log("automatically re-verifying %a because we are too close to the connection limit",n.multiaddr),this.confirmAddress(n)):this.log("skipping verifying %a because we are too close to the connection limit",n.multiaddr))}async askPeerToVerify(e,t,r){let n=this.dialResults.get(r.multiaddr.toString());if(null==n)return void this.log("%a was verified while %p was queued",r.multiaddr,e.remotePeer);let i=AbortSignal.timeout(this.timeout);this.log.trace("asking %p to verify multiaddr %s",e.remotePeer,r.multiaddr);let s=await e.newStream(this.protocol,{signal:i});try{let o=Tv(s).pb(eb),[,a]=await Promise.all([o.write({type:eb.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toMultihash().bytes,addrs:[r.multiaddr.bytes]}}},{signal:i}),o.read({signal:i})]);if(a.type!==eb.MessageType.DIAL_RESPONSE||null==a.dialResponse)return void this.log("invalid autonat response from %p - %j",e.remotePeer,a);let l=a.dialResponse.status;if(this.log.trace("autonat response from %p for %a is %s",e.remotePeer,r.multiaddr,l),l!==eb.ResponseStatus.OK&&l!==eb.ResponseStatus.E_DIAL_ERROR)return;if(n=this.dialResults.get(r.multiaddr.toString()),null==n)return void this.log.trace("peer reported %a as %s but there is no result object",r.multiaddr,a.dialResponse.status);if(n.networkSegments.includes(t))return void this.log.trace("%a results included network segment %s",r.multiaddr,t);if(null!=n.result)return void this.log.trace("already resolved result for %a, ignoring response from",r.multiaddr,e.remotePeer);if(n.verifyingPeers.has(e.remotePeer))return void this.log.trace("peer %p has already verified %a, ignoring response",e.remotePeer,r.multiaddr);if(n.verifyingPeers.add(e.remotePeer),n.networkSegments.push(t),l===eb.ResponseStatus.OK){if(n.success++,"observed"!==n.type)return void this.confirmAddress(n)}else l===eb.ResponseStatus.E_DIAL_ERROR&&n.failure++;this.log("%a success %d failure %d",n.multiaddr,n.success,n.failure),n.success===TT&&this.confirmAddress(n),n.failure===TP&&this.unconfirmAddress(n)}finally{try{await s.close({signal:i})}catch(e){s.abort(e)}}}hasConnectionCapacity(){return this.components.connectionManager.getConnections().length/this.components.connectionManager.getMaxConnections()*100<this.connectionThreshold}confirmAddress(e){this.log("%s address %a is externally dialable",e.type,e.multiaddr),this.components.addressManager.confirmObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!0,e.queue.abort()}unconfirmAddress(e){this.log("%s address %a is not externally dialable",e.type,e.multiaddr),this.components.addressManager.removeObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!1,e.queue.abort()}getNetworkSegment(e){let t=e.toOptions();return 4===t.family?t.host.split(".")[0].padStart(3,"0"):t.host.split(":")[0].padStart(4,"0")}}function TO(e={}){return t=>new TR(t,e)}let TN=Pe("dns4"),TD=Pe("dns6"),TB=Pe("dnsaddr"),TM=T9(Pe("dns"),TB,TN,TD),TL=T9(Pe("ip4"),Pe("ip6")),TF=T9(T7(TL,Pe("tcp")),T7(TM,Pe("tcp"))),TU=T7(TL,Pe("udp")),Tj=T7(TU,Pe("utp")),T$=T7(TU,Pe("quic")),TH=T7(TU,Pe("quic-v1")),Tq=T9(T7(TF,Pe("ws")),T7(TM,Pe("ws"))),Tz=T9(T7(Tq,Pe("p2p")),Tq),TV=T9(T7(TF,Pe("wss")),T7(TM,Pe("wss")),T7(TF,Pe("tls"),Pe("ws")),T7(TM,Pe("tls"),Pe("ws"))),TK=T9(T7(TV,Pe("p2p")),TV),TG=T9(T7(TF,Pe("http")),T7(TL,Pe("http")),T7(TM,Pe("http"))),TW=T9(T7(TF,Pe("https")),T7(TL,Pe("https")),T7(TM,Pe("https"))),TQ=T7(TU,Pe("webrtc-direct"),Pe("certhash")),TJ=T9(T7(TQ,Pe("p2p")),TQ),TZ=T7(TH,Pe("webtransport"),Pe("certhash"),Pe("certhash")),TY=T9(T7(TZ,Pe("p2p")),TZ),TX=T9(T7(Tz,Pe("p2p-webrtc-star"),Pe("p2p")),T7(TK,Pe("p2p-webrtc-star"),Pe("p2p")),T7(Tz,Pe("p2p-webrtc-star")),T7(TK,Pe("p2p-webrtc-star")));T9(T7(Tz,Pe("p2p-websocket-star"),Pe("p2p")),T7(TK,Pe("p2p-websocket-star"),Pe("p2p")),T7(Tz,Pe("p2p-websocket-star")),T7(TK,Pe("p2p-websocket-star")));let T0=T9(T7(TG,Pe("p2p-webrtc-direct"),Pe("p2p")),T7(TW,Pe("p2p-webrtc-direct"),Pe("p2p")),T7(TG,Pe("p2p-webrtc-direct")),T7(TW,Pe("p2p-webrtc-direct"))),T1=T9(Tq,TV,TG,TW,TX,T0,TF,Tj,T$,TM,TJ,TY);T9(T7(T1,Pe("p2p-stardust"),Pe("p2p")),T7(T1,Pe("p2p-stardust")));let T2=T9(T7(T1,Pe("p2p")),TX,T0,TJ,TY,Pe("p2p")),T3=T9(T7(T2,Pe("p2p-circuit"),T2),T7(T2,Pe("p2p-circuit")),T7(Pe("p2p-circuit"),T2),T7(T1,Pe("p2p-circuit")),T7(Pe("p2p-circuit"),T1),Pe("p2p-circuit")),T4=()=>T9(T7(T3,T4),T3),T5=T4(),T6=T9(T7(T5,T2,T5),T7(T2,T5),T7(T5,T2),T5,T2);function T8(e){return function(t){let r;try{r=wt(t)}catch(e){return!1}let n=e(r.protoNames());return null!==n&&(!0===n||!1===n?n:0===n.length)}}function T7(...e){function t(t){if(t.length<e.length)return null;let r=t;return e.some(e=>(Array.isArray(r="function"==typeof e?e().partialMatch(t):e.partialMatch(t))&&(t=r),null===r)),r}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:T8(t),partialMatch:t}}function T9(...e){function t(t){let r=null;return e.some(e=>{let n="function"==typeof e?e().partialMatch(t):e.partialMatch(t);return null!=n&&(r=n,!0)}),r}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:T8(t),partialMatch:t}}function Pe(e){let t=e;return{toString:function(){return t},matches:function(e){let r;try{r=wt(e)}catch(e){return!1}let n=r.protoNames();return 1===n.length&&n[0]===t},partialMatch:function(e){return 0===e.length?null:e[0]===t?e.slice(1):null}}}T9(T7(T5,Pe("webrtc"),Pe("p2p")),T7(T5,Pe("webrtc")),T7(T1,Pe("webrtc"),Pe("p2p")),T7(T1,Pe("webrtc")),Pe("webrtc"));let Pt="bootstrap",Pr=50,Pn=1e3;class Pi extends uS{static tag="bootstrap";log;timer;list;timeout;components;_init;constructor(e,t={list:[]}){if(null==t.list||0===t.list.length)throw Error("Bootstrap requires a list of peer addresses");for(let r of(super(),this.components=e,this.log=e.logger.forComponent("libp2p:bootstrap"),this.timeout=t.timeout??Pn,this.list=[],t.list)){if(!T6.matches(r)){this.log.error("Invalid multiaddr");continue}let e=wt(r),t=e.getPeerId();if(null==t){this.log.error("Invalid bootstrap multiaddr without peer id");continue}let n={id:yT(t),multiaddrs:[e]};this.list.push(n)}this._init=t}[xb]=this;[Symbol.toStringTag]="@libp2p/bootstrap";[En]=["@libp2p/peer-discovery"];isStarted(){return!!this.timer}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(e=>{this.log.error(e)})},this.timeout))}async _discoverBootstrapPeers(){if(null!=this.timer)for(let e of this.list){if(await this.components.peerStore.merge(e.id,{tags:{[this._init.tagName??Pt]:{value:this._init.tagValue??Pr,ttl:this._init.tagTTL}},multiaddrs:e.multiaddrs}),null==this.timer)return;this.safeDispatchEvent("peer",{detail:e}),this.components.connectionManager.openConnection(e.id).catch(t=>{this.log.error("could not dial bootstrap peer %p",e.id,t)})}}stop(){null!=this.timer&&clearTimeout(this.timer),this.timer=void 0}}function Ps(e){return t=>new Pi(t,e)}class Po{filter;constructor(e,t){this.filter=cQ(e,t)}has(e){return this.filter.has(e.toMultihash().bytes)}add(e){this.filter.add(e.toMultihash().bytes)}remove(e){this.filter.remove?.(e.toMultihash().bytes)}}function Pa(e,t=.001){return new Po(e,t)}function Pl(e){let{stream:t,remoteAddr:r,logger:n,onDataRead:i,onDataWrite:s}=e,o=n.forComponent("libp2p:stream:converter"),a=!1,l=!1,c=t.close.bind(t);t.close=async e=>{await c(e),f(!0)};let u=t.abort.bind(t);t.abort=e=>{u(e),f(!0)};let h=t.sink.bind(t);t.sink=async e=>{try{await h((0,lr.F)(e,e=>h3(e,e=>s?.(e))))}catch(e){"aborted"!==e.type&&o.error("%s error in sink",r,e)}finally{l=!0,f()}};let d={log:o,sink:t.sink,source:async function*(){try{for await(let e of t.source)i?.(e),yield e}finally{a=!0,f()}}(),remoteAddr:r,timeline:{open:Date.now(),close:void 0},close:t.close,abort:t.abort};function f(e){!0===e&&(a=!0,l=!0),a&&l&&null==d.timeline.close&&(d.timeline.close=Date.now())}return d}let Pc=290,Pu=1,Ph=2e3,Pd=100,Pf=`${kx}-circuit-relay`;BigInt(131072);let Pp="/libp2p/circuit/relay/0.2.0/hop",Pg="/libp2p/circuit/relay/0.2.0/stop",Pm=300,Py=4096,Pb=.001;function Pw(e){return Number(e*BigInt(1e3)-BigInt(new Date().getTime()))}!function(e){let t,r,n;!function(e){e.RESERVE="RESERVE",e.CONNECT="CONNECT",e.STATUS="STATUS"}(t=e.Type||(e.Type={})),function(e){e[e.RESERVE=0]="RESERVE",e[e.CONNECT=1]="CONNECT",e[e.STATUS=2]="STATUS"}(r||(r={})),function(e){e.codec=()=>nB(r)}(t=e.Type||(e.Type={})),e.codec=()=>(null==n&&(n=nM((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.Type.codec().encode(t.type,r)),null!=t.peer&&(r.uint32(18),eE.codec().encode(t.peer,r)),null!=t.reservation&&(r.uint32(26),eA.codec().encode(t.reservation,r)),null!=t.limit&&(r.uint32(34),ex.codec().encode(t.limit,r)),null!=t.status&&(r.uint32(40),eS.codec().encode(t.status,r)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.type=e.Type.codec().decode(t);break;case 2:i.peer=eE.codec().decode(t,t.uint32(),{limits:n.limits?.peer});break;case 3:i.reservation=eA.codec().decode(t,t.uint32(),{limits:n.limits?.reservation});break;case 4:i.limit=ex.codec().decode(t,t.uint32(),{limits:n.limits?.limit});break;case 5:i.status=eS.codec().decode(t);break;default:t.skipType(7&r)}}return i})),n),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(ew||(ew={})),function(e){let t,r,n;!function(e){e.CONNECT="CONNECT",e.STATUS="STATUS"}(t=e.Type||(e.Type={})),function(e){e[e.CONNECT=0]="CONNECT",e[e.STATUS=1]="STATUS"}(r||(r={})),function(e){e.codec=()=>nB(r)}(t=e.Type||(e.Type={})),e.codec=()=>(null==n&&(n=nM((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.Type.codec().encode(t.type,r)),null!=t.peer&&(r.uint32(18),eE.codec().encode(t.peer,r)),null!=t.limit&&(r.uint32(26),ex.codec().encode(t.limit,r)),null!=t.status&&(r.uint32(32),eS.codec().encode(t.status,r)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.type=e.Type.codec().decode(t);break;case 2:i.peer=eE.codec().decode(t,t.uint32(),{limits:n.limits?.peer});break;case 3:i.limit=ex.codec().decode(t,t.uint32(),{limits:n.limits?.limit});break;case 4:i.status=eS.codec().decode(t);break;default:t.skipType(7&r)}}return i})),n),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(ev||(ev={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.id&&e.id.byteLength>0&&(t.uint32(10),t.bytes(e.id)),null!=e.addrs)for(let r of e.addrs)t.uint32(18),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={id:(0,t9.c)(0),addrs:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.id=e.bytes();break;case 2:if(r.limits?.addrs!=null&&n.addrs.length===r.limits.addrs)throw new nL('Decode error - map field "addrs" had too many elements');n.addrs.push(e.bytes());break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(eE||(eE={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.expire&&0n!==e.expire&&(t.uint32(8),t.uint64(e.expire)),null!=e.addrs)for(let r of e.addrs)t.uint32(18),t.bytes(r);null!=e.voucher&&(t.uint32(26),eI.codec().encode(e.voucher,t)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={expire:0n,addrs:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.expire=e.uint64();break;case 2:if(r.limits?.addrs!=null&&n.addrs.length===r.limits.addrs)throw new nL('Decode error - map field "addrs" had too many elements');n.addrs.push(e.bytes());break;case 3:n.voucher=eI.codec().decode(e,e.uint32(),{limits:r.limits?.voucher});break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(eA||(eA={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.duration&&(t.uint32(8),t.uint32(e.duration)),null!=e.data&&(t.uint32(16),t.uint64(e.data)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.duration=e.uint32();break;case 2:n.data=e.uint64();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(ex||(ex={})),function(e){e.UNUSED="UNUSED",e.OK="OK",e.RESERVATION_REFUSED="RESERVATION_REFUSED",e.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONNECTION_FAILED="CONNECTION_FAILED",e.NO_RESERVATION="NO_RESERVATION",e.MALFORMED_MESSAGE="MALFORMED_MESSAGE",e.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"}(eS||(eS={})),function(e){e[e.UNUSED=0]="UNUSED",e[e.OK=100]="OK",e[e.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",e[e.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",e[e.PERMISSION_DENIED=202]="PERMISSION_DENIED",e[e.CONNECTION_FAILED=203]="CONNECTION_FAILED",e[e.NO_RESERVATION=204]="NO_RESERVATION",e[e.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",e[e.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"}(ek||(ek={})),function(e){e.codec=()=>nB(ek)}(eS||(eS={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.relay&&e.relay.byteLength>0&&(t.uint32(10),t.bytes(e.relay)),null!=e.peer&&e.peer.byteLength>0&&(t.uint32(18),t.bytes(e.peer)),null!=e.expiration&&0n!==e.expiration&&(t.uint32(24),t.uint64(e.expiration)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={relay:(0,t9.c)(0),peer:(0,t9.c)(0),expiration:0n},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.relay=e.bytes();break;case 2:n.peer=e.bytes();break;case 3:n.expiration=e.uint64();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(e_||(e_={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.publicKey&&e.publicKey.byteLength>0&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.payloadType&&e.payloadType.byteLength>0&&(t.uint32(18),t.bytes(e.payloadType)),null!=e.payload&&(t.uint32(26),e_.codec().encode(e.payload,t)),null!=e.signature&&e.signature.byteLength>0&&(t.uint32(42),t.bytes(e.signature)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={publicKey:(0,t9.c)(0),payloadType:(0,t9.c)(0),signature:(0,t9.c)(0)},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.publicKey=e.bytes();break;case 2:n.payloadType=e.bytes();break;case 3:n.payload=e_.codec().decode(e,e.uint32(),{limits:r.limits?.payload});break;case 5:n.signature=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(eI||(eI={}));class Pv{expires;bytes;constructor(e){e?.duration!=null&&e?.duration!==0&&(this.expires=Date.now()+1e3*e.duration),this.bytes=e?.data,0n===this.bytes&&(this.bytes=void 0),this.onData=this.onData.bind(this)}onData(e){null!=this.bytes&&(this.bytes-=BigInt(e.byteLength),this.bytes<0n&&(this.bytes=0n))}getLimits(){if(null==this.expires&&null==this.bytes)return;let e={};if(null!=this.bytes){let t=this;Object.defineProperty(e,"bytes",{get:()=>t.bytes})}if(null!=this.expires){let t=this;Object.defineProperty(e,"seconds",{get:()=>Math.round(((t.expires??0)-Date.now())/1e3)})}return e}}let PE=wP(wT(w7.matchers[0],wA("p2p-circuit"))),PA=wP(wA("p2p-circuit"));class Px extends uS{peerStore;registrar;connectionManager;randomWalk;started;running;topologyId;log;discoveryController;filter;queue;constructor(e,t={}){super(),this.log=e.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.started=!1,this.running=!1,this.peerStore=e.peerStore,this.registrar=e.registrar,this.connectionManager=e.connectionManager,this.randomWalk=e.randomWalk,this.filter=t.filter,this.discoveryController=new AbortController,this.discoveryController.signal}isStarted(){return this.started}async start(){this.topologyId=await this.registrar.register(Pp,{filter:this.filter,onConnect:e=>{this.log.trace("discovered relay %p queue (length: %d, active %d)",e,this.queue?.size,this.queue?.running),this.safeDispatchEvent("relay:discover",{detail:e})}}),this.started=!0}stop(){null!=this.topologyId&&this.registrar.unregister(this.topologyId),this.discoveryController?.abort(),this.started=!1}startDiscovery(){this.running||(this.log("start discovery"),this.running=!0,this.discoveryController=new AbortController,this.discoveryController.signal,Promise.resolve().then(async()=>{this.log("searching peer store for relays");let e=await this.peerStore.all({filters:[e=>e.protocols.includes(Pp)],orders:[()=>.5>Math.random()?1:-1,(e,t)=>{let r=PS(e),n=PS(t);return r>n?-1:+(n>r)}]});for(let t of e)this.log.trace("found relay peer %p in peer store",t.id),this.safeDispatchEvent("relay:discover",{detail:t.id});this.log("found %d relay peers in peer store",e.length);let t=this.queue=new hb({concurrency:5});for await(let e of(this.log("start random walk"),this.randomWalk.walk({signal:this.discoveryController.signal}))){if(this.log.trace("found random peer %p",e.id),t.has(e.id)){this.log.trace("random peer %p was already in queue",e.id);continue}if(this.connectionManager.getConnections(e.id)?.length>0){this.log.trace("random peer %p was already connected",e.id);continue}if(!await this.connectionManager.isDialable(e.multiaddrs)){this.log.trace("random peer %p was not dialable",e.id,e.multiaddrs.map(e=>e.toString()));continue}t.queued>10&&(this.log.trace("wait for space in queue for %p",e.id),await t.onSizeLessThan(10,{signal:this.discoveryController.signal})),this.log("adding random peer %p to dial queue (length: %d, active %d)",e.id,t.size,t.running),t.add(async()=>{let t=hQ([this.discoveryController.signal,AbortSignal.timeout(5e3)]);try{await this.connectionManager.openConnection(e.id,{signal:t})}finally{t.clear()}},{peerId:e.id,signal:this.discoveryController.signal}).catch(t=>{this.log.error("error opening connection to random peer %p",e.id,t)})}this.log("stop random walk"),await t.onIdle()}).catch(e=>{this.discoveryController.signal.aborted||this.log.error("failed when finding relays on the network",e)}))}stopDiscovery(){this.log("stop discovery"),this.running=!1,this.discoveryController?.abort()}}function PS(e){let t=e.metadata.get("last-dial-success");return null==t?0:new Date((0,uh.d)(t)).getTime()}class Pk extends uS{connectionManager;addressManager;reservationStore;listeningAddrs;log;listenTimeout;reservationId;relay;constructor(e,t={}){super(),this.log=e.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.connectionManager=e.connectionManager,this.addressManager=e.addressManager,this.reservationStore=e.reservationStore,this.listeningAddrs=[],this.listenTimeout=t.listenTimeout??Ph,this.reservationStore.addEventListener("relay:removed",this._onRemoveRelayPeer),this.reservationStore.addEventListener("relay:created-reservation",this._onAddRelayPeer)}_onRemoveRelayPeer=e=>{this.log("relay removed %p our relay %p",e.detail.relay,this.relay,this.relay?.equals(e.detail.relay)),this.relay?.equals(e.detail.relay)===!0&&(this.log("relay peer removed %p",e.detail.relay),this.listeningAddrs.forEach(e=>{this.addressManager.removeObservedAddr(e)}),this.listeningAddrs=[],this.safeDispatchEvent("listening"))};_onAddRelayPeer=e=>{let{details:t}=e.detail;"configured"!==t.type&&t.id===this.reservationId&&this.addedRelay(e.detail)};async listen(e){if(PA.exactMatch(e))this.log("searching for circuit relay servers"),this.reservationId=this.reservationStore.reserveRelay();else if(PE.exactMatch(e)){this.log("listen on specific relay server %a",e);let t=AbortSignal.timeout(this.listenTimeout),r=e.decapsulate("/p2p-circuit"),n=await this.connectionManager.openConnection(r,{signal:t});if(!this.reservationStore.hasReservation(n.remotePeer)){this.log("making reservation on peer %p",n.remotePeer);let e=await this.reservationStore.addRelay(n.remotePeer,"configured");this.addedRelay(e)}}else throw new uW(`Could not listen on p2p-circuit address "${e}"`)}getAddrs(){return[...this.listeningAddrs.values()].flat()}updateAnnounceAddrs(){}async close(){this.reservationStore.cancelReservations(),this.listeningAddrs=[],this.reservationStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),queueMicrotask(()=>{this.safeDispatchEvent("close")})}addedRelay(e){this.log("relay peer added %p",e.relay),this.relay=e.relay,this.listeningAddrs=e.details.reservation.addrs.map(e=>wt(e).encapsulate("/p2p-circuit")),this.listeningAddrs.forEach(e=>{this.addressManager.confirmObservedAddr(e,{type:"transport"})}),queueMicrotask(()=>{this.safeDispatchEvent("listening")})}}function P_(e){return new Pk(e)}let PI="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",PC=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=PI[63&r[e]];return t};class PT extends Error{static name="HadEnoughRelaysError";name="HadEnoughRelaysError"}class PP extends Error{static name="DoubleRelayError";name="DoubleRelayError"}class PR extends Error{static name="RelayQueueFullError";name="RelayQueueFullError"}let PO=6e5,PN=3e5,PD=3e4;class PB extends uS{peerId;connectionManager;peerStore;events;reserveQueue;reservations;pendingReservations;maxReservationQueueLength;reservationCompletionTimeout;started;log;relayFilter;constructor(e,t){super(),this.log=e.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.reservations=new yF,this.pendingReservations=[],this.maxReservationQueueLength=t?.maxReservationQueueLength??Pd,this.reservationCompletionTimeout=t?.reservationCompletionTimeout??Ph,this.started=!1,this.relayFilter=cQ(100),this.reserveQueue=new hb({concurrency:t?.reservationConcurrency??Pu,metricName:"libp2p_relay_reservation_queue",metrics:e.metrics}),this.events.addEventListener("connection:close",e=>{null!=[...this.reservations.values()].find(t=>t.connection===e.detail.id)&&this.#G(e.detail.remotePeer).catch(t=>{this.log("could not remove relay %p - %e",e.detail,t)})})}isStarted(){return this.started}start(){this.started=!0}afterStart(){Promise.resolve().then(async()=>{let e=await this.peerStore.all({filters:[e=>e.tags.has(Pf)]});this.log("removing tag from %d old relays",e.length),await Promise.all(e.map(async e=>{await this.peerStore.merge(e.id,{tags:{[Pf]:void 0}})})),this.log("redialing %d old relays",e.length),await Promise.all(e.map(async e=>this.addRelay(e.id,"discovered"))),this.#W()}).catch(e=>{this.log.error(e)})}stop(){this.reserveQueue.clear(),this.reservations.forEach(({timeout:e})=>{clearTimeout(e)}),this.reservations.clear(),this.started=!1}reserveRelay(){let e=PC();return this.pendingReservations.push(e),this.#W(),e}async addRelay(e,t){if(this.peerId.equals(e))throw this.log.trace("not trying to use self as relay"),new uW("Cannot use self as relay");if(this.reserveQueue.size>this.maxReservationQueueLength)throw new PR("The reservation queue is full");let r=this.reserveQueue.find(e);if(null!=r)return this.log.trace("potential relay peer %p is already in the reservation queue",e),r.join();if(this.relayFilter.has(e.toMultihash().bytes))throw new uW("The relay was previously invalid");return this.log.trace("try to reserve relay slot with %p",e),this.reserveQueue.add(async()=>{let r=Date.now();try{let r,n=this.reservations.get(e);if(null!=n){let t=this.connectionManager.getConnections(e),r=!1;if(0===t.length&&this.log("already have relay reservation with %p but we are no longer connected",e),t.map(e=>e.id).includes(n.connection)&&(this.log("already have relay reservation with %p and the original connection is still open",e),r=!0),r&&Pw(n.reservation.expire)>PO)return this.log("already have relay reservation with %p but we are still connected and it does not expire soon",e),{relay:e,details:n};await this.#G(e)}if("discovered"===t&&0===this.pendingReservations.length)throw new PT("Not making reservation on discovered relay because we do not need any more relays");let i=AbortSignal.timeout(this.reservationCompletionTimeout),s=await this.connectionManager.openConnection(e,{signal:i});if(w9.matches(s.remoteAddr))throw new PP("not creating reservation over relayed connection");let o=await this.#Q(s,{signal:i}),a=Pw(o.expire);this.log("created reservation on relay peer %p, expiry date is %s",e,new Date(Date.now()+a).toString());let l=Math.min(Math.max(a-PN,PD),0x7fffffff),c=setTimeout(()=>{this.log("refresh reservation to relay %p",e),this.addRelay(e,t).catch(async t=>{this.log.error("could not refresh reservation to relay %p - %e",e,t),await this.#G(e)}).catch(t=>{this.log.error("could not remove expired reservation to relay %p - %e",e,t)})},l);if("discovered"===t){let e=this.pendingReservations.pop();if(null==e)throw new PT("Made reservation on relay but did not need any more discovered relays");r={timeout:c,reservation:o,type:t,connection:s.id,id:e}}else r={timeout:c,reservation:o,type:t,connection:s.id};this.reservations.set(e,r),await this.peerStore.merge(e,{tags:{[Pf]:{value:1,ttl:a}}}),this.#W();let u={relay:e,details:r};return this.safeDispatchEvent("relay:created-reservation",{detail:u}),u}catch(n){throw("discovered"!==t||"HadEnoughRelaysError"!==n.name)&&this.log.error("could not reserve slot on %p after %dms - %e",e,Date.now()-r,n),("DialError"===n.name||"UnsupportedProtocolError"===n.name)&&this.relayFilter.add(e.toMultihash().bytes),this.#G(e).catch(t=>{this.log.error("could not remove reservation on %p after reserving slot failed - %e",e,t)}),n}},{peerId:e})}hasReservation(e){return this.reservations.has(e)}getReservation(e){return this.reservations.get(e)?.reservation}reservationCount(e){return null==e?this.reservations.size:[...this.reservations.values()].reduce((t,r)=>(r.type===e&&t++,t),0)}cancelReservations(){[...this.reservations.values()].forEach(e=>{clearTimeout(e.timeout)}),this.reservations.clear()}async #Q(e,t){let r;t.signal?.throwIfAborted(),this.log("requesting reservation from %p",e.remotePeer);let n=await e.newStream(Pp,t),i=Tv(n).pb(ew);this.log.trace("send RESERVE to %p",e.remotePeer),await i.write({type:ew.Type.RESERVE},t);try{this.log.trace("reading response from %p",e.remotePeer),r=await i.read(t)}catch(e){throw n.abort(e),e}finally{"closed"!==n.status&&await n.close(t)}if(this.log.trace("read response %o",r),r.status===eS.OK&&null!=r.reservation){let t=new Set;for(let n of(t.add(e.remoteAddr.toString()),r.reservation.addrs)){let r=wt(n);null==r.getPeerId()&&(r=r.encapsulate(`/p2p/${e.remotePeer}`)),r=wt(r.toString().replace(`/p2p/${e.remotePeer}/p2p/${e.remotePeer}`,`/p2p/${e.remotePeer}`)),t.add(r.toString())}return r.reservation.addrs=[...t].map(e=>wt(e).bytes),r.reservation}let s=`reservation failed with status ${r.status??"undefined"}`;throw this.log.error(s),Error(s)}async #G(e){let t=this.reservations.get(e);null!=t&&(this.log("removing relay reservation with %p from local store",e),clearTimeout(t.timeout),this.reservations.delete(e),"discovered"===t.type&&this.pendingReservations.push(t.id),await this.peerStore.merge(e,{tags:{[Pf]:void 0}}),this.safeDispatchEvent("relay:removed",{detail:{relay:e,details:t}}),this.#W())}#W(){if(0===this.pendingReservations.length){this.log.trace("have discovered enough relays"),this.reserveQueue.clear(),this.safeDispatchEvent("relay:found-enough-relays");return}this.relayFilter=cQ(100),this.log("not discovered enough relays %d/%d",this.reservations.size,this.pendingReservations.length),this.safeDispatchEvent("relay:not-enough-relays")}}let PM=e=>{if(null==e.peer)return!1;try{e.peer.addrs.forEach(wt)}catch{return!1}return!0},PL={maxInboundStopStreams:Pm,maxOutboundStopStreams:Pm};class PF{discovery;registrar;peerStore;connectionManager;transportManager;peerId;upgrader;addressManager;connectionGater;reservationStore;logger;maxInboundStopStreams;maxOutboundStopStreams;started;log;shutdownController;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:circuit-relay:transport"),this.registrar=e.registrar,this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.logger=e.logger,this.peerId=e.peerId,this.upgrader=e.upgrader,this.addressManager=e.addressManager,this.connectionGater=e.connectionGater,this.maxInboundStopStreams=t.maxInboundStopStreams??PL.maxInboundStopStreams,this.maxOutboundStopStreams=t.maxOutboundStopStreams??PL.maxOutboundStopStreams,this.shutdownController=new AbortController,this.discovery=new Px(e,{filter:t.discoveryFilter??Pa(Py,Pb)}),this.discovery.addEventListener("relay:discover",e=>{this.reservationStore.addRelay(e.detail,"discovered").catch(t=>{"HadEnoughRelaysError"!==t.name&&"RelayQueueFullError"!==t.name&&this.log.error("could not add discovered relay %p",e.detail,t)})}),this.reservationStore=new PB(e,t),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{this.discovery?.startDiscovery()}),this.reservationStore.addEventListener("relay:found-enough-relays",()=>{this.discovery?.stopDiscovery()}),this.started=!1}[Symbol.toStringTag]="@libp2p/circuit-relay-v2-transport";[En]=["@libp2p/transport","@libp2p/circuit-relay-v2-transport"];get[Ei](){return null!=this.discovery?["@libp2p/identify"]:[]}[xh]=!0;isStarted(){return this.started}async start(){this.shutdownController=new AbortController,await this.registrar.handle(Pg,e=>{let t=this.upgrader.createInboundAbortSignal(this.shutdownController.signal);this.onStop(e,t).catch(t=>{this.log.error("error while handling STOP protocol",t),e.stream.abort(t)}).finally(()=>{t.clear()})},{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnLimitedConnection:!0}),await ul(this.discovery,this.reservationStore),this.started=!0}async stop(){this.shutdownController.abort(),await uc(this.discovery,this.reservationStore),await this.registrar.unhandle(Pg),this.started=!1}async dial(e,t){let r;if(1!==e.protoCodes().filter(e=>e===Pc).length){let t="Invalid circuit relay address";throw this.log.error(t,e),new uG(t)}let n=e.toString().split("/p2p-circuit"),i=wt(n[0]),s=wt(n[n.length-1]),o=i.getPeerId(),a=s.getPeerId();if(null==o||null==a){let t=`ircuit relay dial to ${e.toString()} failed as address did not have both relay and destination PeerIDs`;throw this.log.error(`c${t}`),new uG(`C${t}`)}let l=yT(o),c=yT(a),u=this.connectionManager.getConnections(l)[0];null==u?(await this.peerStore.merge(l,{multiaddrs:[i]}),t.onProgress?.(new nV("circuit-relay:open-connection")),u=await this.connectionManager.openConnection(l,t)):t.onProgress?.(new nV("circuit-relay:reuse-connection"));try{t.onProgress?.(new nV("circuit-relay:open-hop-stream")),r=await u.newStream(Pp,t);let n=Tv(r),o=n.pb(ew);t.onProgress?.(new nV("circuit-relay:write-connect-message")),await o.write({type:ew.Type.CONNECT,peer:{id:c.toMultihash().bytes,addrs:[wt(s).bytes]}},t),t.onProgress?.(new nV("circuit-relay:read-connect-response"));let a=await o.read(t);if(a.status!==eS.OK)throw new uq(`failed to connect via relay with status ${a?.status?.toString()??"undefined"}`);let l=new Pv(a.limit),h=Pl({stream:n.unwrap(),remoteAddr:e,localAddr:i.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`),logger:this.logger,onDataRead:l.onData,onDataWrite:l.onData});return this.log("new outbound relayed connection %a",h.remoteAddr),await this.upgrader.upgradeOutbound(h,{...t,limits:l.getLimits()})}catch(e){throw this.log.error("circuit relay dial to destination %p via relay %p failed",c,l,e),r?.abort(e),e}}createListener(e){return P_({peerId:this.peerId,connectionManager:this.connectionManager,addressManager:this.addressManager,reservationStore:this.reservationStore,logger:this.logger})}listenFilter(e){return(e=Array.isArray(e)?e:[e]).filter(e=>PE.exactMatch(e)||PA.exactMatch(e))}dialFilter(e){return(e=Array.isArray(e)?e:[e]).filter(e=>w9.exactMatch(e))}async onStop({connection:e,stream:t},r){if(!this.reservationStore.hasReservation(e.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),await this.transportManager.listen([e.remoteAddr.encapsulate("/p2p-circuit")])}catch(e){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on",e)}let n=Tv(t).pb(ev),i=await n.read({signal:r});if(this.log("new circuit relay v2 stop stream from %p with type %s",e.remotePeer,i.type),i?.type===void 0){this.log.error("type was missing from circuit v2 stop protocol request from %s",e.remotePeer),await n.write({type:ev.Type.STATUS,status:eS.MALFORMED_MESSAGE},{signal:r}),await t.close();return}if(i.type!==ev.Type.CONNECT){this.log.error("invalid stop connect request via peer %p",e.remotePeer),await n.write({type:ev.Type.STATUS,status:eS.UNEXPECTED_MESSAGE},{signal:r}),await t.close();return}if(!PM(i)){this.log.error("invalid stop connect request via peer %p",e.remotePeer),await n.write({type:ev.Type.STATUS,status:eS.MALFORMED_MESSAGE},{signal:r}),await t.close({signal:r});return}let s=yO(aG.decode(i.peer.id));if(await this.connectionGater.denyInboundRelayedConnection?.(e.remotePeer,s)===!0){this.log.error("connection gater denied inbound relayed connection from %p",e.remotePeer),await n.write({type:ev.Type.STATUS,status:eS.PERMISSION_DENIED},{signal:r}),await t.close({signal:r});return}this.log.trace("sending success response to %p",e.remotePeer),await n.write({type:ev.Type.STATUS,status:eS.OK},{signal:r});let o=new Pv(i.limit),a=e.remoteAddr.encapsulate(`/p2p-circuit/p2p/${s.toString()}`),l=this.addressManager.getAddresses()[0],c=Pl({stream:n.unwrap().unwrap(),remoteAddr:a,localAddr:l,logger:this.logger,onDataRead:o.onData,onDataWrite:o.onData});this.log("new inbound relayed connection %a",c.remoteAddr),await this.upgrader.upgradeInbound(c,{limits:o.getLimits(),signal:r}),this.log("%s connection %a upgraded","inbound",c.remoteAddr)}}function PU(e={}){return t=>new PF(t,e)}function Pj(e,t){return!w9.matches(e)&&null!=t.dialTransportForMultiaddr(e)&&(!!wM.matches(e)||!!wz.matches(e)&&!1===ww(e.toOptions().host))}!function(e){let t,r,n;!function(e){e.UNUSED="UNUSED",e.CONNECT="CONNECT",e.SYNC="SYNC"}(t=e.Type||(e.Type={})),function(e){e[e.UNUSED=0]="UNUSED",e[e.CONNECT=100]="CONNECT",e[e.SYNC=300]="SYNC"}(r||(r={})),function(e){e.codec=()=>nB(r)}(t=e.Type||(e.Type={})),e.codec=()=>(null==n&&(n=nM((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.Type.codec().encode(t.type,r)),null!=t.observedAddresses)for(let e of t.observedAddresses)r.uint32(18),r.bytes(e);!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={observedAddresses:[]},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.type=e.Type.codec().decode(t);break;case 2:if(n.limits?.observedAddresses!=null&&i.observedAddresses.length===n.limits.observedAddresses)throw new nL('Decode error - map field "observedAddresses" had too many elements');i.observedAddresses.push(t.bytes());break;default:t.skipType(7&r)}}return i})),n),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(eC||(eC={}));let P$=4096,PH=100,Pq={timeout:5e3,retries:3,maxInboundStreams:1,maxOutboundStreams:1};class Pz{started;timeout;retries;maxInboundStreams;maxOutboundStreams;peerStore;registrar;connectionManager;addressManager;transportManager;topologyId;log;constructor(e,t){this.log=e.logger.forComponent("libp2p:dcutr"),this.started=!1,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.timeout=t.timeout??Pq.timeout,this.retries=t.retries??Pq.retries,this.maxInboundStreams=t.maxInboundStreams??Pq.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??Pq.maxOutboundStreams}[Symbol.toStringTag]="@libp2p/dcutr";[Ei]=["@libp2p/identify"];isStarted(){return this.started}async start(){this.started||(this.topologyId=await this.registrar.register(PV,{notifyOnLimitedConnection:!0,onConnect:(e,t)=>{w9.exactMatch(t.remoteAddr)&&"inbound"===t.direction&&this.upgradeInbound(t).catch(e=>{this.log.error("error during outgoing DCUtR attempt",e)})}}),await this.registrar.handle(PV,e=>{this.handleIncomingUpgrade(e.stream,e.connection).catch(t=>{this.log.error("error during incoming DCUtR attempt",t),e.stream.abort(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:!0}),this.started=!0)}async stop(){await this.registrar.unhandle(PV),null!=this.topologyId&&this.registrar.unregister(this.topologyId),this.started=!1}async upgradeInbound(e){let t;if(!await this.attemptUnilateralConnectionUpgrade(e))for(let r=0;r<this.retries;r++){let n={signal:AbortSignal.timeout(this.timeout)};try{t=await e.newStream([PV],{signal:n.signal,runOnLimitedConnection:!0});let r=Tv(t,{maxDataLength:P$}).pb(eC);this.log("B sending connect to %p",e.remotePeer);let i=Date.now();await r.write({type:eC.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(e=>e.bytes)},n),this.log("B receiving connect from %p",e.remotePeer);let s=await r.read(n);if(s.type!==eC.Type.CONNECT)throw this.log("A sent wrong message type"),new uq("DCUtR message type was incorrect");let o=this.getDialableMultiaddrs(s.observedAddresses);if(0===o.length)throw this.log("A did not have any dialable multiaddrs"),new uq("DCUtR connect message had no multiaddrs");let a=Date.now()-i;this.log("A sending sync, rtt %dms",a),await r.write({type:eC.Type.SYNC,observedAddresses:[]},n),this.log("A waiting for half RTT"),await S0(a/2),this.log("B dialing",o);let l=await this.connectionManager.openConnection(o,{signal:n.signal,priority:PH,force:!0,initiator:!1});this.log("DCUtR to %p succeeded to address %a, closing relayed connection",e.remotePeer,l.remoteAddr),await e.close(n);break}catch(e){if(this.log.error("error while attempting DCUtR on attempt %d of %d",r+1,this.retries,e),t?.abort(e),r===this.retries)throw e}finally{null!=t&&await t.close(n)}}}async attemptUnilateralConnectionUpgrade(e){let t=(await this.peerStore.get(e.remotePeer)).addresses.map(t=>{let r=t.multiaddr;return null==r.getPeerId()?r.encapsulate(`/p2p/${e.remotePeer}`):r}).filter(e=>Pj(e,this.transportManager));if(t.length>0){let r=AbortSignal.timeout(this.timeout);try{this.log("attempting unilateral connection upgrade to %a",t);let n=await this.connectionManager.openConnection(t,{signal:r,force:!0});if(w9.exactMatch(n.remoteAddr))throw Error("Could not open a new, non-limited, connection");return this.log("unilateral connection upgrade to %p succeeded via %a, closing relayed connection",e.remotePeer,n.remoteAddr),await e.close({signal:r}),!0}catch(r){this.log.error("unilateral connection upgrade to %p on addresses %a failed",e.remotePeer,t,r)}}else this.log("peer %p has no public addresses, not attempting unilateral connection upgrade",e.remotePeer);return!1}async handleIncomingUpgrade(e,t){let r={signal:AbortSignal.timeout(this.timeout)};try{let n=Tv(e,{maxDataLength:P$}).pb(eC);this.log("A receiving connect");let i=await n.read(r);if(i.type!==eC.Type.CONNECT)throw this.log("B sent wrong message type"),new uq("DCUtR message type was incorrect");if(0===i.observedAddresses.length)throw this.log("B sent no multiaddrs"),new uq("DCUtR connect message had no multiaddrs");let s=this.getDialableMultiaddrs(i.observedAddresses);if(0===s.length)throw this.log("B had no dialable multiaddrs"),new uq("DCUtR connect message had no dialable multiaddrs");if(this.log("A sending connect"),await n.write({type:eC.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(e=>e.bytes)}),this.log("A receiving sync"),(await n.read(r)).type!==eC.Type.SYNC)throw new uq("DCUtR message type was incorrect");this.log("A dialing",s);let o=await this.connectionManager.openConnection(s,{signal:r.signal,priority:PH,force:!0});this.log("DCUtR to %p succeeded via %a, closing relayed connection",t.remotePeer,o.remoteAddr),await t.close(r)}catch(r){this.log.error("incoming DCUtR from %p failed",t.remotePeer,r),e.abort(r)}finally{await e.close(r)}}getDialableMultiaddrs(e){let t=[];for(let r of e)if(null!=r&&0!==r.length)try{let e=wt(r);if(!Pj(e,this.transportManager))continue;t.push(e)}catch{}return t}}let PV="/libp2p/dcutr";function PK(e={}){return t=>new Pz(t,e)}let PG="0.1.0",PW="id",PQ="id/push",PJ="1.0.0",PZ="1.0.0",PY=8192,PX=32;!function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.protocolVersion&&(t.uint32(42),t.string(e.protocolVersion)),null!=e.agentVersion&&(t.uint32(50),t.string(e.agentVersion)),null!=e.publicKey&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.listenAddrs)for(let r of e.listenAddrs)t.uint32(18),t.bytes(r);if(null!=e.observedAddr&&(t.uint32(34),t.bytes(e.observedAddr)),null!=e.protocols)for(let r of e.protocols)t.uint32(26),t.string(r);null!=e.signedPeerRecord&&(t.uint32(66),t.bytes(e.signedPeerRecord)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={listenAddrs:[],protocols:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 5:n.protocolVersion=e.string();break;case 6:n.agentVersion=e.string();break;case 1:n.publicKey=e.bytes();break;case 2:if(r.limits?.listenAddrs!=null&&n.listenAddrs.length===r.limits.listenAddrs)throw new nL('Decode error - map field "listenAddrs" had too many elements');n.listenAddrs.push(e.bytes());break;case 4:n.observedAddr=e.bytes();break;case 3:if(r.limits?.protocols!=null&&n.protocols.length===r.limits.protocols)throw new nL('Decode error - map field "protocols" had too many elements');n.protocols.push(e.string());break;case 8:n.signedPeerRecord=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(eT||(eT={}));let P0={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:PY,runOnConnectionOpen:!0,runOnSelfUpdate:!0,runOnLimitedConnection:!0,concurrency:PX};function P1(e){if(null!=e&&e.length>0)try{return wt(e)}catch{}}function P2(e,t){return null!=t?t:e.userAgent}async function P3(e,t,r,n,i){let s;if(r("received identify from %p",n.remotePeer),null==i)throw new uq("message was null or undefined");let o={};if(i.listenAddrs.length>0&&(o.addresses=i.listenAddrs.map(e=>({isCertified:!1,multiaddr:wt(e)}))),i.protocols.length>0&&(o.protocols=i.protocols),null!=i.publicKey){let e=ya(i.publicKey);if(!yP(e).equals(n.remotePeer))throw new uq("public key did not match remote PeerId");o.publicKey=e}if(null!=i.signedPeerRecord){let t;r.trace("received signedPeerRecord from %p",n.remotePeer);let a=i.signedPeerRecord,l=await xA.openAndCertify(a,xI.DOMAIN),c=xI.createFromProtobuf(l.payload),u=yN(l.publicKey.toCID());if(!c.peerId.equals(u))throw new uq("signing key does not match PeerId in the PeerRecord");if(!n.remotePeer.equals(c.peerId))throw new uq("signing key does not match remote PeerId");try{t=await e.get(c.peerId)}catch(e){if("NotFoundError"!==e.name)throw e}if(null!=t&&(o.metadata=t.metadata,null!=t.peerRecordEnvelope)){let e=await xA.createFromProtobuf(t.peerRecordEnvelope),n=xI.createFromProtobuf(e.payload);n.seqNumber>=c.seqNumber&&(r("sequence number was lower or equal to existing sequence number - stored: %d received: %d",n.seqNumber,c.seqNumber),c=n,a=t.peerRecordEnvelope)}o.peerRecordEnvelope=a,o.addresses=c.multiaddrs.map(e=>({isCertified:!0,multiaddr:e})),s={seq:c.seqNumber,addresses:c.multiaddrs}}else r("%p did not send a signed peer record",n.remotePeer);if(r.trace("patching %p with",n.remotePeer,o),await e.patch(n.remotePeer,o),null!=i.agentVersion||null!=i.protocolVersion){let t={};null!=i.agentVersion&&(t.AgentVersion=(0,nm.s)(i.agentVersion)),null!=i.protocolVersion&&(t.ProtocolVersion=(0,nm.s)(i.protocolVersion)),r.trace("merging %p metadata",n.remotePeer,t),await e.merge(n.remotePeer,{metadata:t})}let a={peerId:n.remotePeer,protocolVersion:i.protocolVersion,agentVersion:i.agentVersion,publicKey:i.publicKey,listenAddrs:i.listenAddrs.map(e=>wt(e)),observedAddr:null==i.observedAddr?void 0:wt(i.observedAddr),protocols:i.protocols,signedPeerRecord:s,connection:n};return t.safeDispatchEvent("peer:identify",{detail:a}),a}class P4{host;protocol;started;timeout;peerId;privateKey;peerStore;registrar;addressManager;maxInboundStreams;maxOutboundStreams;maxMessageSize;maxObservedAddresses;events;runOnLimitedConnection;log;constructor(e,t){this.protocol=t.protocol,this.started=!1,this.peerId=e.peerId,this.privateKey=e.privateKey,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.events=e.events,this.log=t.log,this.timeout=t.timeout??P0.timeout,this.maxInboundStreams=t.maxInboundStreams??P0.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??P0.maxOutboundStreams,this.maxMessageSize=t.maxMessageSize??P0.maxMessageSize,this.maxObservedAddresses=t.maxObservedAddresses??P0.maxObservedAddresses,this.runOnLimitedConnection=t.runOnLimitedConnection??P0.runOnLimitedConnection,this.host={protocolVersion:`${t.protocolPrefix??P0.protocolPrefix}/${PG}`,agentVersion:P2(e.nodeInfo,t.agentVersion)}}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:(0,nm.s)(this.host.agentVersion),ProtocolVersion:(0,nm.s)(this.host.protocolVersion)}}),await this.registrar.handle(this.protocol,e=>{this.handleProtocol(e).catch(e=>{this.log.error(e)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.protocol),this.started=!1}}class P5 extends P4{connectionManager;concurrency;constructor(e,t={}){super(e,{...t,protocol:`/${t.protocolPrefix??P0.protocolPrefix}/${PQ}/${PZ}`,log:e.logger.forComponent("libp2p:identify-push")}),this.connectionManager=e.connectionManager,this.concurrency=t.concurrency??P0.concurrency,(t.runOnSelfUpdate??P0.runOnSelfUpdate)&&e.events.addEventListener("self:peer:update",e=>{this.push().catch(e=>{this.log.error(e)})})}[En]=["@libp2p/identify-push"];async push(){if(!this.isStarted())return;let e=this.addressManager.getAddresses().map(e=>e.decapsulateCode(bT("p2p").code)),t=new xI({peerId:this.peerId,multiaddrs:e}),r=await xA.seal(t,this.privateKey),n=this.registrar.getProtocols(),i=await this.peerStore.get(this.peerId),s=(0,uh.d)(i.metadata.get("AgentVersion")??(0,nm.s)(this.host.agentVersion)),o=(0,uh.d)(i.metadata.get("ProtocolVersion")??(0,nm.s)(this.host.protocolVersion)),a=this;async function*l(){for(let t of a.connectionManager.getConnections())(await a.peerStore.get(t.remotePeer)).protocols.includes(a.protocol)&&(yield async()=>{let i,l=AbortSignal.timeout(a.timeout);try{i=await t.newStream(a.protocol,{signal:l,runOnLimitedConnection:a.runOnLimitedConnection});let c=Tv(i,{maxDataLength:a.maxMessageSize}).pb(eT);await c.write({listenAddrs:e.map(e=>e.bytes),signedPeerRecord:r.marshal(),protocols:n,agentVersion:s,protocolVersion:o},{signal:l}),await i.close({signal:l})}catch(e){a.log.error("could not push identify update to peer",e),i?.abort(e)}})}await (0,ux.A)(lt(l(),{concurrency:this.concurrency}))}async handleProtocol(e){let{connection:t,stream:r}=e;try{if(this.peerId.equals(t.remotePeer))throw Error("received push from ourselves?");let e={signal:AbortSignal.timeout(this.timeout)},n=Tv(r,{maxDataLength:this.maxMessageSize}).pb(eT),i=await n.read(e);await r.close(e),await P3(this.peerStore,this.events,this.log,t,i)}catch(e){this.log.error("received invalid message",e),r.abort(e);return}this.log.trace("handled push from %p",t.remotePeer)}}let P6=41;class P8 extends P4{constructor(e,t={}){super(e,{...t,protocol:`/${t.protocolPrefix??P0.protocolPrefix}/${PW}/${PJ}`,log:e.logger.forComponent("libp2p:identify")}),(t.runOnConnectionOpen??P0.runOnConnectionOpen)&&e.events.addEventListener("connection:open",e=>{let t=e.detail;this.identify(t).catch(e=>{e.name!==uH.name&&this.log.error("error during identify trigged by connection:open",e)})})}[En]=["@libp2p/identify"];async _identify(e,t={}){let r;if(null==t.signal){let e=AbortSignal.timeout(this.timeout);t={...t,signal:e}}try{r=await e.newStream(this.protocol,{...t,runOnLimitedConnection:this.runOnLimitedConnection});let n=Tv(r,{maxDataLength:this.maxMessageSize}).pb(eT),i=await n.read(t);return await r.close(t),i}catch(e){throw r?.abort(e),e}}async identify(e,t={}){let r=await this._identify(e,t),{publicKey:n,protocols:i,observedAddr:s}=r;if(null==n)throw new uq("public key was missing from identify message");let o=yN(ya(n).toCID());if(!e.remotePeer.equals(o))throw new uq("identified peer does not match the expected peer");if(this.peerId.equals(o))throw new uq("identified peer is our own peer id?");return this.maybeAddObservedAddress(s),this.log("identify completed for peer %p and protocols %o",o,i),P3(this.peerStore,this.events,this.log,e,r)}maybeAddObservedAddress(e){let t=P1(e);return null==t?void 0:(this.log.trace("our observed address was %a",t),Sp(t))?void this.log.trace("our observed address was private"):t.stringTuples()[0][0]!==P6||Tb(t)?void(!wG.exactMatch(t)&&(this.log.trace("storing the observed address"),this.addressManager.addObservedAddr(t))):void this.log.trace("our observed address was IPv6 but not a global unicast address")}async handleProtocol(e){let{connection:t,stream:r}=e,n=AbortSignal.timeout(this.timeout);try{let e=await this.peerStore.get(this.peerId),i=this.addressManager.getAddresses().map(e=>e.decapsulateCode(bT("p2p").code)),s=e.peerRecordEnvelope;if(i.length>0&&null==s){let e=new xI({peerId:this.peerId,multiaddrs:i});s=(await xA.seal(e,this.privateKey)).marshal().subarray()}let o=t.remoteAddr.bytes;w$.matches(t.remoteAddr)||(o=void 0);let a=Tv(r).pb(eT);await a.write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:yu(this.privateKey.publicKey),listenAddrs:i.map(e=>e.bytes),signedPeerRecord:s,observedAddr:o,protocols:e.protocols},{signal:n}),await r.close({signal:n})}catch(e){this.log.error("could not respond to identify request",e),r.abort(e)}}}function P7(e={}){return t=>new P8(t,e)}function P9(e={}){return t=>new P5(t,e)}let Re=1296e5,Rt="/ipfs/kad/1.0.0",Rr=1728e5,Rn=864e5,Ri=10,Rs=16384,Ro=36e5,Ra=20,Rl=3,Rc=3e5,Ru=1e3,Rh=5e3,Rd=3e5,Rf=3e4,Rp=18e4,Rg=`${kx}-kad-dht`;function Rm(e){let t=e.getUTCFullYear(),r=String(e.getUTCMonth()+1).padStart(2,"0"),n=String(e.getUTCDate()).padStart(2,"0"),i=String(e.getUTCHours()).padStart(2,"0"),s=String(e.getUTCMinutes()).padStart(2,"0"),o=String(e.getUTCSeconds()).padStart(2,"0"),a=String(1e3*e.getUTCMilliseconds()*1e3).padStart(9,"0");return`${t}-${r}-${n}T${i}:${s}:${o}.${a}Z`}function Ry(e){let t=RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),r=String(e).trim().match(t);if(null==r)throw Error("Invalid format");let n=parseInt(r[1],10),i=parseInt(r[2],10)-1,s=parseInt(r[3],10),o=parseInt(r[4],10),a=parseInt(r[5],10);return new Date(Date.UTC(n,i,s,o,a,parseInt(r[6],10),parseInt(r[7].slice(0,-6),10)))}!function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.key&&e.key.byteLength>0&&(t.uint32(10),t.bytes(e.key)),null!=e.value&&e.value.byteLength>0&&(t.uint32(18),t.bytes(e.value)),null!=e.timeReceived&&""!==e.timeReceived&&(t.uint32(42),t.string(e.timeReceived)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={key:(0,t9.c)(0),value:(0,t9.c)(0),timeReceived:""},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.key=e.bytes();break;case 2:n.value=e.bytes();break;case 5:n.timeReceived=e.string();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(eP||(eP={}));class Rb{key;value;timeReceived;constructor(e,t,r){if(!(e instanceof Uint8Array))throw Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=r}serialize(){return eP.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:Rm(this.timeReceived)}}static deserialize(e){let t=eP.decode(e);return new Rb(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){let t=Ry(e.timeReceived);if(null==e.key)throw Error("key missing from deserialized object");if(null==e.value)throw Error("value missing from deserialized object");return new Rb(e.key,e.value,t)}}class Rw extends Error{constructor(e="Query error"){super(e),this.name="QueryError"}}class Rv extends Error{constructor(e="Query aborted"){super(e),this.name="QueryAbortedError"}}class RE extends Error{constructor(e="Invalid record"){super(e),this.name="InvalidRecordError"}}class RA extends Error{constructor(e="No selector function configured for prefix"){super(e),this.name="MissingSelectorError"}}function Rx(e,t={}){let r={...e,name:"SEND_QUERY",type:0,messageName:e.type,messageType:e.type};return t.onProgress?.(new CustomEvent("kad-dht:query:send-query",{detail:r})),r}function RS(e,t={}){let r={...e,name:"PEER_RESPONSE",type:1,messageName:e.messageType,closer:e.closer??[],providers:e.providers??[]};return t.onProgress?.(new CustomEvent("kad-dht:query:peer-response",{detail:r})),r}function Rk(e,t={}){let r={...e,name:"FINAL_PEER",type:2};return t.onProgress?.(new CustomEvent("kad-dht:query:final-peer",{detail:r})),r}function R_(e,t={}){let r={...e,name:"QUERY_ERROR",type:3};return t.onProgress?.(new CustomEvent("kad-dht:query:query-error",{detail:r})),r}function RI(e,t={}){let r={...e,name:"PROVIDER",type:4};return t.onProgress?.(new CustomEvent("kad-dht:query:provider",{detail:r})),r}function RC(e,t={}){let r={...e,name:"VALUE",type:5};return t.onProgress?.(new CustomEvent("kad-dht:query:value",{detail:r})),r}function RT(e,t={}){let r={...e,name:"DIAL_PEER",type:7};return t.onProgress?.(new CustomEvent("kad-dht:query:dial-peer",{detail:r})),r}function RP(e,t,r){if(0===r.length)throw new uC("No records given");let n=(0,uh.d)(t).split("/");if(n.length<3)throw new uC("Record key does not have a selector function");let i=e[n[1].toString()];if(null==i)throw new RA(`No selector function configured for key type "${n[1]}"`);return 1===r.length?0:i(t,r)}!function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.key&&(t.uint32(10),t.bytes(e.key)),null!=e.value&&(t.uint32(18),t.bytes(e.value)),null!=e.author&&(t.uint32(26),t.bytes(e.author)),null!=e.signature&&(t.uint32(34),t.bytes(e.signature)),null!=e.timeReceived&&(t.uint32(42),t.string(e.timeReceived)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.key=e.bytes();break;case 2:n.value=e.bytes();break;case 3:n.author=e.bytes();break;case 4:n.signature=e.bytes();break;case 5:n.timeReceived=e.string();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(eR||(eR={})),function(e){e.PUT_VALUE="PUT_VALUE",e.GET_VALUE="GET_VALUE",e.ADD_PROVIDER="ADD_PROVIDER",e.GET_PROVIDERS="GET_PROVIDERS",e.FIND_NODE="FIND_NODE",e.PING="PING"}(eO||(eO={})),function(e){e[e.PUT_VALUE=0]="PUT_VALUE",e[e.GET_VALUE=1]="GET_VALUE",e[e.ADD_PROVIDER=2]="ADD_PROVIDER",e[e.GET_PROVIDERS=3]="GET_PROVIDERS",e[e.FIND_NODE=4]="FIND_NODE",e[e.PING=5]="PING"}(eN||(eN={})),function(e){e.codec=()=>nB(eN)}(eO||(eO={})),function(e){e.NOT_CONNECTED="NOT_CONNECTED",e.CONNECTED="CONNECTED",e.CAN_CONNECT="CAN_CONNECT",e.CANNOT_CONNECT="CANNOT_CONNECT"}(eD||(eD={})),function(e){e[e.NOT_CONNECTED=0]="NOT_CONNECTED",e[e.CONNECTED=1]="CONNECTED",e[e.CAN_CONNECT=2]="CAN_CONNECT",e[e.CANNOT_CONNECT=3]="CANNOT_CONNECT"}(eB||(eB={})),function(e){e.codec=()=>nB(eB)}(eD||(eD={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.id&&e.id.byteLength>0&&(t.uint32(10),t.bytes(e.id)),null!=e.multiaddrs)for(let r of e.multiaddrs)t.uint32(18),t.bytes(r);null!=e.connection&&(t.uint32(24),eD.codec().encode(e.connection,t)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={id:(0,t9.c)(0),multiaddrs:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.id=e.bytes();break;case 2:if(r.limits?.multiaddrs!=null&&n.multiaddrs.length===r.limits.multiaddrs)throw new nL('Decode error - map field "multiaddrs" had too many elements');n.multiaddrs.push(e.bytes());break;case 3:n.connection=eD.codec().decode(e);break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(eM||(eM={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.type&&0!==eN[e.type]&&(t.uint32(8),eO.codec().encode(e.type,t)),null!=e.clusterLevel&&(t.uint32(80),t.int32(e.clusterLevel)),null!=e.key&&(t.uint32(18),t.bytes(e.key)),null!=e.record&&(t.uint32(26),t.bytes(e.record)),null!=e.closer)for(let r of e.closer)t.uint32(66),eM.codec().encode(r,t);if(null!=e.providers)for(let r of e.providers)t.uint32(74),eM.codec().encode(r,t);!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={type:eO.PUT_VALUE,closer:[],providers:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.type=eO.codec().decode(e);break;case 10:n.clusterLevel=e.int32();break;case 2:n.key=e.bytes();break;case 3:n.record=e.bytes();break;case 8:if(r.limits?.closer!=null&&n.closer.length===r.limits.closer)throw new nL('Decode error - map field "closer" had too many elements');n.closer.push(eM.codec().decode(e,e.uint32(),{limits:r.limits?.closer$}));break;case 9:if(r.limits?.providers!=null&&n.providers.length===r.limits.providers)throw new nL('Decode error - map field "providers" had too many elements');n.providers.push(eM.codec().decode(e,e.uint32(),{limits:r.limits?.providers$}));break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(eL||(eL={}));let RR={pk:function(e,t){return 0}};async function RO(e,t){let r=t.key,n=(0,uh.d)(r).split("/");if(n.length<3)return;let i=e[n[1].toString()];if(null==i)throw new uC(`No validator available for key type "${n[1]}"`);await i(r,t.value)}let RN={pk:async(e,t)=>{if(!(e instanceof Uint8Array))throw new uC('"key" must be a Uint8Array');if(e.byteLength<5)throw new uC("Invalid public key record");if("/pk/"!==(0,uh.d)(e.subarray(0,4)))throw new uC("key was not prefixed with /pk/");let r=ya(t);if(!rr(e.slice(4),r.toMultihash().bytes))throw new uC("public key does not match passed in key")}},RD=(0,nm.s)("/pk/");function RB(e){return{...e,multiaddrs:e.multiaddrs.filter(e=>{let[[t,r]]=e.stringTuples();if(53===t||54===t||55===t)return"localhost"!==r;if(4!==t&&6!==t||null==r)return!1;let n=ww(r);return null==n||!n})}}async function RM(e){return(await nK.sha256.digest(e)).digest}async function RL(e){return RM(e.toMultihash().bytes)}function RF(e,t){return new Es.U(`${e}/${(0,uh.d)(t,"base32")}`,!1)}function RU(e){return rt([RD,e.toMultihash().bytes])}function Rj(e){return"/pk/"===(0,uh.d)(e.subarray(0,4))}function R$(e){return yO(aG.decode(e.subarray(4)))}function RH(e,t){return new Rb(e,t,new Date).serialize()}let Rq=290,Rz=54,RV=55,RK=56,RG=4,RW=41;function RQ(e){let t=e.stringTuples();for(let e of t)if(e[0]===Rq)return!1;if(t[0][0]===Rz||t[0][0]===RV||t[0][0]===RK)return!0;if(t[0][0]===RG||t[0][0]===RW){let e=ww(`${t[0][1]}`);return null==e||!e}return!1}function RJ(e){let t=e.toString().split("/"),r=t.pop(),n=t.pop();if(null==r||null==n)throw Error(`incorrectly formatted provider entry key in datastore: ${e.toString()}`);return{cid:rc.TO.createV1(nz.code,aG.decode((0,nm.s)(n,"base32"))),peerId:yT(r)}}function RZ(e,t,r){let n=[e,"string"==typeof t?t:(0,uh.d)(t.multihash.bytes,"base32")];return null!=r&&n.push(r.toString()),new Es.U(n.join("/"))}function RY(e){return new Date(r4(e))}function RX(e,t,r){return async function*(...n){let i=t.queryTime?.timer(r),s=t.errorTime?.timer(r),o=!1;try{t.queries?.increment({[r]:!0}),yield*e(...n)}catch(e){throw o=!0,s?.(),t.errors?.increment({[r]:!0}),e}finally{t.queries?.decrement({[r]:!0}),o||i?.()}}}function R0(e,t,r){return async function(...n){let i=t?.queryTime?.timer(r),s=t?.errorTime?.timer(r),o=!1;try{return t.queries?.increment({[r]:!0}),await e(...n)}catch(e){throw o=!0,s?.(),t.errors?.increment({[r]:!0}),e}finally{t.queries?.decrement({[r]:!0}),o||i?.()}}}class R1{log;components;validators;selectors;peerRouting;queryManager;network;datastorePrefix;constructor(e,t){let{validators:r,selectors:n,peerRouting:i,queryManager:s,network:o,logPrefix:a}=t;this.components=e,this.log=e.logger.forComponent(`${a}:content-fetching`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=r,this.selectors=n,this.peerRouting=i,this.queryManager=s,this.network=o,this.get=e.metrics?.traceFunction("libp2p.kadDHT.get",this.get.bind(this),{optionsIndex:1})??this.get,this.put=e.metrics?.traceFunction("libp2p.kadDHT.put",this.put.bind(this),{optionsIndex:2})??this.put}async getLocal(e){this.log("getLocal %b",e);let t=RF(this.datastorePrefix,e);this.log("fetching record for key %k",t);let r=await this.components.datastore.get(t);this.log("found %k in local datastore",t);let n=Rb.deserialize(r);return await RO(this.validators,n),n}async *sendCorrectionRecord(e,t,r,n={}){this.log("sendCorrection for %b",e);let i=RH(e,r);for(let{value:s,from:o}of t){if(rr(s,r)){this.log("record was ok");continue}if(this.components.peerId.equals(o)){try{let t=RF(this.datastorePrefix,e);this.log(`Storing corrected record for key ${t.toString()}`),await this.components.datastore.put(t,i.subarray())}catch(e){this.log.error("Failed error correcting self",e)}continue}let t=!1,a={type:eO.PUT_VALUE,key:e,record:i};for await(let e of this.network.sendRequest(o,a,n))"PEER_RESPONSE"===e.name&&null!=e.record&&rr(e.record.value,Rb.deserialize(i).value)&&(t=!0),yield e;t||(yield R_({from:o,error:new Rw("Value not put correctly")},n)),this.log.error("Failed error correcting entry")}}async *put(e,t,r={}){this.log("put key %b value %b",e,t);let n=RH(e,t),i=RF(this.datastorePrefix,e);this.log(`storing record for key ${i.toString()}`),await this.components.datastore.put(i,n.subarray()),yield*(0,lr.F)(this.peerRouting.getClosestPeers(e,{...r,signal:r.signal}),t=>(0,a7.A)(t,t=>async()=>{if("FINAL_PEER"!==t.name)return[t];let i=[],s={type:eO.PUT_VALUE,key:e,record:n};for await(let e of(this.log("send put to %p",t.peer.id),this.network.sendRequest(t.peer.id,s,r)))i.push(e),"PEER_RESPONSE"===e.name&&(null!=e.record&&rr(e.record.value,Rb.deserialize(n).value)||i.push(R_({from:t.peer.id,error:new Rw("Value not put correctly")},r)));return i}),e=>lt(e,{ordered:!1,concurrency:Rl}),async function*(e){for await(let t of e)yield*t})}async *get(e,t={}){this.log("get %b",e);let r=[];for await(let n of this.getMany(e,t))"VALUE"===n.name&&r.push(n),yield n;if(0===r.length)return;let n=r.map(e=>e.value),i=0;try{i=RP(this.selectors,e,n)}catch(e){if("InvalidParametersError"!==e.name)throw e}let s=n[i];if(this.log("GetValue %b %b",e,s),null==s)throw new uL("Best value was not found");yield*this.sendCorrectionRecord(e,r,s,t),yield r[i]}async *getMany(e,t={}){this.log("getMany values for %b",e);try{let r=await this.getLocal(e);yield RC({value:r.value,from:this.components.peerId},t)}catch(t){this.log("error getting local value for %b",e,t)}let r=this,n=async function*({peer:n,signal:i}){for await(let s of r.peerRouting.getValueOrPeers(n,e,{...t,signal:i}))yield s,"PEER_RESPONSE"===s.name&&null!=s.record&&(yield RC({from:n,value:s.record.value},t))};yield*this.queryManager.run(e,n,t)}}function R2(e,t){return{id:e.id.toMultihash().bytes,multiaddrs:(e.multiaddrs??[]).map(e=>e.bytes),connection:t}}function R3(e){if(null==e.id)throw Error("Invalid peer in message");return{id:yO(aG.decode(e.id)),multiaddrs:(e.multiaddrs??[]).map(e=>wt(e))}}class R4{log;components;network;peerRouting;queryManager;routingTable;providers;constructor(e,t){let{network:r,peerRouting:n,queryManager:i,routingTable:s,providers:o,logPrefix:a}=t;this.components=e,this.log=e.logger.forComponent(`${a}:content-routing`),this.network=r,this.peerRouting=n,this.queryManager=i,this.routingTable=s,this.providers=o,this.findProviders=e.metrics?.traceFunction("libp2p.kadDHT.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(e,t)=>("PROVIDER"===e.name&&(t.providers??=[],t.providers.push(...e.providers.map(e=>e.id.toString()))),t)})??this.findProviders,this.provide=e.metrics?.traceFunction("libp2p.kadDHT.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(e,t)=>("PEER_RESPONSE"===e.name&&"ADD_PROVIDER"===e.messageName&&(t.providers??=[],t.providers.push(e.from.toString())),t)})??this.provide}async *provide(e,t,r={}){this.log("provide %s",e);let n=e.multihash.bytes;await this.providers.addProvider(e,this.components.peerId);let i={type:eO.ADD_PROVIDER,key:n,providers:[R2({id:this.components.peerId,multiaddrs:t})]},s=0,o=t=>async()=>{if("FINAL_PEER"!==t.name)return[t];let n=[];this.log("putProvider %s to %p",e,t.peer.id);try{for await(let o of(this.log("sending provider record for %s to %p",e,t.peer.id),this.network.sendMessage(t.peer.id,i,r)))"PEER_RESPONSE"===o.name&&(this.log("sent provider record for %s to %p",e,t.peer.id),s++),n.push(o)}catch(e){this.log.error("error sending provide record to peer %p",t.peer.id,e),n.push(R_({from:t.peer.id,error:e},r))}return n};yield*(0,lr.F)(this.peerRouting.getClosestPeers(n,r),e=>(0,a7.A)(e,e=>o(e)),e=>lt(e,{ordered:!1,concurrency:Rl}),async function*(e){for await(let t of e)yield*t}),this.log("sent provider records to %d peers",s)}async *findProviders(e,t){let r=this.routingTable.kBucketSize,n=0,i=e.multihash.bytes,s=this;this.log("findProviders %c",e);let o=await this.providers.getProviders(e);if(o.length>0){let e=[];for(let t of o.slice(0,r))try{let r=await this.components.peerStore.get(t);e.push({id:t,multiaddrs:r.addresses.map(({multiaddr:e})=>e)})}catch(e){if("NotFoundError"!==e.name)throw e;this.log("no peer store entry for %p",t)}if(yield RS({from:this.components.peerId,messageType:eO.GET_PROVIDERS,providers:e},t),yield RI({from:this.components.peerId,providers:e},t),(n+=e.length)>=r)return}let a=async function*({peer:e,signal:r}){let n={type:eO.GET_PROVIDERS,key:i};yield*s.network.sendRequest(e,n,{...t,signal:r})},l=new xw(o);for await(let s of this.queryManager.run(i,a,t))if(yield s,"PEER_RESPONSE"===s.name){this.log("Found %d provider entries for %c and %d closer peers",s.providers.length,e,s.closer.length);let i=[];for(let e of s.providers)l.has(e.id)||(l.add(e.id),i.push(e));if(i.length>0&&(yield RI({from:s.from,providers:i},t),(n+=i.length)>=r))return}}}class R5 extends uS{log;protocol;running;components;timeout;metrics;constructor(e,t){super(),this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:network`),this.running=!1,this.protocol=t.protocol,this.timeout=new k$({...t.timeout??{},metrics:e.metrics,metricName:`${t.metricsPrefix}_network_message_send_times_milliseconds`}),this.metrics={operations:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_outbound_rpc_requests_total`),errors:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_outbound_rpc_errors_total`)},this.sendRequest=e.metrics?.traceFunction("libp2p.kadDHT.sendRequest",this.sendRequest.bind(this),{optionsIndex:2,getAttributesFromArgs:([e,t],r)=>({...r,to:e.toString(),"message type":`${t.type}`}),getAttributesFromYieldedValue:(e,t)=>("PEER_RESPONSE"===e.name&&(e.providers.length>0&&e.providers.forEach((e,r)=>{t[`providers-${r}`]=e.id.toString()}),e.closer.length>0&&e.closer.forEach((e,r)=>{t[`closer-${r}`]=e.id.toString()})),t)})??this.sendRequest,this.sendMessage=e.metrics?.traceFunction("libp2p.kadDHT.sendMessage",this.sendMessage.bind(this),{optionsIndex:2,getAttributesFromArgs:([e,t],r)=>({...r,to:e.toString(),"message type":`${t.type}`}),getAttributesFromYieldedValue:(e,t)=>("PEER_RESPONSE"===e.name&&(e.providers.length>0&&e.providers.forEach((e,r)=>{t[`providers-${r}`]=e.id.toString()}),e.closer.length>0&&e.closer.forEach((e,r)=>{t[`closer-${r}`]=e.id.toString()})),t)})??this.sendMessage}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async *sendRequest(e,t,r={}){let n;if(!this.running)return;let i=t.type;if(null==i)throw new uC("Message type was missing");this.log("sending %s to %p",t.type,e),yield RT({peer:e},r),yield Rx({to:e,type:i},r);let s=this.timeout.getTimeoutSignal(r);r={...r,signal:s};try{this.metrics.operations?.increment({[i]:!0});let s=await this.components.connectionManager.openConnection(e,r);n=await s.newStream(this.protocol,r);let o=await this._writeReadMessage(n,t,r);n.close(r).catch(t=>{this.log.error("error closing stream to %p",e,t),n?.abort(t)}),yield RS({from:e,messageType:o.type,closer:o.closer.map(R3),providers:o.providers.map(R3),record:null==o.record?void 0:Rb.deserialize(o.record)},r)}catch(s){this.metrics.errors?.increment({[i]:!0}),n?.abort(s),r.signal?.aborted!==!0&&this.log.error("could not send %s to %p - %e",t.type,e,s),yield R_({from:e,error:s},r)}finally{this.timeout.cleanUp(s)}}async *sendMessage(e,t,r={}){let n;if(!this.running)return;let i=t.type;if(null==i)throw new uC("Message type was missing");this.log("sending %s to %p",t.type,e),yield RT({peer:e},r),yield Rx({to:e,type:i},r);let s=this.timeout.getTimeoutSignal(r);r={...r,signal:s};try{this.metrics.operations?.increment({[i]:!0});let s=await this.components.connectionManager.openConnection(e,r);n=await s.newStream(this.protocol,r),await this._writeMessage(n,t,r),n.close(r).catch(t=>{this.log.error("error closing stream to %p",e,t),n?.abort(t)}),yield RS({from:e,messageType:i},r)}catch(t){this.metrics.errors?.increment({[i]:!0}),n?.abort(t),yield R_({from:e,error:t},r)}finally{this.timeout.cleanUp(s)}}async _writeMessage(e,t,r){let n=Tv(e);await n.write(t,eL,r)}async _writeReadMessage(e,t,r){let n=Tv(e);await n.write(t,eL,r);let i=await n.read(eL,r);return i.closer.forEach(e=>{this.safeDispatchEvent("peer",{detail:R3(e)})}),i.providers.forEach(e=>{this.safeDispatchEvent("peer",{detail:R3(e)})}),i}}function R6(e,t){if(e.length!==t.length)throw Error("Inputs should have the same length");let r=(0,t9.K)(e.length);for(let n=0;n<e.length;n++)r[n]=e[n]^t[n];return re(r)}function R8(e,t){if(e.byteLength!==t.byteLength)throw Error("Inputs should have the same length");for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}class R7{originDhtKey;capacity;peerDistances;constructor(e,t){this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(e=>e.peer)}async add(e){let t=await RL(e.id);this.addWithKadId(e,t)}addWithKadId(e,t){if(null!=this.peerDistances.find(t=>t.peer.id.equals(e.id)))return;let r={peer:e,distance:R6(this.originDhtKey,t)},n=!1;for(let e=0;e<this.peerDistances.length;e++){let t=R8(this.peerDistances[e].distance,r.distance);if(0===t||1===t){n=!0,this.peerDistances.splice(e,0,r);break}}n||this.peerDistances.push(r),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async isCloser(e){return 0===this.length||-1===R8(R6(await RL(e),this.originDhtKey),this.peerDistances[this.peerDistances.length-1].distance)}async anyCloser(e){return 0!==e.length&&Promise.any(e.map(async e=>this.isCloser(e)))}}class R9{log;routingTable;network;validators;queryManager;peerStore;peerId;constructor(e,t){this.routingTable=t.routingTable,this.network=t.network,this.validators=t.validators,this.queryManager=t.queryManager,this.peerStore=e.peerStore,this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:peer-routing`),this.findPeer=e.metrics?.traceFunction("libp2p.kadDHT.findPeer",this.findPeer.bind(this),{optionsIndex:1})??this.findPeer,this.getClosestPeers=e.metrics?.traceFunction("libp2p.kadDHT.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1})??this.getClosestPeers}async findPeerLocal(e){let t,r=await this.routingTable.find(e);if(null!=r){this.log("findPeerLocal found %p in routing table",e);try{t=await this.peerStore.get(r)}catch(e){if("NotFoundError"!==e.name)throw e}}if(null==t)try{t=await this.peerStore.get(e)}catch(e){if("NotFoundError"!==e.name)throw e}if(null!=t)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map(e=>e.multiaddr)}}async *_getValueSingle(e,t,r={}){let n={type:eO.GET_VALUE,key:t};yield*this.network.sendRequest(e,n,r)}async *getPublicKeyFromNode(e,t={}){let r=RU(e);for await(let n of this._getValueSingle(e,r,t))if(yield n,"PEER_RESPONSE"===n.name&&null!=n.record){let r=yP(ya(n.record.value));if(!r.equals(e))throw new uT("public key does not match id");if(null==r.publicKey)throw new uT("public key missing");yield RC({from:e,value:n.record.value},t)}throw new Rw(`Node not responding with its public key: ${e.toString()}`)}async *findPeer(e,t={}){if(this.log("findPeer %p",e),!1!==t.useCache){let r=await this.findPeerLocal(e);if(null!=r){this.log("found local"),yield Rk({from:this.peerId,peer:r},t);return}}let r=!1;if(!1!==t.useNetwork){let n=this,i=async function*({peer:r,signal:i}){let s={type:eO.FIND_NODE,key:e.toMultihash().bytes};for await(let o of n.network.sendRequest(r,s,{...t,signal:i}))if(yield o,"PEER_RESPONSE"===o.name){let r=o.closer.find(t=>t.id.equals(e));null!=r&&(yield Rk({from:o.from,peer:r},t))}};for await(let n of this.queryManager.run(e.toMultihash().bytes,i,t))"FINAL_PEER"===n.name&&(r=!0),yield n}r||(yield R_({from:this.peerId,error:new uL("Not found")},t))}async *getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);let r=await RM(e),n=this.routingTable.closestPeers(r),i=this,s=new R7(r,this.routingTable.kBucketSize);await Promise.all(n.map(async e=>{await s.add({id:e,multiaddrs:[]})}));let o=async function*({peer:r,signal:n}){i.log("closerPeersSingle %s from %p",(0,uh.d)(e,"base32"),r);let s={type:eO.FIND_NODE,key:e};yield*i.network.sendRequest(r,s,{...t,signal:n})};for await(let r of this.queryManager.run(e,o,t))"PEER_RESPONSE"===r.name&&await Promise.all(r.closer.map(async e=>{await s.add(e)})),yield r;for(let r of(this.log("found %d peers close to %b",s.length,e),s.peers))yield Rk({from:this.peerId,peer:r},t)}async *getValueOrPeers(e,t,r={}){for await(let n of this._getValueSingle(e,t,r)){if("PEER_RESPONSE"===n.name&&null!=n.record)try{await this._verifyRecordOnline(n.record)}catch(t){let e="invalid record received, discarded";this.log(e),yield R_({from:n.from,error:new Rw(e)},r);continue}yield n}}async _verifyRecordOnline(e){if(null==e.timeReceived)throw new RE("invalid record received");await RO(this.validators,new Rb(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){let r=[];try{let t=aG.decode(e),n=yO(t),i=await this.peerStore.get(n);r.push({id:i.id,multiaddrs:i.addresses.map(({multiaddr:e})=>e)})}catch{}let n=await RM(e),i=this.routingTable.closestPeers(n),s=R6(await RL(t),n);for(let e of i)if(-1===R8(R6(await RL(e),n),s))try{let t=await this.peerStore.get(e);r.push({id:e,multiaddrs:t.addresses.map(({multiaddr:e})=>e)})}catch(e){if("NotFoundError"!==e.name)throw e}return r.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",r.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p with %d peers in the routing table",e,t,this.routingTable.size),r}}class Oe{log;datastore;datastorePrefix;lock;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:providers`),this.datastorePrefix=`${t.datastorePrefix}/provider`,this.datastore=e.datastore,this.lock=t.lock}async addProvider(e,t){let r=await this.lock.readLock();try{this.log("%p provides %s",t,e),await this.writeProviderEntry(e,t)}finally{r()}}async removeProvider(e,t){let r=await this.lock.writeLock();try{let r=RZ(this.datastorePrefix,e,t);this.log("%p no longer provides %s",t,e),await this.datastore.delete(r)}finally{r()}}async getProviders(e){let t=await this.lock.readLock();try{this.log("get providers for %c",e);let t=await this.loadProviders(e);return this.log("got %d providers for %c",t.size,e),[...t.keys()]}finally{t()}}async writeProviderEntry(e,t,r=new Date){let n=RZ(this.datastorePrefix,e,t),i=r3(r.getTime());await this.datastore.put(n,i)}async loadProviders(e){let t=new yF,r=RZ(this.datastorePrefix,e);for await(let e of this.datastore.query({prefix:r.toString()})){let{peerId:r}=RJ(e.key);t.set(r,RY(e.value))}return t}}async function*Ot(e){let{key:t,startingPeer:r,ourPeerId:n,signal:i,query:s,alpha:o,pathIndex:a,numPaths:l,queryFuncTimeout:c,log:u,peersSeen:h,connectionManager:d}=e,f=new u8({concurrency:o,sort:(e,t)=>R8(e.options.distance,t.options.distance)}),p=await RM(t);function g(r,o){if(null==r)return;h.add(r);let m=R6(o,p);f.add(async()=>{let o=[i];null!=c&&o.push(AbortSignal.timeout(c));let y=hQ(o);try{for await(let i of s({...e,key:t,peer:r,signal:y,pathIndex:a,numPaths:l})){if(y.aborted)return;if("PEER_RESPONSE"===i.name)for(let e of i.closer){if(h.has(e.id)){u.trace("already seen %p in query",e.id);continue}if(n.equals(e.id)){u("not querying ourselves");continue}if(!await d.isDialable(e.multiaddrs)){u("not querying undialable peer");continue}let i=await RL(e.id),s=R6(i,p);if(-1!==R8(s,m)){u.trace("skipping %p as they are not closer to %b than %p",e.id,t,r);continue}u.trace("querying closer peer %p",e.id),g(e.id,i)}f.safeDispatchEvent("completed",{detail:i})}}catch(t){if(!i.aborted)return R_({from:r,error:t},e)}finally{y.clear()}},{distance:m}).catch(e=>{u.error(e)})}g(r,await RL(r));try{for await(let e of f.toGenerator({signal:i}))null!=e&&(yield e)}catch(e){if(i.aborted)throw new Rv("Query aborted");throw e}}class Or{disjointPaths;alpha;shutDownController;running;logger;peerId;connectionManager;routingTable;initialQuerySelfHasRun;logPrefix;constructor(e,t){this.logPrefix=t.logPrefix,this.disjointPaths=t.disjointPaths??Ra,this.alpha=t.alpha??Rl,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.logger=e.logger,this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.shutDownController=new AbortController,this.shutDownController.signal,this.running=!1}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.shutDownController=new AbortController,this.shutDownController.signal)}async stop(){this.running=!1,this.shutDownController.abort()}async *run(e,t,r={}){if(!this.running)throw Error("QueryManager not started");if(null==r.signal){let e=AbortSignal.timeout(Rp);r={...r,signal:e}}let n=new AbortController,i=hQ([this.shutDownController.signal,n.signal,r.signal]);n.signal;let s=this.logger.forComponent(`${this.logPrefix}:query:`+(0,uh.d)(e,"base58btc")),o=!1;try{!0!==r.isSelfQuery&&null!=this.initialQuerySelfHasRun&&(s("waiting for initial query-self query before continuing"),await (0,u3.W)(this.initialQuerySelfHasRun.promise,i),this.initialQuerySelfHasRun=void 0),s("query:start");let n=await RM(e),a=this.routingTable.closestPeers(n),l=a.slice(0,Math.min(this.disjointPaths,a.length));if(0===a.length)return void s.error("Running query with no peers");let c=new xw,u=l.map((n,o)=>Ot({...r,key:e,startingPeer:n,ourPeerId:this.peerId,signal:i,query:t,pathIndex:o,numPaths:l.length,alpha:this.alpha,queryFuncTimeout:r.queryFuncTimeout,log:s,peersSeen:c,onProgress:r.onProgress,connectionManager:this.connectionManager}));for await(let e of(0,hw.A)(...u)){if("QUERY_ERROR"===e.name&&s.error("query error",e.error),"PEER_RESPONSE"===e.name)for(let t of[...e.closer,...e.providers])await this.connectionManager.isDialable(t.multiaddrs)&&await this.routingTable.add(t.id);yield e}o=!0}catch(e){if(this.running||"QueryAbortedError"!==e.name)throw e}finally{o||(s("query exited early"),n.abort()),i.clear(),s("query:done")}}}function On(e){return null!=e[Symbol.asyncIterator]}let Oi=function(e){if(On(e))return(async()=>{let t=0;for await(let r of e)t++;return t})();{let t=0;for(let r of e)t++;return t}},Os=e=>{let t=e.addEventListener||e.on||e.addListener,r=e.removeEventListener||e.off||e.removeListener;if(!t||!r)throw TypeError("Emitter is not compatible");return{addListener:t.bind(e),removeListener:r.bind(e)}};function Oo(e,t,r){let n,i=new Promise((i,s)=>{if(!((r={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...r}).count>=0&&(r.count===Number.POSITIVE_INFINITY||Number.isInteger(r.count))))throw TypeError("The `count` option should be at least 0 or more");r.signal?.throwIfAborted();let o=[t].flat(),a=[],{addListener:l,removeListener:c}=Os(e),u=(...e)=>{let t=r.multiArgs?e:e[0];(!r.filter||r.filter(t))&&(a.push(t),r.count===a.length&&(n(),i(a)))},h=e=>{n(),s(e)};for(let e of(n=()=>{for(let e of o)c(e,u);for(let e of r.rejectionEvents)c(e,h)},o))l(e,u);for(let e of r.rejectionEvents)l(e,h);r.signal&&r.signal.addEventListener("abort",()=>{h(r.signal.reason)},{once:!0}),r.resolveImmediately&&i(a)});if(i.cancel=n,"number"==typeof r.timeout){let e=lu(i,{milliseconds:r.timeout});return e.cancel=n,e}return i}function Oa(e,t,r){"function"==typeof r&&(r={filter:r});let n=Oo(e,t,r={...r,count:1,resolveImmediately:!1}),i=n.then(e=>e[0]);return i.cancel=n.cancel,i}class Ol{log;peerId;peerRouting;routingTable;count;interval;initialInterval;queryTimeout;running;timeoutId;controller;initialQuerySelfHasRun;querySelfPromise;constructor(e,t){this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:query-self`),this.running=!1,this.peerRouting=t.peerRouting,this.routingTable=t.routingTable,this.count=t.count??Ra,this.interval=t.interval??Rc,this.initialInterval=t.initialInterval??Ru,this.queryTimeout=t.queryTimeout??Rh,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.querySelf=R0(this.querySelf.bind(this),t.operationMetrics,"SELF_QUERY")}isStarted(){return this.running}start(){this.running||(this.running=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.initialInterval))}stop(){this.running=!1,null!=this.timeoutId&&clearTimeout(this.timeoutId),null!=this.controller&&this.controller.abort()}async querySelf(){if(!this.running)return void this.log("skip self-query because we are not started");if(null!=this.querySelfPromise)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=(0,a9.A)(),this.running){this.controller=new AbortController;let e=[this.controller.signal];if(null==this.initialQuerySelfHasRun){let t=AbortSignal.timeout(this.queryTimeout);e.push(t)}let t=hQ(e);this.controller.signal;try{0===this.routingTable.size&&(this.log("routing table was empty, waiting for some peers before running query"),await Oa(this.routingTable,"peer:add",{signal:t,filter:e=>!this.peerId.equals(e.detail)}),this.log("routing table has peers, continuing with query")),this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);let e=Date.now(),r=await (0,lr.F)(this.peerRouting.getClosestPeers(this.peerId.toMultihash().bytes,{signal:t,isSelfQuery:!0}),e=>(0,dg.A)(e,this.count),async e=>Oi(e));this.log("self-query found %d peers in %dms",r,Date.now()-e)}catch(e){this.log.error("self-query error",e)}finally{t.clear(),null!=this.initialQuerySelfHasRun&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.running&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.interval))}}class Oc extends uS{log;reprovideQueue;maxQueueSize;datastore;timeout;reprovideTimeout;running;shutdownController;reprovideThreshold;contentRouting;datastorePrefix;addressManager;validity;interval;lock;peerId;constructor(e,t){super(),this.log=e.logger.forComponent(`${t.logPrefix}:reprovider`),this.peerId=e.peerId,this.reprovideQueue=new u8({concurrency:t.concurrency??Ri,metrics:e.metrics,metricName:`${t.metricsPrefix}_reprovide_queue`}),this.reprovideTimeout=new k$({...t.timeout??{},metrics:e.metrics,metricName:`${t.metricsPrefix}_reprovide_timeout_milliseconds`}),this.datastore=e.datastore,this.addressManager=e.addressManager,this.datastorePrefix=`${t.datastorePrefix}/provider`,this.reprovideThreshold=t.threshold??Rn,this.maxQueueSize=t.maxQueueSize??Rs,this.validity=t.validity??Rr,this.interval=t.interval??Ro,this.contentRouting=t.contentRouting,this.lock=t.lock,this.running=!1,this.reprovide=R0(this.reprovide.bind(this),t.operationMetrics,"PROVIDE")}start(){this.running||(this.running=!0,this.shutdownController=new AbortController,this.shutdownController.signal,this.timeout=setTimeout(()=>{this.cleanUp().catch(e=>{this.log.error("error running reprovide/cleanup - %e",e)})},this.interval))}stop(){this.running=!1,this.reprovideQueue.clear(),clearTimeout(this.timeout),this.shutdownController?.abort()}async cleanUp(){let e=await this.lock.writeLock();try{for await(let e of(this.safeDispatchEvent("reprovide:start"),this.datastore.query({prefix:this.datastorePrefix})))try{let{cid:t,peerId:r}=RJ(e.key),n=RY(e.value).getTime(),i=n+this.validity,s=Date.now(),o=s>i;this.log.trace("comparing: %d < %d = %s %s",n,s-this.validity,o,o?"(expired)":""),o&&await this.datastore.delete(e.key),this.peerId.equals(r)&&s-i<this.reprovideThreshold&&this.queueReprovide(t).catch(e=>{this.log.error("could not reprovide %c - %e",t,e)})}catch(t){this.log.error("error processing datastore key %s - %e",e.key,t.message)}this.log("reprovide/cleanup successful")}finally{e(),this.safeDispatchEvent("reprovide:end"),this.running&&(this.timeout=setTimeout(()=>{this.cleanUp().catch(e=>{this.log.error("error running re-provide - %e",e)})},this.interval))}}async queueReprovide(e){if(!this.running)return;this.log.trace("waiting for queue capacity before adding %c to re-provide queue",e),await this.reprovideQueue.onSizeLessThan(this.maxQueueSize);let t=this.reprovideQueue.queue.find(t=>t.options.cid.equals(e));if(null!=t)return this.log.trace("not adding %c to re-provide queue - already in queue",e),t.join();this.log.trace("adding %c to re-provide queue",e),this.reprovideQueue.add(async t=>{if(t.signal?.throwIfAborted(),!this.running)return;this.log.trace("re-providing %c",e);let r=this.reprovideTimeout.getTimeoutSignal(t);try{await this.reprovide(t.cid,t)}finally{this.reprovideTimeout.cleanUp(r)}this.log.trace("re-provided %c",e)},{signal:this.shutdownController?.signal,cid:e}).catch(t=>{this.log.error("could not re-provide key %c - %e",e,t)})}async reprovide(e,t){await (0,ux.A)(this.contentRouting.provide(e,this.addressManager.getAddresses(),t))}}let Ou=20,Oh=5e3,Od="kad-close",Of=50;class Op{routingTable;components;closestPeers;newPeers;refreshInterval;peerSetSize;timeout;closeTagName;closeTagValue;log;running;constructor(e,t){this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.routingTable=t.routingTable,this.refreshInterval=t.refreshInterval??Oh,this.peerSetSize=t.peerSetSize??Ou,this.closeTagName=t.closeTagName??Od,this.closeTagValue=t.closeTagValue??Of,this.closestPeers=new xw,this.onPeerPing=this.onPeerPing.bind(this),this.running=!1}async start(){if(this.running)return;this.running=!0;let e=await RL(this.components.peerId);this.newPeers=new R7(e,this.peerSetSize),this.routingTable.addEventListener("peer:ping",this.onPeerPing),this.timeout=setInterval(()=>{this.updatePeerTags().catch(e=>{this.log.error("error updating peer tags - %e",e)})},this.refreshInterval)}stop(){this.running=!1,this.routingTable.removeEventListener("peer:ping",this.onPeerPing),clearTimeout(this.timeout)}onPeerPing(e){this.newPeers?.add({id:e.detail,multiaddrs:[]}).catch(e=>{this.log.error("error adding peer to distance list - %e",e)})}async updatePeerTags(){let e=new xw(this.newPeers?.peers.map(e=>e.id)),t=e.difference(this.closestPeers),r=this.closestPeers.difference(e);this.closestPeers=e,await Promise.all([...[...t].map(async e=>{await this.components.peerStore.merge(e,{tags:{[this.closeTagName]:{value:this.closeTagValue},[Rg]:{value:1}}})}),...[...r].map(async e=>{await this.components.peerStore.merge(e,{tags:{[this.closeTagName]:void 0,[Rg]:void 0}})})])}}function Og(e){return Array.isArray(e?.peers)}class Om{root;localPeer;prefixLength;splitThreshold;kBucketSize;numberOfNodesToPing;lastPingThreshold;ping;verify;onAdd;onRemove;onMove;addingPeerMap;constructor(e){this.prefixLength=e.prefixLength??Ov,this.kBucketSize=e.kBucketSize??Ow,this.splitThreshold=e.splitThreshold??this.kBucketSize,this.numberOfNodesToPing=e.numberOfOldContactsToPing??Ox,this.lastPingThreshold=e.lastPingThreshold??OC,this.ping=e.ping,this.verify=e.verify,this.onAdd=e.onAdd,this.onRemove=e.onRemove,this.addingPeerMap=new yF,this.root={prefix:"",depth:0,peers:[]}}async addSelfPeer(e){this.localPeer={peerId:e,kadId:await RL(e),lastPing:Date.now()}}async add(e,t){let r={peerId:e,kadId:await RL(e),lastPing:0},n=this.addingPeerMap.get(e);if(null!=n)return n;try{let n=this._add(r,t);this.addingPeerMap.set(e,n),await n}finally{this.addingPeerMap.delete(e)}}async _add(e,t){let r=this._determineBucket(e.kadId);if(this._indexOf(r,e.kadId)>-1)return;if(r.peers.length===this.splitThreshold&&r.depth<this.prefixLength){await this._split(r),await this._add(e,t);return}if(r.peers.length<this.kBucketSize){if(!Ob(e,this.lastPingThreshold)){r.peers.push(e),await this.onAdd?.(e,r);return}await this.verify(e,t)&&(e.lastPing=Date.now(),await this._add(e,t));return}let n=r.peers.filter(e=>!(e.peerId.equals(this.localPeer?.peerId)||e.lastPing>Date.now()-this.lastPingThreshold)).sort((e,t)=>e.lastPing<t.lastPing?-1:+(e.lastPing>t.lastPing)).slice(0,this.numberOfNodesToPing),i=!1;for await(let e of this.ping(n,t))i=!0,await this.remove(e.kadId);i&&await this._add(e,t)}*closest(e,t=this.kBucketSize){let r=new R7(e,t);for(let e of this.toIterable())r.addWithKadId({id:e.peerId,multiaddrs:[]},e.kadId);yield*(0,a7.A)(r.peers,e=>e.id)}count(){function e(t){if(Og(t))return t.peers.length;let r=0;return null!=t.left&&(r+=e(t.left)),null!=t.right&&(r+=e(t.right)),r}return e(this.root)}get(e){let t=this._determineBucket(e),r=this._indexOf(t,e);return t.peers[r]}async remove(e){let t=this._determineBucket(e),r=this._indexOf(t,e);if(r>-1){let e=t.peers.splice(r,1)[0];await this.onRemove?.(e,t)}}*toIterable(){function*e(t){if(Og(t))return void(yield*t.peers);yield*e(t.left),yield*e(t.right)}yield*e(this.root)}distance(e,t){return BigInt("0x"+(0,uh.d)(R6(e,t),"base16"))}_determineBucket(e){let t=(0,uh.d)(e,"base2");function r(e,n=0){return Og(e)?e:"0"===t[n]?r(e.left,n+1):r(e.right,n+1)}return r(this.root)}_indexOf(e,t){return e.peers.findIndex(e=>rr(e.kadId,t))}async _split(e){let t={prefix:"0",depth:e.depth+1,peers:[]},r={prefix:"1",depth:e.depth+1,peers:[]};for(let n of e.peers)"0"===(0,uh.d)(n.kadId,"base2")[e.depth]?(t.peers.push(n),await this.onMove?.(n,e,t)):(r.peers.push(n),await this.onMove?.(n,e,r));Oy(e,t,r)}}function Oy(e,t,r){return delete e.peers,e.left=t,e.right=r,""===e.prefix&&(delete e.depth,delete e.prefix),!0}function Ob(e,t){return e.lastPing<Date.now()-t}let Ow=20,Ov=6,OE=20,OA=100,Ox=3,OS=20,Ok=100,O_="kad-peer",OI=1,OC=6e5,OT=!0,OP=1e3;class OR extends uS{kBucketSize;kb;network;closestPeerTagger;log;components;running;pingNewContactTimeout;pingNewContactQueue;pingOldContactTimeout;pingOldContactQueue;populateFromDatastoreOnStart;populateFromDatastoreLimit;protocol;peerTagName;peerTagValue;metrics;constructor(e,t){super(),this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.kBucketSize=t.kBucketSize??Ow,this.running=!1,this.protocol=t.protocol,this.network=t.network,this.peerTagName=t.peerTagName??O_,this.peerTagValue=t.peerTagValue??OI,this.pingOldContacts=this.pingOldContacts.bind(this),this.verifyNewContact=this.verifyNewContact.bind(this),this.peerAdded=this.peerAdded.bind(this),this.peerRemoved=this.peerRemoved.bind(this),this.populateFromDatastoreOnStart=t.populateFromDatastoreOnStart??OT,this.populateFromDatastoreLimit=t.populateFromDatastoreLimit??OP,this.pingOldContactQueue=new hb({concurrency:t.pingOldContactConcurrency??OS,metricName:`${t.metricsPrefix}_ping_old_contact_queue`,metrics:this.components.metrics,maxSize:t.pingOldContactMaxQueueSize??Ok}),this.pingOldContactTimeout=new k$({...t.pingOldContactTimeout??{},metrics:this.components.metrics,metricName:`${t.metricsPrefix}_routing_table_ping_old_contact_time_milliseconds`}),this.pingNewContactQueue=new hb({concurrency:t.pingNewContactConcurrency??OE,metricName:`${t.metricsPrefix}_ping_new_contact_queue`,metrics:this.components.metrics,maxSize:t.pingNewContactMaxQueueSize??OA}),this.pingNewContactTimeout=new k$({...t.pingNewContactTimeout??{},metrics:this.components.metrics,metricName:`${t.metricsPrefix}_routing_table_ping_new_contact_time_milliseconds`}),this.kb=new Om({kBucketSize:t.kBucketSize,prefixLength:t.prefixLength,splitThreshold:t.splitThreshold,numberOfOldContactsToPing:t.numberOfOldContactsToPing,lastPingThreshold:t.lastPingThreshold,ping:this.pingOldContacts,verify:this.verifyNewContact,onAdd:this.peerAdded,onRemove:this.peerRemoved}),this.closestPeerTagger=new Op(this.components,{logPrefix:t.logPrefix,routingTable:this,peerSetSize:t.closestPeerSetSize,refreshInterval:t.closestPeerSetRefreshInterval,closeTagName:t.closeTagName,closeTagValue:t.closeTagValue}),null!=this.components.metrics&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_size`),routingTableKadBucketTotal:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_total`),routingTableKadBucketAverageOccupancy:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_average_occupancy`),routingTableKadBucketMinOccupancy:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_min_occupancy`),routingTableKadBucketMaxOccupancy:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_max_occupancy`),routingTableKadBucketMaxDepth:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_max_depth`),kadBucketEvents:this.components.metrics.registerCounterGroup(`${t.metricsPrefix}_kad_bucket_events_total`)})}isStarted(){return this.running}async start(){this.running||(this.running=!0,await ul(this.closestPeerTagger),await this.kb.addSelfPeer(this.components.peerId))}async afterStart(){Promise.resolve().then(async()=>{if(!this.populateFromDatastoreOnStart)return;let e=0;for(let t of(await this.components.peerStore.all({filters:[e=>e.protocols.includes(this.protocol)&&e.tags.has(O_)],limit:this.populateFromDatastoreLimit}))){if(!this.running)return;try{await this.add(t.id),e++}catch(e){this.log("failed to add peer %p to routing table, removing kad-dht peer tags - %e"),await this.components.peerStore.merge(t.id,{tags:{[this.peerTagName]:void 0}})}}this.log("added %d peer store peers to the routing table",e)}).catch(e=>{this.log.error("error adding peer store peers to the routing table %e",e)})}async stop(){this.running=!1,await uc(this.closestPeerTagger),this.pingOldContactQueue.abort(),this.pingNewContactQueue.abort()}async peerAdded(e,t){this.components.peerId.equals(e.peerId)||await this.components.peerStore.merge(e.peerId,{tags:{[this.peerTagName]:{value:this.peerTagValue}}}),this.updateMetrics(),this.metrics?.kadBucketEvents.increment({peer_added:!0}),this.safeDispatchEvent("peer:add",{detail:e.peerId})}async peerRemoved(e,t){this.components.peerId.equals(e.peerId)||await this.components.peerStore.merge(e.peerId,{tags:{[this.peerTagName]:void 0}}),this.updateMetrics(),this.metrics?.kadBucketEvents.increment({peer_removed:!0}),this.safeDispatchEvent("peer:remove",{detail:e.peerId})}async *pingOldContacts(e,t){if(!this.running)return;let r=[];for(let n of e){if(null==this.kb.get(n.kadId)){this.log("asked to ping contact %p that was not in routing table",n.peerId);continue}this.metrics?.kadBucketEvents.increment({ping_old_contact:!0}),r.push(async()=>{let e=this.pingOldContactQueue.find(n.peerId);return null!=e?(this.log("asked to ping contact %p was already being pinged",n.peerId),await e.join(t))?void 0:n:await this.pingOldContactQueue.add(async e=>{let t=this.pingOldContactTimeout.getTimeoutSignal(),r=hQ([t,e?.signal]);try{return await this.pingContact(n,e)}catch{return this.metrics?.kadBucketEvents.increment({ping_old_contact_error:!0}),!0}finally{this.pingOldContactTimeout.cleanUp(t),r.clear()}},{peerId:n.peerId,signal:t?.signal})?void 0:n})}for await(let e of lt(r))null!=e&&(yield e)}async verifyNewContact(e,t){let r=this.pingNewContactTimeout.getTimeoutSignal(),n=hQ([r,t?.signal]);try{let t=this.pingNewContactQueue.find(e.peerId);if(null!=t)return this.log("joining existing ping to add new peer %p to routing table",e.peerId),await t.join({signal:n});return await this.pingNewContactQueue.add(async t=>(this.metrics?.kadBucketEvents.increment({ping_new_contact:!0}),this.log("pinging new peer %p before adding to routing table",e.peerId),this.pingContact(e,t)),{peerId:e.peerId,signal:n})}catch(t){return this.log.trace("tried to add peer %p but they were not online",e.peerId),this.metrics?.kadBucketEvents.increment({ping_new_contact_error:!0}),!1}finally{this.pingNewContactTimeout.cleanUp(r),n.clear()}}async pingContact(e,t){let r;try{return this.log("pinging contact %p",e.peerId),await this.components.ping.ping(e.peerId,t),this.log("contact %p ping ok",e.peerId),this.safeDispatchEvent("peer:ping",{detail:e.peerId}),!0}catch(t){return this.log("error pinging old contact %p - %e",e.peerId,t),r?.abort(t),!1}}get size(){return null==this.kb?0:this.kb.count()}async find(e){let t=await RL(e);return this.kb.get(t)?.peerId}closestPeer(e){let t=this.closestPeers(e,1);if(t.length>0)return t[0]}closestPeers(e,t=this.kBucketSize){return null==this.kb?[]:[...this.kb.closest(e,t)]}async add(e,t){if(null==this.kb)throw Error("RoutingTable is not started");await this.kb.add(e,t)}async remove(e){if(null==this.kb)throw Error("RoutingTable is not started");let t=await RL(e);await this.kb.remove(t)}updateMetrics(){if(null==this.metrics||null==this.kb)return;let e=0,t=0,r=0,n=20,i=0;function s(o){if(Og(o)){o.depth>r&&(r=o.depth),t++,e+=o.peers.length,o.peers.length<n&&(n=o.peers.length),o.peers.length>i&&(i=o.peers.length);return}s(o.left),s(o.right)}s(this.kb.root),this.metrics.routingTableSize.update(e),this.metrics.routingTableKadBucketTotal.update(t),this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(e/t)),this.metrics.routingTableKadBucketMinOccupancy.update(n),this.metrics.routingTableKadBucketMaxOccupancy.update(i),this.metrics.routingTableKadBucketMaxDepth.update(r)}}let OO=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782],ON=15;class OD{log;peerRouting;routingTable;refreshInterval;refreshQueryTimeout;commonPrefixLengthRefreshedAt;refreshTimeoutId;constructor(e,t){let{peerRouting:r,routingTable:n,refreshInterval:i,refreshQueryTimeout:s,logPrefix:o}=t;this.log=e.logger.forComponent(`${o}:routing-table:refresh`),this.peerRouting=r,this.routingTable=n,this.refreshInterval=i??Rd,this.refreshQueryTimeout=s??Rf,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async afterStart(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){null!=this.refreshTimeoutId&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");let t=this._maxCommonPrefix(),r=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${r.map(e=>e.toISOString()).join(", ")} ]`),Promise.all(r.map(async(n,i)=>{try{if(await this._refreshCommonPrefixLength(i,n,e),0===this._numPeersForCpl(t)){let t=Math.min(2*(i+1),r.length-1);for(let r=i+1;r<t+1;r++)try{await this._refreshCommonPrefixLength(r,n,e)}catch(e){this.log.error(e)}}}catch(e){this.log.error(e)}})).catch(e=>{this.log.error(e)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),null!=this.refreshTimeoutId.unref&&this.refreshTimeoutId.unref()}).catch(e=>{this.log.error(e)})}async _refreshCommonPrefixLength(e,t,r){if(!r&&t.getTime()>Date.now()-this.refreshInterval)return void this.log("not running refresh for cpl %s as time since last refresh not above interval",e);let n=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,n,this.routingTable.size);let i=AbortSignal.timeout(this.refreshQueryTimeout),s=await Oi(this.peerRouting.getClosestPeers(n.toMultihash().bytes,{signal:i}));this.log(`found ${s} peers that were close to imaginary peer %p`,n),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,n,this.routingTable.size)}_getTrackedCommonPrefixLengthsForRefresh(e){e>ON&&(e=ON);let t=[];for(let r=0;r<=e;r++)t[r]=this.commonPrefixLengthRefreshedAt[r]??new Date;return t}async _generateRandomPeerId(e){if(null==this.routingTable.kb)throw Error("Routing table not started");if(null==this.routingTable.kb.localPeer)throw Error("Local peer not set");let t=Er(2),r=(t[1]<<8)+t[0],n=await this._makePeerId(this.routingTable.kb.localPeer.kadId,r,e);return yO(aG.decode(n))}async _makePeerId(e,t,r){if(r>ON)throw Error(`Cannot generate peer ID for common prefix length greater than ${ON}`);let n=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>r,i=65535<<16-(r+1),s=OO[n&i|t&~i],o=new ArrayBuffer(34),a=new DataView(o,0,o.byteLength);return a.setUint8(0,nK.sha256.code),a.setUint8(1,32),a.setUint32(2,s,!1),new Uint8Array(a.buffer,a.byteOffset,a.byteLength)}_maxCommonPrefix(){let e=0;for(let t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(let r of this._prefixLengths())r===e&&t++;return t}*_prefixLengths(){if(this.routingTable.kb?.localPeer!=null)for(let{kadId:e}of this.routingTable.kb.toIterable()){let t=R6(this.routingTable.kb.localPeer.kadId,e),r=0;for(let e of t)if(0===e)r++;else break;yield r}}}let OB=8,OM=4194304;class OL extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class OF extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class OU extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}class Oj extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}function O$(e){return null!=e[Symbol.asyncIterator]}function OH(e,t){if(e.byteLength>t)throw new OF("Message length too long")}let Oq=e=>{let t=rY(e),r=(0,t9.K)(t);return r3(e,r),Oq.bytes=t,r};function Oz(e,t){let r=(t=t??{}).lengthEncoder??Oq,n=t?.maxDataLength??OM;function*i(e){OH(e,n);let t=r(e.byteLength);t instanceof Uint8Array?yield t:yield*t,e instanceof Uint8Array?yield e:yield*e}return O$(e)?async function*(){for await(let t of e)yield*i(t)}():function*(){for(let t of e)yield*i(t)}()}Oq.bytes=0,Oz.single=(e,t)=>{let r=(t=t??{}).lengthEncoder??Oq;return OH(e,t?.maxDataLength??OM),new ro(r(e.byteLength),e)},function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(eF||(eF={}));let OV=e=>{let t=r4(e);return OV.bytes=rY(t),t};function OK(e,t){let r=new ro,n=eF.LENGTH,i=-1,s=t?.lengthDecoder??OV,o=t?.maxLengthLength??OB,a=t?.maxDataLength??OM;function*l(){for(;r.byteLength>0;){if(n===eF.LENGTH)try{if((i=s(r))<0)throw new OL("Invalid message length");if(i>a)throw new OF("Message length too long");let e=s.bytes;r.consume(e),t?.onLength!=null&&t.onLength(i),n=eF.DATA}catch(e){if(e instanceof RangeError){if(r.byteLength>o)throw new OU("Message length length too long");break}throw e}if(n===eF.DATA){if(r.byteLength<i)break;let e=r.sublist(0,i);r.consume(i),t?.onData!=null&&t.onData(e),yield e,n=eF.LENGTH}}}return O$(e)?async function*(){for await(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new Oj("Unexpected end of input")}():function*(){for(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new Oj("Unexpected end of input")}()}OV.bytes=0,OK.fromReader=(e,t)=>{let r=1,n=async function*(){for(;;)try{let{done:t,value:n}=await e.next(r);if(!0===t)return;null!=n&&(yield n)}catch(e){if("ERR_UNDER_READ"===e.code)return{done:!0,value:null};throw e}finally{r=1}}(),i=e=>{r=e};return OK(n,{...t??{},onLength:i})};class OG{peerId;providers;peerStore;log;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:add-provider`),this.peerId=e.peerId,this.providers=t.providers,this.peerStore=e.peerStore}async handle(e,t){let r;if(null==t.key||0===t.key.length)throw new uq("Missing key");try{r=rc.TO.decode(t.key)}catch(e){throw new uq("Invalid CID")}(null==t.providers||0===t.providers.length)&&this.log.error("no providers found in message"),this.log("%p asked us, %p to store provider record for for %c",e,this.peerId,r),await Promise.all(t.providers.map(async t=>{let n=yO(aG.decode(t.id)),i=t.multiaddrs.map(e=>wt(e));return e.equals(n)?t.multiaddrs.length<1?void this.log("no valid addresses for provider %p. Ignore",e):void(this.log.trace("received provider %p for %s (addrs %s)",e,r,i),await this.providers.addProvider(r,n),await this.peerStore.merge(n,{multiaddrs:i})):void this.log("invalid provider peer %p from %p",t.id,e)}))}}class OW{peerRouting;peerInfoMapper;peerId;addressManager;log;constructor(e,t){let{peerRouting:r,logPrefix:n}=t;this.log=e.logger.forComponent(`${n}:rpc:handlers:find-node`),this.peerId=e.peerId,this.addressManager=e.addressManager,this.peerRouting=r,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(this.log("incoming request from %p for peers closer to %b",e,t.key),null==t.key)throw new uq("Invalid FIND_NODE message received - key was missing");let r=await this.peerRouting.getCloserPeersOffline(t.key,e);rr(this.peerId.toMultihash().bytes,t.key)&&r.push({id:this.peerId,multiaddrs:this.addressManager.getAddresses().map(e=>e.decapsulateCode(bT("p2p").code))});let n={type:eO.FIND_NODE,clusterLevel:t.clusterLevel,closer:r.map(this.peerInfoMapper).filter(({multiaddrs:e})=>e.length).map(e=>({id:e.id.toMultihash().bytes,multiaddrs:e.multiaddrs.map(e=>e.bytes)})),providers:[]};return 0===n.closer.length&&this.log("could not find any peers closer to %b than %p",t.key,e),n}}class OQ{peerId;peerRouting;providers;peerStore;peerInfoMapper;log;constructor(e,t){let{peerRouting:r,providers:n,logPrefix:i}=t;this.log=e.logger.forComponent(`${i}:rpc:handlers:get-providers`),this.peerId=e.peerId,this.peerStore=e.peerStore,this.peerRouting=r,this.providers=n,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){let r;if(null==t.key)throw new uq("Invalid GET_PROVIDERS message received - key was missing");try{r=rc.TO.decode(t.key)}catch(e){throw new uq("Invalid CID")}this.log("%p asking for providers for %s",e,r);let[n,i]=await Promise.all([(0,lT.A)((0,a7.A)(await this.providers.getProviders(r),async e=>{let t=await this.peerStore.get(e);return{id:t.id,multiaddrs:t.addresses.map(({multiaddr:e})=>e)}})),this.peerRouting.getCloserPeersOffline(t.key,this.peerId)]),s={type:eO.GET_PROVIDERS,key:t.key,clusterLevel:t.clusterLevel,closer:i.map(this.peerInfoMapper).filter(({id:e,multiaddrs:t})=>t.length>0).map(e=>({id:e.id.toMultihash().bytes,multiaddrs:e.multiaddrs.map(e=>e.bytes)})),providers:n.map(this.peerInfoMapper).filter(({id:e,multiaddrs:t})=>t.length>0).map(e=>({id:e.id.toMultihash().bytes,multiaddrs:e.multiaddrs.map(e=>e.bytes)}))};return this.log("got %s providers %s closerPeers",s.providers.length,s.closer.length),s}async _getAddresses(e){return[]}}class OJ{peerStore;datastore;peerRouting;log;datastorePrefix;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:get-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.peerStore=e.peerStore,this.datastore=e.datastore,this.peerRouting=t.peerRouting}async handle(e,t){let r=t.key;if(this.log("%p asked for key %b",e,r),null==r||0===r.length)throw new uq("Invalid key");let n={type:eO.GET_VALUE,key:r,clusterLevel:t.clusterLevel,closer:[],providers:[]};if(Rj(r)){let e;this.log("is public key");let t=R$(r);try{let r=await this.peerStore.get(t);if(null==r.id.publicKey)throw new uL("No public key found in key book");e=yu(r.id.publicKey)}catch(e){if("NotFoundError"!==e.name)throw e}if(null!=e)return this.log("returning found public key"),n.record=new Rb(r,e,new Date).serialize(),n}let[i,s]=await Promise.all([this._checkLocalDatastore(r),this.peerRouting.getCloserPeersOffline(r,e)]);return null!=i&&(this.log("had record for %b in local datastore",r),n.record=i.serialize()),s.length>0&&(this.log("had %s closer peers in routing table",s.length),n.closer=s.map(e=>({id:e.id.toMultihash().bytes,multiaddrs:e.multiaddrs.map(e=>e.bytes)}))),n}async _checkLocalDatastore(e){let t;this.log("checkLocalDatastore looking for %b",e);let r=RF(this.datastorePrefix,e);try{t=await this.datastore.get(r)}catch(e){if("NotFoundError"===e.name)return;throw e}let n=Rb.deserialize(t);return null==n.timeReceived||Date.now()-n.timeReceived.getTime()>Re?void await this.datastore.delete(r):n}}class OZ{log;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:ping`)}async handle(e,t){return this.log("ping from %p",e),t}}class OY{components;validators;log;datastorePrefix;constructor(e,t){let{validators:r}=t;this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:put-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=r}async handle(e,t){let r=t.key;if(this.log("%p asked us to store value for key %b",e,r),null==t.record){let t=`Empty record from: ${e.toString()}`;throw this.log.error(t),new uq(t)}try{let e=Rb.deserialize(t.record);await RO(this.validators,e),e.timeReceived=new Date;let n=RF(this.datastorePrefix,e.key);await this.components.datastore.put(n,e.serialize().subarray()),this.log("put record for %b into datastore under key %k",r,n)}catch(e){this.log("did not put record for key %b into datastore %o",r,e)}return t}}class OX{handlers;routingTable;log;metrics;constructor(e,t){this.metrics={operations:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_requests_total`),errors:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_errors_total`)},this.log=e.logger.forComponent(`${t.logPrefix}:rpc`),this.routingTable=t.routingTable,this.handlers={[eO.GET_VALUE.toString()]:new OJ(e,t),[eO.PUT_VALUE.toString()]:new OY(e,t),[eO.FIND_NODE.toString()]:new OW(e,t),[eO.ADD_PROVIDER.toString()]:new OG(e,t),[eO.GET_PROVIDERS.toString()]:new OQ(e,t),[eO.PING.toString()]:new OZ(e,t)}}async handleMessage(e,t){let r=this.handlers[t.type];if(null==r)return void this.log.error(`no handler found for message type: ${t.type}`);try{return this.metrics.operations?.increment({[t.type]:!0}),await r.handle(e,t)}catch{this.metrics.errors?.increment({[t.type]:!0})}}onIncomingStream(e){let t="unknown";Promise.resolve().then(async()=>{let{stream:r,connection:n}=e,i=n.remotePeer,s=this;await (0,lr.F)(r,e=>OK(e),async function*(e){for await(let r of e){let e=eL.decode(r);t=e.type,s.log("incoming %s from %p",e.type,i);let n=await s.handleMessage(i,e);null!=n&&(yield eL.encode(n))}},e=>Oz(e),r)}).catch(r=>{this.log.error("error handling %s RPC message from %p - %e",t,e.connection.remotePeer,r)})}}class O0 extends uS{log;components;protocol;running;registrarId;constructor(e,t){super();let{protocol:r,logPrefix:n}=t;this.components=e,this.log=e.logger.forComponent(`${n}:topology-listener`),this.running=!1,this.protocol=r}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.registrarId=await this.components.registrar.register(this.protocol,{onConnect:e=>{this.log("observed peer %p with protocol %s",e,this.protocol),this.dispatchEvent(new CustomEvent("peer",{detail:e}))}}))}async stop(){this.running=!1,null!=this.registrarId&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class O1{dht;constructor(e){this.dht=e}async provide(e,t={}){await (0,ux.A)(this.dht.provide(e,t))}async cancelReprovide(e){await this.dht.cancelReprovide(e)}async *findProviders(e,t={}){for await(let r of this.dht.findProviders(e,t))"PROVIDER"===r.name&&(yield*r.providers)}async put(e,t,r){await (0,ux.A)(this.dht.put(e,t,r))}async get(e,t){for await(let r of this.dht.get(e,t))if("VALUE"===r.name)return r.value;throw new uL("Could not find value for key")}}class O2{dht;constructor(e){this.dht=e}async findPeer(e,t={}){for await(let r of this.dht.findPeer(e,t))if("FINAL_PEER"===r.name)return r.peer;throw new uL("Peer not found")}async *getClosestPeers(e,t={}){for await(let r of this.dht.getClosestPeers(e,t))"FINAL_PEER"===r.name&&(yield r.peer)}}let O3=32,O4=64;class O5 extends uS{protocol;routingTable;providers;network;peerRouting;components;log;running;kBucketSize;clientMode;validators;selectors;queryManager;contentFetching;contentRouting;routingTableRefresh;rpc;topologyListener;querySelf;maxInboundStreams;maxOutboundStreams;dhtContentRouting;dhtPeerRouting;peerInfoMapper;reprovider;constructor(e,t={}){super();let r=t.logPrefix??"libp2p:kad-dht",n=t.datastorePrefix??"/dht",i=t.metricsPrefix??"libp2p_kad_dht",s={queries:e.metrics?.registerMetricGroup(`${i}_operations_total`,{label:"operation"}),errors:e.metrics?.registerCounterGroup(`${i}_operation_errors_total`,{label:"operation"}),queryTime:e.metrics?.registerMetricGroup(`${i}_operation_time_seconds`,{label:"operation"}),errorTime:e.metrics?.registerMetricGroup(`${i}_operation_error_time_seconds`,{label:"operation"})};this.running=!1,this.components=e,this.log=e.logger.forComponent(r),this.protocol=t.protocol??Rt,this.kBucketSize=t.kBucketSize??20,this.clientMode=t.clientMode??!0,this.maxInboundStreams=t.maxInboundStreams??O3,this.maxOutboundStreams=t.maxOutboundStreams??O4,this.peerInfoMapper=t.peerInfoMapper??RB;let o=h$();this.providers=new Oe(e,{...t.providers,logPrefix:r,datastorePrefix:n,lock:o}),this.validators={...RN,...t.validators},this.selectors={...RR,...t.selectors},this.network=new R5(e,{protocol:this.protocol,logPrefix:r,metricsPrefix:i}),this.routingTable=new OR(e,{kBucketSize:t.kBucketSize,pingOldContactTimeout:t.pingOldContactTimeout,pingOldContactConcurrency:t.pingOldContactConcurrency,pingOldContactMaxQueueSize:t.pingOldContactMaxQueueSize,pingNewContactTimeout:t.pingNewContactTimeout,pingNewContactConcurrency:t.pingNewContactConcurrency,pingNewContactMaxQueueSize:t.pingNewContactMaxQueueSize,protocol:this.protocol,logPrefix:r,metricsPrefix:i,prefixLength:t.prefixLength,splitThreshold:t.kBucketSplitThreshold,network:this.network});let a=(0,a9.A)();!0===t.allowQueryWithZeroPeers&&a.resolve(),this.queryManager=new Or(e,{disjointPaths:Math.ceil(this.kBucketSize/2),logPrefix:r,metricsPrefix:i,initialQuerySelfHasRun:a,routingTable:this.routingTable}),this.peerRouting=new R9(e,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:r}),this.contentFetching=new R1(e,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:r,datastorePrefix:n}),this.contentRouting=new R4(e,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:r}),this.routingTableRefresh=new OD(e,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:r}),this.rpc=new OX(e,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:r,metricsPrefix:i,datastorePrefix:n,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new O0(e,{protocol:this.protocol,logPrefix:r}),this.querySelf=new Ol(e,{peerRouting:this.peerRouting,interval:t.querySelfInterval,initialInterval:t.initialQuerySelfInterval,logPrefix:r,initialQuerySelfHasRun:a,routingTable:this.routingTable,operationMetrics:s}),this.reprovider=new Oc(e,{...t.reprovide,logPrefix:r,metricsPrefix:i,datastorePrefix:n,contentRouting:this.contentRouting,lock:o,operationMetrics:s}),this.network.addEventListener("peer",e=>{let t=e.detail;this.onPeerConnect(t).catch(e=>{this.log.error("could not add %p to routing table",t.id,e)}),this.dispatchEvent(new CustomEvent("peer",{detail:t}))}),this.topologyListener.addEventListener("peer",e=>{let t=e.detail;Promise.resolve().then(async()=>{let e=await this.components.peerStore.get(t),r={id:t,multiaddrs:e.addresses.map(({multiaddr:e})=>e),protocols:e.protocols};await this.onPeerConnect(r)}).catch(e=>{this.log.error("could not add %p to routing table - %e",t,e)})}),this.dhtPeerRouting=new O2(this),this.dhtContentRouting=new O1(this),null==t.clientMode&&e.events.addEventListener("self:peer:update",e=>{this.log("received update of self-peer info"),Promise.resolve().then(async()=>{let t=e.detail.peer.addresses.some(({multiaddr:e})=>RQ(e)),r=this.getMode();t&&"client"===r?await this.setMode("server"):"server"!==r||t||await this.setMode("client")}).catch(e=>{this.log.error("error setting dht server mode",e)})}),this.get=RX(this.get.bind(this),s,"GET_VALUE"),this.findProviders=RX(this.findProviders.bind(this),s,"FIND_PROVIDERS"),this.findPeer=RX(this.findPeer.bind(this),s,"FIND_PEER"),this.getClosestPeers=RX(this.getClosestPeers.bind(this),s,"GET_CLOSEST_PEERS"),this.provide=RX(this.provide.bind(this),s,"PROVIDE"),this.put=RX(this.put.bind(this),s,"PUT_VALUE")}[Symbol.toStringTag]="@libp2p/kad-dht";[En]=["@libp2p/content-routing","@libp2p/peer-routing","@libp2p/peer-discovery"];[Ei]=["@libp2p/identify","@libp2p/ping"];get[us](){return this.dhtContentRouting}get[uo](){return this.dhtPeerRouting}get[xb](){return this}async onPeerConnect(e){if(this.log.trace("peer %p connected",e.id),0===(e=this.peerInfoMapper(e)).multiaddrs.length)return void this.log.trace("ignoring %p as there were no valid addresses in %s after filtering",e.id,e.multiaddrs.map(e=>e.toString()));try{await this.routingTable.add(e.id)}catch(t){this.log.error("could not add %p to routing table",e.id,t)}}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}async setMode(e,t=!1){return(e!==this.getMode()||t)&&(await this.components.registrar.unhandle(this.protocol),e!==this.getMode()||t)?void("client"===e?(this.log("enabling client mode while in %s mode",this.getMode()),this.clientMode=!0):(this.log("enabling server mode while in %s mode",this.getMode()),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))):void this.log("already in %s mode",e)}async start(){this.running||(this.running=!0,await this.setMode(this.clientMode?"client":"server",!0),await ul(this.routingTable,this.queryManager,this.network,this.topologyListener,this.routingTableRefresh,this.reprovider),await ul(this.querySelf))}async stop(){this.running=!1,await uc(this.querySelf,this.queryManager,this.network,this.routingTable,this.routingTableRefresh,this.topologyListener,this.reprovider)}async *put(e,t,r={}){yield*this.contentFetching.put(e,t,r)}async *get(e,t={}){yield*this.contentFetching.get(e,t)}async *provide(e,t={}){yield*this.contentRouting.provide(e,this.components.addressManager.getAddresses(),t)}async cancelReprovide(e){await this.providers.removeProvider(e,this.components.peerId)}async *findProviders(e,t={}){yield*this.contentRouting.findProviders(e,t)}async *findPeer(e,t={}){yield*this.peerRouting.findPeer(e,t)}async *getClosestPeers(e,t={}){yield*this.peerRouting.getClosestPeers(e,t)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}}function O6(e={}){return t=>new O5(t,e)}!function(e){e[e.SEND_QUERY=0]="SEND_QUERY",e[e.PEER_RESPONSE=1]="PEER_RESPONSE",e[e.FINAL_PEER=2]="FINAL_PEER",e[e.QUERY_ERROR=3]="QUERY_ERROR",e[e.PROVIDER=4]="PROVIDER",e[e.VALUE=5]="VALUE",e[e.ADD_PEER=6]="ADD_PEER",e[e.DIAL_PEER=7]="DIAL_PEER"}(eU||(eU={})),function(e){e[e.NEW_STREAM=0]="NEW_STREAM",e[e.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",e[e.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",e[e.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",e[e.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",e[e.RESET_RECEIVER=5]="RESET_RECEIVER",e[e.RESET_INITIATOR=6]="RESET_INITIATOR"}(ej||(ej={}));let O8=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),O7=Object.freeze({NEW_STREAM:ej.NEW_STREAM,MESSAGE:ej.MESSAGE_INITIATOR,CLOSE:ej.CLOSE_INITIATOR,RESET:ej.RESET_INITIATOR}),O9=Object.freeze({MESSAGE:ej.MESSAGE_RECEIVER,CLOSE:ej.CLOSE_RECEIVER,RESET:ej.RESET_RECEIVER}),Ne=1048576,Nt=4194304;class Nr{_buffer;_headerInfo;_maxMessageSize;_maxUnprocessedMessageQueueSize;constructor(e=Ne,t=Nt){this._buffer=new ro,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(null==e||0===e.length)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw new uq("Unprocessed message queue size too large!");let t=[];for(;0!==this._buffer.length;){if(null==this._headerInfo)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(e){if("InvalidMessageError"===e.name)throw e;break}let{id:e,type:r,length:n,offset:i}=this._headerInfo;if(this._buffer.length-i<n)break;let s={id:e,type:r};(r===ej.NEW_STREAM||r===ej.MESSAGE_INITIATOR||r===ej.MESSAGE_RECEIVER)&&(s.data=this._buffer.sublist(i,i+n)),t.push(s),this._buffer.consume(i+n),this._headerInfo=null}return t}_decodeHeader(e){let{value:t,offset:r}=Ns(e),{value:n,offset:i}=Ns(e,r),s=7&t;if(null==O8[s])throw Error(`Invalid type received: ${s}`);if(n>this._maxMessageSize)throw new uq("Message size too large");return{id:t>>3,type:s,offset:r+i,length:n}}}let Nn=128,Ni=127;function Ns(e,t=0){let r,n=0,i=0,s=t,o=e.length;do{if(s>=o||i>49)throw t=0,RangeError("Could not decode varint");r=e.get(s++),n+=i<28?(r&Ni)<<i:(r&Ni)*Math.pow(2,i),i+=7}while(r>=Nn);return{value:n,offset:t=s-t}}let No=10240;class Na{_pool;_poolOffset;constructor(){this._pool=(0,t9.K)(No),this._poolOffset=0}write(e,t){let r=this._pool,n=this._poolOffset;r3(e.id<<3|e.type,r,n),n+=rY(e.id<<3|e.type),(e.type===ej.NEW_STREAM||e.type===ej.MESSAGE_INITIATOR||e.type===ej.MESSAGE_RECEIVER)&&null!=e.data?(r3(e.data.length,r,n),n+=rY(e.data.length)):(r3(0,r,n),n+=rY(0));let i=r.subarray(this._poolOffset,n);No-n<100?(this._pool=(0,t9.K)(No),this._poolOffset=0):this._poolOffset=n,t.append(i),(e.type===ej.NEW_STREAM||e.type===ej.MESSAGE_INITIATOR||e.type===ej.MESSAGE_RECEIVER)&&null!=e.data&&t.append(e.data)}}let Nl=new Na;async function*Nc(e){for await(let t of e){let e=new ro;Nl.write(t,e),yield e}}class Nu extends Error{constructor(e="Stream input buffer error"){super(e),this.name="StreamInputBufferError"}}class Nh extends CO{name;streamId;send;types;maxDataSize;constructor(e){super(e),this.types="outbound"===e.direction?O7:O9,this.send=e.send,this.name=e.name,this.streamId=e.streamId,this.maxDataSize=e.maxDataSize}async sendNewStream(){await this.send({id:this.streamId,type:O7.NEW_STREAM,data:new ro((0,nm.s)(this.name))})}async sendData(e){for(e=e.sublist();e.byteLength>0;){let t=Math.min(e.byteLength,this.maxDataSize);await this.send({id:this.streamId,type:this.types.MESSAGE,data:e.sublist(0,t)}),e.consume(t)}}async sendReset(){await this.send({id:this.streamId,type:this.types.RESET})}async sendCloseWrite(){await this.send({id:this.streamId,type:this.types.CLOSE})}async sendCloseRead(){}}function Nd(e){let{id:t,name:r,send:n,onEnd:i,type:s="initiator",maxMsgSize:o=Ne}=e;return new Nh({id:"initiator"===s?`i${t}`:`r${t}`,streamId:t,name:`${r??t}`,direction:"initiator"===s?"outbound":"inbound",maxDataSize:o,onEnd:i,send:n,log:e.logger.forComponent(`libp2p:mplex:stream:${s}:${t}`)})}let Nf=1024,Np=1024,Ng=4194304,Nm=5,Ny=500;function Nb(e){let t={...e,type:`${O8[e.type]} (${e.type})`};return e.type===ej.NEW_STREAM&&(t.data=(0,uh.d)(e.data instanceof Uint8Array?e.data:e.data.subarray())),(e.type===ej.MESSAGE_INITIATOR||e.type===ej.MESSAGE_RECEIVER)&&(t.data=(0,uh.d)(e.data instanceof Uint8Array?e.data:e.data.subarray(),"base16")),t}class Nw{protocol="/mplex/6.7.0";sink;source;log;_streamId;_streams;_init;_source;closeController;rateLimiter;closeTimeout;logger;constructor(e,t){t=t??{},this.log=e.logger.forComponent("libp2p:mplex"),this.logger=e.logger,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=t,this.closeTimeout=t.closeTimeout??Ny,this.sink=this._createSink(),this._source=(0,li.Ny)({objectMode:!0,onEnd:()=>{for(let e of this._streams.initiators.values())e.destroy();for(let e of this._streams.receivers.values())e.destroy()}}),this.source=(0,lr.F)(this._source,e=>Nc(e)),this.closeController=new AbortController,this.rateLimiter=new S1({points:t.disconnectThreshold??Nm,duration:1})}get streams(){let e=[];for(let t of this._streams.initiators.values())e.push(t);for(let t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new uD("Muxer already closed");let t=this._streamId++;e=null==e?t.toString():e.toString();let r=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:r})}async close(e){if(this.closeController.signal.aborted)return;let t=e?.signal??AbortSignal.timeout(this.closeTimeout);try{await Promise.all(this.streams.map(async e=>e.close({signal:t}))),this._source.end(),await this._source.onEmpty({signal:t}),this.closeController.abort()}catch(e){this.abort(e)}}abort(e){this.closeController.signal.aborted||(this.streams.forEach(t=>{t.abort(e)}),this.closeController.abort(e))}_newReceiverStream(e){let{id:t,name:r}=e,n=this._streams.receivers;return this._newStream({id:t,name:r,type:"receiver",registry:n})}_newStream(e){let{id:t,name:r,type:n,registry:i}=e;if(this.log("new %s stream %s",n,t),"initiator"===n&&this._streams.initiators.size===(this._init.maxOutboundStreams??Np))throw new uZ("Too many outbound streams open");if(i.has(t))throw Error(`${n} stream ${t} already exists!`);let s=async e=>{this.log.enabled&&this.log.trace("%s stream %s send",n,t,Nb(e)),this._source.push(e)},o=()=>{this.log("%s stream with id %s and protocol %s ended",n,t,a.protocol),i.delete(t),null!=this._init.onStreamEnd&&this._init.onStreamEnd(a)},a=Nd({id:t,name:r,send:s,type:n,onEnd:o,maxMsgSize:this._init.maxMsgSize,logger:this.logger});return i.set(t,a),a}_createSink(){return async e=>{let t=()=>{CT(e,this.log)};this.closeController.signal.addEventListener("abort",t);try{let t=new Nr(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(let r of e)for(let e of t.write(r))await this._handleIncoming(e);this._source.end()}catch(e){this.log("error in sink",e),this._source.end(e)}finally{this.closeController.signal.removeEventListener("abort",t)}}}async _handleIncoming(e){let{id:t,type:r}=e;if(this.log.enabled&&this.log.trace("incoming message",Nb(e)),e.type===ej.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??Nf)){this.log("too many inbound streams open"),this._source.push({id:t,type:ej.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{this.log("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this.abort(Error("Too many open streams"))}return}let r=this._newReceiverStream({id:t,name:(0,uh.d)(e.data instanceof Uint8Array?e.data:e.data.subarray())});null!=this._init.onIncomingStream&&this._init.onIncomingStream(r);return}let n=((1&r)==1?this._streams.initiators:this._streams.receivers).get(t);if(null==n){this.log("missing stream %s for message type %s",t,O8[r]);try{await this.rateLimiter.consume("missing-stream",1)}catch{this.log("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),this.abort(Error("Too many messages for missing streams"))}return}let i=this._init.maxStreamBufferSize??Ng;try{switch(r){case ej.MESSAGE_INITIATOR:case ej.MESSAGE_RECEIVER:if(n.sourceReadableLength()>i)throw this._source.push({id:e.id,type:r===ej.MESSAGE_INITIATOR?ej.RESET_RECEIVER:ej.RESET_INITIATOR}),new Nu("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers");n.sourcePush(e.data);break;case ej.CLOSE_INITIATOR:case ej.CLOSE_RECEIVER:n.remoteCloseWrite();break;case ej.RESET_INITIATOR:case ej.RESET_RECEIVER:n.reset();break;default:this.log("unknown message type %s",r)}}catch(e){this.log.error("error while processing message",e),n.abort(e)}}}class Nv{protocol="/mplex/6.7.0";_init;components;constructor(e,t={}){this.components=e,this._init=t}[Symbol.toStringTag]="@libp2p/mplex";[En]=["@libp2p/stream-multiplexing"];createStreamMuxer(e={}){return new Nw(this.components,{...e,...this._init})}}function NE(e={}){return t=>new Nv(t,e)}let NA=32,Nx="1.0.0",NS="ping",Nk="ipfs",N_=1e4,NI=2,NC=1;class NT{protocol;components;started;timeout;maxInboundStreams;maxOutboundStreams;runOnLimitedConnection;log;constructor(e,t={}){this.components=e,this.log=e.logger.forComponent("libp2p:ping"),this.started=!1,this.protocol=`/${t.protocolPrefix??Nk}/${NS}/${Nx}`,this.timeout=t.timeout??N_,this.maxInboundStreams=t.maxInboundStreams??NI,this.maxOutboundStreams=t.maxOutboundStreams??NC,this.runOnLimitedConnection=t.runOnLimitedConnection??!0,this.handleMessage=this.handleMessage.bind(this)}[Symbol.toStringTag]="@libp2p/ping";[En]=["@libp2p/ping"];async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){this.log("incoming ping from %p",e.connection.remotePeer);let{stream:t}=e,r=Date.now(),n=kV(t),i=!1;Promise.resolve().then(async()=>{for(;;){let e=AbortSignal.timeout(this.timeout);e.addEventListener("abort",()=>{t?.abort(new uV("ping timeout"))});let r=await n.read({bytes:NA,signal:e});await n.write(r,{signal:e}),i=!0}}).catch(r=>{i&&"UnexpectedEOFError"===r.name&&"ready"!==t.readStatus||(this.log.error("incoming ping from %p failed with error - %e",e.connection.remotePeer,r),t?.abort(r))}).finally(()=>{let n=Date.now()-r;this.log("incoming ping from %p complete in %dms",e.connection.remotePeer,n);let i=AbortSignal.timeout(this.timeout);t.close({signal:i}).catch(r=>{this.log.error("error closing ping stream from %p - %e",e.connection.remotePeer,r),t?.abort(r)})})}async ping(e,t={}){let r;this.log("pinging %p",e);let n=Date.now(),i=Er(NA),s=await this.components.connectionManager.openConnection(e,t);if(null==t.signal){let e=AbortSignal.timeout(this.timeout);t={...t,signal:e}}try{r=await s.newStream(this.protocol,{...t,runOnLimitedConnection:this.runOnLimitedConnection});let e=kV(r),[,o]=await Promise.all([e.write(i,t),e.read({...t,bytes:NA})]),a=Date.now()-n;if(!rr(i,o.subarray()))throw new uz(`Received wrong ping ack after ${a}ms`);return this.log("ping %p complete in %dms",s.remotePeer,a),a}catch(e){throw this.log.error("error while pinging %p",s.remotePeer,e),r?.abort(e),e}finally{null!=r&&await r.close(t)}}}function NP(e={}){return t=>new NT(t,e)}!function(e){let t,r,n;!function(e){e.FIN="FIN",e.STOP_SENDING="STOP_SENDING",e.RESET="RESET",e.FIN_ACK="FIN_ACK"}(t=e.Flag||(e.Flag={})),function(e){e[e.FIN=0]="FIN",e[e.STOP_SENDING=1]="STOP_SENDING",e[e.RESET=2]="RESET",e[e.FIN_ACK=3]="FIN_ACK"}(r||(r={})),function(e){e.codec=()=>nB(r)}(t=e.Flag||(e.Flag={})),e.codec=()=>(null==n&&(n=nM((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.flag&&(r.uint32(8),e.Flag.codec().encode(t.flag,r)),null!=t.message&&(r.uint32(18),r.bytes(t.message)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.flag=e.Flag.codec().decode(t);break;case 2:i.message=t.bytes();break;default:t.skipType(7&r)}}return i})),n),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(e$||(e$={}));let NR=["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"],NO=Array.from("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"),NN="libp2p+webrtc+v1/",ND=466,NB=2097152,NM=3e4,NL=16384,NF=function(e=NL){let t=rY(e-rY(e)),r=1+rY(Object.keys(e$.Flag).length-1),n=1,i=rY(e-t-r-1);return t+r+n+i}(),NU=5e3,Nj=5e3,N$=3e4,NH="/webrtc",Nq="/webrtc-signaling/0.0.1",Nz="/libp2p/webrtc-direct/certificate",NV="webrtc-direct-certificate-private-key",NK=12096e5,NG=864e5;var NW=r(49509),NQ=function(e,t,r){if(r||2==arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},NJ=function(){return function(e,t,r){this.name=e,this.version=t,this.os=r,this.type="browser"}}(),NZ=function(){return function(e){this.version=e,this.type="node",this.name="node",this.os=NW.platform}}(),NY=function(){return function(e,t,r,n){this.name=e,this.version=t,this.os=r,this.bot=n,this.type="bot-device"}}(),NX=function(){return function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}}(),N0=function(){return function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}}(),N1=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,N2=3,N3=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],N4=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function N5(e){return""!==e&&N3.reduce(function(t,r){var n=r[0],i=r[1];if(t)return t;var s=i.exec(e);return!!s&&[n,s]},!1)}function N6(e){var t=N5(e);if(!t)return null;var r=t[0],n=t[1];if("searchbot"===r)return new NX;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<N2&&(i=NQ(NQ([],i,!0),N9(N2-i.length),!0)):i=[];var s=i.join("."),o=N8(e),a=N1.exec(e);return a&&a[1]?new NY(r,s,o,a[1]):new NJ(r,s,o)}function N8(e){for(var t=0,r=N4.length;t<r;t++){var n=N4[t],i=n[0];if(n[1].exec(e))return i}return null}function N7(){return void 0!==NW&&NW.version?new NZ(NW.version.slice(1)):null}function N9(e){for(var t=[],r=0;r<e;r++)t.push("0");return t}let De=function e(e){return e?N6(e):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new N0:"undefined"!=typeof navigator?N6(navigator.userAgent):N7()}(),Dt=null!=De&&"firefox"===De.name,Dr=async function*(){},Dn=async e=>{};function Di(e,t,r=N$,n){"open"===e.readyState&&Promise.resolve().then(async()=>{if(e.bufferedAmount>0){n.log("%s drain channel with %d buffered bytes",t,e.bufferedAmount);let i=(0,a9.A)(),s=!1;e.bufferedAmountLowThreshold=0;let o=()=>{s||(n.log("%s drain channel closed before drain",t),i.resolve())};e.addEventListener("close",o,{once:!0}),e.addEventListener("bufferedamountlow",()=>{s=!0,e.removeEventListener("close",o),i.resolve()}),await lu(i.promise,{milliseconds:r})}}).then(async()=>{"open"===e.readyState&&e.close()}).catch(e=>{n.log.error("error closing outbound stream",e)})}async function Ds(e){return"function"==typeof(e=e??{})&&(e=await e()),e.iceServers=e.iceServers??NR.map(e=>({urls:[e]})),e}let Do=(e=32)=>NN+[...Array(e)].map(()=>NO.at(Math.floor(Math.random()*NO.length))).join("");class Da{log;peerConnection;remoteAddr;timeline;metrics;source=Dr();sink=Dn;constructor(e,t){this.log=e.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=t.remoteAddr,this.timeline=t.timeline,this.peerConnection=t.peerConnection;let r=this.peerConnection,n=r.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",r.connectionState,"initial state",n),("disconnected"===r.connectionState||"failed"===r.connectionState||"closed"===r.connectionState)&&(this.timeline.close=Date.now())}}async close(e){this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({close:!0})}abort(e){this.log.error("closing connection due to error",e),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({abort:!0})}}let Dl=8,Dc=4194304;class Du extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class Dh extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class Dd extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}class Df extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}function Dp(e){return null!=e[Symbol.asyncIterator]}function Dg(e,t){if(e.byteLength>t)throw new Dh("Message length too long")}let Dm=e=>{let t=rY(e),r=(0,t9.K)(t);return r3(e,r),Dm.bytes=t,r};function Dy(e,t){let r=(t=t??{}).lengthEncoder??Dm,n=t?.maxDataLength??Dc;function*i(e){Dg(e,n);let t=r(e.byteLength);t instanceof Uint8Array?yield t:yield*t,e instanceof Uint8Array?yield e:yield*e}return Dp(e)?async function*(){for await(let t of e)yield*i(t)}():function*(){for(let t of e)yield*i(t)}()}Dm.bytes=0,Dy.single=(e,t)=>{let r=(t=t??{}).lengthEncoder??Dm;return Dg(e,t?.maxDataLength??Dc),new ro(r(e.byteLength),e)},function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(eH||(eH={}));let Db=e=>{let t=r4(e);return Db.bytes=rY(t),t};function Dw(e,t){let r=new ro,n=eH.LENGTH,i=-1,s=t?.lengthDecoder??Db,o=t?.maxLengthLength??Dl,a=t?.maxDataLength??Dc;function*l(){for(;r.byteLength>0;){if(n===eH.LENGTH)try{if((i=s(r))<0)throw new Du("Invalid message length");if(i>a)throw new Dh("Message length too long");let e=s.bytes;r.consume(e),t?.onLength!=null&&t.onLength(i),n=eH.DATA}catch(e){if(e instanceof RangeError){if(r.byteLength>o)throw new Dd("Message length length too long");break}throw e}if(n===eH.DATA){if(r.byteLength<i)break;let e=r.sublist(0,i);r.consume(i),t?.onData!=null&&t.onData(e),yield e,n=eH.LENGTH}}}return Dp(e)?async function*(){for await(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new Df("Unexpected end of input")}():function*(){for(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new Df("Unexpected end of input")}()}Db.bytes=0,Dw.fromReader=(e,t)=>{let r=1,n=async function*(){for(;;)try{let{done:t,value:n}=await e.next(r);if(!0===t)return;null!=n&&(yield n)}catch(e){if("ERR_UNDER_READ"===e.code)return{done:!0,value:null};throw e}finally{r=1}}(),i=e=>{r=e};return Dw(n,{...t??{},onLength:i})};class Dv extends CO{channel;incomingData;maxBufferedAmount;bufferedAmountLowEventTimeout;maxMessageSize;receiveFinAck;finAckTimeout;openTimeout;closeController;constructor(e){let t=e.onEnd;switch(e.onEnd=e=>{this.log.trace('readable and writeable ends closed with status "%s"',this.status),Promise.resolve(async()=>{if(null==this.timeline.abort&&null===this.timeline.reset)try{await lu(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(e){this.log.error("error receiving FIN_ACK",e)}}).then(()=>{this.incomingData.end(),t?.(e)}).catch(e=>{this.log.error("error ending stream",e)}).finally(()=>{this.channel.close()})},super(e),this.channel=e.channel,this.channel.binaryType="arraybuffer",this.incomingData=(0,li.Ny)(),this.bufferedAmountLowEventTimeout=e.bufferedAmountLowEventTimeout??NM,this.maxBufferedAmount=e.maxBufferedAmount??NB,this.maxMessageSize=(e.maxMessageSize??NL)-NF,this.receiveFinAck=(0,a9.A)(),this.finAckTimeout=e.closeTimeout??NU,this.openTimeout=e.openTimeout??Nj,this.closeController=new AbortController,this.channel.readyState){case"open":this.timeline.open=new Date().getTime();break;case"closed":case"closing":(void 0===this.timeline.close||0===this.timeline.close)&&(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new uM("Unknown datachannel state")}this.channel.onopen=e=>{this.timeline.open=new Date().getTime()},this.channel.onclose=e=>{this.log.trace("received onclose event"),this.closeController.abort(),this.receiveFinAck.resolve(),this.close().catch(e=>{this.log.error("error closing stream after channel closed",e)})},this.channel.onerror=e=>{this.log.trace("received onerror event"),this.closeController.abort();let t=e.error;this.abort(t)},this.channel.onmessage=async e=>{let{data:t}=e;null!==t&&0!==t.byteLength&&this.incomingData.push(new Uint8Array(t,0,t.byteLength))};let r=this;Promise.resolve().then(async()=>{for await(let e of Dw(this.incomingData)){let t=r.processIncomingProtobuf(e);null!=t&&r.sourcePush(new ro(t))}}).catch(e=>{this.log.error("error processing incoming data channel messages",e)})}sendNewStream(){}async _sendMessage(e,t=!0){if("closed"===this.channel.readyState||"closing"===this.channel.readyState)throw new uM(`Invalid datachannel state - ${this.channel.readyState}`);if("open"!==this.channel.readyState){let e=AbortSignal.timeout(this.openTimeout),t=hQ([this.closeController.signal,e]);try{this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),await u0(this.channel,"open",t)}finally{t.clear()}this.log('channel state is now "%s", sending data',this.channel.readyState)}if(t&&this.channel.bufferedAmount>this.maxBufferedAmount){let e=AbortSignal.timeout(this.bufferedAmountLowEventTimeout),t=hQ([this.closeController.signal,e]);try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),await u0(this.channel,"bufferedamountlow",t)}catch(t){if(e.aborted)throw new uV(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`);throw t}finally{t.clear()}}try{this.log.trace('sending message, channel state "%s"',this.channel.readyState),this.channel.send(e.subarray())}catch(e){this.log.error("error while sending message",e)}}async sendData(e){let t=e.byteLength;for(e=e.sublist();e.byteLength>0;){let r=Math.min(e.byteLength,this.maxMessageSize),n=e.subarray(0,r),i=e$.encode({message:n}),s=Dy.single(i);this.log.trace("sending %d/%d bytes on channel",n.byteLength,t),await this._sendMessage(s),e.consume(r)}this.log.trace('finished sending data, channel state "%s"',this.channel.readyState)}async sendReset(){try{await this._sendFlag(e$.Flag.RESET)}catch(e){this.log.error("failed to send reset - %e",e)}finally{this.channel.close()}}async sendCloseWrite(e){if("open"!==this.channel.readyState)return void this.receiveFinAck.resolve();if(await this._sendFlag(e$.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{await (0,u3.W)(this.receiveFinAck.promise,e?.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorName:"FinAckNotReceivedError"})}catch(e){this.log.error("failed to await FIN_ACK",e)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()}async sendCloseRead(){"open"===this.channel.readyState&&await this._sendFlag(e$.Flag.STOP_SENDING)}processIncomingProtobuf(e){let t=e$.decode(e);if(void 0!==t.flag&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',t.flag,this.writeStatus,this.readStatus),t.flag===e$.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(e$.Flag.FIN_ACK).catch(e=>{this.log.error("error sending FIN_ACK immediately",e)})),t.flag===e$.Flag.RESET&&this.reset(),t.flag===e$.Flag.STOP_SENDING&&this.remoteCloseRead(),t.flag===e$.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),"ready"===this.readStatus)return t.message}async _sendFlag(e){if("open"!==this.channel.readyState)return this.log.trace('not sending flag %s because channel is "%s" and not "open"',e.toString(),this.channel.readyState),!1;this.log.trace("sending flag %s",e.toString());let t=e$.encode({flag:e}),r=Dy.single(t);try{return await this._sendMessage(r,!1),!0}catch(t){this.log.error("could not send flag %s - %e",e.toString(),t)}return!1}}function DE(e){let{channel:t,direction:r,handshake:n}=e;return new Dv({id:`${t.id}`,log:e.logger.forComponent(`libp2p:webrtc:stream:${!0===n?"handshake":r}:${t.id}`),...e})}class DA{protocol;peerConnection;bufferedStreams=[];metrics;dataChannelOptions;components;log;constructor(e,t){this.components=e,this.peerConnection=t.peerConnection,this.metrics=t.metrics,this.protocol=t.protocol??NH,this.dataChannelOptions=t.dataChannelOptions??{},this.log=e.logger.forComponent("libp2p:webrtc:muxerfactory"),this.peerConnection.ondatachannel=({channel:t})=>{if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',t.id),"init"===t.label){this.log.trace("closing early init channel"),t.close();return}let r={},n=DE({channel:t,direction:"inbound",onEnd:e=>{r.onEnd(e)},logger:e.logger,...this.dataChannelOptions});r.stream=n,r.channel=t,r.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter(e=>e.stream.id!==n.id)},this.bufferedStreams.push(r)}}createStreamMuxer(e){return new Dx(this.components,{...e,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol})}}class Dx{init;streams;protocol;log;peerConnection;dataChannelOptions;metrics;logger;constructor(e,t){this.init=t,this.log=e.logger.forComponent("libp2p:webrtc:muxer"),this.logger=e.logger,this.streams=t.streams.map(e=>e.stream),this.peerConnection=t.peerConnection,this.protocol=t.protocol??NH,this.metrics=t.metrics,this.dataChannelOptions=t.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:e})=>{if(this.log.trace("incoming datachannel with channel id %d",e.id),"init"===e.label){this.log.trace("closing init channel"),e.close();return}let r=e.id,n=DE({channel:e,direction:"inbound",onEnd:()=>{this.#J(n,e),this.log("incoming channel %s ended",r)},logger:this.logger,...this.dataChannelOptions});this.streams.push(n),this.metrics?.increment({incoming_stream:!0}),t?.onIncomingStream?.(n)},this.init.streams.length>0&&queueMicrotask(()=>{this.init.streams.forEach(e=>{e.onEnd=()=>{this.log("incoming early channel %s ended with state %s",e.channel.id,e.channel.readyState),this.#J(e.stream,e.channel)},this.metrics?.increment({incoming_stream:!0}),this.init?.onIncomingStream?.(e.stream)})})}#J(e,t){this.log.trace("stream %s %s %s onEnd",e.direction,e.id,e.protocol),Di(t,`${e.direction} ${e.id} ${e.protocol}`,this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter(t=>t.id!==e.id),this.metrics?.increment({stream_end:!0}),this.init?.onStreamEnd?.(e)}async close(e){try{await Promise.all(this.streams.map(async t=>t.close(e)))}catch(e){this.abort(e)}}abort(e){for(let t of this.streams)t.abort(e)}source=Dr();sink=Dn;newStream(){let e=this.peerConnection.createDataChannel(""),t=e.id;this.log.trace("opened outgoing datachannel with channel id %s",t);let r=DE({channel:e,direction:"outbound",onEnd:()=>{this.#J(r,e),this.log("outgoing channel %s ended",t)},logger:this.logger,...this.dataChannelOptions});return this.streams.push(r),this.metrics?.increment({outgoing_stream:!0}),r}}let DS=globalThis.RTCPeerConnection,Dk=globalThis.RTCSessionDescription,D_=globalThis.RTCIceCandidate;class DI extends Error{constructor(e){super(`WebRTC transport error: ${e}`),this.name="WebRTCTransportError"}}class DC extends DI{constructor(e="SDP handshake failed"){super(e),this.name="SDPHandshakeFailedError"}}class DT extends DI{constructor(e,t){super(`Invalid fingerprint "${e}" within ${t}`),this.name="WebRTC/InvalidFingerprintError"}}class DP extends DI{constructor(e){super(`A method (${e}) was called though it has been intentionally left unimplemented.`),this.name="WebRTC/UnimplementedError"}}class DR extends DI{constructor(e){super(`unsupported hash algorithm code: ${e} please see the codes at https://github.com/multiformats/multicodec/blob/master/table.csv `),this.name="WebRTC/UnsupportedHashAlgorithmError"}}!function(e){let t,r,n;!function(e){e.SDP_OFFER="SDP_OFFER",e.SDP_ANSWER="SDP_ANSWER",e.ICE_CANDIDATE="ICE_CANDIDATE"}(t=e.Type||(e.Type={})),function(e){e[e.SDP_OFFER=0]="SDP_OFFER",e[e.SDP_ANSWER=1]="SDP_ANSWER",e[e.ICE_CANDIDATE=2]="ICE_CANDIDATE"}(r||(r={})),function(e){e.codec=()=>nB(r)}(t=e.Type||(e.Type={})),e.codec=()=>(null==n&&(n=nM((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.Type.codec().encode(t.type,r)),null!=t.data&&(r.uint32(18),r.string(t.data)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.type=e.Type.codec().decode(t);break;case 2:i.data=t.string();break;default:t.skipType(7&r)}}return i})),n),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(eq||(eq={}));let DO=async(e,t,r)=>{try{let n=(0,a9.A)();for(DD(e,n);;){let i=await Promise.race([n.promise,t.read({signal:r.signal}).catch(()=>{})]);if(null==i){r.signal?.throwIfAborted();break}if(i.type!==eq.Type.ICE_CANDIDATE)throw new uq("ICE candidate message expected");let s=JSON.parse(i.data??"null");if(""===s||null===s){r.onProgress?.(new nV("webrtc:end-of-ice-candidates")),r.log.trace("end-of-candidates received");continue}let o=new D_(s);r.log.trace("%s received new ICE candidate %o",r.direction,s);try{r.onProgress?.(new nV("webrtc:add-ice-candidate",o.candidate)),await e.addIceCandidate(o)}catch(e){r.log.error("%s bad candidate received",r.direction,s,e)}}}catch(t){if(r.log.error("%s error parsing ICE candidate",r.direction,t),r.signal?.aborted===!0&&"connected"!==DN(e))throw t}};function DN(e){return Dt?e.iceConnectionState:e.connectionState}function DD(e,t){e[Dt?"oniceconnectionstatechange":"onconnectionstatechange"]=r=>{switch(DN(e)){case"connected":t.resolve();break;case"failed":case"disconnected":case"closed":t.reject(new uN("RTCPeerConnection was closed"))}}}async function DB({rtcConfiguration:e,dataChannel:t,signal:r,metrics:n,multiaddr:i,connectionManager:s,transportManager:o,log:a,logger:l,onProgress:c}){let u,{baseAddr:h}=Dj(i);n?.dialerEvents.increment({open:!0}),a.trace("dialing base address: %a",h);let d=h.getPeerId();if(null==d)throw new uC("Relay peer was missing");let f=s.getConnections(yT(d)),p=!1;0===f.length?(c?.(new nV("webrtc:dial-relay")),u=await o.dial(h,{signal:r,onProgress:c}),p=!0):(c?.(new nV("webrtc:reuse-relay-connection")),u=f[0]);try{c?.(new nV("webrtc:open-signaling-stream"));let n=await u.newStream(Nq,{signal:r,runOnLimitedConnection:!0}),s=Tv(n).pb(eq),o=new DS(e),h=new DA({logger:l},{peerConnection:o,dataChannelOptions:t});try{let e=o.createDataChannel("init");o.onicecandidate=({candidate:e})=>{let t=JSON.stringify(e?.toJSON()??null);a.trace("initiator sending ICE candidate %o",e),s.write({type:eq.Type.ICE_CANDIDATE,data:t},{signal:r}).catch(e=>{a.error("error sending ICE candidate",e)})},o.onicecandidateerror=e=>{a.error("initiator ICE candidate error",e)};let t=await o.createOffer().catch(e=>{throw a.error("could not execute createOffer",e),new DC("Failed to set createOffer")});a.trace("initiator send SDP offer %s",t.sdp),c?.(new nV("webrtc:send-sdp-offer")),await s.write({type:eq.Type.SDP_OFFER,data:t.sdp},{signal:r}),await o.setLocalDescription(t).catch(e=>{throw a.error("could not execute setLocalDescription",e),new DC("Failed to set localDescription")}),c?.(new nV("webrtc:read-sdp-answer")),a.trace("initiator read SDP answer");let l=await s.read({signal:r});if(l.type!==eq.Type.SDP_ANSWER)throw new DC("Remote should send an SDP answer");a.trace("initiator received SDP answer %s",l.data);let u=new Dk({type:"answer",sdp:l.data});return await o.setRemoteDescription(u).catch(e=>{throw a.error("could not execute setRemoteDescription",e),new DC("Failed to set remoteDescription")}),a.trace("initiator read candidates until connected"),c?.(new nV("webrtc:read-ice-candidates")),await DO(o,s,{direction:"initiator",signal:r,log:a,onProgress:c}),a.trace("initiator connected, closing init channel"),e.close(),c?.(new nV("webrtc:close-signaling-stream")),a.trace("closing signaling channel"),await n.close({signal:r}),a.trace("initiator connected to remote address %s",i),{remoteAddress:i,peerConnection:o,muxerFactory:h}}catch(e){throw a.error("outgoing signaling error",e),o.close(),n.abort(e),e}finally{o.onicecandidate=null,o.onicecandidateerror=null}}finally{if(p)try{await u.close({signal:r})}catch(e){u.abort(e)}}}let DM=wP(w7.matchers[0],wA("p2p-circuit"));class DL extends uS{transportManager;shutdownController;events;constructor(e,t){super(),this.transportManager=e.transportManager,this.events=e.events,this.shutdownController=t.shutdownController,this.onTransportListening=this.onTransportListening.bind(this)}async listen(){this.events.addEventListener("transport:listening",this.onTransportListening)}onTransportListening(e){e.detail.getAddrs().filter(e=>DM.exactMatch(e)).map(e=>e.encapsulate("/webrtc")).length>0&&this.safeDispatchEvent("listening")}getAddrs(){return this.transportManager.getListeners().filter(e=>!(e instanceof DL)).map(e=>e.getAddrs().filter(e=>DM.exactMatch(e)).map(e=>e.encapsulate("/webrtc"))).flat()}updateAnnounceAddrs(){}async close(){this.events.removeEventListener("transport:listening",this.onTransportListening),this.shutdownController.abort(),queueMicrotask(()=>{this.safeDispatchEvent("close")})}}async function DF({peerConnection:e,stream:t,signal:r,connection:n,log:i}){i.trace("new inbound signaling stream");let s=Tv(t).pb(eq);try{e.onicecandidate=({candidate:e})=>{let t=JSON.stringify(e?.toJSON()??null);i.trace("recipient sending ICE candidate %s",t),s.write({type:eq.Type.ICE_CANDIDATE,data:t},{signal:r}).catch(e=>{i.error("error sending ICE candidate",e)})},i.trace("recipient read SDP offer");let t=await s.read({signal:r});if(t.type!==eq.Type.SDP_OFFER)throw new DC(`expected message type SDP_OFFER, received: ${t.type??"undefined"} `);i.trace("recipient received SDP offer %s",t.data);let n=new Dk({type:"offer",sdp:t.data});await e.setRemoteDescription(n).catch(e=>{throw i.error("could not execute setRemoteDescription",e),new DC("Failed to set remoteDescription")});let o=await e.createAnswer().catch(e=>{throw i.error("could not execute createAnswer",e),new DC("Failed to create answer")});i.trace("recipient send SDP answer %s",o.sdp),await s.write({type:eq.Type.SDP_ANSWER,data:o.sdp},{signal:r}),await e.setLocalDescription(o).catch(e=>{throw i.error("could not execute setLocalDescription",e),new DC("Failed to set localDescription")}),i.trace("recipient read candidates until connected"),await DO(e,s,{direction:"recipient",signal:r,log:i})}catch(t){if("connected"!==DN(e))throw i.error("error while handling signaling stream from peer %a",n.remoteAddr,t),e.close(),t;i("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",n.remoteAddr,t)}let o=wt(`/webrtc/p2p/${n.remoteAddr.getPeerId()}`);return i.trace("recipient connected to remote address %s",o),{remoteAddress:o}}class DU{components;init;log;_started=!1;metrics;shutdownController;constructor(e,t={}){this.components=e,this.init=t,this.log=e.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,this.shutdownController.signal,null!=e.metrics&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}[xh]=!0;[Symbol.toStringTag]="@libp2p/webrtc";[En]=["@libp2p/transport"];[Ei]=["@libp2p/identify","@libp2p/circuit-relay-v2-transport"];isStarted(){return this._started}async start(){await this.components.registrar.handle(Nq,e=>{let t=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);this._onProtocol(e,t).catch(t=>{this.log.error("failed to handle incoming connect from %p",e.connection.remotePeer,t)}).finally(()=>{t.clear()})},{runOnLimitedConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(Nq),this._started=!1}createListener(e){return new DL(this.components,{shutdownController:this.shutdownController})}listenFilter(e){return e.filter(ve.exactMatch)}dialFilter(e){return this.listenFilter(e)}async dial(e,t){this.log.trace("dialing address: %a",e);let{remoteAddress:r,peerConnection:n,muxerFactory:i}=await DB({rtcConfiguration:await Ds(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:e,dataChannelOptions:this.init.dataChannel,signal:t.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:t.onProgress}),s=new Da(this.components,{peerConnection:n,timeline:{open:Date.now()},remoteAddr:r,metrics:this.metrics?.dialerEvents}),o=await t.upgrader.upgradeOutbound(s,{skipProtection:!0,skipEncryption:!0,muxerFactory:i,onProgress:t.onProgress,signal:t.signal});return this._closeOnShutdown(n,s),o}async _onProtocol({connection:e,stream:t},r){let n=new DS(await Ds(this.init.rtcConfiguration)),i=new DA(this.components,{peerConnection:n,dataChannelOptions:this.init.dataChannel});try{let{remoteAddress:s}=await DF({peerConnection:n,connection:e,stream:t,signal:r,log:this.log});await t.close({signal:r});let o=new Da(this.components,{peerConnection:n,timeline:{open:new Date().getTime()},remoteAddr:s,metrics:this.metrics?.listenerEvents});await this.components.upgrader.upgradeInbound(o,{skipEncryption:!0,skipProtection:!0,muxerFactory:i,signal:r}),this._closeOnShutdown(n,o)}catch(e){throw this.log.error("incoming signaling error",e),n.close(),t.abort(e),e}}_closeOnShutdown(e,t){let r=()=>{t.close().catch(e=>{this.log.error("could not close WebRTCMultiaddrConnection",e)})};this.shutdownController.signal.addEventListener("abort",r),e.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",r)})}}function Dj(e){let t=e.toString().split("/webrtc/");if(2!==t.length)throw new uC("webrtc protocol was not present in multiaddr");if(!t[0].includes("/p2p-circuit"))throw new uC("p2p-circuit protocol was not present in multiaddr");let r=wt(t[0]),n=wt("/"+t[1]).getPeerId();if(null==n)throw new uC("destination peer id was missing");let i=r.protos().pop();if(void 0===i)throw new uC("invalid multiaddr");return"p2p"!==i.name&&(r=r.encapsulate(`/p2p/${n}`)),{baseAddr:r,peerId:yT(n)}}r(83548),function(e){e[e.Sequence=0]="Sequence",e[e.Set=1]="Set",e[e.Choice=2]="Choice"}(ez||(ez={})),function(e){e[e.Any=1]="Any",e[e.Boolean=2]="Boolean",e[e.OctetString=3]="OctetString",e[e.BitString=4]="BitString",e[e.Integer=5]="Integer",e[e.Enumerated=6]="Enumerated",e[e.ObjectIdentifier=7]="ObjectIdentifier",e[e.Utf8String=8]="Utf8String",e[e.BmpString=9]="BmpString",e[e.UniversalString=10]="UniversalString",e[e.NumericString=11]="NumericString",e[e.PrintableString=12]="PrintableString",e[e.TeletexString=13]="TeletexString",e[e.VideotexString=14]="VideotexString",e[e.IA5String=15]="IA5String",e[e.GraphicString=16]="GraphicString",e[e.VisibleString=17]="VisibleString",e[e.GeneralString=18]="GeneralString",e[e.CharacterString=19]="CharacterString",e[e.UTCTime=20]="UTCTime",e[e.GeneralizedTime=21]="GeneralizedTime",e[e.DATE=22]="DATE",e[e.TimeOfDay=23]="TimeOfDay",e[e.DateTime=24]="DateTime",e[e.Duration=25]="Duration",e[e.TIME=26]="TIME",e[e.Null=27]="Null"}(eV||(eV={}));class D${constructor(e,t=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if("number"==typeof e)this.fromNumber(e);else if(Ec._H.isBufferSource(e))this.unusedBits=t,this.value=Ec._H.toArrayBuffer(e);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(e){if(!(e instanceof Ae))throw TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new Ae({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new Ae({name:e})}toNumber(){let e="";for(let t of new Uint8Array(this.value))e+=t.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let t=e.toString(2),r=t.length+7>>3;this.unusedBits=(r<<3)-t.length;let n=new Uint8Array(r);t=t.padStart(r<<3,"0").split("").reverse().join("");let i=0;for(;i<r;)n[i]=parseInt(t.slice(i<<3,(i<<3)+8),2),i++;this.value=n.buffer}}class DH{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(e){"number"==typeof e?this.buffer=new ArrayBuffer(e):Ec._H.isBufferSource(e)?this.buffer=Ec._H.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}fromASN(e){if(!(e instanceof E7))throw TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new E7({valueHex:this.buffer})}toSchema(e){return new E7({name:e})}}let Dq={fromASN:e=>e instanceof E4?null:e.valueBeforeDecodeView,toASN:e=>{if(null===e)return new E4;let t=EY(e);if(t.result.error)throw Error(t.result.error);return t.result}},Dz={fromASN:e=>e.valueBlock.valueHexView.byteLength>=4?e.valueBlock.toString():e.valueBlock.valueDec,toASN:e=>new As({value:+e})},DV={fromASN:e=>e.valueBlock.valueDec,toASN:e=>new Ao({value:e})},DK={fromASN:e=>e.valueBlock.valueHexView,toASN:e=>new As({valueHex:e})},DG={fromASN:e=>e.valueBlock.valueHexView,toASN:e=>new Ae({valueHex:e})},DW={fromASN:e=>e.valueBlock.toString(),toASN:e=>new Ac({value:e})},DQ={fromASN:e=>e.valueBlock.value,toASN:e=>new E6({value:e})},DJ={fromASN:e=>e.valueBlock.valueHexView,toASN:e=>new E7({valueHex:e})},DZ={fromASN:e=>new DH(e.getValue()),toASN:e=>e.toASN()};function DY(e){return{fromASN:e=>e.valueBlock.value,toASN:t=>new e({value:t})}}let DX=DY(Aw),D0=DY(AE),D1=DY(Ax),D2=DY(AS),D3=DY(Ak),D4=DY(A_),D5=DY(AI),D6=DY(AC),D8=DY(AT),D7=DY(AP),D9=DY(AR),Be=DY(AO),Bt={fromASN:e=>e.toDate(),toASN:e=>new AN({valueDate:e})},Br={fromASN:e=>e.toDate(),toASN:e=>new AD({valueDate:e})},Bn={fromASN:()=>null,toASN:()=>new E4};function Bi(e){switch(e){case eV.Any:return Dq;case eV.BitString:return DG;case eV.BmpString:return D0;case eV.Boolean:return DQ;case eV.CharacterString:return Be;case eV.Enumerated:return DV;case eV.GeneralString:return D9;case eV.GeneralizedTime:return Br;case eV.GraphicString:return D8;case eV.IA5String:return D6;case eV.Integer:return Dz;case eV.Null:return Bn;case eV.NumericString:return D2;case eV.ObjectIdentifier:return DW;case eV.OctetString:return DJ;case eV.PrintableString:return D3;case eV.TeletexString:return D4;case eV.UTCTime:return Bt;case eV.UniversalString:return D1;case eV.Utf8String:return DX;case eV.VideotexString:return D5;case eV.VisibleString:return D7;default:return null}}function Bs(e){return"function"==typeof e&&e.prototype?!!e.prototype.toASN&&!!e.prototype.fromASN||Bs(e.prototype):!!(e&&"object"==typeof e&&"toASN"in e&&"fromASN"in e)}function Bo(e){var t;if(e){let r=Object.getPrototypeOf(e);return(null==(t=null==r?void 0:r.prototype)?void 0:t.constructor)===Array||Bo(r)}return!1}function Ba(e,t){if(!(e&&t)||e.byteLength!==t.byteLength)return!1;let r=new Uint8Array(e),n=new Uint8Array(t);for(let t=0;t<e.byteLength;t++)if(r[t]!==n[t])return!1;return!0}class Bl{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,t=!1){let r=this.items.get(e);if(!r)throw Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(t&&!r.schema)throw Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return r}cache(e){let t=this.get(e);t.schema||(t.schema=this.create(e,!0))}createDefault(e){let t={type:ez.Sequence,items:{}},r=this.findParentSchema(e);return r&&(Object.assign(t,r),t.items=Object.assign({},t.items,r.items)),t}create(e,t){let r=this.items.get(e)||this.createDefault(e),n=[];for(let e in r.items){let i,s=r.items[e],o=t?e:"";if("number"==typeof s.type){let e=eV[s.type],t=t3[e];if(!t)throw Error(`Cannot get ASN1 class by name '${e}'`);i=new t({name:o})}else Bs(s.type)?i=new s.type().toSchema(o):s.optional?this.get(s.type).type===ez.Choice?i=new Aj({name:o}):(i=this.create(s.type,!1)).name=o:i=new Aj({name:o});let a=!!s.optional||void 0!==s.defaultValue;if(s.repeated&&(i.name="",i=new("set"===s.repeated?Ap:Af)({name:"",value:[new AH({name:o,value:i})]})),null!==s.context&&void 0!==s.context)if(s.implicit)if("number"==typeof s.type||Bs(s.type)){let e=s.repeated?E1:EQ;n.push(new e({name:o,optional:a,idBlock:{tagClass:3,tagNumber:s.context}}))}else{this.cache(s.type);let e=!!s.repeated,t=e?i:this.get(s.type,!0).schema;t="valueBlock"in t?t.valueBlock.value:t.value,n.push(new E1({name:e?"":o,optional:a,idBlock:{tagClass:3,tagNumber:s.context},value:t}))}else n.push(new E1({optional:a,idBlock:{tagClass:3,tagNumber:s.context},value:[i]}));else i.optional=a,n.push(i)}switch(r.type){case ez.Sequence:return new Af({value:n,name:""});case ez.Set:return new Ap({value:n,name:""});case ez.Choice:return new A$({value:n,name:""});default:throw Error("Unsupported ASN1 type in use")}}set(e,t){return this.items.set(e,t),this}findParentSchema(e){let t=Object.getPrototypeOf(e);return t?this.items.get(t)||this.findParentSchema(t):null}}let Bc=new Bl,Bu=e=>t=>{let r;Bc.has(t)?r=Bc.get(t):(r=Bc.createDefault(t),Bc.set(t,r)),Object.assign(r,e)},Bh=e=>(t,r)=>{let n;Bc.has(t.constructor)?n=Bc.get(t.constructor):(n=Bc.createDefault(t.constructor),Bc.set(t.constructor,n));let i=Object.assign({},e);if("number"==typeof i.type&&!i.converter){let n=Bi(e.type);if(!n)throw Error(`Cannot get default converter for property '${r}' of ${t.constructor.name}`);i.converter=n}n.items[r]=i};class Bd extends Error{constructor(){super(...arguments),this.schemas=[]}}class Bf{static parse(e,t){let r=EY(e);if(r.result.error)throw Error(r.result.error);return this.fromASN(r.result,t)}static fromASN(e,t){var r;try{if(Bs(t))return new t().fromASN(e);let n=Bc.get(t);Bc.cache(t);let i=n.schema;if(e.constructor===E1&&n.type!==ez.Choice)for(let t in i=new E1({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:n.schema.valueBlock.value}),n.items)delete e[t];let s=Az({},e,i);if(!s.verified)throw new Bd(`Data does not match to ${t.name} ASN1 schema. ${s.result.error}`);let o=new t;if(Bo(t)){if(!("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)))throw Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let r=n.itemType;if("number"!=typeof r)return t.from(e.valueBlock.value,e=>this.fromASN(e,r));{let n=Bi(r);if(!n)throw Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);return t.from(e.valueBlock.value,e=>n.fromASN(e))}}for(let e in n.items){let t=s.result[e];if(!t)continue;let i=n.items[e],a=i.type;if("number"==typeof a||Bs(a)){let n=null!=(r=i.converter)?r:Bs(a)?new a:null;if(!n)throw Error("Converter is empty");if(i.repeated)if(i.implicit){let r=new("sequence"===i.repeated?Af:Ap);r.valueBlock=t.valueBlock;let s=EY(r.toBER(!1));if(-1===s.offset)throw Error(`Cannot parse the child item. ${s.result.error}`);if(!("value"in s.result.valueBlock&&Array.isArray(s.result.valueBlock.value)))throw Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let a=s.result.valueBlock.value;o[e]=Array.from(a,e=>n.fromASN(e))}else o[e]=Array.from(t,e=>n.fromASN(e));else{let r=t;if(i.implicit){let e;if(Bs(a))e=new a().toSchema("");else{let t=eV[a],r=t3[t];if(!r)throw Error(`Cannot get '${t}' class from asn1js module`);e=new r}e.valueBlock=r.valueBlock,r=EY(e.toBER(!1)).result}o[e]=n.fromASN(r)}}else if(i.repeated){if(!Array.isArray(t))throw Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");o[e]=Array.from(t,e=>this.fromASN(e,a))}else o[e]=this.fromASN(t,a)}return o}catch(e){throw e instanceof Bd&&e.schemas.push(t.name),e}}}class Bp{static serialize(e){return e instanceof EV?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){let t;if(e&&"object"==typeof e&&Bs(e))return e.toASN();if(!(e&&"object"==typeof e))throw TypeError("Parameter 1 should be type of Object.");let r=e.constructor,n=Bc.get(r);Bc.cache(r);let i=[];if(n.itemType){if(!Array.isArray(e))throw TypeError("Parameter 1 should be type of Array.");if("number"==typeof n.itemType){let t=Bi(n.itemType);if(!t)throw Error(`Cannot get default converter for array item of ${r.name} ASN1 schema`);i=e.map(e=>t.toASN(e))}else i=e.map(e=>this.toAsnItem({type:n.itemType},"[]",r,e))}else for(let t in n.items){let s=n.items[t],o=e[t];if(void 0===o||s.defaultValue===o||"object"==typeof s.defaultValue&&"object"==typeof o&&Ba(this.serialize(s.defaultValue),this.serialize(o)))continue;let a=Bp.toAsnItem(s,t,r,o);if("number"==typeof s.context)if(s.implicit)if(!s.repeated&&("number"==typeof s.type||Bs(s.type))){let e={};e.valueHex=a instanceof E4?a.valueBeforeDecodeView:a.valueBlock.toBER(),i.push(new EQ({optional:s.optional,idBlock:{tagClass:3,tagNumber:s.context},...e}))}else i.push(new E1({optional:s.optional,idBlock:{tagClass:3,tagNumber:s.context},value:a.valueBlock.value}));else i.push(new E1({optional:s.optional,idBlock:{tagClass:3,tagNumber:s.context},value:[a]}));else s.repeated?i=i.concat(a):i.push(a)}switch(n.type){case ez.Sequence:t=new Af({value:i});break;case ez.Set:t=new Ap({value:i});break;case ez.Choice:if(!i[0])throw Error(`Schema '${r.name}' has wrong data. Choice cannot be empty.`);t=i[0]}return t}static toAsnItem(e,t,r,n){let i;if("number"==typeof e.type){let s=e.converter;if(!s)throw Error(`Property '${t}' doesn't have converter for type ${eV[e.type]} in schema '${r.name}'`);if(e.repeated){if(!Array.isArray(n))throw TypeError("Parameter 'objProp' should be type of Array.");let t=Array.from(n,e=>s.toASN(e));i=new("sequence"===e.repeated?Af:Ap)({value:t})}else i=s.toASN(n)}else if(e.repeated){if(!Array.isArray(n))throw TypeError("Parameter 'objProp' should be type of Array.");let t=Array.from(n,e=>this.toASN(e));i=new("sequence"===e.repeated?Af:Ap)({value:t})}else i=this.toASN(n);return i}}class Bg extends Array{constructor(e=[]){if("number"==typeof e)super(e);else for(let t of(super(),e))this.push(t)}}class Bm{static serialize(e){return Bp.serialize(e)}static parse(e,t){return Bf.parse(e,t)}static toString(e){let t=EY(Ec._H.isBufferSource(e)?Ec._H.toArrayBuffer(e):Bm.serialize(e));if(-1===t.offset)throw Error(`Cannot decode ASN.1 data. ${t.result.error}`);return t.result.toString()}}var By=r(39249);class Bb{static isIPv4(e){return/^(\d{1,3}\.){3}\d{1,3}$/.test(e)}static parseIPv4(e){let t=e.split(".");if(4!==t.length)throw Error("Invalid IPv4 address");return t.map(e=>{let t=parseInt(e,10);if(isNaN(t)||t<0||t>255)throw Error("Invalid IPv4 address part");return t})}static parseIPv6(e){let t=this.expandIPv6(e).split(":");if(8!==t.length)throw Error("Invalid IPv6 address");return t.reduce((e,t)=>{let r=parseInt(t,16);if(isNaN(r)||r<0||r>65535)throw Error("Invalid IPv6 address part");return e.push(r>>8&255),e.push(255&r),e},[])}static expandIPv6(e){if(!e.includes("::"))return e;let t=e.split("::");if(t.length>2)throw Error("Invalid IPv6 address");let r=t[0]?t[0].split(":"):[],n=t[1]?t[1].split(":"):[],i=8-(r.length+n.length);if(i<0)throw Error("Invalid IPv6 address");return[...r,...Array(i).fill("0"),...n].join(":")}static formatIPv6(e){let t=[];for(let r=0;r<16;r+=2)t.push((e[r]<<8|e[r+1]).toString(16));return this.compressIPv6(t.join(":"))}static compressIPv6(e){let t=e.split(":"),r=-1,n=0,i=-1,s=0;for(let e=0;e<t.length;e++)"0"===t[e]?(-1===i&&(i=e),s++):(s>n&&(r=i,n=s),i=-1,s=0);if(s>n&&(r=i,n=s),n>1){let e=t.slice(0,r).join(":"),i=t.slice(r+n).join(":");return`${e}::${i}`}return e}static parseCIDR(e){let[t,r]=e.split("/"),n=parseInt(r,10);if(this.isIPv4(t)){if(n<0||n>32)throw Error("Invalid IPv4 prefix length");return[this.parseIPv4(t),n]}if(n<0||n>128)throw Error("Invalid IPv6 prefix length");return[this.parseIPv6(t),n]}static decodeIP(e){if(64===e.length&&0===parseInt(e,16))return"::/0";if(16!==e.length)return e;let t=parseInt(e.slice(8),16).toString(2).split("").reduce((e,t)=>e+ +t,0),r=e.slice(0,8).replace(/(.{2})/g,e=>`${parseInt(e,16)}.`);return r=r.slice(0,-1),`${r}/${t}`}static toString(e){let t=new Uint8Array(e);if(4===t.length)return Array.from(t).join(".");if(16===t.length)return this.formatIPv6(t);if(8===t.length||32===t.length){let e=t.length/2,r=t.slice(0,e),n=t.slice(e);if(t.every(e=>0===e))return 8===t.length?"0.0.0.0/0":"::/0";let i=n.reduce((e,t)=>e+(t.toString(2).match(/1/g)||[]).length,0);if(8===t.length){let e=Array.from(r).join(".");return`${e}/${i}`}{let e=this.formatIPv6(r);return`${e}/${i}`}}return this.decodeIP(Ec.U$.ToHex(e))}static fromString(e){if(e.includes("/")){let[t,r]=this.parseCIDR(e),n=new Uint8Array(t.length),i=r;for(let e=0;e<n.length;e++)i>=8?(n[e]=255,i-=8):i>0&&(n[e]=255<<8-i,i=0);let s=new Uint8Array(2*t.length);return s.set(t,0),s.set(n,t.length),s.buffer}return new Uint8Array(this.isIPv4(e)?this.parseIPv4(e):this.parseIPv6(e)).buffer}}let Bw=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};(0,By.Cg)([Bh({type:eV.TeletexString})],Bw.prototype,"teletexString",void 0),(0,By.Cg)([Bh({type:eV.PrintableString})],Bw.prototype,"printableString",void 0),(0,By.Cg)([Bh({type:eV.UniversalString})],Bw.prototype,"universalString",void 0),(0,By.Cg)([Bh({type:eV.Utf8String})],Bw.prototype,"utf8String",void 0),(0,By.Cg)([Bh({type:eV.BmpString})],Bw.prototype,"bmpString",void 0),Bw=(0,By.Cg)([Bu({type:ez.Choice})],Bw);let Bv=class extends Bw{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?Ec.U$.ToHex(this.anyValue):super.toString())}};(0,By.Cg)([Bh({type:eV.IA5String})],Bv.prototype,"ia5String",void 0),(0,By.Cg)([Bh({type:eV.Any})],Bv.prototype,"anyValue",void 0),Bv=(0,By.Cg)([Bu({type:ez.Choice})],Bv);class BE{constructor(e={}){this.type="",this.value=new Bv,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],BE.prototype,"type",void 0),(0,By.Cg)([Bh({type:Bv})],BE.prototype,"value",void 0);let BA=eK=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,eK.prototype)}};BA=eK=(0,By.Cg)([Bu({type:ez.Set,itemType:BE})],BA);let Bx=eG=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,eG.prototype)}};Bx=eG=(0,By.Cg)([Bu({type:ez.Sequence,itemType:BA})],Bx);let BS=eW=class extends Bx{constructor(e){super(e),Object.setPrototypeOf(this,eW.prototype)}};BS=eW=(0,By.Cg)([Bu({type:ez.Sequence})],BS);let Bk={fromASN:e=>Bb.toString(DJ.fromASN(e)),toASN:e=>DJ.toASN(Bb.fromString(e))};class B_{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],B_.prototype,"typeId",void 0),(0,By.Cg)([Bh({type:eV.Any,context:0})],B_.prototype,"value",void 0);class BI{constructor(e={}){this.partyName=new Bw,Object.assign(this,e)}}(0,By.Cg)([Bh({type:Bw,optional:!0,context:0,implicit:!0})],BI.prototype,"nameAssigner",void 0),(0,By.Cg)([Bh({type:Bw,context:1,implicit:!0})],BI.prototype,"partyName",void 0);let BC=class{constructor(e={}){Object.assign(this,e)}};(0,By.Cg)([Bh({type:B_,context:0,implicit:!0})],BC.prototype,"otherName",void 0),(0,By.Cg)([Bh({type:eV.IA5String,context:1,implicit:!0})],BC.prototype,"rfc822Name",void 0),(0,By.Cg)([Bh({type:eV.IA5String,context:2,implicit:!0})],BC.prototype,"dNSName",void 0),(0,By.Cg)([Bh({type:eV.Any,context:3,implicit:!0})],BC.prototype,"x400Address",void 0),(0,By.Cg)([Bh({type:BS,context:4,implicit:!1})],BC.prototype,"directoryName",void 0),(0,By.Cg)([Bh({type:BI,context:5})],BC.prototype,"ediPartyName",void 0),(0,By.Cg)([Bh({type:eV.IA5String,context:6,implicit:!0})],BC.prototype,"uniformResourceIdentifier",void 0),(0,By.Cg)([Bh({type:eV.OctetString,context:7,implicit:!0,converter:Bk})],BC.prototype,"iPAddress",void 0),(0,By.Cg)([Bh({type:eV.ObjectIdentifier,context:8,implicit:!0})],BC.prototype,"registeredID",void 0),BC=(0,By.Cg)([Bu({type:ez.Choice})],BC);let BT="1.3.6.1.5.5.7",BP=`${BT}.1`,BR=`${BT}.3`,BO=`${BT}.48`,BN=`${BO}.1`,BD=`${BO}.2`,BB=`${BO}.3`,BM=`${BO}.5`,BL="2.5.29",BF=`${BP}.1`;class BU{constructor(e={}){this.accessMethod="",this.accessLocation=new BC,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],BU.prototype,"accessMethod",void 0),(0,By.Cg)([Bh({type:BC})],BU.prototype,"accessLocation",void 0);let Bj=eQ=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,eQ.prototype)}};Bj=eQ=(0,By.Cg)([Bu({type:ez.Sequence,itemType:BU})],Bj);let B$=`${BL}.35`;class BH extends DH{}class Bq{constructor(e={}){e&&Object.assign(this,e)}}(0,By.Cg)([Bh({type:BH,context:0,optional:!0,implicit:!0})],Bq.prototype,"keyIdentifier",void 0),(0,By.Cg)([Bh({type:BC,context:1,optional:!0,implicit:!0,repeated:"sequence"})],Bq.prototype,"authorityCertIssuer",void 0),(0,By.Cg)([Bh({type:eV.Integer,context:2,optional:!0,implicit:!0,converter:DK})],Bq.prototype,"authorityCertSerialNumber",void 0);let Bz=`${BL}.19`;class BV{constructor(e={}){this.cA=!1,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Boolean,defaultValue:!1})],BV.prototype,"cA",void 0),(0,By.Cg)([Bh({type:eV.Integer,optional:!0})],BV.prototype,"pathLenConstraint",void 0);let BK=eJ=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,eJ.prototype)}};BK=eJ=(0,By.Cg)([Bu({type:ez.Sequence,itemType:BC})],BK);let BG=eZ=class extends BK{constructor(e){super(e),Object.setPrototypeOf(this,eZ.prototype)}};BG=eZ=(0,By.Cg)([Bu({type:ez.Sequence})],BG);let BW=`${BL}.32`,BQ=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};(0,By.Cg)([Bh({type:eV.IA5String})],BQ.prototype,"ia5String",void 0),(0,By.Cg)([Bh({type:eV.VisibleString})],BQ.prototype,"visibleString",void 0),(0,By.Cg)([Bh({type:eV.BmpString})],BQ.prototype,"bmpString",void 0),(0,By.Cg)([Bh({type:eV.Utf8String})],BQ.prototype,"utf8String",void 0),BQ=(0,By.Cg)([Bu({type:ez.Choice})],BQ);class BJ{constructor(e={}){this.organization=new BQ,this.noticeNumbers=[],Object.assign(this,e)}}(0,By.Cg)([Bh({type:BQ})],BJ.prototype,"organization",void 0),(0,By.Cg)([Bh({type:eV.Integer,repeated:"sequence"})],BJ.prototype,"noticeNumbers",void 0);class BZ{constructor(e={}){Object.assign(this,e)}}(0,By.Cg)([Bh({type:BJ,optional:!0})],BZ.prototype,"noticeRef",void 0),(0,By.Cg)([Bh({type:BQ,optional:!0})],BZ.prototype,"explicitText",void 0);let BY=class{constructor(e={}){Object.assign(this,e)}};(0,By.Cg)([Bh({type:eV.IA5String})],BY.prototype,"cPSuri",void 0),(0,By.Cg)([Bh({type:BZ})],BY.prototype,"userNotice",void 0),BY=(0,By.Cg)([Bu({type:ez.Choice})],BY);class BX{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],BX.prototype,"policyQualifierId",void 0),(0,By.Cg)([Bh({type:eV.Any})],BX.prototype,"qualifier",void 0);class B0{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],B0.prototype,"policyIdentifier",void 0),(0,By.Cg)([Bh({type:BX,repeated:"sequence",optional:!0})],B0.prototype,"policyQualifiers",void 0);let B1=eY=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,eY.prototype)}};B1=eY=(0,By.Cg)([Bu({type:ez.Sequence,itemType:B0})],B1);let B2=class{constructor(e=0){this.value=e}};(0,By.Cg)([Bh({type:eV.Integer})],B2.prototype,"value",void 0),B2=(0,By.Cg)([Bu({type:ez.Choice})],B2);let B3=class extends B2{};B3=(0,By.Cg)([Bu({type:ez.Choice})],B3);let B4=`${BL}.31`;!function(e){e[e.unused=1]="unused",e[e.keyCompromise=2]="keyCompromise",e[e.cACompromise=4]="cACompromise",e[e.affiliationChanged=8]="affiliationChanged",e[e.superseded=16]="superseded",e[e.cessationOfOperation=32]="cessationOfOperation",e[e.certificateHold=64]="certificateHold",e[e.privilegeWithdrawn=128]="privilegeWithdrawn",e[e.aACompromise=256]="aACompromise"}(e0||(e0={}));class B5 extends D${toJSON(){let e=[],t=this.toNumber();return t&e0.aACompromise&&e.push("aACompromise"),t&e0.affiliationChanged&&e.push("affiliationChanged"),t&e0.cACompromise&&e.push("cACompromise"),t&e0.certificateHold&&e.push("certificateHold"),t&e0.cessationOfOperation&&e.push("cessationOfOperation"),t&e0.keyCompromise&&e.push("keyCompromise"),t&e0.privilegeWithdrawn&&e.push("privilegeWithdrawn"),t&e0.superseded&&e.push("superseded"),t&e0.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}}let B6=class{constructor(e={}){Object.assign(this,e)}};(0,By.Cg)([Bh({type:BC,context:0,repeated:"sequence",implicit:!0})],B6.prototype,"fullName",void 0),(0,By.Cg)([Bh({type:BA,context:1,implicit:!0})],B6.prototype,"nameRelativeToCRLIssuer",void 0),B6=(0,By.Cg)([Bu({type:ez.Choice})],B6);class B8{constructor(e={}){Object.assign(this,e)}}(0,By.Cg)([Bh({type:B6,context:0,optional:!0})],B8.prototype,"distributionPoint",void 0),(0,By.Cg)([Bh({type:B5,context:1,optional:!0,implicit:!0})],B8.prototype,"reasons",void 0),(0,By.Cg)([Bh({type:BC,context:2,optional:!0,repeated:"sequence",implicit:!0})],B8.prototype,"cRLIssuer",void 0);let B7=eX=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,eX.prototype)}};B7=eX=(0,By.Cg)([Bu({type:ez.Sequence,itemType:B8})],B7);let B9=e1=class extends B7{constructor(e){super(e),Object.setPrototypeOf(this,e1.prototype)}};B9=e1=(0,By.Cg)([Bu({type:ez.Sequence,itemType:B8})],B9);class Me{constructor(e={}){this.onlyContainsUserCerts=Me.ONLY,this.onlyContainsCACerts=Me.ONLY,this.indirectCRL=Me.ONLY,this.onlyContainsAttributeCerts=Me.ONLY,Object.assign(this,e)}}Me.ONLY=!1,(0,By.Cg)([Bh({type:B6,context:0,optional:!0})],Me.prototype,"distributionPoint",void 0),(0,By.Cg)([Bh({type:eV.Boolean,context:1,defaultValue:Me.ONLY,implicit:!0})],Me.prototype,"onlyContainsUserCerts",void 0),(0,By.Cg)([Bh({type:eV.Boolean,context:2,defaultValue:Me.ONLY,implicit:!0})],Me.prototype,"onlyContainsCACerts",void 0),(0,By.Cg)([Bh({type:B5,context:3,optional:!0,implicit:!0})],Me.prototype,"onlySomeReasons",void 0),(0,By.Cg)([Bh({type:eV.Boolean,context:4,defaultValue:Me.ONLY,implicit:!0})],Me.prototype,"indirectCRL",void 0),(0,By.Cg)([Bh({type:eV.Boolean,context:5,defaultValue:Me.ONLY,implicit:!0})],Me.prototype,"onlyContainsAttributeCerts",void 0),function(e){e[e.unspecified=0]="unspecified",e[e.keyCompromise=1]="keyCompromise",e[e.cACompromise=2]="cACompromise",e[e.affiliationChanged=3]="affiliationChanged",e[e.superseded=4]="superseded",e[e.cessationOfOperation=5]="cessationOfOperation",e[e.certificateHold=6]="certificateHold",e[e.removeFromCRL=8]="removeFromCRL",e[e.privilegeWithdrawn=9]="privilegeWithdrawn",e[e.aACompromise=10]="aACompromise"}(e2||(e2={}));let Mt=class{constructor(e=e2.unspecified){this.reason=e2.unspecified,this.reason=e}toJSON(){return e2[this.reason]}toString(){return this.toJSON()}};(0,By.Cg)([Bh({type:eV.Enumerated})],Mt.prototype,"reason",void 0),Mt=(0,By.Cg)([Bu({type:ez.Choice})],Mt);let Mr=`${BL}.37`,Mn=e3=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,e3.prototype)}};Mn=e3=(0,By.Cg)([Bu({type:ez.Sequence,itemType:eV.ObjectIdentifier})],Mn);let Mi=`${BR}.1`,Ms=`${BR}.2`,Mo=`${BR}.3`,Ma=`${BR}.4`,Ml=`${BR}.8`,Mc=`${BR}.9`,Mu=class{constructor(e=new ArrayBuffer(0)){this.value=e}};(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],Mu.prototype,"value",void 0),Mu=(0,By.Cg)([Bu({type:ez.Choice})],Mu);let Mh=class{constructor(e){this.value=new Date,e&&(this.value=e)}};(0,By.Cg)([Bh({type:eV.GeneralizedTime})],Mh.prototype,"value",void 0),Mh=(0,By.Cg)([Bu({type:ez.Choice})],Mh);let Md=e4=class extends BK{constructor(e){super(e),Object.setPrototypeOf(this,e4.prototype)}};Md=e4=(0,By.Cg)([Bu({type:ez.Sequence})],Md);let Mf=`${BL}.15`;!function(e){e[e.digitalSignature=1]="digitalSignature",e[e.nonRepudiation=2]="nonRepudiation",e[e.keyEncipherment=4]="keyEncipherment",e[e.dataEncipherment=8]="dataEncipherment",e[e.keyAgreement=16]="keyAgreement",e[e.keyCertSign=32]="keyCertSign",e[e.cRLSign=64]="cRLSign",e[e.encipherOnly=128]="encipherOnly",e[e.decipherOnly=256]="decipherOnly"}(e5||(e5={}));class Mp extends D${toJSON(){let e=this.toNumber(),t=[];return e&e5.cRLSign&&t.push("crlSign"),e&e5.dataEncipherment&&t.push("dataEncipherment"),e&e5.decipherOnly&&t.push("decipherOnly"),e&e5.digitalSignature&&t.push("digitalSignature"),e&e5.encipherOnly&&t.push("encipherOnly"),e&e5.keyAgreement&&t.push("keyAgreement"),e&e5.keyCertSign&&t.push("keyCertSign"),e&e5.keyEncipherment&&t.push("keyEncipherment"),e&e5.nonRepudiation&&t.push("nonRepudiation"),t}toString(){return`[${this.toJSON().join(", ")}]`}}class Mg{constructor(e={}){this.base=new BC,this.minimum=0,Object.assign(this,e)}}(0,By.Cg)([Bh({type:BC})],Mg.prototype,"base",void 0),(0,By.Cg)([Bh({type:eV.Integer,context:0,defaultValue:0,implicit:!0})],Mg.prototype,"minimum",void 0),(0,By.Cg)([Bh({type:eV.Integer,context:1,optional:!0,implicit:!0})],Mg.prototype,"maximum",void 0);let Mm=e6=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,e6.prototype)}};Mm=e6=(0,By.Cg)([Bu({type:ez.Sequence,itemType:Mg})],Mm);class My{constructor(e={}){Object.assign(this,e)}}(0,By.Cg)([Bh({type:Mm,context:0,optional:!0,implicit:!0})],My.prototype,"permittedSubtrees",void 0),(0,By.Cg)([Bh({type:Mm,context:1,optional:!0,implicit:!0})],My.prototype,"excludedSubtrees",void 0);class Mb{constructor(e={}){Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer,context:0,implicit:!0,optional:!0,converter:DK})],Mb.prototype,"requireExplicitPolicy",void 0),(0,By.Cg)([Bh({type:eV.Integer,context:1,implicit:!0,optional:!0,converter:DK})],Mb.prototype,"inhibitPolicyMapping",void 0);class Mw{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],Mw.prototype,"issuerDomainPolicy",void 0),(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],Mw.prototype,"subjectDomainPolicy",void 0);let Mv=e8=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,e8.prototype)}};Mv=e8=(0,By.Cg)([Bu({type:ez.Sequence,itemType:Mw})],Mv);let ME=`${BL}.17`,MA=e7=class extends BK{constructor(e){super(e),Object.setPrototypeOf(this,e7.prototype)}};MA=e7=(0,By.Cg)([Bu({type:ez.Sequence})],MA);class Mx{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],Mx.prototype,"type",void 0),(0,By.Cg)([Bh({type:eV.Any,repeated:"set"})],Mx.prototype,"values",void 0);let MS=e9=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,e9.prototype)}};MS=e9=(0,By.Cg)([Bu({type:ez.Sequence,itemType:Mx})],MS);let Mk=`${BL}.14`;class M_ extends BH{}class MI{constructor(e={}){Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.GeneralizedTime,context:0,implicit:!0,optional:!0})],MI.prototype,"notBefore",void 0),(0,By.Cg)([Bh({type:eV.GeneralizedTime,context:1,implicit:!0,optional:!0})],MI.prototype,"notAfter",void 0),function(e){e[e.keyUpdateAllowed=1]="keyUpdateAllowed",e[e.newExtensions=2]="newExtensions",e[e.pKIXCertificate=4]="pKIXCertificate"}(te||(te={}));class MC extends D${toJSON(){let e=[],t=this.toNumber();return t&te.pKIXCertificate&&e.push("pKIXCertificate"),t&te.newExtensions&&e.push("newExtensions"),t&te.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}}class MT{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new MC,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.GeneralString})],MT.prototype,"entrustVers",void 0),(0,By.Cg)([Bh({type:MC})],MT.prototype,"entrustInfoFlags",void 0);let MP=tt=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,tt.prototype)}};MP=tt=(0,By.Cg)([Bu({type:ez.Sequence,itemType:BU})],MP);class MR{constructor(e={}){this.algorithm="",Object.assign(this,e)}isEqual(e){return e instanceof MR&&e.algorithm==this.algorithm&&(e.parameters&&this.parameters&&Ec.n4(e.parameters,this.parameters)||e.parameters===this.parameters)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],MR.prototype,"algorithm",void 0),(0,By.Cg)([Bh({type:eV.Any,optional:!0})],MR.prototype,"parameters",void 0);class MO{constructor(e={}){this.algorithm=new MR,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:MR})],MO.prototype,"algorithm",void 0),(0,By.Cg)([Bh({type:eV.BitString})],MO.prototype,"subjectPublicKey",void 0);let MN=class{constructor(e){if(e)if("string"==typeof e||"number"==typeof e||e instanceof Date){let t=new Date(e);t.getUTCFullYear()>2049?this.generalTime=t:this.utcTime=t}else Object.assign(this,e)}getTime(){let e=this.utcTime||this.generalTime;if(!e)throw Error("Cannot get time from CHOICE object");return e}};(0,By.Cg)([Bh({type:eV.UTCTime})],MN.prototype,"utcTime",void 0),(0,By.Cg)([Bh({type:eV.GeneralizedTime})],MN.prototype,"generalTime",void 0),MN=(0,By.Cg)([Bu({type:ez.Choice})],MN);class MD{constructor(e){this.notBefore=new MN(new Date),this.notAfter=new MN(new Date),e&&(this.notBefore=new MN(e.notBefore),this.notAfter=new MN(e.notAfter))}}(0,By.Cg)([Bh({type:MN})],MD.prototype,"notBefore",void 0),(0,By.Cg)([Bh({type:MN})],MD.prototype,"notAfter",void 0);class MB{constructor(e={}){this.extnID="",this.critical=MB.CRITICAL,this.extnValue=new DH,Object.assign(this,e)}}MB.CRITICAL=!1,(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],MB.prototype,"extnID",void 0),(0,By.Cg)([Bh({type:eV.Boolean,defaultValue:MB.CRITICAL})],MB.prototype,"critical",void 0),(0,By.Cg)([Bh({type:DH})],MB.prototype,"extnValue",void 0);let MM=tr=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,tr.prototype)}};MM=tr=(0,By.Cg)([Bu({type:ez.Sequence,itemType:MB})],MM),function(e){e[e.v1=0]="v1",e[e.v2=1]="v2",e[e.v3=2]="v3"}(tn||(tn={}));class ML{constructor(e={}){this.version=tn.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new MR,this.issuer=new BS,this.validity=new MD,this.subject=new BS,this.subjectPublicKeyInfo=new MO,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer,context:0,defaultValue:tn.v1})],ML.prototype,"version",void 0),(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],ML.prototype,"serialNumber",void 0),(0,By.Cg)([Bh({type:MR})],ML.prototype,"signature",void 0),(0,By.Cg)([Bh({type:BS})],ML.prototype,"issuer",void 0),(0,By.Cg)([Bh({type:MD})],ML.prototype,"validity",void 0),(0,By.Cg)([Bh({type:BS})],ML.prototype,"subject",void 0),(0,By.Cg)([Bh({type:MO})],ML.prototype,"subjectPublicKeyInfo",void 0),(0,By.Cg)([Bh({type:eV.BitString,context:1,implicit:!0,optional:!0})],ML.prototype,"issuerUniqueID",void 0),(0,By.Cg)([Bh({type:eV.BitString,context:2,implicit:!0,optional:!0})],ML.prototype,"subjectUniqueID",void 0),(0,By.Cg)([Bh({type:MM,context:3,optional:!0})],ML.prototype,"extensions",void 0);class MF{constructor(e={}){this.tbsCertificate=new ML,this.signatureAlgorithm=new MR,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:ML})],MF.prototype,"tbsCertificate",void 0),(0,By.Cg)([Bh({type:MR})],MF.prototype,"signatureAlgorithm",void 0),(0,By.Cg)([Bh({type:eV.BitString})],MF.prototype,"signatureValue",void 0);class MU{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new MN,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],MU.prototype,"userCertificate",void 0),(0,By.Cg)([Bh({type:MN})],MU.prototype,"revocationDate",void 0),(0,By.Cg)([Bh({type:MB,optional:!0,repeated:"sequence"})],MU.prototype,"crlEntryExtensions",void 0);class Mj{constructor(e={}){this.signature=new MR,this.issuer=new BS,this.thisUpdate=new MN,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer,optional:!0})],Mj.prototype,"version",void 0),(0,By.Cg)([Bh({type:MR})],Mj.prototype,"signature",void 0),(0,By.Cg)([Bh({type:BS})],Mj.prototype,"issuer",void 0),(0,By.Cg)([Bh({type:MN})],Mj.prototype,"thisUpdate",void 0),(0,By.Cg)([Bh({type:MN,optional:!0})],Mj.prototype,"nextUpdate",void 0),(0,By.Cg)([Bh({type:MU,repeated:"sequence",optional:!0})],Mj.prototype,"revokedCertificates",void 0),(0,By.Cg)([Bh({type:MB,optional:!0,context:0,repeated:"sequence"})],Mj.prototype,"crlExtensions",void 0);class M${constructor(e={}){this.tbsCertList=new Mj,this.signatureAlgorithm=new MR,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:Mj})],M$.prototype,"tbsCertList",void 0),(0,By.Cg)([Bh({type:MR})],M$.prototype,"signatureAlgorithm",void 0),(0,By.Cg)([Bh({type:eV.BitString})],M$.prototype,"signature",void 0);class MH{constructor(e={}){this.issuer=new BS,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:BS})],MH.prototype,"issuer",void 0),(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],MH.prototype,"serialNumber",void 0);let Mq=class{constructor(e={}){Object.assign(this,e)}};(0,By.Cg)([Bh({type:M_,context:0,implicit:!0})],Mq.prototype,"subjectKeyIdentifier",void 0),(0,By.Cg)([Bh({type:MH})],Mq.prototype,"issuerAndSerialNumber",void 0),Mq=(0,By.Cg)([Bu({type:ez.Choice})],Mq),function(e){e[e.v0=0]="v0",e[e.v1=1]="v1",e[e.v2=2]="v2",e[e.v3=3]="v3",e[e.v4=4]="v4",e[e.v5=5]="v5"}(ti||(ti={}));let Mz=class extends MR{};Mz=(0,By.Cg)([Bu({type:ez.Sequence})],Mz);let MV=class extends MR{};MV=(0,By.Cg)([Bu({type:ez.Sequence})],MV);let MK=class extends MR{};MK=(0,By.Cg)([Bu({type:ez.Sequence})],MK);let MG=class extends MR{};MG=(0,By.Cg)([Bu({type:ez.Sequence})],MG);let MW=class extends MR{};MW=(0,By.Cg)([Bu({type:ez.Sequence})],MW);let MQ=class extends MR{};MQ=(0,By.Cg)([Bu({type:ez.Sequence})],MQ);class MJ{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],MJ.prototype,"attrType",void 0),(0,By.Cg)([Bh({type:eV.Any,repeated:"set"})],MJ.prototype,"attrValues",void 0);class MZ{constructor(e={}){this.version=ti.v0,this.sid=new Mq,this.digestAlgorithm=new Mz,this.signatureAlgorithm=new MV,this.signature=new DH,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer})],MZ.prototype,"version",void 0),(0,By.Cg)([Bh({type:Mq})],MZ.prototype,"sid",void 0),(0,By.Cg)([Bh({type:Mz})],MZ.prototype,"digestAlgorithm",void 0),(0,By.Cg)([Bh({type:MJ,repeated:"set",context:0,implicit:!0,optional:!0})],MZ.prototype,"signedAttrs",void 0),(0,By.Cg)([Bh({type:MV})],MZ.prototype,"signatureAlgorithm",void 0),(0,By.Cg)([Bh({type:DH})],MZ.prototype,"signature",void 0),(0,By.Cg)([Bh({type:MJ,repeated:"set",context:1,implicit:!0,optional:!0})],MZ.prototype,"unsignedAttrs",void 0);let MY=ts=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,ts.prototype)}};MY=ts=(0,By.Cg)([Bu({type:ez.Set,itemType:MZ})],MY);let MX=class extends MN{};MX=(0,By.Cg)([Bu({type:ez.Choice})],MX);let M0=class extends MZ{};M0=(0,By.Cg)([Bu({type:ez.Sequence})],M0);class M1{constructor(e={}){this.acIssuer=new BC,this.acSerial=0,this.attrs=[],Object.assign(this,e)}}(0,By.Cg)([Bh({type:BC})],M1.prototype,"acIssuer",void 0),(0,By.Cg)([Bh({type:eV.Integer})],M1.prototype,"acSerial",void 0),(0,By.Cg)([Bh({type:Mx,repeated:"sequence"})],M1.prototype,"attrs",void 0);let M2=to=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,to.prototype)}};M2=to=(0,By.Cg)([Bu({type:ez.Sequence,itemType:eV.ObjectIdentifier})],M2);class M3{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer,optional:!0})],M3.prototype,"pathLenConstraint",void 0),(0,By.Cg)([Bh({type:M2,implicit:!0,context:0,optional:!0})],M3.prototype,"permittedAttrs",void 0),(0,By.Cg)([Bh({type:M2,implicit:!0,context:1,optional:!0})],M3.prototype,"excludedAttrs",void 0),(0,By.Cg)([Bh({type:eV.Boolean,defaultValue:!0})],M3.prototype,"permitUnSpecified",void 0);class M4{constructor(e={}){this.issuer=new BK,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:BK})],M4.prototype,"issuer",void 0),(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],M4.prototype,"serial",void 0),(0,By.Cg)([Bh({type:eV.BitString,optional:!0})],M4.prototype,"issuerUID",void 0),function(e){e[e.publicKey=0]="publicKey",e[e.publicKeyCert=1]="publicKeyCert",e[e.otherObjectTypes=2]="otherObjectTypes"}(ta||(ta={}));class M5{constructor(e={}){this.digestedObjectType=ta.publicKey,this.digestAlgorithm=new MR,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Enumerated})],M5.prototype,"digestedObjectType",void 0),(0,By.Cg)([Bh({type:eV.ObjectIdentifier,optional:!0})],M5.prototype,"otherObjectTypeID",void 0),(0,By.Cg)([Bh({type:MR})],M5.prototype,"digestAlgorithm",void 0),(0,By.Cg)([Bh({type:eV.BitString})],M5.prototype,"objectDigest",void 0);class M6{constructor(e={}){Object.assign(this,e)}}(0,By.Cg)([Bh({type:BK,optional:!0})],M6.prototype,"issuerName",void 0),(0,By.Cg)([Bh({type:M4,context:0,implicit:!0,optional:!0})],M6.prototype,"baseCertificateID",void 0),(0,By.Cg)([Bh({type:M5,context:1,implicit:!0,optional:!0})],M6.prototype,"objectDigestInfo",void 0);let M8=class{constructor(e={}){Object.assign(this,e)}};(0,By.Cg)([Bh({type:BC,repeated:"sequence"})],M8.prototype,"v1Form",void 0),(0,By.Cg)([Bh({type:M6,context:0,implicit:!0})],M8.prototype,"v2Form",void 0),M8=(0,By.Cg)([Bu({type:ez.Choice})],M8);class M7{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.GeneralizedTime})],M7.prototype,"notBeforeTime",void 0),(0,By.Cg)([Bh({type:eV.GeneralizedTime})],M7.prototype,"notAfterTime",void 0);class M9{constructor(e={}){Object.assign(this,e)}}(0,By.Cg)([Bh({type:M4,implicit:!0,context:0,optional:!0})],M9.prototype,"baseCertificateID",void 0),(0,By.Cg)([Bh({type:BK,implicit:!0,context:1,optional:!0})],M9.prototype,"entityName",void 0),(0,By.Cg)([Bh({type:M5,implicit:!0,context:2,optional:!0})],M9.prototype,"objectDigestInfo",void 0),function(e){e[e.v2=1]="v2"}(tl||(tl={}));class Le{constructor(e={}){this.version=tl.v2,this.holder=new M9,this.issuer=new M8,this.signature=new MR,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new M7,this.attributes=[],Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer})],Le.prototype,"version",void 0),(0,By.Cg)([Bh({type:M9})],Le.prototype,"holder",void 0),(0,By.Cg)([Bh({type:M8})],Le.prototype,"issuer",void 0),(0,By.Cg)([Bh({type:MR})],Le.prototype,"signature",void 0),(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],Le.prototype,"serialNumber",void 0),(0,By.Cg)([Bh({type:M7})],Le.prototype,"attrCertValidityPeriod",void 0),(0,By.Cg)([Bh({type:Mx,repeated:"sequence"})],Le.prototype,"attributes",void 0),(0,By.Cg)([Bh({type:eV.BitString,optional:!0})],Le.prototype,"issuerUniqueID",void 0),(0,By.Cg)([Bh({type:MM,optional:!0})],Le.prototype,"extensions",void 0);class Lt{constructor(e={}){this.acinfo=new Le,this.signatureAlgorithm=new MR,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:Le})],Lt.prototype,"acinfo",void 0),(0,By.Cg)([Bh({type:MR})],Lt.prototype,"signatureAlgorithm",void 0),(0,By.Cg)([Bh({type:eV.BitString})],Lt.prototype,"signatureValue",void 0),function(e){e[e.unmarked=1]="unmarked",e[e.unclassified=2]="unclassified",e[e.restricted=4]="restricted",e[e.confidential=8]="confidential",e[e.secret=16]="secret",e[e.topSecret=32]="topSecret"}(tc||(tc={}));class Lr extends D${}class Ln{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier,implicit:!0,context:0})],Ln.prototype,"type",void 0),(0,By.Cg)([Bh({type:eV.Any,implicit:!0,context:1})],Ln.prototype,"value",void 0);class Li{constructor(e={}){this.policyId="",this.classList=new Lr(tc.unclassified),Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],Li.prototype,"policyId",void 0),(0,By.Cg)([Bh({type:Lr,defaultValue:new Lr(tc.unclassified)})],Li.prototype,"classList",void 0),(0,By.Cg)([Bh({type:Ln,repeated:"set"})],Li.prototype,"securityCategories",void 0);class Ls{constructor(e={}){Object.assign(this,e)}}(0,By.Cg)([Bh({type:DH})],Ls.prototype,"cotets",void 0),(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],Ls.prototype,"oid",void 0),(0,By.Cg)([Bh({type:eV.Utf8String})],Ls.prototype,"string",void 0);class Lo{constructor(e={}){this.values=[],Object.assign(this,e)}}(0,By.Cg)([Bh({type:BK,implicit:!0,context:0,optional:!0})],Lo.prototype,"policyAuthority",void 0),(0,By.Cg)([Bh({type:Ls,repeated:"sequence"})],Lo.prototype,"values",void 0);class La{constructor(e={}){this.targetCertificate=new M4,Object.assign(this,e)}}(0,By.Cg)([Bh({type:M4})],La.prototype,"targetCertificate",void 0),(0,By.Cg)([Bh({type:BC,optional:!0})],La.prototype,"targetName",void 0),(0,By.Cg)([Bh({type:M5,optional:!0})],La.prototype,"certDigestInfo",void 0);let Ll=class{constructor(e={}){Object.assign(this,e)}};(0,By.Cg)([Bh({type:BC,context:0,implicit:!0})],Ll.prototype,"targetName",void 0),(0,By.Cg)([Bh({type:BC,context:1,implicit:!0})],Ll.prototype,"targetGroup",void 0),(0,By.Cg)([Bh({type:La,context:2,implicit:!0})],Ll.prototype,"targetCert",void 0),Ll=(0,By.Cg)([Bu({type:ez.Choice})],Ll);let Lc=tu=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,tu.prototype)}};Lc=tu=(0,By.Cg)([Bu({type:ez.Sequence,itemType:Ll})],Lc);let Lu=th=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,th.prototype)}};Lu=th=(0,By.Cg)([Bu({type:ez.Sequence,itemType:Lc})],Lu);class Lh{constructor(e={}){Object.assign(this,e)}}(0,By.Cg)([Bh({type:BK,implicit:!0,context:0,optional:!0})],Lh.prototype,"roleAuthority",void 0),(0,By.Cg)([Bh({type:BC,implicit:!0,context:1})],Lh.prototype,"roleName",void 0);class Ld{constructor(e={}){this.service=new BC,this.ident=new BC,Object.assign(this,e)}}(0,By.Cg)([Bh({type:BC})],Ld.prototype,"service",void 0),(0,By.Cg)([Bh({type:BC})],Ld.prototype,"ident",void 0),(0,By.Cg)([Bh({type:DH,optional:!0})],Ld.prototype,"authInfo",void 0);class Lf{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],Lf.prototype,"otherCertFormat",void 0),(0,By.Cg)([Bh({type:eV.Any})],Lf.prototype,"otherCert",void 0);let Lp=class{constructor(e={}){Object.assign(this,e)}};(0,By.Cg)([Bh({type:MF})],Lp.prototype,"certificate",void 0),(0,By.Cg)([Bh({type:Lt,context:2,implicit:!0})],Lp.prototype,"v2AttrCert",void 0),(0,By.Cg)([Bh({type:Lf,context:3,implicit:!0})],Lp.prototype,"other",void 0),Lp=(0,By.Cg)([Bu({type:ez.Choice})],Lp);let Lg=td=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,td.prototype)}};Lg=td=(0,By.Cg)([Bu({type:ez.Set,itemType:Lp})],Lg);class Lm{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],Lm.prototype,"contentType",void 0),(0,By.Cg)([Bh({type:eV.Any,context:0})],Lm.prototype,"content",void 0);let Ly=class{constructor(e={}){Object.assign(this,e)}};(0,By.Cg)([Bh({type:DH})],Ly.prototype,"single",void 0),(0,By.Cg)([Bh({type:eV.Any})],Ly.prototype,"any",void 0),Ly=(0,By.Cg)([Bu({type:ez.Choice})],Ly);class Lb{constructor(e={}){this.eContentType="",Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],Lb.prototype,"eContentType",void 0),(0,By.Cg)([Bh({type:Ly,context:0,optional:!0})],Lb.prototype,"eContent",void 0);let Lw=class{constructor(e={}){Object.assign(this,e)}};(0,By.Cg)([Bh({type:DH,context:0,implicit:!0,optional:!0})],Lw.prototype,"value",void 0),(0,By.Cg)([Bh({type:DH,converter:DZ,context:0,implicit:!0,optional:!0,repeated:"sequence"})],Lw.prototype,"constructedValue",void 0),Lw=(0,By.Cg)([Bu({type:ez.Choice})],Lw);class Lv{constructor(e={}){this.contentType="",this.contentEncryptionAlgorithm=new MG,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],Lv.prototype,"contentType",void 0),(0,By.Cg)([Bh({type:MG})],Lv.prototype,"contentEncryptionAlgorithm",void 0),(0,By.Cg)([Bh({type:Lw,optional:!0})],Lv.prototype,"encryptedContent",void 0);class LE{constructor(e={}){this.keyAttrId="",Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],LE.prototype,"keyAttrId",void 0),(0,By.Cg)([Bh({type:eV.Any,optional:!0})],LE.prototype,"keyAttr",void 0);class LA{constructor(e={}){this.subjectKeyIdentifier=new M_,Object.assign(this,e)}}(0,By.Cg)([Bh({type:M_})],LA.prototype,"subjectKeyIdentifier",void 0),(0,By.Cg)([Bh({type:eV.GeneralizedTime,optional:!0})],LA.prototype,"date",void 0),(0,By.Cg)([Bh({type:LE,optional:!0})],LA.prototype,"other",void 0);let Lx=class{constructor(e={}){Object.assign(this,e)}};(0,By.Cg)([Bh({type:LA,context:0,implicit:!0,optional:!0})],Lx.prototype,"rKeyId",void 0),(0,By.Cg)([Bh({type:MH,optional:!0})],Lx.prototype,"issuerAndSerialNumber",void 0),Lx=(0,By.Cg)([Bu({type:ez.Choice})],Lx);class LS{constructor(e={}){this.rid=new Lx,this.encryptedKey=new DH,Object.assign(this,e)}}(0,By.Cg)([Bh({type:Lx})],LS.prototype,"rid",void 0),(0,By.Cg)([Bh({type:DH})],LS.prototype,"encryptedKey",void 0);let Lk=tf=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,tf.prototype)}};Lk=tf=(0,By.Cg)([Bu({type:ez.Sequence,itemType:LS})],Lk);class L_{constructor(e={}){this.algorithm=new MR,this.publicKey=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:MR})],L_.prototype,"algorithm",void 0),(0,By.Cg)([Bh({type:eV.BitString})],L_.prototype,"publicKey",void 0);let LI=class{constructor(e={}){Object.assign(this,e)}};(0,By.Cg)([Bh({type:M_,context:0,implicit:!0,optional:!0})],LI.prototype,"subjectKeyIdentifier",void 0),(0,By.Cg)([Bh({type:L_,context:1,implicit:!0,optional:!0})],LI.prototype,"originatorKey",void 0),(0,By.Cg)([Bh({type:MH,optional:!0})],LI.prototype,"issuerAndSerialNumber",void 0),LI=(0,By.Cg)([Bu({type:ez.Choice})],LI);class LC{constructor(e={}){this.version=ti.v3,this.originator=new LI,this.keyEncryptionAlgorithm=new MK,this.recipientEncryptedKeys=new Lk,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer})],LC.prototype,"version",void 0),(0,By.Cg)([Bh({type:LI,context:0})],LC.prototype,"originator",void 0),(0,By.Cg)([Bh({type:DH,context:1,optional:!0})],LC.prototype,"ukm",void 0),(0,By.Cg)([Bh({type:MK})],LC.prototype,"keyEncryptionAlgorithm",void 0),(0,By.Cg)([Bh({type:Lk})],LC.prototype,"recipientEncryptedKeys",void 0);let LT=class{constructor(e={}){Object.assign(this,e)}};(0,By.Cg)([Bh({type:M_,context:0,implicit:!0})],LT.prototype,"subjectKeyIdentifier",void 0),(0,By.Cg)([Bh({type:MH})],LT.prototype,"issuerAndSerialNumber",void 0),LT=(0,By.Cg)([Bu({type:ez.Choice})],LT);class LP{constructor(e={}){this.version=ti.v0,this.rid=new LT,this.keyEncryptionAlgorithm=new MK,this.encryptedKey=new DH,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer})],LP.prototype,"version",void 0),(0,By.Cg)([Bh({type:LT})],LP.prototype,"rid",void 0),(0,By.Cg)([Bh({type:MK})],LP.prototype,"keyEncryptionAlgorithm",void 0),(0,By.Cg)([Bh({type:DH})],LP.prototype,"encryptedKey",void 0);class LR{constructor(e={}){this.keyIdentifier=new DH,Object.assign(this,e)}}(0,By.Cg)([Bh({type:DH})],LR.prototype,"keyIdentifier",void 0),(0,By.Cg)([Bh({type:eV.GeneralizedTime,optional:!0})],LR.prototype,"date",void 0),(0,By.Cg)([Bh({type:LE,optional:!0})],LR.prototype,"other",void 0);class LO{constructor(e={}){this.version=ti.v4,this.kekid=new LR,this.keyEncryptionAlgorithm=new MK,this.encryptedKey=new DH,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer})],LO.prototype,"version",void 0),(0,By.Cg)([Bh({type:LR})],LO.prototype,"kekid",void 0),(0,By.Cg)([Bh({type:MK})],LO.prototype,"keyEncryptionAlgorithm",void 0),(0,By.Cg)([Bh({type:DH})],LO.prototype,"encryptedKey",void 0);class LN{constructor(e={}){this.version=ti.v0,this.keyEncryptionAlgorithm=new MK,this.encryptedKey=new DH,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer})],LN.prototype,"version",void 0),(0,By.Cg)([Bh({type:MQ,context:0,optional:!0})],LN.prototype,"keyDerivationAlgorithm",void 0),(0,By.Cg)([Bh({type:MK})],LN.prototype,"keyEncryptionAlgorithm",void 0),(0,By.Cg)([Bh({type:DH})],LN.prototype,"encryptedKey",void 0);class LD{constructor(e={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],LD.prototype,"oriType",void 0),(0,By.Cg)([Bh({type:eV.Any})],LD.prototype,"oriValue",void 0);let LB=class{constructor(e={}){Object.assign(this,e)}};(0,By.Cg)([Bh({type:LP,optional:!0})],LB.prototype,"ktri",void 0),(0,By.Cg)([Bh({type:LC,context:1,implicit:!0,optional:!0})],LB.prototype,"kari",void 0),(0,By.Cg)([Bh({type:LO,context:2,implicit:!0,optional:!0})],LB.prototype,"kekri",void 0),(0,By.Cg)([Bh({type:LN,context:3,implicit:!0,optional:!0})],LB.prototype,"pwri",void 0),(0,By.Cg)([Bh({type:LD,context:4,implicit:!0,optional:!0})],LB.prototype,"ori",void 0),LB=(0,By.Cg)([Bu({type:ez.Choice})],LB);let LM=tp=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,tp.prototype)}};LM=tp=(0,By.Cg)([Bu({type:ez.Set,itemType:LB})],LM);class LL{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],LL.prototype,"otherRevInfoFormat",void 0),(0,By.Cg)([Bh({type:eV.Any})],LL.prototype,"otherRevInfo",void 0);let LF=class{constructor(e={}){this.other=new LL,Object.assign(this,e)}};(0,By.Cg)([Bh({type:LL,context:1,implicit:!0})],LF.prototype,"other",void 0),LF=(0,By.Cg)([Bu({type:ez.Choice})],LF);let LU=tg=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,tg.prototype)}};LU=tg=(0,By.Cg)([Bu({type:ez.Set,itemType:LF})],LU);class Lj{constructor(e={}){Object.assign(this,e)}}(0,By.Cg)([Bh({type:Lg,context:0,implicit:!0,optional:!0})],Lj.prototype,"certs",void 0),(0,By.Cg)([Bh({type:LU,context:1,implicit:!0,optional:!0})],Lj.prototype,"crls",void 0);let L$=tm=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,tm.prototype)}};L$=tm=(0,By.Cg)([Bu({type:ez.Set,itemType:MJ})],L$);class LH{constructor(e={}){this.version=ti.v0,this.recipientInfos=new LM,this.encryptedContentInfo=new Lv,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer})],LH.prototype,"version",void 0),(0,By.Cg)([Bh({type:Lj,context:0,implicit:!0,optional:!0})],LH.prototype,"originatorInfo",void 0),(0,By.Cg)([Bh({type:LM})],LH.prototype,"recipientInfos",void 0),(0,By.Cg)([Bh({type:Lv})],LH.prototype,"encryptedContentInfo",void 0),(0,By.Cg)([Bh({type:L$,context:1,implicit:!0,optional:!0})],LH.prototype,"unprotectedAttrs",void 0);let Lq="1.2.840.113549.1.7.2",Lz=ty=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,ty.prototype)}};Lz=ty=(0,By.Cg)([Bu({type:ez.Set,itemType:Mz})],Lz);class LV{constructor(e={}){this.version=ti.v0,this.digestAlgorithms=new Lz,this.encapContentInfo=new Lb,this.signerInfos=new MY,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer})],LV.prototype,"version",void 0),(0,By.Cg)([Bh({type:Lz})],LV.prototype,"digestAlgorithms",void 0),(0,By.Cg)([Bh({type:Lb})],LV.prototype,"encapContentInfo",void 0),(0,By.Cg)([Bh({type:Lg,context:0,implicit:!0,optional:!0})],LV.prototype,"certificates",void 0),(0,By.Cg)([Bh({type:LU,context:1,implicit:!0,optional:!0})],LV.prototype,"crls",void 0),(0,By.Cg)([Bh({type:MY})],LV.prototype,"signerInfos",void 0);let LK="1.2.840.10045.2.1",LG="1.2.840.10045.4.1",LW="1.2.840.10045.4.3.1",LQ="1.2.840.10045.4.3.2",LJ="1.2.840.10045.4.3.3",LZ="1.2.840.10045.4.3.4",LY="1.2.840.10045.3.1.7",LX="1.3.132.0.34",L0="1.3.132.0.35";function L1(e){return new MR({algorithm:e})}let L2=L1(LG);L1(LW);let L3=L1(LQ),L4=L1(LJ),L5=L1(LZ),L6=class{constructor(e={}){Object.assign(this,e)}};(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],L6.prototype,"fieldType",void 0),(0,By.Cg)([Bh({type:eV.Any})],L6.prototype,"parameters",void 0),L6=(0,By.Cg)([Bu({type:ez.Sequence})],L6);class L8 extends DH{}let L7=class{constructor(e={}){Object.assign(this,e)}};(0,By.Cg)([Bh({type:eV.OctetString})],L7.prototype,"a",void 0),(0,By.Cg)([Bh({type:eV.OctetString})],L7.prototype,"b",void 0),(0,By.Cg)([Bh({type:eV.BitString,optional:!0})],L7.prototype,"seed",void 0),L7=(0,By.Cg)([Bu({type:ez.Sequence})],L7),function(e){e[e.ecpVer1=1]="ecpVer1"}(tb||(tb={}));let L9=class{constructor(e={}){this.version=tb.ecpVer1,Object.assign(this,e)}};(0,By.Cg)([Bh({type:eV.Integer})],L9.prototype,"version",void 0),(0,By.Cg)([Bh({type:L6})],L9.prototype,"fieldID",void 0),(0,By.Cg)([Bh({type:L7})],L9.prototype,"curve",void 0),(0,By.Cg)([Bh({type:L8})],L9.prototype,"base",void 0),(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],L9.prototype,"order",void 0),(0,By.Cg)([Bh({type:eV.Integer,optional:!0})],L9.prototype,"cofactor",void 0),L9=(0,By.Cg)([Bu({type:ez.Sequence})],L9);let Fe=class{constructor(e={}){Object.assign(this,e)}};(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],Fe.prototype,"namedCurve",void 0),(0,By.Cg)([Bh({type:eV.Null})],Fe.prototype,"implicitCurve",void 0),(0,By.Cg)([Bh({type:L9})],Fe.prototype,"specifiedCurve",void 0),Fe=(0,By.Cg)([Bu({type:ez.Choice})],Fe);class Ft{constructor(e={}){this.version=1,this.privateKey=new DH,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer})],Ft.prototype,"version",void 0),(0,By.Cg)([Bh({type:DH})],Ft.prototype,"privateKey",void 0),(0,By.Cg)([Bh({type:Fe,context:0,optional:!0})],Ft.prototype,"parameters",void 0),(0,By.Cg)([Bh({type:eV.BitString,context:1,optional:!0})],Ft.prototype,"publicKey",void 0);class Fr{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],Fr.prototype,"r",void 0),(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],Fr.prototype,"s",void 0);let Fn="1.2.840.113549.1.1",Fi=`${Fn}.1`,Fs=`${Fn}.7`,Fo=`${Fn}.9`,Fa=`${Fn}.10`,Fl=`${Fn}.2`,Fc=`${Fn}.4`,Fu=`${Fn}.5`,Fh=`${Fn}.14`,Fd=`${Fn}.11`,Ff=`${Fn}.12`,Fp=`${Fn}.13`,Fg=`${Fn}.15`,Fm=`${Fn}.16`,Fy="1.3.14.3.2.26",Fb="2.16.840.1.101.3.4.2.4",Fw="2.16.840.1.101.3.4.2.1",Fv="2.16.840.1.101.3.4.2.2",FE="2.16.840.1.101.3.4.2.3",FA="2.16.840.1.101.3.4.2.5",Fx="2.16.840.1.101.3.4.2.6",FS="1.2.840.113549.2.5",Fk=`${Fn}.8`;function F_(e){return new MR({algorithm:e,parameters:null})}F_("1.2.840.113549.2.2"),F_(FS);let FI=F_(Fy);F_(Fb),F_(Fw),F_(Fv),F_(FE),F_(FA),F_(Fx);let FC=new MR({algorithm:Fk,parameters:Bm.serialize(FI)}),FT=new MR({algorithm:Fo,parameters:Bm.serialize(DJ.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))});F_(Fi),F_(Fl),F_(Fc),F_(Fu),F_(Fg),F_(Fm),F_(Ff),F_(Fp),F_(Fg),F_(Fm);class FP{constructor(e={}){this.hashAlgorithm=new MR(FI),this.maskGenAlgorithm=new MR({algorithm:Fk,parameters:Bm.serialize(FI)}),this.pSourceAlgorithm=new MR(FT),Object.assign(this,e)}}(0,By.Cg)([Bh({type:MR,context:0,defaultValue:FI})],FP.prototype,"hashAlgorithm",void 0),(0,By.Cg)([Bh({type:MR,context:1,defaultValue:FC})],FP.prototype,"maskGenAlgorithm",void 0),(0,By.Cg)([Bh({type:MR,context:2,defaultValue:FT})],FP.prototype,"pSourceAlgorithm",void 0),new MR({algorithm:Fs,parameters:Bm.serialize(new FP)});class FR{constructor(e={}){this.hashAlgorithm=new MR(FI),this.maskGenAlgorithm=new MR({algorithm:Fk,parameters:Bm.serialize(FI)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}}(0,By.Cg)([Bh({type:MR,context:0,defaultValue:FI})],FR.prototype,"hashAlgorithm",void 0),(0,By.Cg)([Bh({type:MR,context:1,defaultValue:FC})],FR.prototype,"maskGenAlgorithm",void 0),(0,By.Cg)([Bh({type:eV.Integer,context:2,defaultValue:20})],FR.prototype,"saltLength",void 0),(0,By.Cg)([Bh({type:eV.Integer,context:3,defaultValue:1})],FR.prototype,"trailerField",void 0),new MR({algorithm:Fa,parameters:Bm.serialize(new FR)});class FO{constructor(e={}){this.digestAlgorithm=new MR,this.digest=new DH,Object.assign(this,e)}}(0,By.Cg)([Bh({type:MR})],FO.prototype,"digestAlgorithm",void 0),(0,By.Cg)([Bh({type:DH})],FO.prototype,"digest",void 0);class FN{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],FN.prototype,"prime",void 0),(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],FN.prototype,"exponent",void 0),(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],FN.prototype,"coefficient",void 0);let FD=tw=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,tw.prototype)}};FD=tw=(0,By.Cg)([Bu({type:ez.Sequence,itemType:FN})],FD);class FB{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer})],FB.prototype,"version",void 0),(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],FB.prototype,"modulus",void 0),(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],FB.prototype,"publicExponent",void 0),(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],FB.prototype,"privateExponent",void 0),(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],FB.prototype,"prime1",void 0),(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],FB.prototype,"prime2",void 0),(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],FB.prototype,"exponent1",void 0),(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],FB.prototype,"exponent2",void 0),(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],FB.prototype,"coefficient",void 0),(0,By.Cg)([Bh({type:FD,optional:!0})],FB.prototype,"otherPrimeInfos",void 0);class FM{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],FM.prototype,"modulus",void 0),(0,By.Cg)([Bh({type:eV.Integer,converter:DK})],FM.prototype,"publicExponent",void 0),function(e){e[e.Transient=0]="Transient",e[e.Singleton=1]="Singleton",e[e.ResolutionScoped=2]="ResolutionScoped",e[e.ContainerScoped=3]="ContainerScoped"}(tv||(tv={}));let FL=tv;var FF=function(e,t){return(FF=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function FU(e,t){function r(){this.constructor=e}FF(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function Fj(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})}function F$(e,t){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return l([e,t])}}function l(s){if(r)throw TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}}function FH(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Fq(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return o}function Fz(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Fq(arguments[t]));return e}function FV(e){return!!e.useClass}function FK(e){return!!e.useFactory}var FG=function(){function e(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return e.prototype.createProxy=function(e){var t,r=this,n=!1,i=function(){return n||(t=e(r.wrap()),n=!0),t};return new Proxy({},this.createHandler(i))},e.prototype.createHandler=function(e){var t={},r=function(r){t[r]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t[0]=e(),Reflect[r].apply(void 0,Fz(t))}};return this.reflectMethods.forEach(r),t},e}();function FW(e){return"string"==typeof e||"symbol"==typeof e}function FQ(e){return"object"==typeof e&&"token"in e&&"multiple"in e}function FJ(e){return"object"==typeof e&&"token"in e&&"transform"in e}function FZ(e){return"function"==typeof e||e instanceof FG}function FY(e){return!!e.useToken}function FX(e){return void 0!=e.useValue}function F0(e){return FV(e)||FX(e)||FY(e)||FK(e)}let F1=function(){function e(){this._registryMap=new Map}return e.prototype.entries=function(){return this._registryMap.entries()},e.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},e.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},e.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},e.prototype.setAll=function(e,t){this._registryMap.set(e,t)},e.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},e.prototype.clear=function(){this._registryMap.clear()},e.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},e}(),F2=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return FU(t,e),t}(F1),F3=function(){return function(){this.scopedResolutions=new Map}}();function F4(e,t){return null===e?"at position #"+t:'"'+e.split(",")[t].trim()+'" at position #'+t}function F5(e,t,r){return void 0===r&&(r="    "),Fz([e],t.message.split("\n").map(function(e){return r+e})).join("\n")}function F6(e,t,r){var n=Fq(e.toString().match(/constructor\(([\w, ]+)\)/)||[],2)[1];return F5("Cannot inject the dependency "+F4(void 0===n?null:n,t)+' of "'+e.name+'" constructor. Reason:',r)}function F8(e){return"function"==typeof e.dispose&&!(e.dispose.length>0)}var F7=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return FU(t,e),t}(F1),F9=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return FU(t,e),t}(F1);let Ue=function(){return function(){this.preResolution=new F7,this.postResolution=new F9}}();var Ut=new Map,Ur=new(function(){function e(e){this.parent=e,this._registry=new F2,this.interceptors=new Ue,this.disposed=!1,this.disposables=new Set}return e.prototype.register=function(e,t,r){if(void 0===r&&(r={lifecycle:FL.Transient}),this.ensureNotDisposed(),FY(n=F0(t)?t:{useClass:t}))for(var n,i=[e],s=n;null!=s;){var o=s.useToken;if(i.includes(o))throw Error("Token registration cycle detected! "+Fz(i,[o]).join(" -> "));i.push(o);var a=this._registry.get(o);s=a&&FY(a.provider)?a.provider:null}if((r.lifecycle===FL.Singleton||r.lifecycle==FL.ContainerScoped||r.lifecycle==FL.ResolutionScoped)&&(FX(n)||FK(n)))throw Error('Cannot use lifecycle "'+FL[r.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:n,options:r}),this},e.prototype.registerType=function(e,t){return(this.ensureNotDisposed(),FW(t))?this.register(e,{useToken:t}):this.register(e,{useClass:t})},e.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},e.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),FW(e)){if(FW(t))return this.register(e,{useToken:t},{lifecycle:FL.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:FL.Singleton});throw Error('Cannot register a type name as a singleton without a "to" token')}var r=e;return t&&!FW(t)&&(r=t),this.register(e,{useClass:r},{lifecycle:FL.Singleton})},e.prototype.resolve=function(e,t,r){void 0===t&&(t=new F3),void 0===r&&(r=!1),this.ensureNotDisposed();var n=this.getRegistration(e);if(!n&&FW(e)){if(r)return;throw Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"Single"),n){var i=this.resolveRegistration(n,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}if(FZ(e)){var i=this.construct(e,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}throw Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},e.prototype.executePreResolutionInterceptor=function(e,t){var r,n;if(this.interceptors.preResolution.has(e)){var i=[];try{for(var s=FH(this.interceptors.preResolution.getAll(e)),o=s.next();!o.done;o=s.next()){var a=o.value;"Once"!=a.options.frequency&&i.push(a),a.callback(e,t)}}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}this.interceptors.preResolution.setAll(e,i)}},e.prototype.executePostResolutionInterceptor=function(e,t,r){var n,i;if(this.interceptors.postResolution.has(e)){var s=[];try{for(var o=FH(this.interceptors.postResolution.getAll(e)),a=o.next();!a.done;a=o.next()){var l=a.value;"Once"!=l.options.frequency&&s.push(l),l.callback(e,t,r)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}this.interceptors.postResolution.setAll(e,s)}},e.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===FL.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var r,n=e.options.lifecycle===FL.Singleton,i=e.options.lifecycle===FL.ContainerScoped,s=n||i;return r=FX(e.provider)?e.provider.useValue:FY(e.provider)?s?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):FV(e.provider)?s?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):FK(e.provider)?e.provider.useFactory(this):this.construct(e.provider,t),e.options.lifecycle===FL.ResolutionScoped&&t.scopedResolutions.set(e,r),r},e.prototype.resolveAll=function(e,t,r){var n=this;void 0===t&&(t=new F3),void 0===r&&(r=!1),this.ensureNotDisposed();var i=this.getAllRegistrations(e);if(!i&&FW(e)){if(r)return[];throw Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"All"),i){var s=i.map(function(e){return n.resolveRegistration(e,t)});return this.executePostResolutionInterceptor(e,s,"All"),s}var o=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,o,"All"),o},e.prototype.isRegistered=function(e,t){return void 0===t&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},e.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},e.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var r=FH(this._registry.entries()),n=r.next();!n.done;n=r.next()){var i=Fq(n.value,2),s=i[0],o=i[1];this._registry.setAll(s,o.filter(function(e){return!FX(e.provider)}).map(function(e){return e.instance=void 0,e}))}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.createChildContainer=function(){this.ensureNotDisposed();var t,r,n=new e(this);try{for(var i=FH(this._registry.entries()),s=i.next();!s.done;s=i.next()){var o=Fq(s.value,2),a=o[0],l=o[1];l.some(function(e){return e.options.lifecycle===FL.ContainerScoped})&&n._registry.setAll(a,l.map(function(e){return e.options.lifecycle===FL.ContainerScoped?{provider:e.provider,options:e.options}:e}))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},e.prototype.beforeResolution=function(e,t,r){void 0===r&&(r={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:r})},e.prototype.afterResolution=function(e,t,r){void 0===r&&(r={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:r})},e.prototype.dispose=function(){return Fj(this,void 0,void 0,function(){var e;return F$(this,function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach(function(t){var r=t.dispose();r&&e.push(r)}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})})},e.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},e.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},e.prototype.construct=function(e,t){var r=this;if(e instanceof FG)return e.createProxy(function(e){return r.resolve(e,t)});var n=function(){var n=Ut.get(e);if(!n||0===n.length)if(0===e.length)return new e;else throw Error('TypeInfo not known for "'+e.name+'"');var i=n.map(r.resolveParams(t,e));return new(e.bind.apply(e,Fz([void 0],i)))}();return F8(n)&&this.disposables.add(n),n},e.prototype.resolveParams=function(e,t){var r=this;return function(n,i){var s,o,a;try{if(FQ(n))if(FJ(n))return n.multiple?(s=r.resolve(n.transform)).transform.apply(s,Fz([r.resolveAll(n.token,new F3,n.isOptional)],n.transformArgs)):(o=r.resolve(n.transform)).transform.apply(o,Fz([r.resolve(n.token,e,n.isOptional)],n.transformArgs));else return n.multiple?r.resolveAll(n.token,new F3,n.isOptional):r.resolve(n.token,e,n.isOptional);if(FJ(n))return(a=r.resolve(n.transform,e)).transform.apply(a,Fz([r.resolve(n.token,e)],n.transformArgs));return r.resolve(n,e)}catch(e){throw Error(F6(t,i,e))}}},e.prototype.ensureNotDisposed=function(){if(this.disposed)throw Error("This container has been disposed, you cannot interact with a disposed container")},e}()),Un="injectionTokens";function Ui(e){var t=Reflect.getMetadata("design:paramtypes",e)||[],r=Reflect.getOwnMetadata(Un,e)||{};return Object.keys(r).forEach(function(e){t[+e]=r[e]}),t}let Us=function(e){return function(t){Ut.set(t,Ui(t)),e&&e.token&&(Array.isArray(e.token)?e.token.forEach(function(e){Ur.register(e,t)}):Ur.register(e.token,t))}};if("undefined"==typeof Reflect||!Reflect.getMetadata)throw Error("tsyringe requires a reflect polyfill. Please add 'import \"reflect-metadata\"' to the top of your entry point.");class Uo{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],Uo.prototype,"attrId",void 0),(0,By.Cg)([Bh({type:eV.Any,repeated:"set"})],Uo.prototype,"attrValues",void 0);let Ua=tE=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,tE.prototype)}};Ua=tE=(0,By.Cg)([Bu({type:ez.Sequence,itemType:Uo})],Ua);let Ul=tA=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,tA.prototype)}};Ul=tA=(0,By.Cg)([Bu({type:ez.Sequence,itemType:Lm})],Ul);class Uc{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],Uc.prototype,"certId",void 0),(0,By.Cg)([Bh({type:eV.Any,context:0})],Uc.prototype,"certValue",void 0);class Uu{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],Uu.prototype,"crlId",void 0),(0,By.Cg)([Bh({type:eV.Any,context:0})],Uu.prototype,"crltValue",void 0);class Uh extends DH{}class Ud{constructor(e={}){this.encryptionAlgorithm=new MR,this.encryptedData=new Uh,Object.assign(this,e)}}(0,By.Cg)([Bh({type:MR})],Ud.prototype,"encryptionAlgorithm",void 0),(0,By.Cg)([Bh({type:Uh})],Ud.prototype,"encryptedData",void 0),function(e){e[e.v1=0]="v1"}(tS||(tS={}));class Uf extends DH{}let Up=tx=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,tx.prototype)}};Up=tx=(0,By.Cg)([Bu({type:ez.Sequence,itemType:Mx})],Up);class Ug{constructor(e={}){this.version=tS.v1,this.privateKeyAlgorithm=new MR,this.privateKey=new Uf,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer})],Ug.prototype,"version",void 0),(0,By.Cg)([Bh({type:MR})],Ug.prototype,"privateKeyAlgorithm",void 0),(0,By.Cg)([Bh({type:Uf})],Ug.prototype,"privateKey",void 0),(0,By.Cg)([Bh({type:Up,implicit:!0,context:0,optional:!0})],Ug.prototype,"attributes",void 0);let Um=class extends Ug{};Um=(0,By.Cg)([Bu({type:ez.Sequence})],Um);let Uy=class extends Ud{};Uy=(0,By.Cg)([Bu({type:ez.Sequence})],Uy);class Ub{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],Ub.prototype,"secretTypeId",void 0),(0,By.Cg)([Bh({type:eV.Any,context:0})],Ub.prototype,"secretValue",void 0);class Uw{constructor(e={}){this.mac=new FO,this.macSalt=new DH,this.iterations=1,Object.assign(this,e)}}(0,By.Cg)([Bh({type:FO})],Uw.prototype,"mac",void 0),(0,By.Cg)([Bh({type:DH})],Uw.prototype,"macSalt",void 0),(0,By.Cg)([Bh({type:eV.Integer,defaultValue:1})],Uw.prototype,"iterations",void 0);class Uv{constructor(e={}){this.version=3,this.authSafe=new Lm,this.macData=new Uw,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer})],Uv.prototype,"version",void 0),(0,By.Cg)([Bh({type:Lm})],Uv.prototype,"authSafe",void 0),(0,By.Cg)([Bh({type:Uw,optional:!0})],Uv.prototype,"macData",void 0);class UE{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],UE.prototype,"bagId",void 0),(0,By.Cg)([Bh({type:eV.Any,context:0})],UE.prototype,"bagValue",void 0),(0,By.Cg)([Bh({type:Uo,repeated:"set",optional:!0})],UE.prototype,"bagAttributes",void 0);let UA=tk=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,tk.prototype)}};UA=tk=(0,By.Cg)([Bu({type:ez.Sequence,itemType:UE})],UA);let Ux="1.2.840.113549.1.9",US=`${Ux}.7`,Uk=`${Ux}.14`,U_=class extends Bw{constructor(e={}){super(e)}toString(){return({}).toString(),this.ia5String||super.toString()}};(0,By.Cg)([Bh({type:eV.IA5String})],U_.prototype,"ia5String",void 0),U_=(0,By.Cg)([Bu({type:ez.Choice})],U_);let UI=class extends Lm{};UI=(0,By.Cg)([Bu({type:ez.Sequence})],UI);let UC=class extends Uv{};UC=(0,By.Cg)([Bu({type:ez.Sequence})],UC);let UT=class extends Ud{};UT=(0,By.Cg)([Bu({type:ez.Sequence})],UT);let UP=class{constructor(e=""){this.value=e}toString(){return this.value}};(0,By.Cg)([Bh({type:eV.IA5String})],UP.prototype,"value",void 0),UP=(0,By.Cg)([Bu({type:ez.Choice})],UP);let UR=class extends U_{};UR=(0,By.Cg)([Bu({type:ez.Choice})],UR);let UO=class extends Bw{};UO=(0,By.Cg)([Bu({type:ez.Choice})],UO);let UN=class{constructor(e=new Date){this.value=e}};(0,By.Cg)([Bh({type:eV.GeneralizedTime})],UN.prototype,"value",void 0),UN=(0,By.Cg)([Bu({type:ez.Choice})],UN);let UD=class extends Bw{};UD=(0,By.Cg)([Bu({type:ez.Choice})],UD);let UB=class{constructor(e="M"){this.value=e}toString(){return this.value}};(0,By.Cg)([Bh({type:eV.PrintableString})],UB.prototype,"value",void 0),UB=(0,By.Cg)([Bu({type:ez.Choice})],UB);let UM=class{constructor(e=""){this.value=e}toString(){return this.value}};(0,By.Cg)([Bh({type:eV.PrintableString})],UM.prototype,"value",void 0),UM=(0,By.Cg)([Bu({type:ez.Choice})],UM);let UL=class extends UM{};UL=(0,By.Cg)([Bu({type:ez.Choice})],UL);let UF=class extends Bw{};UF=(0,By.Cg)([Bu({type:ez.Choice})],UF);let UU=class{constructor(e=""){this.value=e}toString(){return this.value}};(0,By.Cg)([Bh({type:eV.ObjectIdentifier})],UU.prototype,"value",void 0),UU=(0,By.Cg)([Bu({type:ez.Choice})],UU);let Uj=class extends MN{};Uj=(0,By.Cg)([Bu({type:ez.Choice})],Uj);let U$=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};(0,By.Cg)([Bh({type:eV.Integer})],U$.prototype,"value",void 0),U$=(0,By.Cg)([Bu({type:ez.Choice})],U$);let UH=class extends MZ{};UH=(0,By.Cg)([Bu({type:ez.Sequence})],UH);let Uq=class extends Bw{};Uq=(0,By.Cg)([Bu({type:ez.Choice})],Uq);let Uz=t_=class extends MM{constructor(e){super(e),Object.setPrototypeOf(this,t_.prototype)}};Uz=t_=(0,By.Cg)([Bu({type:ez.Sequence})],Uz);let UV=tI=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,tI.prototype)}};UV=tI=(0,By.Cg)([Bu({type:ez.Set,itemType:MJ})],UV);let UK=class{constructor(e=""){this.value=e}toString(){return this.value}};(0,By.Cg)([Bh({type:eV.BmpString})],UK.prototype,"value",void 0),UK=(0,By.Cg)([Bu({type:ez.Choice})],UK);let UG=class extends MR{};UG=(0,By.Cg)([Bu({type:ez.Sequence})],UG);let UW=tC=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,tC.prototype)}};UW=tC=(0,By.Cg)([Bu({type:ez.Sequence,itemType:UG})],UW);let UQ=tT=class extends Bg{constructor(e){super(e),Object.setPrototypeOf(this,tT.prototype)}};UQ=tT=(0,By.Cg)([Bu({type:ez.Sequence,itemType:Mx})],UQ);class UJ{constructor(e={}){this.version=0,this.subject=new BS,this.subjectPKInfo=new MO,this.attributes=new UQ,Object.assign(this,e)}}(0,By.Cg)([Bh({type:eV.Integer})],UJ.prototype,"version",void 0),(0,By.Cg)([Bh({type:BS})],UJ.prototype,"subject",void 0),(0,By.Cg)([Bh({type:MO})],UJ.prototype,"subjectPKInfo",void 0),(0,By.Cg)([Bh({type:UQ,implicit:!0,context:0})],UJ.prototype,"attributes",void 0);class UZ{constructor(e={}){this.certificationRequestInfo=new UJ,this.signatureAlgorithm=new MR,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}(0,By.Cg)([Bh({type:UJ})],UZ.prototype,"certificationRequestInfo",void 0),(0,By.Cg)([Bh({type:MR})],UZ.prototype,"signatureAlgorithm",void 0),(0,By.Cg)([Bh({type:eV.BitString})],UZ.prototype,"signature",void 0);let UY="crypto.algorithm";class UX{getAlgorithms(){return Ur.resolveAll(UY)}toAsnAlgorithm(e){for(let t of({...e},this.getAlgorithms())){let r=t.toAsnAlgorithm(e);if(r)return r}if(/^[0-9.]+$/.test(e.name)){let t=new MR({algorithm:e.name});return"parameters"in e&&(t.parameters=e.parameters),t}throw Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(let t of this.getAlgorithms()){let r=t.toWebAlgorithm(e);if(r)return r}return{name:e.algorithm,parameters:e.parameters}}}let U0="crypto.algorithmProvider";Ur.registerSingleton(U0,UX);let U1="1.3.36.3.3.2.8.1.1",U2=`${U1}.1`,U3=`${U1}.2`,U4=`${U1}.3`,U5=`${U1}.4`,U6=`${U1}.5`,U8=`${U1}.6`,U7=`${U1}.7`,U9=`${U1}.8`,je=`${U1}.9`,jt=`${U1}.10`,jr=`${U1}.11`,jn=`${U1}.12`,ji=`${U1}.13`,js=`${U1}.14`,jo="brainpoolP160r1",ja="brainpoolP160t1",jl="brainpoolP192r1",jc="brainpoolP192t1",ju="brainpoolP224r1",jh="brainpoolP224t1",jd="brainpoolP256r1",jf="brainpoolP256t1",jp="brainpoolP320r1",jg="brainpoolP320t1",jm="brainpoolP384r1",jy="brainpoolP384t1",jb="brainpoolP512r1",jw="brainpoolP512t1",jv="ECDSA",jE=tP=class{toAsnAlgorithm(e){if(e.name.toLowerCase()===jv.toLowerCase()){if("hash"in e)switch(("string"==typeof e.hash?e.hash:e.hash.name).toLowerCase()){case"sha-1":return L2;case"sha-256":return L3;case"sha-384":return L4;case"sha-512":return L5}else if("namedCurve"in e){let t="";switch(e.namedCurve){case"P-256":t=LY;break;case"K-256":t=tP.SECP256K1;break;case"P-384":t=LX;break;case"P-521":t=L0;break;case jo:t=U2;break;case ja:t=U3;break;case jl:t=U4;break;case jc:t=U5;break;case ju:t=U6;break;case jh:t=U8;break;case jd:t=U7;break;case jf:t=U9;break;case jp:t=je;break;case jg:t=jt;break;case jm:t=jr;break;case jy:t=jn;break;case jb:t=ji;break;case jw:t=js}if(t)return new MR({algorithm:LK,parameters:Bm.serialize(new Fe({namedCurve:t}))})}}return null}toWebAlgorithm(e){switch(e.algorithm){case LG:return{name:jv,hash:{name:"SHA-1"}};case LQ:return{name:jv,hash:{name:"SHA-256"}};case LJ:return{name:jv,hash:{name:"SHA-384"}};case LZ:return{name:jv,hash:{name:"SHA-512"}};case LK:if(!e.parameters)throw TypeError("Cannot get required parameters from EC algorithm");switch(Bm.parse(e.parameters,Fe).namedCurve){case LY:return{name:jv,namedCurve:"P-256"};case tP.SECP256K1:return{name:jv,namedCurve:"K-256"};case LX:return{name:jv,namedCurve:"P-384"};case L0:return{name:jv,namedCurve:"P-521"};case U2:return{name:jv,namedCurve:jo};case U3:return{name:jv,namedCurve:ja};case U4:return{name:jv,namedCurve:jl};case U5:return{name:jv,namedCurve:jc};case U6:return{name:jv,namedCurve:ju};case U8:return{name:jv,namedCurve:jh};case U7:return{name:jv,namedCurve:jd};case U9:return{name:jv,namedCurve:jf};case je:return{name:jv,namedCurve:jp};case jt:return{name:jv,namedCurve:jg};case jr:return{name:jv,namedCurve:jm};case jn:return{name:jv,namedCurve:jy};case ji:return{name:jv,namedCurve:jb};case js:return{name:jv,namedCurve:jw}}}return null}};jE.SECP256K1="1.3.132.0.10",jE=tP=(0,By.Cg)([Us()],jE),Ur.registerSingleton(UY,jE);let jA=Symbol("name"),jx=Symbol("value");class jS{constructor(e,t={},r=""){for(let n in this[jA]=e,this[jx]=r,t)this[n]=t[n]}}jS.NAME=jA,jS.VALUE=jx;class jk{static toTextObject(e){let t=new jS("Algorithm Identifier",{},j_.toString(e.algorithm));if(e.parameters)if(e.algorithm===LK){let r=new jE().toWebAlgorithm(e);r&&"namedCurve"in r?t["Named Curve"]=r.namedCurve:t.Parameters=e.parameters}else t.Parameters=e.parameters;return t}}class j_{static toString(e){let t=this.items[e];return t||e}}j_.items={[Fy]:"sha1",[Fb]:"sha224",[Fw]:"sha256",[Fv]:"sha384",[FE]:"sha512",[Fi]:"rsaEncryption",[Fu]:"sha1WithRSAEncryption",[Fh]:"sha224WithRSAEncryption",[Fd]:"sha256WithRSAEncryption",[Ff]:"sha384WithRSAEncryption",[Fp]:"sha512WithRSAEncryption",[LK]:"ecPublicKey",[LG]:"ecdsaWithSHA1",[LW]:"ecdsaWithSHA224",[LQ]:"ecdsaWithSHA256",[LJ]:"ecdsaWithSHA384",[LZ]:"ecdsaWithSHA512",[Mi]:"TLS WWW server authentication",[Ms]:"TLS WWW client authentication",[Mo]:"Code Signing",[Ma]:"E-mail Protection",[Ml]:"Time Stamping",[Mc]:"OCSP Signing",[Lq]:"Signed Data"};class jI{static serialize(e){return this.serializeObj(e).join("\n")}static pad(e=0){return"".padStart(2*e," ")}static serializeObj(e,t=0){let r=[],n=this.pad(t++),i="",s=e[jS.VALUE];for(let o in s&&(i=` ${s}`),r.push(`${n}${e[jS.NAME]}:${i}`),n=this.pad(t),e){if("symbol"==typeof o)continue;let i=e[o],s=o?`${o}: `:"";if("string"==typeof i||"number"==typeof i||"boolean"==typeof i)r.push(`${n}${s}${i}`);else if(i instanceof Date)r.push(`${n}${s}${i.toUTCString()}`);else if(Array.isArray(i))for(let e of i)e[jS.NAME]=o,r.push(...this.serializeObj(e,t));else if(i instanceof jS)i[jS.NAME]=o,r.push(...this.serializeObj(i,t));else if(Ec._H.isBufferSource(i))o?(r.push(`${n}${s}`),r.push(...this.serializeBufferSource(i,t+1))):r.push(...this.serializeBufferSource(i,t));else if("toTextObject"in i){let e=i.toTextObject();e[jS.NAME]=o,r.push(...this.serializeObj(e,t))}else throw TypeError("Cannot serialize data in text format. Unsupported type.")}return r}static serializeBufferSource(e,t=0){let r=this.pad(t),n=Ec._H.toUint8Array(e),i=[];for(let e=0;e<n.length;){let t=[];for(let r=0;r<16&&e<n.length;r++){8===r&&t.push("");let i=n[e++].toString(16).padStart(2,"0");t.push(i)}i.push(`${r}${t.join(" ")}`)}return i}static serializeAlgorithm(e){return this.algorithmSerializer.toTextObject(e)}}jI.oidSerializer=j_,jI.algorithmSerializer=jk;class jC{constructor(...e){if(1===e.length){let t=e[0];this.rawData=Bm.serialize(t),this.onInit(t)}else{let t=Bm.parse(e[0],e[1]);this.rawData=Ec._H.toArrayBuffer(e[0]),this.onInit(t)}}equal(e){return e instanceof jC&&(0,Ec.n4)(e.rawData,this.rawData)}toString(e="text"){switch(e){case"asn":return Bm.toString(this.rawData);case"text":return jI.serialize(this.toTextObject());case"hex":return Ec.U$.ToHex(this.rawData);case"base64":return Ec.U$.ToBase64(this.rawData);case"base64url":return Ec.U$.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){let e=this.toTextObjectEmpty();return e[""]=this.rawData,e}toTextObjectEmpty(e){return new jS(this.getTextName(),{},e)}}jC.NAME="ASN";class jT extends jC{constructor(...e){let t;super(t=Ec._H.isBufferSource(e[0])?Ec._H.toArrayBuffer(e[0]):Bm.serialize(new MB({extnID:e[0],critical:e[1],extnValue:new DH(Ec._H.toArrayBuffer(e[2]))})),MB)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}toTextObject(){let e=this.toTextObjectWithoutValue();return e[""]=this.value,e}toTextObjectWithoutValue(){let e=this.toTextObjectEmpty(this.critical?"critical":void 0);return e[jS.NAME]===jT.NAME&&(e[jS.NAME]=j_.toString(this.type)),e}}class jP{static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&void 0!==e.extractable}constructor(){this.items=new Map,this[tR]="CryptoProvider","undefined"!=typeof self&&"undefined"!=typeof crypto?this.set(jP.DEFAULT,crypto):void 0!==r.g&&r.g.crypto&&r.g.crypto.subtle&&this.set(jP.DEFAULT,r.g.crypto)}clear(){this.items.clear()}delete(e){return this.items.delete(e)}forEach(e,t){return this.items.forEach(e,t)}has(e){return this.items.has(e)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(e=jP.DEFAULT){let t=this.items.get(e.toLowerCase());if(!t)throw Error(`Cannot get Crypto by name '${e}'`);return t}set(e,t){if("string"==typeof e){if(!t)throw TypeError("Argument 'value' is required");this.items.set(e.toLowerCase(),t)}else this.items.set(jP.DEFAULT,e);return this}}tR=Symbol.toStringTag,jP.DEFAULT="default";let jR=new jP,jO=/^[0-2](?:\.[1-9][0-9]*)+$/;function jN(e){return new RegExp(jO).test(e)}class jD{constructor(e={}){for(let t in this.items={},e)this.register(t,e[t])}get(e){return this.items[e]||null}findId(e){return jN(e)?e:this.get(e)}register(e,t){this.items[e]=t,this.items[t]=e}}let jB=new jD;function jM(e,t){return`\\${Ec.U$.ToHex(Ec.U$.FromUtf8String(t)).toUpperCase()}`}function jL(e){return e.replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,jM)}jB.register("CN","2.5.4.3"),jB.register("L","2.5.4.7"),jB.register("ST","2.5.4.8"),jB.register("O","2.5.4.10"),jB.register("OU","2.5.4.11"),jB.register("C","2.5.4.6"),jB.register("DC","0.9.2342.19200300.100.1.25"),jB.register("E","1.2.840.113549.1.9.1"),jB.register("G","2.5.4.42"),jB.register("I","2.5.4.43"),jB.register("SN","2.5.4.4"),jB.register("T","2.5.4.12");class jF{static isASCII(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!1;return!0}static isPrintableString(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(e)}constructor(e,t={}){for(let e in this.extraNames=new jD,this.asn=new BS,t)if(Object.prototype.hasOwnProperty.call(t,e)){let r=t[e];this.extraNames.register(e,r)}"string"==typeof e?this.asn=this.fromString(e):e instanceof BS?this.asn=e:Ec._H.isBufferSource(e)?this.asn=Bm.parse(e,BS):this.asn=this.fromJSON(e)}getField(e){let t=this.extraNames.findId(e)||jB.findId(e),r=[];for(let e of this.asn)for(let n of e)n.type===t&&r.push(n.value.toString());return r}getName(e){return this.extraNames.get(e)||jB.get(e)}toString(){return this.asn.map(e=>e.map(e=>{let t=this.getName(e.type)||e.type,r=e.value.anyValue?`#${Ec.U$.ToHex(e.value.anyValue)}`:jL(e.value.toString());return`${t}=${r}`}).join("+")).join(", ")}toJSON(){var e;let t=[];for(let r of this.asn){let n={};for(let t of r){let r=this.getName(t.type)||t.type;null!=(e=n[r])||(n[r]=[]),n[r].push(t.value.anyValue?`#${Ec.U$.ToHex(t.value.anyValue)}`:t.value.toString())}t.push(n)}return t}fromString(e){let t=new BS,r=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g,n=null,i=",";for(;n=r.exec(`${e},`);){let[,e,r]=n,s=r[r.length-1];(","===s||"+"===s)&&(r=r.slice(0,r.length-1),n[3]=s);let o=n[3];e=this.getTypeOid(e);let a=this.createAttribute(e,r);"+"===i?t[t.length-1].push(a):t.push(new BA([a])),i=o}return t}fromJSON(e){let t=new BS;for(let r of e){let e=new BA;for(let t in r){let n=this.getTypeOid(t);for(let i of r[t]){let t=this.createAttribute(n,i);e.push(t)}}t.push(e)}return t}getTypeOid(e){if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw Error(`Cannot get OID for name type '${e}'`);return e}createAttribute(e,t){let r=new BE({type:e});if("object"==typeof t)for(let e in t)switch(e){case"ia5String":r.value.ia5String=t[e];break;case"utf8String":r.value.utf8String=t[e];break;case"universalString":r.value.universalString=t[e];break;case"bmpString":r.value.bmpString=t[e];break;case"printableString":r.value.printableString=t[e]}else if("#"===t[0])r.value.anyValue=Ec.U$.FromHex(t.slice(1));else{let n=this.processStringValue(t);e===this.getName("E")||e===this.getName("DC")?r.value.ia5String=n:jF.isPrintableString(n)?r.value.printableString=n:r.value.utf8String=n}return r}processStringValue(e){let t=/"(.*?[^\\])?"/.exec(e);return t&&(e=t[1]),e.replace(/\\0a/ig,"\n").replace(/\\0d/ig,"\r").replace(/\\0g/ig,"	").replace(/\\(.)/g,"$1")}toArrayBuffer(){return Bm.serialize(this.asn)}async getThumbprint(...e){var t;let r,n="SHA-1";return!(e.length>=1)||(null==(t=e[0])?void 0:t.subtle)?r=e[0]||jR.get():(n=e[0]||n,r=e[1]||jR.get()),await r.subtle.digest(n,this.toArrayBuffer())}}let jU="Cannot initialize GeneralName from ASN.1 data.",jj=`${jU} Unsupported string format in use.`,j$=`${jU} Value doesn't match to GUID regular expression.`,jH=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,jq="1.3.6.1.4.1.311.25.1",jz="1.3.6.1.4.1.311.20.2.3",jV="dns",jK="dn",jG="email",jW="ip",jQ="url",jJ="guid",jZ="upn",jY="id";class jX extends jC{constructor(...e){let t;if(2===e.length)switch(e[0]){case jK:{let r=new jF(e[1]).toArrayBuffer(),n=Bm.parse(r,BS);t=new BC({directoryName:n});break}case jV:t=new BC({dNSName:e[1]});break;case jG:t=new BC({rfc822Name:e[1]});break;case jJ:{let r=RegExp(jH,"i").exec(e[1]);if(!r)throw Error("Cannot parse GUID value. Value doesn't match to regular expression");let n=r.slice(1).map((e,t)=>t<3?Ec.U$.ToHex(new Uint8Array(Ec.U$.FromHex(e)).reverse()):e).join("");t=new BC({otherName:new B_({typeId:jq,value:Bm.serialize(new DH(Ec.U$.FromHex(n)))})});break}case jW:t=new BC({iPAddress:e[1]});break;case jY:t=new BC({registeredID:e[1]});break;case jZ:t=new BC({otherName:new B_({typeId:jz,value:Bm.serialize(DX.toASN(e[1]))})});break;case jQ:t=new BC({uniformResourceIdentifier:e[1]});break;default:throw Error("Cannot create GeneralName. Unsupported type of the name")}else t=Ec._H.isBufferSource(e[0])?Bm.parse(e[0],BC):e[0];super(t)}onInit(e){if(void 0!=e.dNSName)this.type=jV,this.value=e.dNSName;else if(void 0!=e.rfc822Name)this.type=jG,this.value=e.rfc822Name;else if(void 0!=e.iPAddress)this.type=jW,this.value=e.iPAddress;else if(void 0!=e.uniformResourceIdentifier)this.type=jQ,this.value=e.uniformResourceIdentifier;else if(void 0!=e.registeredID)this.type=jY,this.value=e.registeredID;else if(void 0!=e.directoryName)this.type=jK,this.value=new jF(e.directoryName).toString();else if(void 0!=e.otherName)if(e.otherName.typeId===jq){this.type=jJ;let t=Bm.parse(e.otherName.value,DH),r=RegExp(jH,"i").exec(Ec.U$.ToHex(t));if(!r)throw Error(j$);this.value=r.slice(1).map((e,t)=>t<3?Ec.U$.ToHex(new Uint8Array(Ec.U$.FromHex(e)).reverse()):e).join("-")}else if(e.otherName.typeId===jz)this.type=jZ,this.value=Bm.parse(e.otherName.value,Bw).toString();else throw Error(jj);else throw Error(jj)}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let e;switch(this.type){case jK:case jV:case jJ:case jW:case jY:case jZ:case jQ:e=this.type.toUpperCase();break;case jG:e="Email";break;default:throw Error("Unsupported GeneralName type")}let t=this.value;return this.type===jY&&(t=j_.toString(t)),new jS(e,void 0,t)}}class j0 extends jC{constructor(e){let t;if(e instanceof BK)t=e;else if(Array.isArray(e)){let r=[];for(let t of e)if(t instanceof BC)r.push(t);else{let e=Bm.parse(new jX(t.type,t.value).rawData,BC);r.push(e)}t=new BK(r)}else if(Ec._H.isBufferSource(e))t=Bm.parse(e,BK);else throw Error("Cannot initialize GeneralNames. Incorrect incoming arguments");super(t)}onInit(e){let t=[];for(let r of e){let e=null;try{e=new jX(r)}catch{continue}t.push(e)}this.items=t}toJSON(){return this.items.map(e=>e.toJSON())}toTextObject(){let e=super.toTextObjectEmpty();for(let t of this.items){let r=t.toTextObject(),n=e[r[jS.NAME]];Array.isArray(n)||(n=[],e[r[jS.NAME]]=n),n.push(r)}return e}}j0.NAME="GeneralNames";let j1="-{5}",j2="\\n",j3=`[^${j2}]+`,j4=`${j1}BEGIN (${j3}(?=${j1}))${j1}`,j5=`${j1}END \\1${j1}`,j6="\\n",j8=`[^:${j2}]+`,j7=`(?:[^${j2}]+${j6}(?: +[^${j2}]+${j6})*)`,j9="[a-zA-Z0-9=+/]+",$e=`(?:${j9}${j6})+`,$t=`${j4}${j6}(?:((?:${j8}: ${j7})+))?${j6}?(${$e})${j5}`;class $r{static isPem(e){return"string"==typeof e&&RegExp($t,"g").test(e)}static decodeWithHeaders(e){e=e.replace(/\r/g,"");let t=RegExp($t,"g"),r=[],n=null;for(;n=t.exec(e);){let e=n[3].replace(RegExp(`[${j2}]+`,"g"),""),t={type:n[1],headers:[],rawData:Ec.U$.FromBase64(e)},i=n[2];if(i){let e=i.split(RegExp(j6,"g")),r=null;for(let n of e){let[e,i]=n.split(/:(.*)/);if(void 0===i){if(!r)throw Error("Cannot parse PEM string. Incorrect header value");r.value+=e.trim()}else r&&t.headers.push(r),r={key:e,value:i.trim()}}r&&t.headers.push(r)}r.push(t)}return r}static decode(e){return this.decodeWithHeaders(e).map(e=>e.rawData)}static decodeFirst(e){let t=this.decode(e);if(!t.length)throw RangeError("PEM string doesn't contain any objects");return t[0]}static encode(e,t){if(Array.isArray(e)){let r=[];return t?e.forEach(e=>{if(!Ec._H.isBufferSource(e))throw TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");r.push(this.encodeStruct({type:t,rawData:Ec._H.toArrayBuffer(e)}))}):e.forEach(e=>{if(!("type"in e))throw TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");r.push(this.encodeStruct(e))}),r.join("\n")}if(!t)throw Error("Required argument 'tag' is missed");return this.encodeStruct({type:t,rawData:Ec._H.toArrayBuffer(e)})}static encodeStruct(e){var t;let r,n=e.type.toLocaleUpperCase(),i=[];if(i.push(`-----BEGIN ${n}-----`),null==(t=e.headers)?void 0:t.length){for(let t of e.headers)i.push(`${t.key}: ${t.value}`);i.push("")}let s=Ec.U$.ToBase64(e.rawData),o=0,a=[];for(;o<s.length;)if(s.length-o<64?r=s.substring(o):(r=s.substring(o,o+64),o+=64),0!==r.length){if(a.push(r),r.length<64)break}else break;return i.push(...a),i.push(`-----END ${n}-----`),i.join("\n")}}$r.CertificateTag="CERTIFICATE",$r.CrlTag="CRL",$r.CertificateRequestTag="CERTIFICATE REQUEST",$r.PublicKeyTag="PUBLIC KEY",$r.PrivateKeyTag="PRIVATE KEY";class $n extends jC{static isAsnEncoded(e){return Ec._H.isBufferSource(e)||"string"==typeof e}static toArrayBuffer(e){if("string"==typeof e)if($r.isPem(e))return $r.decode(e)[0];else if(Ec.U$.isHex(e))return Ec.U$.FromHex(e);else if(Ec.U$.isBase64(e))return Ec.U$.FromBase64(e);else if(Ec.U$.isBase64Url(e))return Ec.U$.FromBase64Url(e);else throw TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url");{let t=Ec.U$.ToBinary(e);if($r.isPem(t))return $r.decode(t)[0];if(Ec.U$.isHex(t))return Ec.U$.FromHex(t);if(Ec.U$.isBase64(t))return Ec.U$.FromBase64(t);else if(Ec.U$.isBase64Url(t))return Ec.U$.FromBase64Url(t);return Ec._H.toArrayBuffer(e)}}constructor(...e){$n.isAsnEncoded(e[0])?super($n.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){return"pem"===e?$r.encode(this.rawData,this.tag):super.toString(e)}}class $i extends $n{static async create(e,t=jR.get()){if(e instanceof $i)return e;if(jP.isCryptoKey(e)){if("public"!==e.type)throw TypeError("Public key is required");return new $i(await t.subtle.exportKey("spki",e))}if(e.publicKey)return e.publicKey;if(Ec._H.isBufferSource(e))return new $i(e);throw TypeError("Unsupported PublicKeyType")}constructor(e){$n.isAsnEncoded(e)?super(e,MO):super(e),this.tag=$r.PublicKeyTag}async export(...e){let t,r=["verify"],n={hash:"SHA-256",...this.algorithm};e.length>1?(n=e[0]||n,r=e[1]||r,t=e[2]||jR.get()):t=e[0]||jR.get();let i=this.rawData,s=Bm.parse(this.rawData,MO);return s.algorithm.algorithm===Fa&&(i=$s(s,i)),t.subtle.importKey("spki",i,n,!0,r)}onInit(e){let t=Ur.resolve(U0),r=this.algorithm=t.toWebAlgorithm(e.algorithm);if(e.algorithm.algorithm===Fi){let t=Bm.parse(e.subjectPublicKey,FM),n=Ec._H.toUint8Array(t.modulus);r.publicExponent=Ec._H.toUint8Array(t.publicExponent),r.modulusLength=(!n[0]?n.slice(1):n).byteLength<<3}}async getThumbprint(...e){var t;let r,n="SHA-1";return!(e.length>=1)||(null==(t=e[0])?void 0:t.subtle)?r=e[0]||jR.get():(n=e[0]||n,r=e[1]||jR.get()),await r.subtle.digest(n,this.rawData)}async getKeyIdentifier(...e){let t,r="SHA-1";1===e.length?"string"==typeof e[0]?(r=e[0],t=jR.get()):t=e[0]:2===e.length?(r=e[0],t=e[1]):t=jR.get();let n=Bm.parse(this.rawData,MO);return await t.subtle.digest(r,n.subjectPublicKey)}toTextObject(){let e=this.toTextObjectEmpty(),t=Bm.parse(this.rawData,MO);return e.Algorithm=jI.serializeAlgorithm(t.algorithm),t.algorithm.algorithm===LK?e["EC Point"]=t.subjectPublicKey:e["Raw Data"]=t.subjectPublicKey,e}}function $s(e,t){return e.algorithm=new MR({algorithm:Fi,parameters:null}),t=Bm.serialize(e)}class $o extends jT{static async create(e,t=!1,r=jR.get()){if("name"in e&&"serialNumber"in e)return new $o(e,t);let n=await $i.create(e,r),i=await n.getKeyIdentifier(r);return new $o(Ec.U$.ToHex(i),t)}constructor(...e){if(Ec._H.isBufferSource(e[0]))super(e[0]);else if("string"==typeof e[0])super(B$,e[1],Bm.serialize(new Bq({keyIdentifier:new BH(Ec.U$.FromHex(e[0]))})));else{let t=e[0];super(B$,e[1],Bm.serialize(new Bq({authorityCertIssuer:t.name instanceof j0?Bm.parse(t.name.rawData,BK):t.name,authorityCertSerialNumber:Ec.U$.FromHex(t.serialNumber)})))}}onInit(e){super.onInit(e);let t=Bm.parse(e.extnValue,Bq);t.keyIdentifier&&(this.keyId=Ec.U$.ToHex(t.keyIdentifier)),(t.authorityCertIssuer||t.authorityCertSerialNumber)&&(this.certId={name:t.authorityCertIssuer||[],serialNumber:t.authorityCertSerialNumber?Ec.U$.ToHex(t.authorityCertSerialNumber):""})}toTextObject(){let e=this.toTextObjectWithoutValue(),t=Bm.parse(this.value,Bq);return t.authorityCertIssuer&&(e["Authority Issuer"]=new j0(t.authorityCertIssuer).toTextObject()),t.authorityCertSerialNumber&&(e["Authority Serial Number"]=t.authorityCertSerialNumber),t.keyIdentifier&&(e[""]=t.keyIdentifier),e}}$o.NAME="Authority Key Identifier";class $a extends jT{constructor(...e){if(Ec._H.isBufferSource(e[0])){super(e[0]);let t=Bm.parse(this.value,BV);this.ca=t.cA,this.pathLength=t.pathLenConstraint}else super(Bz,e[2],Bm.serialize(new BV({cA:e[0],pathLenConstraint:e[1]}))),this.ca=e[0],this.pathLength=e[1]}toTextObject(){let e=this.toTextObjectWithoutValue();return this.ca&&(e.CA=this.ca),void 0!==this.pathLength&&(e["Path Length"]=this.pathLength),e}}$a.NAME="Basic Constraints",function(e){e.serverAuth="1.3.6.1.5.5.7.3.1",e.clientAuth="1.3.6.1.5.5.7.3.2",e.codeSigning="1.3.6.1.5.5.7.3.3",e.emailProtection="1.3.6.1.5.5.7.3.4",e.timeStamping="1.3.6.1.5.5.7.3.8",e.ocspSigning="1.3.6.1.5.5.7.3.9"}(tO||(tO={}));class $l extends jT{constructor(...e){if(Ec._H.isBufferSource(e[0])){super(e[0]);let t=Bm.parse(this.value,Mn);this.usages=t.map(e=>e)}else super(Mr,e[1],Bm.serialize(new Mn(e[0]))),this.usages=e[0]}toTextObject(){let e=this.toTextObjectWithoutValue();return e[""]=this.usages.map(e=>j_.toString(e)).join(", "),e}}$l.NAME="Extended Key Usages",function(e){e[e.digitalSignature=1]="digitalSignature",e[e.nonRepudiation=2]="nonRepudiation",e[e.keyEncipherment=4]="keyEncipherment",e[e.dataEncipherment=8]="dataEncipherment",e[e.keyAgreement=16]="keyAgreement",e[e.keyCertSign=32]="keyCertSign",e[e.cRLSign=64]="cRLSign",e[e.encipherOnly=128]="encipherOnly",e[e.decipherOnly=256]="decipherOnly"}(tN||(tN={}));class $c extends jT{constructor(...e){if(Ec._H.isBufferSource(e[0])){super(e[0]);let t=Bm.parse(this.value,Mp);this.usages=t.toNumber()}else super(Mf,e[1],Bm.serialize(new Mp(e[0]))),this.usages=e[0]}toTextObject(){let e=this.toTextObjectWithoutValue(),t=Bm.parse(this.value,Mp);return e[""]=t.toJSON().join(", "),e}}$c.NAME="Key Usages";class $u extends jT{static async create(e,t=!1,r=jR.get()){let n=await $i.create(e,r),i=await n.getKeyIdentifier(r);return new $u(Ec.U$.ToHex(i),t)}constructor(...e){if(Ec._H.isBufferSource(e[0])){super(e[0]);let t=Bm.parse(this.value,M_);this.keyId=Ec.U$.ToHex(t)}else{let t="string"==typeof e[0]?Ec.U$.FromHex(e[0]):e[0];super(Mk,e[1],Bm.serialize(new M_(t))),this.keyId=Ec.U$.ToHex(t)}}toTextObject(){let e=this.toTextObjectWithoutValue(),t=Bm.parse(this.value,M_);return e[""]=t,e}}$u.NAME="Subject Key Identifier";class $h extends jT{constructor(...e){Ec._H.isBufferSource(e[0])?super(e[0]):super(ME,e[1],new j0(e[0]||[]).rawData)}onInit(e){super.onInit(e);let t=Bm.parse(e.extnValue,MA);this.names=new j0(t)}toTextObject(){let e=this.toTextObjectWithoutValue(),t=this.names.toTextObject();for(let r in t)e[r]=t[r];return e}}$h.NAME="Subject Alternative Name";class $d{static register(e,t){this.items.set(e,t)}static create(e){let t=new jT(e),r=this.items.get(t.type);return r?new r(e):t}}$d.items=new Map;class $f extends jT{constructor(...e){var t;if(Ec._H.isBufferSource(e[0])){super(e[0]);let t=Bm.parse(this.value,B1);this.policies=t.map(e=>e.policyIdentifier)}else{let r=e[0];super(BW,null!=(t=e[1])&&t,Bm.serialize(new B1(r.map(e=>new B0({policyIdentifier:e}))))),this.policies=r}}toTextObject(){let e=this.toTextObjectWithoutValue();return e.Policy=this.policies.map(e=>new jS("",{},j_.toString(e))),e}}$f.NAME="Certificate Policies",$d.register(BW,$f);class $p extends jT{constructor(...e){var t;Ec._H.isBufferSource(e[0])?super(e[0]):Array.isArray(e[0])&&"string"==typeof e[0][0]?super(B4,e[1],Bm.serialize(new B7(e[0].map(e=>new B8({distributionPoint:new B6({fullName:[new BC({uniformResourceIdentifier:e})]})}))))):super(B4,e[1],Bm.serialize(new B7(e[0]))),null!=(t=this.distributionPoints)||(this.distributionPoints=[])}onInit(e){super.onInit(e);let t=Bm.parse(e.extnValue,B7);this.distributionPoints=t}toTextObject(){let e=this.toTextObjectWithoutValue();return e["Distribution Point"]=this.distributionPoints.map(e=>{var t;let r={};return e.distributionPoint&&(r[""]=null==(t=e.distributionPoint.fullName)?void 0:t.map(e=>new jX(e).toString()).join(", ")),e.reasons&&(r.Reasons=e.reasons.toString()),e.cRLIssuer&&(r["CRL Issuer"]=e.cRLIssuer.map(e=>e.toString()).join(", ")),r}),e}}$p.NAME="CRL Distribution Points";class $g extends jT{constructor(...e){var t,r,n,i;if(Ec._H.isBufferSource(e[0]))super(e[0]);else if(e[0]instanceof Bj)super(BF,e[1],Bm.serialize(new Bj(e[0])));else{let t=e[0],r=new Bj;$y(r,t,BN,"ocsp"),$y(r,t,BD,"caIssuers"),$y(r,t,BB,"timeStamping"),$y(r,t,BM,"caRepository"),super(BF,e[1],Bm.serialize(r))}null!=(t=this.ocsp)||(this.ocsp=[]),null!=(r=this.caIssuers)||(this.caIssuers=[]),null!=(n=this.timeStamping)||(this.timeStamping=[]),null!=(i=this.caRepository)||(this.caRepository=[])}onInit(e){super.onInit(e),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[],Bm.parse(e.extnValue,Bj).forEach(e=>{switch(e.accessMethod){case BN:this.ocsp.push(new jX(e.accessLocation));break;case BD:this.caIssuers.push(new jX(e.accessLocation));break;case BB:this.timeStamping.push(new jX(e.accessLocation));break;case BM:this.caRepository.push(new jX(e.accessLocation))}})}toTextObject(){let e=this.toTextObjectWithoutValue();return this.ocsp.length&&$m(e,"OCSP",this.ocsp),this.caIssuers.length&&$m(e,"CA Issuers",this.caIssuers),this.timeStamping.length&&$m(e,"Time Stamping",this.timeStamping),this.caRepository.length&&$m(e,"CA Repository",this.caRepository),e}}function $m(e,t,r){if(1===r.length)e[t]=r[0].toTextObject();else{let n=new jS("");r.forEach((e,t)=>{let r=e.toTextObject(),i=`${r[jS.NAME]} ${t+1}`,s=n[i];Array.isArray(s)||(s=[],n[i]=s),s.push(r)}),e[t]=n}}function $y(e,t,r,n){let i=t[n];i&&(Array.isArray(i)?i:[i]).forEach(t=>{"string"==typeof t&&(t=new jX("url",t)),e.push(new BU({accessMethod:r,accessLocation:Bm.parse(t.rawData,BC)}))})}$g.NAME="Authority Info Access";class $b extends jC{constructor(...e){let t;if(Ec._H.isBufferSource(e[0]))t=Ec._H.toArrayBuffer(e[0]);else{let r=e[0],n=Array.isArray(e[1])?e[1].map(e=>Ec._H.toArrayBuffer(e)):[];t=Bm.serialize(new Mx({type:r,values:n}))}super(t,Mx)}onInit(e){this.type=e.type,this.values=e.values}toTextObject(){let e=this.toTextObjectWithoutValue();return e.Value=this.values.map(e=>new jS("",{"":e})),e}toTextObjectWithoutValue(){let e=this.toTextObjectEmpty();return e[jS.NAME]===$b.NAME&&(e[jS.NAME]=j_.toString(this.type)),e}}$b.NAME="Attribute";class $w extends $b{constructor(...e){var t;Ec._H.isBufferSource(e[0])?super(e[0]):super(US,[Bm.serialize(new Uq({printableString:e[0]}))]),null!=(t=this.password)||(this.password="")}onInit(e){if(super.onInit(e),this.values[0]){let e=Bm.parse(this.values[0],Uq);this.password=e.toString()}}toTextObject(){let e=this.toTextObjectWithoutValue();return e[jS.VALUE]=this.password,e}}$w.NAME="Challenge Password";class $v extends $b{constructor(...e){var t;if(Ec._H.isBufferSource(e[0]))super(e[0]);else{let t=e[0],r=new MM;for(let e of t)r.push(Bm.parse(e.rawData,MB));super(Uk,[Bm.serialize(r)])}null!=(t=this.items)||(this.items=[])}onInit(e){if(super.onInit(e),this.values[0]){let e=Bm.parse(this.values[0],MM);this.items=e.map(e=>$d.create(Bm.serialize(e)))}}toTextObject(){let e=this.toTextObjectWithoutValue();for(let t of this.items.map(e=>e.toTextObject()))e[t[jS.NAME]]=t;return e}}$v.NAME="Extensions";class $E{static register(e,t){this.items.set(e,t)}static create(e){let t=new $b(e),r=this.items.get(t.type);return r?new r(e):t}}$E.items=new Map;let $A="crypto.signatureFormatter";class $x{toAsnSignature(e,t){return Ec._H.toArrayBuffer(t)}toWebSignature(e,t){return Ec._H.toArrayBuffer(t)}}let $S=tD=class{static createPssParams(e,t){let r=tD.getHashAlgorithm(e);return r?new FR({hashAlgorithm:r,maskGenAlgorithm:new MR({algorithm:Fk,parameters:Bm.serialize(r)}),saltLength:t}):null}static getHashAlgorithm(e){let t=Ur.resolve(U0);return"string"==typeof e?t.toAsnAlgorithm({name:e}):"object"==typeof e&&e&&"name"in e?t.toAsnAlgorithm(e):null}toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if(!("hash"in e))return new MR({algorithm:Fi,parameters:null});{let t;if("string"==typeof e.hash)t=e.hash;else if(e.hash&&"object"==typeof e.hash&&"name"in e.hash&&"string"==typeof e.hash.name)t=e.hash.name.toUpperCase();else throw Error("Cannot get hash algorithm name");switch(t.toLowerCase()){case"sha-1":return new MR({algorithm:Fu,parameters:null});case"sha-256":return new MR({algorithm:Fd,parameters:null});case"sha-384":return new MR({algorithm:Ff,parameters:null});case"sha-512":return new MR({algorithm:Fp,parameters:null})}}break;case"rsa-pss":if(!("hash"in e))return new MR({algorithm:Fa,parameters:null});{if(!("saltLength"in e&&"number"==typeof e.saltLength))throw Error("Cannot get 'saltLength' from 'alg' argument");let t=tD.createPssParams(e.hash,e.saltLength);if(!t)throw Error("Cannot create PSS parameters");return new MR({algorithm:Fa,parameters:Bm.serialize(t)})}}return null}toWebAlgorithm(e){switch(e.algorithm){case Fi:return{name:"RSASSA-PKCS1-v1_5"};case Fu:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case Fd:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case Ff:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case Fp:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case Fa:if(!e.parameters)return{name:"RSA-PSS"};{let t=Bm.parse(e.parameters,FR);return{name:"RSA-PSS",hash:Ur.resolve(U0).toWebAlgorithm(t.hashAlgorithm),saltLength:t.saltLength}}}return null}};$S=tD=(0,By.Cg)([Us()],$S),Ur.registerSingleton(UY,$S);let $k=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"sha-1":return new MR({algorithm:Fy});case"sha-256":return new MR({algorithm:Fw});case"sha-384":return new MR({algorithm:Fv});case"sha-512":return new MR({algorithm:FE})}return null}toWebAlgorithm(e){switch(e.algorithm){case Fy:return{name:"SHA-1"};case Fw:return{name:"SHA-256"};case Fv:return{name:"SHA-384"};case FE:return{name:"SHA-512"}}return null}};$k=(0,By.Cg)([Us()],$k),Ur.registerSingleton(UY,$k);class $_{addPadding(e,t){let r=Ec._H.toUint8Array(t),n=new Uint8Array(e);return n.set(r,e-r.length),n}removePadding(e,t=!1){let r=Ec._H.toUint8Array(e);for(let e=0;e<r.length;e++)if(r[e]){r=r.slice(e);break}if(t&&r[0]>127){let e=new Uint8Array(r.length+1);return e.set(r,1),e.buffer}return r.buffer}toAsnSignature(e,t){if("ECDSA"===e.name){let r=e.namedCurve,n=$_.namedCurveSize.get(r)||$_.defaultNamedCurveSize,i=new Fr,s=Ec._H.toUint8Array(t);return i.r=this.removePadding(s.slice(0,n),!0),i.s=this.removePadding(s.slice(n,n+n),!0),Bm.serialize(i)}return null}toWebSignature(e,t){if("ECDSA"===e.name){let r=Bm.parse(t,Fr),n=e.namedCurve,i=$_.namedCurveSize.get(n)||$_.defaultNamedCurveSize,s=this.addPadding(i,this.removePadding(r.r)),o=this.addPadding(i,this.removePadding(r.s));return(0,Ec.kg)(s,o)}return null}}$_.namedCurveSize=new Map,$_.defaultNamedCurveSize=32;let $I="1.3.101.110",$C="1.3.101.111",$T="1.3.101.112",$P="1.3.101.113",$R=class{toAsnAlgorithm(e){let t=null;switch(e.name.toLowerCase()){case"ed25519":t=$T;break;case"x25519":t=$I;break;case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":t=$T;break;case"ed448":t=$P}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":t=$I;break;case"x448":t=$C}}return t?new MR({algorithm:t}):null}toWebAlgorithm(e){switch(e.algorithm){case $T:return{name:"Ed25519"};case $P:return{name:"EdDSA",namedCurve:"Ed448"};case $I:return{name:"X25519"};case $C:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};$R=(0,By.Cg)([Us()],$R),Ur.registerSingleton(UY,$R);class $O extends $n{constructor(e){$n.isAsnEncoded(e)?super(e,UZ):super(e),this.tag=$r.CertificateRequestTag}onInit(e){this.tbs=Bm.serialize(e.certificationRequestInfo),this.publicKey=new $i(e.certificationRequestInfo.subjectPKInfo);let t=Ur.resolve(U0);this.signatureAlgorithm=t.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signature,this.attributes=e.certificationRequestInfo.attributes.map(e=>$E.create(Bm.serialize(e)));let r=this.getAttribute(Uk);this.extensions=[],r instanceof $v&&(this.extensions=r.items),this.subjectName=new jF(e.certificationRequestInfo.subject),this.subject=this.subjectName.toString()}getAttribute(e){for(let t of this.attributes)if(t.type===e)return t;return null}getAttributes(e){return this.attributes.filter(t=>t.type===e)}getExtension(e){for(let t of this.extensions)if(t.type===e)return t;return null}getExtensions(e){return this.extensions.filter(t=>t.type===e)}async verify(e=jR.get()){let t={...this.publicKey.algorithm,...this.signatureAlgorithm},r=await this.publicKey.export(t,["verify"],e),n=Ur.resolveAll($A).reverse(),i=null;for(let e of n)if(i=e.toWebSignature(t,this.signature))break;if(!i)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return await e.subtle.verify(this.signatureAlgorithm,r,i,this.tbs)}toTextObject(){let e=this.toTextObjectEmpty(),t=Bm.parse(this.rawData,UZ),r=t.certificationRequestInfo,n=new jS("",{Version:`${tn[r.version]} (${r.version})`,Subject:this.subject,"Subject Public Key Info":this.publicKey});if(this.attributes.length){let e=new jS("");for(let t of this.attributes){let r=t.toTextObject();e[r[jS.NAME]]=r}n.Attributes=e}return e.Data=n,e.Signature=new jS("",{Algorithm:jI.serializeAlgorithm(t.signatureAlgorithm),"":t.signature}),e}}$O.NAME="PKCS#10 Certificate Request";class $N extends $n{constructor(e){$n.isAsnEncoded(e)?super(e,MF):super(e),this.tag=$r.CertificateTag}onInit(e){let t=e.tbsCertificate;this.tbs=Bm.serialize(t),this.serialNumber=Ec.U$.ToHex(t.serialNumber),this.subjectName=new jF(t.subject),this.subject=new jF(t.subject).toString(),this.issuerName=new jF(t.issuer),this.issuer=this.issuerName.toString();let r=Ur.resolve(U0);this.signatureAlgorithm=r.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signatureValue;let n=t.validity.notBefore.utcTime||t.validity.notBefore.generalTime;if(!n)throw Error("Cannot get 'notBefore' value");this.notBefore=n;let i=t.validity.notAfter.utcTime||t.validity.notAfter.generalTime;if(!i)throw Error("Cannot get 'notAfter' value");this.notAfter=i,this.extensions=[],t.extensions&&(this.extensions=t.extensions.map(e=>$d.create(Bm.serialize(e)))),this.publicKey=new $i(t.subjectPublicKeyInfo)}getExtension(e){for(let t of this.extensions)if("string"==typeof e){if(t.type===e)return t}else if(t instanceof e)return t;return null}getExtensions(e){return this.extensions.filter(t=>"string"==typeof e?t.type===e:t instanceof e)}async verify(e={},t=jR.get()){let r,n,i=e.publicKey;try{if(i)if("publicKey"in i)r={...i.publicKey.algorithm,...this.signatureAlgorithm},n=await i.publicKey.export(r,["verify"],t);else if(i instanceof $i)r={...i.algorithm,...this.signatureAlgorithm},n=await i.export(r,["verify"],t);else if(Ec._H.isBufferSource(i)){let e=new $i(i);r={...e.algorithm,...this.signatureAlgorithm},n=await e.export(r,["verify"],t)}else r={...i.algorithm,...this.signatureAlgorithm},n=i;else r={...this.publicKey.algorithm,...this.signatureAlgorithm},n=await this.publicKey.export(r,["verify"],t)}catch(e){return!1}let s=Ur.resolveAll($A).reverse(),o=null;for(let e of s)if(o=e.toWebSignature(r,this.signature))break;if(!o)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");let a=await t.subtle.verify(this.signatureAlgorithm,n,o,this.tbs);if(e.signatureOnly)return a;{let t=(e.date||new Date).getTime();return a&&this.notBefore.getTime()<t&&t<this.notAfter.getTime()}}async getThumbprint(...e){let t,r="SHA-1";return e[0]&&(e[0].subtle?t=e[0]:(r=e[0]||r,t=e[1])),null!=t||(t=jR.get()),await t.subtle.digest(r,this.rawData)}async isSelfSigned(e=jR.get()){return this.subject===this.issuer&&await this.verify({signatureOnly:!0},e)}toTextObject(){let e=this.toTextObjectEmpty(),t=Bm.parse(this.rawData,MF),r=t.tbsCertificate,n=new jS("",{Version:`${tn[r.version]} (${r.version})`,"Serial Number":r.serialNumber,"Signature Algorithm":jI.serializeAlgorithm(r.signature),Issuer:this.issuer,Validity:new jS("",{"Not Before":r.validity.notBefore.getTime(),"Not After":r.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(r.issuerUniqueID&&(n["Issuer Unique ID"]=r.issuerUniqueID),r.subjectUniqueID&&(n["Subject Unique ID"]=r.subjectUniqueID),this.extensions.length){let e=new jS("");for(let t of this.extensions){let r=t.toTextObject();e[r[jS.NAME]]=r}n.Extensions=e}return e.Data=n,e.Signature=new jS("",{Algorithm:jI.serializeAlgorithm(t.signatureAlgorithm),"":t.signatureValue}),e}}$N.NAME="Certificate";class $D{static async createSelfSigned(e,t=jR.get()){if(!e.keys.privateKey)throw Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");return this.create({serialNumber:e.serialNumber,subject:e.name,issuer:e.name,notBefore:e.notBefore,notAfter:e.notAfter,publicKey:e.keys.publicKey,signingKey:e.keys.privateKey,signingAlgorithm:e.signingAlgorithm,extensions:e.extensions},t)}static async create(e,t=jR.get()){var r;let n;n=e.publicKey instanceof $i?e.publicKey.rawData:"publicKey"in e.publicKey?e.publicKey.publicKey.rawData:Ec._H.isBufferSource(e.publicKey)?e.publicKey:await t.subtle.exportKey("spki",e.publicKey);let i=e.serialNumber?Ec._H.toUint8Array(Ec.U$.FromHex(e.serialNumber)):t.getRandomValues(new Uint8Array(16));i[0]>127&&(i[0]&=127),i.length>1&&0===i[0]&&(i[1]|=128);let s=e.notBefore||new Date,o=e.notAfter||new Date(s.getTime()+31536e6),a=new MF({tbsCertificate:new ML({version:tn.v3,serialNumber:i,validity:new MD({notBefore:s,notAfter:o}),extensions:new MM((null==(r=e.extensions)?void 0:r.map(e=>Bm.parse(e.rawData,MB)))||[]),subjectPublicKeyInfo:Bm.parse(n,MO)})});if(e.subject){let t=e.subject instanceof jF?e.subject:new jF(e.subject);a.tbsCertificate.subject=Bm.parse(t.toArrayBuffer(),BS)}if(e.issuer){let t=e.issuer instanceof jF?e.issuer:new jF(e.issuer);a.tbsCertificate.issuer=Bm.parse(t.toArrayBuffer(),BS)}let l={hash:"SHA-256"},c="signingKey"in e?{...l,...e.signingAlgorithm,...e.signingKey.algorithm}:{...l,...e.signingAlgorithm},u=Ur.resolve(U0);a.tbsCertificate.signature=a.signatureAlgorithm=u.toAsnAlgorithm(c);let h=Bm.serialize(a.tbsCertificate),d="signingKey"in e?await t.subtle.sign(c,e.signingKey,h):e.signature,f=Ur.resolveAll($A).reverse(),p=null;for(let e of f)if(p=e.toAsnSignature(c,d))break;if(!p)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return a.signatureValue=p,new $N(Bm.serialize(a))}}!function(e){e[e.unspecified=0]="unspecified",e[e.keyCompromise=1]="keyCompromise",e[e.cACompromise=2]="cACompromise",e[e.affiliationChanged=3]="affiliationChanged",e[e.superseded=4]="superseded",e[e.cessationOfOperation=5]="cessationOfOperation",e[e.certificateHold=6]="certificateHold",e[e.removeFromCRL=8]="removeFromCRL",e[e.privilegeWithdrawn=9]="privilegeWithdrawn",e[e.aACompromise=10]="aACompromise"}(tB||(tB={})),$d.register(Bz,$a),$d.register(Mr,$l),$d.register(Mf,$c),$d.register(Mk,$u),$d.register(B$,$o),$d.register(ME,$h),$d.register(B4,$p),$d.register(BF,$g),$E.register(US,$w),$E.register(Uk,$v),Ur.registerSingleton($A,$x),Ur.registerSingleton($A,$_),$_.namedCurveSize.set("P-256",32),$_.namedCurveSize.set("K-256",32),$_.namedCurveSize.set("P-384",48),$_.namedCurveSize.set("P-521",66);class $B extends uS{async listen(){throw new DP("WebRTCTransport.createListener")}getAddrs(){return[]}updateAnnounceAddrs(){}async close(){}}let $M=Object.values(bb.Fo).map(e=>e.decoder).reduce((e,t)=>e.or(t)),$L=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function $F(e){if(null==e)return;let t=e.match($L);return t?.groups?.fingerprint}function $U(e){let t=e.stringTuples().filter(e=>e[0]===ND).map(e=>e[1])[0];if(void 0===t||""===t)throw new uC(`Couldn't find a certhash component of multiaddr: ${e.toString()}`);return t}function $j(e){return bb.br.decode($M.decode(e))}function $$(e){let t=$j($U(e)),r=$q(t.code),n=t.digest.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),""),i=n.match(/.{1,2}/g);if(null==i)throw new DT(n,e.toString());return`${r} ${i.join(":").toUpperCase()}`}function $H(e){let t=e.split(":").map(e=>parseInt(e,16)),r=Uint8Array.from(t),n=aG.create(nK.sha256.code,r);return wt(`/certhash/${a_.base64url.encode(n.bytes)}`)}function $q(e){switch(e){case 17:return"sha-1";case 18:return"sha-256";case 19:return"sha-512";default:throw new DR(e)}}function $z(e,t){let{host:r,port:n,family:i}=e.toOptions(),s=$$(e);return{type:"answer",sdp:`v=0
o=- 0 0 IN IP${i} ${r}
s=-
t=0 0
a=ice-lite
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
c=IN IP${i} ${r}
a=mid:0
a=ice-options:ice2
a=ice-ufrag:${t}
a=ice-pwd:${t}
a=fingerprint:${s}
a=setup:passive
a=sctp-port:5000
a=max-message-size:${NL}
a=candidate:1467250027 1 UDP 1467250027 ${r} ${n} typ host
a=end-of-candidates
`}}function $V(e,t){let{host:r,port:n,family:i}=e.toOptions();return{type:"offer",sdp:`v=0
o=- 0 0 IN IP${i} ${r}
s=-
c=IN IP${i} ${r}
t=0 0
a=ice-options:ice2,trickle
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:active
a=ice-ufrag:${t}
a=ice-pwd:${t}
a=fingerprint:sha-256 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
a=sctp-port:5000
a=max-message-size:${NL}
a=candidate:1467250027 1 UDP 1467250027 ${r} ${n} typ host
a=end-of-candidates
`}}function $K(e,t){if(void 0===e.sdp)throw new uC("Can't munge a missing SDP");let r=e.sdp.includes("\r\n")?"\r\n":"\n";return e.sdp=e.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,"\na=ice-ufrag:"+t+r).replace(/\na=ice-pwd:[^\n]*\n/,"\na=ice-pwd:"+t+r),e}let $G=(0,nm.s)("libp2p-webrtc-noise:");function $W(e,t,r){let n=e.trim().toLowerCase().replaceAll(":",""),i=(0,nm.s)(n,"hex"),s=aG.create(nK.sha256.code,i),o=$M.decode($U(t)),a=$G.byteLength+s.bytes.byteLength+o.byteLength;return"server"===r?rt([$G,o,s.bytes],a):rt([$G,s.bytes,o],a)}let $Q=Dt?"iceconnectionstatechange":"connectionstatechange";async function $J(e,t,r){let n=e.createDataChannel("",{negotiated:!0,id:0});try{if("client"===r.role){r.log.trace("client creating local offer");let n=await e.createOffer();r.log.trace("client created local offer %s",n.sdp);let i=$K(n,t);r.log.trace("client setting local offer %s",i.sdp),await e.setLocalDescription(i);let s=$z(r.remoteAddr,t);r.log.trace("client setting server description %s",s.sdp),await e.setRemoteDescription(s)}else{let n=$V(r.remoteAddr,t);r.log.trace("server setting client %s %s",n.type,n.sdp),await e.setRemoteDescription(n),r.log.trace("server creating local answer");let i=await e.createAnswer();r.log.trace("server created local answer");let s=$K(i,t);r.log.trace("server setting local description %s",i.sdp),await e.setLocalDescription(s)}if("open"!==n.readyState&&(r.log.trace("%s wait for handshake channel to open, starting status %s",r.role,n.readyState),await u0(n,"open",r.signal)),r.log.trace("%s handshake channel opened",r.role),"server"===r.role){let t=e.remoteFingerprint()?.value??"";r.remoteAddr=r.remoteAddr.encapsulate($H(t))}let i=$F(e.localDescription?.sdp);if(null==i)throw new DI("Could not get fingerprint from local description sdp");r.log.trace("%s performing noise handshake",r.role);let s=$W(i,r.remoteAddr,r.role),o=Ca({prologueBytes:s})(r),a=DE({channel:n,direction:"outbound",handshake:!0,logger:r.logger,...r.dataChannel??{}}),l=new Da(r,{peerConnection:e,remoteAddr:r.remoteAddr,timeline:{open:Date.now()},metrics:r.events});e.addEventListener($Q,()=>{switch(e.connectionState){case"failed":case"disconnected":case"closed":l.close().catch(e=>{r.log.error("error closing connection",e),l.abort(e)})}}),r.events?.increment({peer_connection:!0});let c=new DA(r,{peerConnection:e,metrics:r.events,dataChannelOptions:r.dataChannel});if("client"===r.role)return r.log.trace("%s secure inbound",r.role),await o.secureInbound(a,{remotePeer:r.remotePeerId,signal:r.signal,skipStreamMuxerNegotiation:!0}),r.log.trace("%s upgrade outbound",r.role),await r.upgrader.upgradeOutbound(l,{skipProtection:!0,skipEncryption:!0,muxerFactory:c,signal:r.signal});r.log.trace("%s secure outbound",r.role);let u=await o.secureOutbound(a,{remotePeer:r.remotePeerId,signal:r.signal,skipStreamMuxerNegotiation:!0});l.remoteAddr=l.remoteAddr.encapsulate(`/p2p/${u.remotePeer}`),r.log.trace("%s upgrade inbound",r.role),await r.upgrader.upgradeInbound(l,{skipProtection:!0,skipEncryption:!0,muxerFactory:c,signal:r.signal})}catch(e){throw n.close(),e}}async function $Z(e,t,r,n){return null==n&&(n=await RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256"})),new RTCPeerConnection({...("function"==typeof r?await r():r)??{},certificates:[n]})}async function $Y(e){let t=await ym(e),r=await crypto.subtle.exportKey("pkcs8",t.privateKey);return["-----BEGIN PRIVATE KEY-----",...(0,uh.d)(new Uint8Array(r),"base64pad").split(/(.{64})/).filter(Boolean),"-----END PRIVATE KEY-----"].join("\n")}r(44134).Buffer;class $X{log;metrics;components;init;certificate;privateKey;emitter;renewCertificateTask;constructor(e,t={}){if(this.log=e.logger.forComponent("libp2p:webrtc-direct"),this.components=e,this.init=t,this.emitter=new uS,null!=t.certificateLifespan&&null!=t.certificateRenewalThreshold&&t.certificateRenewalThreshold>=t.certificateLifespan)throw new uC("Certificate renewal threshold must be less than certificate lifespan");null!=e.metrics&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}[xh]=!0;[Symbol.toStringTag]="@libp2p/webrtc-direct";[En]=["@libp2p/transport"];async start(){this.certificate=await this.getCertificate()}async stop(){null!=this.renewCertificateTask&&clearTimeout(this.renewCertificateTask),this.certificate=void 0}async dial(e,t){let r;this.log("dial %a",e),t.signal.throwIfAborted();let n=e.getPeerId();null!=n&&(r=yT(n));let i=Do(),s=await $Z("client",i,"function"==typeof this.init.rtcConfiguration?await this.init.rtcConfiguration():this.init.rtcConfiguration??{});try{return await $J(s,i,{role:"client",log:this.log,logger:this.components.logger,metrics:this.components.metrics,events:this.metrics?.dialerEvents,signal:t.signal,remoteAddr:e,dataChannel:this.init.dataChannel,upgrader:t.upgrader,peerId:this.components.peerId,remotePeerId:r,privateKey:this.components.privateKey})}catch(e){throw s.close(),e}}createListener(e){if(null==this.certificate)throw new uK;return new $B(this.components,{...this.init,...e,certificate:this.certificate,emitter:this.emitter})}listenFilter(e){return e.filter(w4.exactMatch)}dialFilter(e){return this.listenFilter(e)}async getCertificate(e){if($0(this.init.certificate))return this.log("using provided TLS certificate"),this.init.certificate;let t=await this.loadOrCreatePrivateKey(),{pem:r,certhash:n}=await this.loadOrCreateCertificate(t,e);return{privateKey:await $Y(t),pem:r,certhash:n}}async loadOrCreatePrivateKey(){if(null!=this.privateKey)return this.privateKey;let e=this.init.certificateKeychainName??NV,t=this.getKeychain();try{if(null==t)throw this.log("no keychain configured - not checking for stored private key"),new uL;this.log.trace("checking for stored private key"),this.privateKey=await t.exportKey(e)}catch(r){if("NotFoundError"!==r.name)throw r;this.log.trace("generating private key"),this.privateKey=await yo("ECDSA","P-256"),null!=t?(this.log.trace("storing private key"),await t.importKey(e,this.privateKey)):this.log("no keychain configured - not storing private key")}return this.privateKey}async loadOrCreateCertificate(e,t){let r;if(null!=this.certificate&&!0!==t)return this.certificate;let n=new u7.U(this.init.certificateDatastoreKey??Nz),i=await ym(e);try{if(!0===t)throw this.log.trace("forcing renewal of TLS certificate"),new uL;this.log.trace("checking for stored TLS certificate"),r=await this.loadCertificate(n,i)}catch(e){if("NotFoundError"!==e.name)throw e;this.log.trace("generating new TLS certificate"),r=await this.createCertificate(n,i)}let s=r.notAfter.getTime()-(this.init.certificateRenewalThreshold??NG)-Date.now();return s<0&&(s=100),this.log("will renew TLS certificate after %d ms",s),this.renewCertificateTask=setTimeout(()=>{this.log("renewing TLS certificate"),this.getCertificate(!0).then(e=>{this.certificate=e,this.emitter.safeDispatchEvent("certificate:renew",{detail:e})}).catch(e=>{this.log.error("could not renew certificate - %e",e)})},s),{pem:r.toString("pem"),certhash:a_.base64url.encode((await nK.sha256.digest(new Uint8Array(r.rawData))).bytes)}}async loadCertificate(e,t){let r=new $N(await this.components.datastore.get(e)),n=r.notAfter.getTime()-(this.init.certificateRenewalThreshold??NG);if(Date.now()>n)throw this.log("stored TLS certificate has expired"),new uL;this.log("loaded certificate, expires in %d ms",n);let i=await r.publicKey.export(crypto),s=await crypto.subtle.exportKey("raw",i),o=await crypto.subtle.exportKey("raw",t.publicKey);if(!rr(new Uint8Array(s,0,s.byteLength),new Uint8Array(o,0,o.byteLength)))throw this.log("stored TLS certificate public key did not match public key from private key"),new uL;return this.log("loaded certificate, expiry time is %o",n),r}async createCertificate(e,t){let r=new Date,n=new Date(Date.now()+(this.init.certificateLifespan??NK));r.setMilliseconds(0),n.setMilliseconds(0);let i=await $D.createSelfSigned({serialNumber:(100000n*BigInt(Math.random().toString().replace(".",""))).toString(16),name:"CN=example.com, C=US, L=CA, O=example, ST=CA",notBefore:r,notAfter:n,keys:t,extensions:[new $a(!1,void 0,!0)]},crypto);return null!=this.getKeychain()?(this.log.trace("storing TLS certificate"),await this.components.datastore.put(e,(0,nm.s)(i.toString("pem")))):this.log("no keychain is configured so not storing TLS certificate since the private key will not be reused"),i}getKeychain(){try{return this.components.keychain}catch{}}}function $0(e){return null!=e&&"string"==typeof e.privateKey&&"string"==typeof e.pem&&"string"==typeof e.certhash}function $1(e){return t=>new $X(t,e)}function $2(e){return t=>new DU(t,e)}let $3=async e=>{if(e.readyState>=2)throw Error("socket closed");1!==e.readyState&&await new Promise((t,r)=>{function n(){e.removeEventListener("open",i),e.removeEventListener("error",s)}function i(){n(),t()}function s(t){n(),r(t.error??Error(`connect ECONNREFUSED ${e.url}`))}e.addEventListener("open",i),e.addEventListener("error",s)})},$4=(e,t)=>((t=t??{}).closeOnEnd=!1!==t.closeOnEnd,async r=>{for await(let t of r){try{await $3(e)}catch(e){if("socket closed"===e.message)break;throw e}if(e.readyState===e.CLOSING||e.readyState===e.CLOSED)break;e.send(t)}null!=t.closeOnEnd&&e.readyState<=1&&await new Promise((t,r)=>{e.addEventListener("close",e=>{e.wasClean||1006===e.code?t():r(Object.assign(Error("ws error"),{event:e}))}),setTimeout(()=>{e.close()})})});var $5=r(77481);function $6(e){return e instanceof ArrayBuffer||e?.constructor?.name==="ArrayBuffer"&&"number"==typeof e?.byteLength}let $8=e=>{let t;e.binaryType="arraybuffer";let r=async()=>{await new Promise((r,n)=>{if(i)return void r();if(null!=t)return void n(t);let s=t=>{e.removeEventListener("open",o),e.removeEventListener("error",a),t()},o=()=>{s(r)},a=t=>{s(()=>{n(t.error??Error(`connect ECONNREFUSED ${e.url}`))})};e.addEventListener("open",o),e.addEventListener("error",a)})},n=async function*(){let t=new $5.PP(({push:t,stop:r,fail:n})=>{let i=e=>{let r=null;"string"==typeof e.data&&(r=(0,nm.s)(e.data)),$6(e.data)&&(r=new Uint8Array(e.data)),e.data instanceof Uint8Array&&(r=e.data),null!=r&&t(r)},s=e=>{n(e.error??Error("Socket error"))};return e.addEventListener("message",i),e.addEventListener("error",s),e.addEventListener("close",r),()=>{e.removeEventListener("message",i),e.removeEventListener("error",s),e.removeEventListener("close",r)}},{highWaterMark:1/0});for await(let e of(await r(),t))yield $6(e)?new Uint8Array(e):e}(),i=1===e.readyState;return e.addEventListener("open",()=>{i=!0,t=null}),e.addEventListener("close",()=>{i=!1,t=null}),e.addEventListener("error",r=>{i||(t=r.error??Error(`connect ECONNREFUSED ${e.url}`))}),Object.assign(n,{connected:r})},$7=(e,t)=>{t=t??{};let r=$8(e),n=t.remoteAddress,i=t.remotePort;if(null!=e.url)try{let t=new URL(e.url);n=t.hostname,i=parseInt(t.port,10)}catch{}if(null==n||null==i)throw Error("Remote connection did not have address and/or port");return{sink:$4(e,t),source:r,connected:async()=>{await r.connected()},close:async()=>{(e.readyState===e.CONNECTING||e.readyState===e.OPEN)&&await new Promise(t=>{e.addEventListener("close",()=>{t()}),e.close()})},destroy:()=>{null!=e.terminate?e.terminate():e.close()},remoteAddress:n,remotePort:i,socket:e}},$9=WebSocket,He={"http:":"ws:","https:":"wss:"},Ht="ws:",Hr=(e,t)=>{if(e.startsWith("//")&&(e=`${t?.protocol??Ht}${e}`),e.startsWith("/")&&null!=t){let r=t.protocol??Ht,n=t.host,i=null!=t.port&&n?.endsWith(`:${t.port}`)!==!0?`:${t.port}`:"";e=`${r}//${n}${i}${e}`}let r=new URL(e);for(let[e,t]of Object.entries(He))r.protocol===e&&(r.protocol=t);return r};function Hn(e,t){return t=t??{},$7(new $9(Hr(e,"undefined"==typeof window?void 0:window.location).toString(),t.websocket),t)}function Hi(e){return e.filter(e=>w2.exactMatch(e)||w0.exactMatch(e))}function Hs(){throw Error("WebSocket Servers can not be created in the browser!")}let Ho=500;function Ha(e,t,r){let n=r.logger.forComponent("libp2p:websockets:maconn"),i=r.metrics,s=r.metricPrefix??"",o={log:n,async sink(t){try{await e.sink(async function*(){for await(let e of t)e instanceof Uint8Array?yield e:yield e.subarray()}())}catch(e){"aborted"!==e.type&&n.error(e)}},source:e.source,remoteAddr:t,timeline:{open:Date.now()},async close(t={}){let r=Date.now();if(null==t.signal){let e=AbortSignal.timeout(Ho);t={...t,signal:e}}let i=()=>{let{host:e,port:t}=o.remoteAddr.toOptions();n("timeout closing stream to %s:%s after %dms, destroying it manually",e,t,Date.now()-r),this.abort(new uk("Socket close timeout"))};t.signal?.addEventListener("abort",i);try{await e.close()}catch(e){n.error("error closing WebSocket gracefully",e),this.abort(e)}finally{t.signal?.removeEventListener("abort",i),o.timeline.close=Date.now()}},abort(t){let{host:r,port:a}=o.remoteAddr.toOptions();n("timeout closing stream to %s:%s due to error",r,a,t),e.destroy(),o.timeline.close=Date.now(),i?.increment({[`${s}error`]:!0})}};return e.socket.addEventListener("close",()=>{i?.increment({[`${s}close`]:!0}),null==o.timeline.close&&(o.timeline.close=Date.now())},{once:!0}),o}class Hl{log;init;logger;metrics;components;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:websockets"),this.logger=e.logger,this.components=e,this.init=t,null!=e.metrics&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_websockets_dialer_events_total",{label:"event",help:"Total count of WebSockets dialer events by type"})})}[xh]=!0;[Symbol.toStringTag]="@libp2p/websockets";[En]=["@libp2p/transport"];async dial(e,t){this.log("dialing %s",e),t=t??{};let r=Ha(await this._connect(e,t),e,{logger:this.logger,metrics:this.metrics?.dialerEvents});this.log("new outbound connection %s",r.remoteAddr);let n=await t.upgrader.upgradeOutbound(r,t);return this.log("outbound connection %s upgraded",r.remoteAddr),n}async _connect(e,t){t?.signal?.throwIfAborted();let r=e.toOptions();this.log("dialing %s:%s",r.host,r.port);let n=(0,a9.A)(),i=Hn(wc(e),this.init);i.socket.addEventListener("error",()=>{let t=new uN(`Could not connect to ${e.toString()}`);this.log.error("connection error:",t),this.metrics?.dialerEvents.increment({error:!0}),n.reject(t)});try{t.onProgress?.(new nV("websockets:open-connection")),await (0,u3.W)(Promise.race([i.connected(),n.promise]),t.signal)}catch(e){throw t.signal?.aborted&&this.metrics?.dialerEvents.increment({abort:!0}),i.close().catch(e=>{this.log.error("error closing raw socket",e)}),e}return this.log("connected %s",e),this.metrics?.dialerEvents.increment({connect:!0}),i}createListener(e){return Hs({logger:this.logger,events:this.components.events,metrics:this.components.metrics},{...this.init,...e})}listenFilter(e){return(e=Array.isArray(e)?e:[e],this.init?.filter!=null)?this.init?.filter(e):Hi(e)}dialFilter(e){return this.listenFilter(e)}}function Hc(e={}){return t=>new Hl(t,e)}function Hu(e,t){let r=t.map((e,t)=>({record:C1(e),index:t}));return r.sort((e,t)=>{let r=e.record.sequence,n=t.record.sequence;if(r>n)return -1;if(r<n)return 1;if(e.record.validityType===ey.ValidityType.EOL&&t.record.validityType===ey.ValidityType.EOL){let r=C9.fromString(e.record.validity).toDate(),n=C9.fromString(t.record.validity).toDate();if(r.getTime()>n.getTime())return -1;if(r.getTime()<n.getTime())return 1}return 0}),r[0].index}let Hh="5.4.1",Hd="helia",Hf={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dnsaddr/va1.bootstrap.libp2p.io/p2p/12D3KooWKnDdG3iXw9eTFijk3EWSunZcFi54Zka4wmtqtt6rPxc8","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};function Hp(e={}){let t=`${Hd}/${Hh} ${_O()}`;return{privateKey:e.privateKey,dns:e.dns,nodeInfo:{userAgent:t},addresses:{listen:["/p2p-circuit","/webrtc"]},transports:[PU(),$2(),$1(),Hc()],connectionEncrypters:[Ca()],streamMuxers:[CU(),NE()],peerDiscovery:[Ps(Hf)],services:{autoNAT:TO(),dcutr:PK(),delegatedRouting:()=>Tg("https://delegated-ipfs.dev",Tm()),dht:O6({clientMode:!0,validators:{ipns:Tn},selectors:{ipns:Hu}}),identify:P7(),identifyPush:P9(),keychain:xc(e.keychain),ping:NP()}}}async function Hg(e){let t=e.libp2p??{};null==t.privateKey&&null!=e.datastore&&(t.privateKey=await xu(e.datastore,e.keychain));let r=Hp(t);return r.datastore=r.datastore??e.datastore,await _D({...r,...t,start:!1})}async function Hm(e={}){let t,r=e.datastore??new vJ.bk,n=e.blockstore??new vQ.ED;return t=Hy(e.libp2p)?e.libp2p:await Hg({...e,libp2p:{dns:e.dns,...e.libp2p,start:void 0},datastore:r}),{...e,libp2p:t,datastore:r,blockstore:n,blockBrokers:e.blockBrokers??[vu(),y5()],routers:e.routers??[vd(t),vW()],metrics:t.metrics,start:e.start??!0}}function Hy(e){return null!=e&&["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"].every(t=>"function"==typeof e[t])}async function Hb(e={}){let t=new dt(await Hm(e));return!1!==e.start&&await t.start(),t}var Hw=r(40662),Hv=r(59615);let HE=(...e)=>e.join("/").replace(/((?<=\/)\/+)|(^\.\/)|((?<=\/)\.\/)/g,"")||".",HA=HE,Hx=3e4,HS=async({ipfs:e,log:t,events:r,onSynced:n,start:i,timeout:s})=>{if(!e)throw Error("An instance of ipfs is required.");if(!t)throw Error("An instance of log is required.");let o=e.libp2p,a=e.libp2p.services.pubsub,l=t.id,c=HA("/orbitdb/heads/",l),u=new lf({concurrency:1}),h=new Set;r=r||new Hw.EventEmitter,s=s||Hx;let d=!1,f=async e=>{let n=await t.heads();r.emit("join",e,n)},p=e=>(async function*(){for await(let{bytes:e}of(await t.heads()))yield e})(),g=e=>async t=>{for await(let e of t){let t=e.subarray();t&&n&&await n(t)}d&&await f(e)},m=async({connection:e,stream:t})=>{let n=String(e.remotePeer);try{h.add(n),await (0,lr.F)(t,g(n),p,t)}catch(e){h.delete(n),r.emit("error",e)}},y=async e=>{let t=async()=>{let{peerId:t,subscriptions:n}=e.detail,i=String(t),a=n.find(e=>e.topic===l);if(a)if(a.subscribe){if(h.has(i))return;let e=new Hv.TimeoutController(s),{signal:n}=e;try{h.add(i);let e=await o.dialProtocol(t,c,{signal:n});await (0,lr.F)(p,e,g(i))}catch(e){h.delete(i),"UnsupportedProtocolError"===e.name||r.emit("error",e)}finally{e&&e.clear()}}else h.delete(i),r.emit("leave",i)};u.add(t)},b=async e=>{let{topic:t,data:i}=e.detail,s=async()=>{try{i&&n&&await n(i)}catch(e){r.emit("error",e)}};t===l&&u.add(s)},w=async e=>{h.delete(e.detail.toString())},v=async e=>{d&&await a.publish(l,e.bytes)},E=async()=>{d&&(d=!1,await u.onIdle(),a.removeEventListener("subscription-change",y),a.removeEventListener("message",b),await o.unhandle(c),await a.unsubscribe(l),o.removeEventListener("peer:disconnect",w),h.clear())},A=async()=>{d||(await o.handle(c,m),a.addEventListener("subscription-change",y),a.addEventListener("message",b),await a.subscribe(l),o.addEventListener("peer:disconnect",w),d=!0)};return!1!==i&&await A(),{add:v,stop:E,start:A,events:r,peers:h}};var Hk=r(52647);let H_=(e,t)=>{let r=e.time-t.time;return 0===r&&e.id!==t.id?e.id<t.id?-1:1:r},HI=e=>HC(e.id,++e.time),HC=(e,t)=>({id:e,time:t=t||0});new Uint8Array(0);let HT=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},HP=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw Error("Unknown type, must be binary type")},HR=function(e,t){if(e.length>=255)throw TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw TypeError(s+" is ambiguous");r[o]=i}var a=e.length,l=e.charAt(0),c=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[0]){for(var n=0,i=0;e[t]===l;)n++,t++;for(var s=(e.length-t)*c+1>>>0,o=new Uint8Array(s);e[t];){var u=r[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=s-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*o[d]>>>0,o[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),g=n;f!==s;)p[g++]=o[f++];return p}}}function d(e){var r=h(e);if(r)return r;throw Error(`Non-${t} character`)}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*u+1>>>0,c=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*c[f]>>>0,c[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===c[p];)p++;for(var g=l.repeat(r);p<o;++p)g+=e.charAt(c[p]);return g},decodeUnsafe:h,decode:d}};class HO{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class HN{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return HB(this,e)}}class HD{constructor(e){this.decoders=e}or(e){return HB(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let HB=(e,t)=>new HD({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class HM{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new HO(e,t,r),this.decoder=new HN(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}let HL=({name:e,prefix:t,encode:r,decode:n})=>new HM(e,t,r,n),HF=({prefix:e,name:t,alphabet:r})=>{let{encode:n,decode:i}=HR(r,t);return HL({prefix:e,name:t,encode:n,decode:e=>HP(i(e))})},HU=(e,t,r,n)=>{let i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;let o=new Uint8Array(s*r/8|0),a=0,l=0,c=0;for(let t=0;t<s;++t){let s=i[e[t]];if(void 0===s)throw SyntaxError(`Non-${n} character`);l=l<<r|s,(a+=r)>=8&&(a-=8,o[c++]=255&l>>a)}if(a>=r||255&l<<8-a)throw SyntaxError("Unexpected end of data");return o},Hj=(e,t,r)=>{let n="="===t[t.length-1],i=(1<<r)-1,s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},H$=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>HL({prefix:t,name:e,encode:e=>Hj(e,n,r),decode:t=>HU(t,n,r,e)}),HH=H$({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});H$({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),H$({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),H$({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),H$({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),H$({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),H$({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),H$({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),H$({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});let Hq=HF({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});HF({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Hz=128,HV=-128,HK=0x80000000;function HG(e,t,r){t=t||[];for(var n=r=r||0;e>=HK;)t[r++]=255&e|Hz,e/=128;for(;e&HV;)t[r++]=255&e|Hz,e>>>=7;return t[r]=0|e,HG.bytes=r-n+1,t}var HW=128,HQ=127;function HJ(e,t){var r,n=0,t=t||0,i=0,s=t,o=e.length;do{if(s>=o)throw HJ.bytes=0,RangeError("Could not decode varint");r=e[s++],n+=i<28?(r&HQ)<<i:(r&HQ)*Math.pow(2,i),i+=7}while(r>=HW);return HJ.bytes=s-t,n}var HZ=128,HY=16384,HX=2097152,H0=0x10000000,H1=0x800000000,H2=0x40000000000,H3=0x2000000000000,H4=0x100000000000000,H5=0x8000000000000000;let H6={encode:HG,decode:HJ,encodingLength:function(e){return e<HZ?1:e<HY?2:e<HX?3:e<H0?4:e<H1?5:e<H2?6:e<H3?7:e<H4?8:e<H5?9:10}},H8=(e,t=0)=>[H6.decode(e,t),H6.decode.bytes],H7=(e,t,r=0)=>(H6.encode(e,t,r),t),H9=e=>H6.encodingLength(e),qe=(e,t)=>{let r=t.byteLength,n=H9(e),i=n+H9(r),s=new Uint8Array(i+r);return H7(e,s,0),H7(r,s,n),s.set(t,i),new qn(e,r,t,s)},qt=e=>{let t=HP(e),[r,n]=H8(t),[i,s]=H8(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw Error("Incorrect length");return new qn(r,i,o,t)},qr=(e,t)=>{if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&HT(e.bytes,r.bytes)}};class qn{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}let qi=(e,t)=>{let{bytes:r,version:n}=e;return 0===n?qc(r,qo(e),t||Hq.encoder):qu(r,qo(e),t||HH.encoder)},qs=new WeakMap,qo=e=>{let t=qs.get(e);if(null==t){let t=new Map;return qs.set(e,t),t}return t};class qa{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==qh)throw Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==qd)throw Error("Cannot convert non sha2-256 multihash CID to CIDv0");return qa.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,r=qe(e,t);return qa.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return qa.equals(this,e)}static equals(e,t){let r=t;return r&&e.code===r.code&&e.version===r.version&&qr(e.multihash,r.multihash)}toString(e){return qi(this,e)}toJSON(){return{"/":qi(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;let t=e;if(t instanceof qa)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){let{version:e,code:r,multihash:n,bytes:i}=t;return new qa(e,r,n,i||qf(e,r,n.bytes))}if(!0!==t[qp])return null;{let{version:e,multihash:r,code:n}=t,i=qt(r);return qa.create(e,n,i)}}static create(e,t,r){if("number"!=typeof t)throw Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw Error("Invalid digest");switch(e){case 0:if(t===qh)return new qa(e,t,r,r.bytes);throw Error(`Version 0 CID must use dag-pb (code: ${qh}) block encoding`);case 1:{let n=qf(e,t,r.bytes);return new qa(e,t,r,n)}default:throw Error("Invalid version")}}static createV0(e){return qa.create(0,qh,e)}static createV1(e,t){return qa.create(1,e,t)}static decode(e){let[t,r]=qa.decodeFirst(e);if(r.length)throw Error("Incorrect length");return t}static decodeFirst(e){let t=qa.inspectBytes(e),r=t.size-t.multihashSize,n=HP(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw Error("Incorrect length");let i=n.subarray(t.multihashSize-t.digestSize),s=new qn(t.multihashCode,t.digestSize,i,n);return[0===t.version?qa.createV0(s):qa.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0,r=()=>{let[r,n]=H8(e.subarray(t));return t+=n,r},n=r(),i=qh;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw RangeError(`Invalid CID version ${n}`);let s=t,o=r(),a=r(),l=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:l-s,size:l}}static parse(e,t){let[r,n]=ql(e,t),i=qa.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return qo(i).set(r,e),i}}let ql=(e,t)=>{switch(e[0]){case"Q":{let r=t||Hq;return[Hq.prefix,r.decode(`${Hq.prefix}${e}`)]}case Hq.prefix:{let r=t||Hq;return[Hq.prefix,r.decode(e)]}case HH.prefix:{let r=t||HH;return[HH.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},qc=(e,t,r)=>{let{prefix:n}=r;if(n!==Hq.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let i=t.get(n);if(null!=i)return i;{let i=r.encode(e).slice(1);return t.set(n,i),i}},qu=(e,t,r)=>{let{prefix:n}=r,i=t.get(n);if(null!=i)return i;{let i=r.encode(e);return t.set(n,i),i}},qh=112,qd=18,qf=(e,t,r)=>{let n=H9(e),i=n+H9(t),s=new Uint8Array(i+r.byteLength);return H7(e,s,0),H7(t,s,n),s.set(r,i),s},qp=Symbol.for("@ipld/js-cid/CID"),qg=({name:e,code:t,encode:r})=>new qm(e,t,r);class qm{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?qe(this.code,t):t.then(e=>qe(this.code,e))}throw Error("Unknown type, must be binary type")}}function qy({enumerable:e=!0,configurable:t=!1}={}){return{enumerable:e,configurable:t,writable:!1}}function*qb(e,t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))for(let[r,n]of t.entries()){let t=[...e,r],i=qa.asCID(n);i?yield[t.join("/"),i]:"object"==typeof n&&(yield*qw(n,t))}else{let r=qa.asCID(t);r?yield[e.join("/"),r]:yield*qw(t,e)}}function*qw(e,t){if(null==e||e instanceof Uint8Array)return;let r=qa.asCID(e);for(let[n,i]of(r&&(yield[t.join("/"),r]),Object.entries(e))){let e=[...t,n];yield*qb(e,i)}}function*qv(e,t){if(Array.isArray(t))for(let[r,n]of t.entries()){let t=[...e,r];yield t.join("/"),"object"!=typeof n||qa.asCID(n)||(yield*qE(n,t))}else yield*qE(t,e)}function*qE(e,t){if(null!=e&&"object"==typeof e)for(let[r,n]of Object.entries(e)){let e=[...t,r];yield e.join("/"),null==n||n instanceof Uint8Array||"object"!=typeof n||qa.asCID(n)||(yield*qv(e,n))}}function qA(e,t){let r=e;for(let[e,n]of t.entries()){if(null==(r=r[n]))throw Error(`Object has no property at ${t.slice(0,e+1).map(e=>`[${JSON.stringify(e)}]`).join("")}`);let i=qa.asCID(r);if(i)return{value:i,remaining:t.slice(e+1).join("/")}}return{value:r}}class qx{constructor({cid:e,bytes:t,value:r}){if(!e||!t||void 0===r)throw Error("Missing required argument");this.cid=e,this.bytes=t,this.value=r,this.asBlock=this,Object.defineProperties(this,{cid:qy(),bytes:qy(),value:qy(),asBlock:qy()})}links(){return qw(this.value,[])}tree(){return qE(this.value,[])}get(e="/"){return qA(this.value,e.split("/").filter(Boolean))}}async function qS({value:e,codec:t,hasher:r}){if(void 0===e)throw Error('Missing required argument "value"');if(!t||!r)throw Error("Missing required argument: codec or hasher");let n=t.encode(e),i=await r.digest(n);return new qx({value:e,bytes:n,cid:qa.create(1,t.code,i)})}async function qk({bytes:e,codec:t,hasher:r}){if(!e)throw Error('Missing required argument "bytes"');if(!t||!r)throw Error("Missing required argument: codec or hasher");let n=t.decode(e),i=await r.digest(e);return new qx({value:n,bytes:e,cid:qa.create(1,t.code,i)})}let q_=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),qI=qg({name:"sha2-256",code:18,encode:q_("SHA-256")});qg({name:"sha2-512",code:19,encode:q_("SHA-512")});let qC=t1,qT=qI,qP=Hq,qR=e=>e&&void 0!==e.id&&void 0!==e.next&&void 0!==e.payload&&void 0!==e.v&&void 0!==e.clock&&void 0!==e.refs,qO=async e=>{let{cid:t,bytes:r}=await qS({value:e,codec:qC,hasher:qT}),n=t.toString(qP),i=HC(e.clock.id,e.clock.time);return{...e,clock:i,hash:n,bytes:r}},qN={create:async(e,t,r,n=null,i=[],s=[])=>{if(null==e)throw Error("Identity is required, cannot create entry");if(null==t)throw Error("Entry requires an id");if(null==r)throw Error("Entry requires a payload");if(null==i||!Array.isArray(i))throw Error("'next' argument is not an array");let o={id:t,payload:r,next:i,refs:s,clock:n=n||HC(e.publicKey),v:2},{bytes:a}=await qS({value:o,codec:qC,hasher:qT}),l=await e.sign(e,a);return o.key=e.publicKey,o.identity=e.hash,o.sig=l,qO(o)},verify:async(e,t)=>{if(!e)throw Error("Identities is required, cannot verify entry");if(!qR(t))throw Error("Invalid Log entry");if(!t.key)throw Error("Entry doesn't have a key");if(!t.sig)throw Error("Entry doesn't have a signature");let r={id:t.id,payload:t.payload,next:t.next,refs:t.refs,clock:t.clock,v:t.v},{bytes:n}=await qS({value:r,codec:qC,hasher:qT});return e.verify(t.sig,t.key,n)},decode:async e=>{let{cid:t,value:r}=await qk({bytes:e,codec:qC,hasher:qT}),n=t.toString(qP);return{...r,hash:n,bytes:e}},isEqual:(e,t)=>e&&t&&e.hash===t.hash},qD=async()=>{let e={},t=async(t,r)=>{e[t]=r},r=async e=>{if(e)for await(let[r,n]of e.iterator())t(r,n)};return{put:t,del:async t=>{delete e[t]},get:async t=>e[t],iterator:async function*(){for await(let[t,r]of Object.entries(e))yield[t,r]},merge:r,clear:async()=>{e={}},close:async()=>{}}},qB=qD,qM=e=>{e=new Set(e);let t={};for(let r of e)for(let e of r.next)t[e]=r.hash;let r=[];for(let n of e)t[n.hash]||r.push(n);return r},qL=async({storage:e,heads:t})=>{e=e||await qB();let r=async t=>{for(let r of t=qM(t))await e.put(r.hash,r.bytes)},n=async t=>{await e.clear(),await r(t)},i=async e=>{let t=await a();if(t.find(t=>qN.isEqual(t,e)))return;let r=qM([...t,e]);return await n(r),r},s=async e=>{let t=(await a()).filter(t=>t.hash!==e);await n(t)},o=async function*(){for await(let[,t]of e.iterator()){let e=await qN.decode(t);yield e}},a=async()=>{let e=[];for await(let t of o())e.push(t);return e},l=async()=>{await e.clear()},c=async()=>{await e.close()};return await r(t||[]),{put:r,set:n,add:i,remove:s,iterator:o,all:a,clear:l,close:c}};function qF(e,t){let r=(e,t)=>e,n=(e,t)=>qj(e,t,r);return qU(e,t,n)}function qU(e,t,r){let n=H_(e.clock,t.clock);return 0===n?r(e,t):n}function qj(e,t,r){return e.clock.id===t.clock.id?r(e,t):e.clock.id<t.clock.id?-1:1}let{LastWriteWins:q$,NoZeroes:qH}={SortByClocks:qU,SortByClockId:qj,LastWriteWins:qF,NoZeroes:function(e){let t=`Your log's tiebreaker function, ${e.name}, has returned zero and therefore cannot be`;return(r,n)=>{let i=e(r,n);if(0===i)throw Error(t);return i}}},qq=()=>new Date().getTime().toString(),qz=(e,t)=>Math.max(e,t.clock.time),qV=qD,qK=async()=>({canAppend:async e=>!0}),qG=async(e,{logId:t,logHeads:r,access:n,entryStorage:i,headsStorage:s,indexStorage:o,sortFn:a}={})=>{if(null==e)throw Error("Identity is required");if(null!=r&&!Array.isArray(r))throw Error("'logHeads' argument must be an array");let l=t||qq();n=n||await qK();let c=i||await qV(),u=o||await qV();s=s||await qV();let h=await qL({storage:s,heads:r});a=qH(a||q$);let d=new lf({concurrency:1}),f=new lf({concurrency:1}),p=async()=>{let t=Math.max(0,(await g()).reduce(qz,0));return HC(e.publicKey,t)},g=async()=>(await h.all()).sort(a).reverse(),m=async()=>{let e=[];for await(let t of E())e.unshift(t);return e},y=async e=>{let t=await c.get(e);if(t)return await qN.decode(t)},b=async e=>null!=await u.get(e),w=async(t,r={referencesCount:0})=>{let i=async()=>{let i=await g(),s=i.map(e=>e.hash),o=await S(i,r.referencesCount+i.length),a=await qN.create(e,l,t,HI(await p()),s,o);if(!await n.canAppend(a))throw Error(`Could not append entry:
Key "${e.hash}" is not allowed to write to the log`);return await h.set([a]),await c.put(a.hash,a.bytes),await u.put(a.hash,!0),a};return d.add(i)},v=async t=>{let r=async()=>{if(await b(t.hash))return!1;let r=async t=>{if(t.id!==l)throw Error(`Entry's id (${t.id}) doesn't match the log's id (${l}).`);if(!await n.canAppend(t))throw Error(`Could not append entry:
Key "${t.identity}" is not allowed to write to the log`);if(!await qN.verify(e,t))throw Error(`Could not validate signature for entry "${t.hash}"`)};await r(t);let i=(await g()).map(e=>e.hash),s=new Set([t.hash]),o=new Set([...t.next,...t.refs]),a=new Set,d=async()=>{let e=Array.from(o.values()).filter(b).map(y);for(let t of(await Promise.all(e)))for(let e of(o.delete(t.hash),await r(t),s.add(t.hash),[...t.next,...t.refs]))await b(e)||s.has(e)?i.includes(e)&&a.add(e):o.add(e);o.size>0&&await d()};for(let e of(await d(),s.values()))await u.put(e,!0);for(let e of a.values())await h.remove(e);return await c.put(t.hash,t.bytes),await h.add(t),!0};return f.add(r)},E=async function*(e,t){let r,n=()=>!1;t=t||n;let i=(e=e||await g()).sort(a),s={},o=[],l={},c=e=>!(s[e]||l[e]);for(;i.length>0;)if(r=(i=i.sort(a)).pop()){let{hash:e,next:n}=r;if(!s[e]){if(yield r,!0===await t(r))break;s[e]=!0,l[e]=!0,o=[...o,...n].filter(c);let a=e=>{if(!s[e]&&!l[e])return l[e]=!0,y(e)},u=await Promise.all(o.map(a));o=u.filter(e=>null!=e).reduce((e,t)=>Array.from(new Set([...e,...t.next])),[]).filter(c),i=[...u,...i]}}},A=async function*({amount:e=-1,gt:t,gte:r,lt:n,lte:i}={}){if(0===e)return;if("string"==typeof i&&(i=[await y(i)]),"string"==typeof n){let e=await y(n);n=await Promise.all(e.next.map(e=>y(e)))}if(null!=n&&!Array.isArray(n))throw Error("lt must be a string or an array of Entries");if(null!=i&&!Array.isArray(i))throw Error("lte must be a string or an array of Entries");let s=(n||i||await g()).filter(e=>null!=e),o=t||r?await y(t||r):null,a=o||-1===e?-1:e,l=0,c=async e=>(l++,!!e&&!!(l>=a&&-1!==a||o&&qN.isEqual(e,o))),u=o&&-1!==e&&!n&&!i,h=u?new Hk(e+2):null,d=0;for await(let e of E(s,c)){let r=n&&qN.isEqual(e,s),i=t&&qN.isEqual(e,o);r||i||(u?h.set(d++,e.hash):yield e)}if(u){let t=h.keys.length,r=t>e?t-e:0;for(let e of h.keys.slice(r,t)){let t=h.get(e),r=await y(t);yield r}}},x=e=>e&&void 0!==e.id&&void 0!==e.clock&&void 0!==e.heads&&void 0!==e.values&&void 0!==e.access&&void 0!==e.identity&&void 0!==e.storage,S=async(e,t=0)=>{let r=[];for await(let{hash:n}of E(e,async e=>r.length>=t&&-1!==t))r.push(n);return r=r.slice(e.length+1,t)};return{id:l,clock:p,heads:g,values:m,all:m,get:y,has:b,append:w,join:async e=>{if(!e)throw Error("Log instance not defined");if(!x(e))throw Error("Given argument is not an instance of Log");for(let t of(c.merge&&await c.merge(e.storage),await e.heads()))await v(t)},joinEntry:v,traverse:E,iterator:A,clear:async()=>{await u.clear(),await h.clear(),await c.clear()},close:async()=>{await u.close(),await h.close(),await c.close()},access:n,identity:e,storage:c}},qW=async(e,t)=>({put:async(r,n)=>{await e.put(r,n),await t.put(r,n)},get:async r=>{let n=await e.get(r);return!n&&(n=await t.get(r))&&await e.put(r,n),n},del:async r=>{await e.del(r),await t.del(r)},iterator:async function*({amount:r,reverse:n}={}){let i=[],s={amount:r||-1,reverse:n||!1};for(let r of[e,t])for await(let[e,t]of r.iterator(s))i[e]||(i[e]=!0,yield[e,t])},merge:async r=>{await e.merge(r),await t.merge(r),await r.merge(e),await r.merge(t)},clear:async()=>{await e.clear(),await t.clear()},close:async()=>{await e.close(),await t.close()}}),qQ=3e4,qJ=async({ipfs:e,pin:t,timeout:r}={})=>{if(!e)throw Error("An instance of ipfs is required.");return{put:async(n,i)=>{let s=qa.parse(n,Hq),{signal:o}=new Hv.TimeoutController(r||qQ);await e.blockstore.put(s,i,{signal:o}),t&&!await e.pins.isPinned(s)&&await (0,ux.A)(e.pins.add(s))},del:async e=>{},get:async t=>{let n=qa.parse(t,Hq),{signal:i}=new Hv.TimeoutController(r||qQ),s=await e.blockstore.get(n,{signal:i});if(s)return s},iterator:async function*(){},merge:async e=>{},clear:async()=>{},close:async()=>{}}};var qZ=r(59372);let qY="./level",qX="view",q0=async({path:e,valueEncoding:t}={})=>{e=e||qY,t=t||qX;let r=new qZ.Level(e,{valueEncoding:t,passive:!0});return await r.open(),{put:async(e,t)=>{await r.put(e,t)},del:async e=>{await r.del(e)},get:async e=>{try{let t=await r.get(e);if(t)return t}catch(e){}},iterator:async function*({amount:e,reverse:t}={}){let n={limit:e||-1,reverse:t||!1};for await(let[e,t]of r.iterator(n))yield[e,t]},merge:async e=>{},clear:async()=>{await r.clear()},close:async()=>{await r.close()}}},q1=1e6,q2=async({size:e}={})=>{let t=new Hk(e||q1);return{put:async(e,r)=>{t.set(e,r)},del:async e=>{t.remove(e)},get:async e=>t.get(e),iterator:async function*(){for await(let e of t.keys){let r=t.get(e);yield[e,r]}},merge:async e=>{if(e)for await(let[r,n]of e.iterator())t.set(r,n)},clear:async()=>{t=new Hk(e||q1)},close:async()=>{}}},q3=16,q4=1e3,q5=async({ipfs:e,identity:t,address:r,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:l,indexStorage:c,referencesCount:u,syncAutomatically:h,onUpdate:d})=>{s=HA(s||"./orbitdb",`./${r}/`),o=o||{},u=Number(u)>-1?u:q3,l=l||await qW(await q2({size:q4}),await qJ({ipfs:e,pin:!0})),a=a||await qW(await q2({size:q4}),await q0({path:HA(s,"/log/_heads/")})),c=c||await qW(await q2({size:q4}),await q0({path:HA(s,"/log/_index/")}));let f=await qG(t,{logId:r,access:i,entryStorage:l,headsStorage:a,indexStorage:c}),p=new Hw.EventEmitter,g=new lf({concurrency:1}),m=async e=>{let t=async()=>{let t=await f.append(e,{referencesCount:u});return await v.add(t),d&&await d(f,t),p.emit("update",t),t.hash},r=await g.add(t);return await g.onIdle(),r},y=async e=>{let t=async()=>{let t=await qN.decode(e);t&&await f.joinEntry(t)&&(d&&await d(f,t),p.emit("update",t))};await g.add(t)},b=async()=>{await v.stop(),await g.onIdle(),await f.close(),i&&i.close&&await i.close(),p.emit("close")},w=async()=>{await g.onIdle(),await f.clear(),i&&i.drop&&await i.drop(),p.emit("drop")},v=await HS({ipfs:e,log:f,events:p,onSynced:y,start:h});return{address:r,name:n,identity:t,meta:o,close:b,drop:w,addOperation:m,log:f,sync:v,peers:v.peers,events:p,access:i}},q6="documents",q8={indexBy:"_id"},q7=({indexBy:e}=q8)=>async({ipfs:t,identity:r,address:n,name:i,access:s,directory:o,meta:a,headsStorage:l,entryStorage:c,indexStorage:u,referencesCount:h,syncAutomatically:d,onUpdate:f})=>{let p=await q5({ipfs:t,identity:r,address:n,name:i,access:s,directory:o,meta:a,headsStorage:l,entryStorage:c,indexStorage:u,referencesCount:h,syncAutomatically:d}),{addOperation:g,log:m}=p,y=async t=>{let r=t[e];if(!r)throw Error(`The provided document doesn't contain field '${e}'`);return g({op:"PUT",key:r,value:t})},b=async e=>{if(!await w(e))throw Error(`No document with key '${e}' in the database`);return g({op:"DEL",key:e,value:null})},w=async e=>{for await(let t of E())if(e===t.key)return t},v=async e=>{let t=[];for await(let r of E())e(r.value)&&t.push(r.value);return t},E=async function*({amount:e}={}){let t={},r=0;for await(let n of m.iterator()){let{op:i,key:s,value:o}=n.payload;if("PUT"!==i||t[s])"DEL"!==i||t[s]||(t[s]=!0);else{t[s]=!0,r++;let e=n.hash;yield{hash:e,key:s,value:o}}if(r>=e)break}},A=async()=>{let e=[];for await(let t of E())e.unshift(t);return e};return{...p,type:q6,put:y,del:b,get:w,iterator:E,query:v,indexBy:e,all:A}};q7.type=q6;let q9=q7,ze="events",zt=()=>async({ipfs:e,identity:t,address:r,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:l,indexStorage:c,referencesCount:u,syncAutomatically:h,onUpdate:d})=>{let f=await q5({ipfs:e,identity:t,address:r,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:l,indexStorage:c,referencesCount:u,syncAutomatically:h,onUpdate:d}),{addOperation:p,log:g}=f,m=async e=>p({op:"ADD",key:null,value:e}),y=async e=>(await g.get(e)).payload.value,b=async function*({gt:e,gte:t,lt:r,lte:n,amount:i}={}){for await(let s of g.iterator({gt:e,gte:t,lt:r,lte:n,amount:i})){let e=s.hash,t=s.payload.value;yield{hash:e,value:t}}},w=async()=>{let e=[];for await(let t of b())e.unshift(t);return e};return{...f,type:ze,add:m,get:y,iterator:b,all:w}};zt.type=ze;let zr=zt,zn="keyvalue",zi=()=>async({ipfs:e,identity:t,address:r,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:l,indexStorage:c,referencesCount:u,syncAutomatically:h,onUpdate:d})=>{let f=await q5({ipfs:e,identity:t,address:r,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:l,indexStorage:c,referencesCount:u,syncAutomatically:h,onUpdate:d}),{addOperation:p,log:g}=f,m=async(e,t)=>p({op:"PUT",key:e,value:t}),y=async e=>p({op:"DEL",key:e,value:null}),b=async e=>{for await(let t of g.traverse()){let{op:r,key:n,value:i}=t.payload;if("PUT"===r&&n===e)return i;if("DEL"===r&&n===e)return}},w=async function*({amount:e}={}){let t={},r=0;for await(let n of g.traverse()){let{op:i,key:s,value:o}=n.payload;if("PUT"!==i||t[s])"DEL"!==i||t[s]||(t[s]=!0);else{t[s]=!0,r++;let e=n.hash;yield{key:s,value:o,hash:e}}if(r>=e)break}},v=async()=>{let e=[];for await(let t of w())e.unshift(t);return e};return{...f,type:zn,put:m,set:m,del:y,get:b,iterator:w,all:v}};zi.type=zn;let zs=zi,zo="json",za=({directory:e}={})=>async()=>{let t=await q0({path:e,valueEncoding:zo}),r=await q0({path:HA(e,"/_indexedEntries/"),valueEncoding:zo}),n=async(e,n)=>{let i=new Set,s=new Set,o=n.hash,a=async e=>await r.get(e)===!0,l=async e=>!await a(e),c=async e=>{for await(let t of e.next)await l(t)&&s.add(t);return await a(o)&&0===s.size};for await(let n of e.traverse(null,c)){let{hash:e,payload:o}=n;if(await l(e)){let{op:a,key:l}=o;"PUT"!==a||i.has(l)?"DEL"!==a||i.has(l)||(i.add(l),await t.del(l),await r.put(e,!0)):(i.add(l),await t.put(l,n),await r.put(e,!0)),s.delete(e)}}},i=async()=>{await t.close(),await r.close()},s=async()=>{await t.clear(),await r.clear()};return{get:t.get,iterator:t.iterator,update:n,close:i,drop:s}},zl={},zc=e=>{if(!e.type)throw Error("Database type does not contain required field 'type'.");zl[e.type]=e},zu=e=>{if(!e)throw Error("Type not specified");if(!zl[e])throw Error(`Unsupported database type: '${e}'`);return zl[e]};function zh(e,t){for(let r=0;r<e.byteLength;r++){if(e[r]<t[r])return -1;if(e[r]>t[r])return 1}return e.byteLength>t.byteLength?1:e.byteLength<t.byteLength?-1:0}zc(zr),zc(q9),zc(zs);let zd=async(e,t,r)=>{if(!e)throw Error("No signature given");if(!t)throw Error("Given publicKey was undefined");if(!r)throw Error("Given input data was undefined");r instanceof Uint8Array||(r="string"==typeof r?(0,nm.s)(r):new Uint8Array(r));let n=(e,t,r)=>e.verify(t,r),i=!1;try{let s=yl((0,nm.s)(t,"base16"));i=await n(s,r,(0,nm.s)(e,"base16"))}catch(e){}return Promise.resolve(i)},zf=async(e,t)=>{if(!e)throw Error("No signing key given");if(!t)throw Error("Given input data was undefined");return t instanceof Uint8Array||(t="string"==typeof t?(0,nm.s)(t):new Uint8Array(t)),(0,uh.d)(await e.sign(t),"base16")},zp=q2({size:1e3}),zg=async(e,t,r)=>{let n=await zp,i=await n.get(e),s=!1;if(i){let e=(e,t)=>t instanceof Uint8Array?0===zh(e,t):e.toString()===t.toString();s=i.publicKey===t&&e(i.data,r)}else{let i=await zd(e,t,r);s=i,i&&await n.put(e,{publicKey:t,data:r})}return s},zm="./keystore",zy=async({storage:e,path:t}={})=>{e=e||await qW(await q2({size:1e3}),await q0({path:t||zm}));let r=await q2({size:1e3}),n=async(t,n)=>{let{privateKey:i}=n;await e.put("private_"+t,i);let s=yd(i);await r.put(t,s)},i=async e=>{if(!e)throw Error("id needed to create a key");let t=await yo("secp256k1"),r={publicKey:t.publicKey.raw,privateKey:t.raw};return await n(e,r),t};return{clear:async()=>{await e.clear(),await r.clear()},close:async()=>{await e.close(),await r.close()},hasKey:async t=>{if(!t)throw Error("id needed to check a key");let n=!1,i=await r.get(t);if(i)n=!0;else try{n=null!=(i=await e.get("private_"+t))}catch(e){console.error("Error: ENOENT: no such file or directory")}return n},addKey:n,createKey:i,getKey:async t=>{if(!t)throw Error("id needed to get a key");let n=await r.get(t);if(!n){let i;try{i=await e.get("private_"+t)}catch(e){}if(!i)return;n=yd(i),await r.put(t,n)}return n},getPublic:(e,t={})=>{let r=["hex","buffer"],n=t.format||"hex";if(-1===r.indexOf(n))throw Error("Supported formats are `hex` and `buffer`");let i=e.publicKey.raw;return"buffer"===n?i:(0,uh.d)(i,"base16")}}},zb=t1,zw=qI,zv=Hq,zE=async({id:e,publicKey:t,signatures:r,type:n,sign:i,verify:s}={})=>{if(!e)throw Error("Identity id is required");if(!t)throw Error("Invalid public key");if(!r)throw Error("Signatures object is required");if(!r.id)throw Error("Signature of id is required");if(!r.publicKey)throw Error("Signature of publicKey+id is required");if(!n)throw Error("Identity type is required");let o={id:e,publicKey:t,signatures:r=Object.assign({},r),type:n,sign:i,verify:s},{hash:a,bytes:l}=await zA(o);return o.hash=a,o.bytes=l,o},zA=async e=>{let{id:t,publicKey:r,signatures:n,type:i}=e,s={id:t,publicKey:r,signatures:n,type:i},{cid:o,bytes:a}=await qS({value:s,codec:zb,hasher:zw});return{hash:o.toString(zv),bytes:Uint8Array.from(a)}},zx=async e=>{let{value:t}=await qk({bytes:e,codec:zb,hasher:zw});return zE({...t})},zS=e=>!!(e.id&&e.hash&&e.bytes&&e.publicKey&&e.signatures&&e.signatures.id&&e.signatures.publicKey&&e.type),zk=(e,t)=>e.id===t.id&&e.hash===t.hash&&e.type===t.type&&e.publicKey===t.publicKey&&e.signatures.id===t.signatures.id&&e.signatures.publicKey===t.signatures.publicKey,z_="publickey",zI=({keystore:e})=>async()=>{if(!e)throw Error("PublicKeyIdentityProvider requires a keystore parameter");return{type:z_,getId:async({id:t}={})=>{if(!t)throw Error("id is required");let r=await e.getKey(t)||await e.createKey(t);return(0,uh.d)(r.publicKey.raw,"base16")},signIdentity:async(t,{id:r}={})=>{if(!r)throw Error("id is required");let n=await e.getKey(r);if(!n)throw Error(`Signing key for '${r}' not found`);return zf(n,t)}}};zI.verifyIdentity=async e=>{let{id:t,publicKey:r,signatures:n}=e;return zg(n.publicKey,t,r+n.id)},zI.type=z_;let zC={},zT=e=>Object.keys(zC).includes(e),zP=e=>{if(!zT(e))throw Error(`IdentityProvider type '${e}' is not supported`);return zC[e]};(e=>{if(!e.type||"string"!=typeof e.type)throw Error("Given IdentityProvider doesn't have a field 'type'.");if(!e.verifyIdentity)throw Error("Given IdentityProvider doesn't have a function 'verifyIdentity'.");zC[e.type]=e})(zI);let zR=HA("./orbitdb","identities"),zO=async({keystore:e,path:t,storage:r,ipfs:n}={})=>{e=e||await zy({path:t||zR}),r||(r=n?await qW(await q2({size:1e3}),await qJ({ipfs:n,pin:!0})):await qD());let i=await q2({size:1e3}),s=async(t,r)=>{let n=await e.getKey(t.id);if(!n)throw Error("Private signing key not found from KeyStore");return await zf(n,r)},o=async(e,t,r)=>await zg(e,t,r);return{createIdentity:async(t={})=>{t.keystore=e;let n=zP("publickey"),i=t.provider||n({keystore:e}),a=await i();if(!zP(a.type))throw Error("Identity provider is unknown. Use useIdentityProvider(provider) to register the identity provider");let l=await a.getId(t),c=await e.getKey(l)||await e.createKey(l),u=e.getPublic(c),h=await zf(c,l),d=await a.signIdentity(u+h,t),f={id:h,publicKey:d},p=await zE({id:l,publicKey:u,signatures:f,type:a.type,sign:s,verify:o});return await r.put(p.hash,p.bytes),p},verifyIdentity:async e=>{if(!zS(e))return!1;let{id:t,publicKey:r,signatures:n}=e;if(!await o(n.id,r,t))return!1;let s=await i.get(n.id);if(s)return zk(e,s);let a=zP(e.type),l=await a.verifyIdentity(e);return l&&await i.put(n.id,e),l},getIdentity:async e=>{let t=await r.get(e);if(t)return zx(t)},sign:s,verify:o,keystore:e}},zN=e=>{let t;if(!(e=e.toString()).startsWith("/orbitdb")&&!e.startsWith("\\orbitdb"))return!1;e=(e=(e=(e=e.replaceAll("/orbitdb/","")).replaceAll("\\orbitdb\\","")).replaceAll("/","")).replaceAll("\\","");try{t=qa.parse(e,Hq)}catch(e){return!1}return void 0!==t},zD=e=>{if(e&&"orbitdb"===e.protocol&&e.hash)return e;let t="orbitdb",r=e.replace("/orbitdb/","").replace("\\orbitdb\\",""),n=()=>HE("/",t,r);return{protocol:t,hash:r,address:e,toString:n}},zB=t1,zM=qI,zL=Hq,zF=async({ipfs:e,storage:t}={})=>(t=t||await qW(await q2({size:1e5}),await qJ({ipfs:e,pin:!0})),{get:async e=>{let r=await t.get(e),{value:n}=await qk({bytes:r,codec:zB,hasher:zM});return n&&await t.put(e,r),n},create:async({name:e,type:r,accessController:n,meta:i})=>{if(!e)throw Error("name is required");if(!r)throw Error("type is required");if(!n)throw Error("accessController is required");let s=Object.assign({name:e,type:r,accessController:n},void 0!==i?{meta:i}:{}),{cid:o,bytes:a}=await qS({value:s,codec:zB,hasher:zM}),l=o.toString(zL);return await t.put(l,a),{hash:l,manifest:s}},close:async()=>{await t.close()}}),zU=async(e=32)=>{let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="",n=0;for(;n<e;)r+=t.charAt(Math.floor(Math.random()*t.length)),n+=1;return r},zj=t1,z$=qI,zH=Hq,zq=async({storage:e,type:t,params:r})=>{let n={type:t,...r},{cid:i,bytes:s}=await qS({value:n,codec:zj,hasher:z$}),o=i.toString(zH);return await e.put(o,s),o},zz="ipfs",zV=({write:e,storage:t}={})=>async({orbitdb:r,identities:n,address:i})=>{if(t=t||await qW(await q2({size:1e3}),await qJ({ipfs:r.ipfs,pin:!0})),e=e||[r.identity.id],i){let r=await t.get(i.replaceAll("/ipfs/","")),{value:n}=await qk({bytes:r,codec:zj,hasher:z$});e=n.write}else i=await zq({storage:t,type:zz,params:{write:e}}),i=HA("/",zz,i);let s=async t=>{let r=await n.getIdentity(t.identity);if(!r)return!1;let{id:i}=r;return!!(e.includes(i)||e.includes("*"))&&await n.verifyIdentity(r)};return{type:zz,address:i,write:e,canAppend:s}};zV.type=zz;let zK=zV,zG="orbitdb",zW=({write:e}={})=>async({orbitdb:t,identities:r,address:n,name:i})=>{n=n||i||await zU(64),e=e||[t.identity.id];let s=await t.open(n,{type:"keyvalue",AccessController:zK({write:e})});n=s.address;let o=async()=>{let e=[];for await(let t of s.iterator())e[t.key]=t.value;let t=t=>{let r=t[0];e[r]=new Set([...e[r]||[],...t[1]])};return Object.entries({...e,...{admin:new Set([...e.admin||[],...s.access.write])}}).forEach(t),e},a=async e=>(await o())[e]||new Set([]),l=async(e,t)=>{let r=new Set(await a(e));return r.has(t)||r.has("*")};return{type:zG,address:n,write:e,canAppend:async e=>{let t=await r.getIdentity(e.identity);if(!t)return!1;let{id:n}=t;return!!(await l("write",n)||await l("admin",n))&&await r.verifyIdentity(t)},capabilities:o,get:a,grant:async(e,t)=>{let r=new Set([...await s.get(e)||[],t]);await s.put(e,Array.from(r.values()))},revoke:async(e,t)=>{let r=new Set(await s.get(e)||[]);r.delete(t),r.size>0?await s.put(e,Array.from(r.values())):await s.del(e)},close:async()=>{await s.close()},drop:async()=>{await s.drop()},events:s.events}};zW.type=zG;let zQ=zW,zJ={},zZ=e=>{if(!zJ[e])throw Error(`AccessController type '${e}' is not supported`);return zJ[e]},zY=e=>{if(!e.type)throw Error("AccessController does not contain required field 'type'.");zJ[e.type]=e};zY(zK),zY(zQ);let zX="events",z0=zK,z1=async({ipfs:e,id:t,identity:r,identities:n,directory:i}={})=>{let s;if(null==e)throw Error("IPFS instance is a required argument.");t=t||await zU();let o=e.libp2p.peerId;i=i||"./orbitdb",n?s=n.keystore:(s=await zy({path:HA(i,"./keystore")}),n=await zO({ipfs:e,keystore:s})),r?r.provider&&(r=await n.createIdentity({...r})):r=await n.createIdentity({id:t});let a=await zF({ipfs:e}),l={},c=async(t,{type:s,meta:o,sync:h,Database:d,AccessController:f,headsStorage:p,entryStorage:g,indexStorage:m,referencesCount:y}={})=>{let b,w,v;if(l[t])return l[t];if(zN(t)){let i=zD(t);f=zZ((w=await a.get(i.hash)).accessController.split("/",2).pop())(),v=await f({orbitdb:{open:c,identity:r,ipfs:e},identities:n,address:w.accessController}),b=w.name,s=s||w.type,o=w.meta}else{s=s||zX,f=f||z0(),v=await f({orbitdb:{open:c,identity:r,ipfs:e},identities:n,name:t});let i=await a.create({name:t,type:s,accessController:v.address,meta:o});if(w=i.manifest,t=zD(i.hash),b=w.name,o=w.meta,l[t])return l[t]}if(!(d=d||zu(s)()))throw Error(`Unsupported database type: '${s}'`);t=t.toString();let E=await d({ipfs:e,identity:r,address:t,name:b,access:v,directory:i,meta:o,syncAutomatically:h,headsStorage:p,entryStorage:g,indexStorage:m,referencesCount:y});return E.events.on("close",u(t)),l[t]=E,E},u=e=>()=>{delete l[e]};return{id:t,open:c,stop:async()=>{for(let e of Object.values(l))await e.close();s&&await s.close(),a&&await a.close(),l={}},ipfs:e,directory:i,keystore:s,identities:n,identity:r,peerId:o}};class z2{constructor(){throw Error("TCP connections are not possible in browsers")}[xh]=!0;[Symbol.toStringTag]="@libp2p/tcp";[En]=["@libp2p/transport"];async dial(){throw Error("TCP connections are not possible in browsers")}createListener(){throw Error("TCP connections are not possible in browsers")}listenFilter(){return[]}dialFilter(){return[]}}function z3(e={}){return t=>new z2(t,e)}class z4{portMappingClient;constructor(){throw Error("UPnPNAT is not supported in browsers")}[Symbol.toStringTag]="@libp2p/upnp-nat";[En]=["@libp2p/nat-traversal"];get[Ei](){return[]}}function z5(e={}){return t=>new z4(t,e)}!function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.publicKey&&e.publicKey.byteLength>0&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.addrs)for(let r of e.addrs)t.uint32(18),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={publicKey:(0,t9.c)(0),addrs:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.publicKey=e.bytes();break;case 2:if(r.limits?.addrs!=null&&n.addrs.length===r.limits.addrs)throw new nL('Decode error - map field "addrs" had too many elements');n.addrs.push(e.bytes());break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(tM||(tM={}));let z6="_peer-discovery._p2p._pubsub";class z8 extends uS{[xb]=!0;[Symbol.toStringTag]="@libp2p/pubsub-peer-discovery";interval;listenOnly;topics;intervalId;components;log;constructor(e,t={}){super();let{interval:r,topics:n,listenOnly:i}=t;this.components=e,this.interval=r??1e4,this.listenOnly=i??!1,this.log=e.logger.forComponent("libp2p:discovery:pubsub"),Array.isArray(n)&&n.length>0?this.topics=n:this.topics=[z6],this._onMessage=this._onMessage.bind(this)}isStarted(){return null!=this.intervalId}start(){}afterStart(){if(null!=this.intervalId)return;let e=this.components.pubsub;if(null==e)throw Error("PubSub not configured");for(let t of this.topics)e.subscribe(t),e.addEventListener("message",this._onMessage);this.listenOnly||(this._broadcast(),this.intervalId=setInterval(()=>{this._broadcast()},this.interval))}beforeStop(){let e=this.components.pubsub;if(null==e)throw Error("PubSub not configured");for(let t of this.topics)e.unsubscribe(t),e.removeEventListener("message",this._onMessage)}stop(){null!=this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0)}_broadcast(){let e=this.components.peerId;if(null==e.publicKey)throw Error("PeerId was missing public key");let t={publicKey:yu(e.publicKey),addrs:this.components.addressManager.getAddresses().map(e=>e.bytes)},r=tM.encode(t),n=this.components.pubsub;if(null==n)throw Error("PubSub not configured");for(let e of this.topics){if(0===n.getSubscribers(e).length){this.log("skipping broadcasting our peer data on topic %s because there are no peers present",e);continue}this.log("broadcasting our peer data on topic %s",e),n.publish(e,r)}}_onMessage(e){if(!this.isStarted())return;let t=e.detail;if(this.topics.includes(t.topic))try{let e=tM.decode(t.data),r=ya(e.publicKey),n=yP(r);if(n.equals(this.components.peerId))return;this.log("discovered peer %p on %s",n,t.topic),this.safeDispatchEvent("peer",{detail:{id:n,multiaddrs:e.addrs.map(e=>wt(e))}})}catch(e){this.log.error("error handling incoming message",e)}}}function z7(e={}){return t=>new z8(t,e)}let z9="StrictSign",Ve="StrictNoSign";function Vt(e){return null!=e[Symbol.asyncIterator]}!function(e){e.Accept="accept",e.Ignore="ignore",e.Reject="reject"}(tL||(tL={})),Symbol.for("@libp2p/pubsub");let Vr=e=>{let t=rY(e),r=(0,t9.K)(t);return r3(e,r),Vr.bytes=t,r};function Vn(e,t){let r=(t=t??{}).lengthEncoder??Vr;function*n(e){let t=r(e.byteLength);t instanceof Uint8Array?yield t:yield*t,e instanceof Uint8Array?yield e:yield*e}return Vt(e)?async function*(){for await(let t of e)yield*n(t)}():function*(){for(let t of e)yield*n(t)}()}Vr.bytes=0,Vn.single=(e,t)=>new ro(((t=t??{}).lengthEncoder??Vr)(e.byteLength),e);class Vi extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class Vs extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class Vo extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}class Va extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}let Vl=8,Vc=4194304;!function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(tF||(tF={}));let Vu=e=>{let t=r4(e);return Vu.bytes=rY(t),t};function Vh(e,t){let r=new ro,n=tF.LENGTH,i=-1,s=t?.lengthDecoder??Vu,o=t?.maxLengthLength??Vl,a=t?.maxDataLength??Vc;function*l(){for(;r.byteLength>0;){if(n===tF.LENGTH)try{if((i=s(r))<0)throw new Vi("Invalid message length");if(i>a)throw new Vs("Message length too long");let e=s.bytes;r.consume(e),t?.onLength!=null&&t.onLength(i),n=tF.DATA}catch(e){if(e instanceof RangeError){if(r.byteLength>o)throw new Vo("Message length length too long");break}throw e}if(n===tF.DATA){if(r.byteLength<i)break;let e=r.sublist(0,i);r.consume(i),t?.onData!=null&&t.onData(e),yield e,n=tF.LENGTH}}}return Vt(e)?async function*(){for await(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new Va("Unexpected end of input")}():function*(){for(let t of e)r.append(t),yield*l();if(r.byteLength>0)throw new Va("Unexpected end of input")}()}Vu.bytes=0,Vh.fromReader=(e,t)=>{let r=1,n=async function*(){for(;;)try{let{done:t,value:n}=await e.next(r);if(!0===t)return;null!=n&&(yield n)}catch(e){if("ERR_UNDER_READ"===e.code)return{done:!0,value:null};throw e}finally{r=1}}(),i=e=>{r=e};return Vh(n,{...t??{},onLength:i})};let Vd="/floodsub/1.0.0",Vf="/meshsub/1.0.0",Vp="/meshsub/1.1.0",Vg="/meshsub/1.2.0",Vm=6,Vy=4,Vb=12,Vw=4,Vv=2,VE=5,VA=3,Vx=6,VS=.25,Vk=3,V_=100,VI=1e3,VC=6e4,VT=16,VP=6e4,VR=1e4,VO=15,VN=300,VD=1e3,VB=60,VM=2,VL=1e4,VF=5e3,VU=10,Vj=3e3,V$=12e4,VH=12e4,Vq="ERR_TOPIC_VALIDATOR_REJECT",Vz="ERR_TOPIC_VALIDATOR_IGNORE",VV=0,VK=128,VG=1e3,VW=1e3,VQ=1,VJ=512,VZ=512,VY={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxIdontwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};!function(e){let t,r,n,i,s,o,a,l,c,u;!function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.subscribe&&(t.uint32(8),t.bool(e.subscribe)),null!=e.topic&&(t.uint32(18),t.string(e.topic)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.subscribe=e.bool();break;case 2:n.topic=e.string();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(t=e.SubOpts||(e.SubOpts={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.from&&(t.uint32(10),t.bytes(e.from)),null!=e.data&&(t.uint32(18),t.bytes(e.data)),null!=e.seqno&&(t.uint32(26),t.bytes(e.seqno)),null!=e.topic&&""!==e.topic&&(t.uint32(34),t.string(e.topic)),null!=e.signature&&(t.uint32(42),t.bytes(e.signature)),null!=e.key&&(t.uint32(50),t.bytes(e.key)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={topic:""},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.from=e.bytes();break;case 2:n.data=e.bytes();break;case 3:n.seqno=e.bytes();break;case 4:n.topic=e.string();break;case 5:n.signature=e.bytes();break;case 6:n.key=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(r=e.Message||(e.Message={})),function(t){let r;t.codec=()=>(null==r&&(r=nM((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.ihave)for(let n of t.ihave)r.uint32(10),e.ControlIHave.codec().encode(n,r);if(null!=t.iwant)for(let n of t.iwant)r.uint32(18),e.ControlIWant.codec().encode(n,r);if(null!=t.graft)for(let n of t.graft)r.uint32(26),e.ControlGraft.codec().encode(n,r);if(null!=t.prune)for(let n of t.prune)r.uint32(34),e.ControlPrune.codec().encode(n,r);if(null!=t.idontwant)for(let n of t.idontwant)r.uint32(42),e.ControlIDontWant.codec().encode(n,r);!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={ihave:[],iwant:[],graft:[],prune:[],idontwant:[]},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:if(n.limits?.ihave!=null&&i.ihave.length===n.limits.ihave)throw new nL('Decode error - map field "ihave" had too many elements');i.ihave.push(e.ControlIHave.codec().decode(t,t.uint32(),{limits:n.limits?.ihave$}));break;case 2:if(n.limits?.iwant!=null&&i.iwant.length===n.limits.iwant)throw new nL('Decode error - map field "iwant" had too many elements');i.iwant.push(e.ControlIWant.codec().decode(t,t.uint32(),{limits:n.limits?.iwant$}));break;case 3:if(n.limits?.graft!=null&&i.graft.length===n.limits.graft)throw new nL('Decode error - map field "graft" had too many elements');i.graft.push(e.ControlGraft.codec().decode(t,t.uint32(),{limits:n.limits?.graft$}));break;case 4:if(n.limits?.prune!=null&&i.prune.length===n.limits.prune)throw new nL('Decode error - map field "prune" had too many elements');i.prune.push(e.ControlPrune.codec().decode(t,t.uint32(),{limits:n.limits?.prune$}));break;case 5:if(n.limits?.idontwant!=null&&i.idontwant.length===n.limits.idontwant)throw new nL('Decode error - map field "idontwant" had too many elements');i.idontwant.push(e.ControlIDontWant.codec().decode(t,t.uint32(),{limits:n.limits?.idontwant$}));break;default:t.skipType(7&r)}}return i})),r),t.encode=e=>nN(e,t.codec()),t.decode=(e,r)=>ng(e,t.codec(),r)}(n=e.ControlMessage||(e.ControlMessage={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.topicID&&(t.uint32(10),t.string(e.topicID)),null!=e.messageIDs)for(let r of e.messageIDs)t.uint32(18),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={messageIDs:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.topicID=e.string();break;case 2:if(r.limits?.messageIDs!=null&&n.messageIDs.length===r.limits.messageIDs)throw new nL('Decode error - map field "messageIDs" had too many elements');n.messageIDs.push(e.bytes());break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(i=e.ControlIHave||(e.ControlIHave={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.messageIDs)for(let r of e.messageIDs)t.uint32(10),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={messageIDs:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();if(t>>>3==1){if(r.limits?.messageIDs!=null&&n.messageIDs.length===r.limits.messageIDs)throw new nL('Decode error - map field "messageIDs" had too many elements');n.messageIDs.push(e.bytes())}else e.skipType(7&t)}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(s=e.ControlIWant||(e.ControlIWant={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.topicID&&(t.uint32(10),t.string(e.topicID)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();t>>>3==1?n.topicID=e.string():e.skipType(7&t)}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(o=e.ControlGraft||(e.ControlGraft={})),function(t){let r;t.codec=()=>(null==r&&(r=nM((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.topicID&&(r.uint32(10),r.string(t.topicID)),null!=t.peers)for(let n of t.peers)r.uint32(18),e.PeerInfo.codec().encode(n,r);null!=t.backoff&&(r.uint32(24),r.uint64Number(t.backoff)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={peers:[]},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:i.topicID=t.string();break;case 2:if(n.limits?.peers!=null&&i.peers.length===n.limits.peers)throw new nL('Decode error - map field "peers" had too many elements');i.peers.push(e.PeerInfo.codec().decode(t,t.uint32(),{limits:n.limits?.peers$}));break;case 3:i.backoff=t.uint64Number();break;default:t.skipType(7&r)}}return i})),r),t.encode=e=>nN(e,t.codec()),t.decode=(e,r)=>ng(e,t.codec(),r)}(a=e.ControlPrune||(e.ControlPrune={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.peerID&&(t.uint32(10),t.bytes(e.peerID)),null!=e.signedPeerRecord&&(t.uint32(18),t.bytes(e.signedPeerRecord)),!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.peerID=e.bytes();break;case 2:n.signedPeerRecord=e.bytes();break;default:e.skipType(7&t)}}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(l=e.PeerInfo||(e.PeerInfo={})),function(e){let t;e.codec=()=>(null==t&&(t=nM((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.messageIDs)for(let r of e.messageIDs)t.uint32(10),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()},(e,t,r={})=>{let n={messageIDs:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){let t=e.uint32();if(t>>>3==1){if(r.limits?.messageIDs!=null&&n.messageIDs.length===r.limits.messageIDs)throw new nL('Decode error - map field "messageIDs" had too many elements');n.messageIDs.push(e.bytes())}else e.skipType(7&t)}return n})),t),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(c=e.ControlIDontWant||(e.ControlIDontWant={})),e.codec=()=>(null==u&&(u=nM((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.subscriptions)for(let n of t.subscriptions)r.uint32(10),e.SubOpts.codec().encode(n,r);if(null!=t.messages)for(let n of t.messages)r.uint32(18),e.Message.codec().encode(n,r);null!=t.control&&(r.uint32(26),e.ControlMessage.codec().encode(t.control,r)),!1!==n.lengthDelimited&&r.ldelim()},(t,r,n={})=>{let i={subscriptions:[],messages:[]},s=null==r?t.len:t.pos+r;for(;t.pos<s;){let r=t.uint32();switch(r>>>3){case 1:if(n.limits?.subscriptions!=null&&i.subscriptions.length===n.limits.subscriptions)throw new nL('Decode error - map field "subscriptions" had too many elements');i.subscriptions.push(e.SubOpts.codec().decode(t,t.uint32(),{limits:n.limits?.subscriptions$}));break;case 2:if(n.limits?.messages!=null&&i.messages.length===n.limits.messages)throw new nL('Decode error - map field "messages" had too many elements');i.messages.push(e.Message.codec().decode(t,t.uint32(),{limits:n.limits?.messages$}));break;case 3:i.control=e.ControlMessage.codec().decode(t,t.uint32(),{limits:n.limits?.control});break;default:t.skipType(7&r)}}return i})),u),e.encode=t=>nN(t,e.codec()),e.decode=(t,r)=>ng(t,e.codec(),r)}(tU||(tU={}));class VX{gossip;msgs=new Map;msgIdToStrFn;history=[];notValidatedCount=0;constructor(e,t,r){this.gossip=e,this.msgIdToStrFn=r;for(let e=0;e<t;e++)this.history[e]=[]}get size(){return this.msgs.size}put(e,t,r=!1){let{msgIdStr:n}=e;return!this.msgs.has(n)&&(this.msgs.set(n,{message:t,validated:r,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),!r&&this.notValidatedCount++,!0)}observeDuplicate(e,t){let r=this.msgs.get(e);null==r||r.validated||r.originatingPeers.add(t)}get(e){return this.msgs.get(this.msgIdToStrFn(e))?.message}getWithIWantCount(e,t){let r=this.msgs.get(e);if(null==r)return null;let n=(r.iwantCounts.get(t)??0)+1;return r.iwantCounts.set(t,n),{msg:r.message,count:n}}getGossipIDs(e){let t=new Map;for(let r=0;r<this.gossip;r++)this.history[r].forEach(r=>{let n=this.msgs.get(r.msgIdStr);if(n?.validated&&e.has(r.topic)){let e=t.get(r.topic);null==e&&(e=[],t.set(r.topic,e)),e.push(r.msgId)}});return t}validate(e){let t=this.msgs.get(e);if(null==t)return null;!t.validated&&this.notValidatedCount--;let{message:r,originatingPeers:n}=t;return t.validated=!0,t.originatingPeers=new Set,{message:r,originatingPeers:n}}shift(){this.history[this.history.length-1].forEach(e=>{let t=this.msgs.get(e.msgIdStr);null!=t&&(this.msgs.delete(e.msgIdStr),!t.validated&&this.notValidatedCount--)}),this.history.pop(),this.history.unshift([])}remove(e){let t=this.msgs.get(e);return null==t?null:(this.msgs.delete(e),t)}}function V0(e){switch(e){case tL.Ignore:return tH.Ignore;case tL.Reject:return tH.Reject;default:throw Error("Unreachable")}}function V1(e,t,r){return{protocolsEnabled:e.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:e.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:e.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:e.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEventsFanout:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_fanout_total",help:"Number of times we include peers in a topic mesh for fanout reasons",labelNames:["topic"]}),meshPeerInclusionEventsRandom:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_random_total",help:"Number of times we include peers in a topic mesh for random reasons",labelNames:["topic"]}),meshPeerInclusionEventsSubscribed:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_subscribed_total",help:"Number of times we include peers in a topic mesh for subscribed reasons",labelNames:["topic"]}),meshPeerInclusionEventsOutbound:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_outbound_total",help:"Number of times we include peers in a topic mesh for outbound reasons",labelNames:["topic"]}),meshPeerInclusionEventsNotEnough:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_not_enough_total",help:"Number of times we include peers in a topic mesh for not_enough reasons",labelNames:["topic"]}),meshPeerInclusionEventsOpportunistic:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_opportunistic_total",help:"Number of times we include peers in a topic mesh for opportunistic reasons",labelNames:["topic"]}),meshPeerInclusionEventsUnknown:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_unknown_total",help:"Number of times we include peers in a topic mesh for unknown reasons",labelNames:["topic"]}),meshPeerChurnEventsDisconnected:e.gauge({name:"gossipsub_peer_churn_events_disconnected_total",help:"Number of times we remove peers in a topic mesh for disconnected reasons",labelNames:["topic"]}),meshPeerChurnEventsBadScore:e.gauge({name:"gossipsub_peer_churn_events_bad_score_total",help:"Number of times we remove peers in a topic mesh for bad_score reasons",labelNames:["topic"]}),meshPeerChurnEventsPrune:e.gauge({name:"gossipsub_peer_churn_events_prune_total",help:"Number of times we remove peers in a topic mesh for prune reasons",labelNames:["topic"]}),meshPeerChurnEventsExcess:e.gauge({name:"gossipsub_peer_churn_events_excess_total",help:"Number of times we remove peers in a topic mesh for excess reasons",labelNames:["topic"]}),meshPeerChurnEventsUnknown:e.gauge({name:"gossipsub_peer_churn_events_unknown_total",help:"Number of times we remove peers in a topic mesh for unknown reasons",labelNames:["topic"]}),peersPerProtocol:e.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:e.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:e.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),acceptedMessagesTotal:e.gauge({name:"gossipsub_accepted_messages_total",help:"Total accepted messages for each topic",labelNames:["topic"]}),ignoredMessagesTotal:e.gauge({name:"gossipsub_ignored_messages_total",help:"Total ignored messages for each topic",labelNames:["topic"]}),rejectedMessagesTotal:e.gauge({name:"gossipsub_rejected_messages_total",help:"Total rejected messages for each topic",labelNames:["topic"]}),unknownValidationResultsTotal:e.gauge({name:"gossipsub_unknown_validation_results_total",help:"Total unknown validation results for each topic",labelNames:["topic"]}),asyncValidationMcacheHit:e.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),asyncValidationDelayFromFirstSeenSec:e.histogram({name:"gossipsub_async_validation_delay_from_first_seen",help:"Async validation report delay from first seen in second",buckets:[.01,.03,.1,.3,1,3,10]}),asyncValidationUnknownFirstSeen:e.gauge({name:"gossipsub_async_validation_unknown_first_seen_count_total",help:"Async validation report unknown first seen value for message"}),peerReadStreamError:e.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:e.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:e.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:e.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:e.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:e.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:e.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:e.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:e.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:e.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:e.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:e.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:e.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:e.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:e.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:e.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:e.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:e.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:e.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:e.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:e.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:e.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),rpcSentIDontWant:e.gauge({name:"gossipsub_rpc_sent_idontwant_total",help:"RPC sent"}),msgPublishCount:e.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeersByTopic:e.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),directPeersPublishedTotal:e.gauge({name:"gossipsub_direct_peers_published_total",help:"Total direct peers that we publish a msg to",labelNames:["topic"]}),floodsubPeersPublishedTotal:e.gauge({name:"gossipsub_floodsub_peers_published_total",help:"Total floodsub peers that we publish a msg to",labelNames:["topic"]}),meshPeersPublishedTotal:e.gauge({name:"gossipsub_mesh_peers_published_total",help:"Total mesh peers that we publish a msg to",labelNames:["topic"]}),fanoutPeersPublishedTotal:e.gauge({name:"gossipsub_fanout_peers_published_total",help:"Total fanout peers that we publish a msg to",labelNames:["topic"]}),msgPublishBytes:e.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgPublishTime:e.histogram({name:"gossipsub_msg_publish_seconds",help:"Total time in seconds to publish a message",buckets:[.001,.002,.005,.01,.1,.5,1],labelNames:["topic"]}),msgForwardCount:e.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:e.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:e.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:e.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),prevalidationInvalidTotal:e.gauge({name:"gossipsub_pre_validation_invalid_total",help:"Total count of invalid messages received",labelNames:["topic"]}),prevalidationValidTotal:e.gauge({name:"gossipsub_pre_validation_valid_total",help:"Total count of valid messages received",labelNames:["topic"]}),prevalidationDuplicateTotal:e.gauge({name:"gossipsub_pre_validation_duplicate_total",help:"Total count of duplicate messages received",labelNames:["topic"]}),prevalidationUnknownTotal:e.gauge({name:"gossipsub_pre_validation_unknown_status_total",help:"Total count of unknown_status messages received",labelNames:["topic"]}),msgReceivedInvalid:e.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["error"]}),msgReceivedInvalidByTopic:e.gauge({name:"gossipsub_msg_received_invalid_by_topic_total",help:"Tracks specific invalid message by topic",labelNames:["topic"]}),duplicateMsgDeliveryDelay:e.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*r.maxMeshMessageDeliveriesWindowSec,.5*r.maxMeshMessageDeliveriesWindowSec,Number(r.maxMeshMessageDeliveriesWindowSec),2*r.maxMeshMessageDeliveriesWindowSec,4*r.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:e.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:e.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:e.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:e.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:e.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:e.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:e.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores"}),scoreWeights:e.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:e.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:e.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:e.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*r.behaviourPenaltyThreshold,.5*r.behaviourPenaltyThreshold,Number(r.behaviourPenaltyThreshold),2*r.behaviourPenaltyThreshold,4*r.behaviourPenaltyThreshold]}),ihaveRcvIgnored:e.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:e.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:e.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:e.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:e.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),idontwantRcvMsgids:e.gauge({name:"gossipsub_idontwant_rcv_msgids_total",help:"Total received IDONTWANT messages"}),idontwantRcvDonthaveMsgids:e.gauge({name:"gossipsub_idontwant_rcv_dont_have_msgids_total",help:"Total received IDONTWANT messageIDs that we do not have in mcache"}),iwantPromiseStarted:e.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:e.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:e.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:e.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:e.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:e.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:e.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*r.gossipPromiseExpireSec,Number(r.gossipPromiseExpireSec),2*r.gossipPromiseExpireSec,4*r.gossipPromiseExpireSec]}),iwantPromiseUntracked:e.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),connectedPeersBackoffSec:e.histogram({name:"gossipsub_connected_peers_backoff_seconds",help:"Backoff time in seconds",buckets:[1,2,4,10,20,60,120]}),cacheSize:e.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:e.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:e.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:e.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:e.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:t,toTopic(e){return this.topicStrToLabel.get(e)??e},onJoin(e){this.topicSubscriptionStatus.set({topicStr:e},1),this.meshPeerCounts.set({topicStr:e},0)},onLeave(e){this.topicSubscriptionStatus.set({topicStr:e},0),this.meshPeerCounts.set({topicStr:e},0)},onAddToMesh(e,t,r){let n=this.toTopic(e);switch(t){case tK.Fanout:this.meshPeerInclusionEventsFanout.inc({topic:n},r);break;case tK.Random:this.meshPeerInclusionEventsRandom.inc({topic:n},r);break;case tK.Subscribed:this.meshPeerInclusionEventsSubscribed.inc({topic:n},r);break;case tK.Outbound:this.meshPeerInclusionEventsOutbound.inc({topic:n},r);break;case tK.NotEnough:this.meshPeerInclusionEventsNotEnough.inc({topic:n},r);break;case tK.Opportunistic:this.meshPeerInclusionEventsOpportunistic.inc({topic:n},r);break;default:this.meshPeerInclusionEventsUnknown.inc({topic:n},r)}},onRemoveFromMesh(e,t,r){let n=this.toTopic(e);switch(t){case tG.Dc:this.meshPeerChurnEventsDisconnected.inc({topic:n},r);break;case tG.BadScore:this.meshPeerChurnEventsBadScore.inc({topic:n},r);break;case tG.Prune:this.meshPeerChurnEventsPrune.inc({topic:n},r);break;case tG.Excess:this.meshPeerChurnEventsExcess.inc({topic:n},r);break;default:this.meshPeerChurnEventsUnknown.inc({topic:n},r)}},onReportValidation(e,t,r){if(this.asyncValidationMcacheHit.inc({hit:null!=e?"hit":"miss"}),null!=e){let r=this.toTopic(e.message.topic);switch(t){case tL.Accept:this.acceptedMessagesTotal.inc({topic:r});break;case tL.Ignore:this.ignoredMessagesTotal.inc({topic:r});break;case tL.Reject:this.rejectedMessagesTotal.inc({topic:r});break;default:this.unknownValidationResultsTotal.inc({topic:r})}}null!=r?this.asyncValidationDelayFromFirstSeenSec.observe((Date.now()-r)/1e3):this.asyncValidationUnknownFirstSeen.inc()},onScorePenalty(e){this.scoringPenalties.inc({penalty:e},1)},onIhaveRcv(e,t,r){let n=this.toTopic(e);this.ihaveRcvMsgids.inc({topic:n},t),this.ihaveRcvNotSeenMsgids.inc({topic:n},r)},onIwantRcv(e,t){for(let[t,r]of e){let e=this.toTopic(t);this.iwantRcvMsgids.inc({topic:e},r)}this.iwantRcvDonthaveMsgids.inc(t)},onIdontwantRcv(e,t){this.idontwantRcvMsgids.inc(e),this.idontwantRcvDonthaveMsgids.inc(t)},onForwardMsg(e,t){let r=this.toTopic(e);this.msgForwardCount.inc({topic:r},1),this.msgForwardPeers.inc({topic:r},t)},onPublishMsg(e,t,r,n,i){let s=this.toTopic(e);this.msgPublishCount.inc({topic:s},1),this.msgPublishBytes.inc({topic:s},r*n),this.msgPublishPeersByTopic.inc({topic:s},r),this.directPeersPublishedTotal.inc({topic:s},t.direct),this.floodsubPeersPublishedTotal.inc({topic:s},t.floodsub),this.meshPeersPublishedTotal.inc({topic:s},t.mesh),this.fanoutPeersPublishedTotal.inc({topic:s},t.fanout),this.msgPublishTime.observe({topic:s},i/1e3)},onMsgRecvPreValidation(e){let t=this.toTopic(e);this.msgReceivedPreValidation.inc({topic:t},1)},onMsgRecvError(e){let t=this.toTopic(e);this.msgReceivedError.inc({topic:t},1)},onPrevalidationResult(e,t){let r=this.toTopic(e);switch(t){case tz.duplicate:this.prevalidationDuplicateTotal.inc({topic:r});break;case tz.invalid:this.prevalidationInvalidTotal.inc({topic:r});break;case tz.valid:this.prevalidationValidTotal.inc({topic:r});break;default:this.prevalidationUnknownTotal.inc({topic:r})}},onMsgRecvInvalid(e,t){let r=this.toTopic(e),n=t.reason===tH.Error?t.error:t.reason;this.msgReceivedInvalid.inc({error:n},1),this.msgReceivedInvalidByTopic.inc({topic:r},1)},onDuplicateMsgDelivery(e,t,r){let n=this.toTopic(e);this.duplicateMsgDeliveryDelay.observe({topic:n},t/1e3),r&&this.duplicateMsgLateDelivery.inc({topic:n},1)},onPublishDuplicateMsg(e){let t=this.toTopic(e);this.duplicateMsgIgnored.inc({topic:t},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(e,t){this.rpcRecvBytes.inc(t),this.rpcRecvCount.inc(1),null!=e.subscriptions&&this.rpcRecvSubscription.inc(e.subscriptions.length),null!=e.messages&&this.rpcRecvMessage.inc(e.messages.length),null!=e.control&&(this.rpcRecvControl.inc(1),null!=e.control.ihave&&this.rpcRecvIHave.inc(e.control.ihave.length),null!=e.control.iwant&&this.rpcRecvIWant.inc(e.control.iwant.length),null!=e.control.graft&&this.rpcRecvGraft.inc(e.control.graft.length),null!=e.control.prune&&this.rpcRecvPrune.inc(e.control.prune.length))},onRpcSent(e,t){if(this.rpcSentBytes.inc(t),this.rpcSentCount.inc(1),null!=e.subscriptions&&this.rpcSentSubscription.inc(e.subscriptions.length),null!=e.messages&&this.rpcSentMessage.inc(e.messages.length),null!=e.control){let t=e.control.ihave?.length??0,r=e.control.iwant?.length??0,n=e.control.graft?.length??0,i=e.control.prune?.length??0,s=e.control.idontwant?.length??0;t>0&&this.rpcSentIHave.inc(t),r>0&&this.rpcSentIWant.inc(r),n>0&&this.rpcSentGraft.inc(n),i>0&&this.rpcSentPrune.inc(i),s>0&&this.rpcSentIDontWant.inc(s),(t>0||r>0||n>0||i>0||s>0)&&this.rpcSentControl.inc(1)}},registerScores(e,t){let r=0,n=0,i=0,s=0;for(let o of e)o>=t.graylistThreshold&&r++,o>=t.publishThreshold&&n++,o>=t.gossipThreshold&&i++,o>=0&&s++;this.peersByScoreThreshold.set({threshold:tJ.graylist},r),this.peersByScoreThreshold.set({threshold:tJ.publish},n),this.peersByScoreThreshold.set({threshold:tJ.gossip},i),this.peersByScoreThreshold.set({threshold:tJ.mesh},s),this.score.set(e)},registerScoreWeights(e){for(let[t,r]of e.byTopic)this.scoreWeights.set({topic:t,p:"p1"},r.p1w),this.scoreWeights.set({topic:t,p:"p2"},r.p2w),this.scoreWeights.set({topic:t,p:"p3"},r.p3w),this.scoreWeights.set({topic:t,p:"p3b"},r.p3bw),this.scoreWeights.set({topic:t,p:"p4"},r.p4w);this.scoreWeights.set({p:"p5"},e.p5w),this.scoreWeights.set({p:"p6"},e.p6w),this.scoreWeights.set({p:"p7"},e.p7w)},registerScorePerMesh(e,t){let r=new Map;for(let[n,i]of(e.forEach((e,t)=>{let n=this.topicStrToLabel.get(t)??"unknown",i=r.get(n);null==i&&(i=new Set,r.set(n,i)),e.forEach(e=>i?.add(e))}),r)){let e=[];i.forEach(r=>{e.push(t.get(r)??0)}),this.scorePerMesh.set({topic:n},e)}}}}!function(e){e.StrictSign="StrictSign",e.StrictNoSign="StrictNoSign"}(tj||(tj={})),function(e){e[e.Signing=0]="Signing",e[e.Anonymous=1]="Anonymous"}(t$||(t$={})),function(e){e.Error="error",e.Ignore="ignore",e.Reject="reject",e.Blacklisted="blacklisted"}(tH||(tH={})),function(e){e.InvalidSignature="invalid_signature",e.InvalidSeqno="invalid_seqno",e.InvalidPeerId="invalid_peerid",e.SignaturePresent="signature_present",e.SeqnoPresent="seqno_present",e.FromPresent="from_present",e.TransformFailed="transform_failed"}(tq||(tq={})),function(e){e.duplicate="duplicate",e.invalid="invalid",e.valid="valid"}(tz||(tz={})),function(e){e.forward="forward",e.publish="publish"}(tV||(tV={})),function(e){e.Fanout="fanout",e.Random="random",e.Subscribed="subscribed",e.Outbound="outbound",e.NotEnough="not_enough",e.Opportunistic="opportunistic"}(tK||(tK={})),function(e){e.Dc="disconnected",e.BadScore="bad_score",e.Prune="prune",e.Excess="excess"}(tG||(tG={})),function(e){e.GraftBackoff="graft_backoff",e.BrokenPromise="broken_promise",e.MessageDeficit="message_deficit",e.IPColocation="IP_colocation"}(tW||(tW={})),function(e){e.LowScore="low_score",e.MaxIhave="max_ihave",e.MaxIasked="max_iasked"}(tQ||(tQ={})),function(e){e.graylist="graylist",e.publish="publish",e.gossip="gossip",e.mesh="mesh"}(tJ||(tJ={}));class V2 extends Error{static name="InvalidPeerScoreParamsError";constructor(e="Invalid peer score params"){super(e),this.name="InvalidPeerScoreParamsError"}}let V3={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:36e5},V4={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function V5(e={}){return{...V3,...e,topics:null!=e.topics?Object.entries(e.topics).reduce((e,[t,r])=>(e[t]=V6(r),e),{}):{}}}function V6(e={}){return{...V4,...e}}function V8(e){for(let[t,r]of Object.entries(e.topics))try{V7(r)}catch(e){throw new V2(`invalid score parameters for topic ${t}: ${e.message}`)}if(e.topicScoreCap<0)throw new V2("invalid topic score cap; must be positive (or 0 for no cap)");if(null===e.appSpecificScore||void 0===e.appSpecificScore)throw new V2("missing application specific score function");if(e.IPColocationFactorWeight>0)throw new V2("invalid IPColocationFactorWeight; must be negative (or 0 to disable)");if(0!==e.IPColocationFactorWeight&&e.IPColocationFactorThreshold<1)throw new V2("invalid IPColocationFactorThreshold; must be at least 1");if(e.behaviourPenaltyWeight>0)throw new V2("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)");if(0!==e.behaviourPenaltyWeight&&(e.behaviourPenaltyDecay<=0||e.behaviourPenaltyDecay>=1))throw new V2("invalid BehaviourPenaltyDecay; must be between 0 and 1");if(e.decayInterval<1e3)throw new V2("invalid DecayInterval; must be at least 1s");if(e.decayToZero<=0||e.decayToZero>=1)throw new V2("invalid DecayToZero; must be between 0 and 1")}function V7(e){if(e.topicWeight<0)throw new V2("invalid topic weight; must be >= 0");if(0===e.timeInMeshQuantum)throw new V2("invalid TimeInMeshQuantum; must be non zero");if(e.timeInMeshWeight<0)throw new V2("invalid TimeInMeshWeight; must be positive (or 0 to disable)");if(0!==e.timeInMeshWeight&&e.timeInMeshQuantum<=0)throw new V2("invalid TimeInMeshQuantum; must be positive");if(0!==e.timeInMeshWeight&&e.timeInMeshCap<=0)throw new V2("invalid TimeInMeshCap; must be positive");if(e.firstMessageDeliveriesWeight<0)throw new V2("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)");if(0!==e.firstMessageDeliveriesWeight&&(e.firstMessageDeliveriesDecay<=0||e.firstMessageDeliveriesDecay>=1))throw new V2("invalid FirstMessageDeliveriesDecay; must be between 0 and 1");if(0!==e.firstMessageDeliveriesWeight&&e.firstMessageDeliveriesCap<=0)throw new V2("invalid FirstMessageDeliveriesCap; must be positive");if(e.meshMessageDeliveriesWeight>0)throw new V2("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)");if(0!==e.meshMessageDeliveriesWeight&&(e.meshMessageDeliveriesDecay<=0||e.meshMessageDeliveriesDecay>=1))throw new V2("invalid MeshMessageDeliveriesDecay; must be between 0 and 1");if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesCap<=0)throw new V2("invalid MeshMessageDeliveriesCap; must be positive");if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesThreshold<=0)throw new V2("invalid MeshMessageDeliveriesThreshold; must be positive");if(e.meshMessageDeliveriesWindow<0)throw new V2("invalid MeshMessageDeliveriesWindow; must be non-negative");if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesActivation<1e3)throw new V2("invalid MeshMessageDeliveriesActivation; must be at least 1s");if(e.meshFailurePenaltyWeight>0)throw new V2("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)");if(0!==e.meshFailurePenaltyWeight&&(e.meshFailurePenaltyDecay<=0||e.meshFailurePenaltyDecay>=1))throw new V2("invalid MeshFailurePenaltyDecay; must be between 0 and 1");if(e.invalidMessageDeliveriesWeight>0)throw new V2("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)");if(e.invalidMessageDeliveriesDecay<=0||e.invalidMessageDeliveriesDecay>=1)throw new V2("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1")}let V9={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function Ke(e={}){return{...V9,...e}}function Kt(e,t,r=()=>!0){let n=new Set;if(t<=0)return n;for(let i of e){if(n.size>=t)break;r(i)&&(n.add(i),e.delete(i))}return n}function Kr(e,t){return Kt(e,t,()=>!0)}class Kn extends Map{getDefault;constructor(e){super(),this.getDefault=e}getOrDefault(e){let t=super.get(e);return void 0===t&&(t=this.getDefault(),this.set(e,t)),t}}function Ki(e,t,r,n){let i=0;Object.entries(t.topics).forEach(([e,t])=>{let n=r.topics[e];if(void 0===n)return;let s=0;if(t.inMesh){let e=t.meshTime/n.timeInMeshQuantum;e>n.timeInMeshCap&&(e=n.timeInMeshCap),s+=e*n.timeInMeshWeight}let o=t.firstMessageDeliveries;if(o>n.firstMessageDeliveriesCap&&(o=n.firstMessageDeliveriesCap),s+=o*n.firstMessageDeliveriesWeight,t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<n.meshMessageDeliveriesThreshold){let e=n.meshMessageDeliveriesThreshold-t.meshMessageDeliveries;s+=e*e*n.meshMessageDeliveriesWeight}s+=t.meshFailurePenalty*n.meshFailurePenaltyWeight+t.invalidMessageDeliveries*t.invalidMessageDeliveries*n.invalidMessageDeliveriesWeight,i+=s*n.topicWeight}),r.topicScoreCap>0&&i>r.topicScoreCap&&(i=r.topicScoreCap);let s=r.appSpecificScore(e);if(i+=s*r.appSpecificWeight,t.knownIPs.forEach(e=>{if(r.IPColocationFactorWhitelist.has(e))return;let t=n.get(e),s=null!=t?t.size:0;if(s>r.IPColocationFactorThreshold){let e=s-r.IPColocationFactorThreshold;i+=e*e*r.IPColocationFactorWeight}}),t.behaviourPenalty>r.behaviourPenaltyThreshold){let e=t.behaviourPenalty-r.behaviourPenaltyThreshold;i+=e*e*r.behaviourPenaltyWeight}return i}var Ks=r(48856);!function(e){e[e.unknown=0]="unknown",e[e.valid=1]="valid",e[e.invalid=2]="invalid",e[e.ignored=3]="ignored"}(tZ||(tZ={}));class Ko{records;queue;constructor(){this.records=new Map,this.queue=new Ks}getRecord(e){return this.records.get(e)}ensureRecord(e){let t=this.records.get(e);if(null!=t)return t;t={status:tZ.unknown,firstSeenTsMs:Date.now(),validated:0,peers:new Set},this.records.set(e,t);let r={msgId:e,expire:Date.now()+VH};return this.queue.push(r),t}gc(){let e=Date.now(),t=this.queue.peekFront();for(;null!=t&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}class Ka{params;metrics;peerStats=new Map;peerIPs=new Kn(()=>new Set);scoreCache=new Map;deliveryRecords=new Ko;_backgroundInterval;scoreCacheValidityMs;computeScore;log;constructor(e,t,r,n){this.params=e,this.metrics=t,V8(e),this.scoreCacheValidityMs=n.scoreCacheValidityMs,this.computeScore=n.computeScore??Ki,this.log=r.forComponent("libp2p:gossipsub:score")}get size(){return this.peerStats.size}start(){if(null!=this._backgroundInterval)return void this.log("Peer score already running");this._backgroundInterval=setInterval(()=>{this.background()},this.params.decayInterval),this.log("started")}stop(){if(null==this._backgroundInterval)return void this.log("Peer score already stopped");clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),this.log("stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([e,t])=>[e,t]))}messageFirstSeenTimestampMs(e){let t=this.deliveryRecords.getRecord(e);return null!=t?t.firstSeenTsMs:null}refreshScores(){let e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach((r,n)=>{if(!r.connected){e>r.expire&&(this.removeIPsForPeer(n,r.knownIPs),this.peerStats.delete(n),this.scoreCache.delete(n));return}Object.entries(r.topics).forEach(([r,n])=>{let i=this.params.topics[r];void 0!==i&&(n.firstMessageDeliveries*=i.firstMessageDeliveriesDecay,n.firstMessageDeliveries<t&&(n.firstMessageDeliveries=0),n.meshMessageDeliveries*=i.meshMessageDeliveriesDecay,n.meshMessageDeliveries<t&&(n.meshMessageDeliveries=0),n.meshFailurePenalty*=i.meshFailurePenaltyDecay,n.meshFailurePenalty<t&&(n.meshFailurePenalty=0),n.invalidMessageDeliveries*=i.invalidMessageDeliveriesDecay,n.invalidMessageDeliveries<t&&(n.invalidMessageDeliveries=0),n.inMesh&&(n.meshTime=e-n.graftTime,n.meshTime>i.meshMessageDeliveriesActivation&&(n.meshMessageDeliveriesActive=!0)))}),r.behaviourPenalty*=this.params.behaviourPenaltyDecay,r.behaviourPenalty<t&&(r.behaviourPenalty=0)})}score(e){this.metrics?.scoreFnCalls.inc();let t=this.peerStats.get(e);if(null==t)return 0;let r=Date.now(),n=this.scoreCache.get(e);if(null!=n&&n.cacheUntil>r)return n.score;this.metrics?.scoreFnRuns.inc();let i=this.computeScore(e,t,this.params,this.peerIPs),s=r+this.scoreCacheValidityMs;return null!=n?(this.metrics?.scoreCachedDelta.observe(Math.abs(i-n.score)),n.score=i,n.cacheUntil=s):this.scoreCache.set(e,{score:i,cacheUntil:s}),i}addPenalty(e,t,r){let n=this.peerStats.get(e);null!=n&&(n.behaviourPenalty+=t,this.metrics?.onScorePenalty(r))}addPeer(e){let t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){let r=this.peerStats.get(e);null!=r&&r.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){let r=this.peerStats.get(e);null!=r&&r.knownIPs.delete(t);let n=this.peerIPs.get(t);null!=n&&(n.delete(e),0===n.size&&this.peerIPs.delete(t))}removePeer(e){let t=this.peerStats.get(e);if(null!=t){if(this.score(e)>0){this.removeIPsForPeer(e,t.knownIPs),this.peerStats.delete(e);return}Object.entries(t.topics).forEach(([e,t])=>{t.firstMessageDeliveries=0;let r=this.params.topics[e].meshMessageDeliveriesThreshold;if(t.inMesh&&t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<r){let e=r-t.meshMessageDeliveries;t.meshFailurePenalty+=e*e}t.inMesh=!1,t.meshMessageDeliveriesActive=!1}),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){let r=this.peerStats.get(e);if(null!=r){let e=this.getPtopicStats(r,t);null!=e&&(e.inMesh=!0,e.graftTime=Date.now(),e.meshTime=0,e.meshMessageDeliveriesActive=!1)}}prune(e,t){let r=this.peerStats.get(e);if(null!=r){let e=this.getPtopicStats(r,t);if(null!=e){let r=this.params.topics[t].meshMessageDeliveriesThreshold;if(e.meshMessageDeliveriesActive&&e.meshMessageDeliveries<r){let t=r-e.meshMessageDeliveries;e.meshFailurePenalty+=t*t}e.meshMessageDeliveriesActive=!1,e.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,r){this.markFirstMessageDelivery(e,r);let n=this.deliveryRecords.ensureRecord(t),i=Date.now();if(n.status!==tZ.unknown)return void this.log("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,i-n.firstSeenTsMs,tZ[n.status]);n.status=tZ.valid,n.validated=i,n.peers.forEach(t=>{t!==e.toString()&&this.markDuplicateMessageDelivery(t,r)})}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,r,n){switch(n){case tH.Error:this.markInvalidMessageDelivery(e,r);return;case tH.Blacklisted:return}let i=this.deliveryRecords.ensureRecord(t);if(i.status!==tZ.unknown)return void this.log("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-i.firstSeenTsMs,tZ[i.status]);if(n===tH.Ignore){i.status=tZ.ignored,i.peers.clear();return}i.status=tZ.invalid,this.markInvalidMessageDelivery(e,r),i.peers.forEach(e=>{this.markInvalidMessageDelivery(e,r)}),i.peers.clear()}duplicateMessage(e,t,r){let n=this.deliveryRecords.ensureRecord(t);if(!n.peers.has(e))switch(n.status){case tZ.unknown:n.peers.add(e);break;case tZ.valid:n.peers.add(e),this.markDuplicateMessageDelivery(e,r,n.validated);break;case tZ.invalid:this.markInvalidMessageDelivery(e,r);case tZ.ignored:}}markInvalidMessageDelivery(e,t){let r=this.peerStats.get(e);if(null!=r){let e=this.getPtopicStats(r,t);null!=e&&(e.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){let r=this.peerStats.get(e);if(null!=r){let e=this.getPtopicStats(r,t);if(null!=e){let r=this.params.topics[t].firstMessageDeliveriesCap;e.firstMessageDeliveries=Math.min(r,e.firstMessageDeliveries+1),e.inMesh&&(e.meshMessageDeliveries=Math.min(r=this.params.topics[t].meshMessageDeliveriesCap,e.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,r){let n=this.peerStats.get(e);if(null!=n){let e=void 0!==r?Date.now():0,i=this.getPtopicStats(n,t);if(null!=i&&i.inMesh){let n=this.params.topics[t];if(void 0!==r){let i=e-r,s=i>n.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(t,i,s),s)return}i.meshMessageDeliveries=Math.min(n.meshMessageDeliveriesCap,i.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(let r of t){let t=this.peerIPs.get(r);null!=t&&(t.delete(e),0===t.size&&this.peerIPs.delete(r))}}getPtopicStats(e,t){let r=e.topics[t];return void 0!==r?r:void 0!==this.params.topics[t]?(r={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=r,r):null}}function Kl(e,t,r,n,i){let s,o=0,a=new Map;if(Object.entries(t.topics).forEach(([e,t])=>{let n=i.get(e)??"unknown",s=r.topics[e];if(void 0===s)return;let l=a.get(n);null==l&&(l={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},a.set(n,l));let c=0,u=0,h=0,d=0,f=0;t.inMesh&&(c+=Math.max(t.meshTime/s.timeInMeshQuantum,s.timeInMeshCap)*s.timeInMeshWeight);let p=t.firstMessageDeliveries;if(p>s.firstMessageDeliveriesCap&&(p=s.firstMessageDeliveriesCap),u+=p*s.firstMessageDeliveriesWeight,t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<s.meshMessageDeliveriesThreshold){let e=s.meshMessageDeliveriesThreshold-t.meshMessageDeliveries;h+=e*e*s.meshMessageDeliveriesWeight}d+=t.meshFailurePenalty*s.meshFailurePenaltyWeight,f+=t.invalidMessageDeliveries*t.invalidMessageDeliveries*s.invalidMessageDeliveriesWeight,o+=(c+u+h+d+f)*s.topicWeight,l.p1w+=c,l.p2w+=u,l.p3w+=h,l.p3bw+=d,l.p4w+=f}),r.topicScoreCap>0&&o>r.topicScoreCap){o=r.topicScoreCap;let e=r.topicScoreCap/o;for(let t of a.values())t.p1w*=e,t.p2w*=e,t.p3w*=e,t.p3bw*=e,t.p4w*=e}let l=0,c=0;return s=0+r.appSpecificScore(e)*r.appSpecificWeight,t.knownIPs.forEach(e=>{if(r.IPColocationFactorWhitelist.has(e))return;let t=n.get(e),i=null!=t?t.size:0;if(i>r.IPColocationFactorThreshold){let e=i-r.IPColocationFactorThreshold;l+=e*e*r.IPColocationFactorWeight}}),c+=t.behaviourPenalty*t.behaviourPenalty*r.behaviourPenaltyWeight,o+=s+l+c,{byTopic:a,p5w:s,p6w:l,p7w:c,score:o}}function Kc(e,t,r,n,i){let s={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(let o of e){let e=t.get(o);if(null!=e){let t=Kl(o,e,r,n,i);for(let[e,r]of t.byTopic){let t=s.byTopic.get(e);null==t&&(t={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},s.byTopic.set(e,t)),t.p1w.push(r.p1w),t.p2w.push(r.p2w),t.p3w.push(r.p3w),t.p3bw.push(r.p3bw),t.p4w.push(r.p4w)}s.p5w.push(t.p5w),s.p6w.push(t.p6w),s.p7w.push(t.p7w),s.score.push(t.score)}else s.p5w.push(0),s.p6w.push(0),s.p7w.push(0),s.score.push(0)}return s}class Ku{rawStream;pushable;closeController;maxBufferSize;constructor(e,t,r){this.rawStream=e,this.pushable=(0,li.Ny)(),this.closeController=new AbortController,this.maxBufferSize=r.maxBufferSize??1/0,this.closeController.signal.addEventListener("abort",()=>{e.close().catch(t=>{e.abort(t)})}),(0,lr.F)(this.pushable,this.rawStream).catch(t)}get protocol(){return this.rawStream.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(Vn.single(e))}pushPrefixed(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}async close(){this.closeController.abort(),await this.pushable.return()}}class Kh{source;rawStream;closeController;constructor(e,t={}){this.rawStream=e,this.closeController=new AbortController,this.closeController.signal.addEventListener("abort",()=>{e.close().catch(t=>{e.abort(t)})}),this.source=(0,lr.F)(this.rawStream,e=>Vh(e,t))}async close(){this.closeController.abort()}}class Kd{gossipsubIWantFollowupMs;msgIdToStrFn;metrics;promises=new Map;requestMsByMsg=new Map;requestMsByMsgExpire;constructor(e,t,r){this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=r,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){let r=Math.floor(Math.random()*t.length),n=t[r],i=this.msgIdToStrFn(n),s=this.promises.get(i);null==s&&(s=new Map,this.promises.set(i,s));let o=Date.now();!s.has(e)&&(s.set(e,o+this.gossipsubIWantFollowupMs),null!=this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(i)||this.requestMsByMsg.set(i,o)))}getBrokenPromises(){let e=Date.now(),t=new Map,r=0;return this.promises.forEach((n,i)=>{n.forEach((i,s)=>{i<e&&(t.set(s,(t.get(s)??0)+1),n.delete(s),r++)}),0===n.size&&this.promises.delete(i)}),this.metrics?.iwantPromiseBroken.inc(r),t}deliverMessage(e,t=!1){this.trackMessage(e);let r=this.promises.get(e);null!=r&&(this.promises.delete(e),null!=this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(r.size)))}rejectMessage(e,t){this.trackMessage(e),t!==tH.Error&&this.promises.delete(e)}clear(){this.promises.clear()}prune(){let e=Date.now()-this.requestMsByMsgExpire,t=0;for(let[r,n]of this.requestMsByMsg.entries())if(n<e)this.requestMsByMsg.delete(r),t++;else break;this.metrics?.iwantMessagePruned.inc(t)}trackMessage(e){if(null!=this.metrics){let t=this.requestMsByMsg.get(e);void 0!==t&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}}let Kf=(0,nm.s)("libp2p-pubsub:");async function Kp(e,t,r,n){switch(e.type){case t$.Signing:{let i={from:e.author.toMultihash().bytes,data:n,seqno:Er(8),topic:t,signature:void 0,key:void 0},s=rt([Kf,tU.Message.encode(i)]);i.signature=await e.privateKey.sign(s),i.key=e.key;let o={type:"signed",from:e.author,data:r,sequenceNumber:BigInt(`0x${(0,uh.d)(i.seqno??new Uint8Array(0),"base16")}`),topic:t,signature:i.signature,key:ya(i.key)};return{raw:i,msg:o}}case t$.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:t,signature:void 0,key:void 0},msg:{type:"unsigned",data:r,topic:t}};default:throw Error("Unreachable")}}async function Kg(e,t){switch(e){case Ve:if(null!=t.signature)return{valid:!1,error:tq.SignaturePresent};if(null!=t.seqno)return{valid:!1,error:tq.SeqnoPresent};if(null!=t.key)return{valid:!1,error:tq.FromPresent};return{valid:!0,message:{type:"unsigned",topic:t.topic,data:t.data??new Uint8Array(0)}};case z9:{let e,r;if(null==t.seqno||8!==t.seqno.length)return{valid:!1,error:tq.InvalidSeqno};if(null==t.signature)return{valid:!1,error:tq.InvalidSignature};if(null==t.from)return{valid:!1,error:tq.InvalidPeerId};try{e=yO(aG.decode(t.from))}catch(e){return{valid:!1,error:tq.InvalidPeerId}}if(null!=t.key){if(r=ya(t.key),void 0!==e.publicKey&&!r.equals(e.publicKey))return{valid:!1,error:tq.InvalidPeerId}}else{if(null==e.publicKey)return{valid:!1,error:tq.InvalidPeerId};r=e.publicKey}let n={from:t.from,data:t.data,seqno:t.seqno,topic:t.topic,signature:void 0,key:void 0},i=rt([Kf,tU.Message.encode(n)]);if(!await r.verify(i,t.signature))return{valid:!1,error:tq.InvalidSignature};return{valid:!0,message:{type:"signed",from:e,data:t.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${(0,uh.d)(t.seqno,"base16")}`),topic:t.topic,signature:t.signature,key:null!=t.key?ya(t.key):r}}}default:throw Error("Unreachable")}}function Km(e=[],t){return{subscriptions:[],messages:e,control:void 0!==t?{graft:t.graft??[],prune:t.prune??[],ihave:t.ihave??[],iwant:t.iwant??[],idontwant:t.idontwant??[]}:void 0}}function Ky(e){return void 0===e.control&&(e.control={graft:[],prune:[],ihave:[],iwant:[],idontwant:[]}),e}function Kb(e){return(0,uh.d)(e,"base64")}function Kw(e){if(e.length<=1)return e;let t=()=>Math.floor(Math.random()*Math.floor(e.length));for(let r=0;r<e.length;r++){let n=t(),i=e[r];e[r]=e[n],e[n]=i}return e}let Kv=(e,t)=>{let r=(0,nm.s)(t.toString(16).padStart(16,"0"),"base16"),n=yu(e),i=new Uint8Array(n.byteLength+r.length);return i.set(n,0),i.set(r,n.byteLength),i};function KE(e){if("signed"!==e.type)throw Error("expected signed message type");if(null==e.sequenceNumber)throw Error("missing seqno field");return Kv(e.from.publicKey??e.key,e.sequenceNumber)}async function KA(e){return nK.sha256.encode(e.data)}function Kx(e){for(let t of e.tuples())switch(t[0]){case tY.ip4:case tY.ip6:return bN(t[0],t[1])}return null}function KS(e,t,r){switch(e){case z9:return{type:t$.Signing,author:t,key:yu(r.publicKey),privateKey:r};case Ve:return{type:t$.Anonymous};default:throw Error(`Unknown signature policy "${e}"`)}}!function(e){e[e.ip4=4]="ip4",e[e.ip6=41]="ip6"}(tY||(tY={}));class Kk{entries=new Map;validityMs;constructor(e){this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return!!this.entries.has(e)||(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){let e=Date.now();for(let[t,r]of this.entries.entries())if(r.validUntilMs<e)this.entries.delete(t);else break}has(e){return this.entries.has(e)}get(e){let t=this.entries.get(e);return null!=t&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}}!function(e){e[e.started=0]="started",e[e.stopped=1]="stopped"}(tX||(tX={}));class K_ extends uS{globalSignaturePolicy;multicodecs=[Vg,Vp,Vf];publishConfig;dataTransform;peers=new Map;streamsInbound=new Map;streamsOutbound=new Map;outboundInflightQueue=(0,li.Ny)({objectMode:!0});direct=new Set;floodsubPeers=new Set;seenCache;acceptFromWhitelist=new Map;topics=new Map;subscriptions=new Set;mesh=new Map;fanout=new Map;fanoutLastpub=new Map;gossip=new Map;control=new Map;peerhave=new Map;iasked=new Map;backoff=new Map;outbound=new Map;msgIdFn;fastMsgIdFn;msgIdToStrFn;fastMsgIdCache;publishedMessageIds;mcache;score;topicValidators=new Map;log;heartbeatTicks=0;gossipTracer;idontwantCounts=new Map;idontwants=new Map;components;directPeerInitial=null;static multicodec=Vg;opts;decodeRpcLimits;metrics;status={code:tX.stopped};maxInboundStreams;maxOutboundStreams;runOnLimitedConnection;allowedTopics;heartbeatTimer=null;constructor(e,t={}){super();let r={fallbackToFloodsub:!0,floodPublish:!0,batchPublish:!1,tagMeshPeers:!0,doPX:!1,directPeers:[],D:Vm,Dlo:Vy,Dhi:Vb,Dscore:Vw,Dout:Vv,Dlazy:Vx,heartbeatInterval:VI,fanoutTTL:VC,mcacheLength:VE,mcacheGossip:VA,seenTTL:V$,gossipsubIWantFollowupMs:Vj,prunePeers:VT,pruneBackoff:VP,unsubcribeBackoff:VR,graftFloodThreshold:VL,opportunisticGraftPeers:VM,opportunisticGraftTicks:VB,directConnectTicks:VN,gossipFactor:VS,idontwantMinDataSize:VJ,idontwantMaxMessages:VZ,...t,scoreParams:V5(t.scoreParams),scoreThresholds:Ke(t.scoreThresholds)};if(this.components=e,this.decodeRpcLimits=r.decodeRpcLimits??VY,this.globalSignaturePolicy=r.globalSignaturePolicy??z9,r.fallbackToFloodsub&&this.multicodecs.push(Vd),this.log=e.logger.forComponent(r.debugName??"libp2p:gossipsub"),this.opts=r,this.direct=new Set(r.directPeers.map(e=>e.id.toString())),this.seenCache=new Kk({validityMs:r.seenTTL}),this.publishedMessageIds=new Kk({validityMs:r.seenTTL}),null!=t.msgIdFn)this.msgIdFn=t.msgIdFn;else switch(this.globalSignaturePolicy){case z9:this.msgIdFn=KE;break;case Ve:this.msgIdFn=KA;break;default:throw Error(`Invalid globalSignaturePolicy: ${this.globalSignaturePolicy}`)}if(null!=t.fastMsgIdFn&&(this.fastMsgIdFn=t.fastMsgIdFn,this.fastMsgIdCache=new Kk({validityMs:r.seenTTL})),this.msgIdToStrFn=t.msgIdToStrFn??Kb,this.mcache=t.messageCache??new VX(r.mcacheGossip,r.mcacheLength,this.msgIdToStrFn),null!=t.dataTransform&&(this.dataTransform=t.dataTransform),null!=t.metricsRegister){if(null==t.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");let e=Math.max(...Object.values(r.scoreParams.topics).map(e=>e.meshMessageDeliveriesWindow),VW),n=V1(t.metricsRegister,t.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:r.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:e/1e3});for(let e of(n.mcacheSize.addCollect(()=>{this.onScrapeMetrics(n)}),this.multicodecs))n.protocolsEnabled.set({protocol:e},1);this.metrics=n}else this.metrics=null;this.gossipTracer=new Kd(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new Ka(this.opts.scoreParams,this.metrics,this.components.logger,{scoreCacheValidityMs:r.heartbeatInterval}),this.maxInboundStreams=t.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams,this.runOnLimitedConnection=t.runOnLimitedConnection,this.allowedTopics=null!=r.allowedTopics?new Set(r.allowedTopics):null}[Symbol.toStringTag]="@chainsafe/libp2p-gossipsub";[En]=["@libp2p/pubsub"];[Ei]=["@libp2p/identify"];getPeers(){return[...this.peers.values()]}isStarted(){return this.status.code===tX.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=KS(this.globalSignaturePolicy,this.components.peerId,this.components.privateKey),this.outboundInflightQueue=(0,li.Ny)({objectMode:!0}),(0,lr.F)(this.outboundInflightQueue,async e=>{for await(let{peerId:t,connection:r}of e)await this.createOutboundStream(t,r)}).catch(e=>{this.log.error("outbound inflight queue error",e)}),await Promise.all(this.opts.directPeers.map(async e=>{await this.components.peerStore.merge(e.id,{multiaddrs:e.addrs})}));let e=this.components.registrar;await Promise.all(this.multicodecs.map(async t=>e.handle(t,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection})));let t={onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this),notifyOnLimitedConnection:this.runOnLimitedConnection},r=await Promise.all(this.multicodecs.map(async r=>e.register(r,t))),n=setTimeout(this.runHeartbeat,V_);this.status={code:tX.started,registrarTopologyIds:r,heartbeatTimeout:n,hearbeatStartMs:Date.now()+V_},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async e=>this.connect(e)))}).catch(e=>{this.log(e)})},VD),this.opts.tagMeshPeers&&(this.addEventListener("gossipsub:graft",this.tagMeshPeer),this.addEventListener("gossipsub:prune",this.untagMeshPeer)),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==tX.started)return;let{registrarTopologyIds:e}=this.status;this.status={code:tX.stopped},this.opts.tagMeshPeers&&(this.removeEventListener("gossipsub:graft",this.tagMeshPeer),this.removeEventListener("gossipsub:prune",this.untagMeshPeer));let t=this.components.registrar;await Promise.all(this.multicodecs.map(async e=>t.unhandle(e))),e.forEach(e=>{t.unregister(e)}),this.outboundInflightQueue.end();let r=[];for(let e of this.streamsOutbound.values())r.push(e.close());for(let e of(this.streamsOutbound.clear(),this.streamsInbound.values()))r.push(e.close());this.streamsInbound.clear(),await Promise.all(r),this.peers.clear(),this.subscriptions.clear(),null!=this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),null!=this.fastMsgIdCache&&this.fastMsgIdCache.clear(),null!=this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.idontwantCounts.clear(),this.idontwants.clear(),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:e,connection:t}){if(!this.isStarted())return;let r=t.remotePeer;this.addPeer(r,t.direction,t.remoteAddr),this.createInboundStream(r,e),this.outboundInflightQueue.push({peerId:r,connection:t})}onPeerConnected(e,t){this.metrics?.newConnectionCount.inc({status:t.status}),this.isStarted()&&"open"===t.status&&(this.addPeer(e,t.direction,t.remoteAddr),this.outboundInflightQueue.push({peerId:e,connection:t}))}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}async createOutboundStream(e,t){if(!this.isStarted())return;let r=e.toString();if(this.peers.has(r)&&!this.streamsOutbound.has(r))try{let n=new Ku(await t.newStream(this.multicodecs,{runOnLimitedConnection:this.runOnLimitedConnection}),e=>{this.log.error("outbound pipe error",e)},{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",e),this.streamsOutbound.set(r,n);let i=n.protocol;i===Vd&&this.floodsubPeers.add(r),this.metrics?.peersPerProtocol.inc({protocol:i},1),this.subscriptions.size>0&&(this.log("send subscriptions to",r),this.sendSubscriptions(r,Array.from(this.subscriptions),!0))}catch(e){this.log.error("createOutboundStream error",e)}}createInboundStream(e,t){if(!this.isStarted())return;let r=e.toString();if(!this.peers.has(r))return;let n=this.streamsInbound.get(r);void 0!==n&&(this.log("replacing existing inbound steam %s",r),n.close().catch(e=>{this.log.error(e)})),this.log("create inbound stream %s",r);let i=new Kh(t,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(r,i),this.pipePeerReadStream(e,i.source).catch(e=>{this.log(e)})}addPeer(e,t,r){let n=e.toString();if(!this.peers.has(n)){this.log("new peer %p",e),this.peers.set(n,e),this.score.addPeer(n);let i=Kx(r);null!==i?this.score.addIP(n,i):this.log("Added peer has no IP in current address %s %s",n,r.toString()),this.outbound.has(n)||this.outbound.set(n,"outbound"===t)}}removePeer(e){let t=e.toString();if(!this.peers.has(t))return;this.log("delete peer %p",e),this.peers.delete(t);let r=this.streamsOutbound.get(t),n=this.streamsInbound.get(t);for(let e of(null!=r&&this.metrics?.peersPerProtocol.inc({protocol:r.protocol},-1),r?.close().catch(e=>{this.log.error(e)}),n?.close().catch(e=>{this.log.error(e)}),this.streamsOutbound.delete(t),this.streamsInbound.delete(t),this.topics.values()))e.delete(t);for(let[e,r]of this.mesh)r.delete(t)&&this.metrics?.onRemoveFromMesh(e,tG.Dc,1);for(let e of this.fanout.values())e.delete(t);this.floodsubPeers.delete(t),this.gossip.delete(t),this.control.delete(t),this.outbound.delete(t),this.idontwantCounts.delete(t),this.idontwants.delete(t),this.score.removePeer(t),this.acceptFromWhitelist.delete(t)}get started(){return this.status.code===tX.started}getMeshPeers(e){let t=this.mesh.get(e);return null!=t?Array.from(t):[]}getSubscribers(e){let t=this.topics.get(e);return(null!=t?Array.from(t):[]).map(e=>this.peers.get(e)??yT(e))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,t){try{await (0,lr.F)(t,async t=>{for await(let r of t)try{let t=r.subarray(),n=tU.decode(t,{limits:{subscriptions:this.decodeRpcLimits.maxSubscriptions,messages:this.decodeRpcLimits.maxMessages,control$:{ihave:this.decodeRpcLimits.maxIhaveMessageIDs,iwant:this.decodeRpcLimits.maxIwantMessageIDs,graft:this.decodeRpcLimits.maxControlMessages,prune:this.decodeRpcLimits.maxControlMessages,prune$:{peers:this.decodeRpcLimits.maxPeerInfos},idontwant:this.decodeRpcLimits.maxControlMessages,idontwant$:{messageIDs:this.decodeRpcLimits.maxIdontwantMessageIDs}}}});if(this.metrics?.onRpcRecv(n,t.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(e,n)}catch(e){this.metrics?.onRpcRecvError(),this.log(e)}else this.handleReceivedRpc(e,n).catch(e=>{this.metrics?.onRpcRecvError(),this.log(e)})}catch(e){this.metrics?.onRpcDataError(),this.log(e)}})}catch(t){this.metrics?.onPeerReadStreamError(),this.handlePeerReadStreamError(t,e)}}handlePeerReadStreamError(e,t){this.log.error(e),this.onPeerDisconnected(t)}async handleReceivedRpc(e,t){if(!this.acceptFrom(e.toString())){this.log("received message from unacceptable peer %p",e),this.metrics?.rpcRecvNotAccepted.inc();return}let r=null!=t.subscriptions?t.subscriptions.length:0,n=null!=t.messages?t.messages.length:0,i=0,s=0,o=0,a=0;if(null!=t.control&&(null!=t.control.ihave&&(i=t.control.ihave.length),null!=t.control.iwant&&(s=t.control.iwant.length),null!=t.control.graft&&(o=t.control.graft.length),null!=t.control.prune&&(a=t.control.prune.length)),this.log(`rpc.from ${e.toString()} subscriptions ${r} messages ${n} ihave ${i} iwant ${s} graft ${o} prune ${a}`),null!=t.subscriptions&&t.subscriptions.length>0){let r=[];t.subscriptions.forEach(t=>{let n=t.topic,i=!0===t.subscribe;if(null!=n){if(null!=this.allowedTopics&&!this.allowedTopics.has(n))return;this.handleReceivedSubscription(e,n,i),r.push({topic:n,subscribe:i})}}),this.safeDispatchEvent("subscription-change",{detail:{peerId:e,subscriptions:r}})}for(let r of t.messages){if(null!=this.allowedTopics&&!this.allowedTopics.has(r.topic))continue;let t=this.handleReceivedMessage(e,r).catch(e=>{this.metrics?.onMsgRecvError(r.topic),this.log(e)});this.opts.awaitRpcMessageHandler&&await t}null!=t.control&&await this.handleControlMessage(e.toString(),t.control)}handleReceivedSubscription(e,t,r){this.log("subscription update from %p topic %s",e,t);let n=this.topics.get(t);null==n&&(n=new Set,this.topics.set(t,n)),r?n.add(e.toString()):n.delete(e.toString())}async handleReceivedMessage(e,t){this.metrics?.onMsgRecvPreValidation(t.topic);let r=await this.validateReceivedMessage(e,t);this.metrics?.onPrevalidationResult(t.topic,r.code);let n=r.code;switch(n){case tz.duplicate:this.score.duplicateMessage(e.toString(),r.msgIdStr,t.topic),this.gossipTracer.deliverMessage(r.msgIdStr,!0),this.mcache.observeDuplicate(r.msgIdStr,e.toString());return;case tz.invalid:if(null!=r.msgIdStr){let n=r.msgIdStr;this.score.rejectMessage(e.toString(),n,t.topic,r.reason),this.gossipTracer.rejectMessage(n,r.reason)}else this.score.rejectInvalidMessage(e.toString(),t.topic);this.metrics?.onMsgRecvInvalid(t.topic,r);return;case tz.valid:this.score.validateMessage(r.messageId.msgIdStr),this.gossipTracer.deliverMessage(r.messageId.msgIdStr),this.mcache.put(r.messageId,t,!this.opts.asyncValidation),this.subscriptions.has(t.topic)&&(!this.components.peerId.equals(e)||this.opts.emitSelf)&&(super.dispatchEvent(new CustomEvent("gossipsub:message",{detail:{propagationSource:e,msgId:r.messageId.msgIdStr,msg:r.msg}})),super.dispatchEvent(new CustomEvent("message",{detail:r.msg}))),this.opts.asyncValidation||this.forwardMessage(r.messageId.msgIdStr,t,e.toString());break;default:throw Error(`Invalid validation result: ${n}`)}}async validateReceivedMessage(e,t){let r=this.fastMsgIdFn?.(t),n=void 0!==r?this.fastMsgIdCache?.get(r):void 0;if(null!=n)return{code:tz.duplicate,msgIdStr:n};let i=await Kg(this.globalSignaturePolicy,t);if(!i.valid)return{code:tz.invalid,reason:tH.Error,error:i.error};let s=i.message;try{null!=this.dataTransform&&(s.data=this.dataTransform.inboundTransform(t.topic,s.data))}catch(e){return this.log("Invalid message, transform failed",e),{code:tz.invalid,reason:tH.Error,error:tq.TransformFailed}}let o=await this.msgIdFn(s),a=this.msgIdToStrFn(o),l={msgId:o,msgIdStr:a};if(void 0!==r&&null!=this.fastMsgIdCache&&this.fastMsgIdCache.put(r,a)&&this.metrics?.fastMsgIdCacheCollision.inc(),this.seenCache.has(a))return{code:tz.duplicate,msgIdStr:a};this.seenCache.put(a),(t.data?.length??0)>=this.opts.idontwantMinDataSize&&this.sendIDontWants(o,t.topic,e.toString());let c=this.topicValidators.get(t.topic);if(null!=c){let t;try{t=await c(e,s)}catch(r){let e=r.code;e===Vz&&(t=tL.Ignore),t=e===Vq?tL.Reject:tL.Ignore}if(t!==tL.Accept)return{code:tz.invalid,reason:V0(t),msgIdStr:a}}return{code:tz.valid,messageId:l,msg:s}}getScore(e){return this.score.score(e)}sendSubscriptions(e,t,r){this.sendRpc(e,{subscriptions:t.map(e=>({topic:e,subscribe:r})),messages:[]})}async handleControlMessage(e,t){if(void 0===t)return;let r=t.ihave?.length>0?this.handleIHave(e,t.ihave):[],n=t.iwant?.length>0?this.handleIWant(e,t.iwant):[],i=t.graft?.length>0?await this.handleGraft(e,t.graft):[];if(t.prune?.length>0&&await this.handlePrune(e,t.prune),t.idontwant?.length>0&&this.handleIdontwant(e,t.idontwant),0===r.length&&0===n.length&&0===i.length)return;let s=this.sendRpc(e,Km(n,{iwant:r,prune:i})),o=r[0]?.messageIDs;null!=o&&(s?this.gossipTracer.addPromise(e,o):this.metrics?.iwantPromiseUntracked.inc(1))}acceptFrom(e){if(this.direct.has(e))return!0;let t=Date.now(),r=this.acceptFromWhitelist.get(e);if(null!=r&&r.messagesAccepted<VK&&r.acceptUntil>=t)return r.messagesAccepted+=1,!0;let n=this.score.score(e);return n>=VV?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:t+VG}):this.acceptFromWhitelist.delete(e),n>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,t){if(0===t.length)return[];let r=this.score.score(e);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,r),this.metrics?.ihaveRcvIgnored.inc({reason:tQ.LowScore}),[];let n=(this.peerhave.get(e)??0)+1;if(this.peerhave.set(e,n),n>VU)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,n),this.metrics?.ihaveRcvIgnored.inc({reason:tQ.MaxIhave}),[];let i=this.iasked.get(e)??0;if(i>=VF)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,i),this.metrics?.ihaveRcvIgnored.inc({reason:tQ.MaxIasked}),[];let s=new Map;if(t.forEach(({topicID:e,messageIDs:t})=>{if(null==e||null==t||!this.mesh.has(e))return;let r=0;t.forEach(e=>{let t=this.msgIdToStrFn(e);!this.seenCache.has(t)&&(s.set(t,e),r++)}),this.metrics?.onIhaveRcv(e,t.length,r)}),0===s.size)return[];let o=s.size;o+i>VF&&(o=VF-i),this.log("IHAVE: Asking for %d out of %d messages from %s",o,s.size,e);let a=Array.from(s.values());return Kw(a),a=a.slice(0,o),this.iasked.set(e,i+o),[{messageIDs:a}]}handleIWant(e,t){if(0===t.length)return[];let r=this.score.score(e);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,r),[];let n=new Map,i=new Map,s=0;return(t.forEach(({messageIDs:t})=>{t?.forEach(t=>{let r=this.msgIdToStrFn(t),o=this.mcache.getWithIWantCount(r,e);return null==o?void s++:(i.set(o.msg.topic,1+(i.get(o.msg.topic)??0)),o.count>Vk)?void this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,t):void n.set(r,o.msg)})}),this.metrics?.onIwantRcv(i,s),0===n.size)?(this.log("IWANT: Could not provide any wanted messages to %s",e),[]):(this.log("IWANT: Sending %d messages to %s",n.size,e),Array.from(n.values()))}async handleGraft(e,t){let r=[],n=this.score.score(e),i=Date.now(),s=this.opts.doPX;if(t.forEach(({topicID:t})=>{if(null==t)return;let o=this.mesh.get(t);if(null==o){s=!1;return}if(o.has(e))return;let a=this.backoff.get(t)?.get(e);this.direct.has(e)?(this.log("GRAFT: ignoring request from direct peer %s",e),r.push(t),s=!1):"number"==typeof a&&i<a?(this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,tW.GraftBackoff),s=!1,i<a+this.opts.graftFloodThreshold-this.opts.pruneBackoff&&this.score.addPenalty(e,1,tW.GraftBackoff),this.addBackoff(e,t),r.push(t)):n<0?(this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,n,t),r.push(t),s=!1,this.addBackoff(e,t)):o.size>=this.opts.Dhi&&!this.outbound.get(e)?(r.push(t),this.addBackoff(e,t)):(this.log("GRAFT: Add mesh link from %s in %s",e,t),this.score.graft(e,t),o.add(e),this.metrics?.onAddToMesh(t,tK.Subscribed,1)),this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:e,topic:t,direction:"inbound"}})}),0===r.length)return[];let o=!1;return Promise.all(r.map(async t=>this.makePrune(e,t,s,o)))}async handlePrune(e,t){let r=this.score.score(e);for(let{topicID:n,backoff:i,peers:s}of t){if(null==n)continue;let t=this.mesh.get(n);if(null==t)return;this.log("PRUNE: Remove mesh link to %s in %s",e,n),this.score.prune(e,n),t.has(e)&&(t.delete(e),this.metrics?.onRemoveFromMesh(n,tG.Prune,1)),"number"==typeof i&&i>0?this.doAddBackoff(e,n,1e3*i):this.addBackoff(e,n),null!=s&&s.length>0&&(r<this.opts.scoreThresholds.acceptPXThreshold?this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,r,n):await this.pxConnect(s)),this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:e,topic:n,direction:"inbound"}})}}handleIdontwant(e,t){let r=this.idontwantCounts.get(e)??0;if(r>=this.opts.idontwantMaxMessages)return;let n=r,i=this.idontwants.get(e);null==i&&(i=new Map,this.idontwants.set(e,i));let s=0;e:for(let{messageIDs:e}of t)for(let t of e){if(r>=this.opts.idontwantMaxMessages)break e;r++;let e=this.msgIdToStrFn(t);i.set(e,this.heartbeatTicks),!this.mcache.msgs.has(e)&&s++}this.idontwantCounts.set(e,r);let o=r-n;this.metrics?.onIdontwantRcv(o,s)}addBackoff(e,t){this.doAddBackoff(e,t,this.opts.pruneBackoff)}doAddBackoff(e,t,r){let n=this.backoff.get(t);null==n&&(n=new Map,this.backoff.set(t,n));let i=Date.now()+r;(n.get(e)??0)<i&&n.set(e,i)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((e,t)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",t,e),this.score.addPenalty(t,e,tW.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%VO!=0)return;let e=Date.now();this.backoff.forEach((t,r)=>{t.forEach((r,n)=>{r+VQ*this.opts.heartbeatInterval<e&&t.delete(n)}),0===t.size&&this.backoff.delete(r)})}async directConnect(){let e=[];this.direct.forEach(t=>{this.streamsOutbound.has(t)||e.push(t)}),await Promise.all(e.map(async e=>this.connect(e)))}async pxConnect(e){e.length>this.opts.prunePeers&&(Kw(e),e=e.slice(0,this.opts.prunePeers));let t=[];await Promise.all(e.map(async e=>{if(null==e.peerID)return;let r=yO(aG.decode(e.peerID)),n=r.toString();if(!this.peers.has(n)){if(null==e.signedPeerRecord)return void t.push(n);try{if(!await this.components.peerStore.consumePeerRecord(e.signedPeerRecord,r))return void this.log("bogus peer record obtained through px: could not add peer record to address book");t.push(n)}catch(e){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),0!==t.length&&await Promise.all(t.map(async e=>this.connect(e)))}async connect(e){this.log("Initiating connection with %s",e);let t=yT(e),r=await this.components.connectionManager.openConnection(t);for(let e of this.multicodecs)for(let n of this.components.registrar.getTopologies(e))n.onConnect?.(t,r)}subscribe(e){if(this.status.code!==tX.started)throw Error("Pubsub has not started");if(!this.subscriptions.has(e))for(let t of(this.subscriptions.add(e),this.peers.keys()))this.sendSubscriptions(t,[e],!0);this.join(e)}unsubscribe(e){if(this.status.code!==tX.started)throw Error("Pubsub is not started");let t=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,t),t)for(let t of this.peers.keys())this.sendSubscriptions(t,[e],!1);this.leave(e)}join(e){if(this.status.code!==tX.started)throw Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),this.metrics?.onJoin(e);let t=new Set,r=this.backoff.get(e),n=this.fanout.get(e);if(null!=n&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),n.forEach(e=>{!this.direct.has(e)&&this.score.score(e)>=0&&r?.has(e)!==!0&&t.add(e)}),this.metrics?.onAddToMesh(e,tK.Fanout,t.size)),t.size<this.opts.D){let n=t.size;this.getRandomGossipPeers(e,this.opts.D,e=>!t.has(e)&&!this.direct.has(e)&&this.score.score(e)>=0&&r?.has(e)!==!0).forEach(e=>{t.add(e)}),this.metrics?.onAddToMesh(e,tK.Random,t.size-n)}this.mesh.set(e,t),t.forEach(t=>{this.log("JOIN: Add mesh link to %s in %s",t,e),this.sendGraft(t,e)})}leave(e){if(this.status.code!==tX.started)throw Error("Gossipsub has not started");this.log("LEAVE %s",e),this.metrics?.onLeave(e);let t=this.mesh.get(e);null!=t&&(Promise.all(Array.from(t).map(async t=>{this.log("LEAVE: Remove mesh link to %s in %s",t,e),await this.sendPrune(t,e)})).catch(e=>{this.log("Error sending prunes to mesh peers",e)}),this.mesh.delete(e))}selectPeersToForward(e,t,r){let n=new Set,i=this.topics.get(e);null!=i&&(this.direct.forEach(e=>{i.has(e)&&t!==e&&!r?.has(e)&&n.add(e)}),this.floodsubPeers.forEach(e=>{i.has(e)&&t!==e&&!r?.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&n.add(e)}));let s=this.mesh.get(e);return null!=s&&s.size>0&&s.forEach(e=>{t===e||r?.has(e)||n.add(e)}),n}selectPeersToPublish(e){let t=new Set,r={direct:0,floodsub:0,mesh:0,fanout:0},n=this.topics.get(e);if(null!=n)if(this.opts.floodPublish)n.forEach(e=>{this.direct.has(e)?(t.add(e),r.direct++):this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),r.floodsub++)});else{this.direct.forEach(e=>{n.has(e)&&(t.add(e),r.direct++)}),this.floodsubPeers.forEach(e=>{n.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),r.floodsub++)});let i=this.mesh.get(e);if(null!=i&&i.size>0)i.forEach(e=>{t.add(e),r.mesh++}),i.size<this.opts.D&&this.getRandomGossipPeers(e,this.opts.D-i.size,e=>!i.has(e)&&!this.direct.has(e)&&!this.floodsubPeers.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold).forEach(e=>{t.add(e),r.mesh++});else{let n=this.fanout.get(e);if(null!=n&&n.size>0)n.forEach(e=>{t.add(e),r.fanout++});else{let n=this.getRandomGossipPeers(e,this.opts.D,e=>this.score.score(e)>=this.opts.scoreThresholds.publishThreshold);n.size>0&&(this.fanout.set(e,n),n.forEach(e=>{t.add(e),r.fanout++}))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:t,tosendCount:r}}forwardMessage(e,t,r,n){null!=r&&this.score.deliverMessage(r,e,t.topic);let i=this.selectPeersToForward(t.topic,r,n);i.forEach(e=>{this.sendRpc(e,Km([t]))}),this.metrics?.onForwardMsg(t.topic,i.size)}async publish(e,t,r){let n=Date.now(),i=null!=this.dataTransform?this.dataTransform.outboundTransform(e,t):t;if(null==this.publishConfig)throw Error("PublishError.Uninitialized");let{raw:s,msg:o}=await Kp(this.publishConfig,e,t,i),a=await this.msgIdFn(o),l=this.msgIdToStrFn(a),c=r?.ignoreDuplicatePublishError??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(l)){if(c)return this.metrics?.onPublishDuplicateMsg(e),{recipients:[]};throw Error("PublishError.Duplicate")}let{tosend:u,tosendCount:h}=this.selectPeersToPublish(e),d=this.opts.emitSelf&&this.subscriptions.has(e),f=r?.allowPublishToZeroTopicPeers??this.opts.allowPublishToZeroTopicPeers;if(0===u.size&&!f&&!d)throw Error("PublishError.NoPeersSubscribedToTopic");this.seenCache.put(l),this.mcache.put({msgId:a,msgIdStr:l},s,!0),this.publishedMessageIds.put(l);let p=r?.batchPublish??this.opts.batchPublish,g=Km([s]);if(p)this.sendRpcInBatch(u,g);else for(let e of u)this.sendRpc(e,g)||u.delete(e);let m=Date.now()-n;return this.metrics?.onPublishMsg(e,h,u.size,null!=s.data?s.data.length:0,m),d&&(u.add(this.components.peerId.toString()),super.dispatchEvent(new CustomEvent("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:l,msg:o}})),super.dispatchEvent(new CustomEvent("message",{detail:o}))),{recipients:Array.from(u.values()).map(e=>this.peers.get(e)??yT(e))}}sendRpcInBatch(e,t){let r=tU.encode(t),n=Vn.single(r);for(let i of e){let s=this.streamsOutbound.get(i);if(null==s){this.log(`Cannot send RPC to ${i} as there is no open stream to it available`),e.delete(i);continue}try{s.pushPrefixed(n)}catch(t){e.delete(i),this.log.error(`Cannot send rpc to ${i}`,t)}this.metrics?.onRpcSent(t,r.length)}}reportMessageValidationResult(e,t,r){let n;if(r===tL.Accept){if(null!=(n=this.mcache.validate(e))){let{message:r,originatingPeers:i}=n;this.score.deliverMessage(t,e,r.topic),this.forwardMessage(e,n.message,t,i)}}else if(null!=(n=this.mcache.remove(e))){let i=V0(r),{message:s,originatingPeers:o}=n;for(let r of(this.score.rejectMessage(t,e,s.topic,i),o))this.score.rejectMessage(r,e,s.topic,i)}let i=this.score.messageFirstSeenTimestampMs(e);this.metrics?.onReportValidation(n,r,i)}sendGraft(e,t){let r=Km([],{graft:[{topicID:t}]});this.sendRpc(e,r)}async sendPrune(e,t){let r=!0,n=Km([],{prune:[await this.makePrune(e,t,this.opts.doPX,r)]});this.sendRpc(e,n)}sendIDontWants(e,t,r){let n=this.mesh.get(t);if(null==n)return;let i=new Set(n);for(let e of(i.delete(r),i))this.streamsOutbound.get(e)?.protocol!==Vg&&i.delete(e);let s=Km([],{idontwant:[{messageIDs:[e]}]});this.sendRpcInBatch(i,s)}sendRpc(e,t){let r=this.streamsOutbound.get(e);if(null==r)return this.log(`Cannot send RPC to ${e} as there is no open stream to it available`),!1;let n=this.control.get(e);null!=n&&(this.piggybackControl(e,t,n),this.control.delete(e));let i=this.gossip.get(e);null!=i&&(this.piggybackGossip(e,t,i),this.gossip.delete(e));let s=tU.encode(t);try{r.push(s)}catch(t){return this.log.error(`Cannot send rpc to ${e}`,t),null!=n&&this.control.set(e,n),null!=i&&this.gossip.set(e,i),!1}if(this.metrics?.onRpcSent(t,s.length),t.control?.graft!=null)for(let r of t.control?.graft)null!=r.topicID&&this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:e,topic:r.topicID,direction:"outbound"}});if(t.control?.prune!=null)for(let r of t.control?.prune)null!=r.topicID&&this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:e,topic:r.topicID,direction:"outbound"}});return!0}piggybackControl(e,t,r){let n=Ky(t);for(let t of r.graft)null!=t.topicID&&this.mesh.get(t.topicID)?.has(e)&&n.control.graft.push(t);for(let t of r.prune)null==t.topicID||this.mesh.get(t.topicID)?.has(e)||n.control.prune.push(t)}piggybackGossip(e,t,r){Ky(t).control.ihave=r}async sendGraftPrune(e,t,r){let n=this.opts.doPX,i=!1;for(let[s,o]of e){let e=o.map(e=>({topicID:e})),a=[],l=t.get(s);null!=l&&(a=await Promise.all(l.map(async e=>this.makePrune(s,e,n&&!r.get(s),i))),t.delete(s)),this.sendRpc(s,Km([],{graft:e,prune:a}))}for(let[e,s]of t){let t=await Promise.all(s.map(async t=>this.makePrune(e,t,n&&!r.get(e),i)));this.sendRpc(e,Km([],{prune:t}))}}emitGossip(e){let t=this.mcache.getGossipIDs(new Set(e.keys()));for(let[r,n]of e)this.doEmitGossip(r,n,t.get(r)??[])}doEmitGossip(e,t,r){if(0===r.length||(Kw(r),r.length>VF&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",r.length),0===t.size))return;let n=this.opts.Dlazy,i=this.opts.gossipFactor*t.size,s=t;i>n&&(n=i),n>s.size?n=s.size:s=Kw(Array.from(s)).slice(0,n),s.forEach(t=>{let n=r;r.length>VF&&(n=Kw(n.slice()).slice(0,VF)),this.pushGossip(t,{topicID:e,messageIDs:n})})}flush(){for(let[e,t]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,Km([],{ihave:t}));for(let[e,t]of this.control.entries()){this.control.delete(e);let r=Km([],{graft:t.graft,prune:t.prune});this.sendRpc(e,r)}}pushGossip(e,t){this.log("Add gossip to %s",e);let r=this.gossip.get(e)??[];this.gossip.set(e,r.concat(t))}async makePrune(e,t,r,n){if(this.score.prune(e,t),this.streamsOutbound.get(e)?.protocol===Vf)return{topicID:t,peers:[]};let i=n?this.opts.unsubcribeBackoff:this.opts.pruneBackoff,s=i/1e3;if(this.doAddBackoff(e,t,i),!r)return{topicID:t,peers:[],backoff:s};let o=this.getRandomGossipPeers(t,this.opts.prunePeers,t=>t!==e&&this.score.score(t)>=0);return{topicID:t,peers:await Promise.all(Array.from(o).map(async e=>{let t,r=this.peers.get(e)??yT(e);try{t=await this.components.peerStore.get(r)}catch(e){if("NotFoundError"!==e.name)throw e}return{peerID:r.toMultihash().bytes,signedPeerRecord:t?.peerRecordEnvelope}})),backoff:s}}runHeartbeat=()=>{let e=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch(e=>{this.log("Error running heartbeat",e)}).finally(()=>{if(null!=e&&e(),this.status.code===tX.started){clearTimeout(this.status.heartbeatTimeout);let e=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;e<.25*this.opts.heartbeatInterval&&(e+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,e)}})};async heartbeat(){let{D:e,Dlo:t,Dhi:r,Dscore:n,Dout:i,fanoutTTL:s}=this.opts;this.heartbeatTicks++;let o=new Map,a=e=>{let t=o.get(e);return void 0===t&&(t=this.score.score(e),o.set(e,t)),t},l=new Map,c=new Map,u=new Map;for(let e of(this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.idontwantCounts.clear(),this.idontwants.values()))for(let[t,r]of e)this.heartbeatTicks-r>=this.opts.mcacheLength&&e.delete(t);this.heartbeatTicks%this.opts.directConnectTicks==0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();let h=new Map;this.mesh.forEach((s,o)=>{let d=this.topics.get(o),f=new Set,p=new Set;if(h.set(o,p),null!=d){let e=Kw(Array.from(d)),t=this.backoff.get(o);for(let r of e){let e=this.streamsOutbound.get(r);if(null!=e&&this.multicodecs.includes(e.protocol)&&!s.has(r)&&!this.direct.has(r)){let e=a(r);t?.has(r)!==!0&&e>=0&&f.add(r),e>=this.opts.scoreThresholds.gossipThreshold&&p.add(r)}}}let g=(e,t)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",e,o),this.addBackoff(e,o),s.delete(e),a(e)>=this.opts.scoreThresholds.gossipThreshold&&p.add(e),this.metrics?.onRemoveFromMesh(o,t,1);let r=c.get(e);null==r?c.set(e,[o]):r.push(o)},m=(e,t)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",e,o),this.score.graft(e,o),s.add(e),p.delete(e),this.metrics?.onAddToMesh(o,t,1);let r=l.get(e);null==r?l.set(e,[o]):r.push(o)};if(s.forEach(e=>{let t=a(e);t<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",e,t,o),g(e,tG.BadScore),u.set(e,!0))}),s.size<t&&Kr(f,e-s.size).forEach(e=>{m(e,tK.NotEnough)}),s.size>r){let t=Array.from(s);t.sort((e,t)=>a(t)-a(e));let r=0;if((t=t.slice(0,n).concat(Kw(t.slice(n)))).slice(0,e).forEach(e=>{this.outbound.get(e)&&r++}),r<i){let n=e=>{let r=t[e];for(let r=e;r>0;r--)t[r]=t[r-1];t[0]=r};if(r>0){let i=r;for(let r=1;r<e&&i>0;r++)this.outbound.get(t[r])&&(n(r),i--)}let i=e-r;for(let r=e;r<t.length&&i>0;r++)this.outbound.get(t[r])&&(n(r),i--)}t.slice(e).forEach(e=>{g(e,tG.Excess)})}if(s.size>=t){let e=0;s.forEach(t=>{this.outbound.get(t)&&e++}),e<i&&Kt(f,i-e,e=>!0===this.outbound.get(e)).forEach(e=>{m(e,tK.Outbound)})}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks==0&&s.size>1){let e=Array.from(s).sort((e,t)=>a(e)-a(t)),t=a(e[Math.floor(s.size/2)]);if(t<this.opts.scoreThresholds.opportunisticGraftThreshold)for(let e of Kt(f,this.opts.opportunisticGraftPeers,e=>a(e)>t))this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",e,o),m(e,tK.Opportunistic)}});let d=Date.now();this.fanoutLastpub.forEach((e,t)=>{e+s<d&&(this.fanout.delete(t),this.fanoutLastpub.delete(t))}),this.fanout.forEach((t,r)=>{let n=this.topics.get(r);t.forEach(e=>{(!n?.has(e)||a(e)<this.opts.scoreThresholds.publishThreshold)&&t.delete(e)});let i=this.topics.get(r),s=[],o=new Set;if(h.set(r,o),null!=i)for(let e of Kw(Array.from(i))){let r=this.streamsOutbound.get(e);if(null!=r&&this.multicodecs.includes(r.protocol)&&!t.has(e)&&!this.direct.has(e)){let t=a(e);t>=this.opts.scoreThresholds.publishThreshold&&s.push(e),t>=this.opts.scoreThresholds.gossipThreshold&&o.add(e)}}if(t.size<e){let r=e-t.size;s.slice(0,r).forEach(e=>{t.add(e),o?.delete(e)})}}),this.emitGossip(h),await this.sendGraftPrune(l,c,u),this.flush(),this.mcache.shift(),this.dispatchEvent(new CustomEvent("gossipsub:heartbeat"))}getRandomGossipPeers(e,t,r=()=>!0){let n=this.topics.get(e);if(null==n)return new Set;let i=[];return n.forEach(e=>{let t=this.streamsOutbound.get(e);null!=t&&this.multicodecs.includes(t.protocol)&&r(e)&&i.push(e)}),i=Kw(i),t>0&&i.length>t&&(i=i.slice(0,t)),new Set(i)}onScrapeMetrics(e){e.mcacheSize.set(this.mcache.size),e.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),e.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let t=0,r=Date.now();for(let n of(e.connectedPeersBackoffSec.reset(),this.backoff.values()))for(let[i,s]of(t+=n.size,n.entries()))this.peers.has(i)&&e.connectedPeersBackoffSec.observe(Math.max(0,s-r)/1e3);e.cacheSize.set({cache:"backoff"},t);let n=0;for(let e of this.idontwants.values())n+=e.size;for(let[t,r]of(e.cacheSize.set({cache:"idontwants"},n),this.topics))e.topicPeersCount.set({topicStr:t},r.size);for(let[t,r]of this.mesh)e.meshPeerCounts.set({topicStr:t},r.size);let i=[],s=new Map;for(let t of(e.behaviourPenalty.reset(),this.peers.keys())){let r=this.score.score(t);i.push(r),s.set(t,r),e.behaviourPenalty.observe(this.score.peerStats.get(t)?.behaviourPenalty??0)}e.registerScores(i,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,s);let o=Kc(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(o)}tagMeshPeer=e=>{let{peerId:t,topic:r}=e.detail;this.components.peerStore.merge(this.peers.get(t)??yT(t),{tags:{[r]:{value:100}}}).catch(e=>{this.log.error("Error tagging peer %s with topic %s",t,r,e)})};untagMeshPeer=e=>{let{peerId:t,topic:r}=e.detail;this.components.peerStore.merge(this.peers.get(t)??yT(t),{tags:{[r]:void 0}}).catch(e=>{this.log.error("Error untagging peer %s with topic %s",t,r,e)})}}function KI(e={}){return t=>new K_(t,e)}class KC{certificate;constructor(){throw Error("Auto-TLS does not work in browsers")}}function KT(e={}){return t=>new KC(t,e)}function KP(e,t,r,n,i,s,o){let a=[];"0.0.0.0"!=t&&(a=[`/ip4/${t}/tcp/${r}`,`/ip4/${t}/tcp/${n}/ws`,`/ip4/${t}/tcp/${i}/tls/ws`,`/ip4/${t}/udp/${s}/webrtc-direct`]);let l=["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dnsaddr/va1.bootstrap.libp2p.io/p2p/12D3KooWKnDdG3iXw9eTFijk3EWSunZcFi54Zka4wmtqtt6rPxc8","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"];return l=l.concat(o),{addresses:{listen:[`/ip4/0.0.0.0/tcp/${r}`,`/ip4/0.0.0.0/tcp/${n}/ws`,`/ip4/0.0.0.0/tcp/${i}/ws`,`/ip4/0.0.0.0/udp/${s}/webrtc-direct`],appendAnnounce:a},transports:[z3(),$1(),Hc()],connectionEncrypters:[Ca()],streamMuxers:[CU()],connectionGater:{denyDialMultiaddr:()=>!1},peerDiscovery:[z7({interval:1e3,topics:[`${e}.astradb._peer-discovery._p2p._pubsub`],listenOnly:!1}),Ps({list:l})],services:{pubsub:KI({allowPublishToZeroTopicPeers:!0}),autoNAT:TO(),dcutr:PK(),delegatedRouting:()=>Tg("https://delegated-ipfs.dev",Tm()),dht:O6({protocol:"/ipfs/kad/1.0.0",peerInfoMapper:RB,clientMode:!0,validators:{ipns:Tn},selectors:{ipns:Hu}}),identify:P7(),identifyPush:P9(),ping:NP(),upnp:z5(),keychain:xc(),autoTLS:KT()}}}function KR(e,t){let r=["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dnsaddr/va1.bootstrap.libp2p.io/p2p/12D3KooWKnDdG3iXw9eTFijk3EWSunZcFi54Zka4wmtqtt6rPxc8","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"];return r=r.concat(t),{transports:[$1(),Hc()],connectionEncrypters:[Ca()],streamMuxers:[CU()],connectionGater:{denyDialMultiaddr:()=>!1},peerDiscovery:[z7({interval:1e3,topics:[`${e}.astradb._peer-discovery._p2p._pubsub`],listenOnly:!1}),Ps({list:r})],services:{pubsub:KI({allowPublishToZeroTopicPeers:!0}),autoNAT:TO(),dcutr:PK(),delegatedRouting:()=>Tg("https://delegated-ipfs.dev",Tm()),dht:O6({protocol:"/ipfs/kad/1.0.0",peerInfoMapper:RB,clientMode:!0,validators:{ipns:Tn},selectors:{ipns:Hu}}),identify:P7(),identifyPush:P9(),ping:NP()}}}let KO="user-id",KN=async(e,t,r,n,i,s,o,a,l,c,u)=>{let h,d="undefined"!=typeof window;d?console.log("Browser enviroment detected"):console.log("Node enviroment detected");let f=await xu(r);h=d?KR(e,u):KP(e,i,s,o,a,l,u);let p=await _D({datastore:r,privateKey:f,...h});p.addEventListener("certificate:provision",()=>{console.info("A TLS certificate was provisioned")});let g=await Hb({datastore:r,blockstore:n,libp2p:p});console.log(`Node started with id: ${g.libp2p.peerId.toString()}`);let m=await KM(t,g,c),y=await z1({ipfs:g,directory:c,identities:m,id:KO});for(let e of(console.log("Peer multiaddrs:"),y.ipfs.libp2p.getMultiaddrs()))console.log(`${e}`);let b=[];return y.ipfs.libp2p.addEventListener("self:peer:update",e=>{let t=y.ipfs.libp2p.getMultiaddrs();if(JSON.stringify(b)!==JSON.stringify(t)){for(let e of(console.log("Peer multiaddrs changed:"),t))console.log(`${e}`);b=t}}),y};async function KD(e){let t=e.keystore,r=(await t.getKey(KO)).raw;return(0,uh.d)(r,"base32")}function KB(e){return e.identity.publicKey}async function KM(e,t,r){let n=await zy({path:`${r}/keystore`});if(e){console.log("Login key provided, using existing identity");let t=yd((0,nm.s)(e,"base32"));await n.addKey(KO,{privateKey:t.raw})}else console.log("No login key provided, creating new identity"),await n.createKey(KO);return await zO({ipfs:t,keystore:n})}class KL extends Error{constructor(e){super(e),this.name="SyncTimeoutError"}}class KF{dbName;orbitdb;openDb;entriesSeen;events;onUpdate;constructor(e,t,r,n){this.dbName=e,this.orbitdb=t,this.entriesSeen=new Set,this.events=r,this.onUpdate=n}async initNew(){await this.createDatabase(),await this.setupDbEvents(),await this.updateDatabase()}async initExisting(){await this.createDatabase();let e=await this.syncDb();return await this.setupDbEvents(),await this.updateDatabase(),e}async add(e){let t=await this.openDb.add(e);await this.newEntryAdded(t,e)}async getAll(){return(await this.openDb.all()).map(e=>e.value)}async createDatabase(){let e=await qW(await q2({size:1e3}),await qJ({ipfs:this.orbitdb.ipfs,pin:!0})),t=await this.orbitdb.open(this.dbName,{AccessController:zK({write:["*"],storage:e})});this.openDb=t}async syncDb(){let e=!1,t=async(t,r)=>{console.log(`Database ${this.openDb.address} synced with peer ${t}`),e=!0};this.openDb.events.on("join",t);try{await this.waitFor(async()=>e,async()=>!0)}catch(e){if(e instanceof KL)return console.log("Warning: Timeout received. Database was not synced with any provider. Asuming it is a new database with no providers."),!1;throw e}return!0}async waitFor(e,t,r=100,n=2e4){return new Promise((i,s)=>{let o=0,a=setInterval(async()=>{await e()===await t()&&(clearInterval(a),i()),(o+=r)>=n&&(clearInterval(a),s(new KL("Timeout waiting for condition")))},r)})}async setupDbEvents(){this.openDb.events.on("update",async e=>{await this.updateDatabase()}),this.openDb.events.on("join",async(e,t)=>{console.log(`${e} joined the database ${this.dbName}`)})}async updateDatabase(){for await(let e of this.openDb.iterator()){let t=e.hash;this.entriesSeen.has(t)||await this.newEntryAdded(t,e.value)}}async newEntryAdded(e,t){this.entriesSeen.add(e),this.onUpdate&&this.onUpdate(t),this.events.emit(`${this.dbName}`,t),console.log(`New entry added to the database ${this.dbName}`)}}let KU=Error("timeout while waiting for mutex to become available"),Kj=(Error("mutex already locked"),Error("request for lock canceled"));var K$=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class KH{constructor(e,t=Kj){this._value=e,this._cancelError=t,this._queue=[],this._weightedWaiters=[]}acquire(e=1,t=0){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);return new Promise((r,n)=>{let i={resolve:r,reject:n,weight:e,priority:t},s=Kz(this._queue,e=>t<=e.priority);-1===s&&e<=this._value?this._dispatchItem(i):this._queue.splice(s+1,0,i)})}runExclusive(e){return K$(this,arguments,void 0,function*(e,t=1,r=0){let[n,i]=yield this.acquire(t,r);try{return yield e(n)}finally{i()}})}waitForUnlock(e=1,t=0){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,t)?Promise.resolve():new Promise(r=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),Kq(this._weightedWaiters[e-1],{resolve:r,priority:t})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){let t=this._value;this._value-=e.weight,e.resolve([t,this._newReleaser(e.weight)])}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){if(0===this._queue.length)for(let e=this._value;e>0;e--){let t=this._weightedWaiters[e-1];t&&(t.forEach(e=>e.resolve()),this._weightedWaiters[e-1]=[])}else{let e=this._queue[0].priority;for(let t=this._value;t>0;t--){let r=this._weightedWaiters[t-1];if(!r)continue;let n=r.findIndex(t=>t.priority<=e);(-1===n?r:r.splice(0,n)).forEach(e=>e.resolve())}}}_couldLockImmediately(e,t){return(0===this._queue.length||this._queue[0].priority<t)&&e<=this._value}}function Kq(e,t){let r=Kz(e,e=>t.priority<=e.priority);e.splice(r+1,0,t)}function Kz(e,t){for(let r=e.length-1;r>=0;r--)if(t(e[r]))return r;return -1}var KV=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};class KK{constructor(e){this._semaphore=new KH(1,e)}acquire(){return KV(this,arguments,void 0,function*(e=0){let[,t]=yield this._semaphore.acquire(1,e);return t})}runExclusive(e,t=0){return this._semaphore.runExclusive(()=>e(),1,t)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(e=0){return this._semaphore.waitForUnlock(1,e)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}var KG=function(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):i(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})};function KW(e){return void 0!==e.getValue}class KQ{dbName;orbitdb;isCollaborator;keyDb;keys;keyDbs;events;mutex;constructor(e,t,r,n){this.dbName=e,this.orbitdb=t,this.isCollaborator=r,this.keys=new Set,this.keyDbs=new Map,this.events=n,this.mutex=new KK}async init(e){if(this.keyDb=new KF(this.dbName,this.orbitdb,this.events,this.newKeyAdded.bind(this)),this.isCollaborator||e)await this.keyDb.initNew();else if(!await this.keyDb.initExisting())throw Error("No providers found for the key repository database")}async add(e,t){await this.mutex.runExclusive(async()=>{this.keys.has(e)||(this.keys.add(e),await this.keyDb.add(e),console.log(`Key ${e} added to the key repository`));let r=await this.getValueDb(e,!1);await r.openDb.add(t),console.log(`New value appended to the key ${e}`)})}async get(e){return await this.mutex.runExclusive(async()=>{if(!this.keys.has(e))throw Error(`Key ${e} does not exist`);let t=await this.getValueDb(e,!0);return await t.getAll()})}async getAllKeys(){return await this.mutex.runExclusive(async()=>Array.from(this.keys))}async newKeyAdded(e){await this.mutex.runExclusive(async()=>{if(this.keys.add(e),this.isCollaborator){let t=new KF(`${this.dbName}::${e}`,this.orbitdb,this.events);await t.initNew(),this.keyDbs.set(e,t),console.log(`Key ${e} replicated`)}})}async getValueDb(e,t){let r;return this.keyDbs.has(e)?r=this.keyDbs.get(e):(r=new KF(`${this.dbName}::${e}`,this.orbitdb,this.events),t?await r.initExisting():await r.initNew(),this.keyDbs.set(e,r)),r}}class KJ{dbName;orbitdb;connectionManager;keyRepository;events;constructor(e){this.dbName=e,this.events=new Hw}async init(e){let t=`${e.dataDir}/astradb`;this.orbitdb=await KN(this.dbName,e.loginKey,e.datastore,e.blockstore,e.publicIp,e.tcpPort,e.wsPort,e.wssPort,e.webRTCDirectPort,t,e.bootstrapPeers),e.offlineMode?console.log("Offline mode enabled"):(this.connectionManager=new ui(this.dbName,this.orbitdb.ipfs),await this.connectionManager.init(e.isCollaborator)),this.keyRepository=new KQ(this.dbName,this.orbitdb,e.isCollaborator,this.events),await this.keyRepository.init(e.offlineMode)}async add(e,t){await this.keyRepository.add(e,t)}async get(e){return await this.keyRepository.get(e)}async getAllKeys(){return await this.keyRepository.getAllKeys()}getLoginPublicKey(){return KB(this.orbitdb)}async getLoginPrivateKey(){return await KD(this.orbitdb)}}async function KZ(e={}){if(!e.dbName)throw Error("dbName is required");if(e.isCollaborator&&(!e.datastore||!e.blockstore))throw Error("A collaborator node must use a persistent datastore and blockstore.");e.isCollaborator=e.isCollaborator??!1,e.loginKey=e.loginKey??"",e.datastore=e.datastore??new vJ.bk,e.blockstore=e.blockstore??new vQ.ED,e.publicIp=e.publicIp??"0.0.0.0",e.tcpPort=e.tcpPort??40001,e.wsPort=e.wsPort??40002,e.wssPort=e.wssPort??40003,e.webRTCDirectPort=e.webRTCDirectPort??40001,e.dataDir=e.dataDir??"./data",e.bootstrapPeers=e.bootstrapPeers??[],e.offlineMode=e.offlineMode??!1;let t=new KJ(e.dbName);return await t.init(e),t}},22846:(e,t,r)=>{"use strict";let{Buffer:n}=r(44134)||{},{Encoding:i}=r(69503),s=r(77697);class o extends i{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new a({encode:this.encode,decode:e=>this.decode(n.from(e.buffer,e.byteOffset,e.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}}class a extends i{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new o({encode:e=>{let t=this.encode(e);return n.from(t.buffer,t.byteOffset,t.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}}class l extends i{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new o({encode:e=>n.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){let{textEncoder:e,textDecoder:t}=s();return new a({encode:t=>e.encode(this.encode(t)),decode:e=>this.decode(t.decode(e)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}}t.BufferFormat=o,t.ViewFormat=a,t.UTF8Format=l},22938:(e,t,r)=>{"use strict";r.d(t,{s:()=>i});var n=r(2629);function i(e,t="utf8"){let r=n.A[t];if(null==r)throw Error(`Unsupported encoding "${t}"`);return r.decoder.decode(`${r.prefix}${e}`)}},24658:(e,t,r)=>{"use strict";let n=r(4160);class i{constructor(e,t,r){let i=this;this._started=n(),this._rescheduled=0,this._scheduled=t,this._args=r,this._triggered=!1,this._timerWrapper=()=>{i._rescheduled>0?(i._scheduled=i._rescheduled-(n()-i._started),i._schedule(i._scheduled)):(i._triggered=!0,e.apply(null,i._args))},this._timer=setTimeout(this._timerWrapper,t)}reschedule(e){e||(e=this._scheduled);let t=n();t+e-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(e)):this._triggered?this._schedule(e):(this._started=t,this._rescheduled=e)}_schedule(e){this._triggered=!1,this._started=n(),this._rescheduled=0,this._scheduled=e,this._timer=setTimeout(this._timerWrapper,e)}clear(){clearTimeout(this._timer)}}e.exports=function(){let e;if("function"!=typeof arguments[0])throw Error("callback needed");if("number"!=typeof arguments[1])throw Error("timeout needed");if(arguments.length>0){e=Array(arguments.length-2);for(var t=0;t<e.length;t++)e[t]=arguments[t+2]}return new i(arguments[0],arguments[1],e)}},24747:e=>{"use strict";e.exports=ReferenceError},24802:(e,t,r)=>{"use strict";function n(e){return null!=e[Symbol.asyncIterator]}r.d(t,{A:()=>i});let i=function(e){if(n(e))return(async()=>{for await(let t of e);})();for(let t of e);}},25519:(e,t,r)=>{"use strict";r.d(t,{n:()=>d});var n=r(12115),i=r(6101),s=r(63655),o=r(39033),a=r(95155),l="focusScope.autoFocusOnMount",c="focusScope.autoFocusOnUnmount",u={bubbles:!1,cancelable:!0},h="FocusScope",d=n.forwardRef((e,t)=>{let{loop:r=!1,trapped:h=!1,onMountAutoFocus:d,onUnmountAutoFocus:m,...y}=e,[b,E]=n.useState(null),A=(0,o.c)(d),S=(0,o.c)(m),k=n.useRef(null),_=(0,i.s)(t,e=>E(e)),I=n.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;n.useEffect(()=>{if(h){let e=function(e){if(I.paused||!b)return;let t=e.target;b.contains(t)?k.current=t:w(k.current,{select:!0})},t=function(e){if(I.paused||!b)return;let t=e.relatedTarget;null!==t&&(b.contains(t)||w(k.current,{select:!0}))},r=function(e){if(document.activeElement===document.body)for(let t of e)t.removedNodes.length>0&&w(b)};document.addEventListener("focusin",e),document.addEventListener("focusout",t);let n=new MutationObserver(r);return b&&n.observe(b,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),n.disconnect()}}},[h,b,I.paused]),n.useEffect(()=>{if(b){v.add(I);let e=document.activeElement;if(!b.contains(e)){let t=new CustomEvent(l,u);b.addEventListener(l,A),b.dispatchEvent(t),t.defaultPrevented||(f(x(g(b)),{select:!0}),document.activeElement===e&&w(b))}return()=>{b.removeEventListener(l,A),setTimeout(()=>{let t=new CustomEvent(c,u);b.addEventListener(c,S),b.dispatchEvent(t),t.defaultPrevented||w(null!=e?e:document.body,{select:!0}),b.removeEventListener(c,S),v.remove(I)},0)}}},[b,A,S,I]);let C=n.useCallback(e=>{if(!r&&!h||I.paused)return;let t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,n=document.activeElement;if(t&&n){let t=e.currentTarget,[i,s]=p(t);i&&s?e.shiftKey||n!==s?e.shiftKey&&n===i&&(e.preventDefault(),r&&w(s,{select:!0})):(e.preventDefault(),r&&w(i,{select:!0})):n===t&&e.preventDefault()}},[r,h,I.paused]);return(0,a.jsx)(s.sG.div,{tabIndex:-1,...y,ref:_,onKeyDown:C})});function f(e){let{select:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=document.activeElement;for(let n of e)if(w(n,{select:t}),document.activeElement!==r)return}function p(e){let t=g(e);return[m(t,e),m(t.reverse(),e)]}function g(e){let t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function m(e,t){for(let r of e)if(!y(r,{upTo:t}))return r}function y(e,t){let{upTo:r}=t;if("hidden"===getComputedStyle(e).visibility)return!0;for(;e&&(void 0===r||e!==r);){if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function b(e){return e instanceof HTMLInputElement&&"select"in e}function w(e){let{select:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&e.focus){let r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&b(e)&&t&&e.select()}}d.displayName=h;var v=E();function E(){let e=[];return{add(t){let r=e[0];t!==r&&(null==r||r.pause()),(e=A(e,t)).unshift(t)},remove(t){var r;null==(r=(e=A(e,t))[0])||r.resume()}}}function A(e,t){let r=[...e],n=r.indexOf(t);return -1!==n&&r.splice(n,1),r}function x(e){return e.filter(e=>"A"!==e.tagName)}},27744:(e,t,r)=>{"use strict";r.d(t,{Q:()=>h});var n=r(68250),i=r(31987),s=r(98897),o=r(76520),a=r(7786),l=r(76154),c=r(91295),u=r(59372);class h extends n.fD{db;opts;constructor(e,t={}){super(),this.db="string"==typeof e?new u.Level(e,{...t,keyEncoding:"utf8",valueEncoding:"view"}):e,this.opts={createIfMissing:!0,compression:!1,...t}}async open(){try{await this.db.open(this.opts)}catch(e){throw new s.c0(String(e))}}async put(e,t){try{return await this.db.put(e.toString(),t),e}catch(e){throw new s.F9(String(e))}}async get(e){let t;try{t=await this.db.get(e.toString())}catch(e){if(null!=e.notFound)throw new s.m_(String(e));throw new s.kR(String(e))}return t}async has(e){try{await this.db.get(e.toString())}catch(e){if(null!=e.notFound)return!1;throw e}return!0}async delete(e){try{await this.db.del(e.toString())}catch(e){throw new s.DI(String(e))}}async close(){await this.db.close()}batch(){let e=[];return{put:(t,r)=>{e.push({type:"put",key:t.toString(),value:r})},delete:t=>{e.push({type:"del",key:t.toString()})},commit:async()=>{if(null==this.db.batch)throw Error("Batch operations unsupported by underlying Level");await this.db.batch(e)}}}query(e){let t=this._query({values:!0,prefix:e.prefix});Array.isArray(e.filters)&&(t=e.filters.reduce((e,t)=>(0,o.A)(e,t),t)),Array.isArray(e.orders)&&(t=e.orders.reduce((e,t)=>(0,l.A)(e,t),t));let{offset:r,limit:n}=e;if(null!=r){let e=0;t=(0,o.A)(t,()=>e++>=r)}return null!=n&&(t=(0,c.A)(t,n)),t}queryKeys(e){let t=(0,a.A)(this._query({values:!1,prefix:e.prefix}),({key:e})=>e);Array.isArray(e.filters)&&(t=e.filters.reduce((e,t)=>(0,o.A)(e,t),t)),Array.isArray(e.orders)&&(t=e.orders.reduce((e,t)=>(0,l.A)(e,t),t));let{offset:r,limit:n}=e;if(null!=r){let e=0;t=(0,o.A)(t,()=>e++>=r)}return null!=n&&(t=(0,c.A)(t,n)),t}_query(e){let t={keys:!0,keyEncoding:"buffer",values:e.values};if(null!=e.prefix){let r=e.prefix.toString();t.gte=r,t.lt=r+"\xff"}let r=this.db.iterator(t);if(null!=r[Symbol.asyncIterator])return d(r);if(null!=r.next&&null!=r.end)return f(r);throw Error("Level returned incompatible iterator")}}async function*d(e){for await(let[t,r]of e)yield{key:new i.U(t,!1),value:r};await e.close()}function f(e){return{[Symbol.asyncIterator]:()=>({next:async()=>new Promise((t,r)=>{e.next((n,s,o)=>null!=n?void r(n):null==s?void e.end(e=>{if(null!=e)return void r(e);t({done:!0,value:void 0})}):void t({done:!1,value:{key:new i.U(s,!1),value:o}}))}),return:async()=>new Promise((t,r)=>{e.end(e=>{if(null!=e)return void r(e);t({done:!0,value:void 0})})})})}}},28886:(e,t,r)=>{"use strict";var n=r(5955),i=r(8419),s=r(9166),o=r(91453),a=r(81954),l=r(21589),c=o("Object.prototype.toString"),u=r(39781)(),h="undefined"==typeof globalThis?r.g:globalThis,d=i(),f=o("String.prototype.slice"),p=o("Array.prototype.indexOf",!0)||function(e,t){for(var r=0;r<e.length;r+=1)if(e[r]===t)return r;return -1},g={__proto__:null};u&&a&&l?n(d,function(e){var t=new h[e];if(Symbol.toStringTag in t&&l){var r=l(t),n=a(r,Symbol.toStringTag);!n&&r&&(n=a(l(r),Symbol.toStringTag)),g["$"+e]=s(n.get)}}):n(d,function(e){var t=new h[e],r=t.slice||t.set;r&&(g["$"+e]=s(r))});var m=function(e){var t=!1;return n(g,function(r,n){if(!t)try{"$"+r(e)===n&&(t=f(n,1))}catch(e){}}),t},y=function(e){var t=!1;return n(g,function(r,n){if(!t)try{r(e),t=f(n,1)}catch(e){}}),t};e.exports=function(e){if(!e||"object"!=typeof e)return!1;if(!u){var t=f(c(e),8,-1);return p(d,t)>-1?t:"Object"===t&&y(e)}return a?m(e):null}},29200:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r)if(!this._cachedTimeouts)return!1;else this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var i=this._errors[n],s=i.message,o=(e[s]||0)+1;e[s]=o,o>=r&&(t=i,r=o)}return t}},29241:e=>{"use strict";var t,r,n=Function.prototype.toString,i="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof i&&"function"==typeof Object.defineProperty)try{t=Object.defineProperty({},"length",{get:function(){throw r}}),r={},i(function(){throw 42},null,t)}catch(e){e!==r&&(i=null)}else i=null;var s=/^\s*class\b/,o=function(e){try{var t=n.call(e);return s.test(t)}catch(e){return!1}},a=function(e){try{if(o(e))return!1;return n.call(e),!0}catch(e){return!1}},l=Object.prototype.toString,c="[object Object]",u="[object Function]",h="[object GeneratorFunction]",d="[object HTMLAllCollection]",f="[object HTML document.all class]",p="[object HTMLCollection]",g="function"==typeof Symbol&&!!Symbol.toStringTag,m=!(0 in[,]),y=function(){return!1};if("object"==typeof document){var b=document.all;l.call(b)===l.call(document.all)&&(y=function(e){if((m||!e)&&(void 0===e||"object"==typeof e))try{var t=l.call(e);return(t===d||t===f||t===p||t===c)&&null==e("")}catch(e){}return!1})}e.exports=i?function(e){if(y(e))return!0;if(!e||"function"!=typeof e&&"object"!=typeof e)return!1;try{i(e,null,t)}catch(e){if(e!==r)return!1}return!o(e)&&a(e)}:function(e){if(y(e))return!0;if(!e||"function"!=typeof e&&"object"!=typeof e)return!1;if(g)return a(e);if(o(e))return!1;var t=l.call(e);return(t===u||t===h||!!/^\[object HTML/.test(t))&&a(e)}},29485:(e,t,r)=>{e.exports=i;let n=r(56765);function i(e,t,r){let i,s,o,a,l,c;if("number"!=typeof t)throw Error("second argument must be a Number");let u=!0;function h(e){function t(){r&&r(e,i),r=null}u?n(t):t()}function d(t,r,n){if(i[t]=n,r&&(l=!0),0==--o||r)h(r);else if(!l&&c<s){let t;a?(t=a[c],c+=1,e[t](function(e,r){d(t,e,r)})):(t=c,c+=1,e[t](function(e,r){d(t,e,r)}))}}Array.isArray(e)?(i=[],o=s=e.length):(a=Object.keys(e),i={},o=s=a.length),c=t,o?a?a.some(function(r,n){return e[r](function(e,t){d(r,e,t)}),n===t-1}):e.some(function(e,r){return e(function(e,t){d(r,e,t)}),r===t-1}):h(null),u=!1}},30539:(e,t,r)=>{"use strict";r.d(t,{x:()=>u});var n=r(46923),i=r(98897),s=r(59372),o=r(43716),a=r(69685),l=r(34269),c=r(87704);class u extends n.if{db;opts;base;constructor(e,t={}){super(),this.db="string"==typeof e?new s.Level(e,{...t,keyEncoding:"utf8",valueEncoding:"view"}):e,this.opts={createIfMissing:!0,compression:!1,...t},this.base=t.base??o.base32upper}#Z(e){return`/${this.base.encoder.encode(e.multihash.bytes)}`}#Y(e){return a.TO.createV1(l.code,c.decode(this.base.decoder.decode(e.substring(1))))}async open(){try{await this.db.open(this.opts)}catch(e){throw new i.c0(String(e))}}async put(e,t){try{return await this.db.put(this.#Z(e),t),e}catch(e){throw new i.F9(String(e))}}async get(e){let t;try{t=await this.db.get(this.#Z(e))}catch(e){if(null!=e.notFound)throw new i.m_(String(e));throw new i.kR(String(e))}return t}async has(e){try{await this.db.get(this.#Z(e))}catch(e){if(null!=e.notFound)return!1;throw e}return!0}async delete(e){try{await this.db.del(this.#Z(e))}catch(e){throw new i.DI(String(e))}}async close(){await this.db.close()}async *getAll(e){for await(let{key:e,value:t}of this.#X({values:!0}))yield{cid:this.#Y(e),block:t}}async *#X(e){let t={keys:!0,keyEncoding:"buffer",values:e.values};if(null!=e.prefix){let r=e.prefix.toString();t.gte=r,t.lt=r+"\xff"}let r=this.db.iterator(t);try{for await(let[e,t]of r)yield{key:new TextDecoder().decode(e),value:t}}finally{await r.close()}}}},30946:(e,t,r)=>{"use strict";r.r(t),r.d(t,{identity:()=>c});var n=r(70834),i=r(87704);let s=0,o="identity",a=n.coerce;function l(e){return i.create(s,a(e))}let c={code:s,name:o,encode:a,digest:l}},31102:function(e,t){!function(r,n){"use strict";var i={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function s(e){if(!Array.isArray(e)&&!ArrayBuffer.isView(e))return!1;for(var t=0;t<e.length;t++)if(!Number.isInteger(e[t])||e[t]<0||e[t]>255)return!1;return!0}function o(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function a(e,t){return e<<t|e>>>32-t}function l(e){return e^=e>>>16,e=o(e,0x85ebca6b),e^=e>>>13,e=o(e,0xc2b2ae35),e^=e>>>16}function c(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]+t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]+t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]+t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]+t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function u(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]*t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]*t[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=e[3]*t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]*t[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[2]*t[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[3]*t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function h(e,t){return 32==(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function d(e,t){return 0==(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function f(e,t){return[e[0]^t[0],e[1]^t[1]]}function p(e){return e=u(e=f(e,[0,e[0]>>>1]),[0xff51afd7,0xed558ccd]),e=u(e=f(e,[0,e[0]>>>1]),[0xc4ceb9fe,0x1a85ec53]),e=f(e,[0,e[0]>>>1])}i.x86.hash32=function(e,t){if(!i.inputValidation||s(e)){t=t||0;for(var r=e.length%4,n=e.length-r,c=t,u=0,h=0xcc9e2d51,d=0x1b873593,f=0;f<n;f+=4)u=a(u=o(u=e[f]|e[f+1]<<8|e[f+2]<<16|e[f+3]<<24,h),15),c^=u=o(u,d),c=o(c=a(c,13),5)+0xe6546b64;switch(u=0,r){case 3:u^=e[f+2]<<16;case 2:u^=e[f+1]<<8;case 1:u^=e[f],u=a(u=o(u,h),15),c^=u=o(u,d)}return c^=e.length,(c=l(c))>>>0}},i.x86.hash128=function(e,t){if(!i.inputValidation||s(e)){t=t||0;for(var r=e.length%16,n=e.length-r,c=t,u=t,h=t,d=t,f=0,p=0,g=0,m=0,y=0x239b961b,b=0xab0e9789,w=0x38b34ae5,v=0xa1e38b93,E=0;E<n;E+=16)f=e[E]|e[E+1]<<8|e[E+2]<<16|e[E+3]<<24,p=e[E+4]|e[E+5]<<8|e[E+6]<<16|e[E+7]<<24,g=e[E+8]|e[E+9]<<8|e[E+10]<<16|e[E+11]<<24,m=e[E+12]|e[E+13]<<8|e[E+14]<<16|e[E+15]<<24,f=a(f=o(f,y),15),c^=f=o(f,b),c=o(c=a(c,19)+u,5)+0x561ccd1b,p=a(p=o(p,b),16),u^=p=o(p,w),u=o(u=a(u,17)+h,5)+0xbcaa747,g=a(g=o(g,w),17),h^=g=o(g,v),h=o(h=a(h,15)+d,5)+0x96cd1c35,m=a(m=o(m,v),18),d^=m=o(m,y),d=o(d=a(d,13)+c,5)+0x32ac3b17;switch(f=0,p=0,g=0,m=0,r){case 15:m^=e[E+14]<<16;case 14:m^=e[E+13]<<8;case 13:m^=e[E+12],m=a(m=o(m,v),18),d^=m=o(m,y);case 12:g^=e[E+11]<<24;case 11:g^=e[E+10]<<16;case 10:g^=e[E+9]<<8;case 9:g^=e[E+8],g=a(g=o(g,w),17),h^=g=o(g,v);case 8:p^=e[E+7]<<24;case 7:p^=e[E+6]<<16;case 6:p^=e[E+5]<<8;case 5:p^=e[E+4],p=a(p=o(p,b),16),u^=p=o(p,w);case 4:f^=e[E+3]<<24;case 3:f^=e[E+2]<<16;case 2:f^=e[E+1]<<8;case 1:f^=e[E],f=a(f=o(f,y),15),c^=f=o(f,b)}return c^=e.length,u^=e.length,h^=e.length,d^=e.length,c+=u,c+=h,c+=d,u+=c,h+=c,d+=c,c=l(c),u=l(u),h=l(h),d=l(d),c+=u,c+=h,c+=d,u+=c,h+=c,d+=c,("00000000"+(c>>>0).toString(16)).slice(-8)+("00000000"+(u>>>0).toString(16)).slice(-8)+("00000000"+(h>>>0).toString(16)).slice(-8)+("00000000"+(d>>>0).toString(16)).slice(-8)}},i.x64.hash128=function(e,t){if(i.inputValidation&&!s(e))return n;t=t||0;for(var r=e.length%16,o=e.length-r,a=[0,t],l=[0,t],g=[0,0],m=[0,0],y=[0x87c37b91,0x114253d5],b=[0x4cf5ad43,0x2745937f],w=0;w<o;w+=16)g=[e[w+4]|e[w+5]<<8|e[w+6]<<16|e[w+7]<<24,e[w]|e[w+1]<<8|e[w+2]<<16|e[w+3]<<24],m=[e[w+12]|e[w+13]<<8|e[w+14]<<16|e[w+15]<<24,e[w+8]|e[w+9]<<8|e[w+10]<<16|e[w+11]<<24],g=h(g=u(g,y),31),a=c(a=h(a=f(a,g=u(g,b)),27),l),a=c(u(a,[0,5]),[0,0x52dce729]),m=h(m=u(m,b),33),l=c(l=h(l=f(l,m=u(m,y)),31),a),l=c(u(l,[0,5]),[0,0x38495ab5]);switch(g=[0,0],m=[0,0],r){case 15:m=f(m,d([0,e[w+14]],48));case 14:m=f(m,d([0,e[w+13]],40));case 13:m=f(m,d([0,e[w+12]],32));case 12:m=f(m,d([0,e[w+11]],24));case 11:m=f(m,d([0,e[w+10]],16));case 10:m=f(m,d([0,e[w+9]],8));case 9:m=h(m=u(m=f(m,[0,e[w+8]]),b),33),l=f(l,m=u(m,y));case 8:g=f(g,d([0,e[w+7]],56));case 7:g=f(g,d([0,e[w+6]],48));case 6:g=f(g,d([0,e[w+5]],40));case 5:g=f(g,d([0,e[w+4]],32));case 4:g=f(g,d([0,e[w+3]],24));case 3:g=f(g,d([0,e[w+2]],16));case 2:g=f(g,d([0,e[w+1]],8));case 1:g=h(g=u(g=f(g,[0,e[w]]),y),31),a=f(a,g=u(g,b))}return a=c(a=f(a,[0,e.length]),l=f(l,[0,e.length])),l=c(l,a),a=c(a=p(a),l=p(l)),l=c(l,a),("00000000"+(a[0]>>>0).toString(16)).slice(-8)+("00000000"+(a[1]>>>0).toString(16)).slice(-8)+("00000000"+(l[0]>>>0).toString(16)).slice(-8)+("00000000"+(l[1]>>>0).toString(16)).slice(-8)},e.exports&&(t=e.exports=i),t.murmurHash3=i}(0)},31114:(e,t,r)=>{"use strict";r.d(t,{A:()=>ec});var n,i=r(39249),s=r(12115),o="right-scroll-bar-position",a="width-before-scroll-bar",l="with-scroll-bars-hidden",c="--removed-body-scroll-bar-size";function u(e,t){return"function"==typeof e?e(t):e&&(e.current=t),e}function h(e,t){var r=(0,s.useState)(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(value){var n=r.value;n!==value&&(r.value=value,r.callback(value,n))}}}})[0];return r.callback=t,r.facade}var d="undefined"!=typeof window?s.useLayoutEffect:s.useEffect,f=new WeakMap;function p(e,t){var r=h(t||null,function(t){return e.forEach(function(e){return u(e,t)})});return d(function(){var t=f.get(r);if(t){var n=new Set(t),i=new Set(e),s=r.current;n.forEach(function(e){i.has(e)||u(e,null)}),i.forEach(function(e){n.has(e)||u(e,s)})}f.set(r,e)},[e]),r}function g(e){return e}function m(e,t){void 0===t&&(t=g);var r=[],n=!1;return{read:function(){if(n)throw Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(e){var i=t(e,n);return r.push(i),function(){r=r.filter(function(e){return e!==i})}},assignSyncMedium:function(e){for(n=!0;r.length;){var t=r;r=[],t.forEach(e)}r={push:function(t){return e(t)},filter:function(){return r}}},assignMedium:function(e){n=!0;var t=[];if(r.length){var i=r;r=[],i.forEach(e),t=r}var s=function(){var r=t;t=[],r.forEach(e)},o=function(){return Promise.resolve().then(s)};o(),r={push:function(e){t.push(e),o()},filter:function(e){return t=t.filter(e),r}}}}}var y=function(e){void 0===e&&(e={});var t=m(null);return t.options=(0,i.Cl)({async:!0,ssr:!1},e),t}(),b=function(){},w=s.forwardRef(function(e,t){var r=s.useRef(null),n=s.useState({onScrollCapture:b,onWheelCapture:b,onTouchMoveCapture:b}),o=n[0],a=n[1],l=e.forwardProps,c=e.children,u=e.className,h=e.removeScrollBar,d=e.enabled,f=e.shards,g=e.sideCar,m=e.noIsolation,w=e.inert,v=e.allowPinchZoom,E=e.as,A=void 0===E?"div":E,x=e.gapMode,S=(0,i.Tt)(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),k=g,_=p([r,t]),I=(0,i.Cl)((0,i.Cl)({},S),o);return s.createElement(s.Fragment,null,d&&s.createElement(k,{sideCar:y,removeScrollBar:h,shards:f,noIsolation:m,inert:w,setCallbacks:a,allowPinchZoom:!!v,lockRef:r,gapMode:x}),l?s.cloneElement(s.Children.only(c),(0,i.Cl)((0,i.Cl)({},I),{ref:_})):s.createElement(A,(0,i.Cl)({},I,{className:u,ref:_}),c))});w.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},w.classNames={fullWidth:a,zeroRight:o};var v=function(e){var t=e.sideCar,r=(0,i.Tt)(e,["sideCar"]);if(!t)throw Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw Error("Sidecar medium not found");return s.createElement(n,(0,i.Cl)({},r))};function E(e,t){return e.useMedium(t),v}v.isSideCarExport=!0;var A=function(){return n||r.nc};function x(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=A();return t&&e.setAttribute("nonce",t),e}function S(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function k(e){(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}var _=function(){var e=0,t=null;return{add:function(r){0==e&&(t=x())&&(S(t,r),k(t)),e++},remove:function(){--e||!t||(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},I=function(){var e=_();return function(t,r){s.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},C=function(){var e=I();return function(t){return e(t.styles,t.dynamic),null}},T={left:0,top:0,right:0,gap:0},P=function(e){return parseInt(e||"",10)||0},R=function(e){var t=window.getComputedStyle(document.body),r=t["padding"===e?"paddingLeft":"marginLeft"],n=t["padding"===e?"paddingTop":"marginTop"],i=t["padding"===e?"paddingRight":"marginRight"];return[P(r),P(n),P(i)]},O=function(e){if(void 0===e&&(e="margin"),"undefined"==typeof window)return T;var t=R(e),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-r+t[2]-t[0])}},N=C(),D="data-scroll-locked",B=function(e,t,r,n){var i=e.left,s=e.top,u=e.right,h=e.gap;return void 0===r&&(r="margin"),"\n  .".concat(l," {\n   overflow: hidden ").concat(n,";\n   padding-right: ").concat(h,"px ").concat(n,";\n  }\n  body[").concat(D,"] {\n    overflow: hidden ").concat(n,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(n,";"),"margin"===r&&"\n    padding-left: ".concat(i,"px;\n    padding-top: ").concat(s,"px;\n    padding-right: ").concat(u,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(h,"px ").concat(n,";\n    "),"padding"===r&&"padding-right: ".concat(h,"px ").concat(n,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(o," {\n    right: ").concat(h,"px ").concat(n,";\n  }\n  \n  .").concat(a," {\n    margin-right: ").concat(h,"px ").concat(n,";\n  }\n  \n  .").concat(o," .").concat(o," {\n    right: 0 ").concat(n,";\n  }\n  \n  .").concat(a," .").concat(a," {\n    margin-right: 0 ").concat(n,";\n  }\n  \n  body[").concat(D,"] {\n    ").concat(c,": ").concat(h,"px;\n  }\n")},M=function(){var e=parseInt(document.body.getAttribute(D)||"0",10);return isFinite(e)?e:0},L=function(){s.useEffect(function(){return document.body.setAttribute(D,(M()+1).toString()),function(){var e=M()-1;e<=0?document.body.removeAttribute(D):document.body.setAttribute(D,e.toString())}},[])},F=function(e){var t=e.noRelative,r=e.noImportant,n=e.gapMode,i=void 0===n?"margin":n;L();var o=s.useMemo(function(){return O(i)},[i]);return s.createElement(N,{styles:B(o,!t,i,r?"":"!important")})},U=!1;if("undefined"!=typeof window)try{var j=Object.defineProperty({},"passive",{get:function(){return U=!0,!0}});window.addEventListener("test",j,j),window.removeEventListener("test",j,j)}catch(e){U=!1}var $=!!U&&{passive:!1},H=function(e){return"TEXTAREA"===e.tagName},q=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return"hidden"!==r[t]&&!(r.overflowY===r.overflowX&&!H(e)&&"visible"===r[t])},z=function(e){return q(e,"overflowY")},V=function(e){return q(e,"overflowX")},K=function(e,t){var r=t.ownerDocument,n=t;do{if("undefined"!=typeof ShadowRoot&&n instanceof ShadowRoot&&(n=n.host),Q(e,n)){var i=J(e,n);if(i[1]>i[2])return!0}n=n.parentNode}while(n&&n!==r.body);return!1},G=function(e){return[e.scrollTop,e.scrollHeight,e.clientHeight]},W=function(e){return[e.scrollLeft,e.scrollWidth,e.clientWidth]},Q=function(e,t){return"v"===e?z(t):V(t)},J=function(e,t){return"v"===e?G(t):W(t)},Z=function(e,t){return"h"===e&&"rtl"===t?-1:1},Y=function(e,t,r,n,i){var s=Z(e,window.getComputedStyle(t).direction),o=s*n,a=r.target,l=t.contains(a),c=!1,u=o>0,h=0,d=0;do{var f=J(e,a),p=f[0],g=f[1]-f[2]-s*p;(p||g)&&Q(e,a)&&(h+=g,d+=p),a=a instanceof ShadowRoot?a.host:a.parentNode}while(!l&&a!==document.body||l&&(t.contains(a)||t===a));return u&&(i&&1>Math.abs(h)||!i&&o>h)?c=!0:!u&&(i&&1>Math.abs(d)||!i&&-o>d)&&(c=!0),c},X=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},ee=function(e){return[e.deltaX,e.deltaY]},et=function(e){return e&&"current"in e?e.current:e},er=function(e,t){return e[0]===t[0]&&e[1]===t[1]},en=function(e){return"\n  .block-interactivity-".concat(e," {pointer-events: none;}\n  .allow-interactivity-").concat(e," {pointer-events: all;}\n")},ei=0,es=[];function eo(e){for(var t=null;null!==e;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}let ea=E(y,function(e){var t=s.useRef([]),r=s.useRef([0,0]),n=s.useRef(),o=s.useState(ei++)[0],a=s.useState(C)[0],l=s.useRef(e);s.useEffect(function(){l.current=e},[e]),s.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(o));var t=(0,i.fX)([e.lockRef.current],(e.shards||[]).map(et),!0).filter(Boolean);return t.forEach(function(e){return e.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),t.forEach(function(e){return e.classList.remove("allow-interactivity-".concat(o))})}}},[e.inert,e.lockRef.current,e.shards]);var c=s.useCallback(function(e,t){if("touches"in e&&2===e.touches.length||"wheel"===e.type&&e.ctrlKey)return!l.current.allowPinchZoom;var i,s=X(e),o=r.current,a="deltaX"in e?e.deltaX:o[0]-s[0],c="deltaY"in e?e.deltaY:o[1]-s[1],u=e.target,h=Math.abs(a)>Math.abs(c)?"h":"v";if("touches"in e&&"h"===h&&"range"===u.type)return!1;var d=K(h,u);if(!d)return!0;if(d?i=h:(i="v"===h?"h":"v",d=K(h,u)),!d)return!1;if(!n.current&&"changedTouches"in e&&(a||c)&&(n.current=i),!i)return!0;var f=n.current||i;return Y(f,t,e,"h"===f?a:c,!0)},[]),u=s.useCallback(function(e){var r=e;if(es.length&&es[es.length-1]===a){var n="deltaY"in r?ee(r):X(r),i=t.current.filter(function(e){return e.name===r.type&&(e.target===r.target||r.target===e.shadowParent)&&er(e.delta,n)})[0];if(i&&i.should){r.cancelable&&r.preventDefault();return}if(!i){var s=(l.current.shards||[]).map(et).filter(Boolean).filter(function(e){return e.contains(r.target)});(s.length>0?c(r,s[0]):!l.current.noIsolation)&&r.cancelable&&r.preventDefault()}}},[]),h=s.useCallback(function(e,r,n,i){var s={name:e,delta:r,target:n,should:i,shadowParent:eo(n)};t.current.push(s),setTimeout(function(){t.current=t.current.filter(function(e){return e!==s})},1)},[]),d=s.useCallback(function(e){r.current=X(e),n.current=void 0},[]),f=s.useCallback(function(t){h(t.type,ee(t),t.target,c(t,e.lockRef.current))},[]),p=s.useCallback(function(t){h(t.type,X(t),t.target,c(t,e.lockRef.current))},[]);s.useEffect(function(){return es.push(a),e.setCallbacks({onScrollCapture:f,onWheelCapture:f,onTouchMoveCapture:p}),document.addEventListener("wheel",u,$),document.addEventListener("touchmove",u,$),document.addEventListener("touchstart",d,$),function(){es=es.filter(function(e){return e!==a}),document.removeEventListener("wheel",u,$),document.removeEventListener("touchmove",u,$),document.removeEventListener("touchstart",d,$)}},[]);var g=e.removeScrollBar,m=e.inert;return s.createElement(s.Fragment,null,m?s.createElement(a,{styles:en(o)}):null,g?s.createElement(F,{gapMode:e.gapMode}):null)});var el=s.forwardRef(function(e,t){return s.createElement(w,(0,i.Cl)({},e,{ref:t,sideCar:ea}))});el.classNames=w.classNames;let ec=el},31133:(e,t,r)=>{"use strict";function n(){let e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e}r.d(t,{A:()=>n})},31467:e=>{"use strict";e.exports=RangeError},31588:(e,t,r)=>{e.exports=r(31102)},31987:(e,t,r)=>{"use strict";r.d(t,{U:()=>n.U});var n=r(86620)},33534:(e,t)=>{"use strict";t.getCallback=function(e,t){return"function"==typeof e?e:t},t.getOptions=function(e,t){return"object"==typeof e&&null!==e?e:void 0!==t?t:{}}},33771:e=>{"use strict";e.exports=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]},34269:(e,t,r)=>{"use strict";r.r(t),r.d(t,{code:()=>s,decode:()=>a,encode:()=>o,name:()=>i});var n=r(70834);let i="raw",s=85;function o(e){return(0,n.coerce)(e)}function a(e){return(0,n.coerce)(e)}},34378:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var n=r(12115),i=r(47650),s=r(63655),o=r(52712),a=r(95155),l="Portal",c=n.forwardRef((e,t)=>{var r,l;let{container:c,...u}=e,[h,d]=n.useState(!1);(0,o.N)(()=>d(!0),[]);let f=c||h&&(null==(l=globalThis)||null==(r=l.document)?void 0:r.body);return f?i.createPortal((0,a.jsx)(s.sG.div,{...u,ref:t}),f):null});c.displayName=l},34817:e=>{"use strict";e.exports=Math.pow},36362:(e,t,r)=>{"use strict";var n,i=r(91453),s=r(39781)(),o=r(41444),a=r(81954);if(s){var l=i("RegExp.prototype.exec"),c={},u=function(){throw c},h={toString:u,valueOf:u};"symbol"==typeof Symbol.toPrimitive&&(h[Symbol.toPrimitive]=u),n=function(e){if(!e||"object"!=typeof e)return!1;var t=a(e,"lastIndex");if(!(t&&o(t,"value")))return!1;try{l(e,h)}catch(e){return e===c}}}else{var d=i("Object.prototype.toString"),f="[object RegExp]";n=function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&d(e)===f}}e.exports=n},37703:(e,t,r)=>{"use strict";r.d(t,{O:()=>m});var n=r(46923),i=r(68250),s=r(22169),o=["debug","info","warn","error"],a="warn";function l(e){return o.indexOf(e)>=o.indexOf(a)}function c(e,t,r){if(l(t)){let n=new Date().toISOString();e(`[${n}] [${t.toUpperCase()}]`,...r)}}var u={setLevel(e){o.includes(e)&&(a=e)},debug(...e){c(console.debug,"debug",e)},info(...e){c(console.info,"info",e)},warn(...e){c(console.warn,"warn",e)},error(...e){c(console.error,"error",e)}};function h(e,t,r,n){return{id:crypto.randomUUID(),parentId:n||"",sender:e,senderAlias:t,message:r,timestamp:Date.now()}}function d(e){let t=JSON.parse(e);if(!f(t))throw u.error("Parsed object isn't a ChatMessage. Chat returned: ",t),Error("Parsed object isn't a ChatMessage");return t}function f(e){return"object"==typeof e&&null!==e&&"string"==typeof e.id&&"string"==typeof e.sender&&"string"==typeof e.senderAlias&&"string"==typeof e.message&&"number"==typeof e.timestamp}var p=class e{static async create(t,r,n,i){u.debug("Creating Chat...");let s=[];return(await n.getAllKeys()).includes(r)&&(u.info("Existing Chat found, getting messages..."),s=(await n.get(r)).map(e=>d(e)),u.info(`Found ${s.length} messages in existing Chat`)),new e(t,r,s,n,i)}constructor(e,t,r,n,i){this.chatSpace=e,this.chatName=t,this.astraDb=n,this.messages=r,i?this.listenToNewMessages(i):this.listenToNewMessages(e=>{})}getMessages(){return u.info(`Getting messages for ${this.chatName}`),this.messages.sort((e,t)=>e.timestamp-t.timestamp),this.messages}async sendMessage(e){u.info(`Sending message in ${this.chatName}: ${e}`),await this.astraDb.add(this.chatName,JSON.stringify(e))}listenToNewMessages(e){u.info(`Setting new callback for ${this.chatName}`),this.astraDb.events.on(`${this.chatSpace}::${this.chatName}`,t=>{let r=d(t);u.info("New message detected in callback: ",r.id),u.debug("Calling set callback..."),e(r)})}},g=class{constructor(e){this.chatSpace=e}async init(e){u.debug("Creating AstraDb..."),this.astraDb=await (0,s.W)({dbName:this.chatSpace,loginKey:e.loginKey,isCollaborator:e.isCollaborator,datastore:e.datastore,blockstore:e.blockstore,publicIp:e.publicIp,tcpPort:e.tcpPort,wsPort:e.wsPort,wssPort:e.wssPort,webRTCDirectPort:e.webrtcDirectPort,dataDir:e.dataDir,bootstrapPeers:e.bootstrapPeers,offlineMode:e.offlineMode}),u.debug("AstraDb created"),e.alias||u.debug("No alias found, setting public key as alias"),this.alias=e.alias||this.astraDb.getLoginPublicKey()}async createChat(e,t){u.debug(`[${this.alias}] Creating chat...`);let r=await p.create(this.chatSpace,e,this.astraDb,t),n=h(this.getUserId(),this.alias,"Chat created");await r.sendMessage(n),u.debug(`[${this.alias}] Chat "${e}" created`)}async getMessages(e,t){u.info(`[${this.alias}] Getting messages from ${e}...`);let r=await p.create(this.chatSpace,e,this.astraDb,t);return u.debug(`[${this.alias}] Chat found, getting messages...`),r.getMessages()}async sendMessage(e,t,r){u.debug(`[${this.alias}] Sending message for ${e}...`);let n=await p.create(this.chatSpace,e,this.astraDb),i=h(this.getUserId(),this.alias,t,r);u.debug(`[${this.alias}] Sending message with ID ${i.id}`),await n.sendMessage(i),u.info(`[${this.alias}] Message with ID ${e} sent`)}async getChatList(){return u.info(`[${this.alias}] Getting chat list for ${this.chatSpace}`),await this.astraDb.getAllKeys()}getUserId(){return u.debug(`[${this.alias}] Getting user id...`),this.astraDb.getLoginPublicKey()}async getLoginKey(){return u.debug(`[${this.alias}] Getting logging key...`),await this.astraDb.getLoginPrivateKey()}getAlias(){return this.alias}setChatAlias(e){this.alias=e,u.info(`[${this.alias}] New alias set: ${e}`)}};async function m(e){e.chatSpace=e.chatSpace??"bitxenia-chat",e.alias=e.alias??"",e.loginKey=e.loginKey??"",e.isCollaborator=e.isCollaborator??!1,e.datastore=e.datastore??new i.bk,e.blockstore=e.blockstore??new n.ED,e.publicIp=e.publicIp??"0.0.0.0",e.tcpPort=e.tcpPort??50001,e.wsPort=e.wsPort??50002,e.wssPort=e.wssPort??50003,e.webrtcDirectPort=e.webrtcDirectPort??50001,e.dataDir=e.dataDir??"./data/astrachat",e.bootstrapPeers=e.bootstrapPeers??[],e.offlineMode=e.offlineMode??!1,e.logLevel&&u.setLevel(e.logLevel),u.info("Creating Astrachat node...");let t=new g(e.chatSpace);return await t.init(e),u.info("Astrachat node created & initialized"),t}},38168:(e,t,r)=>{"use strict";r.d(t,{Eq:()=>h});var n=function(e){return"undefined"==typeof document?null:(Array.isArray(e)?e[0]:e).ownerDocument.body},i=new WeakMap,s=new WeakMap,o={},a=0,l=function(e){return e&&(e.host||l(e.parentNode))},c=function(e,t){return t.map(function(t){if(e.contains(t))return t;var r=l(t);return r&&e.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",e,". Doing nothing"),null)}).filter(function(e){return!!e})},u=function(e,t,r,n){var l=c(t,Array.isArray(e)?e:[e]);o[r]||(o[r]=new WeakMap);var u=o[r],h=[],d=new Set,f=new Set(l),p=function(e){!e||d.has(e)||(d.add(e),p(e.parentNode))};l.forEach(p);var g=function(e){!e||f.has(e)||Array.prototype.forEach.call(e.children,function(e){if(d.has(e))g(e);else try{var t=e.getAttribute(n),o=null!==t&&"false"!==t,a=(i.get(e)||0)+1,l=(u.get(e)||0)+1;i.set(e,a),u.set(e,l),h.push(e),1===a&&o&&s.set(e,!0),1===l&&e.setAttribute(r,"true"),o||e.setAttribute(n,"true")}catch(t){console.error("aria-hidden: cannot operate on ",e,t)}})};return g(t),d.clear(),a++,function(){h.forEach(function(e){var t=i.get(e)-1,o=u.get(e)-1;i.set(e,t),u.set(e,o),t||(s.has(e)||e.removeAttribute(n),s.delete(e)),o||e.removeAttribute(r)}),--a||(i=new WeakMap,i=new WeakMap,s=new WeakMap,o={})}},h=function(e,t,r){void 0===r&&(r="data-aria-hidden");var i=Array.from(Array.isArray(e)?e:[e]),s=t||n(e);return s?(i.push.apply(i,Array.from(s.querySelectorAll("[aria-live]"))),u(i,s,r,"aria-hidden")):function(){return null}}},38541:(e,t)=>{"use strict";t.supports=function(...e){let t=e.reduce((e,t)=>Object.assign(e,t),{});return Object.assign(t,{snapshots:t.snapshots||!1,permanence:t.permanence||!1,seek:t.seek||!1,clear:t.clear||!1,getMany:t.getMany||!1,keyIterator:t.keyIterator||!1,valueIterator:t.valueIterator||!1,iteratorNextv:t.iteratorNextv||!1,iteratorAll:t.iteratorAll||!1,status:t.status||!1,createIfMissing:t.createIfMissing||!1,errorIfExists:t.errorIfExists||!1,deferredOpen:t.deferredOpen||!1,promises:t.promises||!1,streams:t.streams||!1,encodings:Object.assign({},t.encodings),events:Object.assign({},t.events),additionalMethods:Object.assign({},t.additionalMethods)})}},39070:(e,t,r)=>{"use strict";let{fromCallback:n}=r(82813),i=r(7800),{getOptions:s,getCallback:o}=r(33534),a=Symbol("promise"),l=Symbol("callback"),c=Symbol("working"),u=Symbol("handleOne"),h=Symbol("handleMany"),d=Symbol("autoClose"),f=Symbol("finishWork"),p=Symbol("returnMany"),g=Symbol("closing"),m=Symbol("handleClose"),y=Symbol("closed"),b=Symbol("closeCallbacks"),w=Symbol("keyEncoding"),v=Symbol("valueEncoding"),E=Symbol("abortOnClose"),A=Symbol("legacy"),x=Symbol("keys"),S=Symbol("values"),k=Symbol("limit"),_=Symbol("count"),I=Object.freeze({}),C=()=>{},T=!1;class P{constructor(e,t,r){if("object"!=typeof e||null===e){let t=null===e?"null":typeof e;throw TypeError(`The first argument must be an abstract-level database, received ${t}`)}if("object"!=typeof t||null===t)throw TypeError("The second argument must be an options object");this[y]=!1,this[b]=[],this[c]=!1,this[g]=!1,this[d]=!1,this[l]=null,this[u]=this[u].bind(this),this[h]=this[h].bind(this),this[m]=this[m].bind(this),this[w]=t[w],this[v]=t[v],this[A]=r,this[k]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[_]=0,this[E]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[_]}get limit(){return this[k]}next(e){let t;if(void 0===e)t=new Promise((t,r)=>{e=(e,n,i)=>{e?r(e):this[A]?void 0===n&&void 0===i?t():t([n,i]):t(n)}});else if("function"!=typeof e)throw TypeError("Callback must be a function");return this[g]?this.nextTick(e,new i("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[c]?this.nextTick(e,new i("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[c]=!0,this[l]=e,this[_]>=this[k]?this.nextTick(this[u],null):this._next(this[u])),t}_next(e){this.nextTick(e)}nextv(e,t,r){return(r=n(r=o(t,r),a),t=s(t,I),Number.isInteger(e))?this[g]?this.nextTick(r,new i("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[c]?this.nextTick(r,new i("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[k]<1/0&&(e=Math.min(e,this[k]-this[_])),this[c]=!0,this[l]=r,e<=0?this.nextTick(this[h],null,[]):this._nextv(e,t,this[h])):this.nextTick(r,TypeError("The first argument 'size' must be an integer")),r[a]}_nextv(e,t,r){let n=[],i=(t,s,o)=>t?r(t):(this[A]?void 0===s&&void 0===o:void 0===s)?r(null,n):void(n.push(this[A]?[s,o]:s),n.length===e?r(null,n):this._next(i));this._next(i)}all(e,t){return t=n(t=o(e,t),a),e=s(e,I),this[g]?this.nextTick(t,new i("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[c]?this.nextTick(t,new i("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[c]=!0,this[l]=t,this[d]=!0,this[_]>=this[k]?this.nextTick(this[h],null,[]):this._all(e,this[h])),t[a]}_all(e,t){let r=this[_],n=[],i=()=>{let e=this[k]<1/0?Math.min(1e3,this[k]-r):1e3;e<=0?this.nextTick(t,null,n):this._nextv(e,I,s)},s=(e,s)=>{e?t(e):0===s.length?t(null,n):(n.push.apply(n,s),r+=s.length,i())};i()}[f](){let e=this[l];return this[E]&&null===e?C:(this[c]=!1,this[l]=null,this[g]&&this._close(this[m]),e)}[p](e,t,r){this[d]?this.close(e.bind(null,t,r)):e(t,r)}seek(e,t){if(t=s(t,I),this[g]);else if(this[c])throw new i("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});else{let r=this.db.keyEncoding(t.keyEncoding||this[w]),n=r.format;t.keyEncoding!==n&&(t={...t,keyEncoding:n});let i=this.db.prefixKey(r.encode(e),n);this._seek(i,t)}}_seek(e,t){throw new i("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){return e=n(e,a),this[y]?this.nextTick(e):this[g]?this[b].push(e):(this[g]=!0,this[b].push(e),this[c]?this[E]&&this[f]()(new i("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[m])),e[a]}_close(e){this.nextTick(e)}[m](){this[y]=!0,this.db.detachResource(this);let e=this[b];for(let t of(this[b]=[],e))t()}async *[Symbol.asyncIterator](){try{let e;for(;void 0!==(e=await this.next());)yield e}finally{this[y]||await this.close()}}}class R extends P{constructor(e,t){super(e,t,!0),this[x]=!1!==t.keys,this[S]=!1!==t.values}[u](e,t,r){let n=this[f]();if(e)return n(e);try{t=this[x]&&void 0!==t?this[w].decode(t):void 0,r=this[S]&&void 0!==r?this[v].decode(r):void 0}catch(e){return n(new D("entry",e))}(void 0!==t||void 0!==r)&&this[_]++,n(null,t,r)}[h](e,t){let r=this[f]();if(e)return this[p](r,e);try{for(let e of t){let t=e[0],r=e[1];e[0]=this[x]&&void 0!==t?this[w].decode(t):void 0,e[1]=this[S]&&void 0!==r?this[v].decode(r):void 0}}catch(e){return this[p](r,new D("entries",e))}this[_]+=t.length,this[p](r,null,t)}end(e){return T||"undefined"==typeof console||(T=!0,console.warn(new i("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}}class O extends P{constructor(e,t){super(e,t,!1)}[u](e,t){let r=this[f]();if(e)return r(e);try{t=void 0!==t?this[w].decode(t):void 0}catch(e){return r(new D("key",e))}void 0!==t&&this[_]++,r(null,t)}[h](e,t){let r=this[f]();if(e)return this[p](r,e);try{for(let e=0;e<t.length;e++){let r=t[e];t[e]=void 0!==r?this[w].decode(r):void 0}}catch(e){return this[p](r,new D("keys",e))}this[_]+=t.length,this[p](r,null,t)}}class N extends P{constructor(e,t){super(e,t,!1)}[u](e,t){let r=this[f]();if(e)return r(e);try{t=void 0!==t?this[v].decode(t):void 0}catch(e){return r(new D("value",e))}void 0!==t&&this[_]++,r(null,t)}[h](e,t){let r=this[f]();if(e)return this[p](r,e);try{for(let e=0;e<t.length;e++){let r=t[e];t[e]=void 0!==r?this[v].decode(r):void 0}}catch(e){return this[p](r,new D("values",e))}this[_]+=t.length,this[p](r,null,t)}}class D extends i{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}}for(let e of["_ended property","_nexting property","_end method"])Object.defineProperty(R.prototype,e.split(" ")[0],{get(){throw new i(`The ${e} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new i(`The ${e} has been removed`,{code:"LEVEL_LEGACY"})}});R.keyEncoding=w,R.valueEncoding=v,t.AbstractIterator=R,t.AbstractKeyIterator=O,t.AbstractValueIterator=N},39249:(e,t,r)=>{"use strict";r.d(t,{Cg:()=>o,Cl:()=>i,Tt:()=>s,fX:()=>u});var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},i=function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function s(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function o(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}var a=Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]};function l(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return o}function u(e,t,r){if(r||2==arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}function h(e){return this instanceof h?(this.v=e,this):new h(e)}var d=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},f=function(e){return(f=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},p="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var n=Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n}},39781:(e,t,r)=>{"use strict";var n=r(68852);e.exports=function(){return n()&&!!Symbol.toStringTag}},40463:(e,t)=>{var r;!function(e){"undefined"==typeof DO_NOT_EXPORT_CRC?e(t):e(r={})}(function(e){e.version="1.2.2";var t=function(){for(var e=0,t=Array(256),r=0;256!=r;++r)e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=r)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1,t[r]=e;return"undefined"!=typeof Int32Array?new Int32Array(t):t}(),r=function(e){var t=0,r=0,n=0,i="undefined"!=typeof Int32Array?new Int32Array(4096):Array(4096);for(n=0;256!=n;++n)i[n]=e[n];for(n=0;256!=n;++n)for(r=e[n],t=256+n;t<4096;t+=256)r=i[t]=r>>>8^e[255&r];var s=[];for(n=1;16!=n;++n)s[n-1]="undefined"!=typeof Int32Array?i.subarray(256*n,256*n+256):i.slice(256*n,256*n+256);return s}(t),n=r[0],i=r[1],s=r[2],o=r[3],a=r[4],l=r[5],c=r[6],u=r[7],h=r[8],d=r[9],f=r[10],p=r[11],g=r[12],m=r[13],y=r[14];function b(e,r){for(var n=-1^r,i=0,s=e.length;i<s;)n=n>>>8^t[(n^e.charCodeAt(i++))&255];return~n}function w(e,r){for(var b=-1^r,w=e.length-15,v=0;v<w;)b=y[e[v++]^255&b]^m[e[v++]^b>>8&255]^g[e[v++]^b>>16&255]^p[e[v++]^b>>>24]^f[e[v++]]^d[e[v++]]^h[e[v++]]^u[e[v++]]^c[e[v++]]^l[e[v++]]^a[e[v++]]^o[e[v++]]^s[e[v++]]^i[e[v++]]^n[e[v++]]^t[e[v++]];for(w+=15;v<w;)b=b>>>8^t[(b^e[v++])&255];return~b}function v(e,r){for(var n=-1^r,i=0,s=e.length,o=0,a=0;i<s;)(o=e.charCodeAt(i++))<128?n=n>>>8^t[(n^o)&255]:o<2048?n=(n=n>>>8^t[(n^(192|o>>6&31))&255])>>>8^t[(n^(128|63&o))&255]:o>=55296&&o<57344?(o=(1023&o)+64,a=1023&e.charCodeAt(i++),n=(n=(n=(n=n>>>8^t[(n^(240|o>>8&7))&255])>>>8^t[(n^(128|o>>2&63))&255])>>>8^t[(n^(128|a>>6&15|(3&o)<<4))&255])>>>8^t[(n^(128|63&a))&255]):n=(n=(n=n>>>8^t[(n^(224|o>>12&15))&255])>>>8^t[(n^(128|o>>6&63))&255])>>>8^t[(n^(128|63&o))&255];return~n}e.table=t,e.bstr=b,e.buf=w,e.str=v})},40662:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};function i(e){console&&console.warn&&console.warn(e)}t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=b,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function l(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function u(e,t,r,n){if(l(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),a=o[t]),void 0===a)a=o[t]=r,++e._eventsCount;else if("function"==typeof a?a=o[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(s=c(e))>0&&a.length>s&&!a.warned){a.warned=!0;var s,o,a,u=Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,i(u)}return e}function h(){if(!this.fired)return(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length)?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=h.bind(n);return i.listener=r,n.wrapFn=i,i}function f(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?y(i):g(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=Array(t),n=0;n<t;++n)r[n]=e[n];return r}function m(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function y(e){for(var t=Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function b(e,t){return new Promise(function(r,n){function i(r){e.removeListener(t,s),n(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}v(e,t,s,{once:!0}),"error"!==t&&w(e,i,{once:!0})})}function w(e,t,r){"function"==typeof e.on&&v(e,"error",t,r)}function v(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else if("function"==typeof e.addEventListener)e.addEventListener(t,function i(s){n.once&&e.removeEventListener(t,i),r(s)});else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||s(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),o.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,s=this._events;if(void 0!==s)i=i&&void 0===s.error;else if(!i)return!1;if(i){if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var o,a=Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=s[e];if(void 0===l)return!1;if("function"==typeof l)n(l,this,t);else for(var c=l.length,u=g(l,c),r=0;r<c;++r)n(u[r],this,t);return!0},o.prototype.addListener=function(e,t){return u(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return u(this,e,t,!0)},o.prototype.once=function(e,t){return l(t),this.on(e,d(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,d(this,e,t)),this},o.prototype.removeListener=function(e,t){var r,n,i,s,o;if(l(t),void 0===(n=this._events)||void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;0===i?r.shift():m(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0==arguments.length){var i,s=Object.keys(r);for(n=0;n<s.length;++n)"removeListener"!==(i=s[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},o.prototype.listeners=function(e){return f(this,e,!0)},o.prototype.rawListeners=function(e){return f(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},40944:(e,t)=>{"use strict";var r;function n(e){if(Array.isArray(e)){let t=[],r=0;for(let i=0;i<e.length;i++){let s=n(e[i]);t.push(s),r+=s.length}return f(o(r,192),...t)}let t=w(e);return 1===t.length&&t[0]<128?t:f(o(t.length,128),t)}function i(e,t,r){if(r>e.length)throw Error("invalid RLP (safeSlice): end slice of Uint8Array out-of-bounds");return e.slice(t,r)}function s(e){if(0===e[0])throw Error("invalid RLP: extra zeros");return h(u(e))}function o(e,t){if(e<56)return Uint8Array.from([e+t]);let r=g(e),n=g(t+55+r.length/2);return Uint8Array.from(d(n+r))}function a(e,t=!1){if(null==e||0===e.length)return Uint8Array.from([]);let r=l(w(e));if(t)return r;if(0!==r.remainder.length)throw Error("invalid RLP: remainder must be zero");return r.data}function l(e){let t,r,n,o,a,c=[],u=e[0];if(u<=127)return{data:e.slice(0,1),remainder:e.slice(1)};if(u<=183){if(t=u-127,n=128===u?Uint8Array.from([]):i(e,1,t),2===t&&n[0]<128)throw Error("invalid RLP encoding: invalid prefix, single byte < 0x80 are not prefixed");return{data:n,remainder:e.slice(t)}}if(u<=191){if(r=u-182,e.length-1<r)throw Error("invalid RLP: not enough bytes for string length");if((t=s(i(e,1,r)))<=55)throw Error("invalid RLP: expected string length to be greater than 55");return{data:n=i(e,r,t+r),remainder:e.slice(t+r)}}if(u<=247){for(o=i(e,1,t=u-191);o.length;)a=l(o),c.push(a.data),o=a.remainder;return{data:c,remainder:e.slice(t)}}{if((t=s(i(e,1,r=u-246)))<56)throw Error("invalid RLP: encoded list too short");let n=r+t;if(n>e.length)throw Error("invalid RLP: total length is larger than the data");for(o=i(e,r,n);o.length;)a=l(o),c.push(a.data),o=a.remainder;return{data:c,remainder:e.slice(n)}}}r={value:!0},t.Tj=r=r=r=void 0,r=n,r=a;let c=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function u(e){let t="";for(let r=0;r<e.length;r++)t+=c[e[r]];return t}function h(e){let t=Number.parseInt(e,16);if(Number.isNaN(t))throw Error("Invalid byte sequence");return t}function d(e){if("string"!=typeof e)throw TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw Error("hexToBytes: received invalid unpadded hex");let t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){let n=2*r;t[r]=h(e.slice(n,n+2))}return t}function f(...e){if(1===e.length)return e[0];let t=new Uint8Array(e.reduce((e,t)=>e+t.length,0));for(let r=0,n=0;r<e.length;r++){let i=e[r];t.set(i,n),n+=i.length}return t}function p(e){return new TextEncoder().encode(e)}function g(e){if(e<0)throw Error("Invalid integer as argument, must be unsigned!");let t=e.toString(16);return t.length%2?`0${t}`:t}function m(e){return e.length%2?`0${e}`:e}function y(e){return e.length>=2&&"0"===e[0]&&"x"===e[1]}function b(e){return"string"!=typeof e?e:y(e)?e.slice(2):e}function w(e){if(e instanceof Uint8Array)return e;if("string"==typeof e)return y(e)?d(m(b(e))):p(e);if("number"==typeof e||"bigint"==typeof e)return e?d(g(e)):Uint8Array.from([]);if(null==e)return Uint8Array.from([]);throw Error("toBytes: received unsupported type "+typeof e)}r={bytesToHex:u,concatBytes:f,hexToBytes:d,utf8ToBytes:p},t.Tj={encode:n,decode:a}},41394:(e,t,r)=>{"use strict";r.d(t,{D4:()=>v,s_:()=>E,OY:()=>A});var n=128,i=-128,s=0x80000000;function o(e,t,r){t=t||[];for(var a=r=r||0;e>=s;)t[r++]=255&e|n,e/=128;for(;e&i;)t[r++]=255&e|n,e>>>=7;return t[r]=0|e,o.bytes=r-a+1,t}var a=128,l=127;function c(e,t){var r,n=0,t=t||0,i=0,s=t,o=e.length;do{if(s>=o)throw c.bytes=0,RangeError("Could not decode varint");r=e[s++],n+=i<28?(r&l)<<i:(r&l)*Math.pow(2,i),i+=7}while(r>=a);return c.bytes=s-t,n}var u=128,h=16384,d=2097152,f=0x10000000,p=0x800000000,g=0x40000000000,m=0x2000000000000,y=0x100000000000000,b=0x8000000000000000;let w={encode:o,decode:c,encodingLength:function(e){return e<u?1:e<h?2:e<d?3:e<f?4:e<p?5:e<g?6:e<m?7:e<y?8:e<b?9:10}};function v(e,t=0){return[w.decode(e,t),w.decode.bytes]}function E(e,t,r=0){return w.encode(e,t,r),t}function A(e){return w.encodingLength(e)}},41444:(e,t,r)=>{"use strict";var n=Function.prototype.call,i=Object.prototype.hasOwnProperty;e.exports=r(52430).call(n,i)},41472:(e,t,r)=>{"use strict";r.r(t),r.d(t,{base36:()=>i,base36upper:()=>s});var n=r(52215);let i=(0,n._Q)({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),s=(0,n._Q)({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})},41878:(e,t,r)=>{"use strict";var n=r(12588),i=r(52103);e.exports=n.bind(null,i)},42066:e=>{"use strict";e.exports=Number.isNaN||function(e){return e!=e}},42406:(e,t,r)=>{"use strict";let n,i,s;r.d(t,{S:()=>rf});var o={};function a(e,t){return function(){return e.apply(t,arguments)}}r.r(o),r.d(o,{hasBrowserEnv:()=>eF,hasStandardBrowserEnv:()=>ej,hasStandardBrowserWebWorkerEnv:()=>e$,navigator:()=>eU,origin:()=>eH});var l=r(49509);let{toString:c}=Object.prototype,{getPrototypeOf:u}=Object,{iterator:h,toStringTag:d}=Symbol,f=(e=>t=>{let r=c.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),p=e=>(e=e.toLowerCase(),t=>f(t)===e),g=e=>t=>typeof t===e,{isArray:m}=Array,y=g("undefined");function b(e){return null!==e&&!y(e)&&null!==e.constructor&&!y(e.constructor)&&A(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}let w=p("ArrayBuffer");function v(e){let t;return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&w(e.buffer)}let E=g("string"),A=g("function"),x=g("number"),S=e=>null!==e&&"object"==typeof e,k=e=>!0===e||!1===e,_=e=>{if("object"!==f(e))return!1;let t=u(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(d in e)&&!(h in e)},I=p("Date"),C=p("File"),T=p("Blob"),P=p("FileList"),R=e=>S(e)&&A(e.pipe),O=e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||A(e.append)&&("formdata"===(t=f(e))||"object"===t&&A(e.toString)&&"[object FormData]"===e.toString()))},N=p("URLSearchParams"),[D,B,M,L]=["ReadableStream","Request","Response","Headers"].map(p),F=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function U(e,t,{allOwnKeys:r=!1}={}){let n,i;if(null!=e)if("object"!=typeof e&&(e=[e]),m(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{let i,s=r?Object.getOwnPropertyNames(e):Object.keys(e),o=s.length;for(n=0;n<o;n++)i=s[n],t.call(null,e[i],i,e)}}function j(e,t){let r;t=t.toLowerCase();let n=Object.keys(e),i=n.length;for(;i-- >0;)if(t===(r=n[i]).toLowerCase())return r;return null}let $="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,H=e=>!y(e)&&e!==$;function q(){let{caseless:e}=H(this)&&this||{},t={},r=(r,n)=>{let i=e&&j(t,n)||n;_(t[i])&&_(r)?t[i]=q(t[i],r):_(r)?t[i]=q({},r):m(r)?t[i]=r.slice():t[i]=r};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&U(arguments[e],r);return t}let z=(e,t,r,{allOwnKeys:n}={})=>(U(t,(t,n)=>{r&&A(t)?e[n]=a(t,r):e[n]=t},{allOwnKeys:n}),e),V=e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),K=(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},G=(e,t,r,n)=>{let i,s,o,a={};if(t=t||{},null==e)return t;do{for(s=(i=Object.getOwnPropertyNames(e)).length;s-- >0;)o=i[s],(!n||n(o,e,t))&&!a[o]&&(t[o]=e[o],a[o]=!0);e=!1!==r&&u(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},W=(e,t,r)=>{e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;let n=e.indexOf(t,r);return -1!==n&&n===r},Q=e=>{if(!e)return null;if(m(e))return e;let t=e.length;if(!x(t))return null;let r=Array(t);for(;t-- >0;)r[t]=e[t];return r},J=(e=>t=>e&&t instanceof e)("undefined"!=typeof Uint8Array&&u(Uint8Array)),Z=(e,t)=>{let r,n=(e&&e[h]).call(e);for(;(r=n.next())&&!r.done;){let n=r.value;t.call(e,n[0],n[1])}},Y=(e,t)=>{let r,n=[];for(;null!==(r=e.exec(t));)n.push(r);return n},X=p("HTMLFormElement"),ee=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,r){return t.toUpperCase()+r}),et=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),er=p("RegExp"),en=(e,t)=>{let r=Object.getOwnPropertyDescriptors(e),n={};U(r,(r,i)=>{let s;!1!==(s=t(r,i,e))&&(n[i]=s||r)}),Object.defineProperties(e,n)},ei=e=>{en(e,(t,r)=>{if(A(e)&&-1!==["arguments","caller","callee"].indexOf(r))return!1;if(A(e[r])){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},es=(e,t)=>{let r={};return(e=>{e.forEach(e=>{r[e]=!0})})(m(e)?e:String(e).split(t)),r},eo=()=>{},ea=(e,t)=>null!=e&&Number.isFinite(e*=1)?e:t;function el(e){return!!(e&&A(e.append)&&"FormData"===e[d]&&e[h])}let ec=e=>{let t=Array(10),r=(e,n)=>{if(S(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;let i=m(e)?[]:{};return U(e,(e,t)=>{let s=r(e,n+1);y(s)||(i[t]=s)}),t[n]=void 0,i}}return e};return r(e,0)},eu=p("AsyncFunction"),eh=e=>e&&(S(e)||A(e))&&A(e.then)&&A(e.catch),ed=(i="function"==typeof setImmediate,s=A($.postMessage),i?setImmediate:s?((e,t)=>($.addEventListener("message",({source:r,data:n})=>{r===$&&n===e&&t.length&&t.shift()()},!1),r=>{t.push(r),$.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e)),ef="undefined"!=typeof queueMicrotask?queueMicrotask.bind($):void 0!==l&&l.nextTick||ed,ep=e=>null!=e&&A(e[h]),eg={isArray:m,isArrayBuffer:w,isBuffer:b,isFormData:O,isArrayBufferView:v,isString:E,isNumber:x,isBoolean:k,isObject:S,isPlainObject:_,isReadableStream:D,isRequest:B,isResponse:M,isHeaders:L,isUndefined:y,isDate:I,isFile:C,isBlob:T,isRegExp:er,isFunction:A,isStream:R,isURLSearchParams:N,isTypedArray:J,isFileList:P,forEach:U,merge:q,extend:z,trim:F,stripBOM:V,inherits:K,toFlatObject:G,kindOf:f,kindOfTest:p,endsWith:W,toArray:Q,forEachEntry:Z,matchAll:Y,isHTMLForm:X,hasOwnProperty:et,hasOwnProp:et,reduceDescriptors:en,freezeMethods:ei,toObjectSet:es,toCamelCase:ee,noop:eo,toFiniteNumber:ea,findKey:j,global:$,isContextDefined:H,isSpecCompliantForm:el,toJSONObject:ec,isAsyncFn:eu,isThenable:eh,setImmediate:ed,asap:ef,isIterable:ep};function em(e,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}eg.inherits(em,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:eg.toJSONObject(this.config),code:this.code,status:this.status}}});let ey=em.prototype,eb={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{eb[e]={value:e}}),Object.defineProperties(em,eb),Object.defineProperty(ey,"isAxiosError",{value:!0}),em.from=(e,t,r,n,i,s)=>{let o=Object.create(ey);return eg.toFlatObject(e,o,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),em.call(o,e.message,t,r,n,i),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};let ew=em,ev=null;var eE=r(44134).Buffer;function eA(e){return eg.isPlainObject(e)||eg.isArray(e)}function ex(e){return eg.endsWith(e,"[]")?e.slice(0,-2):e}function eS(e,t,r){return e?e.concat(t).map(function(e,t){return e=ex(e),!r&&t?"["+e+"]":e}).join(r?".":""):t}function ek(e){return eg.isArray(e)&&!e.some(eA)}let e_=eg.toFlatObject(eg,{},null,function(e){return/^is[A-Z]/.test(e)}),eI=function(e,t,r){if(!eg.isObject(e))throw TypeError("target must be an object");t=t||new(ev||FormData);let n=(r=eg.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!eg.isUndefined(t[e])})).metaTokens,i=r.visitor||c,s=r.dots,o=r.indexes,a=(r.Blob||"undefined"!=typeof Blob&&Blob)&&eg.isSpecCompliantForm(t);if(!eg.isFunction(i))throw TypeError("visitor must be a function");function l(e){if(null===e)return"";if(eg.isDate(e))return e.toISOString();if(!a&&eg.isBlob(e))throw new ew("Blob is not supported. Use a Buffer instead.");return eg.isArrayBuffer(e)||eg.isTypedArray(e)?a&&"function"==typeof Blob?new Blob([e]):eE.from(e):e}function c(e,r,i){let a=e;if(e&&!i&&"object"==typeof e){if(eg.endsWith(r,"{}"))r=n?r:r.slice(0,-2),e=JSON.stringify(e);else if(eg.isArray(e)&&ek(e)||(eg.isFileList(e)||eg.endsWith(r,"[]"))&&(a=eg.toArray(e)))return r=ex(r),a.forEach(function(e,n){eg.isUndefined(e)||null===e||t.append(!0===o?eS([r],n,s):null===o?r:r+"[]",l(e))}),!1}return!!eA(e)||(t.append(eS(i,r,s),l(e)),!1)}let u=[],h=Object.assign(e_,{defaultVisitor:c,convertValue:l,isVisitable:eA});function d(e,r){if(!eg.isUndefined(e)){if(-1!==u.indexOf(e))throw Error("Circular reference detected in "+r.join("."));u.push(e),eg.forEach(e,function(e,n){!0===(!(eg.isUndefined(e)||null===e)&&i.call(t,e,eg.isString(n)?n.trim():n,r,h))&&d(e,r?r.concat(n):[n])}),u.pop()}}if(!eg.isObject(e))throw TypeError("data must be an object");return d(e),t};function eC(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function eT(e,t){this._pairs=[],e&&eI(e,this,t)}let eP=eT.prototype;eP.append=function(e,t){this._pairs.push([e,t])},eP.toString=function(e){let t=e?function(t){return e.call(this,t,eC)}:eC;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};let eR=eT;function eO(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function eN(e,t,r){let n;if(!t)return e;let i=r&&r.encode||eO;eg.isFunction(r)&&(r={serialize:r});let s=r&&r.serialize;if(n=s?s(t,r):eg.isURLSearchParams(t)?t.toString():new eR(t,r).toString(i)){let t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}class eD{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){eg.forEach(this.handlers,function(t){null!==t&&e(t)})}}let eB=eD,eM={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},eL={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:eR,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},eF="undefined"!=typeof window&&"undefined"!=typeof document,eU="object"==typeof navigator&&navigator||void 0,ej=eF&&(!eU||0>["ReactNative","NativeScript","NS"].indexOf(eU.product)),e$="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,eH=eF&&window.location.href||"http://localhost",eq={...o,...eL};function ez(e,t){return eI(e,new eq.classes.URLSearchParams,Object.assign({visitor:function(e,t,r,n){return eq.isNode&&eg.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}function eV(e){return eg.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}function eK(e){let t,r,n={},i=Object.keys(e),s=i.length;for(t=0;t<s;t++)n[r=i[t]]=e[r];return n}let eG=function(e){function t(e,r,n,i){let s=e[i++];if("__proto__"===s)return!0;let o=Number.isFinite(+s),a=i>=e.length;return(s=!s&&eg.isArray(n)?n.length:s,a)?eg.hasOwnProp(n,s)?n[s]=[n[s],r]:n[s]=r:(n[s]&&eg.isObject(n[s])||(n[s]=[]),t(e,r,n[s],i)&&eg.isArray(n[s])&&(n[s]=eK(n[s]))),!o}if(eg.isFormData(e)&&eg.isFunction(e.entries)){let r={};return eg.forEachEntry(e,(e,n)=>{t(eV(e),n,r,0)}),r}return null};function eW(e,t,r){if(eg.isString(e))try{return(t||JSON.parse)(e),eg.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(e)}let eQ={transitional:eM,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){let r,n=t.getContentType()||"",i=n.indexOf("application/json")>-1,s=eg.isObject(e);if(s&&eg.isHTMLForm(e)&&(e=new FormData(e)),eg.isFormData(e))return i?JSON.stringify(eG(e)):e;if(eg.isArrayBuffer(e)||eg.isBuffer(e)||eg.isStream(e)||eg.isFile(e)||eg.isBlob(e)||eg.isReadableStream(e))return e;if(eg.isArrayBufferView(e))return e.buffer;if(eg.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return ez(e,this.formSerializer).toString();if((r=eg.isFileList(e))||n.indexOf("multipart/form-data")>-1){let t=this.env&&this.env.FormData;return eI(r?{"files[]":e}:e,t&&new t,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),eW(e)):e}],transformResponse:[function(e){let t=this.transitional||eQ.transitional,r=t&&t.forcedJSONParsing,n="json"===this.responseType;if(eg.isResponse(e)||eg.isReadableStream(e))return e;if(e&&eg.isString(e)&&(r&&!this.responseType||n)){let r=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(e){if(r){if("SyntaxError"===e.name)throw ew.from(e,ew.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:eq.classes.FormData,Blob:eq.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};eg.forEach(["delete","get","head","post","put","patch"],e=>{eQ.headers[e]={}});let eJ=eQ,eZ=eg.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),eY=e=>{let t,r,n,i={};return e&&e.split("\n").forEach(function(e){n=e.indexOf(":"),t=e.substring(0,n).trim().toLowerCase(),r=e.substring(n+1).trim(),!t||i[t]&&eZ[t]||("set-cookie"===t?i[t]?i[t].push(r):i[t]=[r]:i[t]=i[t]?i[t]+", "+r:r)}),i},eX=Symbol("internals");function e0(e){return e&&String(e).trim().toLowerCase()}function e1(e){return!1===e||null==e?e:eg.isArray(e)?e.map(e1):String(e)}function e2(e){let t,r=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;for(;t=n.exec(e);)r[t[1]]=t[2];return r}let e3=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function e4(e,t,r,n,i){if(eg.isFunction(n))return n.call(this,t,r);if(i&&(t=r),eg.isString(t)){if(eg.isString(n))return -1!==t.indexOf(n);if(eg.isRegExp(n))return n.test(t)}}function e5(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function e6(e,t){let r=eg.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(e,r,i){return this[n].call(this,t,e,r,i)},configurable:!0})})}class e8{constructor(e){e&&this.set(e)}set(e,t,r){let n=this;function i(e,t,r){let i=e0(t);if(!i)throw Error("header name must be a non-empty string");let s=eg.findKey(n,i);s&&void 0!==n[s]&&!0!==r&&(void 0!==r||!1===n[s])||(n[s||t]=e1(e))}let s=(e,t)=>eg.forEach(e,(e,r)=>i(e,r,t));if(eg.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(eg.isString(e)&&(e=e.trim())&&!e3(e))s(eY(e),t);else if(eg.isObject(e)&&eg.isIterable(e)){let r={},n,i;for(let t of e){if(!eg.isArray(t))throw TypeError("Object iterator must return a key-value pair");r[i=t[0]]=(n=r[i])?eg.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}s(r,t)}else null!=e&&i(t,e,r);return this}get(e,t){if(e=e0(e)){let r=eg.findKey(this,e);if(r){let e=this[r];if(!t)return e;if(!0===t)return e2(e);if(eg.isFunction(t))return t.call(this,e,r);if(eg.isRegExp(t))return t.exec(e);throw TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=e0(e)){let r=eg.findKey(this,e);return!!(r&&void 0!==this[r]&&(!t||e4(this,this[r],r,t)))}return!1}delete(e,t){let r=this,n=!1;function i(e){if(e=e0(e)){let i=eg.findKey(r,e);i&&(!t||e4(r,r[i],i,t))&&(delete r[i],n=!0)}}return eg.isArray(e)?e.forEach(i):i(e),n}clear(e){let t=Object.keys(this),r=t.length,n=!1;for(;r--;){let i=t[r];(!e||e4(this,this[i],i,e,!0))&&(delete this[i],n=!0)}return n}normalize(e){let t=this,r={};return eg.forEach(this,(n,i)=>{let s=eg.findKey(r,i);if(s){t[s]=e1(n),delete t[i];return}let o=e?e5(i):String(i).trim();o!==i&&delete t[i],t[o]=e1(n),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){let t=Object.create(null);return eg.forEach(this,(r,n)=>{null!=r&&!1!==r&&(t[n]=e&&eg.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){let r=new this(e);return t.forEach(e=>r.set(e)),r}static accessor(e){let t=(this[eX]=this[eX]={accessors:{}}).accessors,r=this.prototype;function n(e){let n=e0(e);t[n]||(e6(r,e),t[n]=!0)}return eg.isArray(e)?e.forEach(n):n(e),this}}e8.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),eg.reduceDescriptors(e8.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[r]=e}}}),eg.freezeMethods(e8);let e7=e8;function e9(e,t){let r=this||eJ,n=t||r,i=e7.from(n.headers),s=n.data;return eg.forEach(e,function(e){s=e.call(r,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function te(e){return!!(e&&e.__CANCEL__)}function tt(e,t,r){ew.call(this,null==e?"canceled":e,ew.ERR_CANCELED,t,r),this.name="CanceledError"}eg.inherits(tt,ew,{__CANCEL__:!0});let tr=tt;function tn(e,t,r){let n=r.config.validateStatus;!r.status||!n||n(r.status)?e(r):t(new ew("Request failed with status code "+r.status,[ew.ERR_BAD_REQUEST,ew.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function ti(e){let t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}let ts=function(e,t){let r,n=Array(e=e||10),i=Array(e),s=0,o=0;return t=void 0!==t?t:1e3,function(a){let l=Date.now(),c=i[o];r||(r=l),n[s]=a,i[s]=l;let u=o,h=0;for(;u!==s;)h+=n[u++],u%=e;if((s=(s+1)%e)===o&&(o=(o+1)%e),l-r<t)return;let d=c&&l-c;return d?Math.round(1e3*h/d):void 0}},to=function(e,t){let r,n,i=0,s=1e3/t,o=(t,s=Date.now())=>{i=s,r=null,n&&(clearTimeout(n),n=null),e.apply(null,t)};return[(...e)=>{let t=Date.now(),a=t-i;a>=s?o(e,t):(r=e,n||(n=setTimeout(()=>{n=null,o(r)},s-a)))},()=>r&&o(r)]},ta=(e,t,r=3)=>{let n=0,i=ts(50,250);return to(r=>{let s=r.loaded,o=r.lengthComputable?r.total:void 0,a=s-n,l=i(a),c=s<=o;n=s,e({loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:l||void 0,estimated:l&&o&&c?(o-s)/l:void 0,event:r,lengthComputable:null!=o,[t?"download":"upload"]:!0})},r)},tl=(e,t)=>{let r=null!=e;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},tc=e=>(...t)=>eg.asap(()=>e(...t)),tu=eq.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,eq.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(eq.origin),eq.navigator&&/(msie|trident)/i.test(eq.navigator.userAgent)):()=>!0,th=eq.hasStandardBrowserEnv?{write(e,t,r,n,i,s){let o=[e+"="+encodeURIComponent(t)];eg.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),eg.isString(n)&&o.push("path="+n),eg.isString(i)&&o.push("domain="+i),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read(e){let t=document.cookie.match(RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function td(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function tf(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function tp(e,t,r){let n=!td(t);return e&&(n||!1==r)?tf(e,t):t}let tg=e=>e instanceof e7?{...e}:e;function tm(e,t){t=t||{};let r={};function n(e,t,r,n){return eg.isPlainObject(e)&&eg.isPlainObject(t)?eg.merge.call({caseless:n},e,t):eg.isPlainObject(t)?eg.merge({},t):eg.isArray(t)?t.slice():t}function i(e,t,r,i){return eg.isUndefined(t)?eg.isUndefined(e)?void 0:n(void 0,e,r,i):n(e,t,r,i)}function s(e,t){if(!eg.isUndefined(t))return n(void 0,t)}function o(e,t){return eg.isUndefined(t)?eg.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function a(r,i,s){return s in t?n(r,i):s in e?n(void 0,r):void 0}let l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(e,t,r)=>i(tg(e),tg(t),r,!0)};return eg.forEach(Object.keys(Object.assign({},e,t)),function(n){let s=l[n]||i,o=s(e[n],t[n],n);eg.isUndefined(o)&&s!==a||(r[n]=o)}),r}let ty=e=>{let t,r=tm({},e),{data:n,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:o,headers:a,auth:l}=r;if(r.headers=a=e7.from(a),r.url=eN(tp(r.baseURL,r.url,r.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&a.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),eg.isFormData(n)){if(eq.hasStandardBrowserEnv||eq.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(!1!==(t=a.getContentType())){let[e,...r]=t?t.split(";").map(e=>e.trim()).filter(Boolean):[];a.setContentType([e||"multipart/form-data",...r].join("; "))}}if(eq.hasStandardBrowserEnv&&(i&&eg.isFunction(i)&&(i=i(r)),i||!1!==i&&tu(r.url))){let e=s&&o&&th.read(o);e&&a.set(s,e)}return r},tb="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(t,r){let n,i,s,o,a,l=ty(e),c=l.data,u=e7.from(l.headers).normalize(),{responseType:h,onUploadProgress:d,onDownloadProgress:f}=l;function p(){o&&o(),a&&a(),l.cancelToken&&l.cancelToken.unsubscribe(n),l.signal&&l.signal.removeEventListener("abort",n)}let g=new XMLHttpRequest;function m(){if(!g)return;let n=e7.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders());tn(function(e){t(e),p()},function(e){r(e),p()},{data:h&&"text"!==h&&"json"!==h?g.response:g.responseText,status:g.status,statusText:g.statusText,headers:n,config:e,request:g}),g=null}g.open(l.method.toUpperCase(),l.url,!0),g.timeout=l.timeout,"onloadend"in g?g.onloadend=m:g.onreadystatechange=function(){g&&4===g.readyState&&(0!==g.status||g.responseURL&&0===g.responseURL.indexOf("file:"))&&setTimeout(m)},g.onabort=function(){g&&(r(new ew("Request aborted",ew.ECONNABORTED,e,g)),g=null)},g.onerror=function(){r(new ew("Network Error",ew.ERR_NETWORK,e,g)),g=null},g.ontimeout=function(){let t=l.timeout?"timeout of "+l.timeout+"ms exceeded":"timeout exceeded",n=l.transitional||eM;l.timeoutErrorMessage&&(t=l.timeoutErrorMessage),r(new ew(t,n.clarifyTimeoutError?ew.ETIMEDOUT:ew.ECONNABORTED,e,g)),g=null},void 0===c&&u.setContentType(null),"setRequestHeader"in g&&eg.forEach(u.toJSON(),function(e,t){g.setRequestHeader(t,e)}),eg.isUndefined(l.withCredentials)||(g.withCredentials=!!l.withCredentials),h&&"json"!==h&&(g.responseType=l.responseType),f&&([s,a]=ta(f,!0),g.addEventListener("progress",s)),d&&g.upload&&([i,o]=ta(d),g.upload.addEventListener("progress",i),g.upload.addEventListener("loadend",o)),(l.cancelToken||l.signal)&&(n=t=>{g&&(r(!t||t.type?new tr(null,e,g):t),g.abort(),g=null)},l.cancelToken&&l.cancelToken.subscribe(n),l.signal&&(l.signal.aborted?n():l.signal.addEventListener("abort",n)));let y=ti(l.url);if(y&&-1===eq.protocols.indexOf(y))return void r(new ew("Unsupported protocol "+y+":",ew.ERR_BAD_REQUEST,e));g.send(c||null)})},tw=(e,t)=>{let{length:r}=e=e?e.filter(Boolean):[];if(t||r){let r,n=new AbortController,i=function(e){if(!r){r=!0,o();let t=e instanceof Error?e:this.reason;n.abort(t instanceof ew?t:new tr(t instanceof Error?t.message:t))}},s=t&&setTimeout(()=>{s=null,i(new ew(`timeout ${t} of ms exceeded`,ew.ETIMEDOUT))},t),o=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)}),e=null)};e.forEach(e=>e.addEventListener("abort",i));let{signal:a}=n;return a.unsubscribe=()=>eg.asap(o),a}},tv=function*(e,t){let r,n=e.byteLength;if(!t||n<t)return void(yield e);let i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},tE=async function*(e,t){for await(let r of tA(e))yield*tv(r,t)},tA=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);let t=e.getReader();try{for(;;){let{done:e,value:r}=await t.read();if(e)break;yield r}}finally{await t.cancel()}},tx=(e,t,r,n)=>{let i,s=tE(e,t),o=0,a=e=>{!i&&(i=!0,n&&n(e))};return new ReadableStream({async pull(e){try{let{done:t,value:n}=await s.next();if(t){a(),e.close();return}let i=n.byteLength;if(r){let e=o+=i;r(e)}e.enqueue(new Uint8Array(n))}catch(e){throw a(e),e}},cancel:e=>(a(e),s.return())},{highWaterMark:2})},tS="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,tk=tS&&"function"==typeof ReadableStream,t_=tS&&("function"==typeof TextEncoder?(n=new TextEncoder,e=>n.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer())),tI=(e,...t)=>{try{return!!e(...t)}catch(e){return!1}},tC=tk&&tI(()=>{let e=!1,t=new Request(eq.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),tT=65536,tP=tk&&tI(()=>eg.isReadableStream(new Response("").body)),tR={stream:tP&&(e=>e.body)};tS&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{tR[t]||(tR[t]=eg.isFunction(e[t])?e=>e[t]():(e,r)=>{throw new ew(`Response type '${t}' is not supported`,ew.ERR_NOT_SUPPORT,r)})})})(new Response);let tO=async e=>{if(null==e)return 0;if(eg.isBlob(e))return e.size;if(eg.isSpecCompliantForm(e)){let t=new Request(eq.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return eg.isArrayBufferView(e)||eg.isArrayBuffer(e)?e.byteLength:(eg.isURLSearchParams(e)&&(e+=""),eg.isString(e))?(await t_(e)).byteLength:void 0},tN=async(e,t)=>{let r=eg.toFiniteNumber(e.getContentLength());return null==r?tO(t):r},tD={http:ev,xhr:tb,fetch:tS&&(async e=>{let t,r,{url:n,method:i,data:s,signal:o,cancelToken:a,timeout:l,onDownloadProgress:c,onUploadProgress:u,responseType:h,headers:d,withCredentials:f="same-origin",fetchOptions:p}=ty(e);h=h?(h+"").toLowerCase():"text";let g=tw([o,a&&a.toAbortSignal()],l),m=g&&g.unsubscribe&&(()=>{g.unsubscribe()});try{if(u&&tC&&"get"!==i&&"head"!==i&&0!==(r=await tN(d,s))){let e,t=new Request(n,{method:"POST",body:s,duplex:"half"});if(eg.isFormData(s)&&(e=t.headers.get("content-type"))&&d.setContentType(e),t.body){let[e,n]=tl(r,ta(tc(u)));s=tx(t.body,tT,e,n)}}eg.isString(f)||(f=f?"include":"omit");let o="credentials"in Request.prototype;t=new Request(n,{...p,signal:g,method:i.toUpperCase(),headers:d.normalize().toJSON(),body:s,duplex:"half",credentials:o?f:void 0});let a=await fetch(t),l=tP&&("stream"===h||"response"===h);if(tP&&(c||l&&m)){let e={};["status","statusText","headers"].forEach(t=>{e[t]=a[t]});let t=eg.toFiniteNumber(a.headers.get("content-length")),[r,n]=c&&tl(t,ta(tc(c),!0))||[];a=new Response(tx(a.body,tT,r,()=>{n&&n(),m&&m()}),e)}h=h||"text";let y=await tR[eg.findKey(tR,h)||"text"](a,e);return!l&&m&&m(),await new Promise((r,n)=>{tn(r,n,{data:y,headers:e7.from(a.headers),status:a.status,statusText:a.statusText,config:e,request:t})})}catch(r){if(m&&m(),r&&"TypeError"===r.name&&/Load failed|fetch/i.test(r.message))throw Object.assign(new ew("Network Error",ew.ERR_NETWORK,e,t),{cause:r.cause||r});throw ew.from(r,r&&r.code,e,t)}})};eg.forEach(tD,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}});let tB=e=>`- ${e}`,tM=e=>eg.isFunction(e)||null===e||!1===e,tL={getAdapter:e=>{let t,r,{length:n}=e=eg.isArray(e)?e:[e],i={};for(let s=0;s<n;s++){let n;if(r=t=e[s],!tM(t)&&void 0===(r=tD[(n=String(t)).toLowerCase()]))throw new ew(`Unknown adapter '${n}'`);if(r)break;i[n||"#"+s]=r}if(!r){let e=Object.entries(i).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));throw new ew("There is no suitable adapter to dispatch the request "+(n?e.length>1?"since :\n"+e.map(tB).join("\n"):" "+tB(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r}};function tF(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new tr(null,e)}function tU(e){return tF(e),e.headers=e7.from(e.headers),e.data=e9.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),tL.getAdapter(e.adapter||eJ.adapter)(e).then(function(t){return tF(e),t.data=e9.call(e,e.transformResponse,t),t.headers=e7.from(t.headers),t},function(t){return!te(t)&&(tF(e),t&&t.response&&(t.response.data=e9.call(e,e.transformResponse,t.response),t.response.headers=e7.from(t.response.headers))),Promise.reject(t)})}let tj="1.9.0",t$={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{t$[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});let tH={};t$.transitional=function(e,t,r){function n(e,t){return"[Axios v"+tj+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return(r,i,s)=>{if(!1===e)throw new ew(n(i," has been removed"+(t?" in "+t:"")),ew.ERR_DEPRECATED);return t&&!tH[i]&&(tH[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,i,s)}},t$.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};let tq={assertOptions:function(e,t,r){if("object"!=typeof e)throw new ew("options must be an object",ew.ERR_BAD_OPTION_VALUE);let n=Object.keys(e),i=n.length;for(;i-- >0;){let s=n[i],o=t[s];if(o){let t=e[s],r=void 0===t||o(t,s,e);if(!0!==r)throw new ew("option "+s+" must be "+r,ew.ERR_BAD_OPTION_VALUE);continue}if(!0!==r)throw new ew("Unknown option "+s,ew.ERR_BAD_OPTION)}},validators:t$},tz=tq.validators;class tV{constructor(e){this.defaults=e||{},this.interceptors={request:new eB,response:new eB}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=Error();let r=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?r&&!String(e.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+r):e.stack=r}catch(e){}}throw e}}_request(e,t){let r,n;"string"==typeof e?(t=t||{}).url=e:t=e||{};let{transitional:i,paramsSerializer:s,headers:o}=t=tm(this.defaults,t);void 0!==i&&tq.assertOptions(i,{silentJSONParsing:tz.transitional(tz.boolean),forcedJSONParsing:tz.transitional(tz.boolean),clarifyTimeoutError:tz.transitional(tz.boolean)},!1),null!=s&&(eg.isFunction(s)?t.paramsSerializer={serialize:s}:tq.assertOptions(s,{encode:tz.function,serialize:tz.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),tq.assertOptions(t,{baseUrl:tz.spelling("baseURL"),withXsrfToken:tz.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=o&&eg.merge(o.common,o[t.method]);o&&eg.forEach(["delete","get","head","post","put","patch","common"],e=>{delete o[e]}),t.headers=e7.concat(a,o);let l=[],c=!0;this.interceptors.request.forEach(function(e){("function"!=typeof e.runWhen||!1!==e.runWhen(t))&&(c=c&&e.synchronous,l.unshift(e.fulfilled,e.rejected))});let u=[];this.interceptors.response.forEach(function(e){u.push(e.fulfilled,e.rejected)});let h=0;if(!c){let e=[tU.bind(this),void 0];for(e.unshift.apply(e,l),e.push.apply(e,u),n=e.length,r=Promise.resolve(t);h<n;)r=r.then(e[h++],e[h++]);return r}n=l.length;let d=t;for(h=0;h<n;){let e=l[h++],t=l[h++];try{d=e(d)}catch(e){t.call(this,e);break}}try{r=tU.call(this,d)}catch(e){return Promise.reject(e)}for(h=0,n=u.length;h<n;)r=r.then(u[h++],u[h++]);return r}getUri(e){return eN(tp((e=tm(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}eg.forEach(["delete","get","head","options"],function(e){tV.prototype[e]=function(t,r){return this.request(tm(r||{},{method:e,url:t,data:(r||{}).data}))}}),eg.forEach(["post","put","patch"],function(e){function t(t){return function(r,n,i){return this.request(tm(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}tV.prototype[e]=t(),tV.prototype[e+"Form"]=t(!0)});let tK=tV;class tG{constructor(e){let t;if("function"!=typeof e)throw TypeError("executor must be a function.");this.promise=new Promise(function(e){t=e});let r=this;this.promise.then(e=>{if(!r._listeners)return;let t=r._listeners.length;for(;t-- >0;)r._listeners[t](e);r._listeners=null}),this.promise.then=e=>{let t,n=new Promise(e=>{r.subscribe(e),t=e}).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e(function(e,n,i){r.reason||(r.reason=new tr(e,n,i),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason)return void e(this.reason);this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){let e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new tG(function(t){e=t}),cancel:e}}}let tW=tG;function tQ(e){return function(t){return e.apply(null,t)}}function tJ(e){return eg.isObject(e)&&!0===e.isAxiosError}let tZ={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(tZ).forEach(([e,t])=>{tZ[t]=e});let tY=tZ;function tX(e){let t=new tK(e),r=a(tK.prototype.request,t);return eg.extend(r,tK.prototype,t,{allOwnKeys:!0}),eg.extend(r,t,null,{allOwnKeys:!0}),r.create=function(t){return tX(tm(e,t))},r}let t0=tX(eJ);t0.Axios=tK,t0.CanceledError=tr,t0.CancelToken=tW,t0.isCancel=te,t0.VERSION=tj,t0.toFormData=eI,t0.AxiosError=ew,t0.Cancel=t0.CanceledError,t0.all=function(e){return Promise.all(e)},t0.spread=tQ,t0.isAxiosError=tJ,t0.mergeConfig=tm,t0.AxiosHeaders=e7,t0.formToJSON=e=>eG(eg.isHTMLForm(e)?new FormData(e):e),t0.getAdapter=tL.getAdapter,t0.HttpStatusCode=tY,t0.default=t0;let t1=t0,{Axios:t2,AxiosError:t3,CanceledError:t4,isCancel:t5,CancelToken:t6,VERSION:t8,all:t7,Cancel:t9,isAxiosError:re,spread:rt,toFormData:rr,AxiosHeaders:rn,HttpStatusCode:ri,formToJSON:rs,getAdapter:ro,mergeConfig:ra}=t1;var rl=r(57116);class rc{articleName;versionManager;constructor(e,t){this.articleName=e,this.versionManager=new rl.m9(t)}getContent(e){let t=[];return t=e?this.versionManager.getBranch(e):this.versionManager.getMainBranch(),(0,rl.a6)(t)}getVersions(){let e=new Set(this.versionManager.getMainBranch().map(e=>e.id));return this.versionManager.getAllVersions().map(t=>({id:t.id,date:t.date,parent:t.parent,mainBranch:e.has(t.id)}))}getCurrentVersionID(){let e=this.versionManager.getMainBranch();if(0===e.length)throw Error("No versions found");return e[e.length-1].id}newContent(e,t){let r;if(t){let n=this.versionManager.getBranch(t),i=(0,rl.a6)(n);r=(0,rl.JL)(i,e,t)}else r=(0,rl.JL)("",e,t??null);return this.versionManager.addVersion(r),r}}class ru{url;constructor(e){this.url=e}async getArticle(e){let{data:t,status:r}=await t1.get(`${this.url}/articles/${e}`);return r===ri.NotFound?Promise.reject("Article not found"):r!==ri.Ok?Promise.reject("Server error"):new rc(e,JSON.parse(t.versions))}async newArticle(e,t){let r=(0,rl.JL)("",t),{status:n}=await t1.post(`${this.url}/articles`,{name:e,version:r});return n===ri.Conflict?Promise.reject("Article already exists"):n!==ri.Created?Promise.reject(`Server error: ${n}`):void 0}async addVersion(e,t,r){let n=(await this.getArticle(e)).newContent(t,r),{status:i}=await t1.patch(`${this.url}/articles/${e}`,n);return i===ri.BadRequest?Promise.reject("Bad request while editing article"):i===ri.NotFound?Promise.reject("Article to edit not found"):void 0}async getArticleList(){let{data:e}=await t1.get(`${this.url}/articles`);return e}}class rh{articleRepository;versionManager;lastVersionFetchedByArticle;async start(e){console.log("Initializing"),this.articleRepository=new ru(e),this.lastVersionFetchedByArticle=new Map}async getArticle(e,t){let r=await this.articleRepository.getArticle(e);return this.lastVersionFetchedByArticle.set(e,r.getCurrentVersionID()),{name:e,content:r.getContent(t),versionsInfo:r.getVersions()}}async newArticle(e,t){if(0===e.length)throw Error("Name cannot be empty");await this.articleRepository.newArticle(e,t)}async editArticle(e,t){if(0===e.length)throw Error("No name given");let r=this.lastVersionFetchedByArticle.get(e);if(!r)throw Error(`Article ${e} was not previously fetched. Fetched articles: ${this.lastVersionFetchedByArticle.keys()}`);await this.articleRepository.addVersion(e,t,r)}async getArticleList(){return this.articleRepository.getArticleList()}async searchArticles(e,t=10,r=0){return[]}}let rd=rh;async function rf(e){let t=new rd;return await t.start(e),t}},43716:(e,t,r)=>{"use strict";r.r(t),r.d(t,{base32:()=>i,base32hex:()=>l,base32hexpad:()=>u,base32hexpadupper:()=>h,base32hexupper:()=>c,base32pad:()=>o,base32padupper:()=>a,base32upper:()=>s,base32z:()=>d});var n=r(52215);let i=(0,n.yE)({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),s=(0,n.yE)({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),o=(0,n.yE)({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),a=(0,n.yE)({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),l=(0,n.yE)({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),c=(0,n.yE)({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),u=(0,n.yE)({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),h=(0,n.yE)({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),d=(0,n.yE)({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})},44134:(e,t,r)=>{"use strict";let n=r(57719),i=r(7610),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=c,t.SlowBuffer=v,t.INSPECT_MAX_BYTES=50;let o=0x7fffffff;function a(){try{let e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}function l(e){if(e>o)throw RangeError('The value "'+e+'" is invalid for option "size"');let t=new Uint8Array(e);return Object.setPrototypeOf(t,c.prototype),t}function c(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return f(e)}return u(e,t,r)}function u(e,t,r){if("string"==typeof e)return p(e,t);if(ArrayBuffer.isView(e))return m(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(eo(e,ArrayBuffer)||e&&eo(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(eo(e,SharedArrayBuffer)||e&&eo(e.buffer,SharedArrayBuffer)))return y(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');let n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return c.from(n,t,r);let i=b(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return c.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function h(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function d(e,t,r){return(h(e),e<=0)?l(e):void 0!==t?"string"==typeof r?l(e).fill(t,r):l(e).fill(t):l(e)}function f(e){return h(e),l(e<0?0:0|w(e))}function p(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!c.isEncoding(t))throw TypeError("Unknown encoding: "+t);let r=0|E(e,t),n=l(r),i=n.write(e,t);return i!==r&&(n=n.slice(0,i)),n}function g(e){let t=e.length<0?0:0|w(e.length),r=l(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function m(e){if(eo(e,Uint8Array)){let t=new Uint8Array(e);return y(t.buffer,t.byteOffset,t.byteLength)}return g(e)}function y(e,t,r){let n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),c.prototype),n}function b(e){if(c.isBuffer(e)){let t=0|w(e.length),r=l(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||ea(e.length)?l(0):g(e):"Buffer"===e.type&&Array.isArray(e.data)?g(e.data):void 0}function w(e){if(e>=o)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function v(e){return+e!=e&&(e=0),c.alloc(+e)}function E(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||eo(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return et(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return ei(e).length;default:if(i)return n?-1:et(e).length;t=(""+t).toLowerCase(),i=!0}}function A(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return L(this,t,r);case"utf8":case"utf-8":return O(this,t,r);case"ascii":return B(this,t,r);case"latin1":case"binary":return M(this,t,r);case"base64":return R(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,t,r);default:if(n)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function x(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function S(e,t,r,n,i){if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),ea(r*=1)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(i)return -1;else r=e.length-1;else if(r<0)if(!i)return -1;else r=0;if("string"==typeof t&&(t=c.from(t,n)),c.isBuffer(t))return 0===t.length?-1:k(e,t,r,n,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return k(e,[t],r,n,i)}throw TypeError("val must be string, number or Buffer")}function k(e,t,r,n,i){let s,o=1,a=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;o=2,a/=2,l/=2,r/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){let n=-1;for(s=r;s<a;s++)if(c(e,s)===c(t,-1===n?0:s-n)){if(-1===n&&(n=s),s-n+1===l)return n*o}else -1!==n&&(s-=s-n),n=-1}else for(r+l>a&&(r=a-l),s=r;s>=0;s--){let r=!0;for(let n=0;n<l;n++)if(c(e,s+n)!==c(t,n)){r=!1;break}if(r)return s}return -1}function _(e,t,r,n){let i;r=Number(r)||0;let s=e.length-r;n?(n=Number(n))>s&&(n=s):n=s;let o=t.length;for(n>o/2&&(n=o/2),i=0;i<n;++i){let n=parseInt(t.substr(2*i,2),16);if(ea(n))break;e[r+i]=n}return i}function I(e,t,r,n){return es(et(t,e.length-r),e,r,n)}function C(e,t,r,n){return es(er(t),e,r,n)}function T(e,t,r,n){return es(ei(t),e,r,n)}function P(e,t,r,n){return es(en(t,e.length-r),e,r,n)}function R(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function O(e,t,r){r=Math.min(e.length,r);let n=[],i=t;for(;i<r;){let t=e[i],s=null,o=t>239?4:t>223?3:t>191?2:1;if(i+o<=r){let r,n,a,l;switch(o){case 1:t<128&&(s=t);break;case 2:(192&(r=e[i+1]))==128&&(l=(31&t)<<6|63&r)>127&&(s=l);break;case 3:r=e[i+1],n=e[i+2],(192&r)==128&&(192&n)==128&&(l=(15&t)<<12|(63&r)<<6|63&n)>2047&&(l<55296||l>57343)&&(s=l);break;case 4:r=e[i+1],n=e[i+2],a=e[i+3],(192&r)==128&&(192&n)==128&&(192&a)==128&&(l=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&a)>65535&&l<1114112&&(s=l)}}null===s?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),i+=o}return D(n)}t.kMaxLength=0x7fffffff,c.TYPED_ARRAY_SUPPORT=a(),c.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=function(e,t,r){return u(e,t,r)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(e,t,r){return d(e,t,r)},c.allocUnsafe=function(e){return f(e)},c.allocUnsafeSlow=function(e){return f(e)},c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(e,t){if(eo(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),eo(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(e)||!c.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:+(n<r)},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){let r;if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;let n=c.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){let t=e[r];if(eo(t,Uint8Array))i+t.length>n.length?(c.isBuffer(t)||(t=c.from(t)),t.copy(n,i)):Uint8Array.prototype.set.call(n,t,i);else if(c.isBuffer(t))t.copy(n,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=t.length}return n},c.byteLength=E,c.prototype._isBuffer=!0,c.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)x(this,t,t+1);return this},c.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)x(this,t,t+3),x(this,t+1,t+2);return this},c.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)x(this,t,t+7),x(this,t+1,t+6),x(this,t+2,t+5),x(this,t+3,t+4);return this},c.prototype.toString=function(){let e=this.length;return 0===e?"":0==arguments.length?O(this,0,e):A.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(e){if(!c.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){let e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(c.prototype[s]=c.prototype.inspect),c.prototype.compare=function(e,t,r,n,i){if(eo(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;let s=i-n,o=r-t,a=Math.min(s,o),l=this.slice(n,i),u=e.slice(t,r);for(let e=0;e<a;++e)if(l[e]!==u[e]){s=l[e],o=u[e];break}return s<o?-1:+(o<s)},c.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return S(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return S(this,e,t,r,!1)},c.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let s=!1;for(;;)switch(n){case"hex":return _(this,e,t,r);case"utf8":case"utf-8":return I(this,e,t,r);case"ascii":case"latin1":case"binary":return C(this,e,t,r);case"base64":return T(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,t,r);default:if(s)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};let N=4096;function D(e){let t=e.length;if(t<=N)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=N));return r}function B(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function M(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function L(e,t,r){let n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=t;n<r;++n)i+=el[e[n]];return i}function F(e,t,r){let n=e.slice(t,r),i="";for(let e=0;e<n.length-1;e+=2)i+=String.fromCharCode(n[e]+256*n[e+1]);return i}function U(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function j(e,t,r,n,i,s){if(!c.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function $(e,t,r,n,i){J(t,n,i,e,r,7);let s=Number(t&BigInt(0xffffffff));e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s;let o=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,r}function H(e,t,r,n,i){J(t,n,i,e,r,7);let s=Number(t&BigInt(0xffffffff));e[r+7]=s,s>>=8,e[r+6]=s,s>>=8,e[r+5]=s,s>>=8,e[r+4]=s;let o=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[r+3]=o,o>>=8,e[r+2]=o,o>>=8,e[r+1]=o,o>>=8,e[r]=o,r+8}function q(e,t,r,n,i,s){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function z(e,t,r,n,s){return t*=1,r>>>=0,s||q(e,t,r,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,r,n,23,4),r+4}function V(e,t,r,n,s){return t*=1,r>>>=0,s||q(e,t,r,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,r,n,52,8),r+8}c.prototype.slice=function(e,t){let r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);let n=this.subarray(e,t);return Object.setPrototypeOf(n,c.prototype),n},c.prototype.readUintLE=c.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||U(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return n},c.prototype.readUintBE=c.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||U(e,t,this.length);let n=this[e+--t],i=1;for(;t>0&&(i*=256);)n+=this[e+--t]*i;return n},c.prototype.readUint8=c.prototype.readUInt8=function(e,t){return e>>>=0,t||U(e,1,this.length),this[e]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||U(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||U(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||U(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||U(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readBigUInt64LE=ec(function(e){Z(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&Y(e,this.length-8);let n=t+256*this[++e]+65536*this[++e]+0x1000000*this[++e],i=this[++e]+256*this[++e]+65536*this[++e]+0x1000000*r;return BigInt(n)+(BigInt(i)<<BigInt(32))}),c.prototype.readBigUInt64BE=ec(function(e){Z(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&Y(e,this.length-8);let n=0x1000000*t+65536*this[++e]+256*this[++e]+this[++e],i=0x1000000*this[++e]+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)}),c.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||U(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},c.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||U(e,t,this.length);let n=t,i=1,s=this[e+--n];for(;n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},c.prototype.readInt8=function(e,t){return(e>>>=0,t||U(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||U(e,2,this.length);let r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},c.prototype.readInt16BE=function(e,t){e>>>=0,t||U(e,2,this.length);let r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||U(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||U(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readBigInt64LE=ec(function(e){Z(e>>>=0,"offset");let t=this[e],r=this[e+7];return(void 0===t||void 0===r)&&Y(e,this.length-8),(BigInt(this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24))<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+0x1000000*this[++e])}),c.prototype.readBigInt64BE=ec(function(e){Z(e>>>=0,"offset");let t=this[e],r=this[e+7];return(void 0===t||void 0===r)&&Y(e,this.length-8),(BigInt((t<<24)+65536*this[++e]+256*this[++e]+this[++e])<<BigInt(32))+BigInt(0x1000000*this[++e]+65536*this[++e]+256*this[++e]+r)}),c.prototype.readFloatLE=function(e,t){return e>>>=0,t||U(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||U(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||U(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||U(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){let n=Math.pow(2,8*r)-1;j(this,e,t,r,n,0)}let i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){let n=Math.pow(2,8*r)-1;j(this,e,t,r,n,0)}let i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},c.prototype.writeUint8=c.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigUInt64LE=ec(function(e,t=0){return $(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeBigUInt64BE=ec(function(e,t=0){return H(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeIntLE=function(e,t,r,n){if(e*=1,t>>>=0,!n){let n=Math.pow(2,8*r-1);j(this,e,t,r,n-1,-n)}let i=0,s=1,o=0;for(this[t]=255&e;++i<r&&(s*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/s|0)-o&255;return t+r},c.prototype.writeIntBE=function(e,t,r,n){if(e*=1,t>>>=0,!n){let n=Math.pow(2,8*r-1);j(this,e,t,r,n-1,-n)}let i=r-1,s=1,o=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/s|0)-o&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||j(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigInt64LE=ec(function(e,t=0){return $(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeBigInt64BE=ec(function(e,t=0){return H(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeFloatLE=function(e,t,r){return z(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return z(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return V(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return V(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,n){if(!c.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);let i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},c.prototype.fill=function(e,t,r,n){let i;if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){let t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{let s=c.isBuffer(e)?e:c.from(e,n),o=s.length;if(0===o)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=s[i%o]}return this};let K={};function G(e,t,r){K[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function W(e){let t="",r=e.length,n=+("-"===e[0]);for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function Q(e,t,r){Z(t,"offset"),(void 0===e[t]||void 0===e[t+r])&&Y(t,e.length-(r+1))}function J(e,t,r,n,i,s){if(e>r||e<t){let n,i="bigint"==typeof t?"n":"";throw n=s>3?0===t||t===BigInt(0)?`>= 0${i} and < 2${i} ** ${(s+1)*8}${i}`:`>= -(2${i} ** ${(s+1)*8-1}${i}) and < 2 ** ${(s+1)*8-1}${i}`:`>= ${t}${i} and <= ${r}${i}`,new K.ERR_OUT_OF_RANGE("value",n,e)}Q(n,i,s)}function Z(e,t){if("number"!=typeof e)throw new K.ERR_INVALID_ARG_TYPE(t,"number",e)}function Y(e,t,r){if(Math.floor(e)!==e)throw Z(e,r),new K.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new K.ERR_BUFFER_OUT_OF_BOUNDS;throw new K.ERR_OUT_OF_RANGE(r||"offset",`>= ${+!!r} and <= ${t}`,e)}G("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),G("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),G("ERR_OUT_OF_RANGE",function(e,t,r){let n=`The value of "${e}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>0x100000000?i=W(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=W(i)),i+="n"),n+=` It must be ${t}. Received ${i}`},RangeError);let X=/[^+/0-9A-Za-z-_]/g;function ee(e){if((e=(e=e.split("=")[0]).trim().replace(X,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function et(e,t){let r;t=t||1/0;let n=e.length,i=null,s=[];for(let o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319||o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function er(e){let t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function en(e,t){let r,n,i=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}function ei(e){return n.toByteArray(ee(e))}function es(e,t,r,n){let i;for(i=0;i<n&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function eo(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function ea(e){return e!=e}let el=function(){let e="0123456789abcdef",t=Array(256);for(let r=0;r<16;++r){let n=16*r;for(let i=0;i<16;++i)t[n+i]=e[r]+e[i]}return t}();function ec(e){return"undefined"==typeof BigInt?eu:e}function eu(){throw Error("BigInt not supported")}},45077:(e,t,r)=>{"use strict";let n=r(56765);e.exports=function(e,...t){0===t.length?n(e):n(()=>e(...t))}},45329:e=>{"use strict";e.exports="undefined"!=typeof Reflect&&Reflect.getPrototypeOf||null},45346:(e,t,r)=>{"use strict";r.d(t,{F:()=>s});var n=r(62954),i=r(62897);function s(e,...t){if(null==e)throw Error("Empty pipeline");if(c(e)){let t=e;e=()=>t.source}else if(l(e)||a(e)){let t=e;e=()=>t}let r=[e,...t];if(r.length>1&&c(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let e=1;e<r.length-1;e++)c(r[e])&&(r[e]=u(r[e]));return o(...r)}let o=(...e)=>{let t;for(;e.length>0;)t=e.shift()(t);return t},a=e=>e?.[Symbol.asyncIterator]!=null,l=e=>e?.[Symbol.iterator]!=null,c=e=>null!=e&&null!=e.sink&&null!=e.source,u=e=>t=>{let r=e.sink(t);if(r?.then!=null){let t,s=(0,n.Ny)({objectMode:!0});r.then(()=>{s.end()},e=>{s.end(e)});let o=e.source;if(a(o))t=async function*(){yield*o,s.end()};else if(l(o))t=function*(){yield*o,s.end()};else throw Error("Unknown duplex source type - must be Iterable or AsyncIterable");return(0,i.A)(s,t())}return e.source}},46923:(e,t,r)=>{"use strict";r.d(t,{if:()=>n.i,ED:()=>c});var n=r(90161),i=r(98897),s=r(43716),o=r(69685),a=r(34269),l=r(87704);class c extends n.i{data;constructor(){super(),this.data=new Map}put(e,t){return this.data.set(s.base32.encode(e.multihash.bytes),t),e}get(e){let t=this.data.get(s.base32.encode(e.multihash.bytes));if(null==t)throw new i.m_;return t}has(e){return this.data.has(s.base32.encode(e.multihash.bytes))}async delete(e){this.data.delete(s.base32.encode(e.multihash.bytes))}async *getAll(){for(let[e,t]of this.data.entries())yield{cid:o.TO.createV1(a.code,l.decode(s.base32.decode(e))),block:t}}}var u=r(3204);r(24802),r(76520),r(62897),r(62954),(0,u.vF)("blockstore:core:tiered"),n.i},47951:(e,t,r)=>{"use strict";r.r(t),r.d(t,{code:()=>o,decode:()=>l,encode:()=>a,name:()=>s});let n=new TextEncoder,i=new TextDecoder,s="json",o=512;function a(e){return n.encode(JSON.stringify(e))}function l(e){return JSON.parse(i.decode(e))}},48856:e=>{"use strict";function t(e,t){var t=t||{};this._capacity=t.capacity,this._head=0,this._tail=0,Array.isArray(e)?this._fromArray(e):(this._capacityMask=3,this._list=[,,,,])}t.prototype.peekAt=function(e){var t=e;if(t===(0|t)){var r=this.size();if(!(t>=r)&&!(t<-r))return t<0&&(t+=r),t=this._head+t&this._capacityMask,this._list[t]}},t.prototype.get=function(e){return this.peekAt(e)},t.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},t.prototype.peekFront=function(){return this.peek()},t.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(t.prototype,"length",{get:function(){return this.size()}}),t.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.unshift=function(e){if(0==arguments.length)return this.size();var t=this._list.length;return(this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail)?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}},t.prototype.push=function(e){if(0==arguments.length)return this.size();var t=this._tail;return(this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail)?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var r=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),r}},t.prototype.removeOne=function(e){var t,r=e;if(r===(0|r)&&this._head!==this._tail){var n=this.size(),i=this._list.length;if(!(r>=n)&&!(r<-n)){r<0&&(r+=n),r=this._head+r&this._capacityMask;var s=this._list[r];if(e<n/2){for(t=e;t>0;t--)this._list[r]=this._list[r=r-1+i&this._capacityMask];this._list[r]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(t=n-1-e;t>0;t--)this._list[r]=this._list[r=r+1+i&this._capacityMask];this._list[r]=void 0,this._tail=this._tail-1+i&this._capacityMask}return s}}},t.prototype.remove=function(e,t){var r,n,i=e,s=t;if(i===(0|i)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(i>=o)&&!(i<-o)&&!(t<1)){if(i<0&&(i+=o),1===t||!t)return(r=[,])[0]=this.removeOne(i),r;if(0===i&&i+t>=o)return r=this.toArray(),this.clear(),r;for(i+t>o&&(t=o-i),r=Array(t),n=0;n<t;n++)r[n]=this._list[this._head+i+n&this._capacityMask];if(i=this._head+i&this._capacityMask,e+t===o){for(this._tail=this._tail-t+a&this._capacityMask,n=t;n>0;n--)this._list[i=i+1+a&this._capacityMask]=void 0;return r}if(0===e){for(this._head=this._head+t+a&this._capacityMask,n=t-1;n>0;n--)this._list[i=i+1+a&this._capacityMask]=void 0;return r}if(i<o/2){for(this._head=this._head+e+t+a&this._capacityMask,n=e;n>0;n--)this.unshift(this._list[i=i-1+a&this._capacityMask]);for(i=this._head-1+a&this._capacityMask;s>0;)this._list[i=i-1+a&this._capacityMask]=void 0,s--;e<0&&(this._tail=i)}else{for(this._tail=i,i=i+t+a&this._capacityMask,n=o-(t+e);n>0;n--)this.push(this._list[i++]);for(i=this._tail;s>0;)this._list[i=i+1+a&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),r}}},t.prototype.splice=function(e,t){var r=e;if(r===(0|r)){var n=this.size();if(r<0&&(r+=n),!(r>n))if(!(arguments.length>2))return this.remove(r,t);else{var i,s,o,a=arguments.length,l=this._list.length,c=2;if(!n||r<n/2){for(i=0,s=Array(r);i<r;i++)s[i]=this._list[this._head+i&this._capacityMask];for(0===t?(o=[],r>0&&(this._head=this._head+r+l&this._capacityMask)):(o=this.remove(r,t),this._head=this._head+r+l&this._capacityMask);a>c;)this.unshift(arguments[--a]);for(i=r;i>0;i--)this.unshift(s[i-1])}else{var u=(s=Array(n-(r+t))).length;for(i=0;i<u;i++)s[i]=this._list[this._head+r+t+i&this._capacityMask];for(0===t?(o=[],r!=n&&(this._tail=this._head+r+l&this._capacityMask)):(o=this.remove(r,t),this._tail=this._tail-u+l&this._capacityMask);c<a;)this.push(arguments[c++]);for(i=0;i<u;i++)this.push(s[i])}return o}}},t.prototype.clear=function(){this._list=Array(this._list.length),this._head=0,this._tail=0},t.prototype.isEmpty=function(){return this._head===this._tail},t.prototype.toArray=function(){return this._copyArray(!1)},t.prototype._fromArray=function(e){var t=e.length,r=this._nextPowerOf2(t);this._list=Array(r),this._capacityMask=r-1,this._tail=t;for(var n=0;n<t;n++)this._list[n]=e[n]},t.prototype._copyArray=function(e,t){var r,n=this._list,i=n.length,s=this.length;if((t|=s)==s&&this._head<this._tail)return this._list.slice(this._head,this._tail);var o=Array(t),a=0;if(e||this._head>this._tail){for(r=this._head;r<i;r++)o[a++]=n[r];for(r=0;r<this._tail;r++)o[a++]=n[r]}else for(r=this._head;r<this._tail;r++)o[a++]=n[r];return o},t.prototype._growArray=function(){if(0!=this._head){var e=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=e}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1},t.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},t.prototype._nextPowerOf2=function(e){return Math.max(1<<Math.log(e)/Math.log(2)+1,4)},e.exports=t},49005:(e,t,r)=>{"use strict";r.d(t,{H_:()=>iu,UC:()=>io,YJ:()=>ia,q7:()=>ic,VF:()=>ip,JU:()=>il,ZL:()=>is,z6:()=>ih,hN:()=>id,bL:()=>ir,wv:()=>ig,Pb:()=>im,G5:()=>ib,ZP:()=>iy,l9:()=>ii});var n,i=r(12115),s=r(85185),o=r(6101),a=r(46081),l=r(5845),c=r(63655);function u(e,t){return t.get?t.get.call(e):t.value}function h(e,t,r){if(!t.has(e))throw TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}function d(e,t){var r=h(e,t,"get");return u(e,r)}function f(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}function p(e,t,r){f(e,t),t.set(e,r)}function g(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=r}}function m(e,t,r){var n=h(e,t,"set");return g(e,n,r),r}var y=r(99708),b=r(95155);function w(e){let t=e+"CollectionProvider",[r,n]=(0,a.A)(t),[s,l]=r(t,{collectionRef:{current:null},itemMap:new Map}),c=e=>{let{scope:t,children:r}=e,n=i.useRef(null),o=i.useRef(new Map).current;return(0,b.jsx)(s,{scope:t,itemMap:o,collectionRef:n,children:r})};c.displayName=t;let u=e+"CollectionSlot",h=(0,y.TL)(u),d=i.forwardRef((e,t)=>{let{scope:r,children:n}=e,i=l(u,r),s=(0,o.s)(t,i.collectionRef);return(0,b.jsx)(h,{ref:s,children:n})});d.displayName=u;let f=e+"CollectionItemSlot",p="data-radix-collection-item",g=(0,y.TL)(f),m=i.forwardRef((e,t)=>{let{scope:r,children:n,...s}=e,a=i.useRef(null),c=(0,o.s)(t,a),u=l(f,r);return i.useEffect(()=>(u.itemMap.set(a,{ref:a,...s}),()=>void u.itemMap.delete(a))),(0,b.jsx)(g,{...{[p]:""},ref:c,children:n})});return m.displayName=f,[{Provider:c,Slot:d,ItemSlot:m},function(t){let r=l(e+"CollectionConsumer",t);return i.useCallback(()=>{let e=r.collectionRef.current;if(!e)return[];let t=Array.from(e.querySelectorAll("[".concat(p,"]")));return Array.from(r.itemMap.values()).sort((e,r)=>t.indexOf(e.ref.current)-t.indexOf(r.ref.current))},[r.collectionRef,r.itemMap])},n]}var v=new WeakMap;function E(e,t){if("at"in Array.prototype)return Array.prototype.at.call(e,t);let r=A(e,t);return -1===r?void 0:e[r]}function A(e,t){let r=e.length,n=x(t),i=n>=0?n:r+n;return i<0||i>=r?-1:i}function x(e){return e!=e||0===e?0:Math.trunc(e)}n=new WeakMap;function S(e,t){return!!(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_PRECEDING)}var k=r(94315),_=r(19178),I=r(92293),C=r(25519),T=r(61285);let P=["top","right","bottom","left"],R=Math.min,O=Math.max,N=Math.round,D=Math.floor,B=e=>({x:e,y:e}),M={left:"right",right:"left",bottom:"top",top:"bottom"},L={start:"end",end:"start"};function F(e,t,r){return O(e,R(t,r))}function U(e,t){return"function"==typeof e?e(t):e}function j(e){return e.split("-")[0]}function $(e){return e.split("-")[1]}function H(e){return"x"===e?"y":"x"}function q(e){return"y"===e?"height":"width"}function z(e){return["top","bottom"].includes(j(e))?"y":"x"}function V(e){return H(z(e))}function K(e,t,r){void 0===r&&(r=!1);let n=$(e),i=V(e),s=q(i),o="x"===i?n===(r?"end":"start")?"right":"left":"start"===n?"bottom":"top";return t.reference[s]>t.floating[s]&&(o=Z(o)),[o,Z(o)]}function G(e){let t=Z(e);return[W(e),t,W(t)]}function W(e){return e.replace(/start|end/g,e=>L[e])}function Q(e,t,r){let n=["left","right"],i=["right","left"],s=["top","bottom"],o=["bottom","top"];switch(e){case"top":case"bottom":if(r)return t?i:n;return t?n:i;case"left":case"right":return t?s:o;default:return[]}}function J(e,t,r,n){let i=$(e),s=Q(j(e),"start"===r,n);return i&&(s=s.map(e=>e+"-"+i),t&&(s=s.concat(s.map(W)))),s}function Z(e){return e.replace(/left|right|bottom|top/g,e=>M[e])}function Y(e){return{top:0,right:0,bottom:0,left:0,...e}}function X(e){return"number"!=typeof e?Y(e):{top:e,right:e,bottom:e,left:e}}function ee(e){let{x:t,y:r,width:n,height:i}=e;return{width:n,height:i,top:r,left:t,right:t+n,bottom:r+i,x:t,y:r}}function et(e,t,r){let n,{reference:i,floating:s}=e,o=z(t),a=V(t),l=q(a),c=j(t),u="y"===o,h=i.x+i.width/2-s.width/2,d=i.y+i.height/2-s.height/2,f=i[l]/2-s[l]/2;switch(c){case"top":n={x:h,y:i.y-s.height};break;case"bottom":n={x:h,y:i.y+i.height};break;case"right":n={x:i.x+i.width,y:d};break;case"left":n={x:i.x-s.width,y:d};break;default:n={x:i.x,y:i.y}}switch($(t)){case"start":n[a]-=f*(r&&u?-1:1);break;case"end":n[a]+=f*(r&&u?-1:1)}return n}let er=async(e,t,r)=>{let{placement:n="bottom",strategy:i="absolute",middleware:s=[],platform:o}=r,a=s.filter(Boolean),l=await (null==o.isRTL?void 0:o.isRTL(t)),c=await o.getElementRects({reference:e,floating:t,strategy:i}),{x:u,y:h}=et(c,n,l),d=n,f={},p=0;for(let r=0;r<a.length;r++){let{name:s,fn:g}=a[r],{x:m,y:y,data:b,reset:w}=await g({x:u,y:h,initialPlacement:n,placement:d,strategy:i,middlewareData:f,rects:c,platform:o,elements:{reference:e,floating:t}});u=null!=m?m:u,h=null!=y?y:h,f={...f,[s]:{...f[s],...b}},w&&p<=50&&(p++,"object"==typeof w&&(w.placement&&(d=w.placement),w.rects&&(c=!0===w.rects?await o.getElementRects({reference:e,floating:t,strategy:i}):w.rects),{x:u,y:h}=et(c,d,l)),r=-1)}return{x:u,y:h,placement:d,strategy:i,middlewareData:f}};async function en(e,t){var r;void 0===t&&(t={});let{x:n,y:i,platform:s,rects:o,elements:a,strategy:l}=e,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:h="floating",altBoundary:d=!1,padding:f=0}=U(t,e),p=X(f),g="floating"===h?"reference":"floating",m=a[d?g:h],y=ee(await s.getClippingRect({element:null==(r=await (null==s.isElement?void 0:s.isElement(m)))||r?m:m.contextElement||await (null==s.getDocumentElement?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),b="floating"===h?{x:n,y:i,width:o.floating.width,height:o.floating.height}:o.reference,w=await (null==s.getOffsetParent?void 0:s.getOffsetParent(a.floating)),v=await (null==s.isElement?void 0:s.isElement(w))&&await (null==s.getScale?void 0:s.getScale(w))||{x:1,y:1},E=ee(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:b,offsetParent:w,strategy:l}):b);return{top:(y.top-E.top+p.top)/v.y,bottom:(E.bottom-y.bottom+p.bottom)/v.y,left:(y.left-E.left+p.left)/v.x,right:(E.right-y.right+p.right)/v.x}}let ei=e=>({name:"arrow",options:e,async fn(t){let{x:r,y:n,placement:i,rects:s,platform:o,elements:a,middlewareData:l}=t,{element:c,padding:u=0}=U(e,t)||{};if(null==c)return{};let h=X(u),d={x:r,y:n},f=V(i),p=q(f),g=await o.getDimensions(c),m="y"===f,y=m?"top":"left",b=m?"bottom":"right",w=m?"clientHeight":"clientWidth",v=s.reference[p]+s.reference[f]-d[f]-s.floating[p],E=d[f]-s.reference[f],A=await (null==o.getOffsetParent?void 0:o.getOffsetParent(c)),x=A?A[w]:0;x&&await (null==o.isElement?void 0:o.isElement(A))||(x=a.floating[w]||s.floating[p]);let S=v/2-E/2,k=x/2-g[p]/2-1,_=R(h[y],k),I=R(h[b],k),C=_,T=x-g[p]-I,P=x/2-g[p]/2+S,O=F(C,P,T),N=!l.arrow&&null!=$(i)&&P!==O&&s.reference[p]/2-(P<C?_:I)-g[p]/2<0,D=N?P<C?P-C:P-T:0;return{[f]:d[f]+D,data:{[f]:O,centerOffset:P-O-D,...N&&{alignmentOffset:D}},reset:N}}}),es=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var r,n,i,s,o,a;let{placement:l,middlewareData:c,rects:u,initialPlacement:h,platform:d,elements:f}=t,{mainAxis:p=!0,crossAxis:g=!0,fallbackPlacements:m,fallbackStrategy:y="bestFit",fallbackAxisSideDirection:b="none",flipAlignment:w=!0,...v}=U(e,t);if(null!=(r=c.arrow)&&r.alignmentOffset)return{};let E=j(l),A=z(h),x=j(h)===h,S=await (null==d.isRTL?void 0:d.isRTL(f.floating)),k=m||(x||!w?[Z(h)]:G(h)),_="none"!==b;!m&&_&&k.push(...J(h,w,b,S));let I=[h,...k],C=await en(t,v),T=[],P=(null==(n=c.flip)?void 0:n.overflows)||[];if(p&&T.push(C[E]),g){let e=K(l,u,S);T.push(C[e[0]],C[e[1]])}if(P=[...P,{placement:l,overflows:T}],!T.every(e=>e<=0)){let e=((null==(i=c.flip)?void 0:i.index)||0)+1,t=I[e];if(t){let r="alignment"===g&&A!==z(t),n=(null==(o=P[0])?void 0:o.overflows[0])>0;if(!r||n)return{data:{index:e,overflows:P},reset:{placement:t}}}let r=null==(s=P.filter(e=>e.overflows[0]<=0).sort((e,t)=>e.overflows[1]-t.overflows[1])[0])?void 0:s.placement;if(!r)switch(y){case"bestFit":{let e=null==(a=P.filter(e=>{if(_){let t=z(e.placement);return t===A||"y"===t}return!0}).map(e=>[e.placement,e.overflows.filter(e=>e>0).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0])?void 0:a[0];e&&(r=e);break}case"initialPlacement":r=h}if(l!==r)return{reset:{placement:r}}}return{}}}};function eo(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function ea(e){return P.some(t=>e[t]>=0)}let el=function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(t){let{rects:r}=t,{strategy:n="referenceHidden",...i}=U(e,t);switch(n){case"referenceHidden":{let e=eo(await en(t,{...i,elementContext:"reference"}),r.reference);return{data:{referenceHiddenOffsets:e,referenceHidden:ea(e)}}}case"escaped":{let e=eo(await en(t,{...i,altBoundary:!0}),r.floating);return{data:{escapedOffsets:e,escaped:ea(e)}}}default:return{}}}}};async function ec(e,t){let{placement:r,platform:n,elements:i}=e,s=await (null==n.isRTL?void 0:n.isRTL(i.floating)),o=j(r),a=$(r),l="y"===z(r),c=["left","top"].includes(o)?-1:1,u=s&&l?-1:1,h=U(t,e),{mainAxis:d,crossAxis:f,alignmentAxis:p}="number"==typeof h?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return a&&"number"==typeof p&&(f="end"===a?-1*p:p),l?{x:f*u,y:d*c}:{x:d*c,y:f*u}}let eu=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){var r,n;let{x:i,y:s,placement:o,middlewareData:a}=t,l=await ec(t,e);return o===(null==(r=a.offset)?void 0:r.placement)&&null!=(n=a.arrow)&&n.alignmentOffset?{}:{x:i+l.x,y:s+l.y,data:{...l,placement:o}}}}},eh=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){let{x:r,y:n,placement:i}=t,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:e=>{let{x:t,y:r}=e;return{x:t,y:r}}},...l}=U(e,t),c={x:r,y:n},u=await en(t,l),h=z(j(i)),d=H(h),f=c[d],p=c[h];if(s){let e="y"===d?"top":"left",t="y"===d?"bottom":"right",r=f+u[e],n=f-u[t];f=F(r,f,n)}if(o){let e="y"===h?"top":"left",t="y"===h?"bottom":"right",r=p+u[e],n=p-u[t];p=F(r,p,n)}let g=a.fn({...t,[d]:f,[h]:p});return{...g,data:{x:g.x-r,y:g.y-n,enabled:{[d]:s,[h]:o}}}}}},ed=function(e){return void 0===e&&(e={}),{options:e,fn(t){let{x:r,y:n,placement:i,rects:s,middlewareData:o}=t,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=U(e,t),u={x:r,y:n},h=z(i),d=H(h),f=u[d],p=u[h],g=U(a,t),m="number"==typeof g?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(l){let e="y"===d?"height":"width",t=s.reference[d]-s.floating[e]+m.mainAxis,r=s.reference[d]+s.reference[e]-m.mainAxis;f<t?f=t:f>r&&(f=r)}if(c){var y,b;let e="y"===d?"width":"height",t=["top","left"].includes(j(i)),r=s.reference[h]-s.floating[e]+(t&&(null==(y=o.offset)?void 0:y[h])||0)+(t?0:m.crossAxis),n=s.reference[h]+s.reference[e]+(t?0:(null==(b=o.offset)?void 0:b[h])||0)-(t?m.crossAxis:0);p<r?p=r:p>n&&(p=n)}return{[d]:f,[h]:p}}}},ef=function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(t){var r,n;let i,s,{placement:o,rects:a,platform:l,elements:c}=t,{apply:u=()=>{},...h}=U(e,t),d=await en(t,h),f=j(o),p=$(o),g="y"===z(o),{width:m,height:y}=a.floating;"top"===f||"bottom"===f?(i=f,s=p===(await (null==l.isRTL?void 0:l.isRTL(c.floating))?"start":"end")?"left":"right"):(s=f,i="end"===p?"top":"bottom");let b=y-d.top-d.bottom,w=m-d.left-d.right,v=R(y-d[i],b),E=R(m-d[s],w),A=!t.middlewareData.shift,x=v,S=E;if(null!=(r=t.middlewareData.shift)&&r.enabled.x&&(S=w),null!=(n=t.middlewareData.shift)&&n.enabled.y&&(x=b),A&&!p){let e=O(d.left,0),t=O(d.right,0),r=O(d.top,0),n=O(d.bottom,0);g?S=m-2*(0!==e||0!==t?e+t:O(d.left,d.right)):x=y-2*(0!==r||0!==n?r+n:O(d.top,d.bottom))}await u({...t,availableWidth:S,availableHeight:x});let k=await l.getDimensions(c.floating);return m!==k.width||y!==k.height?{reset:{rects:!0}}:{}}}};function ep(){return"undefined"!=typeof window}function eg(e){return eb(e)?(e.nodeName||"").toLowerCase():"#document"}function em(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function ey(e){var t;return null==(t=(eb(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function eb(e){return!!ep()&&(e instanceof Node||e instanceof em(e).Node)}function ew(e){return!!ep()&&(e instanceof Element||e instanceof em(e).Element)}function ev(e){return!!ep()&&(e instanceof HTMLElement||e instanceof em(e).HTMLElement)}function eE(e){return!!ep()&&"undefined"!=typeof ShadowRoot&&(e instanceof ShadowRoot||e instanceof em(e).ShadowRoot)}function eA(e){let{overflow:t,overflowX:r,overflowY:n,display:i}=eT(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!["inline","contents"].includes(i)}function ex(e){return["table","td","th"].includes(eg(e))}function eS(e){return[":popover-open",":modal"].some(t=>{try{return e.matches(t)}catch(e){return!1}})}function ek(e){let t=eI(),r=ew(e)?eT(e):e;return["transform","translate","scale","rotate","perspective"].some(e=>!!r[e]&&"none"!==r[e])||!!r.containerType&&"normal"!==r.containerType||!t&&!!r.backdropFilter&&"none"!==r.backdropFilter||!t&&!!r.filter&&"none"!==r.filter||["transform","translate","scale","rotate","perspective","filter"].some(e=>(r.willChange||"").includes(e))||["paint","layout","strict","content"].some(e=>(r.contain||"").includes(e))}function e_(e){let t=eR(e);for(;ev(t)&&!eC(t);){if(ek(t))return t;if(eS(t))break;t=eR(t)}return null}function eI(){return"undefined"!=typeof CSS&&!!CSS.supports&&CSS.supports("-webkit-backdrop-filter","none")}function eC(e){return["html","body","#document"].includes(eg(e))}function eT(e){return em(e).getComputedStyle(e)}function eP(e){return ew(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function eR(e){if("html"===eg(e))return e;let t=e.assignedSlot||e.parentNode||eE(e)&&e.host||ey(e);return eE(t)?t.host:t}function eO(e){let t=eR(e);return eC(t)?e.ownerDocument?e.ownerDocument.body:e.body:ev(t)&&eA(t)?t:eO(t)}function eN(e,t,r){var n;void 0===t&&(t=[]),void 0===r&&(r=!0);let i=eO(e),s=i===(null==(n=e.ownerDocument)?void 0:n.body),o=em(i);if(s){let e=eD(o);return t.concat(o,o.visualViewport||[],eA(i)?i:[],e&&r?eN(e):[])}return t.concat(i,eN(i,[],r))}function eD(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function eB(e){let t=eT(e),r=parseFloat(t.width)||0,n=parseFloat(t.height)||0,i=ev(e),s=i?e.offsetWidth:r,o=i?e.offsetHeight:n,a=N(r)!==s||N(n)!==o;return a&&(r=s,n=o),{width:r,height:n,$:a}}function eM(e){return ew(e)?e:e.contextElement}function eL(e){let t=eM(e);if(!ev(t))return B(1);let r=t.getBoundingClientRect(),{width:n,height:i,$:s}=eB(t),o=(s?N(r.width):r.width)/n,a=(s?N(r.height):r.height)/i;return o&&Number.isFinite(o)||(o=1),a&&Number.isFinite(a)||(a=1),{x:o,y:a}}let eF=B(0);function eU(e){let t=em(e);return eI()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:eF}function ej(e,t,r){return void 0===t&&(t=!1),!!r&&(!t||r===em(e))&&t}function e$(e,t,r,n){void 0===t&&(t=!1),void 0===r&&(r=!1);let i=e.getBoundingClientRect(),s=eM(e),o=B(1);t&&(n?ew(n)&&(o=eL(n)):o=eL(e));let a=ej(s,r,n)?eU(s):B(0),l=(i.left+a.x)/o.x,c=(i.top+a.y)/o.y,u=i.width/o.x,h=i.height/o.y;if(s){let e=em(s),t=n&&ew(n)?em(n):n,r=e,i=eD(r);for(;i&&n&&t!==r;){let e=eL(i),t=i.getBoundingClientRect(),n=eT(i),s=t.left+(i.clientLeft+parseFloat(n.paddingLeft))*e.x,o=t.top+(i.clientTop+parseFloat(n.paddingTop))*e.y;l*=e.x,c*=e.y,u*=e.x,h*=e.y,l+=s,c+=o,i=eD(r=em(i))}}return ee({width:u,height:h,x:l,y:c})}function eH(e,t){let r=eP(e).scrollLeft;return t?t.left+r:e$(ey(e)).left+r}function eq(e,t,r){void 0===r&&(r=!1);let n=e.getBoundingClientRect();return{x:n.left+t.scrollLeft-(r?0:eH(e,n)),y:n.top+t.scrollTop}}function ez(e){let t=ey(e),r=eP(e),n=e.ownerDocument.body,i=O(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),s=O(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight),o=-r.scrollLeft+eH(e),a=-r.scrollTop;return"rtl"===eT(n).direction&&(o+=O(t.clientWidth,n.clientWidth)-i),{width:i,height:s,x:o,y:a}}function eV(e,t){let r=em(e),n=ey(e),i=r.visualViewport,s=n.clientWidth,o=n.clientHeight,a=0,l=0;if(i){s=i.width,o=i.height;let e=eI();(!e||e&&"fixed"===t)&&(a=i.offsetLeft,l=i.offsetTop)}return{width:s,height:o,x:a,y:l}}function eK(e,t){let r=e$(e,!0,"fixed"===t),n=r.top+e.clientTop,i=r.left+e.clientLeft,s=ev(e)?eL(e):B(1),o=e.clientWidth*s.x,a=e.clientHeight*s.y;return{width:o,height:a,x:i*s.x,y:n*s.y}}function eG(e,t,r){let n;if("viewport"===t)n=eV(e,r);else if("document"===t)n=ez(ey(e));else if(ew(t))n=eK(t,r);else{let r=eU(e);n={x:t.x-r.x,y:t.y-r.y,width:t.width,height:t.height}}return ee(n)}function eW(e,t){let r=eR(e);return!(r===t||!ew(r)||eC(r))&&("fixed"===eT(r).position||eW(r,t))}function eQ(e,t){let r=t.get(e);if(r)return r;let n=eN(e,[],!1).filter(e=>ew(e)&&"body"!==eg(e)),i=null,s="fixed"===eT(e).position,o=s?eR(e):e;for(;ew(o)&&!eC(o);){let t=eT(o),r=ek(o);r||"fixed"!==t.position||(i=null),(s?!r&&!i:!r&&"static"===t.position&&!!i&&["absolute","fixed"].includes(i.position)||eA(o)&&!r&&eW(e,o))?n=n.filter(e=>e!==o):i=t,o=eR(o)}return t.set(e,n),n}function eJ(e,t,r){let n=ev(t),i=ey(t),s="fixed"===r,o=e$(e,!0,s,t),a={scrollLeft:0,scrollTop:0},l=B(0);function c(){l.x=eH(i)}if(n||!n&&!s)if(("body"!==eg(t)||eA(i))&&(a=eP(t)),n){let e=e$(t,!0,s,t);l.x=e.x+t.clientLeft,l.y=e.y+t.clientTop}else i&&c();s&&!n&&i&&c();let u=!i||n||s?B(0):eq(i,a);return{x:o.left+a.scrollLeft-l.x-u.x,y:o.top+a.scrollTop-l.y-u.y,width:o.width,height:o.height}}function eZ(e){return"static"===eT(e).position}function eY(e,t){if(!ev(e)||"fixed"===eT(e).position)return null;if(t)return t(e);let r=e.offsetParent;return ey(e)===r&&(r=r.ownerDocument.body),r}function eX(e,t){let r=em(e);if(eS(e))return r;if(!ev(e)){let t=eR(e);for(;t&&!eC(t);){if(ew(t)&&!eZ(t))return t;t=eR(t)}return r}let n=eY(e,t);for(;n&&ex(n)&&eZ(n);)n=eY(n,t);return n&&eC(n)&&eZ(n)&&!ek(n)?r:n||e_(e)||r}let e0=async function(e){let t=this.getOffsetParent||eX,r=this.getDimensions,n=await r(e.floating);return{reference:eJ(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}},e1={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{elements:t,rect:r,offsetParent:n,strategy:i}=e,s="fixed"===i,o=ey(n),a=!!t&&eS(t.floating);if(n===o||a&&s)return r;let l={scrollLeft:0,scrollTop:0},c=B(1),u=B(0),h=ev(n);if((h||!h&&!s)&&(("body"!==eg(n)||eA(o))&&(l=eP(n)),ev(n))){let e=e$(n);c=eL(n),u.x=e.x+n.clientLeft,u.y=e.y+n.clientTop}let d=!o||h||s?B(0):eq(o,l,!0);return{width:r.width*c.x,height:r.height*c.y,x:r.x*c.x-l.scrollLeft*c.x+u.x+d.x,y:r.y*c.y-l.scrollTop*c.y+u.y+d.y}},getDocumentElement:ey,getClippingRect:function(e){let{element:t,boundary:r,rootBoundary:n,strategy:i}=e,s=[..."clippingAncestors"===r?eS(t)?[]:eQ(t,this._c):[].concat(r),n],o=s[0],a=s.reduce((e,r)=>{let n=eG(t,r,i);return e.top=O(n.top,e.top),e.right=R(n.right,e.right),e.bottom=R(n.bottom,e.bottom),e.left=O(n.left,e.left),e},eG(t,o,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}},getOffsetParent:eX,getElementRects:e0,getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){let{width:t,height:r}=eB(e);return{width:t,height:r}},getScale:eL,isElement:ew,isRTL:function(e){return"rtl"===eT(e).direction}};function e2(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function e3(e,t){let r,n=null,i=ey(e);function s(){var e;clearTimeout(r),null==(e=n)||e.disconnect(),n=null}function o(a,l){void 0===a&&(a=!1),void 0===l&&(l=1),s();let c=e.getBoundingClientRect(),{left:u,top:h,width:d,height:f}=c;if(a||t(),!d||!f)return;let p=D(h),g=D(i.clientWidth-(u+d)),m={rootMargin:-p+"px "+-g+"px "+-D(i.clientHeight-(h+f))+"px "+-D(u)+"px",threshold:O(0,R(1,l))||1},y=!0;function b(t){let n=t[0].intersectionRatio;if(n!==l){if(!y)return o();n?o(!1,n):r=setTimeout(()=>{o(!1,1e-7)},1e3)}1!==n||e2(c,e.getBoundingClientRect())||o(),y=!1}try{n=new IntersectionObserver(b,{...m,root:i.ownerDocument})}catch(e){n=new IntersectionObserver(b,m)}n.observe(e)}return o(!0),s}function e4(e,t,r,n){let i;void 0===n&&(n={});let{ancestorScroll:s=!0,ancestorResize:o=!0,elementResize:a="function"==typeof ResizeObserver,layoutShift:l="function"==typeof IntersectionObserver,animationFrame:c=!1}=n,u=eM(e),h=s||o?[...u?eN(u):[],...eN(t)]:[];h.forEach(e=>{s&&e.addEventListener("scroll",r,{passive:!0}),o&&e.addEventListener("resize",r)});let d=u&&l?e3(u,r):null,f=-1,p=null;a&&(p=new ResizeObserver(e=>{let[n]=e;n&&n.target===u&&p&&(p.unobserve(t),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var e;null==(e=p)||e.observe(t)})),r()}),u&&!c&&p.observe(u),p.observe(t));let g=c?e$(e):null;function m(){let t=e$(e);g&&!e2(g,t)&&r(),g=t,i=requestAnimationFrame(m)}return c&&m(),r(),()=>{var e;h.forEach(e=>{s&&e.removeEventListener("scroll",r),o&&e.removeEventListener("resize",r)}),null==d||d(),null==(e=p)||e.disconnect(),p=null,c&&cancelAnimationFrame(i)}}let e5=eu,e6=eh,e8=es,e7=ef,e9=el,te=ei,tt=ed,tr=(e,t,r)=>{let n=new Map,i={platform:e1,...r},s={...i.platform,_c:n};return er(e,t,{...i,platform:s})};var tn=r(47650),ti="undefined"!=typeof document?i.useLayoutEffect:i.useEffect;function ts(e,t){let r,n,i;if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if((r=e.length)!==t.length)return!1;for(n=r;0!=n--;)if(!ts(e[n],t[n]))return!1;return!0}if((r=(i=Object.keys(e)).length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!({}).hasOwnProperty.call(t,i[n]))return!1;for(n=r;0!=n--;){let r=i[n];if(("_owner"!==r||!e.$$typeof)&&!ts(e[r],t[r]))return!1}return!0}return e!=e&&t!=t}function to(e){return"undefined"==typeof window?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function ta(e,t){let r=to(e);return Math.round(t*r)/r}function tl(e){let t=i.useRef(e);return ti(()=>{t.current=e}),t}function tc(e){void 0===e&&(e={});let{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:s,elements:{reference:o,floating:a}={},transform:l=!0,whileElementsMounted:c,open:u}=e,[h,d]=i.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[f,p]=i.useState(n);ts(f,n)||p(n);let[g,m]=i.useState(null),[y,b]=i.useState(null),w=i.useCallback(e=>{e!==x.current&&(x.current=e,m(e))},[]),v=i.useCallback(e=>{e!==S.current&&(S.current=e,b(e))},[]),E=o||g,A=a||y,x=i.useRef(null),S=i.useRef(null),k=i.useRef(h),_=null!=c,I=tl(c),C=tl(s),T=tl(u),P=i.useCallback(()=>{if(!x.current||!S.current)return;let e={placement:t,strategy:r,middleware:f};C.current&&(e.platform=C.current),tr(x.current,S.current,e).then(e=>{let t={...e,isPositioned:!1!==T.current};R.current&&!ts(k.current,t)&&(k.current=t,tn.flushSync(()=>{d(t)}))})},[f,t,r,C,T]);ti(()=>{!1===u&&k.current.isPositioned&&(k.current.isPositioned=!1,d(e=>({...e,isPositioned:!1})))},[u]);let R=i.useRef(!1);ti(()=>(R.current=!0,()=>{R.current=!1}),[]),ti(()=>{if(E&&(x.current=E),A&&(S.current=A),E&&A){if(I.current)return I.current(E,A,P);P()}},[E,A,P,I,_]);let O=i.useMemo(()=>({reference:x,floating:S,setReference:w,setFloating:v}),[w,v]),N=i.useMemo(()=>({reference:E,floating:A}),[E,A]),D=i.useMemo(()=>{let e={position:r,left:0,top:0};if(!N.floating)return e;let t=ta(N.floating,h.x),n=ta(N.floating,h.y);return l?{...e,transform:"translate("+t+"px, "+n+"px)",...to(N.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:t,top:n}},[r,l,N.floating,h.x,h.y]);return i.useMemo(()=>({...h,update:P,refs:O,elements:N,floatingStyles:D}),[h,P,O,N,D])}let tu=e=>{function t(e){return({}).hasOwnProperty.call(e,"current")}return{name:"arrow",options:e,fn(r){let{element:n,padding:i}="function"==typeof e?e(r):e;return n&&t(n)?null!=n.current?te({element:n.current,padding:i}).fn(r):{}:n?te({element:n,padding:i}).fn(r):{}}}},th=(e,t)=>({...e5(e),options:[e,t]}),td=(e,t)=>({...e6(e),options:[e,t]}),tf=(e,t)=>({...tt(e),options:[e,t]}),tp=(e,t)=>({...e8(e),options:[e,t]}),tg=(e,t)=>({...e7(e),options:[e,t]}),tm=(e,t)=>({...e9(e),options:[e,t]}),ty=(e,t)=>({...tu(e),options:[e,t]});var tb="Arrow",tw=i.forwardRef((e,t)=>{let{children:r,width:n=10,height:i=5,...s}=e;return(0,b.jsx)(c.sG.svg,{...s,ref:t,width:n,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:(0,b.jsx)("polygon",{points:"0,0 30,0 15,10"})})});tw.displayName=tb;var tv=tw,tE=r(39033),tA=r(52712);function tx(e){let[t,r]=i.useState(void 0);return(0,tA.N)(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let n,i;if(!Array.isArray(t)||!t.length)return;let s=t[0];if("borderBoxSize"in s){let e=s.borderBoxSize,t=Array.isArray(e)?e[0]:e;n=t.inlineSize,i=t.blockSize}else n=e.offsetWidth,i=e.offsetHeight;r({width:n,height:i})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}r(void 0)},[e]),t}var tS="Popper",[tk,t_]=(0,a.A)(tS),[tI,tC]=tk(tS),tT=e=>{let{__scopePopper:t,children:r}=e,[n,s]=i.useState(null);return(0,b.jsx)(tI,{scope:t,anchor:n,onAnchorChange:s,children:r})};tT.displayName=tS;var tP="PopperAnchor",tR=i.forwardRef((e,t)=>{let{__scopePopper:r,virtualRef:n,...s}=e,a=tC(tP,r),l=i.useRef(null),u=(0,o.s)(t,l);return i.useEffect(()=>{a.onAnchorChange((null==n?void 0:n.current)||l.current)}),n?null:(0,b.jsx)(c.sG.div,{...s,ref:u})});tR.displayName=tP;var tO="PopperContent",[tN,tD]=tk(tO),tB=i.forwardRef((e,t)=>{var r,n,s,a,l,u,h,d;let{__scopePopper:f,side:p="bottom",sideOffset:g=0,align:m="center",alignOffset:y=0,arrowPadding:w=0,avoidCollisions:v=!0,collisionBoundary:E=[],collisionPadding:A=0,sticky:x="partial",hideWhenDetached:S=!1,updatePositionStrategy:k="optimized",onPlaced:_,...I}=e,C=tC(tO,f),[T,P]=i.useState(null),R=(0,o.s)(t,e=>P(e)),[O,N]=i.useState(null),D=tx(O),B=null!=(h=null==D?void 0:D.width)?h:0,M=null!=(d=null==D?void 0:D.height)?d:0,L=p+("center"!==m?"-"+m:""),F="number"==typeof A?A:{top:0,right:0,bottom:0,left:0,...A},U=Array.isArray(E)?E:[E],j=U.length>0,$={padding:F,boundary:U.filter(tU),altBoundary:j},{refs:H,floatingStyles:q,placement:z,isPositioned:V,middlewareData:K}=tc({strategy:"fixed",placement:L,whileElementsMounted:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return e4(...t,{animationFrame:"always"===k})},elements:{reference:C.anchor},middleware:[th({mainAxis:g+M,alignmentAxis:y}),v&&td({mainAxis:!0,crossAxis:!1,limiter:"partial"===x?tf():void 0,...$}),v&&tp({...$}),tg({...$,apply:e=>{let{elements:t,rects:r,availableWidth:n,availableHeight:i}=e,{width:s,height:o}=r.reference,a=t.floating.style;a.setProperty("--radix-popper-available-width","".concat(n,"px")),a.setProperty("--radix-popper-available-height","".concat(i,"px")),a.setProperty("--radix-popper-anchor-width","".concat(s,"px")),a.setProperty("--radix-popper-anchor-height","".concat(o,"px"))}}),O&&ty({element:O,padding:w}),tj({arrowWidth:B,arrowHeight:M}),S&&tm({strategy:"referenceHidden",...$})]}),[G,W]=t$(z),Q=(0,tE.c)(_);(0,tA.N)(()=>{V&&(null==Q||Q())},[V,Q]);let J=null==(r=K.arrow)?void 0:r.x,Z=null==(n=K.arrow)?void 0:n.y,Y=(null==(s=K.arrow)?void 0:s.centerOffset)!==0,[X,ee]=i.useState();return(0,tA.N)(()=>{T&&ee(window.getComputedStyle(T).zIndex)},[T]),(0,b.jsx)("div",{ref:H.setFloating,"data-radix-popper-content-wrapper":"",style:{...q,transform:V?q.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:X,"--radix-popper-transform-origin":[null==(a=K.transformOrigin)?void 0:a.x,null==(l=K.transformOrigin)?void 0:l.y].join(" "),...(null==(u=K.hide)?void 0:u.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:(0,b.jsx)(tN,{scope:f,placedSide:G,onArrowChange:N,arrowX:J,arrowY:Z,shouldHideArrow:Y,children:(0,b.jsx)(c.sG.div,{"data-side":G,"data-align":W,...I,ref:R,style:{...I.style,animation:V?void 0:"none"}})})})});tB.displayName=tO;var tM="PopperArrow",tL={top:"bottom",right:"left",bottom:"top",left:"right"},tF=i.forwardRef(function(e,t){let{__scopePopper:r,...n}=e,i=tD(tM,r),s=tL[i.placedSide];return(0,b.jsx)("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[s]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:(0,b.jsx)(tv,{...n,ref:t,style:{...n.style,display:"block"}})})});function tU(e){return null!==e}tF.displayName=tM;var tj=e=>({name:"transformOrigin",options:e,fn(t){var r,n,i,s,o;let{placement:a,rects:l,middlewareData:c}=t,u=(null==(r=c.arrow)?void 0:r.centerOffset)!==0,h=u?0:e.arrowWidth,d=u?0:e.arrowHeight,[f,p]=t$(a),g={start:"0%",center:"50%",end:"100%"}[p],m=(null!=(s=null==(n=c.arrow)?void 0:n.x)?s:0)+h/2,y=(null!=(o=null==(i=c.arrow)?void 0:i.y)?o:0)+d/2,b="",w="";return"bottom"===f?(b=u?g:"".concat(m,"px"),w="".concat(-d,"px")):"top"===f?(b=u?g:"".concat(m,"px"),w="".concat(l.floating.height+d,"px")):"right"===f?(b="".concat(-d,"px"),w=u?g:"".concat(y,"px")):"left"===f&&(b="".concat(l.floating.width+d,"px"),w=u?g:"".concat(y,"px")),{data:{x:b,y:w}}}});function t$(e){let[t,r="center"]=e.split("-");return[t,r]}var tH=tT,tq=tR,tz=tB,tV=tF,tK=r(34378),tG=r(28905),tW="rovingFocusGroup.onEntryFocus",tQ={bubbles:!1,cancelable:!0},tJ="RovingFocusGroup",[tZ,tY,tX]=w(tJ),[t0,t1]=(0,a.A)(tJ,[tX]),[t2,t3]=t0(tJ),t4=i.forwardRef((e,t)=>(0,b.jsx)(tZ.Provider,{scope:e.__scopeRovingFocusGroup,children:(0,b.jsx)(tZ.Slot,{scope:e.__scopeRovingFocusGroup,children:(0,b.jsx)(t5,{...e,ref:t})})}));t4.displayName=tJ;var t5=i.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:r,orientation:n,loop:a=!1,dir:u,currentTabStopId:h,defaultCurrentTabStopId:d,onCurrentTabStopIdChange:f,onEntryFocus:p,preventScrollOnEntryFocus:g=!1,...m}=e,y=i.useRef(null),w=(0,o.s)(t,y),v=(0,k.jH)(u),[E,A]=(0,l.i)({prop:h,defaultProp:null!=d?d:null,onChange:f,caller:tJ}),[x,S]=i.useState(!1),_=(0,tE.c)(p),I=tY(r),C=i.useRef(!1),[T,P]=i.useState(0);return i.useEffect(()=>{let e=y.current;if(e)return e.addEventListener(tW,_),()=>e.removeEventListener(tW,_)},[_]),(0,b.jsx)(t2,{scope:r,orientation:n,dir:v,loop:a,currentTabStopId:E,onItemFocus:i.useCallback(e=>A(e),[A]),onItemShiftTab:i.useCallback(()=>S(!0),[]),onFocusableItemAdd:i.useCallback(()=>P(e=>e+1),[]),onFocusableItemRemove:i.useCallback(()=>P(e=>e-1),[]),children:(0,b.jsx)(c.sG.div,{tabIndex:x||0===T?-1:0,"data-orientation":n,...m,ref:w,style:{outline:"none",...e.style},onMouseDown:(0,s.m)(e.onMouseDown,()=>{C.current=!0}),onFocus:(0,s.m)(e.onFocus,e=>{let t=!C.current;if(e.target===e.currentTarget&&t&&!x){let t=new CustomEvent(tW,tQ);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=I().filter(e=>e.focusable);rt([e.find(e=>e.active),e.find(e=>e.id===E),...e].filter(Boolean).map(e=>e.ref.current),g)}}C.current=!1}),onBlur:(0,s.m)(e.onBlur,()=>S(!1))})})}),t6="RovingFocusGroupItem",t8=i.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:r,focusable:n=!0,active:o=!1,tabStopId:a,children:l,...u}=e,h=(0,T.B)(),d=a||h,f=t3(t6,r),p=f.currentTabStopId===d,g=tY(r),{onFocusableItemAdd:m,onFocusableItemRemove:y,currentTabStopId:w}=f;return i.useEffect(()=>{if(n)return m(),()=>y()},[n,m,y]),(0,b.jsx)(tZ.ItemSlot,{scope:r,id:d,focusable:n,active:o,children:(0,b.jsx)(c.sG.span,{tabIndex:p?0:-1,"data-orientation":f.orientation,...u,ref:t,onMouseDown:(0,s.m)(e.onMouseDown,e=>{n?f.onItemFocus(d):e.preventDefault()}),onFocus:(0,s.m)(e.onFocus,()=>f.onItemFocus(d)),onKeyDown:(0,s.m)(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey)return void f.onItemShiftTab();if(e.target!==e.currentTarget)return;let t=re(e,f.orientation,f.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let r=g().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)r.reverse();else if("prev"===t||"next"===t){"prev"===t&&r.reverse();let n=r.indexOf(e.currentTarget);r=f.loop?rr(r,n+1):r.slice(n+1)}setTimeout(()=>rt(r))}}),children:"function"==typeof l?l({isCurrentTabStop:p,hasTabStop:null!=w}):l})})});t8.displayName=t6;var t7={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function t9(e,t){return"rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}function re(e,t,r){let n=t9(e.key,r);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(n))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(n)))return t7[n]}function rt(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=document.activeElement;for(let n of e)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}function rr(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var rn=t4,ri=t8,rs=r(38168),ro=r(31114),ra=["Enter"," "],rl=["ArrowUp","PageDown","End"],rc=["ArrowDown","PageUp","Home",...rl],ru={ltr:[...ra,"ArrowRight"],rtl:[...ra,"ArrowLeft"]},rh={ltr:["ArrowLeft"],rtl:["ArrowRight"]},rd="Menu",[rf,rp,rg]=w(rd),[rm,ry]=(0,a.A)(rd,[rg,t_,t1]),rb=t_(),rw=t1(),[rv,rE]=rm(rd),[rA,rx]=rm(rd),rS=e=>{let{__scopeMenu:t,open:r=!1,children:n,dir:s,onOpenChange:o,modal:a=!0}=e,l=rb(t),[c,u]=i.useState(null),h=i.useRef(!1),d=(0,tE.c)(o),f=(0,k.jH)(s);return i.useEffect(()=>{let e=()=>{h.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>h.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}},[]),(0,b.jsx)(tH,{...l,children:(0,b.jsx)(rv,{scope:t,open:r,onOpenChange:d,content:c,onContentChange:u,children:(0,b.jsx)(rA,{scope:t,onClose:i.useCallback(()=>d(!1),[d]),isUsingKeyboardRef:h,dir:f,modal:a,children:n})})})};rS.displayName=rd;var rk="MenuAnchor",r_=i.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e,i=rb(r);return(0,b.jsx)(tq,{...i,...n,ref:t})});r_.displayName=rk;var rI="MenuPortal",[rC,rT]=rm(rI,{forceMount:void 0}),rP=e=>{let{__scopeMenu:t,forceMount:r,children:n,container:i}=e,s=rE(rI,t);return(0,b.jsx)(rC,{scope:t,forceMount:r,children:(0,b.jsx)(tG.C,{present:r||s.open,children:(0,b.jsx)(tK.Z,{asChild:!0,container:i,children:n})})})};rP.displayName=rI;var rR="MenuContent",[rO,rN]=rm(rR),rD=i.forwardRef((e,t)=>{let r=rT(rR,e.__scopeMenu),{forceMount:n=r.forceMount,...i}=e,s=rE(rR,e.__scopeMenu),o=rx(rR,e.__scopeMenu);return(0,b.jsx)(rf.Provider,{scope:e.__scopeMenu,children:(0,b.jsx)(tG.C,{present:n||s.open,children:(0,b.jsx)(rf.Slot,{scope:e.__scopeMenu,children:o.modal?(0,b.jsx)(rB,{...i,ref:t}):(0,b.jsx)(rM,{...i,ref:t})})})})}),rB=i.forwardRef((e,t)=>{let r=rE(rR,e.__scopeMenu),n=i.useRef(null),a=(0,o.s)(t,n);return i.useEffect(()=>{let e=n.current;if(e)return(0,rs.Eq)(e)},[]),(0,b.jsx)(rF,{...e,ref:a,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:(0,s.m)(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),rM=i.forwardRef((e,t)=>{let r=rE(rR,e.__scopeMenu);return(0,b.jsx)(rF,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),rL=(0,y.TL)("MenuContent.ScrollLock"),rF=i.forwardRef((e,t)=>{let{__scopeMenu:r,loop:n=!1,trapFocus:a,onOpenAutoFocus:l,onCloseAutoFocus:c,disableOutsidePointerEvents:u,onEntryFocus:h,onEscapeKeyDown:d,onPointerDownOutside:f,onFocusOutside:p,onInteractOutside:g,onDismiss:m,disableOutsideScroll:y,...w}=e,v=rE(rR,r),E=rx(rR,r),A=rb(r),x=rw(r),S=rp(r),[k,T]=i.useState(null),P=i.useRef(null),R=(0,o.s)(t,P,v.onContentChange),O=i.useRef(0),N=i.useRef(""),D=i.useRef(0),B=i.useRef(null),M=i.useRef("right"),L=i.useRef(0),F=y?ro.A:i.Fragment,U=y?{as:rL,allowPinchZoom:!0}:void 0,j=e=>{var t,r;let n=N.current+e,i=S().filter(e=>!e.disabled),s=document.activeElement,o=null==(t=i.find(e=>e.ref.current===s))?void 0:t.textValue,a=nd(i.map(e=>e.textValue),n,o),l=null==(r=i.find(e=>e.textValue===a))?void 0:r.ref.current;!function e(t){N.current=t,window.clearTimeout(O.current),""!==t&&(O.current=window.setTimeout(()=>e(""),1e3))}(n),l&&setTimeout(()=>l.focus())};i.useEffect(()=>()=>window.clearTimeout(O.current),[]),(0,I.Oh)();let $=i.useCallback(e=>{var t,r;return M.current===(null==(t=B.current)?void 0:t.side)&&np(e,null==(r=B.current)?void 0:r.area)},[]);return(0,b.jsx)(rO,{scope:r,searchRef:N,onItemEnter:i.useCallback(e=>{$(e)&&e.preventDefault()},[$]),onItemLeave:i.useCallback(e=>{var t;$(e)||(null==(t=P.current)||t.focus(),T(null))},[$]),onTriggerLeave:i.useCallback(e=>{$(e)&&e.preventDefault()},[$]),pointerGraceTimerRef:D,onPointerGraceIntentChange:i.useCallback(e=>{B.current=e},[]),children:(0,b.jsx)(F,{...U,children:(0,b.jsx)(C.n,{asChild:!0,trapped:a,onMountAutoFocus:(0,s.m)(l,e=>{var t;e.preventDefault(),null==(t=P.current)||t.focus({preventScroll:!0})}),onUnmountAutoFocus:c,children:(0,b.jsx)(_.qW,{asChild:!0,disableOutsidePointerEvents:u,onEscapeKeyDown:d,onPointerDownOutside:f,onFocusOutside:p,onInteractOutside:g,onDismiss:m,children:(0,b.jsx)(rn,{asChild:!0,...x,dir:E.dir,orientation:"vertical",loop:n,currentTabStopId:k,onCurrentTabStopIdChange:T,onEntryFocus:(0,s.m)(h,e=>{E.isUsingKeyboardRef.current||e.preventDefault()}),preventScrollOnEntryFocus:!0,children:(0,b.jsx)(tz,{role:"menu","aria-orientation":"vertical","data-state":na(v.open),"data-radix-menu-content":"",dir:E.dir,...A,...w,ref:R,style:{outline:"none",...w.style},onKeyDown:(0,s.m)(w.onKeyDown,e=>{let t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,r=e.ctrlKey||e.altKey||e.metaKey,n=1===e.key.length;t&&("Tab"===e.key&&e.preventDefault(),!r&&n&&j(e.key));let i=P.current;if(e.target!==i||!rc.includes(e.key))return;e.preventDefault();let s=S().filter(e=>!e.disabled).map(e=>e.ref.current);rl.includes(e.key)&&s.reverse(),nu(s)}),onBlur:(0,s.m)(e.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(O.current),N.current="")}),onPointerMove:(0,s.m)(e.onPointerMove,ng(e=>{let t=e.target,r=L.current!==e.clientX;e.currentTarget.contains(t)&&r&&(M.current=e.clientX>L.current?"right":"left",L.current=e.clientX)}))})})})})})})});rD.displayName=rR;var rU="MenuGroup",rj=i.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e;return(0,b.jsx)(c.sG.div,{role:"group",...n,ref:t})});rj.displayName=rU;var r$="MenuLabel",rH=i.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e;return(0,b.jsx)(c.sG.div,{...n,ref:t})});rH.displayName=r$;var rq="MenuItem",rz="menu.itemSelect",rV=i.forwardRef((e,t)=>{let{disabled:r=!1,onSelect:n,...a}=e,l=i.useRef(null),u=rx(rq,e.__scopeMenu),h=rN(rq,e.__scopeMenu),d=(0,o.s)(t,l),f=i.useRef(!1),p=()=>{let e=l.current;if(!r&&e){let t=new CustomEvent(rz,{bubbles:!0,cancelable:!0});e.addEventListener(rz,e=>null==n?void 0:n(e),{once:!0}),(0,c.hO)(e,t),t.defaultPrevented?f.current=!1:u.onClose()}};return(0,b.jsx)(rK,{...a,ref:d,disabled:r,onClick:(0,s.m)(e.onClick,p),onPointerDown:t=>{var r;null==(r=e.onPointerDown)||r.call(e,t),f.current=!0},onPointerUp:(0,s.m)(e.onPointerUp,e=>{var t;f.current||null==(t=e.currentTarget)||t.click()}),onKeyDown:(0,s.m)(e.onKeyDown,e=>{let t=""!==h.searchRef.current;r||t&&" "===e.key||ra.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})})});rV.displayName=rq;var rK=i.forwardRef((e,t)=>{let{__scopeMenu:r,disabled:n=!1,textValue:a,...l}=e,u=rN(rq,r),h=rw(r),d=i.useRef(null),f=(0,o.s)(t,d),[p,g]=i.useState(!1),[m,y]=i.useState("");return i.useEffect(()=>{let e=d.current;if(e){var t;y((null!=(t=e.textContent)?t:"").trim())}},[l.children]),(0,b.jsx)(rf.ItemSlot,{scope:r,disabled:n,textValue:null!=a?a:m,children:(0,b.jsx)(ri,{asChild:!0,...h,focusable:!n,children:(0,b.jsx)(c.sG.div,{role:"menuitem","data-highlighted":p?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...l,ref:f,onPointerMove:(0,s.m)(e.onPointerMove,ng(e=>{n?u.onItemLeave(e):(u.onItemEnter(e),e.defaultPrevented||e.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:(0,s.m)(e.onPointerLeave,ng(e=>u.onItemLeave(e))),onFocus:(0,s.m)(e.onFocus,()=>g(!0)),onBlur:(0,s.m)(e.onBlur,()=>g(!1))})})})}),rG="MenuCheckboxItem",rW=i.forwardRef((e,t)=>{let{checked:r=!1,onCheckedChange:n,...i}=e;return(0,b.jsx)(r2,{scope:e.__scopeMenu,checked:r,children:(0,b.jsx)(rV,{role:"menuitemcheckbox","aria-checked":nl(r)?"mixed":r,...i,ref:t,"data-state":nc(r),onSelect:(0,s.m)(i.onSelect,()=>null==n?void 0:n(!!nl(r)||!r),{checkForDefaultPrevented:!1})})})});rW.displayName=rG;var rQ="MenuRadioGroup",[rJ,rZ]=rm(rQ,{value:void 0,onValueChange:()=>{}}),rY=i.forwardRef((e,t)=>{let{value:r,onValueChange:n,...i}=e,s=(0,tE.c)(n);return(0,b.jsx)(rJ,{scope:e.__scopeMenu,value:r,onValueChange:s,children:(0,b.jsx)(rj,{...i,ref:t})})});rY.displayName=rQ;var rX="MenuRadioItem",r0=i.forwardRef((e,t)=>{let{value:r,...n}=e,i=rZ(rX,e.__scopeMenu),o=r===i.value;return(0,b.jsx)(r2,{scope:e.__scopeMenu,checked:o,children:(0,b.jsx)(rV,{role:"menuitemradio","aria-checked":o,...n,ref:t,"data-state":nc(o),onSelect:(0,s.m)(n.onSelect,()=>{var e;return null==(e=i.onValueChange)?void 0:e.call(i,r)},{checkForDefaultPrevented:!1})})})});r0.displayName=rX;var r1="MenuItemIndicator",[r2,r3]=rm(r1,{checked:!1}),r4=i.forwardRef((e,t)=>{let{__scopeMenu:r,forceMount:n,...i}=e,s=r3(r1,r);return(0,b.jsx)(tG.C,{present:n||nl(s.checked)||!0===s.checked,children:(0,b.jsx)(c.sG.span,{...i,ref:t,"data-state":nc(s.checked)})})});r4.displayName=r1;var r5="MenuSeparator",r6=i.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e;return(0,b.jsx)(c.sG.div,{role:"separator","aria-orientation":"horizontal",...n,ref:t})});r6.displayName=r5;var r8="MenuArrow",r7=i.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e,i=rb(r);return(0,b.jsx)(tV,{...i,...n,ref:t})});r7.displayName=r8;var r9="MenuSub",[ne,nt]=rm(r9),nr=e=>{let{__scopeMenu:t,children:r,open:n=!1,onOpenChange:s}=e,o=rE(r9,t),a=rb(t),[l,c]=i.useState(null),[u,h]=i.useState(null),d=(0,tE.c)(s);return i.useEffect(()=>(!1===o.open&&d(!1),()=>d(!1)),[o.open,d]),(0,b.jsx)(tH,{...a,children:(0,b.jsx)(rv,{scope:t,open:n,onOpenChange:d,content:u,onContentChange:h,children:(0,b.jsx)(ne,{scope:t,contentId:(0,T.B)(),triggerId:(0,T.B)(),trigger:l,onTriggerChange:c,children:r})})})};nr.displayName=r9;var nn="MenuSubTrigger",ni=i.forwardRef((e,t)=>{let r=rE(nn,e.__scopeMenu),n=rx(nn,e.__scopeMenu),a=nt(nn,e.__scopeMenu),l=rN(nn,e.__scopeMenu),c=i.useRef(null),{pointerGraceTimerRef:u,onPointerGraceIntentChange:h}=l,d={__scopeMenu:e.__scopeMenu},f=i.useCallback(()=>{c.current&&window.clearTimeout(c.current),c.current=null},[]);return i.useEffect(()=>f,[f]),i.useEffect(()=>{let e=u.current;return()=>{window.clearTimeout(e),h(null)}},[u,h]),(0,b.jsx)(r_,{asChild:!0,...d,children:(0,b.jsx)(rK,{id:a.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":a.contentId,"data-state":na(r.open),...e,ref:(0,o.t)(t,a.onTriggerChange),onClick:t=>{var n;null==(n=e.onClick)||n.call(e,t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:(0,s.m)(e.onPointerMove,ng(t=>{l.onItemEnter(t),!t.defaultPrevented&&(e.disabled||r.open||c.current||(l.onPointerGraceIntentChange(null),c.current=window.setTimeout(()=>{r.onOpenChange(!0),f()},100)))})),onPointerLeave:(0,s.m)(e.onPointerLeave,ng(e=>{var t,n;f();let i=null==(t=r.content)?void 0:t.getBoundingClientRect();if(i){let t=null==(n=r.content)?void 0:n.dataset.side,s="right"===t,o=s?-5:5,a=i[s?"left":"right"],c=i[s?"right":"left"];l.onPointerGraceIntentChange({area:[{x:e.clientX+o,y:e.clientY},{x:a,y:i.top},{x:c,y:i.top},{x:c,y:i.bottom},{x:a,y:i.bottom}],side:t}),window.clearTimeout(u.current),u.current=window.setTimeout(()=>l.onPointerGraceIntentChange(null),300)}else{if(l.onTriggerLeave(e),e.defaultPrevented)return;l.onPointerGraceIntentChange(null)}})),onKeyDown:(0,s.m)(e.onKeyDown,t=>{let i=""!==l.searchRef.current;if(!e.disabled&&(!i||" "!==t.key)&&ru[n.dir].includes(t.key)){var s;r.onOpenChange(!0),null==(s=r.content)||s.focus(),t.preventDefault()}})})})});ni.displayName=nn;var ns="MenuSubContent",no=i.forwardRef((e,t)=>{let r=rT(rR,e.__scopeMenu),{forceMount:n=r.forceMount,...a}=e,l=rE(rR,e.__scopeMenu),c=rx(rR,e.__scopeMenu),u=nt(ns,e.__scopeMenu),h=i.useRef(null),d=(0,o.s)(t,h);return(0,b.jsx)(rf.Provider,{scope:e.__scopeMenu,children:(0,b.jsx)(tG.C,{present:n||l.open,children:(0,b.jsx)(rf.Slot,{scope:e.__scopeMenu,children:(0,b.jsx)(rF,{id:u.contentId,"aria-labelledby":u.triggerId,...a,ref:d,align:"start",side:"rtl"===c.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{var t;c.isUsingKeyboardRef.current&&(null==(t=h.current)||t.focus()),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:(0,s.m)(e.onFocusOutside,e=>{e.target!==u.trigger&&l.onOpenChange(!1)}),onEscapeKeyDown:(0,s.m)(e.onEscapeKeyDown,e=>{c.onClose(),e.preventDefault()}),onKeyDown:(0,s.m)(e.onKeyDown,e=>{let t=e.currentTarget.contains(e.target),r=rh[c.dir].includes(e.key);if(t&&r){var n;l.onOpenChange(!1),null==(n=u.trigger)||n.focus(),e.preventDefault()}})})})})})});function na(e){return e?"open":"closed"}function nl(e){return"indeterminate"===e}function nc(e){return nl(e)?"indeterminate":e?"checked":"unchecked"}function nu(e){let t=document.activeElement;for(let r of e)if(r===t||(r.focus(),document.activeElement!==t))return}function nh(e,t){return e.map((r,n)=>e[(t+n)%e.length])}function nd(e,t,r){let n=t.length>1&&Array.from(t).every(e=>e===t[0])?t[0]:t,i=r?e.indexOf(r):-1,s=nh(e,Math.max(i,0));1===n.length&&(s=s.filter(e=>e!==r));let o=s.find(e=>e.toLowerCase().startsWith(n.toLowerCase()));return o!==r?o:void 0}function nf(e,t){let{x:r,y:n}=e,i=!1;for(let e=0,s=t.length-1;e<t.length;s=e++){let o=t[e],a=t[s],l=o.x,c=o.y,u=a.x,h=a.y;c>n!=h>n&&r<(u-l)*(n-c)/(h-c)+l&&(i=!i)}return i}function np(e,t){return!!t&&nf({x:e.clientX,y:e.clientY},t)}function ng(e){return t=>"mouse"===t.pointerType?e(t):void 0}no.displayName=ns;var nm=rS,ny=r_,nb=rP,nw=rD,nv=rj,nE=rH,nA=rV,nx=rW,nS=rY,nk=r0,n_=r4,nI=r6,nC=r7,nT=nr,nP=ni,nR=no,nO="DropdownMenu",[nN,nD]=(0,a.A)(nO,[ry]),nB=ry(),[nM,nL]=nN(nO),nF=e=>{let{__scopeDropdownMenu:t,children:r,dir:n,open:s,defaultOpen:o,onOpenChange:a,modal:c=!0}=e,u=nB(t),h=i.useRef(null),[d,f]=(0,l.i)({prop:s,defaultProp:null!=o&&o,onChange:a,caller:nO});return(0,b.jsx)(nM,{scope:t,triggerId:(0,T.B)(),triggerRef:h,contentId:(0,T.B)(),open:d,onOpenChange:f,onOpenToggle:i.useCallback(()=>f(e=>!e),[f]),modal:c,children:(0,b.jsx)(nm,{...u,open:d,onOpenChange:f,dir:n,modal:c,children:r})})};nF.displayName=nO;var nU="DropdownMenuTrigger",nj=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,disabled:n=!1,...i}=e,a=nL(nU,r),l=nB(r);return(0,b.jsx)(ny,{asChild:!0,...l,children:(0,b.jsx)(c.sG.button,{type:"button",id:a.triggerId,"aria-haspopup":"menu","aria-expanded":a.open,"aria-controls":a.open?a.contentId:void 0,"data-state":a.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...i,ref:(0,o.t)(t,a.triggerRef),onPointerDown:(0,s.m)(e.onPointerDown,e=>{!n&&0===e.button&&!1===e.ctrlKey&&(a.onOpenToggle(),a.open||e.preventDefault())}),onKeyDown:(0,s.m)(e.onKeyDown,e=>{!n&&(["Enter"," "].includes(e.key)&&a.onOpenToggle(),"ArrowDown"===e.key&&a.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})})})});nj.displayName=nU;var n$=e=>{let{__scopeDropdownMenu:t,...r}=e,n=nB(t);return(0,b.jsx)(nb,{...n,...r})};n$.displayName="DropdownMenuPortal";var nH="DropdownMenuContent",nq=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,o=nL(nH,r),a=nB(r),l=i.useRef(!1);return(0,b.jsx)(nw,{id:o.contentId,"aria-labelledby":o.triggerId,...a,...n,ref:t,onCloseAutoFocus:(0,s.m)(e.onCloseAutoFocus,e=>{var t;l.current||null==(t=o.triggerRef.current)||t.focus(),l.current=!1,e.preventDefault()}),onInteractOutside:(0,s.m)(e.onInteractOutside,e=>{let t=e.detail.originalEvent,r=0===t.button&&!0===t.ctrlKey,n=2===t.button||r;(!o.modal||n)&&(l.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});nq.displayName=nH;var nz="DropdownMenuGroup",nV=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nv,{...i,...n,ref:t})});nV.displayName=nz;var nK="DropdownMenuLabel",nG=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nE,{...i,...n,ref:t})});nG.displayName=nK;var nW="DropdownMenuItem",nQ=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nA,{...i,...n,ref:t})});nQ.displayName=nW;var nJ="DropdownMenuCheckboxItem",nZ=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nx,{...i,...n,ref:t})});nZ.displayName=nJ;var nY="DropdownMenuRadioGroup",nX=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nS,{...i,...n,ref:t})});nX.displayName=nY;var n0="DropdownMenuRadioItem",n1=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nk,{...i,...n,ref:t})});n1.displayName=n0;var n2="DropdownMenuItemIndicator",n3=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(n_,{...i,...n,ref:t})});n3.displayName=n2;var n4="DropdownMenuSeparator",n5=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nI,{...i,...n,ref:t})});n5.displayName=n4;var n6="DropdownMenuArrow";i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nC,{...i,...n,ref:t})}).displayName=n6;var n8=e=>{let{__scopeDropdownMenu:t,children:r,open:n,onOpenChange:i,defaultOpen:s}=e,o=nB(t),[a,c]=(0,l.i)({prop:n,defaultProp:null!=s&&s,onChange:i,caller:"DropdownMenuSub"});return(0,b.jsx)(nT,{...o,open:a,onOpenChange:c,children:r})},n7="DropdownMenuSubTrigger",n9=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nP,{...i,...n,ref:t})});n9.displayName=n7;var ie="DropdownMenuSubContent",it=i.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=nB(r);return(0,b.jsx)(nR,{...i,...n,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});it.displayName=ie;var ir=nF,ii=nj,is=n$,io=nq,ia=nV,il=nG,ic=nQ,iu=nZ,ih=nX,id=n1,ip=n3,ig=n5,im=n8,iy=n9,ib=it},50271:(e,t,r)=>{var n="/",i=r(49509);!function(){var t={189:function(){!function(e,t){"use strict";if(!e.setImmediate){var r,n=1,s={},o=!1,a=e.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(e);l=l&&l.setTimeout?l:e,"[object process]"===({}).toString.call(e.process)?f():p()?g():e.MessageChannel?m():a&&"onreadystatechange"in a.createElement("script")?y():b(),l.setImmediate=c,l.clearImmediate=u}function c(e){"function"!=typeof e&&(e=Function(""+e));for(var t=Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var o={callback:e,args:t};return s[n]=o,r(n),n++}function u(e){delete s[e]}function h(e){var r=e.callback,n=e.args;switch(n.length){case 0:r();break;case 1:r(n[0]);break;case 2:r(n[0],n[1]);break;case 3:r(n[0],n[1],n[2]);break;default:r.apply(t,n)}}function d(e){if(o)setTimeout(d,0,e);else{var t=s[e];if(t){o=!0;try{h(t)}finally{u(e),o=!1}}}}function f(){r=function(e){i.nextTick(function(){d(e)})}}function p(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}function g(){var t="setImmediate$"+Math.random()+"$",n=function(r){r.source===e&&"string"==typeof r.data&&0===r.data.indexOf(t)&&d(+r.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),r=function(r){e.postMessage(t+r,"*")}}function m(){var e=new MessageChannel;e.port1.onmessage=function(e){d(e.data)},r=function(t){e.port2.postMessage(t)}}function y(){var e=a.documentElement;r=function(t){var r=a.createElement("script");r.onreadystatechange=function(){d(t),r.onreadystatechange=null,e.removeChild(r),r=null},e.appendChild(r)}}function b(){r=function(e){setTimeout(d,0,e)}}}("undefined"==typeof self?void 0===r.g?this:r.g:self)}};"undefined"!=typeof __nccwpck_require__&&(__nccwpck_require__.ab=n+"/");var s={};t[189](),e.exports=s}()},51476:e=>{var t=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},r=-1,n=1,i=0;t.Diff=function(e,t){return[e,t]},t.prototype.diff_main=function(e,r,n,s){void 0===s&&(s=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var o=s;if(null==e||null==r)throw Error("Null input. (diff_main)");if(e==r)return e?[new t.Diff(i,e)]:[];void 0===n&&(n=!0);var a=n,l=this.diff_commonPrefix(e,r),c=e.substring(0,l);e=e.substring(l),r=r.substring(l),l=this.diff_commonSuffix(e,r);var u=e.substring(e.length-l);e=e.substring(0,e.length-l),r=r.substring(0,r.length-l);var h=this.diff_compute_(e,r,a,o);return c&&h.unshift(new t.Diff(i,c)),u&&h.push(new t.Diff(i,u)),this.diff_cleanupMerge(h),h},t.prototype.diff_compute_=function(e,s,o,a){if(!e)return[new t.Diff(n,s)];if(!s)return[new t.Diff(r,e)];var l,c=e.length>s.length?e:s,u=e.length>s.length?s:e,h=c.indexOf(u);if(-1!=h)return l=[new t.Diff(n,c.substring(0,h)),new t.Diff(i,u),new t.Diff(n,c.substring(h+u.length))],e.length>s.length&&(l[0][0]=l[2][0]=r),l;if(1==u.length)return[new t.Diff(r,e),new t.Diff(n,s)];var d=this.diff_halfMatch_(e,s);if(d){var f=d[0],p=d[1],g=d[2],m=d[3],y=d[4],b=this.diff_main(f,g,o,a),w=this.diff_main(p,m,o,a);return b.concat([new t.Diff(i,y)],w)}return o&&e.length>100&&s.length>100?this.diff_lineMode_(e,s,a):this.diff_bisect_(e,s,a)},t.prototype.diff_lineMode_=function(e,s,o){var a=this.diff_linesToChars_(e,s);e=a.chars1,s=a.chars2;var l=a.lineArray,c=this.diff_main(e,s,!1,o);this.diff_charsToLines_(c,l),this.diff_cleanupSemantic(c),c.push(new t.Diff(i,""));for(var u=0,h=0,d=0,f="",p="";u<c.length;){switch(c[u][0]){case n:d++,p+=c[u][1];break;case r:h++,f+=c[u][1];break;case i:if(h>=1&&d>=1){c.splice(u-h-d,h+d),u=u-h-d;for(var g=this.diff_main(f,p,!1,o),m=g.length-1;m>=0;m--)c.splice(u,0,g[m]);u+=g.length}d=0,h=0,f="",p=""}u++}return c.pop(),c},t.prototype.diff_bisect_=function(e,i,s){for(var o=e.length,a=i.length,l=Math.ceil((o+a)/2),c=l,u=2*l,h=Array(u),d=Array(u),f=0;f<u;f++)h[f]=-1,d[f]=-1;h[c+1]=0,d[c+1]=0;for(var p=o-a,g=p%2!=0,m=0,y=0,b=0,w=0,v=0;v<l&&!(new Date().getTime()>s);v++){for(var E=-v+m;E<=v-y;E+=2){for(var A,x=c+E,S=(A=E==-v||E!=v&&h[x-1]<h[x+1]?h[x+1]:h[x-1]+1)-E;A<o&&S<a&&e.charAt(A)==i.charAt(S);)A++,S++;if(h[x]=A,A>o)y+=2;else if(S>a)m+=2;else if(g){var k=c+p-E;if(k>=0&&k<u&&-1!=d[k]){var _=o-d[k];if(A>=_)return this.diff_bisectSplit_(e,i,A,S,s)}}}for(var I=-v+b;I<=v-w;I+=2){for(var _,k=c+I,C=(_=I==-v||I!=v&&d[k-1]<d[k+1]?d[k+1]:d[k-1]+1)-I;_<o&&C<a&&e.charAt(o-_-1)==i.charAt(a-C-1);)_++,C++;if(d[k]=_,_>o)w+=2;else if(C>a)b+=2;else if(!g){var x=c+p-I;if(x>=0&&x<u&&-1!=h[x]){var A=h[x],S=c+A-x;if(A>=(_=o-_))return this.diff_bisectSplit_(e,i,A,S,s)}}}}return[new t.Diff(r,e),new t.Diff(n,i)]},t.prototype.diff_bisectSplit_=function(e,t,r,n,i){var s=e.substring(0,r),o=t.substring(0,n),a=e.substring(r),l=t.substring(n),c=this.diff_main(s,o,!1,i),u=this.diff_main(a,l,!1,i);return c.concat(u)},t.prototype.diff_linesToChars_=function(e,t){var r=[],n={};function i(e){for(var t="",i=0,o=-1,a=r.length;o<e.length-1;){-1==(o=e.indexOf("\n",i))&&(o=e.length-1);var l=e.substring(i,o+1);(n.hasOwnProperty?n.hasOwnProperty(l):void 0!==n[l])?t+=String.fromCharCode(n[l]):(a==s&&(l=e.substring(i),o=e.length),t+=String.fromCharCode(a),n[l]=a,r[a++]=l),i=o+1}return t}r[0]="";var s=4e4,o=i(e);return s=65535,{chars1:o,chars2:i(t),lineArray:r}},t.prototype.diff_charsToLines_=function(e,t){for(var r=0;r<e.length;r++){for(var n=e[r][1],i=[],s=0;s<n.length;s++)i[s]=t[n.charCodeAt(s)];e[r][1]=i.join("")}},t.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var r=0,n=Math.min(e.length,t.length),i=n,s=0;r<i;)e.substring(s,i)==t.substring(s,i)?s=r=i:n=i,i=Math.floor((n-r)/2+r);return i},t.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var r=0,n=Math.min(e.length,t.length),i=n,s=0;r<i;)e.substring(e.length-i,e.length-s)==t.substring(t.length-i,t.length-s)?s=r=i:n=i,i=Math.floor((n-r)/2+r);return i},t.prototype.diff_commonOverlap_=function(e,t){var r=e.length,n=t.length;if(0==r||0==n)return 0;r>n?e=e.substring(r-n):r<n&&(t=t.substring(0,r));var i=Math.min(r,n);if(e==t)return i;for(var s=0,o=1;;){var a=e.substring(i-o),l=t.indexOf(a);if(-1==l)return s;o+=l,(0==l||e.substring(i-o)==t.substring(0,o))&&(s=o,o++)}},t.prototype.diff_halfMatch_=function(e,t){if(this.Diff_Timeout<=0)return null;var r,n,i,s,o,a=e.length>t.length?e:t,l=e.length>t.length?t:e;if(a.length<4||2*l.length<a.length)return null;var c=this;function u(e,t,r){for(var n,i,s,o,a=e.substring(r,r+Math.floor(e.length/4)),l=-1,u="";-1!=(l=t.indexOf(a,l+1));){var h=c.diff_commonPrefix(e.substring(r),t.substring(l)),d=c.diff_commonSuffix(e.substring(0,r),t.substring(0,l));u.length<d+h&&(u=t.substring(l-d,l)+t.substring(l,l+h),n=e.substring(0,r-d),i=e.substring(r+h),s=t.substring(0,l-d),o=t.substring(l+h))}return 2*u.length>=e.length?[n,i,s,o,u]:null}var h=u(a,l,Math.ceil(a.length/4)),d=u(a,l,Math.ceil(a.length/2));return h||d?(r=d?h&&h[4].length>d[4].length?h:d:h,e.length>t.length?(n=r[0],i=r[1],s=r[2],o=r[3]):(s=r[0],o=r[1],n=r[2],i=r[3]),[n,i,s,o,r[4]]):null},t.prototype.diff_cleanupSemantic=function(e){for(var s=!1,o=[],a=0,l=null,c=0,u=0,h=0,d=0,f=0;c<e.length;)e[c][0]==i?(o[a++]=c,u=d,h=f,d=0,f=0,l=e[c][1]):(e[c][0]==n?d+=e[c][1].length:f+=e[c][1].length,l&&l.length<=Math.max(u,h)&&l.length<=Math.max(d,f)&&(e.splice(o[a-1],0,new t.Diff(r,l)),e[o[a-1]+1][0]=n,a--,c=--a>0?o[a-1]:-1,u=0,h=0,d=0,f=0,l=null,s=!0)),c++;for(s&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),c=1;c<e.length;){if(e[c-1][0]==r&&e[c][0]==n){var p=e[c-1][1],g=e[c][1],m=this.diff_commonOverlap_(p,g),y=this.diff_commonOverlap_(g,p);m>=y?(m>=p.length/2||m>=g.length/2)&&(e.splice(c,0,new t.Diff(i,g.substring(0,m))),e[c-1][1]=p.substring(0,p.length-m),e[c+1][1]=g.substring(m),c++):(y>=p.length/2||y>=g.length/2)&&(e.splice(c,0,new t.Diff(i,p.substring(0,y))),e[c-1][0]=n,e[c-1][1]=g.substring(0,g.length-y),e[c+1][0]=r,e[c+1][1]=p.substring(y),c++),c++}c++}},t.prototype.diff_cleanupSemanticLossless=function(e){function r(e,r){if(!e||!r)return 6;var n=e.charAt(e.length-1),i=r.charAt(0),s=n.match(t.nonAlphaNumericRegex_),o=i.match(t.nonAlphaNumericRegex_),a=s&&n.match(t.whitespaceRegex_),l=o&&i.match(t.whitespaceRegex_),c=a&&n.match(t.linebreakRegex_),u=l&&i.match(t.linebreakRegex_),h=c&&e.match(t.blanklineEndRegex_),d=u&&r.match(t.blanklineStartRegex_);if(h||d)return 5;if(c||u)return 4;if(s&&!a&&l)return 3;if(a||l)return 2;if(s||o)return 1;return 0}for(var n=1;n<e.length-1;){if(e[n-1][0]==i&&e[n+1][0]==i){var s=e[n-1][1],o=e[n][1],a=e[n+1][1],l=this.diff_commonSuffix(s,o);if(l){var c=o.substring(o.length-l);s=s.substring(0,s.length-l),o=c+o.substring(0,o.length-l),a=c+a}for(var u=s,h=o,d=a,f=r(s,o)+r(o,a);o.charAt(0)===a.charAt(0);){s+=o.charAt(0),o=o.substring(1)+a.charAt(0),a=a.substring(1);var p=r(s,o)+r(o,a);p>=f&&(f=p,u=s,h=o,d=a)}e[n-1][1]!=u&&(u?e[n-1][1]=u:(e.splice(n-1,1),n--),e[n][1]=h,d?e[n+1][1]=d:(e.splice(n+1,1),n--))}n++}},t.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,t.whitespaceRegex_=/\s/,t.linebreakRegex_=/[\r\n]/,t.blanklineEndRegex_=/\n\r?\n$/,t.blanklineStartRegex_=/^\r?\n\r?\n/,t.prototype.diff_cleanupEfficiency=function(e){for(var s=!1,o=[],a=0,l=null,c=0,u=!1,h=!1,d=!1,f=!1;c<e.length;)e[c][0]==i?(e[c][1].length<this.Diff_EditCost&&(d||f)?(o[a++]=c,u=d,h=f,l=e[c][1]):(a=0,l=null),d=f=!1):(e[c][0]==r?f=!0:d=!0,l&&(u&&h&&d&&f||l.length<this.Diff_EditCost/2&&u+h+d+f==3)&&(e.splice(o[a-1],0,new t.Diff(r,l)),e[o[a-1]+1][0]=n,a--,l=null,u&&h?(d=f=!0,a=0):(c=--a>0?o[a-1]:-1,d=f=!1),s=!0)),c++;s&&this.diff_cleanupMerge(e)},t.prototype.diff_cleanupMerge=function(e){e.push(new t.Diff(i,""));for(var s,o=0,a=0,l=0,c="",u="";o<e.length;)switch(e[o][0]){case n:l++,u+=e[o][1],o++;break;case r:a++,c+=e[o][1],o++;break;case i:a+l>1?(0!==a&&0!==l&&(0!==(s=this.diff_commonPrefix(u,c))&&(o-a-l>0&&e[o-a-l-1][0]==i?e[o-a-l-1][1]+=u.substring(0,s):(e.splice(0,0,new t.Diff(i,u.substring(0,s))),o++),u=u.substring(s),c=c.substring(s)),0!==(s=this.diff_commonSuffix(u,c))&&(e[o][1]=u.substring(u.length-s)+e[o][1],u=u.substring(0,u.length-s),c=c.substring(0,c.length-s))),o-=a+l,e.splice(o,a+l),c.length&&(e.splice(o,0,new t.Diff(r,c)),o++),u.length&&(e.splice(o,0,new t.Diff(n,u)),o++),o++):0!==o&&e[o-1][0]==i?(e[o-1][1]+=e[o][1],e.splice(o,1)):o++,l=0,a=0,c="",u=""}""===e[e.length-1][1]&&e.pop();var h=!1;for(o=1;o<e.length-1;)e[o-1][0]==i&&e[o+1][0]==i&&(e[o][1].substring(e[o][1].length-e[o-1][1].length)==e[o-1][1]?(e[o][1]=e[o-1][1]+e[o][1].substring(0,e[o][1].length-e[o-1][1].length),e[o+1][1]=e[o-1][1]+e[o+1][1],e.splice(o-1,1),h=!0):e[o][1].substring(0,e[o+1][1].length)==e[o+1][1]&&(e[o-1][1]+=e[o+1][1],e[o][1]=e[o][1].substring(e[o+1][1].length)+e[o+1][1],e.splice(o+1,1),h=!0)),o++;h&&this.diff_cleanupMerge(e)},t.prototype.diff_xIndex=function(e,t){var i,s=0,o=0,a=0,l=0;for(i=0;i<e.length&&(e[i][0]!==n&&(s+=e[i][1].length),e[i][0]!==r&&(o+=e[i][1].length),!(s>t));i++)a=s,l=o;return e.length!=i&&e[i][0]===r?l:l+(t-a)},t.prototype.diff_prettyHtml=function(e){for(var t=[],s=/&/g,o=/</g,a=/>/g,l=/\n/g,c=0;c<e.length;c++){var u=e[c][0],h=e[c][1].replace(s,"&amp;").replace(o,"&lt;").replace(a,"&gt;").replace(l,"&para;<br>");switch(u){case n:t[c]='<ins style="background:#e6ffe6;">'+h+"</ins>";break;case r:t[c]='<del style="background:#ffe6e6;">'+h+"</del>";break;case i:t[c]="<span>"+h+"</span>"}}return t.join("")},t.prototype.diff_text1=function(e){for(var t=[],r=0;r<e.length;r++)e[r][0]!==n&&(t[r]=e[r][1]);return t.join("")},t.prototype.diff_text2=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==r&&(t[n]=e[n][1]);return t.join("")},t.prototype.diff_levenshtein=function(e){for(var t=0,s=0,o=0,a=0;a<e.length;a++){var l=e[a][0],c=e[a][1];switch(l){case n:s+=c.length;break;case r:o+=c.length;break;case i:t+=Math.max(s,o),s=0,o=0}}return t+Math.max(s,o)},t.prototype.diff_toDelta=function(e){for(var t=[],s=0;s<e.length;s++)switch(e[s][0]){case n:t[s]="+"+encodeURI(e[s][1]);break;case r:t[s]="-"+e[s][1].length;break;case i:t[s]="="+e[s][1].length}return t.join("	").replace(/%20/g," ")},t.prototype.diff_fromDelta=function(e,s){for(var o=[],a=0,l=0,c=s.split(/\t/g),u=0;u<c.length;u++){var h=c[u].substring(1);switch(c[u].charAt(0)){case"+":try{o[a++]=new t.Diff(n,decodeURI(h))}catch(e){throw Error("Illegal escape in diff_fromDelta: "+h)}break;case"-":case"=":var d=parseInt(h,10);if(isNaN(d)||d<0)throw Error("Invalid number in diff_fromDelta: "+h);var f=e.substring(l,l+=d);"="==c[u].charAt(0)?o[a++]=new t.Diff(i,f):o[a++]=new t.Diff(r,f);break;default:if(c[u])throw Error("Invalid diff operation in diff_fromDelta: "+c[u])}}if(l!=e.length)throw Error("Delta length ("+l+") does not equal source text length ("+e.length+").");return o},t.prototype.match_main=function(e,t,r){if(null==e||null==t||null==r)throw Error("Null input. (match_main)");return(r=Math.max(0,Math.min(r,e.length)),e==t)?0:e.length?e.substring(r,r+t.length)==t?r:this.match_bitap_(e,t,r):-1},t.prototype.match_bitap_=function(e,t,r){if(t.length>this.Match_MaxBits)throw Error("Pattern too long for this browser.");var n,i,s,o=this.match_alphabet_(t),a=this;function l(e,n){var i=e/t.length,s=Math.abs(r-n);return a.Match_Distance?i+s/a.Match_Distance:s?1:i}var c=this.Match_Threshold,u=e.indexOf(t,r);-1!=u&&(c=Math.min(l(0,u),c),-1!=(u=e.lastIndexOf(t,r+t.length))&&(c=Math.min(l(0,u),c)));var h=1<<t.length-1;u=-1;for(var d=t.length+e.length,f=0;f<t.length;f++){for(n=0,i=d;n<i;)l(f,r+i)<=c?n=i:d=i,i=Math.floor((d-n)/2+n);d=i;var p=Math.max(1,r-i+1),g=Math.min(r+i,e.length)+t.length,m=Array(g+2);m[g+1]=(1<<f)-1;for(var y=g;y>=p;y--){var b=o[e.charAt(y-1)];if(0===f?m[y]=(m[y+1]<<1|1)&b:m[y]=(m[y+1]<<1|1)&b|((s[y+1]|s[y])<<1|1)|s[y+1],m[y]&h){var w=l(f,y-1);if(w<=c)if(c=w,(u=y-1)>r)p=Math.max(1,2*r-u);else break}}if(l(f+1,r)>c)break;s=m}return u},t.prototype.match_alphabet_=function(e){for(var t={},r=0;r<e.length;r++)t[e.charAt(r)]=0;for(var r=0;r<e.length;r++)t[e.charAt(r)]|=1<<e.length-r-1;return t},t.prototype.patch_addContext_=function(e,r){if(0!=r.length){if(null===e.start2)throw Error("patch not initialized");for(var n=r.substring(e.start2,e.start2+e.length1),s=0;r.indexOf(n)!=r.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)s+=this.Patch_Margin,n=r.substring(e.start2-s,e.start2+e.length1+s);s+=this.Patch_Margin;var o=r.substring(e.start2-s,e.start2);o&&e.diffs.unshift(new t.Diff(i,o));var a=r.substring(e.start2+e.length1,e.start2+e.length1+s);a&&e.diffs.push(new t.Diff(i,a)),e.start1-=o.length,e.start2-=o.length,e.length1+=o.length+a.length,e.length2+=o.length+a.length}},t.prototype.patch_make=function(e,s,o){if("string"==typeof e&&"string"==typeof s&&void 0===o)a=e,(l=this.diff_main(a,s,!0)).length>2&&(this.diff_cleanupSemantic(l),this.diff_cleanupEfficiency(l));else if(e&&"object"==typeof e&&void 0===s&&void 0===o)l=e,a=this.diff_text1(l);else if("string"==typeof e&&s&&"object"==typeof s&&void 0===o)a=e,l=s;else if("string"==typeof e&&"string"==typeof s&&o&&"object"==typeof o)a=e,l=o;else throw Error("Unknown call format to patch_make.");if(0===l.length)return[];for(var a,l,c=[],u=new t.patch_obj,h=0,d=0,f=0,p=a,g=a,m=0;m<l.length;m++){var y=l[m][0],b=l[m][1];switch(!h&&y!==i&&(u.start1=d,u.start2=f),y){case n:u.diffs[h++]=l[m],u.length2+=b.length,g=g.substring(0,f)+b+g.substring(f);break;case r:u.length1+=b.length,u.diffs[h++]=l[m],g=g.substring(0,f)+g.substring(f+b.length);break;case i:b.length<=2*this.Patch_Margin&&h&&l.length!=m+1?(u.diffs[h++]=l[m],u.length1+=b.length,u.length2+=b.length):b.length>=2*this.Patch_Margin&&h&&(this.patch_addContext_(u,p),c.push(u),u=new t.patch_obj,h=0,p=g,d=f)}y!==n&&(d+=b.length),y!==r&&(f+=b.length)}return h&&(this.patch_addContext_(u,p),c.push(u)),c},t.prototype.patch_deepCopy=function(e){for(var r=[],n=0;n<e.length;n++){var i=e[n],s=new t.patch_obj;s.diffs=[];for(var o=0;o<i.diffs.length;o++)s.diffs[o]=new t.Diff(i.diffs[o][0],i.diffs[o][1]);s.start1=i.start1,s.start2=i.start2,s.length1=i.length1,s.length2=i.length2,r[n]=s}return r},t.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var s=this.patch_addPadding(e);t=s+t+s,this.patch_splitMax(e);for(var o=0,a=[],l=0;l<e.length;l++){var c=e[l].start2+o,u=this.diff_text1(e[l].diffs),h=-1;if(u.length>this.Match_MaxBits?-1!=(f=this.match_main(t,u.substring(0,this.Match_MaxBits),c))&&(-1==(h=this.match_main(t,u.substring(u.length-this.Match_MaxBits),c+u.length-this.Match_MaxBits))||f>=h)&&(f=-1):f=this.match_main(t,u,c),-1==f)a[l]=!1,o-=e[l].length2-e[l].length1;else if(a[l]=!0,o=f-c,p=-1==h?t.substring(f,f+u.length):t.substring(f,h+this.Match_MaxBits),u==p)t=t.substring(0,f)+this.diff_text2(e[l].diffs)+t.substring(f+u.length);else{var d=this.diff_main(u,p,!1);if(u.length>this.Match_MaxBits&&this.diff_levenshtein(d)/u.length>this.Patch_DeleteThreshold)a[l]=!1;else{this.diff_cleanupSemanticLossless(d);for(var f,p,g,m=0,y=0;y<e[l].diffs.length;y++){var b=e[l].diffs[y];b[0]!==i&&(g=this.diff_xIndex(d,m)),b[0]===n?t=t.substring(0,f+g)+b[1]+t.substring(f+g):b[0]===r&&(t=t.substring(0,f+g)+t.substring(f+this.diff_xIndex(d,m+b[1].length))),b[0]!==r&&(m+=b[1].length)}}}}return[t=t.substring(s.length,t.length-s.length),a]},t.prototype.patch_addPadding=function(e){for(var r=this.Patch_Margin,n="",s=1;s<=r;s++)n+=String.fromCharCode(s);for(var s=0;s<e.length;s++)e[s].start1+=r,e[s].start2+=r;var o=e[0],a=o.diffs;if(0==a.length||a[0][0]!=i)a.unshift(new t.Diff(i,n)),o.start1-=r,o.start2-=r,o.length1+=r,o.length2+=r;else if(r>a[0][1].length){var l=r-a[0][1].length;a[0][1]=n.substring(a[0][1].length)+a[0][1],o.start1-=l,o.start2-=l,o.length1+=l,o.length2+=l}if(0==(a=(o=e[e.length-1]).diffs).length||a[a.length-1][0]!=i)a.push(new t.Diff(i,n)),o.length1+=r,o.length2+=r;else if(r>a[a.length-1][1].length){var l=r-a[a.length-1][1].length;a[a.length-1][1]+=n.substring(0,l),o.length1+=l,o.length2+=l}return n},t.prototype.patch_splitMax=function(e){for(var s=this.Match_MaxBits,o=0;o<e.length;o++)if(!(e[o].length1<=s)){var a=e[o];e.splice(o--,1);for(var l=a.start1,c=a.start2,u="";0!==a.diffs.length;){var h=new t.patch_obj,d=!0;for(h.start1=l-u.length,h.start2=c-u.length,""!==u&&(h.length1=h.length2=u.length,h.diffs.push(new t.Diff(i,u)));0!==a.diffs.length&&h.length1<s-this.Patch_Margin;){var f=a.diffs[0][0],p=a.diffs[0][1];f===n?(h.length2+=p.length,c+=p.length,h.diffs.push(a.diffs.shift()),d=!1):f===r&&1==h.diffs.length&&h.diffs[0][0]==i&&p.length>2*s?(h.length1+=p.length,l+=p.length,d=!1,h.diffs.push(new t.Diff(f,p)),a.diffs.shift()):(p=p.substring(0,s-h.length1-this.Patch_Margin),h.length1+=p.length,l+=p.length,f===i?(h.length2+=p.length,c+=p.length):d=!1,h.diffs.push(new t.Diff(f,p)),p==a.diffs[0][1]?a.diffs.shift():a.diffs[0][1]=a.diffs[0][1].substring(p.length))}u=(u=this.diff_text2(h.diffs)).substring(u.length-this.Patch_Margin);var g=this.diff_text1(a.diffs).substring(0,this.Patch_Margin);""!==g&&(h.length1+=g.length,h.length2+=g.length,0!==h.diffs.length&&h.diffs[h.diffs.length-1][0]===i?h.diffs[h.diffs.length-1][1]+=g:h.diffs.push(new t.Diff(i,g))),d||e.splice(++o,0,h)}}},t.prototype.patch_toText=function(e){for(var t=[],r=0;r<e.length;r++)t[r]=e[r];return t.join("")},t.prototype.patch_fromText=function(e){var s=[];if(!e)return s;for(var o=e.split("\n"),a=0,l=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;a<o.length;){var c=o[a].match(l);if(!c)throw Error("Invalid patch string: "+o[a]);var u=new t.patch_obj;for(s.push(u),u.start1=parseInt(c[1],10),""===c[2]?(u.start1--,u.length1=1):"0"==c[2]?u.length1=0:(u.start1--,u.length1=parseInt(c[2],10)),u.start2=parseInt(c[3],10),""===c[4]?(u.start2--,u.length2=1):"0"==c[4]?u.length2=0:(u.start2--,u.length2=parseInt(c[4],10)),a++;a<o.length;){var h=o[a].charAt(0);try{var d=decodeURI(o[a].substring(1))}catch(e){throw Error("Illegal escape in patch_fromText: "+d)}if("-"==h)u.diffs.push(new t.Diff(r,d));else if("+"==h)u.diffs.push(new t.Diff(n,d));else if(" "==h)u.diffs.push(new t.Diff(i,d));else if("@"==h)break;else if(""===h);else throw Error('Invalid patch mode "'+h+'" in: '+d);a++}}return s},t.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},t.patch_obj.prototype.toString=function(){e=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1;for(var e,t,s=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2,o=["@@ -"+e+" +"+s+" @@\n"],a=0;a<this.diffs.length;a++){switch(this.diffs[a][0]){case n:t="+";break;case r:t="-";break;case i:t=" "}o[a+1]=t+encodeURI(this.diffs[a][1])+"\n"}return o.join("").replace(/%20/g," ")},e.exports=t,e.exports.diff_match_patch=t,e.exports.DIFF_DELETE=r,e.exports.DIFF_INSERT=n,e.exports.DIFF_EQUAL=i},51517:e=>{"use strict";e.exports=Math.max},52103:e=>{"use strict";function t(e){return e>=55296&&e<=56319}function r(e){return e>=56320&&e<=57343}e.exports=function(e){if("string"!=typeof e)throw Error("Input must be string");for(var n=e.length,i=0,s=null,o=null,a=0;a<n;a++)r(s=e.charCodeAt(a))?null!=o&&t(o)?i+=1:i+=3:s<=127?i+=1:s>=128&&s<=2047?i+=2:s>=2048&&s<=65535&&(i+=3),o=s;return i}},52192:e=>{"use strict";var t="Function.prototype.bind called on incompatible ",r=Object.prototype.toString,n=Math.max,i="[object Function]",s=function(e,t){for(var r=[],n=0;n<e.length;n+=1)r[n]=e[n];for(var i=0;i<t.length;i+=1)r[i+e.length]=t[i];return r},o=function(e,t){for(var r=[],n=t||0,i=0;n<e.length;n+=1,i+=1)r[i]=e[n];return r},a=function(e,t){for(var r="",n=0;n<e.length;n+=1)r+=e[n],n+1<e.length&&(r+=t);return r};e.exports=function(e){var l,c=this;if("function"!=typeof c||r.apply(c)!==i)throw TypeError(t+c);for(var u=o(arguments,1),h=function(){if(this instanceof l){var t=c.apply(this,s(u,arguments));return Object(t)===t?t:this}return c.apply(e,s(u,arguments))},d=n(0,c.length-u.length),f=[],p=0;p<d;p++)f[p]="$"+p;if(l=Function("binder","return function ("+a(f,",")+"){ return binder.apply(this,arguments); }")(h),c.prototype){var g=function(){};g.prototype=c.prototype,l.prototype=new g,g.prototype=null}return l}},52215:(e,t,r)=>{"use strict";r.d(t,{_Q:()=>h,HT:()=>u,yE:()=>p});var n=r(70834);let i=function(e,t){if(e.length>=255)throw TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw TypeError(s+" is ambiguous");r[o]=i}var a=e.length,l=e.charAt(0),c=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[0]){for(var n=0,i=0;e[t]===l;)n++,t++;for(var s=(e.length-t)*c+1>>>0,o=new Uint8Array(s);e[t];){var u=r[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=s-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*o[d]>>>0,o[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),g=n;f!==s;)p[g++]=o[f++];return p}}}function d(e){var r=h(e);if(r)return r;throw Error(`Non-${t} character`)}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*u+1>>>0,c=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*c[f]>>>0,c[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===c[p];)p++;for(var g=l.repeat(r);p<o;++p)g+=e.charAt(c[p]);return g},decodeUnsafe:h,decode:d}};class s{name;prefix;baseEncode;constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class o{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,r){this.name=e,this.prefix=t;let n=t.codePointAt(0);if(void 0===n)throw Error("Invalid prefix character");this.prefixCodePoint=n,this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return l(this,e)}}class a{decoders;constructor(e){this.decoders=e}or(e){return l(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(null!=r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function l(e,t){return new a({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}class c{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new s(e,t,r),this.decoder=new o(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function u({name:e,prefix:t,encode:r,decode:n}){return new c(e,t,r,n)}function h({name:e,prefix:t,alphabet:r}){let{encode:s,decode:o}=i(r,e);return u({prefix:t,name:e,encode:s,decode:e=>(0,n.coerce)(o(e))})}function d(e,t,r,n){let i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;let o=new Uint8Array(s*r/8|0),a=0,l=0,c=0;for(let t=0;t<s;++t){let s=i[e[t]];if(void 0===s)throw SyntaxError(`Non-${n} character`);l=l<<r|s,(a+=r)>=8&&(a-=8,o[c++]=255&l>>a)}if(a>=r||(255&l<<8-a)!=0)throw SyntaxError("Unexpected end of data");return o}function f(e,t,r){let n="="===t[t.length-1],i=(1<<r)-1,s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(0!==o&&(s+=t[i&a<<r-o]),n)for(;(s.length*r&7)!=0;)s+="=";return s}function p({name:e,prefix:t,bitsPerChar:r,alphabet:n}){return u({prefix:t,name:e,encode:e=>f(e,n,r),decode:t=>d(t,n,r,e)})}},52430:(e,t,r)=>{"use strict";var n=r(52192);e.exports=Function.prototype.bind||n},52647:(e,t,r)=>{var n=r(40662),i=r(84115);function s(e){if(!(this instanceof s))return new s(e);"number"==typeof e&&(e={max:e}),e||(e={}),n.EventEmitter.call(this),this.cache={},this.head=this.tail=null,this.length=0,this.max=e.max||1e3,this.maxAge=e.maxAge||0}e.exports=s,i(s,n.EventEmitter),Object.defineProperty(s.prototype,"keys",{get:function(){return Object.keys(this.cache)}}),s.prototype.clear=function(){this.cache={},this.head=this.tail=null,this.length=0},s.prototype.remove=function(e){if("string"!=typeof e&&(e=""+e),this.cache.hasOwnProperty(e)){var t=this.cache[e];return delete this.cache[e],this._unlink(e,t.prev,t.next),t.value}},s.prototype._unlink=function(e,t,r){this.length--,0===this.length?this.head=this.tail=null:this.head===e?(this.head=t,this.cache[this.head].next=null):this.tail===e?(this.tail=r,this.cache[this.tail].prev=null):(this.cache[t].next=r,this.cache[r].prev=t)},s.prototype.peek=function(e){if(this.cache.hasOwnProperty(e)){var t=this.cache[e];if(this._checkAge(e,t))return t.value}},s.prototype.set=function(e,t){var r;if("string"!=typeof e&&(e=""+e),this.cache.hasOwnProperty(e)){if((r=this.cache[e]).value=t,this.maxAge&&(r.modified=Date.now()),e===this.head)return t;this._unlink(e,r.prev,r.next)}else r={value:t,modified:0,next:null,prev:null},this.maxAge&&(r.modified=Date.now()),this.cache[e]=r,this.length===this.max&&this.evict();return this.length++,r.next=null,r.prev=this.head,this.head&&(this.cache[this.head].next=e),this.head=e,this.tail||(this.tail=e),t},s.prototype._checkAge=function(e,t){return!(this.maxAge&&Date.now()-t.modified>this.maxAge)||(this.remove(e),this.emit("evict",{key:e,value:t.value}),!1)},s.prototype.get=function(e){if("string"!=typeof e&&(e=""+e),this.cache.hasOwnProperty(e)){var t=this.cache[e];if(this._checkAge(e,t))return this.head!==e&&(e===this.tail?(this.tail=t.next,this.cache[this.tail].prev=null):this.cache[t.prev].next=t.next,this.cache[t.next].prev=t.prev,this.cache[this.head].next=e,t.prev=this.head,t.next=null,this.head=e),t.value}},s.prototype.evict=function(){if(this.tail){var e=this.tail,t=this.remove(this.tail);this.emit("evict",{key:e,value:t})}}},53377:(e,t,r)=>{"use strict";var n=r(28886);e.exports=function(e){return!!n(e)}},53647:(e,t,r)=>{"use strict";r.r(t),r.d(t,{base64:()=>i,base64pad:()=>s,base64url:()=>o,base64urlpad:()=>a});var n=r(52215);let i=(0,n.yE)({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),s=(0,n.yE)({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),o=(0,n.yE)({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),a=(0,n.yE)({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})},54251:e=>{"use strict";e.exports=Math.min},54954:(e,t,r)=>{"use strict";r.d(t,{f:()=>a});var n=r(24802),i=r(76520),s=r(76154),o=r(91295);class a{put(e,t,r){return Promise.reject(Error(".put is not implemented"))}get(e,t){return Promise.reject(Error(".get is not implemented"))}has(e,t){return Promise.reject(Error(".has is not implemented"))}delete(e,t){return Promise.reject(Error(".delete is not implemented"))}async *putMany(e,t={}){for await(let{key:r,value:n}of e)await this.put(r,n,t),yield r}async *getMany(e,t={}){for await(let r of e)yield{key:r,value:await this.get(r,t)}}async *deleteMany(e,t={}){for await(let r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await (0,n.A)(this.putMany(e,r)),e=[],await (0,n.A)(this.deleteMany(t,r)),t=[]}}}async *_all(e,t){throw Error("._all is not implemented")}async *_allKeys(e,t){throw Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix){let t=e.prefix;r=(0,i.A)(r,e=>e.key.toString().startsWith(t))}if(Array.isArray(e.filters)&&(r=e.filters.reduce((e,t)=>(0,i.A)(e,t),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((e,t)=>(0,s.A)(e,t),r)),null!=e.offset){let t=0,n=e.offset;r=(0,i.A)(r,()=>t++>=n)}return null!=e.limit&&(r=(0,o.A)(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix){let t=e.prefix;r=(0,i.A)(r,e=>e.toString().startsWith(t))}if(Array.isArray(e.filters)&&(r=e.filters.reduce((e,t)=>(0,i.A)(e,t),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((e,t)=>(0,s.A)(e,t),r)),null!=e.offset){let t=e.offset,n=0;r=(0,i.A)(r,()=>n++>=t)}return null!=e.limit&&(r=(0,o.A)(r,e.limit)),r}}},56335:(e,t,r)=>{"use strict";let n;r.d(t,{e:()=>m});var i=r(17849),s=r(49509);let o="test"==s.env.ETH_ENV?"http://localhost:8545":`https://sepolia.infura.io/v3/${s.env.SEPOLIA_API_KEY}`;if("undefined"!=typeof window&&void 0!==window.ethereum)window.ethereum.request({method:"eth_requestAccounts"}),n=new i.Ay$(window.ethereum);else{let e=new i.Ay$.providers.HttpProvider(o);n=new i.Ay$(e)}let a=n,l=JSON.parse('[{"inputs":[{"internalType":"string","name":"","type":"string"}],"name":"aliasToWalletAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"","type":"string"}],"name":"chatNameToAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"chatNames","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"chats","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_name","type":"string"}],"name":"createChat","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_walletAddress","type":"address"}],"name":"getAlias","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_alias","type":"string"}],"name":"setAlias","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"walletAddressToAlias","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"}]'),c=JSON.parse('[{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"id","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"parentId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"sender","type":"address"},{"indexed":false,"internalType":"string","name":"senderAlias","type":"string"},{"indexed":false,"internalType":"string","name":"content","type":"string"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"MessageSent","type":"event"},{"inputs":[],"name":"factory","outputs":[{"internalType":"contract ChatFactory","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getMessages","outputs":[{"components":[{"internalType":"bytes32","name":"id","type":"bytes32"},{"internalType":"bytes32","name":"parentId","type":"bytes32"},{"internalType":"address","name":"sender","type":"address"},{"internalType":"string","name":"senderAlias","type":"string"},{"internalType":"string","name":"content","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"internalType":"struct Chat.Message[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"messages","outputs":[{"internalType":"bytes32","name":"id","type":"bytes32"},{"internalType":"bytes32","name":"parentId","type":"bytes32"},{"internalType":"address","name":"sender","type":"address"},{"internalType":"string","name":"senderAlias","type":"string"},{"internalType":"string","name":"content","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_content","type":"string"},{"internalType":"bytes32","name":"_parentId","type":"bytes32"}],"name":"sendMessage","outputs":[],"stateMutability":"nonpayable","type":"function"}]'),u="0x73511669fd4dE447feD18BB79bAFeAC93aB7F31f",h="0x0000000000000000000000000000000000000000000000000000000000000000";class d{chatFactoryInstance;constructor(){this.chatFactoryInstance=new a.eth.Contract(l,u)}async createChat(e){let t=await a.eth.getAccounts();await this.chatFactoryInstance.methods.createChat(e).send({from:t[0]})}async listenToNewMessages(e,t){(await this.buildChatContractInstance(e)).events.MessageSent().on("data",e=>{let{id:r,parentId:n,sender:i,senderAlias:s,content:o,timestamp:a}=e.returnValues;t({id:r,parentId:n===h?void 0:n,sender:i,senderAlias:s,message:o,timestamp:Number(a)})})}async getMessages(e){let t=await this.buildChatContractInstance(e);return(await t.methods.getMessages().call()).map(e=>({id:e.id,parentId:e.parentId===h?void 0:e.parentId,sender:e.sender,senderAlias:e.senderAlias,message:e.content,timestamp:e.timestamp}))}async sendMessage(e,t,r){let n=await this.buildChatContractInstance(e),i=await a.eth.getAccounts(),s=r||h;await n.methods.sendMessage(t,s).send({from:i[0]})}async setAlias(e){let t=await a.eth.getAccounts();await this.chatFactoryInstance.methods.setAlias(e).send({from:t[0]})}async getAlias(){let e=await a.eth.getAccounts();return await this.chatFactoryInstance.methods.getAlias(e[0]).call()}async buildChatContractInstance(e){let t=await this.chatFactoryInstance.methods.chatNameToAddress(e).call();return new a.eth.Contract(c,t)}}let f=d;class p{chatRepository;constructor(){this.chatRepository=new f}async start(){throw Error("Method not implemented.")}async listenToNewMessages(e,t){this.chatRepository.listenToNewMessages(e,t)}async createChat(e){this.chatRepository.createChat(e)}async sendMessage(e,t,r){await this.chatRepository.sendMessage(e,t,r)}async getMessages(e){return(await this.chatRepository.getMessages(e)).map(e=>({id:e.id,parentId:e.parentId,sender:e.sender,senderAlias:e.senderAlias,message:e.message,timestamp:Number(e.timestamp)}))}async setAlias(e){await this.chatRepository.setAlias(e)}async getAlias(){return await this.chatRepository.getAlias()}async getChatNames(){throw Error("Method not implemented.")}}let g=p;async function m(){return new g}},56406:(e,t,r)=>{"use strict";var n="undefined"!=typeof Symbol&&Symbol,i=r(68852);e.exports=function(){return"function"==typeof n&&"function"==typeof Symbol&&"symbol"==typeof n("foo")&&"symbol"==typeof Symbol("bar")&&i()}},56765:(e,t,r)=>{let n;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:r.g):e=>(n||(n=Promise.resolve())).then(e).catch(e=>setTimeout(()=>{throw e},0))},57116:(e,t,r)=>{"use strict";r.d(t,{JL:()=>o,a6:()=>i,m9:()=>a});var n=r(51476);function i(e){let t=new n,r=e.flatMap(e=>e.patch),[i,s]=t.patch_apply(r,"");for(let e=0;e<s.length;e++)if(!s[e])throw Error(`Failed to apply patch ${e}`);return i}function s(e,t){return new n().patch_make(e,t)}function o(e,t,r){let n=crypto.randomUUID();return{id:n,date:Date.now().toString(),patch:s(e,t),parent:r??null}}var a=class{versions;lastVersion;cachedMainBranch;constructor(e){if(this.versions=new Map,e)for(let t of e)this.addVersionRaw(t);this.lastVersion=this.getLastVersion(),this.cachedMainBranch=null}addVersion(e){this.addVersionRaw(e),this.lastVersion=this.getLastVersion(),this.cachedMainBranch=null}getAllVersions(){return Array.from(this.versions.values())}getMainBranch(){if(this.cachedMainBranch)return this.cachedMainBranch;let e=this.lastVersion;if(!e)return[];let t=this.getBranch(e);return this.cachedMainBranch=t,t}getBranch(e){let t=[],r=e;for(;r;){let e=this.versions.get(r);if(!e)throw Error("Version not found while walking main version branch");t.push(e),r=e.parent}return t.reverse(),t}addVersionRaw(e){if(this.versions.has(e.id))throw Error("Version with the same ID already exists");this.versions.set(e.id,e)}getLastVersion(){let e=this.getLeaves(this.versions);if(0===e.size)return null;let t=this.getLongestBranchLeaf(e,this.versions).map(e=>this.versions.get(e));return t.sort((e,t)=>e.date<t.date?1:-1),t.pop().id}getLeaves(e){let t=new Set,r=new Set;for(let[n,i]of e)r.has(n)||(i.parent&&(r.add(i.parent),t.delete(i.parent)),t.add(n));return t}getLongestBranchLeaf(e,t){let r=new Map,n=0,i=[];for(let s of e){let e=this.getVersionRootDistance(s,r,t);i.push({leaf:s,distance:e}),e>n&&(n=e)}return i.filter(e=>e.distance===n).map(e=>e.leaf)}getVersionRootDistance(e,t,r){if(t.has(e))return t.get(e);let n=r.get(e);if(!n)throw Error(`Version not found: ${e}`);if(!n.parent)return t.set(e,0),0;let i=this.getVersionRootDistance(n.parent,t,r)+1;return t.set(e,i),i}}},57621:(e,t,r)=>{"use strict";let{fromCallback:n}=r(82813),i=r(7800),{getCallback:s,getOptions:o}=r(33534),a=Symbol("promise"),l=Symbol("status"),c=Symbol("operations"),u=Symbol("finishClose"),h=Symbol("closeCallbacks");class d{constructor(e){if("object"!=typeof e||null===e){let t=null===e?"null":typeof e;throw TypeError(`The first argument must be an abstract-level database, received ${t}`)}this[c]=[],this[h]=[],this[l]="open",this[u]=this[u].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[c].length}put(e,t,r){if("open"!==this[l])throw new i("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let n=this.db._checkKey(e)||this.db._checkValue(t);if(n)throw n;let s=r&&null!=r.sublevel?r.sublevel:this.db,o=r,a=s.keyEncoding(r&&r.keyEncoding),u=s.valueEncoding(r&&r.valueEncoding),h=a.format;r={...r,keyEncoding:h,valueEncoding:u.format},s!==this.db&&(r.sublevel=null);let d=s.prefixKey(a.encode(e),h),f=u.encode(t);return this._put(d,f,r),this[c].push({...o,type:"put",key:e,value:t}),this}_put(e,t,r){}del(e,t){if("open"!==this[l])throw new i("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let r=this.db._checkKey(e);if(r)throw r;let n=t&&null!=t.sublevel?t.sublevel:this.db,s=t,o=n.keyEncoding(t&&t.keyEncoding),a=o.format;return t={...t,keyEncoding:a},n!==this.db&&(t.sublevel=null),this._del(n.prefixKey(o.encode(e),a),t),this[c].push({...s,type:"del",key:e}),this}_del(e,t){}clear(){if("open"!==this[l])throw new i("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[c]=[],this}_clear(){}write(e,t){return t=n(t=s(e,t),a),e=o(e),"open"!==this[l]?this.nextTick(t,new i("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):0===this.length?this.close(t):(this[l]="writing",this._write(e,e=>{this[l]="closing",this[h].push(()=>t(e)),e||this.db.emit("batch",this[c]),this._close(this[u])})),t[a]}_write(e,t){}close(e){return e=n(e,a),"closing"===this[l]?this[h].push(e):"closed"===this[l]?this.nextTick(e):(this[h].push(e),"writing"!==this[l]&&(this[l]="closing",this._close(this[u]))),e[a]}_close(e){this.nextTick(e)}[u](){this[l]="closed",this.db.detachResource(this);let e=this[h];for(let t of(this[h]=[],e))t()}}t.AbstractChainedBatch=d},57719:(e,t)=>{"use strict";t.byteLength=c,t.toByteArray=h,t.fromByteArray=p;for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=s.length;o<a;++o)r[o]=s[o],n[s.charCodeAt(o)]=o;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}function c(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n}function u(e,t,r){return(t+r)*3/4-r}function h(e){var t,r,s=l(e),o=s[0],a=s[1],c=new i(u(e,o,a)),h=0,d=a>0?o-4:o;for(r=0;r<d;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],c[h++]=t>>16&255,c[h++]=t>>8&255,c[h++]=255&t;return 2===a&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,c[h++]=255&t),1===a&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,c[h++]=t>>8&255,c[h++]=255&t),c}function d(e){return r[e>>18&63]+r[e>>12&63]+r[e>>6&63]+r[63&e]}function f(e,t,r){for(var n=[],i=t;i<r;i+=3)n.push(d((e[i]<<16&0xff0000)+(e[i+1]<<8&65280)+(255&e[i+2])));return n.join("")}function p(e){for(var t,n=e.length,i=n%3,s=[],o=16383,a=0,l=n-i;a<l;a+=o)s.push(f(e,a,a+o>l?l:a+o));return 1===i?s.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===i&&s.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),s.join("")}n[45]=62,n[95]=63},59372:(e,t,r)=>{t.Level=r(80501).BrowserLevel},59615:(e,t,r)=>{"use strict";let{AbortController:n}=globalThis,i=r(24658);class s extends n{constructor(e){super(),this._ms=e,this._timer=i(()=>this.abort(),e),Object.setPrototypeOf(this,s.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=i(()=>this.abort(),this._ms)}}e.exports={TimeoutController:s}},59888:(e,t,r)=>{"use strict";var n=r(62030),i=r(61925),s=r(63674),o=r(81954);e.exports=function(e,t,r){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new s("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new s("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new s("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new s("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new s("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new s("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,u=arguments.length>6&&arguments[6],h=!!o&&o(e,t);if(n)n(e,t,{configurable:null===c&&h?h.configurable:!c,enumerable:null===a&&h?h.enumerable:!a,value:r,writable:null===l&&h?h.writable:!l});else if(!u&&(a||l||c))throw new i("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");else e[t]=r}},60261:e=>{"use strict";e.exports=Function.prototype.call},60289:(e,t,r)=>{"use strict";var n=r(94061),i=r(17001),s=r(28886),o=r(53377);function a(e){return e.call.bind(e)}var l="undefined"!=typeof BigInt,c="undefined"!=typeof Symbol,u=a(Object.prototype.toString),h=a(Number.prototype.valueOf),d=a(String.prototype.valueOf),f=a(Boolean.prototype.valueOf);if(l)var p=a(BigInt.prototype.valueOf);if(c)var g=a(Symbol.prototype.valueOf);function m(e,t){if("object"!=typeof e)return!1;try{return t(e),!0}catch(e){return!1}}function y(e){return"[object Map]"===u(e)}function b(e){return"[object Set]"===u(e)}function w(e){return"[object WeakMap]"===u(e)}function v(e){return"[object WeakSet]"===u(e)}function E(e){return"[object ArrayBuffer]"===u(e)}function A(e){return"undefined"!=typeof ArrayBuffer&&(E.working?E(e):e instanceof ArrayBuffer)}function x(e){return"[object DataView]"===u(e)}function S(e){return"undefined"!=typeof DataView&&(x.working?x(e):e instanceof DataView)}t.isArgumentsObject=n,t.isGeneratorFunction=i,t.isTypedArray=o,t.isPromise=function(e){return"undefined"!=typeof Promise&&e instanceof Promise||null!==e&&"object"==typeof e&&"function"==typeof e.then&&"function"==typeof e.catch},t.isArrayBufferView=function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):o(e)||S(e)},t.isUint8Array=function(e){return"Uint8Array"===s(e)},t.isUint8ClampedArray=function(e){return"Uint8ClampedArray"===s(e)},t.isUint16Array=function(e){return"Uint16Array"===s(e)},t.isUint32Array=function(e){return"Uint32Array"===s(e)},t.isInt8Array=function(e){return"Int8Array"===s(e)},t.isInt16Array=function(e){return"Int16Array"===s(e)},t.isInt32Array=function(e){return"Int32Array"===s(e)},t.isFloat32Array=function(e){return"Float32Array"===s(e)},t.isFloat64Array=function(e){return"Float64Array"===s(e)},t.isBigInt64Array=function(e){return"BigInt64Array"===s(e)},t.isBigUint64Array=function(e){return"BigUint64Array"===s(e)},y.working="undefined"!=typeof Map&&y(new Map),t.isMap=function(e){return"undefined"!=typeof Map&&(y.working?y(e):e instanceof Map)},b.working="undefined"!=typeof Set&&b(new Set),t.isSet=function(e){return"undefined"!=typeof Set&&(b.working?b(e):e instanceof Set)},w.working="undefined"!=typeof WeakMap&&w(new WeakMap),t.isWeakMap=function(e){return"undefined"!=typeof WeakMap&&(w.working?w(e):e instanceof WeakMap)},v.working="undefined"!=typeof WeakSet&&v(new WeakSet),t.isWeakSet=function(e){return v(e)},E.working="undefined"!=typeof ArrayBuffer&&E(new ArrayBuffer),t.isArrayBuffer=A,x.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&x(new DataView(new ArrayBuffer(1),0,1)),t.isDataView=S;var k="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:void 0;function _(e){return"[object SharedArrayBuffer]"===u(e)}function I(e){return void 0!==k&&(void 0===_.working&&(_.working=_(new k)),_.working?_(e):e instanceof k)}function C(e){return m(e,h)}function T(e){return m(e,d)}function P(e){return m(e,f)}function R(e){return l&&m(e,p)}function O(e){return c&&m(e,g)}t.isSharedArrayBuffer=I,t.isAsyncFunction=function(e){return"[object AsyncFunction]"===u(e)},t.isMapIterator=function(e){return"[object Map Iterator]"===u(e)},t.isSetIterator=function(e){return"[object Set Iterator]"===u(e)},t.isGeneratorObject=function(e){return"[object Generator]"===u(e)},t.isWebAssemblyCompiledModule=function(e){return"[object WebAssembly.Module]"===u(e)},t.isNumberObject=C,t.isStringObject=T,t.isBooleanObject=P,t.isBigIntObject=R,t.isSymbolObject=O,t.isBoxedPrimitive=function(e){return C(e)||T(e)||P(e)||R(e)||O(e)},t.isAnyArrayBuffer=function(e){return"undefined"!=typeof Uint8Array&&(A(e)||I(e))},["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(e){Object.defineProperty(t,e,{enumerable:!1,value:function(){throw Error(e+" is not supported in userland")}})})},61043:e=>{"use strict";e.exports=Function.prototype.apply},61285:(e,t,r)=>{"use strict";r.d(t,{B:()=>l});var n,i=r(12115),s=r(52712),o=(n||(n=r.t(i,2)))[" useId ".trim().toString()]||(()=>void 0),a=0;function l(e){let[t,r]=i.useState(o());return(0,s.N)(()=>{e||r(e=>e??String(a++))},[e]),e||(t?`radix-${t}`:"")}},61925:e=>{"use strict";e.exports=SyntaxError},62030:e=>{"use strict";var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch(e){t=!1}e.exports=t},62806:(e,t,r)=>{var n="/",i=r(49509);!function(){var t={782:function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},646:function(e){"use strict";let t={};function r(e,r,n){function i(e,t,n){return"string"==typeof r?r:r(e,t,n)}n||(n=Error);class s extends n{constructor(e,t,r){super(i(e,t,r))}}s.prototype.name=n.name,s.prototype.code=e,t[e]=s}function n(e,t){if(!Array.isArray(e))return`of ${t} ${String(e)}`;{let r=e.length;return(e=e.map(e=>String(e)),r>2)?`one of ${t} ${e.slice(0,r-1).join(", ")}, or `+e[r-1]:2===r?`one of ${t} ${e[0]} or ${e[1]}`:`of ${t} ${e[0]}`}}function i(e,t,r){return e.substr(!r||r<0?0:+r,t.length)===t}function s(e,t,r){return(void 0===r||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}function o(e,t,r){return"number"!=typeof r&&(r=0),!(r+t.length>e.length)&&-1!==e.indexOf(t,r)}r("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),r("ERR_INVALID_ARG_TYPE",function(e,t,r){let a,l;if("string"==typeof t&&i(t,"not ")?(a="must not be",t=t.replace(/^not /,"")):a="must be",s(e," argument"))l=`The ${e} ${a} ${n(t,"type")}`;else{let r=o(e,".")?"property":"argument";l=`The "${e}" ${r} ${a} ${n(t,"type")}`}return l+`. Received type ${typeof r}`},TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.q=t},403:function(e,t,r){"use strict";var n=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=u;var s=r(709),o=r(337);r(782)(u,s);for(var a=n(o.prototype),l=0;l<a.length;l++){var c=a[l];u.prototype[c]||(u.prototype[c]=o.prototype[c])}function u(e){if(!(this instanceof u))return new u(e);s.call(this,e),o.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",h)))}function h(){this._writableState.ended||i.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(u.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(u.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},889:function(e,t,r){"use strict";e.exports=i;var n=r(170);function i(e){if(!(this instanceof i))return new i(e);n.call(this,e)}r(782)(i,n),i.prototype._transform=function(e,t,r){r(null,e)}},709:function(e,t,n){"use strict";e.exports=T,T.ReadableState=C,n(361).EventEmitter;var s,o,a,l,c,u=function(e,t){return e.listeners(t).length},h=n(678),d=n(300).Buffer,f=r.g.Uint8Array||function(){};function p(e){return d.from(e)}function g(e){return d.isBuffer(e)||e instanceof f}var m=n(837);o=m&&m.debuglog?m.debuglog("stream"):function(){};var y=n(379),b=n(25),w=n(776).getHighWaterMark,v=n(646).q,E=v.ERR_INVALID_ARG_TYPE,A=v.ERR_STREAM_PUSH_AFTER_EOF,x=v.ERR_METHOD_NOT_IMPLEMENTED,S=v.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;n(782)(T,h);var k=b.errorOrDestroy,_=["error","close","destroy","pause","resume"];function I(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}function C(e,t,r){s=s||n(403),e=e||{},"boolean"!=typeof r&&(r=t instanceof s),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=w(this,e,"readableHighWaterMark",r),this.buffer=new y,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(a||(a=n(704).s),this.decoder=new a(e.encoding),this.encoding=e.encoding)}function T(e){if(s=s||n(403),!(this instanceof T))return new T(e);var t=this instanceof s;this._readableState=new C(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),h.call(this)}function P(e,t,r,n,i){o("readableAddChunk",t);var s,a=e._readableState;if(null===t)a.reading=!1,M(e,a);else if(i||(s=O(a,t)),s)k(e,s);else if(a.objectMode||t&&t.length>0)if("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===d.prototype||(t=p(t)),n)a.endEmitted?k(e,new S):R(e,a,t,!0);else if(a.ended)k(e,new A);else{if(a.destroyed)return!1;a.reading=!1,a.decoder&&!r?(t=a.decoder.write(t),a.objectMode||0!==t.length?R(e,a,t,!1):U(e,a)):R(e,a,t,!1)}else n||(a.reading=!1,U(e,a));return!a.ended&&(a.length<a.highWaterMark||0===a.length)}function R(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&L(e)),U(e,t)}function O(e,t){var r;return g(t)||"string"==typeof t||void 0===t||e.objectMode||(r=new E("chunk",["string","Buffer","Uint8Array"],t)),r}Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),T.prototype.destroy=b.destroy,T.prototype._undestroy=b.undestroy,T.prototype._destroy=function(e,t){t(e)},T.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=d.from(e,t),t=""),r=!0),P(this,e,t,!1,r)},T.prototype.unshift=function(e){return P(this,e,null,!0,!1)},T.prototype.isPaused=function(){return!1===this._readableState.flowing},T.prototype.setEncoding=function(e){a||(a=n(704).s);var t=new a(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,i="";null!==r;)i+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var N=0x40000000;function D(e){return e>=N?e=N:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function B(e,t){if(e<=0||0===t.length&&t.ended)return 0;if(t.objectMode)return 1;if(e!=e)if(t.flowing&&t.length)return t.buffer.head.data.length;else return t.length;return(e>t.highWaterMark&&(t.highWaterMark=D(e)),e<=t.length)?e:t.ended?t.length:(t.needReadable=!0,0)}function M(e,t){if(o("onEofChunk"),!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?L(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,F(e)))}}function L(e){var t=e._readableState;o("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(o("emitReadable",t.flowing),t.emittedReadable=!0,i.nextTick(F,e))}function F(e){var t=e._readableState;o("emitReadable_",t.destroyed,t.length,t.ended),!t.destroyed&&(t.length||t.ended)&&(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,K(e)}function U(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(j,e,t))}function j(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(o("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function $(e){return function(){var t=e._readableState;o("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&u(e,"data")&&(t.flowing=!0,K(e))}}function H(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function q(e){o("readable nexttick read 0"),e.read(0)}function z(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(V,e,t))}function V(e,t){o("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),K(e),t.flowing&&!t.reading&&e.read(0)}function K(e){var t=e._readableState;for(o("flow",t.flowing);t.flowing&&null!==e.read(););}function G(e,t){var r;return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r)}function W(e){var t=e._readableState;o("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,i.nextTick(Q,t,e))}function Q(e,t){if(o("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function J(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return -1}T.prototype.read=function(e){o("read",e),e=parseInt(e,10);var t,r=this._readableState,n=e;if(0!==e&&(r.emittedReadable=!1),0===e&&r.needReadable&&((0!==r.highWaterMark?r.length>=r.highWaterMark:r.length>0)||r.ended))return o("read: emitReadable",r.length,r.ended),0===r.length&&r.ended?W(this):L(this),null;if(0===(e=B(e,r))&&r.ended)return 0===r.length&&W(this),null;var i=r.needReadable;return o("need readable",i),(0===r.length||r.length-e<r.highWaterMark)&&o("length less than watermark",i=!0),r.ended||r.reading?o("reading or ended",i=!1):i&&(o("do read"),r.reading=!0,r.sync=!0,0===r.length&&(r.needReadable=!0),this._read(r.highWaterMark),r.sync=!1,r.reading||(e=B(n,r))),null===(t=e>0?G(e,r):null)?(r.needReadable=r.length<=r.highWaterMark,e=0):(r.length-=e,r.awaitDrain=0),0===r.length&&(r.ended||(r.needReadable=!0),n!==e&&r.ended&&W(this)),null!==t&&this.emit("data",t),t},T.prototype._read=function(e){k(this,new x("_read()"))},T.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e)}n.pipesCount+=1,o("pipe count=%d opts=%j",n.pipesCount,t);var s=t&&!1===t.end||e===i.stdout||e===i.stderr?y:l;function a(e,t){o("onunpipe"),e===r&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,d())}function l(){o("onend"),e.end()}n.endEmitted?i.nextTick(s):r.once("end",s),e.on("unpipe",a);var c=$(r);e.on("drain",c);var h=!1;function d(){o("cleanup"),e.removeListener("close",g),e.removeListener("finish",m),e.removeListener("drain",c),e.removeListener("error",p),e.removeListener("unpipe",a),r.removeListener("end",l),r.removeListener("end",y),r.removeListener("data",f),h=!0,n.awaitDrain&&(!e._writableState||e._writableState.needDrain)&&c()}function f(t){o("ondata");var i=e.write(t);o("dest.write",i),!1===i&&((1===n.pipesCount&&n.pipes===e||n.pipesCount>1&&-1!==J(n.pipes,e))&&!h&&(o("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function p(t){o("onerror",t),y(),e.removeListener("error",p),0===u(e,"error")&&k(e,t)}function g(){e.removeListener("finish",m),y()}function m(){o("onfinish"),e.removeListener("close",g),y()}function y(){o("unpipe"),r.unpipe(e)}return r.on("data",f),I(e,"error",p),e.once("close",g),e.once("finish",m),e.emit("pipe",r),n.flowing||(o("pipe resume"),r.resume()),e},T.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<i;s++)n[s].emit("unpipe",this,{hasUnpiped:!1});return this}var o=J(t.pipes,e);return -1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},T.prototype.on=function(e,t){var r=h.prototype.on.call(this,e,t),n=this._readableState;return"data"===e?(n.readableListening=this.listenerCount("readable")>0,!1!==n.flowing&&this.resume()):"readable"!==e||n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,o("on readable",n.length,n.reading),n.length?L(this):n.reading||i.nextTick(q,this)),r},T.prototype.addListener=T.prototype.on,T.prototype.removeListener=function(e,t){var r=h.prototype.removeListener.call(this,e,t);return"readable"===e&&i.nextTick(H,this),r},T.prototype.removeAllListeners=function(e){var t=h.prototype.removeAllListeners.apply(this,arguments);return("readable"===e||void 0===e)&&i.nextTick(H,this),t},T.prototype.resume=function(){var e=this._readableState;return e.flowing||(o("resume"),e.flowing=!e.readableListening,z(this,e)),e.paused=!1,this},T.prototype.pause=function(){return o("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(o("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},T.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",function(){if(o("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){if(o("wrapped data"),r.decoder&&(i=r.decoder.write(i)),!r.objectMode||null!=i)(r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause()))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var s=0;s<_.length;s++)e.on(_[s],this.emit.bind(this,_[s]));return this._read=function(t){o("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(T.prototype[Symbol.asyncIterator]=function(){return void 0===l&&(l=n(871)),l(this)}),Object.defineProperty(T.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(T.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(T.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),T._fromList=G,Object.defineProperty(T.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(T.from=function(e,t){return void 0===c&&(c=n(727)),c(T,e,t)})},170:function(e,t,r){"use strict";e.exports=u;var n=r(646).q,i=n.ERR_METHOD_NOT_IMPLEMENTED,s=n.ERR_MULTIPLE_CALLBACK,o=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=n.ERR_TRANSFORM_WITH_LENGTH_0,l=r(403);function c(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new s);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);l.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",h)}function h(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush(function(t,r){d(e,t,r)})}function d(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new a;if(e._transformState.transforming)throw new o;return e.push(null)}r(782)(u,l),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,l.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,r){r(new i("_transform()"))},u.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){l.prototype._destroy.call(this,e,function(e){t(e)})}},337:function(e,t,n){"use strict";function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){V(t,e)}}e.exports=C,C.WritableState=I;var o,a,l={deprecate:n(769)},c=n(678),u=n(300).Buffer,h=r.g.Uint8Array||function(){};function d(e){return u.from(e)}function f(e){return u.isBuffer(e)||e instanceof h}var p=n(25),g=n(776).getHighWaterMark,m=n(646).q,y=m.ERR_INVALID_ARG_TYPE,b=m.ERR_METHOD_NOT_IMPLEMENTED,w=m.ERR_MULTIPLE_CALLBACK,v=m.ERR_STREAM_CANNOT_PIPE,E=m.ERR_STREAM_DESTROYED,A=m.ERR_STREAM_NULL_VALUES,x=m.ERR_STREAM_WRITE_AFTER_END,S=m.ERR_UNKNOWN_ENCODING,k=p.errorOrDestroy;function _(){}function I(e,t,r){o=o||n(403),e=e||{},"boolean"!=typeof r&&(r=t instanceof o),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=g(this,e,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var i=!1===e.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){M(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function C(e){var t=this instanceof(o=o||n(403));if(!t&&!a.call(C,this))return new C(e);this._writableState=new I(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),c.call(this)}function T(e,t){var r=new x;k(e,r),i.nextTick(t,r)}function P(e,t,r,n){var s;return null===r?s=new A:"string"==typeof r||t.objectMode||(s=new y("chunk",["string","Buffer"],r)),!s||(k(e,s),i.nextTick(n,s),!1)}function R(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=u.from(t,r)),t}function O(e,t,r,n,i,s){if(!r){var o=R(t,n,i);n!==o&&(r=!0,i="buffer",n=o)}var a=t.objectMode?1:n.length;t.length+=a;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:s,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else N(e,t,!1,a,n,i,s);return l}function N(e,t,r,n,i,s,o){t.writelen=n,t.writecb=o,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new E("write")):r?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function D(e,t,r,n,s){--t.pendingcb,r?(i.nextTick(s,n),i.nextTick(q,e,t),e._writableState.errorEmitted=!0,k(e,n)):(s(n),e._writableState.errorEmitted=!0,k(e,n),q(e,t))}function B(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function M(e,t){var r=e._writableState,n=r.sync,s=r.writecb;if("function"!=typeof s)throw new w;if(B(r),t)D(e,r,n,t,s);else{var o=j(r)||e.destroyed;o||r.corked||r.bufferProcessing||!r.bufferedRequest||U(e,r),n?i.nextTick(L,e,r,o,s):L(e,r,o,s)}}function L(e,t,r,n){r||F(e,t),t.pendingcb--,n(),q(e,t)}function F(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function U(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=Array(t.bufferedRequestCount),i=t.corkedRequestsFree;i.entry=r;for(var o=0,a=!0;r;)n[o]=r,r.isBuf||(a=!1),r=r.next,o+=1;n.allBuffers=a,N(e,t,!0,t.length,n,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;r;){var l=r.chunk,c=r.encoding,u=r.callback,h=t.objectMode?1:l.length;if(N(e,t,!1,h,l,c,u),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function j(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function $(e,t){e._final(function(r){t.pendingcb--,r&&k(e,r),t.prefinished=!0,e.emit("prefinish"),q(e,t)})}function H(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,i.nextTick($,e,t)))}function q(e,t){var r=j(t);if(r&&(H(e,t),0===t.pendingcb)&&(t.finished=!0,e.emit("finish"),t.autoDestroy)){var n=e._readableState;(!n||n.autoDestroy&&n.endEmitted)&&e.destroy()}return r}function z(e,t,r){t.ending=!0,q(e,t),r&&(t.finished?i.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function V(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree.next=e}n(782)(C,c),I.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(I.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(a=Function.prototype[Symbol.hasInstance],Object.defineProperty(C,Symbol.hasInstance,{value:function(e){return!!a.call(this,e)||this===C&&e&&e._writableState instanceof I}})):a=function(e){return e instanceof this},C.prototype.pipe=function(){k(this,new v)},C.prototype.write=function(e,t,r){var n=this._writableState,i=!1,s=!n.objectMode&&f(e);return s&&!u.isBuffer(e)&&(e=d(e)),"function"==typeof t&&(r=t,t=null),s?t="buffer":t||(t=n.defaultEncoding),"function"!=typeof r&&(r=_),n.ending?T(this,r):(s||P(this,n,e,r))&&(n.pendingcb++,i=O(this,n,s,e,t,r)),i},C.prototype.cork=function(){this._writableState.corked++},C.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||U(this,e))},C.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new S(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(C.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(C.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),C.prototype._write=function(e,t,r){r(new b("_write()"))},C.prototype._writev=null,C.prototype.end=function(e,t,r){var n=this._writableState;return"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||z(this,n,r),this},Object.defineProperty(C.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(C.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),C.prototype.destroy=p.destroy,C.prototype._undestroy=p.undestroy,C.prototype._destroy=function(e,t){t(e)}},871:function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s,o=r(698),a=Symbol("lastResolve"),l=Symbol("lastReject"),c=Symbol("error"),u=Symbol("ended"),h=Symbol("lastPromise"),d=Symbol("handlePromise"),f=Symbol("stream");function p(e,t){return{value:e,done:t}}function g(e){var t=e[a];if(null!==t){var r=e[f].read();null!==r&&(e[h]=null,e[a]=null,e[l]=null,t(p(r,!1)))}}function m(e){i.nextTick(g,e)}function y(e,t){return function(r,n){e.then(function(){if(t[u])return void r(p(void 0,!0));t[d](r,n)},n)}}var b=Object.getPrototypeOf(function(){}),w=Object.setPrototypeOf((n(s={get stream(){return this[f]},next:function(){var e,t=this,r=this[c];if(null!==r)return Promise.reject(r);if(this[u])return Promise.resolve(p(void 0,!0));if(this[f].destroyed)return new Promise(function(e,r){i.nextTick(function(){t[c]?r(t[c]):e(p(void 0,!0))})});var n=this[h];if(n)e=new Promise(y(n,this));else{var s=this[f].read();if(null!==s)return Promise.resolve(p(s,!1));e=new Promise(this[d])}return this[h]=e,e}},Symbol.asyncIterator,function(){return this}),n(s,"return",function(){var e=this;return new Promise(function(t,r){e[f].destroy(null,function(e){if(e)return void r(e);t(p(void 0,!0))})})}),s),b);e.exports=function(e){var t,r=Object.create(w,(n(t={},f,{value:e,writable:!0}),n(t,a,{value:null,writable:!0}),n(t,l,{value:null,writable:!0}),n(t,c,{value:null,writable:!0}),n(t,u,{value:e._readableState.endEmitted,writable:!0}),n(t,d,{value:function(e,t){var n=r[f].read();n?(r[h]=null,r[a]=null,r[l]=null,e(p(n,!1))):(r[a]=e,r[l]=t)},writable:!0}),t));return r[h]=null,o(e,function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[l];null!==t&&(r[h]=null,r[a]=null,r[l]=null,t(e)),r[c]=e;return}var n=r[a];null!==n&&(r[h]=null,r[a]=null,r[l]=null,n(p(void 0,!0))),r[u]=!0}),e.on("readable",m.bind(null,r)),r}},379:function(e,t,r){"use strict";function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach(function(t){s(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}var c=r(300).Buffer,u=r(837).inspect,h=u&&u.custom||"inspect";function d(e,t,r){c.prototype.copy.call(e,t,r)}e.exports=function(){function e(){o(this,e),this.head=null,this.tail=null,this.length=0}return l(e,[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return c.alloc(0);for(var t=c.allocUnsafe(e>>>0),r=this.head,n=0;r;)d(r.data,t,n),n+=r.data.length,r=r.next;return t}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,s=e>i.length?i.length:e;if(s===i.length?n+=i:n+=i.slice(0,e),0==(e-=s)){s===i.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(s));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=c.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var i=r.data,s=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,s),0==(e-=s)){s===i.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=i.slice(s));break}++n}return this.length-=n,t}},{key:h,value:function(e,t){return u(this,i({},t,{depth:0,customInspect:!1}))}}]),e}()},25:function(e){"use strict";function t(e,t){n(e,t),r(e)}function r(e){(!e._writableState||e._writableState.emitClose)&&(!e._readableState||e._readableState.emitClose)&&e.emit("close")}function n(e,t){e.emit("error",t)}e.exports={destroy:function(e,s){var o=this,a=this._readableState&&this._readableState.destroyed,l=this._writableState&&this._writableState.destroyed;return a||l?s?s(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,i.nextTick(n,this,e)):i.nextTick(n,this,e)):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!s&&e?o._writableState?o._writableState.errorEmitted?i.nextTick(r,o):(o._writableState.errorEmitted=!0,i.nextTick(t,o,e)):i.nextTick(t,o,e):s?(i.nextTick(r,o),s(e)):i.nextTick(r,o)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}},698:function(e,t,r){"use strict";var n=r(646).q.ERR_STREAM_PREMATURE_CLOSE;function i(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}function s(){}function o(e){return e.setHeader&&"function"==typeof e.abort}function a(e,t,r){if("function"==typeof t)return a(e,null,t);t||(t={}),r=i(r||s);var l=t.readable||!1!==t.readable&&e.readable,c=t.writable||!1!==t.writable&&e.writable,u=function(){e.writable||d()},h=e._writableState&&e._writableState.finished,d=function(){c=!1,h=!0,l||r.call(e)},f=e._readableState&&e._readableState.endEmitted,p=function(){l=!1,f=!0,c||r.call(e)},g=function(t){r.call(e,t)},m=function(){var t;return l&&!f?(e._readableState&&e._readableState.ended||(t=new n),r.call(e,t)):c&&!h?(e._writableState&&e._writableState.ended||(t=new n),r.call(e,t)):void 0},y=function(){e.req.on("finish",d)};return o(e)?(e.on("complete",d),e.on("abort",m),e.req?y():e.on("request",y)):c&&!e._writableState&&(e.on("end",u),e.on("close",u)),e.on("end",p),e.on("finish",d),!1!==t.error&&e.on("error",g),e.on("close",m),function(){e.removeListener("complete",d),e.removeListener("abort",m),e.removeListener("request",y),e.req&&e.req.removeListener("finish",d),e.removeListener("end",u),e.removeListener("close",u),e.removeListener("finish",d),e.removeListener("end",p),e.removeListener("error",g),e.removeListener("close",m)}}e.exports=a},727:function(e,t,r){"use strict";function n(e,t,r,n,i,s,o){try{var a=e[s](o),l=a.value}catch(e){r(e);return}a.done?t(l):Promise.resolve(l).then(n,i)}function i(e){return function(){var t=this,r=arguments;return new Promise(function(i,s){var o=e.apply(t,r);function a(e){n(o,i,s,a,l,"next",e)}function l(e){n(o,i,s,a,l,"throw",e)}a(void 0)})}}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach(function(t){a(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var l=r(646).q.ERR_INVALID_ARG_TYPE;e.exports=function(e,t,r){if(t&&"function"==typeof t.next)n=t;else if(t&&t[Symbol.asyncIterator])n=t[Symbol.asyncIterator]();else if(t&&t[Symbol.iterator])n=t[Symbol.iterator]();else throw new l("iterable",["Iterable"],t);var n,s=new e(o({objectMode:!0},r)),a=!1;function c(){return u.apply(this,arguments)}function u(){return(u=i(function*(){try{var e=yield n.next(),t=e.value;e.done?s.push(null):s.push((yield t))?c():a=!1}catch(e){s.destroy(e)}})).apply(this,arguments)}return s._read=function(){a||(a=!0,c())},s}},442:function(e,t,r){"use strict";function n(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}var i,s=r(646).q,o=s.ERR_MISSING_ARGS,a=s.ERR_STREAM_DESTROYED;function l(e){if(e)throw e}function c(e){return e.setHeader&&"function"==typeof e.abort}function u(e,t,s,o){o=n(o);var l=!1;e.on("close",function(){l=!0}),void 0===i&&(i=r(698)),i(e,{readable:t,writable:s},function(e){if(e)return o(e);l=!0,o()});var u=!1;return function(t){if(!l&&!u){if(u=!0,c(e))return e.abort();if("function"==typeof e.destroy)return e.destroy();o(t||new a("pipe"))}}}function h(e){e()}function d(e,t){return e.pipe(t)}function f(e){return e.length&&"function"==typeof e[e.length-1]?e.pop():l}e.exports=function(){for(var e,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=f(r);if(Array.isArray(r[0])&&(r=r[0]),r.length<2)throw new o("streams");var s=r.map(function(t,n){var o=n<r.length-1;return u(t,o,n>0,function(t){e||(e=t),t&&s.forEach(h),o||(s.forEach(h),i(e))})});return r.reduce(d)}},776:function(e,t,r){"use strict";var n=r(646).q.ERR_INVALID_OPT_VALUE;function i(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}e.exports={getHighWaterMark:function(e,t,r,s){var o=i(t,s,r);if(null!=o){if(!(isFinite(o)&&Math.floor(o)===o)||o<0)throw new n(s?r:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}},678:function(e,t,r){e.exports=r(781)},55:function(e,t,r){var n=r(300),i=n.Buffer;function s(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(s(n,t),t.Buffer=o),o.prototype=Object.create(i.prototype),s(i,o),o.from=function(e,t,r){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return n.SlowBuffer(e)}},173:function(e,t,r){e.exports=i;var n=r(361).EventEmitter;function i(){n.call(this)}r(782)(i,n),i.Readable=r(709),i.Writable=r(337),i.Duplex=r(403),i.Transform=r(170),i.PassThrough=r(889),i.finished=r(698),i.pipeline=r(442),i.Stream=i,i.prototype.pipe=function(e,t){var r=this;function i(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function s(){r.readable&&r.resume&&r.resume()}r.on("data",i),e.on("drain",s),e._isStdio||t&&!1===t.end||(r.on("end",a),r.on("close",l));var o=!1;function a(){o||(o=!0,e.end())}function l(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(u(),0===n.listenerCount(this,"error"))throw e}function u(){r.removeListener("data",i),e.removeListener("drain",s),r.removeListener("end",a),r.removeListener("close",l),r.removeListener("error",c),e.removeListener("error",c),r.removeListener("end",u),r.removeListener("close",u),e.removeListener("close",u)}return r.on("error",c),e.on("error",c),r.on("end",u),r.on("close",u),e.on("close",u),e.emit("pipe",r),e}},704:function(e,t,r){"use strict";var n=r(55).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(e){var t;if(!e)return"utf8";for(;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function o(e){var t=s(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw Error("Unknown encoding: "+e);return t||e}function a(e){var t;switch(this.encoding=o(e),this.encoding){case"utf16le":this.text=p,this.end=g,t=4;break;case"utf8":this.fillLast=h,t=4;break;case"base64":this.text=m,this.end=y,t=3;break;default:this.write=b,this.end=w;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function l(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function c(e,t,r){var n=t.length-1;if(n<r)return 0;var i=l(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||-2===i?0:(i=l(t[n]))>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||-2===i?0:(i=l(t[n]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}function u(e,t,r){if((192&t[0])!=128)return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if((192&t[1])!=128)return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&(192&t[2])!=128)return e.lastNeed=2,""}}function h(e){var t=this.lastTotal-this.lastNeed,r=u(this,e,t);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):void(e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length)}function d(e,t){var r=c(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)}function f(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t}function p(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function g(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function m(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function y(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function b(e){return e.toString(this.encoding)}function w(e){return e&&e.length?this.write(e):""}t.s=a,a.prototype.write=function(e){var t,r;if(0===e.length)return"";if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},a.prototype.end=f,a.prototype.text=d,a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},769:function(e){function t(e){try{if(!r.g.localStorage)return!1}catch(e){return!1}var t=r.g.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function e(e,r){if(t("noDeprecation"))return e;var n=!1;return function(){if(!n){if(t("throwDeprecation"))throw Error(r);t("traceDeprecation")?console.trace(r):console.warn(r),n=!0}return e.apply(this,arguments)}}},300:function(e){"use strict";e.exports=r(44134)},361:function(e){"use strict";e.exports=r(40662)},781:function(e){"use strict";e.exports=r(40662).EventEmitter},837:function(e){"use strict";e.exports=r(1504)}},s={};function o(e){var r=s[e];if(void 0!==r)return r.exports;var n=s[e]={exports:{}},i=!0;try{t[e](n,n.exports,o),i=!1}finally{i&&delete s[e]}return n.exports}o.ab=n+"/",e.exports=o(173)}()},62897:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var n=r(31133),i=r(10258);class s{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=(0,n.A)(),this.haveNext=(0,n.A)()}[Symbol.asyncIterator](){return this}async next(){if(null==this.nextResult&&await this.haveNext.promise,null==this.nextResult)throw Error("HaveNext promise resolved but nextResult was undefined");let e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=(0,n.A)(),e}async throw(e){return this.ended=!0,this.error=e,null!=e&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){let e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){null!=e?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(null!=e&&this.ended)throw this.error??Error("Cannot push value onto an ended pushable");for(;null!=this.nextResult;)await this.readNext.promise;null!=e?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=(0,n.A)(),await (0,i.W)(this.readNext.promise,t?.signal,t)}}function o(){return new s}function a(e){return null!=e[Symbol.asyncIterator]}async function l(e,t,r){try{await Promise.all(e.map(async e=>{for await(let n of e)await t.push(n,{signal:r}),r.throwIfAborted()})),await t.end(void 0,{signal:r})}catch(e){await t.end(e,{signal:r}).catch(()=>{})}}async function*c(e){let t=new AbortController,r=o();l(e,r,t.signal).catch(()=>{});try{yield*r}finally{t.abort()}}function*u(e){for(let t of e)yield*t}let h=function(...e){let t=[];for(let r of e)a(r)||t.push(r);return t.length===e.length?u(t):c(e)}},62954:(e,t,r)=>{"use strict";r.d(t,{Ny:()=>a});var n=r(31133);class i{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||(e-1&e)!=0)throw Error("Max size for a FixedFIFO should be a power of two");this.buffer=Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class s{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new i(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new i(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}class o extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function a(e={}){return l(e=>{let t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}},e)}function l(e,t){let r,i,a,l=(t=t??{}).onEnd,c=new s,u=(0,n.A)(),h=e=>null!=i?i(e):(c.push(e),r),d=e=>(c=new s,null!=i)?i({error:e}):(c.push({error:e}),r),f=e=>{if(a)return r;if(t?.objectMode!==!0&&e?.byteLength==null)throw Error("objectMode was not true but tried to push non-Uint8Array value");return h({done:!1,value:e})},p=e=>a?r:(a=!0,null!=e?d(e):h({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{if(!c.isEmpty())return e(c);if(a)return{done:!0};return await new Promise((t,n)=>{i=s=>{i=null,c.push(s);try{t(e(c))}catch(e){n(e)}return r}})}finally{c.isEmpty()&&queueMicrotask(()=>{u.resolve(),u=(0,n.A)()})}},return:()=>(c=new s,p(),{done:!0}),throw:e=>(p(e),{done:!0}),push:f,end:p,get readableLength(){return c.size},onEmpty:async e=>{let t,r,n=e?.signal;if(n?.throwIfAborted(),!c.isEmpty()){null!=n&&(t=new Promise((e,t)=>{r=()=>{t(new o)},n.addEventListener("abort",r)}));try{await Promise.race([u.promise,t])}finally{null!=r&&null!=n&&n?.removeEventListener("abort",r)}}}},null==l)return r;let g=r;return r={[Symbol.asyncIterator](){return this},next:()=>g.next(),throw:e=>(g.throw(e),null!=l&&(l(e),l=void 0),{done:!0}),return:()=>(g.return(),null!=l&&(l(),l=void 0),{done:!0}),push:f,end:e=>(g.end(e),null!=l&&(l(e),l=void 0),r),get readableLength(){return g.readableLength},onEmpty:e=>g.onEmpty(e)}}},63547:(e,t,r)=>{"use strict";let{AbstractKeyIterator:n,AbstractValueIterator:i}=r(39070),s=Symbol("iterator"),o=Symbol("callback"),a=Symbol("handleOne"),l=Symbol("handleMany");class c extends n{constructor(e,t){super(e,t),this[s]=e.iterator({...t,keys:!0,values:!1}),this[a]=this[a].bind(this),this[l]=this[l].bind(this)}}class u extends i{constructor(e,t){super(e,t),this[s]=e.iterator({...t,keys:!1,values:!0}),this[a]=this[a].bind(this),this[l]=this[l].bind(this)}}for(let e of[c,u]){let t=e===c,r=t?e=>e[0]:e=>e[1];e.prototype._next=function(e){this[o]=e,this[s].next(this[a])},e.prototype[a]=function(e,r,n){let i=this[o];e?i(e):i(null,t?r:n)},e.prototype._nextv=function(e,t,r){this[o]=r,this[s].nextv(e,t,this[l])},e.prototype._all=function(e,t){this[o]=t,this[s].all(e,this[l])},e.prototype[l]=function(e,t){let n=this[o];e?n(e):n(null,t.map(r))},e.prototype._seek=function(e,t){this[s].seek(e,t)},e.prototype._close=function(e){this[s].close(e)}}t.DefaultKeyIterator=c,t.DefaultValueIterator=u},63674:e=>{"use strict";e.exports=TypeError},64196:(e,t,r)=>{"use strict";let n=r(7800),{Buffer:i}=r(44134)||{},{AbstractSublevelIterator:s,AbstractSublevelKeyIterator:o,AbstractSublevelValueIterator:a}=r(74181),l=Symbol("prefix"),c=Symbol("upperBound"),u=Symbol("prefixRange"),h=Symbol("parent"),d=Symbol("unfix"),f=new TextEncoder,p={separator:"!"};e.exports=function({AbstractLevel:e}){class t extends e{static defaults(e){if("string"==typeof e)throw new n("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(e&&e.open)throw new n("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return null==e?p:e.separator?e:{...e,separator:"!"}}constructor(e,r,i){let{separator:s,manifest:o,...a}=t.defaults(i);r=w(r,s);let u=s.charCodeAt(0)+1,p=e[h]||e;if(!f.encode(r).every(e=>e>u&&e<127))throw new n(`Prefix must use bytes > ${u} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(g(p,o),a);let m=(e.prefix||"")+s+r+s,v=m.slice(0,-1)+String.fromCharCode(u);this[h]=p,this[l]=new y(m),this[c]=new y(v),this[d]=new b,this.nextTick=p.nextTick}prefixKey(e,t){if("utf8"===t)return this[l].utf8+e;if(0===e.byteLength)return this[l][t];if("view"===t){let t=this[l].view,r=new Uint8Array(t.byteLength+e.byteLength);return r.set(t,0),r.set(e,t.byteLength),r}{let t=this[l].buffer;return i.concat([t,e],t.byteLength+e.byteLength)}}[u](e,t){void 0!==e.gte?e.gte=this.prefixKey(e.gte,t):void 0!==e.gt?e.gt=this.prefixKey(e.gt,t):e.gte=this[l][t],void 0!==e.lte?e.lte=this.prefixKey(e.lte,t):void 0!==e.lt?e.lt=this.prefixKey(e.lt,t):e.lte=this[c][t]}get prefix(){return this[l].utf8}get db(){return this[h]}_open(e,t){this[h].open({passive:!0},t)}_put(e,t,r,n){this[h].put(e,t,r,n)}_get(e,t,r){this[h].get(e,t,r)}_getMany(e,t,r){this[h].getMany(e,t,r)}_del(e,t,r){this[h].del(e,t,r)}_batch(e,t,r){this[h].batch(e,t,r)}_clear(e,t){this[u](e,e.keyEncoding),this[h].clear(e,t)}_iterator(e){this[u](e,e.keyEncoding);let t=this[h].iterator(e),r=this[d].get(this[l].utf8.length,e.keyEncoding);return new s(this,e,t,r)}_keys(e){this[u](e,e.keyEncoding);let t=this[h].keys(e),r=this[d].get(this[l].utf8.length,e.keyEncoding);return new o(this,e,t,r)}_values(e){this[u](e,e.keyEncoding);let t=this[h].values(e);return new a(this,e,t)}}return{AbstractSublevel:t}};let g=function(e,t){return{...e.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...t,encodings:{utf8:m(e,"utf8"),buffer:m(e,"buffer"),view:m(e,"view")}}},m=function(e,t){return!!e.supports.encodings[t]&&e.keyEncoding(t).name===t};class y{constructor(e){this.utf8=e,this.view=f.encode(e),this.buffer=i?i.from(this.view.buffer,0,this.view.byteLength):{}}}class b{constructor(){this.cache=new Map}get(e,t){let r=this.cache.get(t);return void 0===r&&(r="view"===t?(function(e,t){return t.subarray(e)}).bind(null,e):(function(e,t){return t.slice(e)}).bind(null,e),this.cache.set(t,r)),r}}let w=function(e,t){let r=0,n=e.length;for(;r<n&&e[r]===t;)r++;for(;n>r&&e[n-1]===t;)n--;return e.slice(r,n)}},65639:(e,t,r)=>{"use strict";r.d(t,{H:()=>i});var n=r(87704);function i({name:e,code:t,encode:r}){return new s(e,t,r)}class s{name;code;encode;constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?n.create(this.code,t):t.then(e=>n.create(this.code,e))}throw Error("Unknown type, must be binary type")}}},68250:(e,t,r)=>{"use strict";r.d(t,{fD:()=>d.f,bk:()=>f.b});var n=r(86620);let i="/repo/flatfs/shard/",s="SHARDING";class o{param;name;_padding;constructor(e){this.param=e,this.name="base",this._padding=""}fun(e){return"implement me"}toString(){return`${i}v1/${this.name}/${this.param}`}}class a extends o{constructor(e){super(e),this._padding="".padStart(e,"_"),this.name="prefix"}fun(e){return(e+this._padding).slice(0,this.param)}}class l extends o{constructor(e){super(e),this._padding="".padStart(e,"_"),this.name="suffix"}fun(e){let t=this._padding+e;return t.slice(t.length-this.param)}}class c extends o{constructor(e){super(e),this._padding="".padStart(e+1,"_"),this.name="next-to-last"}fun(e){let t=this._padding+e,r=t.length-this.param-1;return t.slice(r,r+this.param)}}function u(e){if(0===(e=e.trim()).length)throw Error("empty shard string");if(!e.startsWith(i))throw Error(`invalid or no path prefix: ${e}`);let t=e.slice(i.length).split("/"),r=t[0];if("v1"!==r)throw Error(`expect 'v1' version, got '${r}'`);let n=t[1];if(null==t[2]||""===t[2])throw Error("missing param");let s=parseInt(t[2],10);switch(n){case"prefix":return new a(s);case"suffix":return new l(s);case"next-to-last":return new c(s);default:throw Error(`unkown sharding function: ${n}`)}}let h=async(e,t)=>{let r=new n.U(e).child(new n.U(s)),i="function"==typeof t.getRaw?t.getRaw.bind(t):t.get.bind(t),o=await i(r);return u(new TextDecoder().decode(o??"").trim())};var d=r(54954),f=r(3972),p=r(7786),g=r(45346);class m extends d.f{child;transform;constructor(e,t){super(),this.child=e,this.transform=t}async put(e,t,r){return await this.child.put(this.transform.convert(e),t,r),e}async get(e,t){return this.child.get(this.transform.convert(e),t)}async has(e,t){return this.child.has(this.transform.convert(e),t)}async delete(e,t){await this.child.delete(this.transform.convert(e),t)}async *putMany(e,t={}){let r=this.transform,n=this.child;yield*(0,g.F)(e,async function*(e){yield*(0,p.A)(e,({key:e,value:t})=>({key:r.convert(e),value:t}))},async function*(e){yield*n.putMany(e,t)},async function*(e){yield*(0,p.A)(e,e=>r.invert(e))})}async *getMany(e,t={}){let r=this.transform,n=this.child;yield*(0,g.F)(e,async function*(e){yield*(0,p.A)(e,e=>r.convert(e))},async function*(e){yield*n.getMany(e,t)},async function*(e){yield*(0,p.A)(e,({key:e,value:t})=>({key:r.invert(e),value:t}))})}async *deleteMany(e,t={}){let r=this.transform,n=this.child;yield*(0,g.F)(e,async function*(e){yield*(0,p.A)(e,e=>r.convert(e))},async function*(e){yield*n.deleteMany(e,t)},async function*(e){yield*(0,p.A)(e,e=>r.invert(e))})}batch(){let e=this.child.batch();return{put:(t,r)=>{e.put(this.transform.convert(t),r)},delete:t=>{e.delete(this.transform.convert(t))},commit:async t=>{await e.commit(t)}}}query(e,t){let r={...e};r.filters=(r.filters??[]).map(e=>({key:t,value:r})=>e({key:this.transform.convert(t),value:r}));let{prefix:n}=e;return null!=n&&"/"!==n&&(delete r.prefix,r.filters.push(({key:e})=>this.transform.invert(e).toString().startsWith(n))),null!=r.orders&&(r.orders=r.orders.map(e=>(t,r)=>e({key:this.transform.invert(t.key),value:t.value},{key:this.transform.invert(r.key),value:r.value}))),(0,p.A)(this.child.query(r,t),({key:e,value:t})=>({key:this.transform.invert(e),value:t}))}queryKeys(e,t){let r={...e};r.filters=(r.filters??[]).map(e=>t=>e(this.transform.convert(t)));let{prefix:n}=e;return null!=n&&"/"!==n&&(delete r.prefix,r.filters.push(e=>this.transform.invert(e).toString().startsWith(n))),null!=r.orders&&(r.orders=r.orders.map(e=>(t,r)=>e(this.transform.invert(t),this.transform.invert(r)))),(0,p.A)(this.child.queryKeys(r,t),e=>this.transform.invert(e))}}var y=r(31987),b=r(98897);let w=new y.U(s);class v extends d.f{child;shard;constructor(e,t){super(),this.child=new m(e,{convert:this._convertKey.bind(this),invert:this._invertKey.bind(this)}),this.shard=t}async open(){this.shard=await v.create(this.child,this.shard)}_convertKey(e){let t=e.toString();return t===w.toString()?e:new y.U(this.shard.fun(t)).child(e)}_invertKey(e){return e.toString()===w.toString()?e:y.U.withNamespaces(e.list().slice(1))}static async create(e,t){if(!await e.has(w)){if(null==t)throw new b.c0("Shard is required when datastore doesn't have a shard key already");await e.put(w,new TextEncoder().encode(t.toString()+"\n"))}null==t&&(t=await h("/",e));let r=await h("/",e),n=r.toString(),i=t.toString();if(n!==i)throw Error(`specified fun ${i} does not match repo shard fun ${n}`);return r}async put(e,t,r){return await this.child.put(e,t,r),e}async get(e,t){return this.child.get(e,t)}async has(e,t){return this.child.has(e,t)}async delete(e,t){await this.child.delete(e,t)}async *putMany(e,t={}){yield*this.child.putMany(e,t)}async *getMany(e,t={}){yield*this.child.getMany(e,t)}async *deleteMany(e,t={}){yield*this.child.deleteMany(e,t)}batch(){return this.child.batch()}query(e,t){let r=({key:e})=>e.toString()!==w.toString(),n={...e,filters:[r].concat(e.filters??[])};return this.child.query(n,t)}queryKeys(e,t){let r=e=>e.toString()!==w.toString(),n={...e,filters:[r].concat(e.filters??[])};return this.child.queryKeys(n,t)}}r(76520),r(62897),r(76154),r(91295),d.f;var E=r(3204);r(24802),r(62954),(0,E.vF)("datastore:core:tiered"),d.f},68852:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t||"[object Symbol]"!==Object.prototype.toString.call(t)||"[object Symbol]"!==Object.prototype.toString.call(r))return!1;var n=42;for(var i in e[t]=n,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var s=Object.getOwnPropertySymbols(e);if(1!==s.length||s[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(o.value!==n||!0!==o.enumerable)return!1}return!0}},69503:(e,t,r)=>{"use strict";let n=r(7800),i=new Set(["buffer","view","utf8"]);class s{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,"function"!=typeof this.encode)throw TypeError("The 'encode' property must be a function");if("function"!=typeof this.decode)throw TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),"string"!=typeof this.name||""===this.name)throw TypeError("The 'name' property must be a string");if("string"!=typeof this.format||!i.has(this.format))throw TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new n(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new n(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new n(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}}t.Encoding=s},69600:(e,t,r)=>{"use strict";r.d(t,{Fo:()=>P,br:()=>T.br});var n={};r.r(n),r.d(n,{base10:()=>u});var i={};r.r(i),r.d(i,{base16:()=>h,base16upper:()=>d});var s={};r.r(s),r.d(s,{base2:()=>f});var o={};r.r(o),r.d(o,{base256emoji:()=>w});var a={};r.r(a),r.d(a,{base8:()=>S});var l={};r.r(l),r.d(l,{identity:()=>_});var c=r(52215);let u=(0,c._Q)({prefix:"9",name:"base10",alphabet:"0123456789"}),h=(0,c.yE)({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),d=(0,c.yE)({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),f=(0,c.yE)({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),p=Array.from("\uD83D\uDE80\uD83E\uDE90\uD83D\uDEF0\uD83C\uDF0C\uD83C\uDF11\uD83C\uDF12\uD83C\uDF13\uD83C\uDF14\uD83C\uDF15\uD83C\uDF16\uD83C\uDF17\uD83C\uDF18\uD83C\uDF0D\uD83C\uDF0F\uD83C\uDF0E\uD83D\uDC09\uD83D\uDCBB\uD83D\uDDA5\uD83D\uDCBE\uD83D\uDCBF\uD83D\uDE02\uD83D\uDE0D\uD83E\uDD23\uD83D\uDE0A\uD83D\uDE4F\uD83D\uDC95\uD83D\uDE2D\uD83D\uDE18\uD83D\uDC4D\uD83D\uDE05\uD83D\uDC4F\uD83D\uDE01\uD83D\uDD25\uD83E\uDD70\uD83D\uDC94\uD83D\uDC96\uD83D\uDC99\uD83D\uDE22\uD83E\uDD14\uD83D\uDE06\uD83D\uDE44\uD83D\uDCAA\uD83D\uDE09\uD83D\uDC4C\uD83E\uDD17\uD83D\uDC9C\uD83D\uDE14\uD83D\uDE0E\uD83D\uDE07\uD83C\uDF39\uD83E\uDD26\uD83C\uDF89\uD83D\uDC9E\uD83E\uDD37\uD83D\uDE31\uD83D\uDE0C\uD83C\uDF38\uD83D\uDE4C\uD83D\uDE0B\uD83D\uDC97\uD83D\uDC9A\uD83D\uDE0F\uD83D\uDC9B\uD83D\uDE42\uD83D\uDC93\uD83E\uDD29\uD83D\uDE04\uD83D\uDE00\uD83D\uDDA4\uD83D\uDE03\uD83D\uDCAF\uD83D\uDE48\uD83D\uDC47\uD83C\uDFB6\uD83D\uDE12\uD83E\uDD2D\uD83D\uDE1C\uD83D\uDC8B\uD83D\uDC40\uD83D\uDE2A\uD83D\uDE11\uD83D\uDCA5\uD83D\uDE4B\uD83D\uDE1E\uD83D\uDE29\uD83D\uDE21\uD83E\uDD2A\uD83D\uDC4A\uD83E\uDD73\uD83D\uDE25\uD83E\uDD24\uD83D\uDC49\uD83D\uDC83\uD83D\uDE33\uD83D\uDE1A\uD83D\uDE1D\uD83D\uDE34\uD83C\uDF1F\uD83D\uDE2C\uD83D\uDE43\uD83C\uDF40\uD83C\uDF37\uD83D\uDE3B\uD83D\uDE13\uD83E\uDD7A\uD83C\uDF08\uD83D\uDE08\uD83E\uDD18\uD83D\uDCA6\uD83D\uDE23\uD83C\uDFC3\uD83D\uDC90\uD83C\uDF8A\uD83D\uDC98\uD83D\uDE20\uD83D\uDE15\uD83C\uDF3A\uD83C\uDF82\uD83C\uDF3B\uD83D\uDE10\uD83D\uDD95\uD83D\uDC9D\uD83D\uDE4A\uD83D\uDE39\uD83D\uDDE3\uD83D\uDCAB\uD83D\uDC80\uD83D\uDC51\uD83C\uDFB5\uD83E\uDD1E\uD83D\uDE1B\uD83D\uDD34\uD83D\uDE24\uD83C\uDF3C\uD83D\uDE2B\uD83E\uDD19\uD83C\uDFC6\uD83E\uDD2B\uD83D\uDC48\uD83D\uDE2E\uD83D\uDE46\uD83C\uDF7B\uD83C\uDF43\uD83D\uDC36\uD83D\uDC81\uD83D\uDE32\uD83C\uDF3F\uD83E\uDDE1\uD83C\uDF81\uD83C\uDF1E\uD83C\uDF88\uD83D\uDC4B\uD83D\uDE30\uD83E\uDD28\uD83D\uDE36\uD83E\uDD1D\uD83D\uDEB6\uD83D\uDCB0\uD83C\uDF53\uD83D\uDCA2\uD83E\uDD1F\uD83D\uDE41\uD83D\uDEA8\uD83D\uDCA8\uD83E\uDD2C\uD83C\uDF80\uD83C\uDF7A\uD83E\uDD13\uD83D\uDE19\uD83D\uDC9F\uD83C\uDF31\uD83D\uDE16\uD83D\uDC76\uD83E\uDD74\uD83D\uDC8E\uD83D\uDCB8\uD83D\uDE28\uD83C\uDF1A\uD83E\uDD8B\uD83D\uDE37\uD83D\uDD7A\uD83D\uDE45\uD83D\uDE1F\uD83D\uDE35\uD83D\uDC4E\uD83E\uDD32\uD83E\uDD20\uD83E\uDD27\uD83D\uDCCC\uD83D\uDD35\uD83D\uDC85\uD83E\uDDD0\uD83D\uDC3E\uD83C\uDF52\uD83D\uDE17\uD83E\uDD11\uD83C\uDF0A\uD83E\uDD2F\uD83D\uDC37\uD83D\uDCA7\uD83D\uDE2F\uD83D\uDC86\uD83D\uDC46\uD83C\uDFA4\uD83D\uDE47\uD83C\uDF51\uD83C\uDF34\uD83D\uDCA3\uD83D\uDC38\uD83D\uDC8C\uD83D\uDCCD\uD83E\uDD40\uD83E\uDD22\uD83D\uDC45\uD83D\uDCA1\uD83D\uDCA9\uD83D\uDC50\uD83D\uDCF8\uD83D\uDC7B\uD83E\uDD10\uD83E\uDD2E\uD83C\uDFBC\uD83E\uDD75\uD83D\uDEA9\uD83C\uDF4E\uD83C\uDF4A\uD83D\uDC7C\uD83D\uDC8D\uD83D\uDCE3\uD83E\uDD42"),g=p.reduce((e,t,r)=>(e[r]=t,e),[]),m=p.reduce((e,t,r)=>{let n=t.codePointAt(0);if(null==n)throw Error(`Invalid character: ${t}`);return e[n]=r,e},[]);function y(e){return e.reduce((e,t)=>e+=g[t],"")}function b(e){let t=[];for(let r of e){let e=r.codePointAt(0);if(null==e)throw Error(`Invalid character: ${r}`);let n=m[e];if(null==n)throw Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}let w=(0,c.HT)({prefix:"\uD83D\uDE80",name:"base256emoji",encode:y,decode:b});var v=r(43716),E=r(41472),A=r(7796),x=r(53647);let S=(0,c.yE)({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var k=r(70834);let _=(0,c.HT)({prefix:"\0",name:"identity",encode:e=>(0,k.toString)(e),decode:e=>(0,k.fromString)(e)});r(47951),r(34269);var I=r(30946),C=r(97141),T=r(16121);let P={...l,...s,...a,...n,...i,...v,...E,...A,...x,...o};({...C,...I})},69685:(e,t,r)=>{"use strict";r.d(t,{TO:()=>d});var n=r(43716),i=r(41472),s=r(7796),o=r(70834),a=r(87704),l=r(41394);function c(e,t){let{bytes:r,version:i}=e;return 0===i?p(r,h(e),t??s.base58btc.encoder):g(r,h(e),t??n.base32.encoder)}let u=new WeakMap;function h(e){let t=u.get(e);if(null==t){let t=new Map;return u.set(e,t),t}return t}class d{code;version;multihash;bytes;"/";constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==m)throw Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==y)throw Error("Cannot convert non sha2-256 multihash CID to CIDv0");return d.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,r=a.create(e,t);return d.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return d.equals(this,e)}static equals(e,t){let r=t;return null!=r&&e.code===r.code&&e.version===r.version&&a.equals(e.multihash,r.multihash)}toString(e){return c(this,e)}toJSON(){return{"/":c(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;let t=e;if(t instanceof d)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){let{version:e,code:r,multihash:n,bytes:i}=t;return new d(e,r,n,i??b(e,r,n.bytes))}if(!0!==t[w])return null;{let{version:e,multihash:r,code:n}=t,i=a.decode(r);return d.create(e,n,i)}}static create(e,t,r){if("number"!=typeof t)throw Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw Error("Invalid digest");switch(e){case 0:if(t===m)return new d(e,t,r,r.bytes);throw Error(`Version 0 CID must use dag-pb (code: ${m}) block encoding`);case 1:{let n=b(e,t,r.bytes);return new d(e,t,r,n)}default:throw Error("Invalid version")}}static createV0(e){return d.create(0,m,e)}static createV1(e,t){return d.create(1,e,t)}static decode(e){let[t,r]=d.decodeFirst(e);if(0!==r.length)throw Error("Incorrect length");return t}static decodeFirst(e){let t=d.inspectBytes(e),r=t.size-t.multihashSize,n=(0,o.coerce)(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw Error("Incorrect length");let i=n.subarray(t.multihashSize-t.digestSize),s=new a.Digest(t.multihashCode,t.digestSize,i,n);return[0===t.version?d.createV0(s):d.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0,r=()=>{let[r,n]=l.D4(e.subarray(t));return t+=n,r},n=r(),i=m;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw RangeError(`Invalid CID version ${n}`);let s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){let[r,n]=f(e,t),i=d.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return h(i).set(r,e),i}}function f(e,t){switch(e[0]){case"Q":{let r=t??s.base58btc;return[s.base58btc.prefix,r.decode(`${s.base58btc.prefix}${e}`)]}case s.base58btc.prefix:{let r=t??s.base58btc;return[s.base58btc.prefix,r.decode(e)]}case n.base32.prefix:{let r=t??n.base32;return[n.base32.prefix,r.decode(e)]}case i.base36.prefix:{let r=t??i.base36;return[i.base36.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}function p(e,t,r){let{prefix:n}=r;if(n!==s.base58btc.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let i=t.get(n);if(null!=i)return i;{let i=r.encode(e).slice(1);return t.set(n,i),i}}function g(e,t,r){let{prefix:n}=r,i=t.get(n);if(null!=i)return i;{let i=r.encode(e);return t.set(n,i),i}}let m=112,y=18;function b(e,t,r){let n=l.OY(e),i=n+l.OY(t),s=new Uint8Array(i+r.byteLength);return l.s_(e,s,0),l.s_(t,s,n),s.set(r,i),s}let w=Symbol.for("@ipld/js-cid/CID")},69811:(e,t,r)=>{"use strict";let n=r(7800),i=Object.prototype.hasOwnProperty,s=new Set(["lt","lte","gt","gte"]);e.exports=function(e,t){let r={};for(let o in e)if(i.call(e,o)&&"keyEncoding"!==o&&"valueEncoding"!==o){if("start"===o||"end"===o)throw new n(`The legacy range option '${o}' has been removed`,{code:"LEVEL_LEGACY"});if("encoding"===o)throw new n("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});s.has(o)?r[o]=t.encode(e[o]):r[o]=e[o]}return r.reverse=!!r.reverse,r.limit=Number.isInteger(r.limit)&&r.limit>=0?r.limit:-1,r}},70508:(e,t,r)=>{"use strict";var n,i=r(2821),s=r(2902),o=r(12764),a=r(31467),l=r(24747),c=r(61925),u=r(63674),h=r(97968),d=r(82083),f=r(5729),p=r(51517),g=r(54251),m=r(34817),y=r(83623),b=r(87700),w=Function,v=function(e){try{return w('"use strict"; return ('+e+").constructor;")()}catch(e){}},E=r(81954),A=r(62030),x=function(){throw new u},S=E?function(){try{return arguments.callee,x}catch(e){try{return E(arguments,"callee").get}catch(e){return x}}}():x,k=r(56406)(),_=r(21589),I=r(71033),C=r(45329),T=r(61043),P=r(60261),R={},O="undefined"!=typeof Uint8Array&&_?_(Uint8Array):n,N={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":k&&_?_([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":R,"%AsyncGenerator%":R,"%AsyncGeneratorFunction%":R,"%AsyncIteratorPrototype%":R,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":s,"%eval%":eval,"%EvalError%":o,"%Float16Array%":"undefined"==typeof Float16Array?n:Float16Array,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":w,"%GeneratorFunction%":R,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":k&&_?_(_([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&k&&_?_(new Map()[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":i,"%Object.getOwnPropertyDescriptor%":E,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":a,"%ReferenceError%":l,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&k&&_?_(new Set()[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":k&&_?_(""[Symbol.iterator]()):n,"%Symbol%":k?Symbol:n,"%SyntaxError%":c,"%ThrowTypeError%":S,"%TypedArray%":O,"%TypeError%":u,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":h,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet,"%Function.prototype.call%":P,"%Function.prototype.apply%":T,"%Object.defineProperty%":A,"%Object.getPrototypeOf%":I,"%Math.abs%":d,"%Math.floor%":f,"%Math.max%":p,"%Math.min%":g,"%Math.pow%":m,"%Math.round%":y,"%Math.sign%":b,"%Reflect.getPrototypeOf%":C};if(_)try{null.error}catch(e){var D=_(_(e));N["%Error.prototype%"]=D}var B=function e(t){var r;if("%AsyncFunction%"===t)r=v("async function () {}");else if("%GeneratorFunction%"===t)r=v("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=v("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&_&&(r=_(i.prototype))}return N[t]=r,r},M={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},L=r(52430),F=r(41444),U=L.call(P,Array.prototype.concat),j=L.call(T,Array.prototype.splice),$=L.call(P,String.prototype.replace),H=L.call(P,String.prototype.slice),q=L.call(P,RegExp.prototype.exec),z=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,V=/\\(\\)?/g,K=function(e){var t=H(e,0,1),r=H(e,-1);if("%"===t&&"%"!==r)throw new c("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new c("invalid intrinsic syntax, expected opening `%`");var n=[];return $(e,z,function(e,t,r,i){n[n.length]=r?$(i,V,"$1"):t||e}),n},G=function(e,t){var r,n=e;if(F(M,n)&&(n="%"+(r=M[n])[0]+"%"),F(N,n)){var i=N[n];if(i===R&&(i=B(n)),void 0===i&&!t)throw new u("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:i}}throw new c("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new u("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new u('"allowMissing" argument must be a boolean');if(null===q(/^%?[^%]*%?$/,e))throw new c("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=K(e),n=r.length>0?r[0]:"",i=G("%"+n+"%",t),s=i.name,o=i.value,a=!1,l=i.alias;l&&(n=l[0],j(r,U([0,1],l)));for(var h=1,d=!0;h<r.length;h+=1){var f=r[h],p=H(f,0,1),g=H(f,-1);if(('"'===p||"'"===p||"`"===p||'"'===g||"'"===g||"`"===g)&&p!==g)throw new c("property names with quotes must have matching quotes");if("constructor"!==f&&d||(a=!0),n+="."+f,F(N,s="%"+n+"%"))o=N[s];else if(null!=o){if(!(f in o)){if(!t)throw new u("base intrinsic for "+e+" exists, but the property is not available.");return}if(E&&h+1>=r.length){var m=E(o,f);o=(d=!!m)&&"get"in m&&!("originalValue"in m.get)?m.get:o[f]}else d=F(o,f),o=o[f];d&&!a&&(N[s]=o)}}return o}},70834:(e,t,r)=>{"use strict";r.r(t),r.d(t,{coerce:()=>a,empty:()=>n,equals:()=>o,fromHex:()=>s,fromString:()=>c,isBinary:()=>l,toHex:()=>i,toString:()=>u});let n=new Uint8Array(0);function i(e){return e.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),"")}function s(e){let t=e.match(/../g);return null!=t?new Uint8Array(t.map(e=>parseInt(e,16))):n}function o(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function a(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw Error("Unknown type, must be binary type")}function l(e){return e instanceof ArrayBuffer||ArrayBuffer.isView(e)}function c(e){return new TextEncoder().encode(e)}function u(e){return new TextDecoder().decode(e)}},71033:(e,t,r)=>{"use strict";e.exports=r(2821).getPrototypeOf||null},71094:(e,t,r)=>{"use strict";let{supports:n}=r(38541),{Transcoder:i}=r(12338),{EventEmitter:s}=r(40662),{fromCallback:o}=r(82813),a=r(7800),{AbstractIterator:l}=r(39070),{DefaultKeyIterator:c,DefaultValueIterator:u}=r(63547),{DeferredIterator:h,DeferredKeyIterator:d,DeferredValueIterator:f}=r(92425),{DefaultChainedBatch:p}=r(95948),{getCallback:g,getOptions:m}=r(33534),y=r(69811),b=Symbol("promise"),w=Symbol("landed"),v=Symbol("resources"),E=Symbol("closeResources"),A=Symbol("operations"),x=Symbol("undefer"),S=Symbol("deferOpen"),k=Symbol("options"),_=Symbol("status"),I=Symbol("defaultOptions"),C=Symbol("transcoder"),T=Symbol("keyEncoding"),P=Symbol("valueEncoding"),R=()=>{};class O extends s{constructor(e,t){if(super(),"object"!=typeof e||null===e)throw TypeError("The first argument 'manifest' must be an object");let{keyEncoding:r,valueEncoding:s,passive:o,...a}=t=m(t);for(let t of(this[v]=new Set,this[A]=[],this[S]=!0,this[k]=a,this[_]="opening",this.supports=n(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:!1!==e.snapshots,permanence:!1!==e.permanence,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[C]=new i(B(this)),this[T]=this[C].encoding(r||"utf8"),this[P]=this[C].encoding(s||"utf8"),this[C].encodings()))this.supports.encodings[t.commonName]||(this.supports.encodings[t.commonName]=!0);this[I]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[T].commonName,valueEncoding:this[P].commonName}),key:Object.freeze({keyEncoding:this[T].commonName})},this.nextTick(()=>{this[S]&&this.open({passive:!1},R)})}get status(){return this[_]}keyEncoding(e){return this[C].encoding(null!=e?e:this[T])}valueEncoding(e){return this[C].encoding(null!=e?e:this[P])}open(e,t){t=o(t=g(e,t),b),(e={...this[k],...m(e)}).createIfMissing=!1!==e.createIfMissing,e.errorIfExists=!!e.errorIfExists;let r=e=>{"closing"===this[_]||"opening"===this[_]?this.once(w,e?()=>r(e):r):"open"!==this[_]?t(new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:e})):t()};return e.passive?"opening"===this[_]?this.once(w,r):this.nextTick(r):"closed"===this[_]||this[S]?(this[S]=!1,this[_]="opening",this.emit("opening"),this._open(e,e=>{if(e){this[_]="closed",this[E](()=>{this.emit(w),r(e)}),this[x]();return}this[_]="open",this[x](),this.emit(w),"open"===this[_]&&this.emit("open"),"open"===this[_]&&this.emit("ready"),r()})):"open"===this[_]?this.nextTick(r):this.once(w,()=>this.open(e,t)),t[b]}_open(e,t){this.nextTick(t)}close(e){e=o(e,b);let t=r=>{"opening"===this[_]||"closing"===this[_]?this.once(w,r?t(r):t):"closed"!==this[_]?e(new a("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:r})):e()};if("open"===this[_]){this[_]="closing",this.emit("closing");let e=e=>{this[_]="open",this[x](),this.emit(w),t(e)};this[E](()=>{this._close(r=>{if(r)return e(r);this[_]="closed",this[x](),this.emit(w),"closed"===this[_]&&this.emit("closed"),t()})})}else"closed"===this[_]?this.nextTick(t):this.once(w,()=>this.close(e));return e[b]}[E](e){if(0===this[v].size)return this.nextTick(e);let t=this[v].size,r=!0,n=()=>{0==--t&&(r?this.nextTick(e):e())};for(let e of this[v])e.close(n);r=!1,this[v].clear()}_close(e){this.nextTick(e)}get(e,t,r){if(r=o(r=g(t,r),b),t=m(t,this[I].entry),"opening"===this[_])return this.defer(()=>this.get(e,t,r)),r[b];if(D(this,r))return r[b];let n=this._checkKey(e);if(n)return this.nextTick(r,n),r[b];let i=this.keyEncoding(t.keyEncoding),s=this.valueEncoding(t.valueEncoding),l=i.format,c=s.format;return(t.keyEncoding!==l||t.valueEncoding!==c)&&(t=Object.assign({},t,{keyEncoding:l,valueEncoding:c})),this._get(this.prefixKey(i.encode(e),l),t,(e,t)=>{if(e)return("LEVEL_NOT_FOUND"===e.code||e.notFound||/NotFound/i.test(e))&&(e.code||(e.code="LEVEL_NOT_FOUND"),e.notFound||(e.notFound=!0),e.status||(e.status=404)),r(e);try{t=s.decode(t)}catch(e){return r(new a("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:e}))}r(null,t)}),r[b]}_get(e,t,r){this.nextTick(r,Error("NotFound"))}getMany(e,t,r){if(r=o(r=g(t,r),b),t=m(t,this[I].entry),"opening"===this[_])return this.defer(()=>this.getMany(e,t,r)),r[b];if(D(this,r))return r[b];if(!Array.isArray(e))return this.nextTick(r,TypeError("The first argument 'keys' must be an array")),r[b];if(0===e.length)return this.nextTick(r,null,[]),r[b];let n=this.keyEncoding(t.keyEncoding),i=this.valueEncoding(t.valueEncoding),s=n.format,l=i.format;(t.keyEncoding!==s||t.valueEncoding!==l)&&(t=Object.assign({},t,{keyEncoding:s,valueEncoding:l}));let c=Array(e.length);for(let t=0;t<e.length;t++){let i=e[t],o=this._checkKey(i);if(o)return this.nextTick(r,o),r[b];c[t]=this.prefixKey(n.encode(i),s)}return this._getMany(c,t,(e,t)=>{if(e)return r(e);try{for(let e=0;e<t.length;e++)void 0!==t[e]&&(t[e]=i.decode(t[e]))}catch(e){return r(new a(`Could not decode one or more of ${t.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:e}))}r(null,t)}),r[b]}_getMany(e,t,r){this.nextTick(r,null,Array(e.length).fill(void 0))}put(e,t,r,n){if(n=o(n=g(r,n),b),r=m(r,this[I].entry),"opening"===this[_])return this.defer(()=>this.put(e,t,r,n)),n[b];if(D(this,n))return n[b];let i=this._checkKey(e)||this._checkValue(t);if(i)return this.nextTick(n,i),n[b];let s=this.keyEncoding(r.keyEncoding),a=this.valueEncoding(r.valueEncoding),l=s.format,c=a.format;(r.keyEncoding!==l||r.valueEncoding!==c)&&(r=Object.assign({},r,{keyEncoding:l,valueEncoding:c}));let u=this.prefixKey(s.encode(e),l),h=a.encode(t);return this._put(u,h,r,r=>{if(r)return n(r);this.emit("put",e,t),n()}),n[b]}_put(e,t,r,n){this.nextTick(n)}del(e,t,r){if(r=o(r=g(t,r),b),t=m(t,this[I].key),"opening"===this[_])return this.defer(()=>this.del(e,t,r)),r[b];if(D(this,r))return r[b];let n=this._checkKey(e);if(n)return this.nextTick(r,n),r[b];let i=this.keyEncoding(t.keyEncoding),s=i.format;return t.keyEncoding!==s&&(t=Object.assign({},t,{keyEncoding:s})),this._del(this.prefixKey(i.encode(e),s),t,t=>{if(t)return r(t);this.emit("del",e),r()}),r[b]}_del(e,t,r){this.nextTick(r)}batch(e,t,r){if(!arguments.length){if("opening"===this[_])return new p(this);if("open"!==this[_])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(r=o(r="function"==typeof e?e:g(t,r),b),t=m(t,this[I].empty),"opening"===this[_])return this.defer(()=>this.batch(e,t,r)),r[b];if(D(this,r))return r[b];if(!Array.isArray(e))return this.nextTick(r,TypeError("The first argument 'operations' must be an array")),r[b];if(0===e.length)return this.nextTick(r),r[b];let n=Array(e.length),{keyEncoding:i,valueEncoding:s,...l}=t;for(let t=0;t<e.length;t++){if("object"!=typeof e[t]||null===e[t])return this.nextTick(r,TypeError("A batch operation must be an object")),r[b];let o=Object.assign({},e[t]);if("put"!==o.type&&"del"!==o.type)return this.nextTick(r,TypeError("A batch operation must have a type property that is 'put' or 'del'")),r[b];let a=this._checkKey(o.key);if(a)return this.nextTick(r,a),r[b];let l=null!=o.sublevel?o.sublevel:this,c=l.keyEncoding(o.keyEncoding||i),u=c.format;if(o.key=l.prefixKey(c.encode(o.key),u),o.keyEncoding=u,"put"===o.type){let e=this._checkValue(o.value);if(e)return this.nextTick(r,e),r[b];let t=l.valueEncoding(o.valueEncoding||s);o.value=t.encode(o.value),o.valueEncoding=t.format}l!==this&&(o.sublevel=null),n[t]=o}return this._batch(n,l,t=>{if(t)return r(t);this.emit("batch",e),r()}),r[b]}_batch(e,t,r){this.nextTick(r)}sublevel(e,t){return this._sublevel(e,N.defaults(t))}_sublevel(e,t){return new N(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=o(t=g(e,t),b),e=m(e,this[I].empty),"opening"===this[_])return this.defer(()=>this.clear(e,t)),t[b];if(D(this,t))return t[b];let r=e,n=this.keyEncoding(e.keyEncoding);return(e=y(e,n)).keyEncoding=n.format,0===e.limit?this.nextTick(t):this._clear(e,e=>{if(e)return t(e);this.emit("clear",r),t()}),t[b]}_clear(e,t){this.nextTick(t)}iterator(e){let t=this.keyEncoding(e&&e.keyEncoding),r=this.valueEncoding(e&&e.valueEncoding);if((e=y(e,t)).keys=!1!==e.keys,e.values=!1!==e.values,e[l.keyEncoding]=t,e[l.valueEncoding]=r,e.keyEncoding=t.format,e.valueEncoding=r.format,"opening"===this[_])return new h(this,e);if("open"!==this[_])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new l(this,e)}keys(e){let t=this.keyEncoding(e&&e.keyEncoding),r=this.valueEncoding(e&&e.valueEncoding);if((e=y(e,t))[l.keyEncoding]=t,e[l.valueEncoding]=r,e.keyEncoding=t.format,e.valueEncoding=r.format,"opening"===this[_])return new d(this,e);if("open"!==this[_])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new c(this,e)}values(e){let t=this.keyEncoding(e&&e.keyEncoding),r=this.valueEncoding(e&&e.valueEncoding);if((e=y(e,t))[l.keyEncoding]=t,e[l.valueEncoding]=r,e.keyEncoding=t.format,e.valueEncoding=r.format,"opening"===this[_])return new f(this,e);if("open"!==this[_])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new u(this,e)}defer(e){if("function"!=typeof e)throw TypeError("The first argument must be a function");this[A].push(e)}[x](){if(0===this[A].length)return;let e=this[A];for(let t of(this[A]=[],e))t()}attachResource(e){if("object"!=typeof e||null===e||"function"!=typeof e.close)throw TypeError("The first argument must be a resource object");this[v].add(e)}detachResource(e){this[v].delete(e)}_chainedBatch(){return new p(this)}_checkKey(e){if(null==e)return new a("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(null==e)return new a("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}}O.prototype.nextTick=r(45077);let{AbstractSublevel:N}=r(64196)({AbstractLevel:O});t.AbstractLevel=O,t.AbstractSublevel=N;let D=function(e,t){return"open"!==e[_]&&(e.nextTick(t,new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0)},B=function(e){return Object.keys(e.supports.encodings).filter(t=>!!e.supports.encodings[t])}},71807:e=>{var t="/";!function(){"use strict";var r={114:function(e){function t(e){if("string"!=typeof e)throw TypeError("Path must be a string. Received "+JSON.stringify(e))}function r(e,t){for(var r,n="",i=0,s=-1,o=0,a=0;a<=e.length;++a){if(a<e.length)r=e.charCodeAt(a);else if(47===r)break;else r=47;if(47===r){if(s===a-1||1===o);else if(s!==a-1&&2===o){if(n.length<2||2!==i||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2)){if(n.length>2){var l=n.lastIndexOf("/");if(l!==n.length-1){-1===l?(n="",i=0):i=(n=n.slice(0,l)).length-1-n.lastIndexOf("/"),s=a,o=0;continue}}else if(2===n.length||1===n.length){n="",i=0,s=a,o=0;continue}}t&&(n.length>0?n+="/..":n="..",i=2)}else n.length>0?n+="/"+e.slice(s+1,a):n=e.slice(s+1,a),i=a-s-1;s=a,o=0}else 46===r&&-1!==o?++o:o=-1}return n}function n(e,t){var r=t.dir||t.root,n=t.base||(t.name||"")+(t.ext||"");return r?r===t.root?r+n:r+e+n:n}var i={resolve:function(){for(var e,n,i="",s=!1,o=arguments.length-1;o>=-1&&!s;o--)o>=0?n=arguments[o]:(void 0===e&&(e=""),n=e),t(n),0!==n.length&&(i=n+"/"+i,s=47===n.charCodeAt(0));if(i=r(i,!s),s)if(i.length>0)return"/"+i;else return"/";return i.length>0?i:"."},normalize:function(e){if(t(e),0===e.length)return".";var n=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return(0!==(e=r(e,!n)).length||n||(e="."),e.length>0&&i&&(e+="/"),n)?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0==arguments.length)return".";for(var e,r=0;r<arguments.length;++r){var n=arguments[r];t(n),n.length>0&&(void 0===e?e=n:e+="/"+n)}return void 0===e?".":i.normalize(e)},relative:function(e,r){if(t(e),t(r),e===r||(e=i.resolve(e))===(r=i.resolve(r)))return"";for(var n=1;n<e.length&&47===e.charCodeAt(n);++n);for(var s=e.length,o=s-n,a=1;a<r.length&&47===r.charCodeAt(a);++a);for(var l=r.length-a,c=o<l?o:l,u=-1,h=0;h<=c;++h){if(h===c){if(l>c){if(47===r.charCodeAt(a+h))return r.slice(a+h+1);else if(0===h)return r.slice(a+h)}else o>c&&(47===e.charCodeAt(n+h)?u=h:0===h&&(u=0));break}var d=e.charCodeAt(n+h);if(d!==r.charCodeAt(a+h))break;47===d&&(u=h)}var f="";for(h=n+u+1;h<=s;++h)(h===s||47===e.charCodeAt(h))&&(0===f.length?f+="..":f+="/..");return f.length>0?f+r.slice(a+u):(a+=u,47===r.charCodeAt(a)&&++a,r.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var r=e.charCodeAt(0),n=47===r,i=-1,s=!0,o=e.length-1;o>=1;--o)if(47===(r=e.charCodeAt(o))){if(!s){i=o;break}}else s=!1;return -1===i?n?"/":".":n&&1===i?"//":e.slice(0,i)},basename:function(e,r){if(void 0!==r&&"string"!=typeof r)throw TypeError('"ext" argument must be a string');t(e);var n,i=0,s=-1,o=!0;if(void 0!==r&&r.length>0&&r.length<=e.length){if(r.length===e.length&&r===e)return"";var a=r.length-1,l=-1;for(n=e.length-1;n>=0;--n){var c=e.charCodeAt(n);if(47===c){if(!o){i=n+1;break}}else -1===l&&(o=!1,l=n+1),a>=0&&(c===r.charCodeAt(a)?-1==--a&&(s=n):(a=-1,s=l))}return i===s?s=l:-1===s&&(s=e.length),e.slice(i,s)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!o){i=n+1;break}}else -1===s&&(o=!1,s=n+1);return -1===s?"":e.slice(i,s)},extname:function(e){t(e);for(var r=-1,n=0,i=-1,s=!0,o=0,a=e.length-1;a>=0;--a){var l=e.charCodeAt(a);if(47===l){if(!s){n=a+1;break}continue}-1===i&&(s=!1,i=a+1),46===l?-1===r?r=a:1!==o&&(o=1):-1!==r&&(o=-1)}return -1===r||-1===i||0===o||1===o&&r===i-1&&r===n+1?"":e.slice(r,i)},format:function(e){if(null===e||"object"!=typeof e)throw TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return n("/",e)},parse:function(e){t(e);var r,n={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return n;var i=e.charCodeAt(0),s=47===i;s?(n.root="/",r=1):r=0;for(var o=-1,a=0,l=-1,c=!0,u=e.length-1,h=0;u>=r;--u){if(47===(i=e.charCodeAt(u))){if(!c){a=u+1;break}continue}-1===l&&(c=!1,l=u+1),46===i?-1===o?o=u:1!==h&&(h=1):-1!==o&&(h=-1)}return -1===o||-1===l||0===h||1===h&&o===l-1&&o===a+1?-1!==l&&(0===a&&s?n.base=n.name=e.slice(1,l):n.base=n.name=e.slice(a,l)):(0===a&&s?(n.name=e.slice(1,o),n.base=e.slice(1,l)):(n.name=e.slice(a,o),n.base=e.slice(a,l)),n.ext=e.slice(o,l)),a>0?n.dir=e.slice(0,a-1):s&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};i.posix=i,e.exports=i}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}},o=!0;try{r[e](s,s.exports,i),o=!1}finally{o&&delete n[e]}return s.exports}i.ab=t+"/",e.exports=i(114)}()},73002:function(e,t){(function(){var e,r,n,i,s,o,a,l;l=function(e){return[(-0x1000000&e)>>>24,(0xff0000&e)>>>16,(65280&e)>>>8,255&e].join(".")},a=function(e){var t,n,i,s,o,a;for(t=[],i=s=0;s<=3&&0!==e.length;i=++s){if(i>0){if("."!==e[0])throw Error("Invalid IP");e=e.substring(1)}o=(a=r(e))[0],n=a[1],e=e.substring(n),t.push(o)}if(0!==e.length)throw Error("Invalid IP");switch(t.length){case 1:if(t[0]>0xffffffff)throw Error("Invalid IP");return t[0]>>>0;case 2:if(t[0]>255||t[1]>0xffffff)throw Error("Invalid IP");return(t[0]<<24|t[1])>>>0;case 3:if(t[0]>255||t[1]>255||t[2]>65535)throw Error("Invalid IP");return(t[0]<<24|t[1]<<16|t[2])>>>0;case 4:if(t[0]>255||t[1]>255||t[2]>255||t[3]>255)throw Error("Invalid IP");return(t[0]<<24|t[1]<<16|t[2]<<8|t[3])>>>0;default:throw Error("Invalid IP")}},i=(n=function(e){return e.charCodeAt(0)})("0"),o=n("a"),s=n("A"),r=function(e){var t,r,a,l,c;for(l=0,t=10,r="9",a=0,e.length>1&&"0"===e[a]&&("x"===e[a+1]||"X"===e[a+1]?(a+=2,t=16):"0"<=e[a+1]&&e[a+1]<="9"&&(a++,t=8,r="7")),c=a;a<e.length;){if("0"<=e[a]&&e[a]<=r)l=l*t+(n(e[a])-i)>>>0;else if(16===t)if("a"<=e[a]&&e[a]<="f")l=l*t+(10+n(e[a])-o)>>>0;else if("A"<=e[a]&&e[a]<="F")l=l*t+(10+n(e[a])-s)>>>0;else break;else break;if(l>0xffffffff)throw Error("too large");a++}if(a===c)throw Error("empty octet");return[l,a]},e=function(){function e(e,t){var r,n,i;if("string"!=typeof e)throw Error("Missing `net' parameter");if(t||(e=(i=e.split("/",2))[0],t=i[1]),t||(t=32),"string"==typeof t&&t.indexOf(".")>-1){try{this.maskLong=a(t)}catch(e){throw Error("Invalid mask: "+t)}for(r=n=32;n>=0;r=--n)if(this.maskLong===0xffffffff<<32-r>>>0){this.bitmask=r;break}}else if(t||0===t)this.bitmask=parseInt(t,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=0xffffffff<<32-this.bitmask>>>0);else throw Error("Invalid mask: empty");try{this.netLong=(a(e)&this.maskLong)>>>0}catch(t){throw Error("Invalid net address: "+e)}if(!(this.bitmask<=32))throw Error("Invalid mask for ip4: "+t);this.size=Math.pow(2,32-this.bitmask),this.base=l(this.netLong),this.mask=l(this.maskLong),this.hostmask=l(~this.maskLong),this.first=this.bitmask<=30?l(this.netLong+1):this.base,this.last=this.bitmask<=30?l(this.netLong+this.size-2):l(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?l(this.netLong+this.size-1):void 0}return e.prototype.contains=function(t){return("string"==typeof t&&(t.indexOf("/")>0||4!==t.split(".").length)&&(t=new e(t)),t instanceof e)?this.contains(t.base)&&this.contains(t.broadcast||t.last):(a(t)&this.maskLong)>>>0==(this.netLong&this.maskLong)>>>0},e.prototype.next=function(t){return null==t&&(t=1),new e(l(this.netLong+this.size*t),this.mask)},e.prototype.forEach=function(e){var t,r,n;for(n=a(this.first),r=a(this.last),t=0;n<=r;)e(l(n),n,t),t++,n++},e.prototype.toString=function(){return this.base+"/"+this.bitmask},e}(),t.ip2long=a,t.long2ip=l,t.Netmask=e}).call(this)},73737:function(e,t,r){"use strict";let n=r(6913),{hasOwnProperty:i}=Object.prototype,{propertyIsEnumerable:s}=Object,o=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0}),a=this,l={concatArrays:!1,ignoreUndefined:!1},c=e=>{let t=[];for(let r in e)i.call(e,r)&&t.push(r);if(Object.getOwnPropertySymbols)for(let r of Object.getOwnPropertySymbols(e))s.call(e,r)&&t.push(r);return t};function u(e){return Array.isArray(e)?h(e):n(e)?d(e):e}function h(e){let t=e.slice(0,0);return c(e).forEach(r=>{o(t,r,u(e[r]))}),t}function d(e){let t=null===Object.getPrototypeOf(e)?Object.create(null):{};return c(e).forEach(r=>{o(t,r,u(e[r]))}),t}let f=(e,t,r,n)=>(r.forEach(r=>{void 0===t[r]&&n.ignoreUndefined||(r in e&&e[r]!==Object.getPrototypeOf(e)?o(e,r,g(e[r],t[r],n)):o(e,r,u(t[r])))}),e),p=(e,t,r)=>{let n=e.slice(0,0),s=0;return[e,t].forEach(t=>{let a=[];for(let r=0;r<t.length;r++)i.call(t,r)&&(a.push(String(r)),t===e?o(n,s++,t[r]):o(n,s++,u(t[r])));n=f(n,t,c(t).filter(e=>!a.includes(e)),r)}),n};function g(e,t,r){return r.concatArrays&&Array.isArray(e)&&Array.isArray(t)?p(e,t,r):n(t)&&n(e)?f(e,t,c(t),r):u(t)}e.exports=function(...e){let t=g(u(l),this!==a&&this||{},l),r={_:{}};for(let i of e)if(void 0!==i){if(!n(i))throw TypeError("`"+i+"` is not an Option Object");r=g(r,{_:i},t)}return r._}},74181:(e,t,r)=>{"use strict";let{AbstractIterator:n,AbstractKeyIterator:i,AbstractValueIterator:s}=r(39070),o=Symbol("unfix"),a=Symbol("iterator"),l=Symbol("handleOne"),c=Symbol("handleMany"),u=Symbol("callback");class h extends n{constructor(e,t,r,n){super(e,t),this[a]=r,this[o]=n,this[l]=this[l].bind(this),this[c]=this[c].bind(this),this[u]=null}[l](e,t,r){let n=this[u];if(e)return n(e);void 0!==t&&(t=this[o](t)),n(e,t,r)}[c](e,t){let r=this[u];if(e)return r(e);for(let e of t){let t=e[0];void 0!==t&&(e[0]=this[o](t))}r(e,t)}}class d extends i{constructor(e,t,r,n){super(e,t),this[a]=r,this[o]=n,this[l]=this[l].bind(this),this[c]=this[c].bind(this),this[u]=null}[l](e,t){let r=this[u];if(e)return r(e);void 0!==t&&(t=this[o](t)),r(e,t)}[c](e,t){let r=this[u];if(e)return r(e);for(let e=0;e<t.length;e++){let r=t[e];void 0!==r&&(t[e]=this[o](r))}r(e,t)}}class f extends s{constructor(e,t,r){super(e,t),this[a]=r}}for(let e of[h,d])e.prototype._next=function(e){this[u]=e,this[a].next(this[l])},e.prototype._nextv=function(e,t,r){this[u]=r,this[a].nextv(e,t,this[c])},e.prototype._all=function(e,t){this[u]=t,this[a].all(e,this[c])};for(let e of[f])e.prototype._next=function(e){this[a].next(e)},e.prototype._nextv=function(e,t,r){this[a].nextv(e,t,r)},e.prototype._all=function(e,t){this[a].all(e,t)};for(let e of[h,d,f])e.prototype._seek=function(e,t){this[a].seek(e,t)},e.prototype._close=function(e){this[a].close(e)};t.AbstractSublevelIterator=h,t.AbstractSublevelKeyIterator=d,t.AbstractSublevelValueIterator=f},75799:e=>{"use strict";e.exports=function(e){let t=void 0!==e.gte?e.gte:void 0!==e.gt?e.gt:void 0,r=void 0!==e.lte?e.lte:void 0!==e.lt?e.lt:void 0,n=void 0===e.gte,i=void 0===e.lte;return void 0!==t&&void 0!==r?IDBKeyRange.bound(t,r,n,i):void 0!==t?IDBKeyRange.lowerBound(t,n):void 0!==r?IDBKeyRange.upperBound(r,i):null}},76154:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(4157);function i(e){return null!=e[Symbol.asyncIterator]}let s=function(e,t){return i(e)?async function*(){let r=await (0,n.A)(e);yield*r.sort(t)}():function*(){let r=(0,n.A)(e);yield*r.sort(t)}()}},76520:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(1707);function i(e){return null!=e[Symbol.asyncIterator]}let s=function(e,t){let r=0;if(i(e))return async function*(){for await(let n of e)await t(n,r++)&&(yield n)}();let s=(0,n.A)(e),{value:o,done:a}=s.next();if(!0===a)return function*(){}();let l=t(o,r++);if("function"==typeof l.then)return async function*(){for await(let e of(await l&&(yield o),s))await t(e,r++)&&(yield e)}();let c=t;return function*(){for(let e of(!0===l&&(yield o),s))c(e,r++)&&(yield e)}()}},77338:e=>{!function(){e.exports=m;var t=86400,r=3200,n=1168776,i=0x178302cc00,s=1009822464e5,o=864e13,a=0x100000000,l=1e6,c="000000000",u=Math.trunc||function(e){var t=e-e%1;return 0==t&&(e<0||0===e&&1/e!=1/0)?-0:t},h=m.prototype,d=(m.fromDate=function(e){return new m(+e)},m.fromInt64BE=E(0,1,2,3,0,4),m.fromInt64LE=E(3,2,1,0,4,0),m.fromString=function(e){var t,r=new m,e=(e+="").replace(/^\s*[+\-]?\d+/,function(e){var e=+e,t=1970+(e-1970)%400;return r.year=e-t,t}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(e,r,n){return r<0&&(n*=-1),t=6e4*(60*r+ +n),""}).replace(/\.\d+$/,function(e){return r.nano=+(e+c).substr(1,9),""}).split(/\D+/);if(1<e.length?e[1]--:e[1]=0,r.time=t=Date.UTC.apply(Date,e)-(t||0),isNaN(t))throw TypeError("Invalid Date");return y(r)},m.fromTimeT=function(e){return w(e,0)},h.year=0,h.time=0,h.nano=0,h.addNano=function(e){return this.nano+=+e||0,this},h.getNano=function(){var e=y(this);return(e.time%1e3*l+ +e.nano+1e9)%1e9},h.getTimeT=function(){var e=y(this),i=Math.floor(e.time/1e3),e=e.year;return e&&(i+=e*n*t/r),i},h.getYear=function(){return this.toDate().getUTCFullYear()+this.year},h.toDate=function(){return b(y(this).time)},h.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},h.toString=function(e){var t=this,r=t.toDate(),n={H:function(){return x(r.getUTCHours())},L:function(){return S(r.getUTCMilliseconds(),3)},M:function(){return x(r.getUTCMinutes())},N:function(){return S(t.getNano(),9)},S:function(){return x(r.getUTCSeconds())},Y:function(){var e=t.getYear();return 999999<e?"+"+e:9999<e?"+"+S(e,6):0<=e?S(e,4):-999999<=e?"-"+S(-e,6):e},a:function(){return p[r.getUTCDay()]},b:function(){return f[r.getUTCMonth()]},d:function(){return x(r.getUTCDate())},e:function(){var e;return(9<(e=r.getUTCDate())?"":" ")+(0|e)},m:function(){return x(r.getUTCMonth()+1)}};return function e(t){return t.replace(/%./g,function(t){var r=t[1],i=g[r],r=n[r];return i?e(i):r?r():t})}(e||d)},h.writeInt64BE=v(0,1,2,3,0,4),h.writeInt64LE=v(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],p=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g={"%":"%",F:"%Y-%m-%d",n:"\n",R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};function m(e,t,r){var n=this;if(!(n instanceof m))return new m(e,t,r);n.time=+e||0,n.nano=+t||0,n.year=+r||0,y(n)}function y(e){var t,n,i,a=e.year,c=e.time,h=e.nano,d=((h<0||l<=h)&&(h-=(n=Math.floor(h/l))*l,c+=n,n=1),a%r);return(c<-o||o<c||d)&&((t=u(c/s))&&(a+=t*r,c-=t*s),(i=b(c)).setUTCFullYear(d+i.getUTCFullYear()),i=(c=+i)+(t=u((a-=d)/r))*s,t&&-o<=i&&i<=o&&(a-=t*r,c=i),n=1),n&&(e.year=a,e.time=c,e.nano=h),e}function b(e){var t=new Date(0);return t.setTime(e),t}function w(e,t){e=+e||0;var n=u((t=(0|t)*a)/i)+u(e/i),t=t%i+e%i,e=u(t/i);return e&&(n+=e,t-=e*i),new m(1e3*t,0,n*r)}function v(e,i,s,o,l,c){return function(e,i){var s=y(this);A(e=e||Array(8),i|=0);var o=Math.floor(s.time/1e3),s=s.year*(n*t/r),d=u(s/a)+u(o/a),s=s%a+o%a,o=Math.floor(s/a);return o&&(d+=o,s-=o*a),h(e,i+l,d),h(e,i+c,s),e};function h(t,r,n){t[r+e]=n>>24&255,t[r+i]=n>>16&255,t[r+s]=n>>8&255,t[r+o]=255&n}}function E(e,t,r,n,i,s){return function(e,t){A(e,t|=0);var r=o(e,t+i);return w(o(e,t+s),r)};function o(i,s){return 0x1000000*i[s+e]+(i[s+t]<<16|i[s+r]<<8|i[s+n])}}function A(e,t){if(null==(e=e&&e.length))throw TypeError("Invalid Buffer");if(e<t+8)throw RangeError("Out of range")}function x(e){return(9<e?"":"0")+(0|e)}function S(e,t){return(c+(0|e)).substr(-t)}}()},77477:(e,t,r)=>{"use strict";r.d(t,{d:()=>i});var n=r(2629);function i(e,t="utf8"){let r=n.A[t];if(null==r)throw Error(`Unsupported encoding "${t}"`);return r.encoder.encode(e).substring(1)}},77481:(e,t,r)=>{"use strict";var n;n={value:!0};let i=r(94858);t.PP=i.EventIterator,n=function(e,t,r){return new i.EventIterator(({push:r})=>(this.addEventListener(e,r,t),()=>this.removeEventListener(e,r,t)),r)},n=i.EventIterator},77697:e=>{"use strict";let t=null;e.exports=function(){return null===t&&(t={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),t}},78229:module=>{var __dirname="/";!function(){var __webpack_modules__={950:function(__unused_webpack_module,exports){var indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0;r<e.length;r++)if(e[r]===t)return r;return -1},Object_keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var r in e)t.push(r);return t},forEach=function(e,t){if(e.forEach)return e.forEach(t);for(var r=0;r<e.length;r++)t(e[r],r,e)},defineProp=function(){try{return Object.defineProperty({},"_",{}),function(e,t,r){Object.defineProperty(e,t,{writable:!0,enumerable:!1,configurable:!0,value:r})}}catch(e){return function(e,t,r){e[t]=r}}}(),globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports.Script=function(e){if(!(this instanceof Script))return new Script(e);this.code=e};Script.prototype.runInContext=function(e){if(!(e instanceof Context))throw TypeError("needs a 'context' argument.");var t=document.createElement("iframe");t.style||(t.style={}),t.style.display="none",document.body.appendChild(t);var r=t.contentWindow,n=r.eval,i=r.execScript;!n&&i&&(i.call(r,"null"),n=r.eval),forEach(Object_keys(e),function(t){r[t]=e[t]}),forEach(globals,function(t){e[t]&&(r[t]=e[t])});var s=Object_keys(r),o=n.call(r,this.code);return forEach(Object_keys(r),function(t){(t in e||-1===indexOf(s,t))&&(e[t]=r[t])}),forEach(globals,function(t){t in e||defineProp(e,t,r[t])}),document.body.removeChild(t),o},Script.prototype.runInThisContext=function(){return eval(this.code)},Script.prototype.runInNewContext=function(e){var t=Script.createContext(e),r=this.runInContext(t);return e&&forEach(Object_keys(t),function(r){e[r]=t[r]}),r},forEach(Object_keys(Script.prototype),function(e){exports[e]=Script[e]=function(t){var r=Script(t);return r[e].apply(r,[].slice.call(arguments,1))}}),exports.isContext=function(e){return e instanceof Context},exports.createScript=function(e){return exports.Script(e)},exports.createContext=Script.createContext=function(e){var t=new Context;return"object"==typeof e&&forEach(Object_keys(e),function(r){t[r]=e[r]}),t}}};"undefined"!=typeof __nccwpck_require__&&(__nccwpck_require__.ab=__dirname+"/");var __nested_webpack_exports__={};__webpack_modules__[950](0,__nested_webpack_exports__),module.exports=__nested_webpack_exports__}()},79589:e=>{"use strict";e.exports=function(e,t,r,n,i){if(0===n.limit)return e.nextTick(i);let s=e.db.transaction([t],"readwrite"),o=s.objectStore(t),a=0;s.oncomplete=function(){i()},s.onabort=function(){i(s.error||Error("aborted by user"))};let l=o.openKeyCursor?"openKeyCursor":"openCursor",c=n.reverse?"prev":"next";o[l](r,c).onsuccess=function(e){let t=e.target.result;t&&(o.delete(t.key).onsuccess=function(){(n.limit<=0||++a<n.limit)&&t.continue()})}}},80228:(e,t,r)=>{var n=r(44134),i=n.Buffer;function s(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(s(n,t),t.Buffer=o),o.prototype=Object.create(i.prototype),s(i,o),o.from=function(e,t,r){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return n.SlowBuffer(e)}},80501:(e,t,r)=>{"use strict";let{AbstractLevel:n}=r(97233),i=r(7800),s=r(29485),{fromCallback:o}=r(82813),{Iterator:a}=r(18993),l=r(13623),c=r(79589),u=r(75799),h="level-js-",d=Symbol("idb"),f=Symbol("namePrefix"),p=Symbol("location"),g=Symbol("version"),m=Symbol("store"),y=Symbol("onComplete"),b=Symbol("promise");class w extends n{constructor(e,t,r){if("function"==typeof t||"function"==typeof r)throw new i("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});let{prefix:n,version:s,...o}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},o),"string"!=typeof e)throw Error("constructor requires a location string argument");this[p]=e,this[f]=null==n?h:n,this[g]=parseInt(s||1,10),this[d]=null}get location(){return this[p]}get namePrefix(){return this[f]}get version(){return this[g]}get db(){return this[d]}get type(){return"browser-level"}_open(e,t){let r=indexedDB.open(this[f]+this[p],this[g]);r.onerror=function(){t(r.error||Error("unknown error"))},r.onsuccess=()=>{this[d]=r.result,t()},r.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(this[p])||t.createObjectStore(this[p])}}[m](e){return this[d].transaction([this[p]],e).objectStore(this[p])}[y](e,t){let r=e.transaction;r.onabort=function(){t(r.error||Error("aborted by user"))},r.oncomplete=function(){t(null,e.result)}}_get(e,t,r){let n,s=this[m]("readonly");try{n=s.get(e)}catch(e){return this.nextTick(r,e)}this[y](n,function(e,t){return e?r(e):void 0===t?r(new i("Entry not found",{code:"LEVEL_NOT_FOUND"})):void r(null,l(t))})}_getMany(e,t,r){let n=this[m]("readonly");s(e.map(e=>t=>{let r;try{r=n.get(e)}catch(e){return t(e)}r.onsuccess=()=>{let e=r.result;t(null,void 0===e?e:l(e))},r.onerror=e=>{e.stopPropagation(),t(r.error)}}),16,r)}_del(e,t,r){let n,i=this[m]("readwrite");try{n=i.delete(e)}catch(e){return this.nextTick(r,e)}this[y](n,r)}_put(e,t,r,n){let i,s=this[m]("readwrite");try{i=s.put(t,e)}catch(e){return this.nextTick(n,e)}this[y](i,n)}_iterator(e){return new a(this,this[p],e)}_batch(e,t,r){let n,i=this[m]("readwrite"),s=i.transaction,o=0;function a(){let t,r=e[o++],l=r.key;try{t="del"===r.type?i.delete(l):i.put(r.value,l)}catch(e){n=e,s.abort();return}o<e.length?t.onsuccess=a:"function"==typeof s.commit&&s.commit()}s.onabort=function(){r(n||s.error||Error("aborted by user"))},s.oncomplete=function(){r()},a()}_clear(e,t){let r,n;try{r=u(e)}catch(e){return this.nextTick(t)}if(e.limit>=0)return c(this,this[p],r,e,t);try{let e=this[m]("readwrite");n=r?e.delete(r):e.clear()}catch(e){return this.nextTick(t,e)}this[y](n,t)}_close(e){this[d].close(),this.nextTick(e)}}w.destroy=function(e,t,r){"function"==typeof t&&(r=t,t=h),r=o(r,b);let n=indexedDB.deleteDatabase(t+e);return n.onsuccess=function(){r()},n.onerror=function(e){r(e)},r[b]},t.BrowserLevel=w},81954:(e,t,r)=>{"use strict";var n=r(13372);if(n)try{n([],"length")}catch(e){n=null}e.exports=n},82083:e=>{"use strict";e.exports=Math.abs},82661:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,n,s,o){if("function"!=typeof n)throw TypeError("The listener must be a function");var a=new i(n,s||e,o),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1)),a.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=Array(s);i<s;i++)o[i]=n[i].fn;return o},a.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,i,s,o){var a=r?r+e:e;if(!this._events[a])return!1;var l,c,u=this._events[a],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,i),!0;case 5:return u.fn.call(u.context,t,n,i,s),!0;case 6:return u.fn.call(u.context,t,n,i,s,o),!0}for(c=1,l=Array(h-1);c<h;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var d,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,n);break;case 4:u[c].fn.call(u[c].context,t,n,i);break;default:if(!l)for(d=1,l=Array(h-1);d<h;d++)l[d-1]=arguments[d];u[c].fn.apply(u[c].context,l)}}return!0},a.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,n,i){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||i&&!a.once||n&&a.context!==n||o(this,s);else{for(var l=0,c=[],u=a.length;l<u;l++)(a[l].fn!==t||i&&!a[l].once||n&&a[l].context!==n)&&c.push(a[l]);c.length?this._events[s]=1===c.length?c[0]:c:o(this,s)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a},82813:(e,t,r)=>{"use strict";var n=r(96341);t.fromCallback=function(e,t){if(void 0===e){var r=new Promise(function(t,r){e=function(e,n){e?r(e):t(n)}});e[void 0!==t?t:"promise"]=r}else if("function"!=typeof e)throw TypeError("Callback must be a function");return e},t.fromPromise=function(e,t){if(void 0===t)return e;e.then(function(e){n(()=>t(null,e))}).catch(function(e){n(()=>t(e))})}},83548:(e,t,r)=>{var n;!function(e){!function(t){var n="object"==typeof globalThis?globalThis:"object"==typeof r.g?r.g:"object"==typeof self?self:"object"==typeof this?this:l(),i=s(e);function s(e,t){return function(r,n){Object.defineProperty(e,r,{configurable:!0,writable:!0,value:n}),t&&t(r,n)}}function o(){try{return Function("return this;")()}catch(e){}}function a(){try{return(0,eval)("(function() { return this; })()")}catch(e){}}function l(){return o()||a()}void 0!==n.Reflect&&(i=s(n.Reflect,i)),t(i,n),void 0===n.Reflect&&(n.Reflect=e)}(function(e,t){var r=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,i=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",s=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a=({__proto__:[]})instanceof Array,l=!o&&!a,c={create:o?function(){return et(Object.create(null))}:a?function(){return et({__proto__:null})}:function(){return et({})},has:l?function(e,t){return r.call(e,t)}:function(e,t){return t in e},get:l?function(e,t){return r.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},u=Object.getPrototypeOf(Function),h="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:Y(),d="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:X(),f="function"==typeof WeakMap?WeakMap:ee(),p=n?Symbol.for("@reflect-metadata:registry"):void 0,g=W(),m=Q(g);function y(e,t){for(var r=e.length-1;r>=0;--r){var n=(0,e[r])(t);if(!I(n)&&!C(n)){if(!F(n))throw TypeError();t=n}}return t}function b(e,t,r,n){for(var i=e.length-1;i>=0;--i){var s=(0,e[i])(t,r,n);if(!I(s)&&!C(s)){if(!P(s))throw TypeError();n=s}}return n}function w(e,t,r){if(v(e,t,r))return!0;var n=K(t);return!C(n)&&w(e,n,r)}function v(e,t,r){var n=Z(t,r,!1);return!I(n)&&N(n.OrdinaryHasOwnMetadata(e,t,r))}function E(e,t,r){if(v(e,t,r))return A(e,t,r);var n=K(t);if(!C(n))return E(e,n,r)}function A(e,t,r){var n=Z(t,r,!1);if(!I(n))return n.OrdinaryGetOwnMetadata(e,t,r)}function x(e,t,r,n){Z(r,n,!0).OrdinaryDefineOwnMetadata(e,t,r,n)}function S(e,t){var r=k(e,t),n=K(e);if(null===n)return r;var i=S(n,t);if(i.length<=0)return r;if(r.length<=0)return i;for(var s=new d,o=[],a=0,l=r;a<l.length;a++){var c=l[a],u=s.has(c);u||(s.add(c),o.push(c))}for(var h=0,f=i;h<f.length;h++){var c=f[h],u=s.has(c);u||(s.add(c),o.push(c))}return o}function k(e,t){var r=Z(e,t,!1);return r?r.OrdinaryOwnMetadataKeys(e,t):[]}function _(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function I(e){return void 0===e}function C(e){return null===e}function T(e){return"symbol"==typeof e}function P(e){return"object"==typeof e?null!==e:"function"==typeof e}function R(e,t){switch(_(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var r=3===t?"string":5===t?"number":"default",n=$(e,i);if(void 0!==n){var s=n.call(e,r);if(P(s))throw TypeError();return s}return O(e,"default"===r?"number":r)}function O(e,t){if("string"===t){var r=e.toString;if(L(r)){var n=r.call(e);if(!P(n))return n}var i=e.valueOf;if(L(i)){var n=i.call(e);if(!P(n))return n}}else{var i=e.valueOf;if(L(i)){var n=i.call(e);if(!P(n))return n}var s=e.toString;if(L(s)){var n=s.call(e);if(!P(n))return n}}throw TypeError()}function N(e){return!!e}function D(e){return""+e}function B(e){var t=R(e,3);return T(t)?t:D(t)}function M(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function L(e){return"function"==typeof e}function F(e){return"function"==typeof e}function U(e){switch(_(e)){case 3:case 4:return!0;default:return!1}}function j(e,t){return e===t||e!=e&&t!=t}function $(e,t){var r=e[t];if(null!=r){if(!L(r))throw TypeError();return r}}function H(e){var t=$(e,s);if(!L(t))throw TypeError();var r=t.call(e);if(!P(r))throw TypeError();return r}function q(e){return e.value}function z(e){var t=e.next();return!t.done&&t}function V(e){var t=e.return;t&&t.call(e)}function K(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===u||t!==u)return t;var r=e.prototype,n=r&&Object.getPrototypeOf(r);if(null==n||n===Object.prototype)return t;var i=n.constructor;return"function"!=typeof i||i===e?t:i}function G(){I(p)||void 0===t.Reflect||p in t.Reflect||"function"!=typeof t.Reflect.defineMetadata||(e=J(t.Reflect));var e,r,n,i,s=new f,o={registerProvider:a,getProvider:c,setProvider:g};return o;function a(t){if(!Object.isExtensible(o))throw Error("Cannot add provider to a frozen registry.");switch(!0){case e===t:break;case I(r):r=t;break;case r===t:break;case I(n):n=t;break;case n===t:break;default:void 0===i&&(i=new d),i.add(t)}}function l(t,s){if(!I(r)){if(r.isProviderFor(t,s))return r;if(!I(n)){if(n.isProviderFor(t,s))return r;if(!I(i))for(var o=H(i);;){var a=z(o);if(!a)return;var l=q(a);if(l.isProviderFor(t,s))return V(o),l}}}if(!I(e)&&e.isProviderFor(t,s))return e}function c(e,t){var r,n=s.get(e);return I(n)||(r=n.get(t)),I(r)&&(I(r=l(e,t))||(I(n)&&(n=new h,s.set(e,n)),n.set(t,r))),r}function u(e){if(I(e))throw TypeError();return r===e||n===e||!I(i)&&i.has(e)}function g(e,t,r){if(!u(r))throw Error("Metadata provider not registered.");var n=c(e,t);if(n!==r){if(!I(n))return!1;var i=s.get(e);I(i)&&(i=new h,s.set(e,i)),i.set(t,r)}return!0}}function W(){var e;return!I(p)&&P(t.Reflect)&&Object.isExtensible(t.Reflect)&&(e=t.Reflect[p]),I(e)&&(e=G()),!I(p)&&P(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,p,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function Q(e){var t=new f,r={isProviderFor:function(e,r){var n=t.get(e);return!I(n)&&n.has(r)},OrdinaryDefineOwnMetadata:o,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:s,OrdinaryOwnMetadataKeys:a,OrdinaryDeleteMetadata:l};return g.registerProvider(r),r;function n(n,i,s){var o=t.get(n),a=!1;if(I(o)){if(!s)return;o=new h,t.set(n,o),a=!0}var l=o.get(i);if(I(l)){if(!s)return;if(l=new h,o.set(i,l),!e.setProvider(n,i,r))throw o.delete(i),a&&t.delete(n),Error("Wrong provider for target.")}return l}function i(e,t,r){var i=n(t,r,!1);return!I(i)&&N(i.has(e))}function s(e,t,r){var i=n(t,r,!1);if(!I(i))return i.get(e)}function o(e,t,r,i){n(r,i,!0).set(e,t)}function a(e,t){var r=[],i=n(e,t,!1);if(I(i))return r;for(var s=H(i.keys()),o=0;;){var a=z(s);if(!a)return r.length=o,r;var l=q(a);try{r[o]=l}catch(e){try{V(s)}finally{throw e}}o++}}function l(e,r,i){var s=n(r,i,!1);if(I(s)||!s.delete(e))return!1;if(0===s.size){var o=t.get(r);I(o)||(o.delete(i),0===o.size&&t.delete(o))}return!0}}function J(e){var t=e.defineMetadata,r=e.hasOwnMetadata,n=e.getOwnMetadata,i=e.getOwnMetadataKeys,s=e.deleteMetadata,o=new f;return{isProviderFor:function(e,t){var r=o.get(e);return!!(!I(r)&&r.has(t))||!!i(e,t).length&&(I(r)&&(r=new d,o.set(e,r)),r.add(t),!0)},OrdinaryDefineOwnMetadata:t,OrdinaryHasOwnMetadata:r,OrdinaryGetOwnMetadata:n,OrdinaryOwnMetadataKeys:i,OrdinaryDeleteMetadata:s}}function Z(e,t,r){var n=g.getProvider(e,t);if(!I(n))return n;if(r){if(g.setProvider(e,t,m))return m;throw Error("Illegal state.")}}function Y(){var e={},t=[],r=function(){function e(e,t,r){this._index=0,this._keys=e,this._values=t,this._selector=r}return e.prototype["@@iterator"]=function(){return this},e.prototype[s]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var r=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var r=this._find(e,!0);return this._values[r]=t,this},t.prototype.delete=function(t){var r=this._find(t,!1);if(r>=0){for(var n=this._keys.length,i=r+1;i<n;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,j(t,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new r(this._keys,this._values,n)},t.prototype.values=function(){return new r(this._keys,this._values,i)},t.prototype.entries=function(){return new r(this._keys,this._values,o)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[s]=function(){return this.entries()},t.prototype._find=function(e,t){if(!j(this._cacheKey,e)){this._cacheIndex=-1;for(var r=0;r<this._keys.length;r++)if(j(this._keys[r],e)){this._cacheIndex=r;break}}return this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function n(e,t){return e}function i(e,t){return t}function o(e,t){return[e,t]}}function X(){return function(){function e(){this._map=new h}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.keys()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[s]=function(){return this.keys()},e}()}function ee(){var e=16,t=c.create(),n=i();return function(){function e(){this._key=i()}return e.prototype.has=function(e){var t=s(e,!1);return void 0!==t&&c.has(t,this._key)},e.prototype.get=function(e){var t=s(e,!1);return void 0!==t?c.get(t,this._key):void 0},e.prototype.set=function(e,t){return s(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=s(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=i()},e}();function i(){var e;do e="@@WeakMap@@"+l();while(c.has(t,e));return t[e]=!0,e}function s(e,t){if(!r.call(e,n)){if(!t)return;Object.defineProperty(e,n,{value:c.create()})}return e[n]}function o(e,t){for(var r=0;r<t;++r)e[r]=255*Math.random()|0;return e}function a(e){if("function"==typeof Uint8Array){var t=new Uint8Array(e);return"undefined"!=typeof crypto?crypto.getRandomValues(t):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(t):o(t,e),t}return o(Array(e),e)}function l(){var t=a(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var r="",n=0;n<e;++n){var i=t[n];(4===n||6===n||8===n)&&(r+="-"),i<16&&(r+="0"),r+=i.toString(16).toLowerCase()}return r}}function et(e){return e.__=void 0,delete e.__,e}e("decorate",function(e,t,r,n){if(I(r)){if(!M(e)||!F(t))throw TypeError();return y(e,t)}if(!M(e)||!P(t)||!P(n)&&!I(n)&&!C(n))throw TypeError();return C(n)&&(n=void 0),b(e,t,r=B(r),n)}),e("metadata",function(e,t){return function(r,n){if(!P(r)||!I(n)&&!U(n))throw TypeError();x(e,t,r,n)}}),e("defineMetadata",function(e,t,r,n){if(!P(r))throw TypeError();return I(n)||(n=B(n)),x(e,t,r,n)}),e("hasMetadata",function(e,t,r){if(!P(t))throw TypeError();return I(r)||(r=B(r)),w(e,t,r)}),e("hasOwnMetadata",function(e,t,r){if(!P(t))throw TypeError();return I(r)||(r=B(r)),v(e,t,r)}),e("getMetadata",function(e,t,r){if(!P(t))throw TypeError();return I(r)||(r=B(r)),E(e,t,r)}),e("getOwnMetadata",function(e,t,r){if(!P(t))throw TypeError();return I(r)||(r=B(r)),A(e,t,r)}),e("getMetadataKeys",function(e,t){if(!P(e))throw TypeError();return I(t)||(t=B(t)),S(e,t)}),e("getOwnMetadataKeys",function(e,t){if(!P(e))throw TypeError();return I(t)||(t=B(t)),k(e,t)}),e("deleteMetadata",function(e,t,r){if(!P(t)||(I(r)||(r=B(r)),!P(t)))throw TypeError();I(r)||(r=B(r));var n=Z(t,r,!1);return!I(n)&&n.OrdinaryDeleteMetadata(e,t,r)})})}(n||(n={}))},83623:e=>{"use strict";e.exports=Math.round},84115:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},84116:e=>{"use strict";let t=7;function r(e,t){return e+n(t)}function n(e){let t=e;return t-=t>>1&0x55555555,((t=(0x33333333&t)+(t>>2&0x33333333))+(t>>4)&0xf0f0f0f)*0x1010101>>24}function i(e,t){return e[0]-t[0]}function s(e){return e[1]}e.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,t){let r=this._internalPositionFor(e,!1);if(void 0===t)-1!==r&&(this._unsetInternalPos(r),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let n=!1;-1===r?(r=this._data.length,this._setBit(e),this._changedData=!0):n=!0,this._setInternalPos(r,e,t,n),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();let t=this._internalPositionFor(e,!0);if(-1!==t)return this._data[t][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){let e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let t=0;for(;t<this.length;)e(this.get(t),t,this),t++}map(e){let t=0,r=Array(this.length);for(;t<this.length;)r[t]=e(this.get(t),t,this),t++;return r}reduce(e,t){let r=0,n=t;for(;r<this.length;)n=e(n,this.get(r),r),r++;return n}find(e){let t=0,r,n;for(;t<this.length&&!r;)r=e(n=this.get(t)),t++;return r?n:void 0}_internalPositionFor(e,i){let s=this._bytePosFor(e,i);if(s>=this._bitArrays.length)return -1;let o=this._bitArrays[s],a=e-s*t;return(o&1<<a)>0?this._bitArrays.slice(0,s).reduce(r,0)+n(o&~(0xffffffff<<a+1))-1:-1}_bytePosFor(e,r){let n=Math.floor(e/t),i=n+1;for(;!r&&this._bitArrays.length<i;)this._bitArrays.push(0);return n}_setBit(e){let r=this._bytePosFor(e,!1);this._bitArrays[r]|=1<<e-r*t}_unsetBit(e){let r=this._bytePosFor(e,!1);this._bitArrays[r]&=~(1<<e-r*t)}_setInternalPos(e,t,r,n){let i=this._data,s=[t,r];if(n)this._sortData(),i[e]=s;else{if(i.length)if(i[i.length-1][0]>=t)i.push(s);else if(i[0][0]<=t)i.unshift(s);else{let e=Math.round(i.length/2);this._data=i.slice(0,e).concat(s).concat(i.slice(e))}else this._data.push(s);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(i),this._changedData=!1}bitField(){let e,t=[],r=8,n=0,i=0,s=this._bitArrays.slice();for(;s.length||n;){0===n&&(e=s.shift(),n=7);let o=Math.min(n,r);i|=(e&~(255<<o))<<8-r,e>>>=o,n-=o,(r-=o)&&(n||s.length)||(t.push(i),i=0,r=8)}for(var o=t.length-1;o>0;o--)if(0===t[o])t.pop();else break;return t}compactArray(){return this._sortData(),this._data.map(s)}}},84896:(e,t,r)=>{e.exports=r(90342)},85407:(e,t,r)=>{"use strict";var n=r(52430),i=r(63674),s=r(60261),o=r(3289);e.exports=function(e){if(e.length<1||"function"!=typeof e[0])throw new i("a function is required");return o(n,s,e)}},86589:e=>{"use strict";e.exports=JSON.parse('{"name":"dotenv","version":"16.5.0","description":"Loads environment variables from .env file","main":"lib/main.js","types":"lib/main.d.ts","exports":{".":{"types":"./lib/main.d.ts","require":"./lib/main.js","default":"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},"scripts":{"dts-check":"tsc --project tests/types/tsconfig.json","lint":"standard","pretest":"npm run lint && npm run dts-check","test":"tap run --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run --show-full-coverage --timeout=60000 --coverage-report=lcov","prerelease":"npm test","release":"standard-version"},"repository":{"type":"git","url":"git://github.com/motdotla/dotenv.git"},"homepage":"https://github.com/motdotla/dotenv#readme","funding":"https://dotenvx.com","keywords":["dotenv","env",".env","environment","variables","config","settings"],"readmeFilename":"README.md","license":"BSD-2-Clause","devDependencies":{"@types/node":"^18.11.3","decache":"^4.6.2","sinon":"^14.0.1","standard":"^17.0.0","standard-version":"^9.5.0","tap":"^19.2.0","typescript":"^4.8.4"},"engines":{"node":">=12"},"browser":{"fs":false}}')},86620:(e,t,r)=>{"use strict";r.d(t,{U:()=>l});var n=r(22938),i=r(77477);let s="/",o=new TextEncoder().encode(s),a=o[0];class l{_buf;constructor(e,t){if("string"==typeof e)this._buf=(0,n.s)(e);else if(e instanceof Uint8Array)this._buf=e;else throw Error("Invalid key, should be String of Uint8Array");if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==a)throw Error("Invalid key")}toString(e="utf8"){return(0,i.d)(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new l(e.join(s))}static random(){return new l(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new l(e):"function"==typeof e.uint8Array?new l(e.uint8Array()):null}clean(){if((null==this._buf||0===this._buf.byteLength)&&(this._buf=o),this._buf[0]!==a){let e=new Uint8Array(this._buf.byteLength+1);e.fill(a,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===a;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;let n=t[e],i=r[e];if(n<i)return!0;if(n>i)return!1}return t.length<r.length}reverse(){return l.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(s).slice(1)}type(){return c(this.baseNamespace())}name(){return u(this.baseNamespace())}instance(e){return new l(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(s)||(e+=s),new l(e+=this.type())}parent(){let e=this.list();return new l(1===e.length?s:e.slice(0,-1).join(s))}child(e){return this.toString()===s?e:e.toString()===s?this:new l(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return l.withNamespaces([...this.namespaces(),...h(e.map(e=>e.namespaces()))])}}function c(e){let t=e.split(":");return t.length<2?"":t.slice(0,-1).join(":")}function u(e){let t=e.split(":");return t[t.length-1]}function h(e){return[].concat(...e)}},86892:(e,t,r)=>{"use strict";let{Buffer:n}=r(44134)||{Buffer:{isBuffer:()=>!1}},{textEncoder:i,textDecoder:s}=r(77697)(),{BufferFormat:o,ViewFormat:a,UTF8Format:l}=r(22846),c=e=>e;t.utf8=new l({encode:function(e){return n.isBuffer(e)?e.toString("utf8"):ArrayBuffer.isView(e)?s.decode(e):String(e)},decode:c,name:"utf8",createViewTranscoder(){return new a({encode:function(e){return ArrayBuffer.isView(e)?e:i.encode(e)},decode:function(e){return s.decode(e)},name:`${this.name}+view`})},createBufferTranscoder(){return new o({encode:function(e){return n.isBuffer(e)?e:ArrayBuffer.isView(e)?n.from(e.buffer,e.byteOffset,e.byteLength):n.from(String(e),"utf8")},decode:function(e){return e.toString("utf8")},name:`${this.name}+buffer`})}}),t.json=new l({encode:JSON.stringify,decode:JSON.parse,name:"json"}),t.buffer=new o({encode:function(e){return n.isBuffer(e)?e:ArrayBuffer.isView(e)?n.from(e.buffer,e.byteOffset,e.byteLength):n.from(String(e),"utf8")},decode:c,name:"buffer",createViewTranscoder(){return new a({encode:function(e){return ArrayBuffer.isView(e)?e:n.from(String(e),"utf8")},decode:function(e){return n.from(e.buffer,e.byteOffset,e.byteLength)},name:`${this.name}+view`})}}),t.view=new a({encode:function(e){return ArrayBuffer.isView(e)?e:i.encode(e)},decode:c,name:"view",createBufferTranscoder(){return new o({encode:function(e){return n.isBuffer(e)?e:ArrayBuffer.isView(e)?n.from(e.buffer,e.byteOffset,e.byteLength):n.from(String(e),"utf8")},decode:c,name:`${this.name}+buffer`})}}),t.hex=new o({encode:function(e){return n.isBuffer(e)?e:n.from(String(e),"hex")},decode:function(e){return e.toString("hex")},name:"hex"}),t.base64=new o({encode:function(e){return n.isBuffer(e)?e:n.from(String(e),"base64")},decode:function(e){return e.toString("base64")},name:"base64"})},87700:(e,t,r)=>{"use strict";var n=r(42066);e.exports=function(e){return n(e)||0===e?e:e<0?-1:1}},87704:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Digest:()=>l,create:()=>s,decode:()=>o,equals:()=>a,hasCode:()=>c});var n=r(70834),i=r(41394);function s(e,t){let r=t.byteLength,n=i.OY(e),s=n+i.OY(r),o=new Uint8Array(s+r);return i.s_(e,o,0),i.s_(r,o,n),o.set(t,s),new l(e,r,t,o)}function o(e){let t=(0,n.coerce)(e),[r,s]=i.D4(t),[o,a]=i.D4(t.subarray(s)),c=t.subarray(s+a);if(c.byteLength!==o)throw Error("Incorrect length");return new l(r,o,c,t)}function a(e,t){if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&(0,n.equals)(e.bytes,r.bytes)}}class l{code;size;digest;bytes;constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}function c(e,t){return e.code===t}},89159:(e,t,r)=>{"use strict";r.d(t,{m:()=>u});var n=r(57116);class i{articleName;astraDb;versionManager;constructor(e,t,r){this.articleName=e,this.astraDb=r,this.versionManager=new n.m9(this.constructVersions(t))}getContent(e){let t=[];return t=e?this.versionManager.getBranch(e):this.versionManager.getMainBranch(),(0,n.a6)(t)}getVersions(){let e=new Set(this.versionManager.getMainBranch().map(e=>e.id));return this.versionManager.getAllVersions().map(t=>({id:t.id,date:t.date,parent:t.parent,mainBranch:e.has(t.id)}))}getCurrentVersionID(){let e=this.versionManager.getMainBranch();if(0===e.length)throw Error("No versions found");return e[e.length-1].id}async newContent(e,t){let r;if(t){let i=this.versionManager.getBranch(t),s=(0,n.a6)(i);r=(0,n.JL)(s,e,t)}else r=(0,n.JL)("",e,t??null);this.versionManager.addVersion(r),await this.astraDb.add(this.articleName,JSON.stringify(r))}constructVersions(e){let t=[];for(let r of e){let e=JSON.parse(r);t.push(e)}return t}}class s{wikiName;astraDb;lastVersionFetchedByArticle;constructor(e,t){this.wikiName=e,this.astraDb=t,this.lastVersionFetchedByArticle=new Map}async getArticle(e,t){let r=await this.astraDb.get(e),n=new i(e,r,this.astraDb);return this.lastVersionFetchedByArticle.set(e,n.getCurrentVersionID()),{name:e,content:n.getContent(t),versionsInfo:n.getVersions()}}async newArticle(e,t){let r=new i(e,[],this.astraDb);await r.newContent(t)}async editArticle(e,t){let r=await this.astraDb.get(e),n=new i(e,r,this.astraDb),s=this.lastVersionFetchedByArticle.get(e);if(!s)throw Error(`Article ${e} was not previously fetched. Fetched articles: ${this.lastVersionFetchedByArticle.keys()}`);await n.newContent(t,s)}async getArticleList(){return this.astraDb.getAllKeys()}}var o=r(22169);class a{wikiName;astraDb;articleRepository;constructor(e){this.wikiName=e}async init(e){this.astraDb=await (0,o.W)({dbName:this.wikiName,isCollaborator:e.isCollaborator,datastore:e.datastore,blockstore:e.blockstore,publicIp:e.publicIp,tcpPort:e.tcpPort,wsPort:e.wsPort,wssPort:e.wssPort,webRTCDirectPort:e.webRTCDirectPort,dataDir:e.dataDir,bootstrapPeers:e.bootstrapPeers,offlineMode:e.offlineMode}),this.articleRepository=new s(this.wikiName,this.astraDb)}async getArticle(e,t){console.log(`Fetching article ${e}`);let r=await this.articleRepository.getArticle(e,t);return console.log(`Article ${e} fetched`),r}async newArticle(e,t){console.log(`Creating article ${e}`),await this.articleRepository.newArticle(e,t),console.log(`Article ${e} created`)}async editArticle(e,t){console.log(`Editing article ${e}`),await this.articleRepository.editArticle(e,t),console.log(`Article ${e} edited`)}async getArticleList(){return await this.articleRepository.getArticleList()}}var l=r(46923),c=r(68250);async function u(e={}){e.wikiName=e.wikiName??"bitxenia-wiki",e.isCollaborator=e.isCollaborator??!1,e.datastore=e.datastore??new c.bk,e.blockstore=e.blockstore??new l.ED,e.publicIp=e.publicIp??"0.0.0.0",e.tcpPort=e.tcpPort??40001,e.wsPort=e.wsPort??40002,e.wssPort=e.wssPort??40003,e.webRTCDirectPort=e.webRTCDirectPort??40001,e.dataDir=e.dataDir??"./data/astrawiki",e.bootstrapPeers=e.bootstrapPeers??[],e.offlineMode=e.offlineMode??!1;let t=new a(e.wikiName);return await t.init(e),t}},90161:(e,t,r)=>{"use strict";r.d(t,{i:()=>n});class n{has(e,t){return Promise.reject(Error(".has is not implemented"))}put(e,t,r){return Promise.reject(Error(".put is not implemented"))}async *putMany(e,t){for await(let{cid:r,block:n}of e)await this.put(r,n,t),yield r}get(e,t){return Promise.reject(Error(".get is not implemented"))}async *getMany(e,t){for await(let r of e)yield{cid:r,block:await this.get(r,t)}}delete(e,t){return Promise.reject(Error(".delete is not implemented"))}async *deleteMany(e,t){for await(let r of e)await this.delete(r,t),yield r}async *getAll(e){throw Error(".getAll is not implemented")}}},90342:(e,t,r)=>{var n=r(29200);t.operation=function(e){return new n(t.timeouts(e),{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var n=[],i=0;i<t.retries;i++)n.push(this.createTimeout(i,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(i,t)),n.sort(function(e,t){return e-t}),n},t.createTimeout=function(e,t){var r=Math.round((t.randomize?Math.random()+1:1)*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(r,t.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var i in n=[],e)"function"==typeof e[i]&&n.push(i);for(var s=0;s<n.length;s++){var o=n[s],a=e[o];e[o]=(function(n){var i=t.operation(r),s=Array.prototype.slice.call(arguments,1),o=s.pop();s.push(function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),o.apply(this,arguments))}),i.attempt(function(){n.apply(e,s)})}).bind(e,a),e[o].options=r}}},91011:e=>{e.exports=function(e){if(!e)throw Error("hashlru must have a max value, of type number, greater than 0");var t=0,r=Object.create(null),n=Object.create(null);function i(i,s){r[i]=s,++t>=e&&(t=0,n=r,r=Object.create(null))}return{has:function(e){return void 0!==r[e]||void 0!==n[e]},remove:function(e){void 0!==r[e]&&(r[e]=void 0),void 0!==n[e]&&(n[e]=void 0)},get:function(e){var t=r[e];return void 0!==t?t:void 0!==(t=n[e])?(i(e,t),t):void 0},set:function(e,t){void 0!==r[e]?r[e]=t:i(e,t)},clear:function(){r=Object.create(null),n=Object.create(null)}}}},91295:(e,t,r)=>{"use strict";function n(e){return null!=e[Symbol.asyncIterator]}r.d(t,{A:()=>i});let i=function(e,t){return n(e)?async function*(){let r=0;if(!(t<1)){for await(let n of e)if(yield n,++r===t)return}}():function*(){let r=0;if(!(t<1)){for(let n of e)if(yield n,++r===t)return}}()}},91453:(e,t,r)=>{"use strict";var n=r(70508),i=r(85407),s=i([n("%String.prototype.indexOf%")]);e.exports=function(e,t){var r=n(e,!!t);return"function"==typeof r&&s(e,".prototype.")>-1?i([r]):r}},92293:(e,t,r)=>{"use strict";r.d(t,{Oh:()=>s});var n=r(12115),i=0;function s(){n.useEffect(()=>{var e,t;let r=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",null!=(e=r[0])?e:o()),document.body.insertAdjacentElement("beforeend",null!=(t=r[1])?t:o()),i++,()=>{1===i&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),i--}},[])}function o(){let e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}},92425:(e,t,r)=>{"use strict";let{AbstractIterator:n,AbstractKeyIterator:i,AbstractValueIterator:s}=r(39070),o=r(7800),a=Symbol("nut"),l=Symbol("undefer"),c=Symbol("factory");class u extends n{constructor(e,t){super(e,t),this[a]=null,this[c]=()=>e.iterator(t),this.db.defer(()=>this[l]())}}class h extends i{constructor(e,t){super(e,t),this[a]=null,this[c]=()=>e.keys(t),this.db.defer(()=>this[l]())}}class d extends s{constructor(e,t){super(e,t),this[a]=null,this[c]=()=>e.values(t),this.db.defer(()=>this[l]())}}for(let e of[u,h,d])e.prototype[l]=function(){"open"===this.db.status&&(this[a]=this[c]())},e.prototype._next=function(e){null!==this[a]?this[a].next(e):"opening"===this.db.status?this.db.defer(()=>this._next(e)):this.nextTick(e,new o("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._nextv=function(e,t,r){null!==this[a]?this[a].nextv(e,t,r):"opening"===this.db.status?this.db.defer(()=>this._nextv(e,t,r)):this.nextTick(r,new o("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._all=function(e,t){null!==this[a]?this[a].all(t):"opening"===this.db.status?this.db.defer(()=>this._all(e,t)):this.nextTick(t,new o("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._seek=function(e,t){null!==this[a]?this[a]._seek(e,t):"opening"===this.db.status&&this.db.defer(()=>this._seek(e,t))},e.prototype._close=function(e){null!==this[a]?this[a].close(e):"opening"===this.db.status?this.db.defer(()=>this._close(e)):this.nextTick(e)};t.DeferredIterator=u,t.DeferredKeyIterator=h,t.DeferredValueIterator=d},92678:e=>{"use strict";e.exports="undefined"!=typeof Reflect&&Reflect&&Reflect.apply},94061:(e,t,r)=>{"use strict";var n=r(39781)(),i=r(91453)("Object.prototype.toString"),s=function(e){return(!n||!e||"object"!=typeof e||!(Symbol.toStringTag in e))&&"[object Arguments]"===i(e)},o=function(e){return!!s(e)||null!==e&&"object"==typeof e&&"length"in e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==i(e)&&"callee"in e&&"[object Function]"===i(e.callee)},a=function(){return s(arguments)}();s.isLegacyArguments=o,e.exports=a?s:o},94858:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;let t={value:e,done:!1};if(this.pullQueue.length){let e=this.pullQueue.shift();e&&e.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),void 0!==this.highWaterMark&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){for(let e of(this.isStopped=!0,this.remove(),this.pullQueue))e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(let t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{let t=Promise.reject(e);t.catch(()=>{}),this.pushQueue.push(t)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{let t=this.pushQueue.shift();return t?(void 0!==this.lowWaterMark&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((e,t)=>{this.pullQueue.push({resolve:e,reject:t})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class n{constructor(e,{highWaterMark:t=100,lowWaterMark:n=1}={}){let i=new r;i.highWaterMark=t,i.lowWaterMark=n,i.removeCallback=e({push:e=>i.push(e),stop:()=>i.stop(),fail:e=>i.fail(e),on:(e,t)=>{i.eventHandlers[e]=t}})||(()=>{}),this[Symbol.asyncIterator]=()=>i[Symbol.asyncIterator](),Object.freeze(this)}}t.EventIterator=n,t.default=n},95120:(e,t,r)=>{var n="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==r.g&&r.g,i=function(){function e(){this.fetch=!1,this.DOMException=n.DOMException}return e.prototype=n,new e}();!function(e){!function(t){var n=void 0!==e&&e||"undefined"!=typeof self&&self||void 0!==r.g&&r.g||{},i={searchParams:"URLSearchParams"in n,iterable:"Symbol"in n&&"iterator"in Symbol,blob:"FileReader"in n&&"Blob"in n&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in n,arrayBuffer:"ArrayBuffer"in n};function s(e){return e&&DataView.prototype.isPrototypeOf(e)}if(i.arrayBuffer)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=ArrayBuffer.isView||function(e){return e&&o.indexOf(Object.prototype.toString.call(e))>-1};function l(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function u(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return i.iterable&&(t[Symbol.iterator]=function(){return t}),t}function h(e){this.map={},e instanceof h?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){if(2!=e.length)throw TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function d(e){if(!e._noBody){if(e.bodyUsed)return Promise.reject(TypeError("Already read"));e.bodyUsed=!0}}function f(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function p(e){var t=new FileReader,r=f(t);return t.readAsArrayBuffer(e),r}function g(e){var t=new FileReader,r=f(t),n=/charset=([A-Za-z0-9_-]+)/.exec(e.type),i=n?n[1]:"utf-8";return t.readAsText(e,i),r}function m(e){for(var t=new Uint8Array(e),r=Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(e){this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:i.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:i.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():i.arrayBuffer&&i.blob&&s(e)?(this._bodyArrayBuffer=y(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):i.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||a(e))?this._bodyArrayBuffer=y(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),!this.headers.get("content-type")&&("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):i.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},i.blob&&(this.blob=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(!this._bodyFormData)return Promise.resolve(new Blob([this._bodyText]));throw Error("could not read FormData body as blob")}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=d(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}if(i.blob)return this.blob().then(p);throw Error("could not read as ArrayBuffer")},this.text=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return g(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(m(this._bodyArrayBuffer));if(!this._bodyFormData)return Promise.resolve(this._bodyText);throw Error("could not read FormData body as text")},i.formData&&(this.formData=function(){return this.text().then(A)}),this.json=function(){return this.text().then(JSON.parse)},this}h.prototype.append=function(e,t){e=l(e),t=c(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},h.prototype.delete=function(e){delete this.map[l(e)]},h.prototype.get=function(e){return e=l(e),this.has(e)?this.map[e]:null},h.prototype.has=function(e){return this.map.hasOwnProperty(l(e))},h.prototype.set=function(e,t){this.map[l(e)]=c(t)},h.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},h.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),u(e)},h.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),u(e)},h.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),u(e)},i.iterable&&(h.prototype[Symbol.iterator]=h.prototype.entries);var w=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function v(e){var t=e.toUpperCase();return w.indexOf(t)>-1?t:e}function E(e,t){if(!(this instanceof E))throw TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r=(t=t||{}).body;if(e instanceof E){if(e.bodyUsed)throw TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new h(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",(t.headers||!this.headers)&&(this.headers=new h(t.headers)),this.method=v(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal||function(){if("AbortController"in n)return new AbortController().signal}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(r),("GET"===this.method||"HEAD"===this.method)&&("no-store"===t.cache||"no-cache"===t.cache)){var i=/([?&])_=[^&]*/;if(i.test(this.url))this.url=this.url.replace(i,"$1_="+new Date().getTime());else{var s=/\?/;this.url+=(s.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}function A(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}}),t}function x(e){var t=new h;return e.replace(/\r?\n[\t ]+/g," ").split("\r").map(function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e}).forEach(function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();try{t.append(n,i)}catch(e){console.warn("Response "+e.message)}}}),t}function S(e,t){if(!(this instanceof S))throw TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.status<200||this.status>599)throw RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new h(t.headers),this.url=t.url||"",this._initBody(e)}E.prototype.clone=function(){return new E(this,{body:this._bodyInit})},b.call(E.prototype),b.call(S.prototype),S.prototype.clone=function(){return new S(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},S.error=function(){var e=new S(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var k=[301,302,303,307,308];S.redirect=function(e,t){if(-1===k.indexOf(t))throw RangeError("Invalid status code");return new S(null,{status:t,headers:{location:e}})},t.DOMException=n.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function _(e,r){return new Promise(function(s,o){var a=new E(e,r);if(a.signal&&a.signal.aborted)return o(new t.DOMException("Aborted","AbortError"));var u=new XMLHttpRequest;function d(){u.abort()}function f(e){try{return""===e&&n.location.href?n.location.href:e}catch(t){return e}}if(u.onload=function(){var e={statusText:u.statusText,headers:x(u.getAllResponseHeaders()||"")};0===a.url.indexOf("file://")&&(u.status<200||u.status>599)?e.status=200:e.status=u.status,e.url="responseURL"in u?u.responseURL:e.headers.get("X-Request-URL");var t="response"in u?u.response:u.responseText;setTimeout(function(){s(new S(t,e))},0)},u.onerror=function(){setTimeout(function(){o(TypeError("Network request failed"))},0)},u.ontimeout=function(){setTimeout(function(){o(TypeError("Network request timed out"))},0)},u.onabort=function(){setTimeout(function(){o(new t.DOMException("Aborted","AbortError"))},0)},u.open(a.method,f(a.url),!0),"include"===a.credentials?u.withCredentials=!0:"omit"===a.credentials&&(u.withCredentials=!1),"responseType"in u&&(i.blob?u.responseType="blob":i.arrayBuffer&&(u.responseType="arraybuffer")),r&&"object"==typeof r.headers&&!(r.headers instanceof h||n.Headers&&r.headers instanceof n.Headers)){var p=[];Object.getOwnPropertyNames(r.headers).forEach(function(e){p.push(l(e)),u.setRequestHeader(e,c(r.headers[e]))}),a.headers.forEach(function(e,t){-1===p.indexOf(t)&&u.setRequestHeader(t,e)})}else a.headers.forEach(function(e,t){u.setRequestHeader(t,e)});a.signal&&(a.signal.addEventListener("abort",d),u.onreadystatechange=function(){4===u.readyState&&a.signal.removeEventListener("abort",d)}),u.send(void 0===a._bodyInit?null:a._bodyInit)})}_.polyfill=!0,n.fetch||(n.fetch=_,n.Headers=h,n.Request=E,n.Response=S),t.Headers=h,t.Request=E,t.Response=S,t.fetch=_}({})}(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var s=n.fetch?n:i;(t=s.fetch).default=s.fetch,t.fetch=s.fetch,t.Headers=s.Headers,t.Request=s.Request,t.Response=s.Response,e.exports=t},95224:(e,t,r)=>{"use strict";var n=r(91453),i=r(36362),s=n("RegExp.prototype.exec"),o=r(63674);e.exports=function(e){if(!i(e))throw new o("`regex` must be a RegExp");return function(t){return null!==s(e,t)}}},95948:(e,t,r)=>{"use strict";let{AbstractChainedBatch:n}=r(57621),i=r(7800),s=Symbol("encoded");class o extends n{constructor(e){super(e),this[s]=[]}_put(e,t,r){this[s].push({...r,type:"put",key:e,value:t})}_del(e,t){this[s].push({...t,type:"del",key:e})}_clear(){this[s]=[]}_write(e,t){"opening"===this.db.status?this.db.defer(()=>this._write(e,t)):"open"===this.db.status?0===this[s].length?this.nextTick(t):this.db._batch(this[s],e,t):this.nextTick(t,new i("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}}t.DefaultChainedBatch=o},96341:e=>{e.exports="function"==typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e)},97141:(e,t,r)=>{"use strict";r.r(t),r.d(t,{sha256:()=>s,sha512:()=>o});var n=r(65639);function i(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}let s=(0,n.H)({name:"sha2-256",code:18,encode:i("SHA-256")}),o=(0,n.H)({name:"sha2-512",code:19,encode:i("SHA-512")})},97233:(e,t,r)=>{"use strict";t.AbstractLevel=r(71094).AbstractLevel,t.AbstractSublevel=r(71094).AbstractSublevel,t.AbstractIterator=r(39070).AbstractIterator,t.AbstractKeyIterator=r(39070).AbstractKeyIterator,t.AbstractValueIterator=r(39070).AbstractValueIterator,t.AbstractChainedBatch=r(57621).AbstractChainedBatch},97967:(e,t,r)=>{var n=r(49509),i=r(44134).Buffer;let s=r(72016),o=r(71807),a=r(668),l=r(8777),c=r(86589).version,u=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function h(e){console.log(`[dotenv@${c}][WARN] ${e}`)}function d(e){console.log(`[dotenv@${c}][DEBUG] ${e}`)}function f(e){return e&&e.DOTENV_KEY&&e.DOTENV_KEY.length>0?e.DOTENV_KEY:n.env.DOTENV_KEY&&n.env.DOTENV_KEY.length>0?n.env.DOTENV_KEY:""}function p(e,t){let r;try{r=new URL(t)}catch(e){if("ERR_INVALID_URL"===e.code){let e=Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw e.code="INVALID_DOTENV_KEY",e}throw e}let n=r.password;if(!n){let e=Error("INVALID_DOTENV_KEY: Missing key part");throw e.code="INVALID_DOTENV_KEY",e}let i=r.searchParams.get("environment");if(!i){let e=Error("INVALID_DOTENV_KEY: Missing environment part");throw e.code="INVALID_DOTENV_KEY",e}let s=`DOTENV_VAULT_${i.toUpperCase()}`,o=e.parsed[s];if(!o){let e=Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${s} in your .env.vault file.`);throw e.code="NOT_FOUND_DOTENV_ENVIRONMENT",e}return{ciphertext:o,key:n}}function g(e){let t=null;if(e&&e.path&&e.path.length>0)if(Array.isArray(e.path))for(let r of e.path)s.existsSync(r)&&(t=r.endsWith(".vault")?r:`${r}.vault`);else t=e.path.endsWith(".vault")?e.path:`${e.path}.vault`;else t=o.resolve(n.cwd(),".env.vault");return s.existsSync(t)?t:null}function m(e){return"~"===e[0]?o.join(a.homedir(),e.slice(1)):e}let y={configDotenv:function(e){let t,r=o.resolve(n.cwd(),".env"),i="utf8",a=!!(e&&e.debug);e&&e.encoding?i=e.encoding:a&&d("No encoding is specified. UTF-8 is used by default");let l=[r];if(e&&e.path)if(Array.isArray(e.path))for(let t of(l=[],e.path))l.push(m(t));else l=[m(e.path)];let c={};for(let r of l)try{let t=y.parse(s.readFileSync(r,{encoding:i}));y.populate(c,t,e)}catch(e){a&&d(`Failed to load ${r} ${e.message}`),t=e}let u=n.env;return(e&&null!=e.processEnv&&(u=e.processEnv),y.populate(u,c,e),t)?{parsed:c,error:t}:{parsed:c}},_configVault:function(e){e&&e.debug&&d("Loading env from encrypted .env.vault");let t=y._parseVault(e),r=n.env;return e&&null!=e.processEnv&&(r=e.processEnv),y.populate(r,t,e),{parsed:t}},_parseVault:function(e){let t,r=g(e),n=y.configDotenv({path:r});if(!n.parsed){let e=Error(`MISSING_DATA: Cannot parse ${r} for an unknown reason`);throw e.code="MISSING_DATA",e}let i=f(e).split(","),s=i.length;for(let e=0;e<s;e++)try{let r=i[e].trim(),s=p(n,r);t=y.decrypt(s.ciphertext,s.key);break}catch(t){if(e+1>=s)throw t}return y.parse(t)},config:function(e){if(0===f(e).length)return y.configDotenv(e);let t=g(e);return t?y._configVault(e):(h(`You set DOTENV_KEY but you are missing a .env.vault file at ${t}. Did you forget to build it?`),y.configDotenv(e))},decrypt:function(e,t){let r=i.from(t.slice(-64),"hex"),n=i.from(e,"base64"),s=n.subarray(0,12),o=n.subarray(-16);n=n.subarray(12,-16);try{let e=l.createDecipheriv("aes-256-gcm",r,s);return e.setAuthTag(o),`${e.update(n)}${e.final()}`}catch(n){let e=n instanceof RangeError,t="Invalid key length"===n.message,r="Unsupported state or unable to authenticate data"===n.message;if(e||t){let e=Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw e.code="INVALID_DOTENV_KEY",e}if(r){let e=Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw e.code="DECRYPTION_FAILED",e}throw n}},parse:function(e){let t,r={},n=e.toString();for(n=n.replace(/\r\n?/mg,"\n");null!=(t=u.exec(n));){let e=t[1],n=t[2]||"",i=(n=n.trim())[0];n=n.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),'"'===i&&(n=(n=n.replace(/\\n/g,"\n")).replace(/\\r/g,"\r")),r[e]=n}return r},populate:function(e,t,r={}){let n=!!(r&&r.debug),i=!!(r&&r.override);if("object"!=typeof t){let e=Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw e.code="OBJECT_REQUIRED",e}for(let r of Object.keys(t))Object.prototype.hasOwnProperty.call(e,r)?(!0===i&&(e[r]=t[r]),n&&(!0===i?d(`"${r}" is already defined and WAS overwritten`):d(`"${r}" is already defined and was NOT overwritten`))):e[r]=t[r]}};e.exports.configDotenv=y.configDotenv,e.exports._configVault=y._configVault,e.exports._parseVault=y._parseVault,e.exports.config=y.config,e.exports.decrypt=y.decrypt,e.exports.parse=y.parse,e.exports.populate=y.populate,e.exports=y},97968:e=>{"use strict";e.exports=URIError},98897:(e,t,r)=>{"use strict";r.d(t,{DI:()=>a,kR:()=>o,m_:()=>c,c0:()=>n,F9:()=>s});class n extends Error{static name="OpenFailedError";static code="ERR_OPEN_FAILED";name=n.name;code=n.code;constructor(e="Open failed"){super(e)}}class i extends Error{static name="CloseFailedError";static code="ERR_CLOSE_FAILED";name=i.name;code=i.code;constructor(e="Close failed"){super(e)}}class s extends Error{static name="PutFailedError";static code="ERR_PUT_FAILED";name=s.name;code=s.code;constructor(e="Put failed"){super(e)}}class o extends Error{static name="GetFailedError";static code="ERR_GET_FAILED";name=o.name;code=o.code;constructor(e="Get failed"){super(e)}}class a extends Error{static name="DeleteFailedError";static code="ERR_DELETE_FAILED";name=a.name;code=a.code;constructor(e="Delete failed"){super(e)}}class l extends Error{static name="HasFailedError";static code="ERR_HAS_FAILED";name=l.name;code=l.code;constructor(e="Has failed"){super(e)}}class c extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=c.name;code=c.code;constructor(e="Not Found"){super(e)}}class u extends Error{static name="AbortError";static code="ERR_ABORTED";name=u.name;code=u.code;constructor(e="Aborted"){super(e)}}}}]);